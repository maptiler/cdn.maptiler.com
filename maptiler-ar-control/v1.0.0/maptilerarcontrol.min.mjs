import{LngLat as Sa}from"@maptiler/sdk";import*as j from"three";import{Quaternion as un,Matrix4 as Ft,RGBAFormat as $t,RGBA_ASTC_4x4_Format as rc,RGBA_BPTC_Format as ac,RGBA_ETC2_EAC_Format as oc,RGBA_PVRTC_4BPPV1_Format as Ac,RGBA_S3TC_DXT5_Format as lc,RGB_ETC1_Format as hc,RGB_ETC2_Format as cc,RGB_PVRTC_4BPPV1_Format as uc,RGB_S3TC_DXT1_Format as dc,Texture as hi,Vector3 as R,Color as yt,Vector2 as wt,PerspectiveCamera as Xi,MeshBasicMaterial as kt,PlaneGeometry as Zi,Matrix3 as dn,Triangle as Ma,Raycaster as gc,Loader as gn,FileLoader as he,SRGBColorSpace as gt,LinearSRGBColorSpace as ts,BufferGeometry as pn,BufferAttribute as _t,CompressedArrayTexture as pc,UnsignedByteType as Jt,CompressedTexture as mc,LinearFilter as ce,LinearMipmapLinearFilter as es,NoColorSpace as mn,EventDispatcher as ci,WebGLRenderer as fc,NoToneMapping as La,LoaderUtils as fn,SpotLight as Ic,PointLight as In,DirectionalLight as Ta,MeshPhysicalMaterial as ue,InstancedMesh as Cc,Object3D as ui,TextureLoader as Da,ImageBitmapLoader as Ec,InterleavedBuffer as Bc,InterleavedBufferAttribute as yc,RepeatWrapping as De,PointsMaterial as wc,Material as is,LineBasicMaterial as Qc,MeshStandardMaterial as Re,DoubleSide as Fe,PropertyBinding as di,SkinnedMesh as vc,Mesh as F,LineSegments as bc,Line as xc,LineLoop as Sc,Points as Mc,Group as ss,MathUtils as ns,OrthographicCamera as rs,Skeleton as Lc,InterpolateLinear as Cn,AnimationClip as Tc,Bone as Dc,FloatType as de,HalfFloatType as xt,DataTexture as Rc,Data3DTexture as Fc,Spherical as as,Euler as Ra,ShaderMaterial as os,Scene as Kt,WebGLRenderTarget as As,Sphere as En,FrontSide as Bn,EquirectangularReflectionMapping as kc,sRGBEncoding as yn,WebGLCubeRenderTarget as Fa,CubeCamera as ka,BoxGeometry as wn,NoBlending as _c,BackSide as ls,VideoTexture as Uc,CanvasTexture as Nc,LoopPingPong as _a,LoopOnce as Gc,LoopRepeat as Ua,TrianglesDrawMode as Pc,TriangleFanDrawMode as Qn,TriangleStripDrawMode as Na,NearestFilter as Ga,NearestMipmapNearestFilter as Pa,LinearMipmapNearestFilter as Oa,NearestMipmapLinearFilter as Ha,ClampToEdgeWrapping as qa,MirroredRepeatWrapping as Va,InterpolateDiscrete as $a,VectorKeyframeTrack as Oc,QuaternionKeyframeTrack as Ja,NumberKeyframeTrack as Hc,Box3 as ge,RGFormat as hs,RedFormat as cs,LightProbe as qc,Float32BufferAttribute as Vc,DataTextureLoader as $c,AnimationMixer as Jc,Interpolant as Kc,Source as Yc,DataUtils as us,MeshDepthMaterial as zc,LinearEncoding as vn}from"three";import jc from"events";import{GLTFExporter as Wc}from"three/examples/jsm/exporters/GLTFExporter.js";import*as bn from"three/examples/jsm/libs/fflate.module.js";var Xc=Object.defineProperty,Zc=Object.defineProperties,tu=Object.getOwnPropertyDescriptors,Ka=Object.getOwnPropertySymbols,eu=Object.getPrototypeOf,iu=Object.prototype.hasOwnProperty,su=Object.prototype.propertyIsEnumerable,nu=Reflect.get,Ya=(a,t,e)=>t in a?Xc(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,ru=(a,t)=>{for(var e in t||(t={}))iu.call(t,e)&&Ya(a,e,t[e]);if(Ka)for(var e of Ka(t))su.call(t,e)&&Ya(a,e,t[e]);return a},au=(a,t)=>Zc(a,tu(t)),xn=(a,t,e)=>nu(eu(a),e,t),b=(a,t,e)=>new Promise((i,s)=>{var n=A=>{try{o(e.next(A))}catch(l){s(l)}},r=A=>{try{o(e.throw(A))}catch(l){s(l)}},o=A=>A.done?i(A.value):Promise.resolve(A.value).then(n,r);o((e=e.apply(a,t)).next())});/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/const ou=(a,t)=>t.kind==="method"&&t.descriptor&&!("value"in t.descriptor)?au(ru({},t),{finisher(e){e.createProperty(t.key,a)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){typeof t.initializer=="function"&&(this[t.key]=t.initializer.call(this))},finisher(e){e.createProperty(t.key,a)}};function T(a){return(t,e)=>e!==void 0?((i,s,n)=>{s.constructor.createProperty(n,i)})(a,t,e):ou(a,t)}/**
* @license
* Copyright 2021 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var Sn;((Sn=window.HTMLSlotElement)===null||Sn===void 0?void 0:Sn.prototype.assignedElements)!=null;/**
* @license
* Copyright 2019 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/const ds=window,Mn=ds.ShadowRoot&&(ds.ShadyCSS===void 0||ds.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,za=Symbol(),ja=new WeakMap;class Au{constructor(t,e,i){if(this._$cssResult$=!0,i!==za)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(Mn&&t===void 0){const i=e!==void 0&&e.length===1;i&&(t=ja.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&ja.set(e,t))}return t}toString(){return this.cssText}}const lu=a=>new Au(typeof a=="string"?a:a+"",void 0,za),hu=(a,t)=>{Mn?a.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet):t.forEach(e=>{const i=document.createElement("style"),s=ds.litNonce;s!==void 0&&i.setAttribute("nonce",s),i.textContent=e.cssText,a.appendChild(i)})},Wa=Mn?a=>a:a=>a instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return lu(e)})(a):a;/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var Ln;const gs=window,Xa=gs.trustedTypes,cu=Xa?Xa.emptyScript:"",Za=gs.reactiveElementPolyfillSupport,Tn={toAttribute(a,t){switch(t){case Boolean:a=a?cu:null;break;case Object:case Array:a=a==null?a:JSON.stringify(a)}return a},fromAttribute(a,t){let e=a;switch(t){case Boolean:e=a!==null;break;case Number:e=a===null?null:Number(a);break;case Object:case Array:try{e=JSON.parse(a)}catch{e=null}}return e}},to=(a,t)=>t!==a&&(t==t||a==a),Dn={attribute:!0,type:String,converter:Tn,reflect:!1,hasChanged:to};class pe extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(t){var e;this.finalize(),((e=this.h)!==null&&e!==void 0?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach((e,i)=>{const s=this._$Ep(i,e);s!==void 0&&(this._$Ev.set(s,i),t.push(s))}),t}static createProperty(t,e=Dn){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const i=typeof t=="symbol"?Symbol():"__"+t,s=this.getPropertyDescriptor(t,i,e);s!==void 0&&Object.defineProperty(this.prototype,t,s)}}static getPropertyDescriptor(t,e,i){return{get(){return this[e]},set(s){const n=this[t];this[e]=s,this.requestUpdate(t,n,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||Dn}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),t.h!==void 0&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,i=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const s of i)this.createProperty(s,e[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const s of i)e.unshift(Wa(s))}else t!==void 0&&e.push(Wa(t));return e}static _$Ep(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}u(){var t;this._$E_=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(t=this.constructor.h)===null||t===void 0||t.forEach(e=>e(this))}addController(t){var e,i;((e=this._$ES)!==null&&e!==void 0?e:this._$ES=[]).push(t),this.renderRoot!==void 0&&this.isConnected&&((i=t.hostConnected)===null||i===void 0||i.call(t))}removeController(t){var e;(e=this._$ES)===null||e===void 0||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])})}createRenderRoot(){var t;const e=(t=this.shadowRoot)!==null&&t!==void 0?t:this.attachShadow(this.constructor.shadowRootOptions);return hu(e,this.constructor.elementStyles),e}connectedCallback(){var t;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$ES)===null||t===void 0||t.forEach(e=>{var i;return(i=e.hostConnected)===null||i===void 0?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$ES)===null||t===void 0||t.forEach(e=>{var i;return(i=e.hostDisconnected)===null||i===void 0?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EO(t,e,i=Dn){var s;const n=this.constructor._$Ep(t,i);if(n!==void 0&&i.reflect===!0){const r=(((s=i.converter)===null||s===void 0?void 0:s.toAttribute)!==void 0?i.converter:Tn).toAttribute(e,i.type);this._$El=t,r==null?this.removeAttribute(n):this.setAttribute(n,r),this._$El=null}}_$AK(t,e){var i;const s=this.constructor,n=s._$Ev.get(t);if(n!==void 0&&this._$El!==n){const r=s.getPropertyOptions(n),o=typeof r.converter=="function"?{fromAttribute:r.converter}:((i=r.converter)===null||i===void 0?void 0:i.fromAttribute)!==void 0?r.converter:Tn;this._$El=n,this[n]=o.fromAttribute(e,r.type),this._$El=null}}requestUpdate(t,e,i){let s=!0;t!==void 0&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||to)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),i.reflect===!0&&this._$El!==t&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(t,i))):s=!1),!this.isUpdatePending&&s&&(this._$E_=this._$Ej())}_$Ej(){return b(this,null,function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&(yield t),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((s,n)=>this[n]=s),this._$Ei=void 0);let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$ES)===null||t===void 0||t.forEach(s=>{var n;return(n=s.hostUpdate)===null||n===void 0?void 0:n.call(s)}),this.update(i)):this._$Ek()}catch(s){throw e=!1,this._$Ek(),s}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$ES)===null||e===void 0||e.forEach(i=>{var s;return(s=i.hostUpdated)===null||s===void 0?void 0:s.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){this._$EC!==void 0&&(this._$EC.forEach((e,i)=>this._$EO(i,this[i],e)),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}pe.finalized=!0,pe.elementProperties=new Map,pe.elementStyles=[],pe.shadowRootOptions={mode:"open"},Za?.({ReactiveElement:pe}),((Ln=gs.reactiveElementVersions)!==null&&Ln!==void 0?Ln:gs.reactiveElementVersions=[]).push("1.6.1");/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var Rn;const ps=window,ke=ps.trustedTypes,eo=ke?ke.createPolicy("lit-html",{createHTML:a=>a}):void 0,Fn="$lit$",Yt=`lit$${(Math.random()+"").slice(9)}$`,io="?"+Yt,uu=`<${io}>`,_e=document,gi=()=>_e.createComment(""),pi=a=>a===null||typeof a!="object"&&typeof a!="function",so=Array.isArray,du=a=>so(a)||typeof a?.[Symbol.iterator]=="function",kn=`[ 	
\f\r]`,mi=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,no=/-->/g,ro=/>/g,me=RegExp(`>|${kn}(?:([^\\s"'>=/]+)(${kn}*=${kn}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),ao=/'/g,oo=/"/g,Ao=/^(?:script|style|textarea|title)$/i,gu=a=>(t,...e)=>({_$litType$:a,strings:t,values:e}),ms=gu(1),Ue=Symbol.for("lit-noChange"),W=Symbol.for("lit-nothing"),lo=new WeakMap,Ne=_e.createTreeWalker(_e,129,null,!1),pu=(a,t)=>{const e=a.length-1,i=[];let s,n=t===2?"<svg>":"",r=mi;for(let A=0;A<e;A++){const l=a[A];let c,h,d=-1,u=0;for(;u<l.length&&(r.lastIndex=u,h=r.exec(l),h!==null);)u=r.lastIndex,r===mi?h[1]==="!--"?r=no:h[1]!==void 0?r=ro:h[2]!==void 0?(Ao.test(h[2])&&(s=RegExp("</"+h[2],"g")),r=me):h[3]!==void 0&&(r=me):r===me?h[0]===">"?(r=s??mi,d=-1):h[1]===void 0?d=-2:(d=r.lastIndex-h[2].length,c=h[1],r=h[3]===void 0?me:h[3]==='"'?oo:ao):r===oo||r===ao?r=me:r===no||r===ro?r=mi:(r=me,s=void 0);const g=r===me&&a[A+1].startsWith("/>")?" ":"";n+=r===mi?l+uu:d>=0?(i.push(c),l.slice(0,d)+Fn+l.slice(d)+Yt+g):l+Yt+(d===-2?(i.push(void 0),A):g)}const o=n+(a[e]||"<?>")+(t===2?"</svg>":"");if(!Array.isArray(a)||!a.hasOwnProperty("raw"))throw Error("invalid template strings array");return[eo!==void 0?eo.createHTML(o):o,i]};class zi{constructor({strings:t,_$litType$:e},i){let s;this.parts=[];let n=0,r=0;const o=t.length-1,A=this.parts,[l,c]=pu(t,e);if(this.el=zi.createElement(l,i),Ne.currentNode=this.el.content,e===2){const h=this.el.content,d=h.firstChild;d.remove(),h.append(...d.childNodes)}for(;(s=Ne.nextNode())!==null&&A.length<o;){if(s.nodeType===1){if(s.hasAttributes()){const h=[];for(const d of s.getAttributeNames())if(d.endsWith(Fn)||d.startsWith(Yt)){const u=c[r++];if(h.push(d),u!==void 0){const g=s.getAttribute(u.toLowerCase()+Fn).split(Yt),m=/([.?@])?(.*)/.exec(u);A.push({type:1,index:n,name:m[2],strings:g,ctor:m[1]==="."?fu:m[1]==="?"?Cu:m[1]==="@"?Eu:fs})}else A.push({type:6,index:n})}for(const d of h)s.removeAttribute(d)}if(Ao.test(s.tagName)){const h=s.textContent.split(Yt),d=h.length-1;if(d>0){s.textContent=ke?ke.emptyScript:"";for(let u=0;u<d;u++)s.append(h[u],gi()),Ne.nextNode(),A.push({type:2,index:++n});s.append(h[d],gi())}}}else if(s.nodeType===8)if(s.data===io)A.push({type:2,index:n});else{let h=-1;for(;(h=s.data.indexOf(Yt,h+1))!==-1;)A.push({type:7,index:n}),h+=Yt.length-1}n++}}static createElement(t,e){const i=_e.createElement("template");return i.innerHTML=t,i}}function Ge(a,t,e=a,i){var s,n,r,o;if(t===Ue)return t;let A=i!==void 0?(s=e._$Co)===null||s===void 0?void 0:s[i]:e._$Cl;const l=pi(t)?void 0:t._$litDirective$;return A?.constructor!==l&&((n=A?._$AO)===null||n===void 0||n.call(A,!1),l===void 0?A=void 0:(A=new l(a),A._$AT(a,e,i)),i!==void 0?((r=(o=e)._$Co)!==null&&r!==void 0?r:o._$Co=[])[i]=A:e._$Cl=A),A!==void 0&&(t=Ge(a,A._$AS(a,t.values),A,i)),t}class mu{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var e;const{el:{content:i},parts:s}=this._$AD,n=((e=t?.creationScope)!==null&&e!==void 0?e:_e).importNode(i,!0);Ne.currentNode=n;let r=Ne.nextNode(),o=0,A=0,l=s[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new ji(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new Bu(r,this,t)),this._$AV.push(c),l=s[++A]}o!==l?.index&&(r=Ne.nextNode(),o++)}return n}v(t){let e=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class ji{constructor(t,e,i,s){var n;this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=s,this._$Cp=(n=s?.isConnected)===null||n===void 0||n}get _$AU(){var t,e;return(e=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&e!==void 0?e:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t?.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Ge(this,t,e),pi(t)?t===W||t==null||t===""?(this._$AH!==W&&this._$AR(),this._$AH=W):t!==this._$AH&&t!==Ue&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):du(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==W&&pi(this._$AH)?this._$AA.nextSibling.data=t:this.$(_e.createTextNode(t)),this._$AH=t}g(t){var e;const{values:i,_$litType$:s}=t,n=typeof s=="number"?this._$AC(t):(s.el===void 0&&(s.el=zi.createElement(s.h,this.options)),s);if(((e=this._$AH)===null||e===void 0?void 0:e._$AD)===n)this._$AH.v(i);else{const r=new mu(n,this),o=r.u(this.options);r.v(i),this.$(o),this._$AH=r}}_$AC(t){let e=lo.get(t.strings);return e===void 0&&lo.set(t.strings,e=new zi(t)),e}T(t){so(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,s=0;for(const n of t)s===e.length?e.push(i=new ji(this.k(gi()),this.k(gi()),this,this.options)):i=e[s],i._$AI(n),s++;s<e.length&&(this._$AR(i&&i._$AB.nextSibling,s),e.length=s)}_$AR(t=this._$AA.nextSibling,e){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,e);t&&t!==this._$AB;){const s=t.nextSibling;t.remove(),t=s}}setConnected(t){var e;this._$AM===void 0&&(this._$Cp=t,(e=this._$AP)===null||e===void 0||e.call(this,t))}}class fs{constructor(t,e,i,s,n){this.type=1,this._$AH=W,this._$AN=void 0,this.element=t,this.name=e,this._$AM=s,this.options=n,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=W}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,i,s){const n=this.strings;let r=!1;if(n===void 0)t=Ge(this,t,e,0),r=!pi(t)||t!==this._$AH&&t!==Ue,r&&(this._$AH=t);else{const o=t;let A,l;for(t=n[0],A=0;A<n.length-1;A++)l=Ge(this,o[i+A],e,A),l===Ue&&(l=this._$AH[A]),r||(r=!pi(l)||l!==this._$AH[A]),l===W?t=W:t!==W&&(t+=(l??"")+n[A+1]),this._$AH[A]=l}r&&!s&&this.j(t)}j(t){t===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class fu extends fs{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===W?void 0:t}}const Iu=ke?ke.emptyScript:"";class Cu extends fs{constructor(){super(...arguments),this.type=4}j(t){t&&t!==W?this.element.setAttribute(this.name,Iu):this.element.removeAttribute(this.name)}}class Eu extends fs{constructor(t,e,i,s,n){super(t,e,i,s,n),this.type=5}_$AI(t,e=this){var i;if((t=(i=Ge(this,t,e,0))!==null&&i!==void 0?i:W)===Ue)return;const s=this._$AH,n=t===W&&s!==W||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==W&&(s===W||n);n&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,i;typeof this._$AH=="function"?this._$AH.call((i=(e=this.options)===null||e===void 0?void 0:e.host)!==null&&i!==void 0?i:this.element,t):this._$AH.handleEvent(t)}}class Bu{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){Ge(this,t)}}const ho=ps.litHtmlPolyfillSupport;ho?.(zi,ji),((Rn=ps.litHtmlVersions)!==null&&Rn!==void 0?Rn:ps.litHtmlVersions=[]).push("2.7.3");const co=(a,t,e)=>{var i,s;const n=(i=e?.renderBefore)!==null&&i!==void 0?i:t;let r=n._$litPart$;if(r===void 0){const o=(s=e?.renderBefore)!==null&&s!==void 0?s:null;n._$litPart$=r=new ji(t.insertBefore(gi(),o),o,void 0,e??{})}return r._$AI(a),r};/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var _n,Un;class Is extends pe{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const i=super.createRenderRoot();return(t=(e=this.renderOptions).renderBefore)!==null&&t!==void 0||(e.renderBefore=i.firstChild),i}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=co(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._$Do)===null||t===void 0||t.setConnected(!1)}render(){return Ue}}Is.finalized=!0,Is._$litElement$=!0,(_n=globalThis.litElementHydrateSupport)===null||_n===void 0||_n.call(globalThis,{LitElement:Is});const uo=globalThis.litElementPolyfillSupport;uo?.({LitElement:Is}),((Un=globalThis.litElementVersions)!==null&&Un!==void 0?Un:globalThis.litElementVersions=[]).push("3.3.2");/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const go=navigator.xr!=null&&self.XRSession!=null&&navigator.xr.isSessionSupported!=null,po=go&&self.XRSession.prototype.requestHitTestSource!=null,Nn=self.ResizeObserver!=null,Gn=self.IntersectionObserver!=null,mo=po;(()=>{const a=navigator.userAgent||navigator.vendor||self.opera;let t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(t=!0),t})(),/\bCrOS\b/.test(navigator.userAgent);const yu=/android/i.test(navigator.userAgent),fo=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;/Safari\//.test(navigator.userAgent);const wu=/firefox/i.test(navigator.userAgent),Qu=/OculusBrowser/.test(navigator.userAgent);fo&&/CriOS\//.test(navigator.userAgent);const vu=yu&&!wu&&!Qu,bu=Boolean(window.webkit&&window.webkit.messageHandlers),Io=(()=>{if(fo){if(bu)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const a=document.createElement("a");return Boolean(a.relList&&a.relList.supports&&a.relList.supports("ar"))}}else return!1})();/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Co=a=>!!a&&a!=="null"?xu(a):null,Eo=()=>{if(mo)return;const a=[];throw go||a.push("WebXR Device API"),po||a.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${a.join(", ")}`)},xu=a=>new URL(a,window.location.toString()).toString(),Su=(a,t)=>{let e=null;const i=(...s)=>{e==null&&(a(...s),e=self.setTimeout(()=>e=null,t))};return i.flush=()=>{e!=null&&(self.clearTimeout(e),e=null)},i},Bo=(a,t)=>{let e=null;return(...i)=>{e!=null&&self.clearTimeout(e),e=self.setTimeout(()=>{e=null,a(...i)},t)}},St=(a,t,e)=>Math.max(t,Math.min(e,a)),Mu=1,Pn=(()=>{const a=(()=>{var t;if(!((t=document.documentElement.getAttribute("itemtype"))===null||t===void 0)&&t.includes("schema.org/SearchResultsPage"))return!0;const e=document.head!=null?Array.from(document.head.querySelectorAll("meta")):[];for(const i of e)if(i.name==="viewport")return!0;return!1})();return a||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),()=>a?window.devicePixelRatio:Mu})(),yo=(()=>{const a="model-viewer-debug-mode",t=new RegExp(`[?&]${a}(&|$)`);return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(t)})(),Lu=(a=0)=>new Promise(t=>setTimeout(t,a)),Tu=(a,t,e=null)=>new Promise(i=>{function s(n){(!e||e(n))&&(i(n),a.removeEventListener(t,s))}a.addEventListener(t,s)});/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var fi=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};const Du=.5,Ru=0,Fu=1,ku=1,Ii=Symbol("currentEnvironmentMap"),Ci=Symbol("currentBackground"),Cs=Symbol("updateEnvironment"),Es=Symbol("cancelEnvironmentUpdate"),_u=a=>{var t,e,i;class s extends a{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=Ru,this.shadowSoftness=Fu,this.exposure=ku,this[t]=null,this[e]=null,this[i]=null}updated(r){super.updated(r),r.has("shadowIntensity")&&(this[Q].setShadowIntensity(this.shadowIntensity*Du),this[ct]()),r.has("shadowSoftness")&&(this[Q].setShadowSoftness(this.shadowSoftness),this[ct]()),r.has("exposure")&&(this[Q].exposure=this.exposure,this[ct]()),(r.has("environmentImage")||r.has("skyboxImage"))&&this[si]()&&this[Cs]()}hasBakedShadow(){return this[Q].bakedShadows.size>0}[(t=Ii,e=Ci,i=Es,Cs)](){return b(this,null,function*(){const{skyboxImage:r,environmentImage:o}=this;this[Es]!=null&&(this[Es](),this[Es]=null);const{textureUtils:A}=this[O];if(A==null)return;const l=this[be].beginActivity();try{const{environmentMap:c,skybox:h}=yield A.generateEnvironmentMapAndSkybox(Co(r),o,d=>l(St(d,0,1)));this[Ii]!==c&&(this[Ii]=c,this.dispatchEvent(new CustomEvent("environment-change"))),h!=null?this[Ci]=h.name===c.name?c:h:this[Ci]=null,this[Q].setEnvironmentAndSkybox(this[Ii],this[Ci]),this[Q].dispatchEvent({type:"envmap-update"})}catch(c){if(c instanceof Error)throw this[Q].setEnvironmentAndSkybox(null,null),c}finally{l(1)}})}}return fi([T({type:String,attribute:"environment-image"})],s.prototype,"environmentImage",void 0),fi([T({type:String,attribute:"skybox-image"})],s.prototype,"skyboxImage",void 0),fi([T({type:Number,attribute:"shadow-intensity"})],s.prototype,"shadowIntensity",void 0),fi([T({type:Number,attribute:"shadow-softness"})],s.prototype,"shadowSoftness",void 0),fi([T({type:Number})],s.prototype,"exposure",void 0),s};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Uu=ms`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Nu=ms`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Gu=ms`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Pu=ms`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          aria-label="View in your space">
        ${Gu}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${Nu}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${Uu}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,Ou=a=>{co(Pu,a)},On=new WeakMap;class Hu extends gn{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,s){const n=new he(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,r=>{this.parse(r,e,s)},i,s)}parse(t,e,i){this.decodeDracoFile(t,e,null,null,gt).catch(i)}decodeDracoFile(t,e,i,s,n=ts){const r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:n};return this.decodeGeometry(t,r).then(e)}decodeGeometry(t,e){const i=JSON.stringify(e);if(On.has(t)){const A=On.get(t);if(A.key===i)return A.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const n=this.workerNextTaskID++,r=t.byteLength,o=this._getWorker(n,r).then(A=>(s=A,new Promise((l,c)=>{s._callbacks[n]={resolve:l,reject:c},s.postMessage({type:"decode",id:n,taskConfig:e,buffer:t},[t])}))).then(A=>this._createGeometry(A.geometry));return o.catch(()=>!0).then(()=>{s&&n&&this._releaseTask(s,n)}),On.set(t,{key:i,promise:o}),o}_createGeometry(t){const e=new pn;t.index&&e.setIndex(new _t(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const s=t.attributes[i],n=s.name,r=s.array,o=s.itemSize,A=new _t(r,o);n==="color"&&this._assignVertexColorSpace(A,s.vertexColorSpace),e.setAttribute(n,A)}return e}_assignVertexColorSpace(t,e){if(e!==gt)return;const i=new yt;for(let s=0,n=t.count;s<n;s++)i.fromBufferAttribute(t,s).convertSRGBToLinear(),t.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(t,e){const i=new he(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((s,n)=>{i.load(t,s,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{const s=i[0];t||(this.decoderConfig.wasmBinary=i[1]);const n=qu.toString(),r=["/* draco decoder */",s,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(n){const r=n.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,n){return s._taskLoad>n._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function qu(){let a,t;onmessage=function(r){const o=r.data;switch(o.type){case"init":a=o.decoderConfig,t=new Promise(function(c){a.onModuleLoaded=function(h){c({draco:h})},DracoDecoderModule(a)});break;case"decode":const A=o.buffer,l=o.taskConfig;t.then(c=>{const h=c.draco,d=new h.Decoder;try{const u=e(h,d,new Int8Array(A),l),g=u.attributes.map(m=>m.array.buffer);u.index&&g.push(u.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:u},g)}catch(u){console.error(u),self.postMessage({type:"error",id:o.id,error:u.message})}finally{h.destroy(d)}});break}};function e(r,o,A,l){const c=l.attributeIDs,h=l.attributeTypes;let d,u;const g=o.GetEncodedGeometryType(A);if(g===r.TRIANGULAR_MESH)d=new r.Mesh,u=o.DecodeArrayToMesh(A,A.byteLength,d);else if(g===r.POINT_CLOUD)d=new r.PointCloud,u=o.DecodeArrayToPointCloud(A,A.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!u.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+u.error_msg());const m={index:null,attributes:[]};for(const p in c){const f=self[h[p]];let I,C;if(l.useUniqueIDs)C=c[p],I=o.GetAttributeByUniqueId(d,C);else{if(C=o.GetAttributeId(d,r[c[p]]),C===-1)continue;I=o.GetAttribute(d,C)}const E=s(r,o,d,p,f,I);p==="color"&&(E.vertexColorSpace=l.vertexColorSpace),m.attributes.push(E)}return g===r.TRIANGULAR_MESH&&(m.index=i(r,o,d)),r.destroy(d),m}function i(r,o,A){const l=A.num_faces()*3,c=l*4,h=r._malloc(c);o.GetTrianglesUInt32Array(A,c,h);const d=new Uint32Array(r.HEAPF32.buffer,h,l).slice();return r._free(h),{array:d,itemSize:1}}function s(r,o,A,l,c,h){const d=h.num_components(),u=A.num_points()*d,g=u*c.BYTES_PER_ELEMENT,m=n(r,c),p=r._malloc(g);o.GetAttributeDataArrayForAllPoints(A,h,m,g,p);const f=new c(r.HEAPF32.buffer,p,u).slice();return r._free(p),{name:l,array:f,itemSize:d}}function n(r,o){switch(o){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}function wo(a,t){if(t===Pc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(t===Qn||t===Na){let e=a.getIndex();if(e===null){const r=[],o=a.getAttribute("position");if(o!==void 0){for(let A=0;A<o.count;A++)r.push(A);a.setIndex(r),e=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const i=e.count-2,s=[];if(t===Qn)for(let r=1;r<=i;r++)s.push(e.getX(0)),s.push(e.getX(r)),s.push(e.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(s.push(e.getX(r)),s.push(e.getX(r+1)),s.push(e.getX(r+2))):(s.push(e.getX(r+2)),s.push(e.getX(r+1)),s.push(e.getX(r)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const n=a.clone();return n.setIndex(s),n.clearGroups(),n}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),a}class Vu extends gn{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new zu(e)}),this.register(function(e){return new id(e)}),this.register(function(e){return new sd(e)}),this.register(function(e){return new nd(e)}),this.register(function(e){return new Wu(e)}),this.register(function(e){return new Xu(e)}),this.register(function(e){return new Zu(e)}),this.register(function(e){return new td(e)}),this.register(function(e){return new Yu(e)}),this.register(function(e){return new ed(e)}),this.register(function(e){return new ju(e)}),this.register(function(e){return new Ju(e)}),this.register(function(e){return new rd(e)}),this.register(function(e){return new ad(e)})}load(t,e,i,s){const n=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=fn.extractUrlBase(t),this.manager.itemStart(t);const o=function(l){s?s(l):console.error(l),n.manager.itemError(t),n.manager.itemEnd(t)},A=new he(this.manager);A.setPath(this.path),A.setResponseType("arraybuffer"),A.setRequestHeader(this.requestHeader),A.setWithCredentials(this.withCredentials),A.load(t,function(l){try{n.parse(l,r,function(c){e(c),n.manager.itemEnd(t)},o)}catch(c){o(c)}},i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let n;const r={},o={},A=new TextDecoder;if(typeof t=="string")n=JSON.parse(t);else if(t instanceof ArrayBuffer)if(A.decode(new Uint8Array(t,0,4))===Qo){try{r[N.KHR_BINARY_GLTF]=new od(t)}catch(c){s&&s(c);return}n=JSON.parse(r[N.KHR_BINARY_GLTF].content)}else n=JSON.parse(A.decode(t));else n=t;if(n.asset===void 0||n.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Ed(n,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](l);o[h.name]=h,r[h.name]=!0}if(n.extensionsUsed)for(let c=0;c<n.extensionsUsed.length;++c){const h=n.extensionsUsed[c],d=n.extensionsRequired||[];switch(h){case N.KHR_MATERIALS_UNLIT:r[h]=new Ku;break;case N.KHR_DRACO_MESH_COMPRESSION:r[h]=new Ad(n,this.dracoLoader);break;case N.KHR_TEXTURE_TRANSFORM:r[h]=new ld;break;case N.KHR_MESH_QUANTIZATION:r[h]=new hd;break;default:d.indexOf(h)>=0&&o[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,n){i.parse(t,e,s,n)})}}function $u(){let a={};return{get:function(t){return a[t]},add:function(t,e){a[t]=e},remove:function(t){delete a[t]},removeAll:function(){a={}}}}const N={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ju{constructor(t){this.parser=t,this.name=N.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let s=e.cache.get(i);if(s)return s;const n=e.json,r=((n.extensions&&n.extensions[this.name]||{}).lights||[])[t];let o;const A=new yt(16777215);r.color!==void 0&&A.fromArray(r.color);const l=r.range!==void 0?r.range:0;switch(r.type){case"directional":o=new Ta(A),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new In(A),o.distance=l;break;case"spot":o=new Ic(A),o.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,jt(o,r),r.intensity!==void 0&&(o.intensity=r.intensity),o.name=e.createUniqueName(r.name||"light_"+t),s=Promise.resolve(o),e.cache.add(i,s),s}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,s=i.json.nodes[t],n=(s.extensions&&s.extensions[this.name]||{}).light;return n===void 0?null:this._loadLight(n).then(function(r){return i._getNodeRef(e.cache,n,r)})}}class Ku{constructor(){this.name=N.KHR_MATERIALS_UNLIT}getMaterialType(){return kt}extendParams(t,e,i){const s=[];t.color=new yt(1,1,1),t.opacity=1;const n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const r=n.baseColorFactor;t.color.fromArray(r),t.opacity=r[3]}n.baseColorTexture!==void 0&&s.push(i.assignTexture(t,"map",n.baseColorTexture,gt))}return Promise.all(s)}}class Yu{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}}class zu{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(e.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&n.push(i.assignTexture(e,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&n.push(i.assignTexture(e,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(n.push(i.assignTexture(e,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const o=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new wt(o,o)}return Promise.all(n)}}class ju{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(e.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&n.push(i.assignTexture(e,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(e.iridescenceIOR=r.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&n.push(i.assignTexture(e,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}}class Wu{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[];e.sheenColor=new yt(0,0,0),e.sheenRoughness=0,e.sheen=1;const r=s.extensions[this.name];return r.sheenColorFactor!==void 0&&e.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&n.push(i.assignTexture(e,"sheenColorMap",r.sheenColorTexture,gt)),r.sheenRoughnessTexture!==void 0&&n.push(i.assignTexture(e,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(n)}}class Xu{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(e.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&n.push(i.assignTexture(e,"transmissionMap",r.transmissionTexture)),Promise.all(n)}}class Zu{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];e.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&n.push(i.assignTexture(e,"thicknessMap",r.thicknessTexture)),e.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return e.attenuationColor=new yt(o[0],o[1],o[2]),Promise.all(n)}}class td{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class ed{constructor(t){this.parser=t,this.name=N.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],r=s.extensions[this.name];e.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&n.push(i.assignTexture(e,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return e.specularColor=new yt(o[0],o[1],o[2]),r.specularColorTexture!==void 0&&n.push(i.assignTexture(e,"specularColorMap",r.specularColorTexture,gt)),Promise.all(n)}}class id{constructor(t){this.parser=t,this.name=N.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],r=e.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,n.source,r)}}class sd{constructor(t){this.parser=t,this.name=N.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const r=n.extensions[e],o=s.images[r.source];let A=i.textureLoader;if(o.uri){const l=i.options.manager.getHandler(o.uri);l!==null&&(A=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(t,r.source,A);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class nd{constructor(t){this.parser=t,this.name=N.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const r=n.extensions[e],o=s.images[r.source];let A=i.textureLoader;if(o.uri){const l=i.options.manager.getHandler(o.uri);l!==null&&(A=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(t,r.source,A);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class rd{constructor(t){this.name=N.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],n=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(o){const A=s.byteOffset||0,l=s.byteLength||0,c=s.count,h=s.byteStride,d=new Uint8Array(o,A,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(c,h,d,s.mode,s.filter).then(function(u){return u.buffer}):r.ready.then(function(){const u=new ArrayBuffer(c*h);return r.decodeGltfBuffer(new Uint8Array(u),c,h,d,s.mode,s.filter),u})})}else return null}}class ad{constructor(t){this.name=N.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const A of s.primitives)if(A.mode!==ft.TRIANGLES&&A.mode!==ft.TRIANGLE_STRIP&&A.mode!==ft.TRIANGLE_FAN&&A.mode!==void 0)return null;const n=i.extensions[this.name].attributes,r=[],o={};for(const A in n)r.push(this.parser.getDependency("accessor",n[A]).then(l=>(o[A]=l,o[A])));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then(A=>{const l=A.pop(),c=l.isGroup?l.children:[l],h=A[0].count,d=[];for(const u of c){const g=new Ft,m=new R,p=new un,f=new R(1,1,1),I=new Cc(u.geometry,u.material,h);for(let C=0;C<h;C++)o.TRANSLATION&&m.fromBufferAttribute(o.TRANSLATION,C),o.ROTATION&&p.fromBufferAttribute(o.ROTATION,C),o.SCALE&&f.fromBufferAttribute(o.SCALE,C),I.setMatrixAt(C,g.compose(m,p,f));for(const C in o)C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&u.geometry.setAttribute(C,o[C]);ui.prototype.copy.call(I,u),this.parser.assignFinalMaterial(I),d.push(I)}return l.isGroup?(l.clear(),l.add(...d),l):d[0]}))}}const Qo="glTF",Ei=12,vo={JSON:1313821514,BIN:5130562};class od{constructor(t){this.name=N.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,Ei),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Qo)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Ei,n=new DataView(t,Ei);let r=0;for(;r<s;){const o=n.getUint32(r,!0);r+=4;const A=n.getUint32(r,!0);if(r+=4,A===vo.JSON){const l=new Uint8Array(t,Ei+r,o);this.content=i.decode(l)}else if(A===vo.BIN){const l=Ei+r;this.body=t.slice(l,l+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ad{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=N.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,n=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,o={},A={},l={};for(const c in r){const h=qn[c]||c.toLowerCase();o[h]=r[c]}for(const c in t.attributes){const h=qn[c]||c.toLowerCase();if(r[c]!==void 0){const d=i.accessors[t.attributes[c]],u=Pe[d.componentType];l[h]=u.name,A[h]=d.normalized===!0}}return e.getDependency("bufferView",n).then(function(c){return new Promise(function(h){s.decodeDracoFile(c,function(d){for(const u in d.attributes){const g=d.attributes[u],m=A[u];m!==void 0&&(g.normalized=m)}h(d)},o,l)})})}}class ld{constructor(){this.name=N.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class hd{constructor(){this.name=N.KHR_MESH_QUANTIZATION}}class bo extends Kc{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=t*s*3+s;for(let r=0;r!==s;r++)e[r]=i[n+r];return e}interpolate_(t,e,i,s){const n=this.resultBuffer,r=this.sampleValues,o=this.valueSize,A=o*2,l=o*3,c=s-e,h=(i-e)/c,d=h*h,u=d*h,g=t*l,m=g-l,p=-2*u+3*d,f=u-d,I=1-p,C=f-d+h;for(let E=0;E!==o;E++){const B=r[m+E+o],y=r[m+E+A]*c,w=r[g+E+o],v=r[g+E]*c;n[E]=I*B+C*y+p*w+f*v}return n}}const cd=new un;class ud extends bo{interpolate_(t,e,i,s){const n=super.interpolate_(t,e,i,s);return cd.fromArray(n).normalize().toArray(n),n}}const ft={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Pe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xo={9728:Ga,9729:ce,9984:Pa,9985:Oa,9986:Ha,9987:es},So={33071:qa,33648:Va,10497:De},Hn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},zt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},dd={CUBICSPLINE:void 0,LINEAR:Cn,STEP:$a},Vn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function gd(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Re({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Bn})),a.DefaultMaterial}function Bi(a,t,e){for(const i in e.extensions)a[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function jt(a,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(a.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function pd(a,t,e){let i=!1,s=!1,n=!1;for(let l=0,c=t.length;l<c;l++){const h=t[l];if(h.POSITION!==void 0&&(i=!0),h.NORMAL!==void 0&&(s=!0),h.COLOR_0!==void 0&&(n=!0),i&&s&&n)break}if(!i&&!s&&!n)return Promise.resolve(a);const r=[],o=[],A=[];for(let l=0,c=t.length;l<c;l++){const h=t[l];if(i){const d=h.POSITION!==void 0?e.getDependency("accessor",h.POSITION):a.attributes.position;r.push(d)}if(s){const d=h.NORMAL!==void 0?e.getDependency("accessor",h.NORMAL):a.attributes.normal;o.push(d)}if(n){const d=h.COLOR_0!==void 0?e.getDependency("accessor",h.COLOR_0):a.attributes.color;A.push(d)}}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(A)]).then(function(l){const c=l[0],h=l[1],d=l[2];return i&&(a.morphAttributes.position=c),s&&(a.morphAttributes.normal=h),n&&(a.morphAttributes.color=d),a.morphTargetsRelative=!0,a})}function md(a,t){if(a.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)a.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(a.morphTargetInfluences.length===e.length){a.morphTargetDictionary={};for(let i=0,s=e.length;i<s;i++)a.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function fd(a){const t=a.extensions&&a.extensions[N.KHR_DRACO_MESH_COMPRESSION];let e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+Mo(t.attributes):e=a.indices+":"+Mo(a.attributes)+":"+a.mode,e}function Mo(a){let t="";const e=Object.keys(a).sort();for(let i=0,s=e.length;i<s;i++)t+=e[i]+":"+a[e[i]]+";";return t}function $n(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Id(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Cd=new Ft;class Ed{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new $u,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,n=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,n=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&n<98?this.textureLoader=new Da(this.options.manager):this.textureLoader=new Ec(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new he(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const o={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:i,userData:{}};Bi(n,o,s),jt(o,s),Promise.all(i._invokeAll(function(A){return A.afterRoot&&A.afterRoot(o)})).then(function(){t(o)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,n=e.length;s<n;s++){const r=e[s].joints;for(let o=0,A=r.length;o<A;o++)t[r[o]].isBone=!0}for(let s=0,n=t.length;s<n;s++){const r=t[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),n=(r,o)=>{const A=this.associations.get(r);A!=null&&this.associations.set(o,A);for(const[l,c]of r.children.entries())n(c,o.children[l])};return n(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const n=t(e[s]);n&&i.push(n)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(n){return n.loadNode&&n.loadNode(e)});break;case"mesh":s=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(n,r){return i.getDependency(t,r)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[N.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(n,r){i.load(fn.resolveURL(e.uri,s.path),n,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,n=e.byteOffset||0;return i.slice(n,n+s)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const r=Hn[s.type],o=Pe[s.componentType],A=s.normalized===!0,l=new o(s.count*r);return Promise.resolve(new _t(l,r,A))}const n=[];return s.bufferView!==void 0?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),s.sparse!==void 0&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then(function(r){const o=r[0],A=Hn[s.type],l=Pe[s.componentType],c=l.BYTES_PER_ELEMENT,h=c*A,d=s.byteOffset||0,u=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let m,p;if(u&&u!==h){const f=Math.floor(d/u),I="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+f+":"+s.count;let C=e.cache.get(I);C||(m=new l(o,f*u,s.count*u/c),C=new Bc(m,u/c),e.cache.add(I,C)),p=new yc(C,A,d%u/c,g)}else o===null?m=new l(s.count*A):m=new l(o,d,s.count*A),p=new _t(m,A,g);if(s.sparse!==void 0){const f=Hn.SCALAR,I=Pe[s.sparse.indices.componentType],C=s.sparse.indices.byteOffset||0,E=s.sparse.values.byteOffset||0,B=new I(r[1],C,s.sparse.count*f),y=new l(r[2],E,s.sparse.count*A);o!==null&&(p=new _t(p.array.slice(),p.itemSize,p.normalized));for(let w=0,v=B.length;w<v;w++){const x=B[w];if(p.setX(x,y[w*A]),A>=2&&p.setY(x,y[w*A+1]),A>=3&&p.setZ(x,y[w*A+2]),A>=4&&p.setW(x,y[w*A+3]),A>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p})}loadTexture(t){const e=this.json,i=this.options,s=e.textures[t].source,n=e.images[s];let r=this.textureLoader;if(n.uri){const o=i.manager.getHandler(n.uri);o!==null&&(r=o)}return this.loadTextureImage(t,s,r)}loadTextureImage(t,e,i){const s=this,n=this.json,r=n.textures[t],o=n.images[e],A=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[A])return this.textureCache[A];const l=this.loadImageSource(e,i).then(function(c){c.flipY=!1,c.name=r.name||o.name||"",c.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(c.name=o.uri);const h=(n.samplers||{})[r.sampler]||{};return c.magFilter=xo[h.magFilter]||ce,c.minFilter=xo[h.minFilter]||es,c.wrapS=So[h.wrapS]||De,c.wrapT=So[h.wrapT]||De,s.associations.set(c,{textures:t}),c}).catch(function(){return null});return this.textureCache[A]=l,l}loadImageSource(t,e){const i=this,s=this.json,n=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(h=>h.clone());const r=s.images[t],o=self.URL||self.webkitURL;let A=r.uri||"",l=!1;if(r.bufferView!==void 0)A=i.getDependency("bufferView",r.bufferView).then(function(h){l=!0;const d=new Blob([h],{type:r.mimeType});return A=o.createObjectURL(d),A});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(A).then(function(h){return new Promise(function(d,u){let g=d;e.isImageBitmapLoader===!0&&(g=function(m){const p=new hi(m);p.needsUpdate=!0,d(p)}),e.load(fn.resolveURL(h,n.path),g,void 0,u)})}).then(function(h){return l===!0&&o.revokeObjectURL(A),h.userData.mimeType=r.mimeType||Id(r.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",A),h});return this.sourceCache[t]=c,c}assignTexture(t,e,i,s){const n=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(r=r.clone(),r.channel=i.texCoord),n.extensions[N.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[N.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const A=n.associations.get(r);r=n.extensions[N.KHR_TEXTURE_TRANSFORM].extendTexture(r,o),n.associations.set(r,A)}}return s!==void 0&&(r.colorSpace=s),t[e]=r,r})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=e.attributes.tangent===void 0,n=e.attributes.color!==void 0,r=e.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+i.uuid;let A=this.cache.get(o);A||(A=new wc,is.prototype.copy.call(A,i),A.color.copy(i.color),A.map=i.map,A.sizeAttenuation=!1,this.cache.add(o,A)),i=A}else if(t.isLine){const o="LineBasicMaterial:"+i.uuid;let A=this.cache.get(o);A||(A=new Qc,is.prototype.copy.call(A,i),A.color.copy(i.color),A.map=i.map,this.cache.add(o,A)),i=A}if(s||n||r){let o="ClonedMaterial:"+i.uuid+":";s&&(o+="derivative-tangents:"),n&&(o+="vertex-colors:"),r&&(o+="flat-shading:");let A=this.cache.get(o);A||(A=i.clone(),n&&(A.vertexColors=!0),r&&(A.flatShading=!0),s&&(A.normalScale&&(A.normalScale.y*=-1),A.clearcoatNormalScale&&(A.clearcoatNormalScale.y*=-1)),this.cache.add(o,A),this.associations.set(A,this.associations.get(i))),i=A}t.material=i}getMaterialType(){return Re}loadMaterial(t){const e=this,i=this.json,s=this.extensions,n=i.materials[t];let r;const o={},A=n.extensions||{},l=[];if(A[N.KHR_MATERIALS_UNLIT]){const h=s[N.KHR_MATERIALS_UNLIT];r=h.getMaterialType(),l.push(h.extendParams(o,n,e))}else{const h=n.pbrMetallicRoughness||{};if(o.color=new yt(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;o.color.fromArray(d),o.opacity=d[3]}h.baseColorTexture!==void 0&&l.push(e.assignTexture(o,"map",h.baseColorTexture,gt)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(l.push(e.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,o)})))}n.doubleSided===!0&&(o.side=Fe);const c=n.alphaMode||Vn.OPAQUE;if(c===Vn.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===Vn.MASK&&(o.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&r!==kt&&(l.push(e.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new wt(1,1),n.normalTexture.scale!==void 0)){const h=n.normalTexture.scale;o.normalScale.set(h,h)}return n.occlusionTexture!==void 0&&r!==kt&&(l.push(e.assignTexture(o,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&r!==kt&&(o.emissive=new yt().fromArray(n.emissiveFactor)),n.emissiveTexture!==void 0&&r!==kt&&l.push(e.assignTexture(o,"emissiveMap",n.emissiveTexture,gt)),Promise.all(l).then(function(){const h=new r(o);return n.name&&(h.name=n.name),jt(h,n),e.associations.set(h,{materials:t}),n.extensions&&Bi(s,h,n),h})}createUniqueName(t){const e=di.sanitizeNodeName(t||"");let i=e;for(let s=1;this.nodeNamesUsed[i];++s)i=e+"_"+s;return this.nodeNamesUsed[i]=!0,i}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function n(o){return i[N.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,e).then(function(A){return Lo(A,o,e)})}const r=[];for(let o=0,A=t.length;o<A;o++){const l=t[o],c=fd(l),h=s[c];if(h)r.push(h.promise);else{let d;l.extensions&&l.extensions[N.KHR_DRACO_MESH_COMPRESSION]?d=n(l):d=Lo(new pn,l,e),s[c]={primitive:l,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(t){const e=this,i=this.json,s=this.extensions,n=i.meshes[t],r=n.primitives,o=[];for(let A=0,l=r.length;A<l;A++){const c=r[A].material===void 0?gd(this.cache):this.getDependency("material",r[A].material);o.push(c)}return o.push(e.loadGeometries(r)),Promise.all(o).then(function(A){const l=A.slice(0,A.length-1),c=A[A.length-1],h=[];for(let u=0,g=c.length;u<g;u++){const m=c[u],p=r[u];let f;const I=l[u];if(p.mode===ft.TRIANGLES||p.mode===ft.TRIANGLE_STRIP||p.mode===ft.TRIANGLE_FAN||p.mode===void 0)f=n.isSkinnedMesh===!0?new vc(m,I):new F(m,I),f.isSkinnedMesh===!0&&f.normalizeSkinWeights(),p.mode===ft.TRIANGLE_STRIP?f.geometry=wo(f.geometry,Na):p.mode===ft.TRIANGLE_FAN&&(f.geometry=wo(f.geometry,Qn));else if(p.mode===ft.LINES)f=new bc(m,I);else if(p.mode===ft.LINE_STRIP)f=new xc(m,I);else if(p.mode===ft.LINE_LOOP)f=new Sc(m,I);else if(p.mode===ft.POINTS)f=new Mc(m,I);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(f.geometry.morphAttributes).length>0&&md(f,n),f.name=e.createUniqueName(n.name||"mesh_"+t),jt(f,n),p.extensions&&Bi(s,f,p),e.assignFinalMaterial(f),h.push(f)}for(let u=0,g=h.length;u<g;u++)e.associations.set(h[u],{meshes:t,primitives:u});if(h.length===1)return h[0];const d=new ss;e.associations.set(d,{meshes:t});for(let u=0,g=h.length;u<g;u++)d.add(h[u]);return d})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new Xi(ns.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new rs(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),jt(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let s=0,n=e.joints.length;s<n;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const n=s.pop(),r=s,o=[],A=[];for(let l=0,c=r.length;l<c;l++){const h=r[l];if(h){o.push(h);const d=new Ft;n!==null&&d.fromArray(n.array,l*16),A.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[l])}return new Lc(o,A)})}loadAnimation(t){const e=this.json.animations[t],i=e.name?e.name:"animation_"+t,s=[],n=[],r=[],o=[],A=[];for(let l=0,c=e.channels.length;l<c;l++){const h=e.channels[l],d=e.samplers[h.sampler],u=h.target,g=u.node,m=e.parameters!==void 0?e.parameters[d.input]:d.input,p=e.parameters!==void 0?e.parameters[d.output]:d.output;u.node!==void 0&&(s.push(this.getDependency("node",g)),n.push(this.getDependency("accessor",m)),r.push(this.getDependency("accessor",p)),o.push(d),A.push(u))}return Promise.all([Promise.all(s),Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(A)]).then(function(l){const c=l[0],h=l[1],d=l[2],u=l[3],g=l[4],m=[];for(let p=0,f=c.length;p<f;p++){const I=c[p],C=h[p],E=d[p],B=u[p],y=g[p];if(I===void 0)continue;I.updateMatrix();let w;switch(zt[y.path]){case zt.weights:w=Hc;break;case zt.rotation:w=Ja;break;case zt.position:case zt.scale:default:w=Oc;break}const v=I.name?I.name:I.uuid,x=B.interpolation!==void 0?dd[B.interpolation]:Cn,S=[];zt[y.path]===zt.weights?I.traverse(function(M){M.morphTargetInfluences&&S.push(M.name?M.name:M.uuid)}):S.push(v);let _=E.array;if(E.normalized){const M=$n(_.constructor),V=new Float32Array(_.length);for(let L=0,H=_.length;L<H;L++)V[L]=_[L]*M;_=V}for(let M=0,V=S.length;M<V;M++){const L=new w(S[M]+"."+zt[y.path],C.array,_,x);B.interpolation==="CUBICSPLINE"&&(L.createInterpolant=function(H){const G=this instanceof Ja?ud:bo;return new G(this.times,this.values,this.getValueSize()/3,H)},L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(L)}}return new Tc(i,void 0,m)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(n){const r=i._getNodeRef(i.meshCache,s.mesh,n);return s.weights!==void 0&&r.traverse(function(o){if(o.isMesh)for(let A=0,l=s.weights.length;A<l;A++)o.morphTargetInfluences[A]=s.weights[A]}),r})}loadNode(t){const e=this.json,i=this,s=e.nodes[t],n=i._loadNodeShallow(t),r=[],o=s.children||[];for(let l=0,c=o.length;l<c;l++)r.push(i.getDependency("node",o[l]));const A=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([n,Promise.all(r),A]).then(function(l){const c=l[0],h=l[1],d=l[2];d!==null&&c.traverse(function(u){!u.isSkinnedMesh||u.bind(d,Cd)});for(let u=0,g=h.length;u<g;u++)c.add(h[u]);return c})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const n=e.nodes[t],r=n.name?s.createUniqueName(n.name):"",o=[],A=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return A&&o.push(A),n.camera!==void 0&&o.push(s.getDependency("camera",n.camera).then(function(l){return s._getNodeRef(s.cameraCache,n.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){o.push(l)}),this.nodeCache[t]=Promise.all(o).then(function(l){let c;if(n.isBone===!0?c=new Dc:l.length>1?c=new ss:l.length===1?c=l[0]:c=new ui,c!==l[0])for(let h=0,d=l.length;h<d;h++)c.add(l[h]);if(n.name&&(c.userData.name=n.name,c.name=r),jt(c,n),n.extensions&&Bi(i,c,n),n.matrix!==void 0){const h=new Ft;h.fromArray(n.matrix),c.applyMatrix4(h)}else n.translation!==void 0&&c.position.fromArray(n.translation),n.rotation!==void 0&&c.quaternion.fromArray(n.rotation),n.scale!==void 0&&c.scale.fromArray(n.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=t,c}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,n=new ss;i.name&&(n.name=s.createUniqueName(i.name)),jt(n,i),i.extensions&&Bi(e,n,i);const r=i.nodes||[],o=[];for(let A=0,l=r.length;A<l;A++)o.push(s.getDependency("node",r[A]));return Promise.all(o).then(function(A){for(let c=0,h=A.length;c<h;c++)n.add(A[c]);const l=c=>{const h=new Map;for(const[d,u]of s.associations)(d instanceof is||d instanceof hi)&&h.set(d,u);return c.traverse(d=>{const u=s.associations.get(d);u!=null&&h.set(d,u)}),h};return s.associations=l(n),n})}}function Bd(a,t,e){const i=t.attributes,s=new ge;if(i.POSITION!==void 0){const o=e.json.accessors[i.POSITION],A=o.min,l=o.max;if(A!==void 0&&l!==void 0){if(s.set(new R(A[0],A[1],A[2]),new R(l[0],l[1],l[2])),o.normalized){const c=$n(Pe[o.componentType]);s.min.multiplyScalar(c),s.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const n=t.targets;if(n!==void 0){const o=new R,A=new R;for(let l=0,c=n.length;l<c;l++){const h=n[l];if(h.POSITION!==void 0){const d=e.json.accessors[h.POSITION],u=d.min,g=d.max;if(u!==void 0&&g!==void 0){if(A.setX(Math.max(Math.abs(u[0]),Math.abs(g[0]))),A.setY(Math.max(Math.abs(u[1]),Math.abs(g[1]))),A.setZ(Math.max(Math.abs(u[2]),Math.abs(g[2]))),d.normalized){const m=$n(Pe[d.componentType]);A.multiplyScalar(m)}o.max(A)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(o)}a.boundingBox=s;const r=new En;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,a.boundingSphere=r}function Lo(a,t,e){const i=t.attributes,s=[];function n(r,o){return e.getDependency("accessor",r).then(function(A){a.setAttribute(o,A)})}for(const r in i){const o=qn[r]||r.toLowerCase();o in a.attributes||s.push(n(i[r],o))}if(t.indices!==void 0&&!a.index){const r=e.getDependency("accessor",t.indices).then(function(o){a.setIndex(o)});s.push(r)}return jt(a,t),Bd(a,t,e),Promise.all(s).then(function(){return t.targets!==void 0?pd(a,t.targets,e):a})}class yd{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const i=this.workersResolve[t];if(i&&i(e),this.queue.length){const{resolve:s,msg:n,transfer:r}=this.queue.shift();this.workersResolve[t]=s,this.workers[t].postMessage(n,r)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(t,e)):this.queue.push({resolve:i,msg:t,transfer:e})})}dispose(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const wd=0,Qd=2,vd=1,bd=2,xd=0,To=9,Jn=15,Do=16,Kn=22,Ro=37,Yn=43,Fo=76,ko=83,_o=97,Uo=100,No=103,Go=109;class Sd{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class yi{constructor(t,e,i,s){this._dataView=new DataView(t.buffer,t.byteOffset+e,i),this._littleEndian=s,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==e&&s<t;)s++,this._offset++;return s<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const at=[171,75,84,88,32,50,48,187,13,10,26,10];function Po(a){return typeof TextDecoder<"u"?new TextDecoder().decode(a):Buffer.from(a).toString("utf8")}function Md(a){const t=new Uint8Array(a.buffer,a.byteOffset,at.length);if(t[0]!==at[0]||t[1]!==at[1]||t[2]!==at[2]||t[3]!==at[3]||t[4]!==at[4]||t[5]!==at[5]||t[6]!==at[6]||t[7]!==at[7]||t[8]!==at[8]||t[9]!==at[9]||t[10]!==at[10]||t[11]!==at[11])throw new Error("Missing KTX 2.0 identifier.");const e=new Sd,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new yi(a,at.length,i,!0);e.vkFormat=s._nextUint32(),e.typeSize=s._nextUint32(),e.pixelWidth=s._nextUint32(),e.pixelHeight=s._nextUint32(),e.pixelDepth=s._nextUint32(),e.layerCount=s._nextUint32(),e.faceCount=s._nextUint32();const n=s._nextUint32();e.supercompressionScheme=s._nextUint32();const r=s._nextUint32(),o=s._nextUint32(),A=s._nextUint32(),l=s._nextUint32(),c=s._nextUint64(),h=s._nextUint64(),d=new yi(a,at.length+i,3*n*8,!0);for(let D=0;D<n;D++)e.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const u=new yi(a,r,o,!0),g={vendorId:u._skip(4)._nextUint16(),descriptorType:u._nextUint16(),versionNumber:u._nextUint16(),descriptorBlockSize:u._nextUint16(),colorModel:u._nextUint8(),colorPrimaries:u._nextUint8(),transferFunction:u._nextUint8(),flags:u._nextUint8(),texelBlockDimension:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],bytesPlane:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],samples:[]},m=(g.descriptorBlockSize/4-6)/4;for(let D=0;D<m;D++){const U={bitOffset:u._nextUint16(),bitLength:u._nextUint8(),channelType:u._nextUint8(),samplePosition:[u._nextUint8(),u._nextUint8(),u._nextUint8(),u._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&U.channelType?(U.sampleLower=u._nextInt32(),U.sampleUpper=u._nextInt32()):(U.sampleLower=u._nextUint32(),U.sampleUpper=u._nextUint32()),g.samples[D]=U}e.dataFormatDescriptor.length=0,e.dataFormatDescriptor.push(g);const p=new yi(a,A,l,!0);for(;p._offset<l;){const D=p._nextUint32(),U=p._scan(D),z=Po(U),it=p._scan(D-U.byteLength);e.keyValue[z]=z.match(/^ktx/i)?Po(it):it,p._offset%4&&p._skip(4-p._offset%4)}if(h<=0)return e;const f=new yi(a,c,h,!0),I=f._nextUint16(),C=f._nextUint16(),E=f._nextUint32(),B=f._nextUint32(),y=f._nextUint32(),w=f._nextUint32(),v=[];for(let D=0;D<n;D++)v.push({imageFlags:f._nextUint32(),rgbSliceByteOffset:f._nextUint32(),rgbSliceByteLength:f._nextUint32(),alphaSliceByteOffset:f._nextUint32(),alphaSliceByteLength:f._nextUint32()});const x=c+f._offset,S=x+E,_=S+B,M=_+y,V=new Uint8Array(a.buffer,a.byteOffset+x,E),L=new Uint8Array(a.buffer,a.byteOffset+S,B),H=new Uint8Array(a.buffer,a.byteOffset+_,y),G=new Uint8Array(a.buffer,a.byteOffset+M,w);return e.globalData={endpointCount:I,selectorCount:C,imageDescs:v,endpointsData:V,selectorsData:L,tablesData:H,extendedData:G},e}let zn,Ut,jn;const Wn={env:{emscripten_notify_memory_growth:function(a){jn=new Uint8Array(Ut.exports.memory.buffer)}}};class Ld{init(){return zn||(zn=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Oo).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,Wn)).then(this._init):WebAssembly.instantiate(Buffer.from(Oo,"base64"),Wn).then(this._init),zn)}_init(t){Ut=t.instance,Wn.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!Ut)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=t.byteLength,s=Ut.exports.malloc(i);jn.set(t,s),e=e||Number(Ut.exports.ZSTD_findDecompressedSize(s,i));const n=Ut.exports.malloc(e),r=Ut.exports.ZSTD_decompress(n,e,s,i),o=jn.slice(n,n+r);return Ut.exports.free(s),Ut.exports.free(n),o}}const Oo="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",Xn=new WeakMap;let Zn=0,tr;class Rt extends gn{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new yd,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return t.isWebGPURenderer===!0?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const t=new he(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),i=new he(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,s]).then(([n,r])=>{const o=Rt.BasisWorker.toString(),A=["/* constants */","let _EngineFormat = "+JSON.stringify(Rt.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Rt.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Rt.BasisFormat),"/* basis_transcoder.js */",n,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([A])),this.transcoderBinary=r,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),c=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:c},[c]),l})}),Zn>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Zn++}return this.transcoderPending}load(t,e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const n=new he(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(t,r=>{if(Xn.has(r))return Xn.get(r).promise.then(e).catch(s);this._createTexture(r).then(o=>e?e(o):null).catch(s)},i,s)}_createTextureFrom(t,e){const{mipmaps:i,width:s,height:n,format:r,type:o,error:A,dfdTransferFn:l,dfdFlags:c}=t;if(o==="error")return Promise.reject(A);const h=e.layerCount>1?new pc(i,s,n,e.layerCount,r,Jt):new mc(i,s,n,r,Jt);return h.minFilter=i.length===1?ce:es,h.magFilter=ce,h.generateMipmaps=!1,h.needsUpdate=!0,h.colorSpace=l===bd?gt:mn,h.premultiplyAlpha=!!(c&vd),h}_createTexture(t){return b(this,arguments,function*(e,i={}){const s=Md(new Uint8Array(e));if(s.vkFormat!==xd)return Dd(s);const n=i,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:n},[e])).then(o=>this._createTextureFrom(o.data,s));return Xn.set(e,{promise:r}),r})}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Zn--,this}}Rt.BasisFormat={ETC1S:0,UASTC_4x4:1},Rt.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Rt.EngineFormat={RGBAFormat:$t,RGBA_ASTC_4x4_Format:rc,RGBA_BPTC_Format:ac,RGBA_ETC2_EAC_Format:oc,RGBA_PVRTC_4BPPV1_Format:Ac,RGBA_S3TC_DXT5_Format:lc,RGB_ETC1_Format:hc,RGB_ETC2_Format:cc,RGB_PVRTC_4BPPV1_Format:uc,RGB_S3TC_DXT1_Format:dc},Rt.BasisWorker=function(){let a,t,e;const i=_EngineFormat,s=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",function(g){const m=g.data;switch(m.type){case"init":a=m.config,r(m.transcoderBinary);break;case"transcode":t.then(()=>{try{const{width:p,height:f,hasAlpha:I,mipmaps:C,format:E,dfdTransferFn:B,dfdFlags:y}=o(m.buffer),w=[];for(let v=0;v<C.length;++v)w.push(C[v].data.buffer);self.postMessage({type:"transcode",id:m.id,width:p,height:f,hasAlpha:I,mipmaps:C,format:E,dfdTransferFn:B,dfdFlags:y},w)}catch(p){console.error(p),self.postMessage({type:"error",id:m.id,error:p.message})}});break}});function r(g){t=new Promise(m=>{e={wasmBinary:g,onRuntimeInitialized:m},BASIS(e)}).then(()=>{e.initializeBasis(),e.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function o(g){const m=new e.KTX2File(new Uint8Array(g));function p(){m.close(),m.delete()}if(!m.isValid())throw p(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const f=m.isUASTC()?n.UASTC_4x4:n.ETC1S,I=m.getWidth(),C=m.getHeight(),E=m.getLayers()||1,B=m.getLevels(),y=m.getHasAlpha(),w=m.getDFDTransferFunc(),v=m.getDFDFlags(),{transcoderFormat:x,engineFormat:S}=h(f,I,C,y);if(!I||!C||!B)throw p(),new Error("THREE.KTX2Loader:	Invalid texture");if(!m.startTranscoding())throw p(),new Error("THREE.KTX2Loader: .startTranscoding failed");const _=[];for(let M=0;M<B;M++){const V=[];let L,H;for(let G=0;G<E;G++){const D=m.getImageLevelInfo(M,G,0);L=D.origWidth<4?D.origWidth:D.width,H=D.origHeight<4?D.origHeight:D.height;const U=new Uint8Array(m.getImageTranscodedSizeInBytes(M,G,0,x));if(!m.transcodeImage(U,M,G,0,x,0,-1,-1))throw p(),new Error("THREE.KTX2Loader: .transcodeImage failed.");V.push(U)}_.push({data:u(V),width:L,height:H})}return p(),{width:I,height:C,hasAlpha:y,mipmaps:_,format:S,dfdTransferFn:w,dfdFlags:v}}const A=[{if:"astcSupported",basisFormat:[n.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],l=A.sort(function(g,m){return g.priorityETC1S-m.priorityETC1S}),c=A.sort(function(g,m){return g.priorityUASTC-m.priorityUASTC});function h(g,m,p,f){let I,C;const E=g===n.ETC1S?l:c;for(let B=0;B<E.length;B++){const y=E[B];if(!!a[y.if]&&!!y.basisFormat.includes(g)&&!(f&&y.transcoderFormat.length<2)&&!(y.needsPowerOfTwo&&!(d(m)&&d(p))))return I=y.transcoderFormat[f?1:0],C=y.engineFormat[f?1:0],{transcoderFormat:I,engineFormat:C}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),I=s.RGBA32,C=i.RGBAFormat,{transcoderFormat:I,engineFormat:C}}function d(g){return g<=2?!0:(g&g-1)===0&&g!==0}function u(g){let m=0;for(let I=0;I<g.length;I++)m+=g[I].byteLength;const p=new Uint8Array(m);let f=0;for(let I=0;I<g.length;I++){const C=g[I];p.set(C,f),f+=C.byteLength}return p}};const Ho={[Go]:$t,[_o]:$t,[Ro]:$t,[Yn]:$t,[No]:hs,[ko]:hs,[Do]:hs,[Kn]:hs,[Uo]:cs,[Fo]:cs,[Jn]:cs,[To]:cs},er={[Go]:de,[_o]:xt,[Ro]:Jt,[Yn]:Jt,[No]:de,[ko]:xt,[Do]:Jt,[Kn]:Jt,[Uo]:de,[Fo]:xt,[Jn]:Jt,[To]:Jt},Td={[Yn]:gt,[Kn]:gt,[Jn]:gt};function Dd(a){return b(this,null,function*(){const{vkFormat:t,pixelWidth:e,pixelHeight:i,pixelDepth:s}=a;if(Ho[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const n=a.levels[0];let r,o;if(a.supercompressionScheme===wd)r=n.levelData;else if(a.supercompressionScheme===Qd)tr||(tr=new Promise(l=>b(this,null,function*(){const c=new Ld;yield c.init(),l(c)}))),r=(yield tr).decode(n.levelData,n.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");er[t]===de?o=new Float32Array(r.buffer,r.byteOffset,r.byteLength/Float32Array.BYTES_PER_ELEMENT):er[t]===xt?o=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/Uint16Array.BYTES_PER_ELEMENT):o=r;const A=s===0?new Rc(o,e,i):new Fc(o,e,i,s);return A.type=er[t],A.format=Ho[t],A.colorSpace=Td[t]||mn,A.needsUpdate=!0,Promise.resolve(A)})}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var qo,Vo;const Qt=Symbol("retainerCount"),Nt=Symbol("recentlyUsed"),Bs=Symbol("evict"),wi=Symbol("evictionThreshold"),ir=Symbol("cache");class Rd{constructor(t,e=5){this[qo]=new Map,this[Vo]=[],this[ir]=t,this[wi]=e}set evictionThreshold(t){this[wi]=t,this[Bs]()}get evictionThreshold(){return this[wi]}get cache(){return this[ir]}retainerCount(t){return this[Qt].get(t)||0}reset(){this[Qt].clear(),this[Nt]=[]}retain(t){this[Qt].has(t)||this[Qt].set(t,0),this[Qt].set(t,this[Qt].get(t)+1);const e=this[Nt].indexOf(t);e!==-1&&this[Nt].splice(e,1),this[Nt].unshift(t),this[Bs]()}release(t){this[Qt].has(t)&&this[Qt].set(t,Math.max(this[Qt].get(t)-1,0)),this[Bs]()}[(qo=Qt,Vo=Nt,Bs)](){if(!(this[Nt].length<this[wi]))for(let t=this[Nt].length-1;t>=this[wi];--t){const e=this[Nt][t];this[Qt].get(e)===0&&(this[ir].delete(e),this[Nt].splice(t,1))}}}/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Fd=a=>{const t=[],e=new Set;for(const i of a){let s=i,n=0;for(;e.has(s);)s=i+"."+ ++n;e.add(s),t.push(s)}return t},kd=a=>{const t=new Map;for(const e of a.mappings)for(const i of e.variants)t.set(i,{material:null,gltfMaterialIndex:e.material});return t};class _d{constructor(t){this.parser=t,this.name="KHR_materials_variants"}afterRoot(t){const e=this.parser,i=e.json;if(i.extensions===void 0||i.extensions[this.name]===void 0)return null;const s=i.extensions[this.name].variants||[],n=Fd(s.map(r=>r.name));for(const r of t.scenes)r.traverse(o=>{const A=o;if(!A.material)return;const l=e.associations.get(A);if(l==null||l.meshes==null||l.primitives==null)return;const c=i.meshes[l.meshes].primitives[l.primitives].extensions;!c||!c[this.name]||(A.userData.variantMaterials=kd(c[this.name]))});return t.userData.variants=n,Promise.resolve()}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var $o,Jo;hi.DEFAULT_ANISOTROPY=4;const Ud=(a,t,e=()=>{})=>{const i=s=>{const n=s.loaded/s.total;e(Math.max(0,Math.min(1,isFinite(n)?n:1)))};return new Promise((s,n)=>{t.load(a,s,i,n)})},Nd=a=>new Promise((t,e)=>{const i=document.createElement("script");document.body.appendChild(i),i.onload=t,i.onerror=e,i.async=!0,i.src=a}),Gt=new Map,sr=new Map;let Ko;const Yo=new Hu;let zo;const nr=new Rt;let rr,ar;const fe=Symbol("loader"),Wt=Symbol("evictionPolicy"),jo=Symbol("GLTFInstance");class X extends ci{constructor(t){super(),this[Jo]=new Vu().register(e=>new _d(e)),this[jo]=t,this[fe].setDRACOLoader(Yo),this[fe].setKTX2Loader(nr)}static setDRACODecoderLocation(t){Ko=t,Yo.setDecoderPath(t)}static getDRACODecoderLocation(){return Ko}static setKTX2TranscoderLocation(t){zo=t,nr.setTranscoderPath(t)}static getKTX2TranscoderLocation(){return zo}static setMeshoptDecoderLocation(t){rr!==t&&(rr=t,ar=Nd(t).then(()=>MeshoptDecoder.ready).then(()=>MeshoptDecoder))}static getMeshoptDecoderLocation(){return rr}static initializeKTX2Loader(t){nr.detectSupport(t)}static get cache(){return Gt}static clearCache(){Gt.forEach((t,e)=>{this.delete(e)}),this[Wt].reset()}static has(t){return Gt.has(t)}static delete(t){return b(this,null,function*(){if(!this.has(t))return;const e=Gt.get(t);sr.delete(t),Gt.delete(t),(yield e).dispose()})}static hasFinishedLoading(t){return!!sr.get(t)}get[($o=Wt,Jo=fe,Wt)](){return this.constructor[Wt]}preload(t,e,i=()=>{}){return b(this,null,function*(){if(this[fe].setWithCredentials(X.withCredentials),this.dispatchEvent({type:"preload",element:e,src:t}),!Gt.has(t)){ar!=null&&this[fe].setMeshoptDecoder(yield ar);const s=Ud(t,this[fe],o=>{i(o*.8)}),n=this[jo],r=s.then(o=>n.prepare(o)).then(o=>(i(.9),new n(o))).catch(o=>(console.error(o),new n));Gt.set(t,r)}yield Gt.get(t),sr.set(t,!0),i&&i(1)})}load(t,e,i=()=>{}){return b(this,null,function*(){yield this.preload(t,e,i);const s=yield(yield Gt.get(t)).clone();return this[Wt].retain(t),s.dispose=()=>{this[Wt].release(t)},s})}}X[$o]=new Rd(X);class Gd extends ui{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new wt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&e.element.parentNode!==null&&e.element.parentNode.removeChild(e.element)})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const Oe=new R,Wo=new Ft,Xo=new Ft,Zo=new R,tA=new R;class Pd{constructor(t={}){const e=this;let i,s,n,r;const o={objects:new WeakMap},A=t.element!==void 0?t.element:document.createElement("div");A.style.overflow="hidden",this.domElement=A,this.getSize=function(){return{width:i,height:s}},this.render=function(u,g){u.matrixWorldAutoUpdate===!0&&u.updateMatrixWorld(),g.parent===null&&g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),Wo.copy(g.matrixWorldInverse),Xo.multiplyMatrices(g.projectionMatrix,Wo),l(u,u,g),d(u)},this.setSize=function(u,g){i=u,s=g,n=i/2,r=s/2,A.style.width=u+"px",A.style.height=g+"px"};function l(u,g,m){if(u.isCSS2DObject){Oe.setFromMatrixPosition(u.matrixWorld),Oe.applyMatrix4(Xo);const p=u.visible===!0&&Oe.z>=-1&&Oe.z<=1&&u.layers.test(m.layers)===!0;if(u.element.style.display=p===!0?"":"none",p===!0){u.onBeforeRender(e,g,m);const I=u.element;I.style.transform="translate("+-100*u.center.x+"%,"+-100*u.center.y+"%)translate("+(Oe.x*n+n)+"px,"+(-Oe.y*r+r)+"px)",I.parentNode!==A&&A.appendChild(I),u.onAfterRender(e,g,m)}const f={distanceToCameraSquared:c(m,u)};o.objects.set(u,f)}for(let p=0,f=u.children.length;p<f;p++)l(u.children[p],g,m)}function c(u,g){return Zo.setFromMatrixPosition(u.matrixWorld),tA.setFromMatrixPosition(g.matrixWorld),Zo.distanceToSquared(tA)}function h(u){const g=[];return u.traverse(function(m){m.isCSS2DObject&&g.push(m)}),g}function d(u){const g=h(u).sort(function(p,f){if(p.renderOrder!==f.renderOrder)return f.renderOrder-p.renderOrder;const I=o.objects.get(p).distanceToCameraSquared,C=o.objects.get(f).distanceToCameraSquared;return I-C}),m=g.length;for(let p=0,f=g.length;p<f;p++)g[p].element.style.zIndex=m-p}}}function ys(a,t,e){let i=e;const s=new R;return a.updateWorldMatrix(!0,!0),a.traverseVisible(n=>{const{geometry:r}=n;if(r!==void 0){const{position:o}=r.attributes;if(o!==void 0)for(let A=0,l=o.count;A<l;A++)n.isMesh?n.getVertexPosition(A,s):s.fromBufferAttribute(o,A),n.isSkinnedMesh||s.applyMatrix4(n.matrixWorld),i=t(i,s)}}),i}const eA={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class or{constructor(){this.pluginCallbacks=[],this.register(function(t){return new jd(t)}),this.register(function(t){return new Wd(t)}),this.register(function(t){return new tg(t)}),this.register(function(t){return new eg(t)}),this.register(function(t){return new ig(t)}),this.register(function(t){return new sg(t)}),this.register(function(t){return new Xd(t)}),this.register(function(t){return new Zd(t)}),this.register(function(t){return new ng(t)}),this.register(function(t){return new rg(t)})}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){const n=new zd,r=[];for(let o=0,A=this.pluginCallbacks.length;o<A;o++)r.push(this.pluginCallbacks[o](n));n.setPlugins(r),n.write(t,e,s).catch(i)}parseAsync(t,e){const i=this;return new Promise(function(s,n){i.parse(t,s,n,e)})}}const k={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Ar="KHR_mesh_quantization",pt={};pt[Ga]=k.NEAREST,pt[Pa]=k.NEAREST_MIPMAP_NEAREST,pt[Ha]=k.NEAREST_MIPMAP_LINEAR,pt[ce]=k.LINEAR,pt[Oa]=k.LINEAR_MIPMAP_NEAREST,pt[es]=k.LINEAR_MIPMAP_LINEAR,pt[qa]=k.CLAMP_TO_EDGE,pt[De]=k.REPEAT,pt[Va]=k.MIRRORED_REPEAT;const iA={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Od=new yt,sA=12,Hd=1179937895,qd=2,nA=8,Vd=1313821514,$d=5130562;function Qi(a,t){return a.length===t.length&&a.every(function(e,i){return e===t[i]})}function Jd(a){return new TextEncoder().encode(a).buffer}function Kd(a){return Qi(a.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Yd(a,t,e){const i={min:new Array(a.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(a.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=t;s<t+e;s++)for(let n=0;n<a.itemSize;n++){let r;a.itemSize>4?r=a.array[s*a.itemSize+n]:(n===0?r=a.getX(s):n===1?r=a.getY(s):n===2?r=a.getZ(s):n===3&&(r=a.getW(s)),a.normalized===!0&&(r=ns.normalize(r,a.array))),i.min[n]=Math.min(i.min[n],r),i.max[n]=Math.max(i.max[n],r)}return i}function rA(a){return Math.ceil(a/4)*4}function lr(a,t=0){const e=rA(a.byteLength);if(e!==a.byteLength){const i=new Uint8Array(e);if(i.set(new Uint8Array(a)),t!==0)for(let s=a.byteLength;s<e;s++)i[s]=t;return i.buffer}return a}function aA(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function oA(a,t){if(a.toBlob!==void 0)return new Promise(i=>a.toBlob(i,t));let e;return t==="image/jpeg"?e=.92:t==="image/webp"&&(e=.8),a.convertToBlob({type:t,quality:e})}class zd{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(t){this.plugins=t}write(t,e){return b(this,arguments,function*(i,s,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(i),yield Promise.all(this.pending);const r=this,o=r.buffers,A=r.json;n=r.options;const l=r.extensionsUsed,c=r.extensionsRequired,h=new Blob(o,{type:"application/octet-stream"}),d=Object.keys(l),u=Object.keys(c);if(d.length>0&&(A.extensionsUsed=d),u.length>0&&(A.extensionsRequired=u),A.buffers&&A.buffers.length>0&&(A.buffers[0].byteLength=h.size),n.binary===!0){const g=new FileReader;g.readAsArrayBuffer(h),g.onloadend=function(){const m=lr(g.result),p=new DataView(new ArrayBuffer(nA));p.setUint32(0,m.byteLength,!0),p.setUint32(4,$d,!0);const f=lr(Jd(JSON.stringify(A)),32),I=new DataView(new ArrayBuffer(nA));I.setUint32(0,f.byteLength,!0),I.setUint32(4,Vd,!0);const C=new ArrayBuffer(sA),E=new DataView(C);E.setUint32(0,Hd,!0),E.setUint32(4,qd,!0);const B=sA+I.byteLength+f.byteLength+p.byteLength+m.byteLength;E.setUint32(8,B,!0);const y=new Blob([C,I,f,p,m],{type:"application/octet-stream"}),w=new FileReader;w.readAsArrayBuffer(y),w.onloadend=function(){s(w.result)}}}else if(A.buffers&&A.buffers.length>0){const g=new FileReader;g.readAsDataURL(h),g.onloadend=function(){const m=g.result;A.buffers[0].uri=m,s(A)}}else s(A)})}serializeUserData(t,e){if(Object.keys(t.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const n=JSON.parse(JSON.stringify(t.userData));if(i.includeCustomExtensions&&n.gltfExtensions){e.extensions===void 0&&(e.extensions={});for(const r in n.gltfExtensions)e.extensions[r]=n.gltfExtensions[r],s[r]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(e.extras=n)}catch(n){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+n.message)}}getUID(t,e=!1){if(this.uids.has(t)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(t,i)}return this.uids.get(t).get(e)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const e=new R;for(let i=0,s=t.count;i<s;i++)if(Math.abs(e.fromBufferAttribute(t,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const e=this.cache;if(e.attributesNormalized.has(t))return e.attributesNormalized.get(t);const i=t.clone(),s=new R;for(let n=0,r=i.count;n<r;n++)s.fromBufferAttribute(i,n),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(n,s.x,s.y,s.z);return e.attributesNormalized.set(t,i),i}applyTextureTransform(t,e){let i=!1;const s={};(e.offset.x!==0||e.offset.y!==0)&&(s.offset=e.offset.toArray(),i=!0),e.rotation!==0&&(s.rotation=e.rotation,i=!0),(e.repeat.x!==1||e.repeat.y!==1)&&(s.scale=e.repeat.toArray(),i=!0),i&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(t,e){if(t===e)return t;function i(d){return d.colorSpace===gt?function(u){return u<.04045?u*.0773993808:Math.pow(u*.9478672986+.0521327014,2.4)}:function(u){return u}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=t?t.image:null,n=e?e.image:null,r=Math.max(s?s.width:0,n?n.width:0),o=Math.max(s?s.height:0,n?n.height:0),A=aA();A.width=r,A.height=o;const l=A.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,r,o);const c=l.getImageData(0,0,r,o);if(s){l.drawImage(s,0,0,r,o);const d=i(t),u=l.getImageData(0,0,r,o).data;for(let g=2;g<u.length;g+=4)c.data[g]=d(u[g]/256)*256}if(n){l.drawImage(n,0,0,r,o);const d=i(e),u=l.getImageData(0,0,r,o).data;for(let g=1;g<u.length;g+=4)c.data[g]=d(u[g]/256)*256}l.putImageData(c,0,0);const h=(t||e).clone();return h.source=new Yc(A),h.colorSpace=mn,h.channel=(t||e).channel,t&&e&&t.channel!==e.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),h}processBuffer(t){const e=this.json,i=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),i.push(t),0}processBufferView(t,e,i,s,n){const r=this.json;r.bufferViews||(r.bufferViews=[]);let o;switch(e){case k.BYTE:case k.UNSIGNED_BYTE:o=1;break;case k.SHORT:case k.UNSIGNED_SHORT:o=2;break;default:o=4}const A=rA(s*t.itemSize*o),l=new DataView(new ArrayBuffer(A));let c=0;for(let d=i;d<i+s;d++)for(let u=0;u<t.itemSize;u++){let g;t.itemSize>4?g=t.array[d*t.itemSize+u]:(u===0?g=t.getX(d):u===1?g=t.getY(d):u===2?g=t.getZ(d):u===3&&(g=t.getW(d)),t.normalized===!0&&(g=ns.normalize(g,t.array))),e===k.FLOAT?l.setFloat32(c,g,!0):e===k.INT?l.setInt32(c,g,!0):e===k.UNSIGNED_INT?l.setUint32(c,g,!0):e===k.SHORT?l.setInt16(c,g,!0):e===k.UNSIGNED_SHORT?l.setUint16(c,g,!0):e===k.BYTE?l.setInt8(c,g):e===k.UNSIGNED_BYTE&&l.setUint8(c,g),c+=o}const h={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:A};return n!==void 0&&(h.target=n),n===k.ARRAY_BUFFER&&(h.byteStride=t.itemSize*o),this.byteOffset+=A,r.bufferViews.push(h),{id:r.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const e=this,i=e.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const n=new FileReader;n.readAsArrayBuffer(t),n.onloadend=function(){const r=lr(n.result),o={buffer:e.processBuffer(r),byteOffset:e.byteOffset,byteLength:r.byteLength};e.byteOffset+=r.byteLength,s(i.bufferViews.push(o)-1)}})}processAccessor(t,e,i,s){const n=this.json,r={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let o;if(t.array.constructor===Float32Array)o=k.FLOAT;else if(t.array.constructor===Int32Array)o=k.INT;else if(t.array.constructor===Uint32Array)o=k.UNSIGNED_INT;else if(t.array.constructor===Int16Array)o=k.SHORT;else if(t.array.constructor===Uint16Array)o=k.UNSIGNED_SHORT;else if(t.array.constructor===Int8Array)o=k.BYTE;else if(t.array.constructor===Uint8Array)o=k.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(i===void 0&&(i=0),s===void 0&&(s=t.count),s===0)return null;const A=Yd(t,i,s);let l;e!==void 0&&(l=t===e.index?k.ELEMENT_ARRAY_BUFFER:k.ARRAY_BUFFER);const c=this.processBufferView(t,o,i,s,l),h={bufferView:c.id,byteOffset:c.byteOffset,componentType:o,count:s,max:A.max,min:A.min,type:r[t.itemSize]};return t.normalized===!0&&(h.normalized=!0),n.accessors||(n.accessors=[]),n.accessors.push(h)-1}processImage(t,e,i,s="image/png"){if(t!==null){const n=this,r=n.cache,o=n.json,A=n.options,l=n.pending;r.images.has(t)||r.images.set(t,{});const c=r.images.get(t),h=s+":flipY/"+i.toString();if(c[h]!==void 0)return c[h];o.images||(o.images=[]);const d={mimeType:s},u=aA();u.width=Math.min(t.width,A.maxTextureSize),u.height=Math.min(t.height,A.maxTextureSize);const g=u.getContext("2d");if(i===!0&&(g.translate(0,u.height),g.scale(1,-1)),t.data!==void 0){e!==$t&&console.error("GLTFExporter: Only RGBAFormat is supported."),(t.width>A.maxTextureSize||t.height>A.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const p=new Uint8ClampedArray(t.height*t.width*4);for(let f=0;f<p.length;f+=4)p[f+0]=t.data[f+0],p[f+1]=t.data[f+1],p[f+2]=t.data[f+2],p[f+3]=t.data[f+3];g.putImageData(new ImageData(p,t.width,t.height),0,0)}else g.drawImage(t,0,0,u.width,u.height);A.binary===!0?l.push(oA(u,s).then(p=>n.processBufferViewImage(p)).then(p=>{d.bufferView=p})):u.toDataURL!==void 0?d.uri=u.toDataURL(s):l.push(oA(u,s).then(p=>new FileReader().readAsDataURL(p)).then(p=>{d.uri=p}));const m=o.images.push(d)-1;return c[h]=m,m}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const e=this.json;e.samplers||(e.samplers=[]);const i={magFilter:pt[t.magFilter],minFilter:pt[t.minFilter],wrapS:pt[t.wrapS],wrapT:pt[t.wrapT]};return e.samplers.push(i)-1}processTexture(t){const e=this.cache,i=this.json;if(e.textures.has(t))return e.textures.get(t);i.textures||(i.textures=[]);let s=t.userData.mimeType;s==="image/webp"&&(s="image/png");const n={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,s)};t.name&&(n.name=t.name),this._invokeAll(function(o){o.writeTexture&&o.writeTexture(t,n)});const r=i.textures.push(n)-1;return e.textures.set(t,r),r}processMaterial(t){const e=this.cache,i=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};t.isMeshStandardMaterial!==!0&&t.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const n=t.color.toArray().concat([t.opacity]);if(Qi(n,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=n),t.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=t.metalness,s.pbrMetallicRoughness.roughnessFactor=t.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),t.metalnessMap||t.roughnessMap){const o=this.buildMetalRoughTexture(t.metalnessMap,t.roughnessMap),A={index:this.processTexture(o),channel:o.channel};this.applyTextureTransform(A,o),s.pbrMetallicRoughness.metallicRoughnessTexture=A}if(t.map){const o={index:this.processTexture(t.map),texCoord:t.map.channel};this.applyTextureTransform(o,t.map),s.pbrMetallicRoughness.baseColorTexture=o}if(t.emissive){const o=t.emissive;if(Math.max(o.r,o.g,o.b)>0&&(s.emissiveFactor=t.emissive.toArray()),t.emissiveMap){const A={index:this.processTexture(t.emissiveMap),texCoord:t.emissiveMap.channel};this.applyTextureTransform(A,t.emissiveMap),s.emissiveTexture=A}}if(t.normalMap){const o={index:this.processTexture(t.normalMap),texCoord:t.normalMap.channel};t.normalScale&&t.normalScale.x!==1&&(o.scale=t.normalScale.x),this.applyTextureTransform(o,t.normalMap),s.normalTexture=o}if(t.aoMap){const o={index:this.processTexture(t.aoMap),texCoord:t.aoMap.channel};t.aoMapIntensity!==1&&(o.strength=t.aoMapIntensity),this.applyTextureTransform(o,t.aoMap),s.occlusionTexture=o}t.transparent?s.alphaMode="BLEND":t.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=t.alphaTest),t.side===Fe&&(s.doubleSided=!0),t.name!==""&&(s.name=t.name),this.serializeUserData(t,s),this._invokeAll(function(o){o.writeMaterial&&o.writeMaterial(t,s)});const r=i.materials.push(s)-1;return e.materials.set(t,r),r}processMesh(t){const e=this.cache,i=this.json,s=[t.geometry.uuid];if(Array.isArray(t.material))for(let C=0,E=t.material.length;C<E;C++)s.push(t.material[C].uuid);else s.push(t.material.uuid);const n=s.join(":");if(e.meshes.has(n))return e.meshes.get(n);const r=t.geometry;let o;t.isLineSegments?o=k.LINES:t.isLineLoop?o=k.LINE_LOOP:t.isLine?o=k.LINE_STRIP:t.isPoints?o=k.POINTS:o=t.material.wireframe?k.LINES:k.TRIANGLES;const A={},l={},c=[],h=[],d={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},u=r.getAttribute("normal");u!==void 0&&!this.isNormalizedNormalAttribute(u)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),r.setAttribute("normal",this.createNormalizedNormalAttribute(u)));let g=null;for(let C in r.attributes){if(C.slice(0,5)==="morph")continue;const E=r.attributes[C];if(C=d[C]||C.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(C)||(C="_"+C),e.attributes.has(this.getUID(E))){l[C]=e.attributes.get(this.getUID(E));continue}g=null;const B=E.array;C==="JOINTS_0"&&!(B instanceof Uint16Array)&&!(B instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new _t(new Uint16Array(B),E.itemSize,E.normalized));const y=this.processAccessor(g||E,r);y!==null&&(C.startsWith("_")||this.detectMeshQuantization(C,E),l[C]=y,e.attributes.set(this.getUID(E),y))}if(u!==void 0&&r.setAttribute("normal",u),Object.keys(l).length===0)return null;if(t.morphTargetInfluences!==void 0&&t.morphTargetInfluences.length>0){const C=[],E=[],B={};if(t.morphTargetDictionary!==void 0)for(const y in t.morphTargetDictionary)B[t.morphTargetDictionary[y]]=y;for(let y=0;y<t.morphTargetInfluences.length;++y){const w={};let v=!1;for(const x in r.morphAttributes){if(x!=="position"&&x!=="normal"){v||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),v=!0);continue}const S=r.morphAttributes[x][y],_=x.toUpperCase(),M=r.attributes[x];if(e.attributes.has(this.getUID(S,!0))){w[_]=e.attributes.get(this.getUID(S,!0));continue}const V=S.clone();if(!r.morphTargetsRelative)for(let L=0,H=S.count;L<H;L++)for(let G=0;G<S.itemSize;G++)G===0&&V.setX(L,S.getX(L)-M.getX(L)),G===1&&V.setY(L,S.getY(L)-M.getY(L)),G===2&&V.setZ(L,S.getZ(L)-M.getZ(L)),G===3&&V.setW(L,S.getW(L)-M.getW(L));w[_]=this.processAccessor(V,r),e.attributes.set(this.getUID(M,!0),w[_])}h.push(w),C.push(t.morphTargetInfluences[y]),t.morphTargetDictionary!==void 0&&E.push(B[y])}A.weights=C,E.length>0&&(A.extras={},A.extras.targetNames=E)}const m=Array.isArray(t.material);if(m&&r.groups.length===0)return null;const p=m?t.material:[t.material],f=m?r.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let C=0,E=f.length;C<E;C++){const B={mode:o,attributes:l};if(this.serializeUserData(r,B),h.length>0&&(B.targets=h),r.index!==null){let w=this.getUID(r.index);(f[C].start!==void 0||f[C].count!==void 0)&&(w+=":"+f[C].start+":"+f[C].count),e.attributes.has(w)?B.indices=e.attributes.get(w):(B.indices=this.processAccessor(r.index,r,f[C].start,f[C].count),e.attributes.set(w,B.indices)),B.indices===null&&delete B.indices}const y=this.processMaterial(p[f[C].materialIndex]);y!==null&&(B.material=y),c.push(B)}A.primitives=c,i.meshes||(i.meshes=[]),this._invokeAll(function(C){C.writeMesh&&C.writeMesh(t,A)});const I=i.meshes.push(A)-1;return e.meshes.set(n,I),I}detectMeshQuantization(t,e){if(this.extensionsUsed[Ar])return;let i;switch(e.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}e.normalized&&(i+=" normalized");const s=t.split("_",1)[0];eA[s]&&eA[s].includes(i)&&(this.extensionsUsed[Ar]=!0,this.extensionsRequired[Ar]=!0)}processCamera(t){const e=this.json;e.cameras||(e.cameras=[]);const i=t.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:t.right*2,ymag:t.top*2,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:s.perspective={aspectRatio:t.aspect,yfov:ns.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},t.name!==""&&(s.name=t.type),e.cameras.push(s)-1}processAnimation(t,e){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),t=or.Utils.mergeMorphTargetTracks(t.clone(),e);const n=t.tracks,r=[],o=[];for(let A=0;A<n.length;++A){const l=n[A],c=di.parseTrackName(l.name);let h=di.findNode(e,c.nodeName);const d=iA[c.propertyName];if(c.objectName==="bones"&&(h.isSkinnedMesh===!0?h=h.skeleton.getBoneByName(c.objectIndex):h=void 0),!h||!d)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;const u=1;let g=l.values.length/l.times.length;d===iA.morphTargetInfluences&&(g/=h.morphTargetInfluences.length);let m;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):l.getInterpolation()===$a?m="STEP":m="LINEAR",o.push({input:this.processAccessor(new _t(l.times,u)),output:this.processAccessor(new _t(l.values,g)),interpolation:m}),r.push({sampler:o.length-1,target:{node:s.get(h),path:d}})}return i.animations.push({name:t.name||"clip_"+i.animations.length,samplers:o,channels:r}),i.animations.length-1}processSkin(t){const e=this.json,i=this.nodeMap,s=e.nodes[i.get(t)],n=t.skeleton;if(n===void 0)return null;const r=t.skeleton.bones[0];if(r===void 0)return null;const o=[],A=new Float32Array(n.bones.length*16),l=new Ft;for(let c=0;c<n.bones.length;++c)o.push(i.get(n.bones[c])),l.copy(n.boneInverses[c]),l.multiply(t.bindMatrix).toArray(A,c*16);return e.skins===void 0&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new _t(A,16)),joints:o,skeleton:i.get(r)}),s.skin=e.skins.length-1}processNode(t){const e=this.json,i=this.options,s=this.nodeMap;e.nodes||(e.nodes=[]);const n={};if(i.trs){const o=t.quaternion.toArray(),A=t.position.toArray(),l=t.scale.toArray();Qi(o,[0,0,0,1])||(n.rotation=o),Qi(A,[0,0,0])||(n.translation=A),Qi(l,[1,1,1])||(n.scale=l)}else t.matrixAutoUpdate&&t.updateMatrix(),Kd(t.matrix)===!1&&(n.matrix=t.matrix.elements);if(t.name!==""&&(n.name=String(t.name)),this.serializeUserData(t,n),t.isMesh||t.isLine||t.isPoints){const o=this.processMesh(t);o!==null&&(n.mesh=o)}else t.isCamera&&(n.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const o=[];for(let A=0,l=t.children.length;A<l;A++){const c=t.children[A];if(c.visible||i.onlyVisible===!1){const h=this.processNode(c);h!==null&&o.push(h)}}o.length>0&&(n.children=o)}this._invokeAll(function(o){o.writeNode&&o.writeNode(t,n)});const r=e.nodes.push(n)-1;return s.set(t,r),r}processScene(t){const e=this.json,i=this.options;e.scenes||(e.scenes=[],e.scene=0);const s={};t.name!==""&&(s.name=t.name),e.scenes.push(s);const n=[];for(let r=0,o=t.children.length;r<o;r++){const A=t.children[r];if(A.visible||i.onlyVisible===!1){const l=this.processNode(A);l!==null&&n.push(l)}}n.length>0&&(s.nodes=n),this.serializeUserData(t,s)}processObjects(t){const e=new Kt;e.name="AuxScene";for(let i=0;i<t.length;i++)e.children.push(t[i]);this.processScene(e)}processInput(t){const e=this.options;t=t instanceof Array?t:[t],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(t)});const i=[];for(let s=0;s<t.length;s++)t[s]instanceof Kt?this.processScene(t[s]):i.push(t[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<e.animations.length;++s)this.processAnimation(e.animations[s],t[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(t)})}_invokeAll(t){for(let e=0,i=this.plugins.length;e<i;e++)t(this.plugins[e])}}class jd{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,e){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);return}const i=this.writer,s=i.json,n=i.extensionsUsed,r={};t.name&&(r.name=t.name),r.color=t.color.toArray(),r.intensity=t.intensity,t.isDirectionalLight?r.type="directional":t.isPointLight?(r.type="point",t.distance>0&&(r.range=t.distance)):t.isSpotLight&&(r.type="spot",t.distance>0&&(r.range=t.distance),r.spot={},r.spot.innerConeAngle=(t.penumbra-1)*t.angle*-1,r.spot.outerConeAngle=t.angle),t.decay!==void 0&&t.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),t.target&&(t.target.parent!==t||t.target.position.x!==0||t.target.position.y!==0||t.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},n[this.name]=!0);const o=s.extensions[this.name].lights;o.push(r),e.extensions=e.extensions||{},e.extensions[this.name]={light:o.length-1}}}class Wd{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}writeMaterial(t,e){if(!t.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},i[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}}class Xd{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.clearcoatFactor=t.clearcoat,t.clearcoatMap){const r={index:i.processTexture(t.clearcoatMap),texCoord:t.clearcoatMap.channel};i.applyTextureTransform(r,t.clearcoatMap),n.clearcoatTexture=r}if(n.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const r={index:i.processTexture(t.clearcoatRoughnessMap),texCoord:t.clearcoatRoughnessMap.channel};i.applyTextureTransform(r,t.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=r}if(t.clearcoatNormalMap){const r={index:i.processTexture(t.clearcoatNormalMap),texCoord:t.clearcoatNormalMap.channel};i.applyTextureTransform(r,t.clearcoatNormalMap),n.clearcoatNormalTexture=r}e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class Zd{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.iridescenceFactor=t.iridescence,t.iridescenceMap){const r={index:i.processTexture(t.iridescenceMap),texCoord:t.iridescenceMap.channel};i.applyTextureTransform(r,t.iridescenceMap),n.iridescenceTexture=r}if(n.iridescenceIor=t.iridescenceIOR,n.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const r={index:i.processTexture(t.iridescenceThicknessMap),texCoord:t.iridescenceThicknessMap.channel};i.applyTextureTransform(r,t.iridescenceThicknessMap),n.iridescenceThicknessTexture=r}e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class tg{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.transmissionFactor=t.transmission,t.transmissionMap){const r={index:i.processTexture(t.transmissionMap),texCoord:t.transmissionMap.channel};i.applyTextureTransform(r,t.transmissionMap),n.transmissionTexture=r}e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class eg{constructor(t){this.writer=t,this.name="KHR_materials_volume"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const i=this.writer,s=i.extensionsUsed,n={};if(n.thicknessFactor=t.thickness,t.thicknessMap){const r={index:i.processTexture(t.thicknessMap),texCoord:t.thicknessMap.channel};i.applyTextureTransform(r,t.thicknessMap),n.thicknessTexture=r}n.attenuationDistance=t.attenuationDistance,n.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class ig{constructor(t){this.writer=t,this.name="KHR_materials_ior"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.ior===1.5)return;const i=this.writer.extensionsUsed,s={};s.ior=t.ior,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}}class sg{constructor(t){this.writer=t,this.name="KHR_materials_specular"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.specularIntensity===1&&t.specularColor.equals(Od)&&!t.specularIntensityMap&&!t.specularColorTexture)return;const i=this.writer,s=i.extensionsUsed,n={};if(t.specularIntensityMap){const r={index:i.processTexture(t.specularIntensityMap),texCoord:t.specularIntensityMap.channel};i.applyTextureTransform(r,t.specularIntensityMap),n.specularTexture=r}if(t.specularColorMap){const r={index:i.processTexture(t.specularColorMap),texCoord:t.specularColorMap.channel};i.applyTextureTransform(r,t.specularColorMap),n.specularColorTexture=r}n.specularFactor=t.specularIntensity,n.specularColorFactor=t.specularColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class ng{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.sheen==0)return;const i=this.writer,s=i.extensionsUsed,n={};if(t.sheenRoughnessMap){const r={index:i.processTexture(t.sheenRoughnessMap),texCoord:t.sheenRoughnessMap.channel};i.applyTextureTransform(r,t.sheenRoughnessMap),n.sheenRoughnessTexture=r}if(t.sheenColorMap){const r={index:i.processTexture(t.sheenColorMap),texCoord:t.sheenColorMap.channel};i.applyTextureTransform(r,t.sheenColorMap),n.sheenColorTexture=r}n.sheenRoughnessFactor=t.sheenRoughness,n.sheenColorFactor=t.sheenColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=n,s[this.name]=!0}}class rg{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||t.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=t.emissiveIntensity,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}}or.Utils={insertKeyframe:function(a,t){const e=a.getValueSize(),i=new a.TimeBufferType(a.times.length+1),s=new a.ValueBufferType(a.values.length+e),n=a.createInterpolant(new a.ValueBufferType(e));let r;if(a.times.length===0){i[0]=t;for(let o=0;o<e;o++)s[o]=0;r=0}else if(t<a.times[0]){if(Math.abs(a.times[0]-t)<.001)return 0;i[0]=t,i.set(a.times,1),s.set(n.evaluate(t),0),s.set(a.values,e),r=0}else if(t>a.times[a.times.length-1]){if(Math.abs(a.times[a.times.length-1]-t)<.001)return a.times.length-1;i[i.length-1]=t,i.set(a.times,0),s.set(a.values,0),s.set(n.evaluate(t),a.values.length),r=i.length-1}else for(let o=0;o<a.times.length;o++){if(Math.abs(a.times[o]-t)<.001)return o;if(a.times[o]<t&&a.times[o+1]>t){i.set(a.times.slice(0,o+1),0),i[o+1]=t,i.set(a.times.slice(o+1),o+2),s.set(a.values.slice(0,(o+1)*e),0),s.set(n.evaluate(t),(o+1)*e),s.set(a.values.slice((o+1)*e),(o+2)*e),r=o+1;break}}return a.times=i,a.values=s,r},mergeMorphTargetTracks:function(a,t){const e=[],i={},s=a.tracks;for(let n=0;n<s.length;++n){let r=s[n];const o=di.parseTrackName(r.name),A=di.findNode(t,o.nodeName);if(o.propertyName!=="morphTargetInfluences"||o.propertyIndex===void 0){e.push(r);continue}if(r.createInterpolant!==r.InterpolantFactoryMethodDiscrete&&r.createInterpolant!==r.InterpolantFactoryMethodLinear){if(r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),r=r.clone(),r.setInterpolation(Cn)}const l=A.morphTargetInfluences.length,c=A.morphTargetDictionary[o.propertyIndex];if(c===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);let h;if(i[A.uuid]===void 0){h=r.clone();const u=new h.ValueBufferType(l*h.times.length);for(let g=0;g<h.times.length;g++)u[g*l+c]=h.values[g];h.name=(o.nodeName||"")+".morphTargetInfluences",h.values=u,i[A.uuid]=h,e.push(h);continue}const d=r.createInterpolant(new r.ValueBufferType(1));h=i[A.uuid];for(let u=0;u<h.times.length;u++)h.values[u*l+c]=d.evaluate(h.times[u]);for(let u=0;u<r.times.length;u++){const g=this.insertKeyframe(h,r.times[u]);h.values[g*l+c]=r.values[u]}}return a.tracks=e,a}};/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const AA=a=>a.material!==void 0&&a.userData&&a.userData.variantMaterials&&!!Array.from(a.userData.variantMaterials.values()).filter(t=>ws(t.material)),ws=a=>a&&a.isMaterial&&!Array.isArray(a);class ag{constructor(t){this.writer=t,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(t){const e=new Set;for(const i of t)i.traverse(s=>{if(!AA(s))return;const n=s.userData.variantMaterials,r=s.userData.variantData;for(const[o,A]of r){const l=n.get(A.index);l&&ws(l.material)&&e.add(o)}});e.forEach(i=>this.variantNames.push(i))}writeMesh(t,e){if(!AA(t))return;const i=t.userData,s=i.variantMaterials,n=i.variantData,r=new Map,o=new Map,A=Array.from(n.values()).sort((h,d)=>h.index-d.index);for(const[h,d]of A.entries())o.set(d.index,h);for(const h of n.values()){const d=s.get(h.index);if(!d||!ws(d.material))continue;const u=this.writer.processMaterial(d.material);r.has(u)||r.set(u,{material:u,variants:[]}),r.get(u).variants.push(o.get(h.index))}const l=Array.from(r.values()).map(h=>h.variants.sort((d,u)=>d-u)&&h).sort((h,d)=>h.material-d.material);if(l.length===0)return;const c=ws(i.originalMaterial)?this.writer.processMaterial(i.originalMaterial):-1;for(const h of e.primitives)c>=0&&(h.material=c),h.extensions=h.extensions||{},h.extensions[this.name]={mappings:l}}afterParse(){if(this.variantNames.length===0)return;const t=this.writer.json;t.extensions=t.extensions||{};const e=this.variantNames.map(i=>({name:i}));t.extensions[this.name]={variants:e},this.writer.extensionsUsed[this.name]=!0}}class og{constructor(t,e,i,s,n){this.xrLight=t,this.renderer=e,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=n,this.frameCallback=this.onXRFrame.bind(this);const r=e.xr.getSession();if(s&&"XRWebGLBinding"in window){const o=new Fa(16);t.environment=o.texture;const A=e.getContext();switch(r.preferredReflectionFormat){case"srgba8":A.getExtension("EXT_sRGB");break;case"rgba16f":A.getExtension("OES_texture_half_float");break}this.xrWebGLBinding=new XRWebGLBinding(r,A),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}r.requestAnimationFrame(this.frameCallback)}updateReflection(){const t=this.renderer.properties.get(this.xrLight.environment);if(t){const e=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);e&&(t.__webglTexture=e,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(t,e){if(!this.xrLight)return;e.session.requestAnimationFrame(this.frameCallback);const i=e.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const s=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/s,i.primaryLightIntensity.y/s,i.primaryLightIntensity.z/s),this.xrLight.directionalLight.intensity=s,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class Ag extends ss{constructor(t,e=!0){super(),this.lightProbe=new qc,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new Ta,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,s=!1;t.xr.addEventListener("sessionstart",()=>{const n=t.xr.getSession();"requestLightProbe"in n&&n.requestLightProbe({reflectionFormat:n.preferredReflectionFormat}).then(r=>{i=new og(this,t,r,e,()=>{s=!0,this.dispatchEvent({type:"estimationstart"})})})}),t.xr.addEventListener("sessionend",()=>{i&&(i.dispose(),i=null),s&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const lA=1e4,lg=.001,hA=50;class mt{constructor(t=hA){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(t)}setDecayTime(t){this.naturalFrequency=1/Math.max(lg,t)}update(t,e,i,s){const n=2e-4*this.naturalFrequency;if(t==null||s===0||t===e&&this.velocity===0)return e;if(i<0)return t;const r=t-e,o=this.velocity+this.naturalFrequency*r,A=r+i*o,l=Math.exp(-this.naturalFrequency*i),c=(o-this.naturalFrequency*A)*l,h=-this.naturalFrequency*(c+o*l);return Math.abs(c)<n*Math.abs(s)&&h*r>=0?(this.velocity=0,e):(this.velocity=c,e+A*l)}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const He=.2,cA=.03,hg=.75,uA=12,cg=Math.PI/(2*uA),dA=new wt,Qs=(a,t,e)=>{let i=t>0?e>0?0:-Math.PI/2:e>0?Math.PI/2:Math.PI;for(let s=0;s<=uA;++s)a.push(t+(He-cA)*Math.cos(i),e+(He-cA)*Math.sin(i),0,t+He*Math.cos(i),e+He*Math.sin(i),0),i+=cg};class gA extends F{constructor(t,e){const i=new pn,s=[],n=[],{size:r,boundingBox:o}=t,A=r.x/2,l=(e==="back"?r.y:r.z)/2;Qs(n,A,l),Qs(n,-A,l),Qs(n,-A,-l),Qs(n,A,-l);const c=n.length/3;for(let u=0;u<c-2;u+=2)s.push(u,u+1,u+3,u,u+3,u+2);const h=c-2;s.push(h,h+1,1,h,1,0),i.setAttribute("position",new Vc(n,3)),i.setIndex(s),super(i),this.side=e;const d=this.material;switch(d.side=Fe,d.transparent=!0,d.opacity=0,this.goalOpacity=0,this.opacityDamper=new mt,this.hitPlane=new F(new Zi(2*(A+He),2*(l+He))),this.hitPlane.visible=!1,this.hitPlane.material.side=Fe,this.add(this.hitPlane),o.getCenter(this.position),e){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=o.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=o.min.z,this.position.z=this.shadowHeight}t.target.add(this),this.offsetHeight=0}getHit(t,e,i){dA.set(e,-i),this.hitPlane.visible=!0;const s=t.positionAndNormalFromPoint(dA,this.hitPlane);return this.hitPlane.visible=!1,s==null?null:s.position}getExpandedHit(t,e,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const s=this.getHit(t,e,i);return this.hitPlane.scale.set(1,1,1),s}set offsetHeight(t){t-=.001,this.side==="back"?this.position.z=this.shadowHeight+t:this.position.y=this.shadowHeight+t}get offsetHeight(){return this.side==="back"?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(t){this.goalOpacity=t?hg:0}updateOpacity(t){const e=this.material;e.opacity=this.opacityDamper.update(e.opacity,this.goalOpacity,t,1),this.visible=e.opacity>0}dispose(){var t;const{geometry:e,material:i}=this.hitPlane;e.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),(t=this.parent)===null||t===void 0||t.remove(this)}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const st=(a,t)=>({type:"number",number:a,unit:t}),Xt=(()=>{const a={};return t=>{const e=t;if(e in a)return a[e];const i=[];let s=0;for(;t;){if(++s>1e3){t="";break}const n=pA(t),r=n.nodes[0];if(r==null||r.terms.length===0)break;i.push(r),t=n.remainingInput}return a[e]=i}})(),pA=(()=>{const a=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,e=/^[\),]/,i="(",s="#";return n=>{const r=[];for(;n.length&&(n=n.trim(),!e.test(n));)if(n[0]===i){const{nodes:o,remainingInput:A}=mA(n);n=A,r.push({type:"function",name:{type:"ident",value:"calc"},arguments:o})}else if(a.test(n)){const o=ug(n),A=o.nodes[0];if(n=o.remainingInput,n[0]===i){const{nodes:l,remainingInput:c}=mA(n);r.push({type:"function",name:A,arguments:l}),n=c}else r.push(A)}else if(t.test(n))r.push({type:"operator",value:n[0]}),n=n.slice(1);else{const{nodes:o,remainingInput:A}=n[0]===s?gg(n):dg(n);if(o.length===0)break;r.push(o[0]),n=A}return{nodes:[{type:"expression",terms:r}],remainingInput:n}}})(),ug=(()=>{const a=/[^a-z0-9_\-\u0240-\uffff]/i;return t=>{const e=t.match(a),i=e==null?t:t.substr(0,e.index),s=e==null?"":t.substr(e.index);return{nodes:[{type:"ident",value:i}],remainingInput:s}}})(),dg=(()=>{const a=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,e=/^(m|mm|cm|rad|deg|[%])$/;return i=>{const s=i.match(a),n=s==null?"0":s[0];i=n==null?i:i.slice(n.length);const r=i.match(t);let o=r!=null&&r[0]!==""?r[0]:null;const A=r==null?i:i.slice(o.length);return o!=null&&!e.test(o)&&(o=null),{nodes:[{type:"number",number:parseFloat(n)||0,unit:o}],remainingInput:A}}})(),gg=(()=>{const a=/^[a-f0-9]*/i;return t=>{t=t.slice(1).trim();const e=t.match(a);return{nodes:e==null?[]:[{type:"hex",value:e[0]}],remainingInput:e==null?t:t.slice(e[0].length)}}})(),mA=a=>{const t=[];for(a=a.slice(1).trim();a.length;){const e=pA(a);if(t.push(e.nodes[0]),a=e.remainingInput.trim(),a[0]===",")a=a.slice(1).trim();else if(a[0]===")"){a=a.slice(1);break}}return{nodes:t,remainingInput:a}},fA=Symbol("visitedTypes");class pg{constructor(t){this[fA]=t}walk(t,e){const i=t.slice();for(;i.length;){const s=i.shift();switch(this[fA].indexOf(s.type)>-1&&e(s),s.type){case"expression":i.unshift(...s.terms);break;case"function":i.unshift(s.name,...s.arguments);break}}}}const Zt=Object.freeze({type:"number",number:0,unit:null});/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const vs=(a,t=0)=>{let{number:e,unit:i}=a;if(!isFinite(e))e=t,i="rad";else if(a.unit==="rad"||a.unit==null)return a;const s=(i==="deg"&&e!=null?e:0)*Math.PI/180;return{type:"number",number:s,unit:"rad"}},IA=(a,t=0)=>{let{number:e,unit:i}=a;if(!isFinite(e))e=t,i="m";else if(a.unit==="m")return a;let s;switch(i){default:s=1;break;case"cm":s=1/100;break;case"mm":s=1/1e3;break}const n=s*e;return{type:"number",number:n,unit:"m"}},Pt=(()=>{const a=e=>e,t={rad:a,deg:vs,m:a,mm:IA,cm:IA};return(e,i=Zt)=>{isFinite(e.number)||(e.number=i.number,e.unit=i.unit);const{unit:s}=e;if(s==null)return e;const n=t[s];return n==null?i:n(e)}})();/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var CA,EA,BA;const qe=Symbol("evaluate"),bs=Symbol("lastValue");class J{constructor(){this[CA]=null}static evaluatableFor(t,e=Zt){if(t instanceof J)return t;if(t.type==="number")return t.unit==="%"?new mg(t,e):t;switch(t.name.value){case"calc":return new Cg(t,e);case"env":return new fg(t)}return Zt}static evaluate(t){return t instanceof J?t.evaluate():t}static isConstant(t){return t instanceof J?t.isConstant:!0}static applyIntrinsics(t,e){const{basis:i,keywords:s}=e,{auto:n}=s;return i.map((r,o)=>{const A=n[o]==null?r:n[o];let l=t[o]?t[o]:A;if(l.type==="ident"){const c=l.value;c in s&&(l=s[c][o])}return(l==null||l.type==="ident")&&(l=A),l.unit==="%"?st(l.number/100*r.number,r.unit):(l=Pt(l,r),l.unit!==r.unit?r:l)})}get isConstant(){return!1}evaluate(){return(!this.isConstant||this[bs]==null)&&(this[bs]=this[qe]()),this[bs]}}CA=bs;const yA=Symbol("percentage"),hr=Symbol("basis");class mg extends J{constructor(t,e){super(),this[yA]=t,this[hr]=e}get isConstant(){return!0}[qe](){return st(this[yA].number/100*this[hr].number,this[hr].unit)}}const xs=Symbol("identNode");class fg extends J{constructor(t){super(),this[EA]=null;const e=t.arguments.length?t.arguments[0].terms[0]:null;e!=null&&e.type==="ident"&&(this[xs]=e)}get isConstant(){return!1}[(EA=xs,qe)](){if(this[xs]!=null)switch(this[xs].value){case"window-scroll-y":const t=window.pageYOffset,e=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),i=t/(e-window.innerHeight)||0;return{type:"number",number:i,unit:null}}return Zt}}const Ig=/[\*\/]/,Ve=Symbol("evaluator");class Cg extends J{constructor(t,e=Zt){if(super(),this[BA]=null,t.arguments.length!==1)return;const i=t.arguments[0].terms.slice(),s=[];for(;i.length;){const n=i.shift();if(s.length>0){const r=s[s.length-1];if(r.type==="operator"&&Ig.test(r.value)){const o=s.pop(),A=s.pop();if(A==null)return;s.push(new QA(o,J.evaluatableFor(A,e),J.evaluatableFor(n,e)));continue}}s.push(n.type==="operator"?n:J.evaluatableFor(n,e))}for(;s.length>2;){const[n,r,o]=s.splice(0,3);if(r.type!=="operator")return;s.unshift(new QA(r,J.evaluatableFor(n,e),J.evaluatableFor(o,e)))}s.length===1&&(this[Ve]=s[0])}get isConstant(){return this[Ve]==null||J.isConstant(this[Ve])}[(BA=Ve,qe)](){return this[Ve]!=null?J.evaluate(this[Ve]):Zt}}const wA=Symbol("operator"),cr=Symbol("left"),ur=Symbol("right");class QA extends J{constructor(t,e,i){super(),this[wA]=t,this[cr]=e,this[ur]=i}get isConstant(){return J.isConstant(this[cr])&&J.isConstant(this[ur])}[qe](){const t=Pt(J.evaluate(this[cr])),e=Pt(J.evaluate(this[ur])),{number:i,unit:s}=t,{number:n,unit:r}=e;if(r!=null&&s!=null&&r!=s)return Zt;const o=s||r;let A;switch(this[wA].value){case"+":A=i+n;break;case"-":A=i-n;break;case"/":A=i/n;break;case"*":A=i*n;break;default:return Zt}return{type:"number",number:A,unit:o}}}const dr=Symbol("evaluatables"),vA=Symbol("intrinsics");class bA extends J{constructor(t,e){super(),this[vA]=e;const i=t[0],s=i!=null?i.terms:[];this[dr]=e.basis.map((n,r)=>{const o=s[r];return o==null?{type:"ident",value:"auto"}:o.type==="ident"?o:J.evaluatableFor(o,n)})}get isConstant(){for(const t of this[dr])if(!J.isConstant(t))return!1;return!0}[qe](){const t=this[dr].map(e=>J.evaluate(e));return J.applyIntrinsics(t,this[vA]).map(e=>e.number)}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var xA,SA,MA,LA;const $e=Symbol("instances"),TA=Symbol("activateListener"),DA=Symbol("deactivateListener"),gr=Symbol("notifyInstances"),RA=Symbol("notify"),FA=Symbol("callback");class Dt{constructor(t){this[FA]=t}static[gr](){for(const t of Dt[$e])t[RA]()}static[(xA=$e,TA)](){window.addEventListener("scroll",this[gr],{passive:!0})}static[DA](){window.removeEventListener("scroll",this[gr])}observe(){Dt[$e].size===0&&Dt[TA](),Dt[$e].add(this)}disconnect(){Dt[$e].delete(this),Dt[$e].size===0&&Dt[DA]()}[RA](){this[FA]()}}Dt[xA]=new Set;const kA=Symbol("computeStyleCallback"),_A=Symbol("astWalker"),vi=Symbol("dependencies"),UA=Symbol("onScroll");class Eg{constructor(t){this[SA]={},this[MA]=new pg(["function"]),this[LA]=()=>{this[kA]({relatedState:"window-scroll"})},this[kA]=t}observeEffectsFor(t){const e={},i=this[vi];this[_A].walk(t,s=>{const{name:n}=s,r=s.arguments[0].terms[0];if(!(n.value!=="env"||r==null||r.type!=="ident"))switch(r.value){case"window-scroll-y":if(e["window-scroll"]==null){const o="window-scroll"in i?i["window-scroll"]:new Dt(this[UA]);o.observe(),delete i["window-scroll"],e["window-scroll"]=o}break}});for(const s in i)i[s].disconnect();this[vi]=e}dispose(){for(const t in this[vi])this[vi][t].disconnect()}}SA=vi,MA=_A,LA=UA;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const te=a=>{const t=a.observeEffects||!1,e=a.intrinsics instanceof Function?a.intrinsics:()=>a.intrinsics;return(i,s)=>{const n=i.updated,r=i.connectedCallback,o=i.disconnectedCallback,A=Symbol(`${s}StyleEffector`),l=Symbol(`${s}StyleEvaluator`),c=Symbol(`${s}UpdateEvaluator`),h=Symbol(`${s}EvaluateAndSync`);Object.defineProperties(i,{[A]:{value:null,writable:!0},[l]:{value:null,writable:!0},[c]:{value:function(){const d=Xt(this[s]);this[l]=new bA(d,e(this)),this[A]==null&&t&&(this[A]=new Eg(()=>this[h]())),this[A]!=null&&this[A].observeEffectsFor(d)}},[h]:{value:function(){if(this[l]==null)return;const d=this[l].evaluate();this[a.updateHandler](d)}},updated:{value:function(d){d.has(s)&&(this[c](),this[h]()),n.call(this,d)}},connectedCallback:{value:function(){r.call(this),this.requestUpdate(s,this[s])}},disconnectedCallback:{value:function(){o.call(this),this[A]!=null&&(this[A].dispose(),this[A]=null)}}})}};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const NA=a=>a<.5?2*a*a:-1+(4-2*a)*a,Bg=(a,t,e=NA)=>i=>a+(t-a)*e(i),yg=(a,t)=>{const e=s=>n=>s+=n,i=t.map(e(0));return s=>{s=St(s,0,1),s*=i[i.length-1];const n=i.findIndex(A=>A>=s),r=n<1?0:i[n-1],o=i[n];return a[n]((s-r)/(o-r))}},Je=a=>{const t=[],e=[];let i=a.initialValue;for(let s=0;s<a.keyframes.length;++s){const n=a.keyframes[s],{value:r,frames:o}=n,A=n.ease||NA,l=Bg(i,r,A);t.push(l),e.push(o),i=r}return yg(t,e)};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var tt=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};const wg=5e3,Qg=Je({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),vg=Je({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),bg=30,xg=12,GA="0deg 75deg 105%",Sg="auto auto auto",Mg="auto",Lg=2.2,Tg=["front","right","back","left"],Dg=["upper-","","lower-"],Rg=3e3,Fg=". Use mouse, touch or arrow keys to move.",Ss={AUTO:"auto",NONE:"none"},pr={BASIC:"basic",WIGGLE:"wiggle"},kg={PAN_Y:"pan-y",PAN_X:"pan-x",NONE:"none"},PA=()=>({basis:[vs(st(bg,"deg"))],keywords:{auto:[null]}}),_g=()=>({basis:[vs(st(xg,"deg"))],keywords:{auto:[null]}}),OA=(()=>{const a=Xt(GA)[0].terms,t=Pt(a[0]),e=Pt(a[1]);return i=>{const s=i[Q].idealCameraDistance();return{basis:[t,e,st(s,"m")],keywords:{auto:[null,null,st(105,"%")]}}}})(),Ug=a=>{const t=Lg*a[Q].boundingSphere.radius;return{basis:[st(-1/0,"rad"),st(Math.PI/8,"rad"),st(t,"m")],keywords:{auto:[null,null,null]}}},Ng=a=>{const t=OA(a),e=new bA([],t).evaluate()[2];return{basis:[st(1/0,"rad"),st(Math.PI-Math.PI/8,"rad"),st(e,"m")],keywords:{auto:[null,null,null]}}},Gg=a=>{const t=a[Q].boundingBox.getCenter(new R);return{basis:[st(t.x,"m"),st(t.y,"m"),st(t.z,"m")],keywords:{auto:[null,null,null]}}},HA=Math.PI/2,Pg=Math.PI/3,Og=HA/2,Hg=2*Math.PI,q=Symbol("controls"),Ms=Symbol("panElement"),mr=Symbol("promptElement"),Ls=Symbol("promptAnimatedContainer"),fr=Symbol("fingerAnimatedContainers"),Ts=Symbol("deferInteractionPrompt"),qA=Symbol("updateAria"),VA=Symbol("updateCameraForRadius"),Ke=Symbol("cancelPrompts"),Ir=Symbol("onChange"),bi=Symbol("onPointerChange"),Ie=Symbol("waitingToPromptUser"),Ds=Symbol("userHasInteracted"),Ye=Symbol("promptElementVisibleTime"),xi=Symbol("lastPromptOffset"),Rs=Symbol("cancellationSource"),Cr=Symbol("lastSpherical"),Si=Symbol("jumpCamera"),Er=Symbol("initialized"),Mi=Symbol("maintainThetaPhi"),$A=Symbol("syncCameraOrbit"),JA=Symbol("syncFieldOfView"),KA=Symbol("syncCameraTarget"),YA=Symbol("syncMinCameraOrbit"),zA=Symbol("syncMaxCameraOrbit"),jA=Symbol("syncMinFieldOfView"),WA=Symbol("syncMaxFieldOfView"),qg=a=>{var t,e,i,s,n,r,o,A,l,c,h,d,u,g,m,p,f;class I extends a{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=GA,this.cameraTarget=Sg,this.fieldOfView=Mg,this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=Rg,this.interactionPrompt=Ss.AUTO,this.interactionPromptStyle=pr.WIGGLE,this.orbitSensitivity=1,this.touchAction=kg.NONE,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=hA,this[t]=this.shadowRoot.querySelector(".interaction-prompt"),this[e]=this.shadowRoot.querySelector("#prompt"),this[i]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[s]=this.shadowRoot.querySelector(".pan-target"),this[n]=0,this[r]=1/0,this[o]=!1,this[A]=!1,this[l]=K.AUTOMATIC,this[c]=new Kg(this[Q].camera,this[Lt],this[Q]),this[h]=new as,this[d]=!1,this[u]=!1,this[g]=!1,this[m]=()=>{const E=this[q].changeSource;this[Rs]=E,E===K.USER_INTERACTION&&(this[Ds]=!0,this[Ts]())},this[p]=()=>{this[qA](),this[ct]();const E=this[q].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:E}}))},this[f]=E=>{E.type==="pointer-change-start"?this[Pi].classList.add("pointer-tumbling"):this[Pi].classList.remove("pointer-tumbling")}}get inputSensitivity(){return this[q].inputSensitivity}set inputSensitivity(E){this[q].inputSensitivity=E}getCameraOrbit(){const{theta:E,phi:B,radius:y}=this[Cr];return{theta:E,phi:B,radius:y,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return ae(this[O].isPresenting?this[O].arRenderer.target:this[Q].getTarget())}getFieldOfView(){return this[q].getFieldOfView()}getMinimumFieldOfView(){return this[q].options.minimumFieldOfView}getMaximumFieldOfView(){return this[q].options.maximumFieldOfView}getIdealAspect(){return this[Q].idealAspect}jumpCameraToGoal(){this[Si]=!0,this.requestUpdate(Si,!1)}resetInteractionPrompt(){this[xi]=0,this[Ye]=1/0,this[Ds]=!1,this[Ie]=this.interactionPrompt===Ss.AUTO&&this.cameraControls}zoom(E){const B=new WheelEvent("wheel",{deltaY:-30*E});this[Lt].dispatchEvent(B)}connectedCallback(){super.connectedCallback(),this[q].addEventListener("user-interaction",this[Ke]),this[q].addEventListener("pointer-change-start",this[bi]),this[q].addEventListener("pointer-change-end",this[bi])}disconnectedCallback(){super.disconnectedCallback(),this[q].removeEventListener("user-interaction",this[Ke]),this[q].removeEventListener("pointer-change-start",this[bi]),this[q].removeEventListener("pointer-change-end",this[bi])}updated(E){super.updated(E);const B=this[q],y=this[Q];if(E.has("cameraControls")&&(this.cameraControls?(B.enableInteraction(),this.interactionPrompt===Ss.AUTO&&(this[Ie]=!0)):(B.disableInteraction(),this[Ts]()),this[Lt].setAttribute("aria-label",this[Ui])),E.has("disableZoom")&&(B.disableZoom=this.disableZoom),E.has("disablePan")&&(B.enablePan=!this.disablePan),E.has("disableTap")&&(B.enableTap=!this.disableTap),(E.has("interactionPrompt")||E.has("cameraControls")||E.has("src"))&&(this.interactionPrompt===Ss.AUTO&&this.cameraControls&&!this[Ds]?this[Ie]=!0:this[Ts]()),E.has("interactionPromptStyle")&&(this[Ls].style.opacity=this.interactionPromptStyle==pr.BASIC?"1":"0"),E.has("touchAction")){const w=this.touchAction;B.applyOptions({touchAction:w}),B.updateTouchActionStyle()}E.has("orbitSensitivity")&&(B.orbitSensitivity=this.orbitSensitivity),E.has("interpolationDecay")&&(B.setDamperDecayTime(this.interpolationDecay),y.setTargetDamperDecayTime(this.interpolationDecay)),this[Si]===!0&&Promise.resolve().then(()=>{B.jumpToGoal(),y.jumpToGoal(),this[Ir](),this[Si]=!1})}updateFraming(){return b(this,null,function*(){const E=this[Q],B=E.adjustedFoV(E.framedFoVDeg);yield E.updateFraming();const y=E.adjustedFoV(E.framedFoVDeg),w=this[q].getFieldOfView()/B;this[q].setFieldOfView(y*w),this[Mi]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),yield this.updateComplete})}interact(E,B,y){const w=this[Lt],v=this[fr];if(v[0].style.opacity==="1"){console.warn("interact() failed because an existing interaction is running.");return}const x=[];x.push({x:Je(B.x),y:Je(B.y)});const S=[{x:x[0].x(0),y:x[0].y(0)}];y!=null&&(x.push({x:Je(y.x),y:Je(y.y)}),S.push({x:x[1].x(0),y:x[1].y(0)}));let _=performance.now();const{width:M,height:V}=this[Q],L=this.getBoundingClientRect(),H=U=>{for(const[z,it]of S.entries()){const{style:Z}=v[z];Z.transform=`translateX(${M*it.x}px) translateY(${V*it.y}px)`,U==="pointerdown"?Z.opacity="1":U==="pointerup"&&(Z.opacity="0");const le={pointerId:z-5678,pointerType:"touch",target:w,clientX:M*it.x+L.x,clientY:V*it.y+L.y,altKey:!0};w.dispatchEvent(new PointerEvent(U,le))}},G=()=>{const U=this[Rs];if(U!==K.AUTOMATIC||!w.isConnected){for(const it of this[fr])it.style.opacity="0";H("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:U}})),document.removeEventListener("visibilitychange",D);return}const z=Math.min(1,(performance.now()-_)/E);for(const[it,Z]of S.entries())Z.x=x[it].x(z),Z.y=x[it].y(z);H("pointermove"),z<1?requestAnimationFrame(G):(H("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:K.AUTOMATIC}})),document.removeEventListener("visibilitychange",D))},D=()=>{let U=0;document.visibilityState==="hidden"?U=performance.now()-_:_=performance.now()-U};document.addEventListener("visibilitychange",D),H("pointerdown"),this[Rs]=K.AUTOMATIC,requestAnimationFrame(G)}[(t=mr,e=Ls,i=fr,s=Ms,n=xi,r=Ye,o=Ds,A=Ie,l=Rs,c=q,h=Cr,d=Si,u=Er,g=Mi,JA)](E){const B=this[q],y=this[Q];y.framedFoVDeg=E[0]*180/Math.PI,B.changeSource=K.NONE,B.setFieldOfView(y.adjustedFoV(y.framedFoVDeg)),this[Ke]()}[$A](E){const B=this[q];if(this[Mi]){const{theta:y,phi:w}=this.getCameraOrbit();E[0]=y,E[1]=w,this[Mi]=!1}B.changeSource=K.NONE,B.setOrbit(E[0],E[1],E[2]),this[Ke]()}[YA](E){this[q].applyOptions({minimumAzimuthalAngle:E[0],minimumPolarAngle:E[1],minimumRadius:E[2]}),this.jumpCameraToGoal()}[zA](E){this[q].applyOptions({maximumAzimuthalAngle:E[0],maximumPolarAngle:E[1],maximumRadius:E[2]}),this[VA](E[2]),this.jumpCameraToGoal()}[jA](E){this[q].applyOptions({minimumFieldOfView:E[0]*180/Math.PI}),this.jumpCameraToGoal()}[WA](E){const B=this[Q].adjustedFoV(E[0]*180/Math.PI);this[q].applyOptions({maximumFieldOfView:B}),this.jumpCameraToGoal()}[KA](E){const[B,y,w]=E;this[O].arRenderer.isPresenting||this[Q].setTarget(B,y,w),this[q].changeSource=K.NONE,this[O].arRenderer.updateTarget(),this[Ke]()}[Tt](E,B){if(super[Tt](E,B),this[O].isPresenting||!this[xe]())return;const y=this[q],w=this[Q],v=performance.now();if(this[Ie]&&this.loaded&&v>this[Gi]+this.interactionPromptThreshold&&(this[Ie]=!1,this[Ye]=v,this[mr].classList.add("visible")),isFinite(this[Ye])&&this.interactionPromptStyle===pr.WIGGLE){const _=(v-this[Ye])/wg%1,M=Qg(_),V=vg(_);if(this[Ls].style.opacity=`${V}`,M!==this[xi]){const L=M*w.width*.05,H=(M-this[xi])*Math.PI/16;this[Ls].style.transform=`translateX(${L}px)`,y.changeSource=K.AUTOMATIC,y.adjustOrbit(H,0,0),this[xi]=M}}const x=y.update(E,B),S=w.updateTarget(B);(x||S)&&this[Ir]()}[Ts](){this[Ie]=!1,this[mr].classList.remove("visible"),this[Ye]=1/0}[VA](E){const B=Math.max(this[Q].boundingSphere.radius,E),y=0,w=Math.abs(2*B);this[q].updateNearFar(y,w)}[qA](){const{theta:E,phi:B}=this[q].getCameraSpherical(this[Cr]),y=(4+Math.floor((E%Hg+Og)/HA))%4,w=Math.floor(B/Pg),v=Tg[y],x=Dg[w];this[zr](`View from stage ${x}${v}`)}get[Ui](){return super[Ui].replace(/\.$/,"")+(this.cameraControls?Fg:"")}[Oi](E){return b(this,null,function*(){const B=this[q],y=this[Q],w=y.adjustedFoV(y.framedFoVDeg);xn(I.prototype,this,Oi).call(this,E);const v=y.adjustedFoV(y.framedFoVDeg)/w,x=B.getFieldOfView()*(isFinite(v)?v:1);B.updateAspect(this[Q].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),yield this.updateComplete,this[q].setFieldOfView(x),this.jumpCameraToGoal()})}[re](){super[re](),this[Er]?this[Mi]=!0:this[Er]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}return m=Ke,p=Ir,f=bi,tt([T({type:Boolean,attribute:"camera-controls"})],I.prototype,"cameraControls",void 0),tt([te({intrinsics:OA,observeEffects:!0,updateHandler:$A}),T({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],I.prototype,"cameraOrbit",void 0),tt([te({intrinsics:Gg,observeEffects:!0,updateHandler:KA}),T({type:String,attribute:"camera-target",hasChanged:()=>!0})],I.prototype,"cameraTarget",void 0),tt([te({intrinsics:PA,observeEffects:!0,updateHandler:JA}),T({type:String,attribute:"field-of-view",hasChanged:()=>!0})],I.prototype,"fieldOfView",void 0),tt([te({intrinsics:Ug,updateHandler:YA}),T({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],I.prototype,"minCameraOrbit",void 0),tt([te({intrinsics:Ng,updateHandler:zA}),T({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],I.prototype,"maxCameraOrbit",void 0),tt([te({intrinsics:_g,updateHandler:jA}),T({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],I.prototype,"minFieldOfView",void 0),tt([te({intrinsics:PA,updateHandler:WA}),T({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],I.prototype,"maxFieldOfView",void 0),tt([T({type:Number,attribute:"interaction-prompt-threshold"})],I.prototype,"interactionPromptThreshold",void 0),tt([T({type:String,attribute:"interaction-prompt"})],I.prototype,"interactionPrompt",void 0),tt([T({type:String,attribute:"interaction-prompt-style"})],I.prototype,"interactionPromptStyle",void 0),tt([T({type:Number,attribute:"orbit-sensitivity"})],I.prototype,"orbitSensitivity",void 0),tt([T({type:String,attribute:"touch-action"})],I.prototype,"touchAction",void 0),tt([T({type:Boolean,attribute:"disable-zoom"})],I.prototype,"disableZoom",void 0),tt([T({type:Boolean,attribute:"disable-pan"})],I.prototype,"disablePan",void 0),tt([T({type:Boolean,attribute:"disable-tap"})],I.prototype,"disableTap",void 0),tt([T({type:Number,attribute:"interpolation-decay"})],I.prototype,"interpolationDecay",void 0),I};/* @license
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Vg=.018,XA=2,$g=300,Jg=new wt,ZA=new R,tl=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),Fs=Math.PI/8,ks=.04,_s=10,K={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class Kg extends ci{constructor(t,e,i){super(),this.camera=t,this.element=e,this.scene=i,this.orbitSensitivity=1,this.inputSensitivity=1,this.changeSource=K.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new dn,this.panPerPixel=0,this.spherical=new as,this.goalSpherical=new as,this.thetaDamper=new mt,this.phiDamper=new mt,this.radiusDamper=new mt,this.logFov=Math.log(tl.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new mt,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=s=>{if(this.enablePan)s.preventDefault();else for(const n of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:n.id})))},this.touchModeZoom=(s,n)=>{if(!this._disableZoom){const r=this.twoTouchDistance(this.pointers[0],this.pointers[1]),o=ks*(this.lastSeparation-r)*50/this.scene.height;this.lastSeparation=r,this.userAdjustOrbit(0,0,o)}this.panPerPixel>0&&this.movePan(s,n)},this.disableScroll=s=>{s.preventDefault()},this.touchModeRotate=(s,n)=>{const{touchAction:r}=this._options;if(!this.touchDecided&&r!=="none"){this.touchDecided=!0;const o=Math.abs(s),A=Math.abs(n);if(this.changeSource===K.USER_INTERACTION&&(r==="pan-y"&&A>o||r==="pan-x"&&o>A)){this.touchMode=null;return}else this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(s,n)},this.onPointerDown=s=>{if(this.pointers.length>2)return;const{element:n}=this;this.pointers.length===0&&(n.addEventListener("pointermove",this.onPointerMove),n.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=s.clientX,this.startPointerPosition.clientY=s.clientY,this.startTime=performance.now());try{n.setPointerCapture(s.pointerId)}catch{}this.pointers.push({clientX:s.clientX,clientY:s.clientY,id:s.pointerId}),this.isUserPointing=!1,s.pointerType==="touch"?(this.changeSource=s.altKey?K.AUTOMATIC:K.USER_INTERACTION,this.onTouchChange(s)):(this.changeSource=K.USER_INTERACTION,this.onMouseDown(s)),this.changeSource===K.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=s=>{const n=this.pointers.find(l=>l.id===s.pointerId);if(n==null)return;if(s.pointerType==="mouse"&&s.buttons===0){this.onPointerUp(s);return}const r=this.pointers.length,o=(s.clientX-n.clientX)/r,A=(s.clientY-n.clientY)/r;o===0&&A===0||(n.clientX=s.clientX,n.clientY=s.clientY,s.pointerType==="touch"?(this.changeSource=s.altKey?K.AUTOMATIC:K.USER_INTERACTION,this.touchMode!==null&&this.touchMode(o,A)):(this.changeSource=K.USER_INTERACTION,this.panPerPixel>0?this.movePan(o,A):this.handleSinglePointerMove(o,A)))},this.onPointerUp=s=>{const{element:n}=this,r=this.pointers.findIndex(o=>o.id===s.pointerId);r!==-1&&this.pointers.splice(r,1),this.panPerPixel>0&&!s.altKey&&this.resetRadius(),this.pointers.length===0?(n.removeEventListener("pointermove",this.onPointerMove),n.removeEventListener("pointerup",this.onPointerUp),n.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(s)):this.touchMode!==null&&this.onTouchChange(s),this.scene.element[Ms].style.opacity=0,n.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=s=>{this.changeSource=K.USER_INTERACTION;const n=s.deltaY*(s.deltaMode==1?18:1)*ks/30;this.userAdjustOrbit(0,0,n),s.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=s=>{const{changeSource:n}=this;this.changeSource=K.USER_INTERACTION,(s.shiftKey&&this.enablePan?this.panKeyCodeHandler(s):this.orbitZoomKeyCodeHandler(s))?(s.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=n},this._options=Object.assign({},tl),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(this._interactionEnabled===!1){const{element:t}=this;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||t.addEventListener("wheel",this.onWheel),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("touchmove",()=>{},{passive:!1}),t.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(this._interactionEnabled===!0){const{element:t}=this;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("pointercancel",this.onPointerUp),t.removeEventListener("wheel",this.onWheel),t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("contextmenu",this.onContext),t.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(t){this._disableZoom!=t&&(this._disableZoom=t,t===!0?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(t=new as){return t.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(t){Object.assign(this._options,t),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(t,e){this.camera.far=e===0?2:e,this.camera.near=Math.max(t,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(t){this.camera.aspect=t,this.camera.updateProjectionMatrix()}setOrbit(t=this.goalSpherical.theta,e=this.goalSpherical.phi,i=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:n,minimumPolarAngle:r,maximumPolarAngle:o,minimumRadius:A,maximumRadius:l}=this._options,{theta:c,phi:h,radius:d}=this.goalSpherical,u=St(t,s,n);!isFinite(s)&&!isFinite(n)&&(this.spherical.theta=this.wrapAngle(this.spherical.theta-u)+u);const g=St(e,r,o),m=St(i,A,l);return u===c&&g===h&&m===d||!isFinite(u)||!isFinite(g)||!isFinite(m)?!1:(this.goalSpherical.theta=u,this.goalSpherical.phi=g,this.goalSpherical.radius=m,this.goalSpherical.makeSafe(),!0)}setRadius(t){this.goalSpherical.radius=t,this.setOrbit()}setFieldOfView(t){const{minimumFieldOfView:e,maximumFieldOfView:i}=this._options;t=St(t,e,i),this.goalLogFov=Math.log(t)}setDamperDecayTime(t){this.thetaDamper.setDecayTime(t),this.phiDamper.setDecayTime(t),this.radiusDamper.setDecayTime(t),this.fovDamper.setDecayTime(t)}adjustOrbit(t,e,i){const{theta:s,phi:n,radius:r}=this.goalSpherical,{minimumRadius:o,maximumRadius:A,minimumFieldOfView:l,maximumFieldOfView:c}=this._options,h=this.spherical.theta-s,d=Math.PI-.001,u=s-St(t,-d-h,d-h),g=n-e,m=i===0?0:((i>0?A:o)-r)/(Math.log(i>0?c:l)-this.goalLogFov),p=r+i*(isFinite(m)?m:(A-o)*2);if(this.setOrbit(u,g,p),i!==0){const f=this.goalLogFov+i;this.setFieldOfView(Math.exp(f))}}jumpToGoal(){this.update(0,lA)}update(t,e){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:s}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=Math.sign(n)*2*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,e,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,e,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,e,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,e,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:t}=this.element;if(this._interactionEnabled){const{touchAction:e}=this._options;this._disableZoom&&e!=="none"?t.touchAction="manipulation":t.touchAction=e}else t.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new Ra(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(t,e,i){this.adjustOrbit(t*this.orbitSensitivity*this.inputSensitivity,e*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(t){const e=(t+Math.PI)/(2*Math.PI);return(e-Math.floor(e))*2*Math.PI-Math.PI}pixelLengthToSphericalAngle(t){return 2*Math.PI*t/this.scene.height}twoTouchDistance(t,e){const{clientX:i,clientY:s}=t,{clientX:n,clientY:r}=e,o=n-i,A=r-s;return Math.sqrt(o*o+A*A)}handleSinglePointerMove(t,e){const i=this.pixelLengthToSphericalAngle(t),s=this.pixelLengthToSphericalAngle(e);this.isUserPointing===!1&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,s,0)}initializePan(){const{theta:t,phi:e}=this.spherical,i=t-this.scene.yaw;this.panPerPixel=Vg/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(e)*Math.sin(i),0,0,Math.sin(e),0,Math.sin(i),-Math.cos(e)*Math.cos(i),0)}movePan(t,e){const{scene:i}=this,s=ZA.set(t,e,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;s.multiplyScalar(n);const r=i.getTarget();r.add(s.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(r,r),i.setTarget(r.x,r.y,r.z)}recenter(t){if(performance.now()>this.startTime+$g||Math.abs(t.clientX-this.startPointerPosition.clientX)>XA||Math.abs(t.clientY-this.startPointerPosition.clientY)>XA)return;const{scene:e}=this,i=e.positionAndNormalFromPoint(e.getNDC(t.clientX,t.clientY));if(i==null){const{cameraTarget:s}=e.element;e.element.cameraTarget="",e.element.cameraTarget=s,this.userAdjustOrbit(0,0,1)}else e.target.worldToLocal(i.position),e.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:t}=this,e=t.positionAndNormalFromPoint(Jg.set(0,0));if(e==null)return;t.target.worldToLocal(e.position);const i=t.getTarget(),{theta:s,phi:n}=this.spherical,r=s-t.yaw,o=ZA.set(Math.sin(n)*Math.sin(r),Math.cos(n),Math.sin(n)*Math.cos(r)),A=o.dot(e.position.sub(i));i.add(o.multiplyScalar(A)),t.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-A)}onTouchChange(t){if(this.pointers.length===1)this.touchMode=this.touchModeRotate;else{if(this._disableZoom){this.touchMode=null,this.element.removeEventListener("touchmove",this.disableScroll);return}this.touchMode=this.touchDecided&&this.touchMode===null?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&this.touchMode!=null&&(this.initializePan(),t.altKey||(this.scene.element[Ms].style.opacity=1))}}onMouseDown(t){this.panPerPixel=0,this.enablePan&&(t.button===2||t.ctrlKey||t.metaKey||t.shiftKey)&&(this.initializePan(),this.scene.element[Ms].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(t){let e=!0;switch(t.key){case"PageUp":this.userAdjustOrbit(0,0,ks);break;case"PageDown":this.userAdjustOrbit(0,0,-1*ks);break;case"ArrowUp":this.userAdjustOrbit(0,-Fs,0);break;case"ArrowDown":this.userAdjustOrbit(0,Fs,0);break;case"ArrowLeft":this.userAdjustOrbit(-Fs,0,0);break;case"ArrowRight":this.userAdjustOrbit(Fs,0,0);break;default:e=!1;break}return e}panKeyCodeHandler(t){this.initializePan();let e=!0;switch(t.key){case"ArrowUp":this.movePan(0,-1*_s);break;case"ArrowDown":this.movePan(0,_s);break;case"ArrowLeft":this.movePan(-1*_s,0);break;case"ArrowRight":this.movePan(_s,0);break;default:e=!1;break}return e}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Yg=30,zg=.8,el=1.5,jg=20,il=1.3,Wg=1/il,Xg=.25,Zg=10,ee={NOT_PRESENTING:"not-presenting",SESSION_STARTED:"session-started",OBJECT_PLACED:"object-placed",FAILED:"failed"},Br={TRACKING:"tracking",NOT_TRACKING:"not-tracking"},Us=new R,tp=new Ft,ep=new R,ip=new Xi(45,1,.1,100);class sp extends ci{constructor(t){super(),this.renderer=t,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new R,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new R,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new R,this.goalYaw=0,this.goalScale=1,this.xDamper=new mt,this.yDamper=new mt,this.zDamper=new mt,this.yawDamper=new mt,this.scaleDamper=new mt,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onUpdateScene=()=>{this.placementBox!=null&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new gA(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),n=this.presentedScene,r=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:o}=this.inputSource.gamepad,A=r.getHit(this.presentedScene,o[0],o[1]);r.show=!0,A!=null?(this.isTranslating=!0,this.lastDragPosition.copy(A)):this.placeOnWall===!1&&(this.isRotating=!0,this.lastAngle=o[0]*el)}else if(s.length===2){r.show=!0,this.isTwoFingering=!0;const{separation:o}=this.fingerPolar(s);this.firstRatio=o/n.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=t.threeRenderer,this.threeRenderer.xr.enabled=!0}resolveARSession(){return b(this,null,function*(){Eo();const t=yield navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),yield this.threeRenderer.xr.setSession(t),this.threeRenderer.xr.cameraAutoUpdate=!1,t})}get presentedScene(){return this._presentedScene}supportsPresentation(){return b(this,null,function*(){try{return Eo(),yield navigator.xr.isSessionSupported("immersive-ar")}catch(t){return console.warn("Request to present in WebXR denied:"),console.warn(t),console.warn("Falling back to next ar-mode"),!1}})}present(t,e=!1){return b(this,null,function*(){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise((l,c)=>{requestAnimationFrame(()=>l())});t.setHotspotsVisibility(!1),t.queueRender(),yield i,this._presentedScene=t,this.overlay=t.element.shadowRoot.querySelector("div.default"),e===!0&&(this.xrLight=new Ag(this.threeRenderer),this.xrLight.addEventListener("estimationstart",()=>{if(!this.isPresenting||this.xrLight==null)return;const l=this.presentedScene;l.add(this.xrLight),l.environment=this.xrLight.environment}));const s=yield this.resolveARSession();s.addEventListener("end",()=>{this.postSessionCleanup()},{once:!0});const n=t.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const r=yield s.requestReferenceSpace("viewer");this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=t.yaw,this.goalYaw=t.yaw,this.goalScale=1,t.background=null,this.oldShadowIntensity=t.shadowIntensity,t.setShadowIntensity(.01),this.oldTarget.copy(t.getTarget()),t.element.addEventListener("load",this.onUpdateScene);const o=jg*Math.PI/180,A=this.placeOnWall===!0?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(o),z:-Math.cos(o)});s.requestHitTestSource({space:r,offsetRay:A}).then(l=>{this.initialHitSource=l}),this.currentSession=s,this.placementBox=new gA(t,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:ee.SESSION_STARTED})})}stopPresenting(){return b(this,null,function*(){if(!this.isPresenting)return;const t=new Promise(e=>{this.resolveCleanup=e});try{yield this.currentSession.end(),yield t}catch(e){console.warn("Error while trying to end WebXR AR session"),console.warn(e),this.postSessionCleanup()}})}get isPresenting(){return this.presentedScene!=null}get target(){return this.oldTarget}updateTarget(){const t=this.presentedScene;if(t!=null){const e=t.getTarget();this.oldTarget.copy(e),this.placeOnWall?e.z=t.boundingBox.min.z:e.y=t.boundingBox.min.y,t.setTarget(e.x,e.y,e.z)}}postSessionCleanup(){const t=this.currentSession;t!=null&&(t.removeEventListener("selectstart",this.onSelectStart),t.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const e=this.presentedScene;if(this._presentedScene=null,e!=null){const{element:r}=e;this.xrLight!=null&&(e.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),e.position.set(0,0,0),e.scale.set(1,1,1),e.setShadowOffset(0);const o=this.turntableRotation;o!=null&&(e.yaw=o);const A=this.oldShadowIntensity;A!=null&&e.setShadowIntensity(A),e.setEnvironmentAndSkybox(r[Ii],r[Ci]);const l=this.oldTarget;e.setTarget(l.x,l.y,l.z),e.xrCamera=null,e.element.removeEventListener("load",this.onUpdateScene),e.orientHotspots(0),r.requestUpdate("cameraTarget"),r.requestUpdate("maxCameraOrbit"),r[Oi](r.getBoundingClientRect()),requestAnimationFrame(()=>{e.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:K.NONE}}))})}this.renderer.height=0;const i=this.exitWebXRButtonContainer;i!=null&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;s!=null&&(s.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;n!=null&&(n.cancel(),this.initialHitSource=null),this.placementBox!=null&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,this.resolveCleanup!=null&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:ee.NOT_PRESENTING})}updateView(t){const e=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(ip),e.xrCamera=i.getCamera();const{elements:s}=e.getCamera().matrixWorld;if(e.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),t.requestViewportScale&&t.recommendedViewportScale){const r=t.recommendedViewportScale;t.requestViewportScale(Math.max(r,Xg))}const n=i.getBaseLayer();if(n!=null){const r=n instanceof XRWebGLLayer?n.getViewport(t):i.getBinding().getViewSubImage(n,t).viewport;this.threeRenderer.setViewport(r.x,r.y,r.width,r.height)}}placeInitially(){const t=this.presentedScene,{position:e,element:i}=t,s=t.getCamera(),{width:n,height:r}=this.overlay.getBoundingClientRect();t.setSize(n,r),s.projectionMatrixInverse.copy(s.projectionMatrix).invert();const{theta:o,radius:A}=i.getCameraOrbit(),l=s.getWorldDirection(Us);t.yaw=Math.atan2(-l.x,-l.z)-o,this.goalYaw=t.yaw,e.copy(s.position).add(l.multiplyScalar(A)),this.updateTarget();const c=t.getTarget();e.add(c).sub(this.oldTarget),this.goalPosition.copy(e),t.setHotspotsVisibility(!0);const{session:h}=this.frame;h.addEventListener("selectstart",this.onSelectStart),h.addEventListener("selectend",this.onSelectEnd),h.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(d=>{this.transientHitTestSource=d})}getTouchLocation(){const{axes:t}=this.inputSource.gamepad;let e=this.placementBox.getExpandedHit(this.presentedScene,t[0],t[1]);return e!=null&&(Us.copy(e).sub(this.presentedScene.getCamera().position),Us.length()>Zg)?null:e}getHitPoint(t){const e=this.threeRenderer.xr.getReferenceSpace(),i=t.getPose(e);if(i==null)return null;const s=tp.fromArray(i.transform.matrix);return this.placeOnWall===!0&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?ep.setFromMatrixPosition(s):null}moveToFloor(t){const e=this.initialHitSource;if(e==null)return;const i=t.getHitTestResults(e);if(i.length==0)return;const s=i[0],n=this.getHitPoint(s);n!=null&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),e.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:ee.OBJECT_PLACED}))}fingerPolar(t){const e=t[0].inputSource.gamepad.axes,i=t[1].inputSource.gamepad.axes,s=i[0]-e[0],n=i[1]-e[1],r=Math.atan2(n,s);let o=this.lastAngle-r;return o>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),this.lastAngle=r,{separation:Math.sqrt(s*s+n*n),deltaYaw:o}}processInput(t){const e=this.transientHitTestSource;if(e==null||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=t.getHitTestResultsForTransientInput(e),s=this.presentedScene,n=s.scale.x;if(this.isTwoFingering){if(i.length<2)this.isTwoFingering=!1;else{const{separation:r,deltaYaw:o}=this.fingerPolar(i);if(this.placeOnWall===!1&&(this.goalYaw+=o),s.canScale){const A=r/this.firstRatio;this.goalScale=A<il&&A>Wg?1:A}}return}else if(i.length===2){this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:r}=this.fingerPolar(i);this.firstRatio=r/n;return}if(this.isRotating){const r=this.inputSource.gamepad.axes[0]*el;this.goalYaw+=r-this.lastAngle,this.lastAngle=r}else this.isTranslating&&i.forEach(r=>{if(r.inputSource!==this.inputSource)return;let o=null;if(r.results.length>0&&(o=this.getHitPoint(r.results[0])),o==null&&(o=this.getTouchLocation()),o!=null){if(this.goalPosition.sub(this.lastDragPosition),this.placeOnWall===!1){const A=o.y-this.lastDragPosition.y;if(A<0){this.placementBox.offsetHeight=A/n,this.presentedScene.setShadowOffset(A);const l=Us.copy(s.getCamera().position),c=-A/(l.y-o.y);l.multiplyScalar(c),o.multiplyScalar(1-c).add(l)}}this.goalPosition.add(o),this.lastDragPosition.copy(o)}})}moveScene(t){const e=this.presentedScene,{position:i,yaw:s}=e,n=e.boundingSphere.radius,r=this.goalPosition,o=e.scale.x,A=this.placementBox;let l=K.NONE;if(!r.equals(i)||this.goalScale!==o){l=K.USER_INTERACTION;let{x:c,y:h,z:d}=i;c=this.xDamper.update(c,r.x,t,n),h=this.yDamper.update(h,r.y,t,n),d=this.zDamper.update(d,r.z,t,n),i.set(c,h,d);const u=this.scaleDamper.update(o,this.goalScale,t,1);if(e.scale.set(u,u,u),!this.isTranslating){const g=r.y-h;this.placementComplete&&this.placeOnWall===!1?(A.offsetHeight=g/u,e.setShadowOffset(g)):g===0&&(this.placementComplete=!0,A.show=!1,e.setShadowIntensity(zg))}}A.updateOpacity(t),e.updateTarget(t),e.yaw=this.yawDamper.update(s,this.goalYaw,t,Math.PI),e.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:l}}))}onWebXRFrame(t,e){this.frame=e,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),s=e.getViewerPose(i);s==null&&this.tracking===!0&&this.frames>Yg&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:Br.NOT_TRACKING}));const n=this.presentedScene;if(s==null||n==null||!n.element.loaded){this.threeRenderer.clear();return}this.tracking===!1&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:Br.TRACKING}));let r=!0;for(const o of s.views){if(this.updateView(o),r){this.moveToFloor(e),this.processInput(e);const A=t-this.lastTick;this.moveScene(A),this.renderer.preRender(n,t,A),this.lastTick=t,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),r=!1}}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class np{constructor(t){t.threeRenderer.debug={checkShaderErrors:!0},Promise.resolve().then(()=>{self.dispatchEvent(new CustomEvent("model-viewer-renderer-debug",{detail:{renderer:t,THREE:{ShaderMaterial:os,Texture:hi,Mesh:F,Scene:Kt,PlaneGeometry:Zi,OrthographicCamera:rs,WebGLRenderTarget:As}}}))})}addScene(t){self.dispatchEvent(new CustomEvent("model-viewer-scene-added-debug",{detail:{scene:t}}))}removeScene(t){self.dispatchEvent(new CustomEvent("model-viewer-scene-removed-debug",{detail:{scene:t}}))}}function rp(a){const t=new Map,e=new Map,i=a.clone();return sl(a,i,function(s,n){t.set(n,s),e.set(s,n)}),i.traverse(function(s){if(!s.isSkinnedMesh)return;const n=s,r=t.get(s),o=r.skeleton.bones;n.skeleton=r.skeleton.clone(),n.bindMatrix.copy(r.bindMatrix),n.skeleton.bones=o.map(function(A){return e.get(A)}),n.bind(n.skeleton,n.bindMatrix)}),i}function sl(a,t,e){e(a,t);for(let i=0;i<a.children.length;i++)sl(a.children[i],t.children[i],e)}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const nl=Symbol("prepared"),Ns=Symbol("prepare"),Mt=Symbol("preparedGLTF"),Gs=Symbol("clone");class ap{constructor(t){this[Mt]=t}static prepare(t){if(t.scene==null)throw new Error("Model does not have a scene");if(t[nl])return t;const e=this[Ns](t);return e[nl]=!0,e}static[Ns](t){const{scene:e}=t,i=[e];return Object.assign(Object.assign({},t),{scene:e,scenes:i})}get parser(){return this[Mt].parser}get animations(){return this[Mt].animations}get scene(){return this[Mt].scene}get scenes(){return this[Mt].scenes}get cameras(){return this[Mt].cameras}get asset(){return this[Mt].asset}get userData(){return this[Mt].userData}clone(){const t=this.constructor,e=this[Gs]();return new t(e)}dispose(){this.scenes.forEach(t=>{t.traverse(e=>{const i=e;!i.material||((Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{for(const n in s){const r=s[n];if(r instanceof hi){const o=r.source.data;o.close!=null&&o.close(),r.dispose()}}s.dispose()}),i.geometry.dispose())})})}[Gs](){const t=this[Mt],e=rp(this.scene);op(e,this.scene);const i=[e],s=t.userData?Object.assign({},t.userData):{};return Object.assign(Object.assign({},t),{scene:e,scenes:i,userData:s})}}const op=(a,t)=>{rl(a,t,(e,i)=>{i.userData.variantMaterials!==void 0&&(e.userData.variantMaterials=new Map(i.userData.variantMaterials)),i.userData.variantData!==void 0&&(e.userData.variantData=i.userData.variantData),i.userData.originalMaterial!==void 0&&(e.userData.originalMaterial=i.userData.originalMaterial)})},rl=(a,t,e)=>{e(a,t);for(let i=0;i<a.children.length;i++)rl(a.children[i],t.children[i],e)},al=Symbol("threeGLTF"),ol=Symbol("gltf"),Al=Symbol("gltfElementMap"),ll=Symbol("threeObjectMap"),hl=Symbol("parallelTraverseThreeScene"),cl=Symbol("correlateOriginalThreeGLTF"),ul=Symbol("correlateCloneThreeGLTF");class Wi{constructor(t,e,i,s){this[al]=t,this[ol]=e,this[Al]=s,this[ll]=i}static from(t,e){return e!=null?this[ul](t,e):this[cl](t)}static[cl](t){const e=t.parser.json,i=t.parser.associations,s=new Map,n={name:"Default"},r={type:"materials",index:-1};for(const o of i.keys())o instanceof is&&i.get(o)==null&&(r.index<0&&(e.materials==null&&(e.materials=[]),r.index=e.materials.length,e.materials.push(n)),o.name=n.name,i.set(o,{materials:r.index}));for(const[o,A]of i){if(A){const l=o;l.userData=l.userData||{},l.userData.associations=A}for(const l in A)if(l!=null&&l!=="primitives"){const c=l,h=(e[c]||[])[A[c]];if(h==null)continue;let d=s.get(h);d==null&&(d=new Set,s.set(h,d)),d.add(o)}}return new Wi(t,e,i,s)}static[ul](t,e){const i=e.threeGLTF,s=e.gltf,n=JSON.parse(JSON.stringify(s)),r=new Map,o=new Map;for(let A=0;A<i.scenes.length;A++)this[hl](i.scenes[A],t.scenes[A],(l,c)=>{const h=e.threeObjectMap.get(l);if(h!=null){for(const d in h)if(d!=null&&d!=="primitives"){const u=d,g=h[u],m=n[u][g],p=r.get(c)||{};p[u]=g,r.set(c,p);const f=o.get(m)||new Set;f.add(c),o.set(m,f)}}});return new Wi(t,n,r,o)}static[hl](t,e,i){const s=(n,r)=>{if(i(n,r),n.isObject3D){const o=n,A=r;if(o.material)if(Array.isArray(o.material))for(let l=0;l<o.material.length;++l)i(o.material[l],A.material[l]);else i(o.material,A.material);for(let l=0;l<n.children.length;++l)s(n.children[l],r.children[l])}};s(t,e)}get threeGLTF(){return this[al]}get gltf(){return this[ol]}get gltfElementMap(){return this[Al]}get threeObjectMap(){return this[ll]}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Li=Symbol("correlatedSceneGraph");class Ap extends ap{static[Ns](t){const e=super[Ns](t);e[Li]==null&&(e[Li]=Wi.from(e));const{scene:i}=e,s=new En(void 0,1/0);return i.traverse(n=>{n.renderOrder=1e3,n.frustumCulled=!1,n.name||(n.name=n.uuid);const r=n;if(r.material){const{geometry:o}=r;r.castShadow=!0,r.isSkinnedMesh&&(o.boundingSphere=s,o.boundingBox=null);const A=r.material;if(A.isMeshBasicMaterial===!0&&(A.toneMapped=!1),A.shadowSide=Bn,A.aoMap){const{gltf:l,threeObjectMap:c}=e[Li],h=c.get(A);if(l.materials!=null&&h!=null&&h.materials!=null){const d=l.materials[h.materials];d.occlusionTexture&&d.occlusionTexture.texCoord===0&&o.attributes.uv!=null&&o.setAttribute("uv2",o.attributes.uv)}}}}),e}get correlatedSceneGraph(){return this[Mt][Li]}[Gs](){const t=super[Gs](),e=new Map;return t.scene.traverse(i=>{const s=i;if(s.material){const n=s.material;if(n!=null){if(e.has(n.uuid)){s.material=e.get(n.uuid);return}s.material=n.clone(),e.set(n.uuid,s.material)}}}),t[Li]=Wi.from(t,this.correlatedSceneGraph),t}}class lp extends $c{constructor(t){super(t),this.type=xt}parse(t){const e=function(h,d){switch(h){case 1:console.error("THREE.RGBELoader Read Error: "+(d||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(d||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(d||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(d||""))}return-1},i=`
`,s=function(h,d,u){d=d||1024;let g=h.pos,m=-1,p=0,f="",I=String.fromCharCode.apply(null,new Uint16Array(h.subarray(g,g+128)));for(;0>(m=I.indexOf(i))&&p<d&&g<h.byteLength;)f+=I,p+=I.length,g+=128,I+=String.fromCharCode.apply(null,new Uint16Array(h.subarray(g,g+128)));return-1<m?(u!==!1&&(h.pos+=p+m+1),f+I.slice(0,m)):!1},n=function(h){const d=/^#\?(\S+)/,u=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,g=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,m=/^\s*FORMAT=(\S+)\s*$/,p=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,f={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let I,C;if(h.pos>=h.byteLength||!(I=s(h)))return e(1,"no header found");if(!(C=I.match(d)))return e(3,"bad initial token");for(f.valid|=1,f.programtype=C[1],f.string+=I+`
`;I=s(h),I!==!1;){if(f.string+=I+`
`,I.charAt(0)==="#"){f.comments+=I+`
`;continue}if((C=I.match(u))&&(f.gamma=parseFloat(C[1])),(C=I.match(g))&&(f.exposure=parseFloat(C[1])),(C=I.match(m))&&(f.valid|=2,f.format=C[1]),(C=I.match(p))&&(f.valid|=4,f.height=parseInt(C[1],10),f.width=parseInt(C[2],10)),f.valid&2&&f.valid&4)break}return f.valid&2?f.valid&4?f:e(3,"missing image size specifier"):e(3,"missing format specifier")},r=function(h,d,u){const g=d;if(g<8||g>32767||h[0]!==2||h[1]!==2||h[2]&128)return new Uint8Array(h);if(g!==(h[2]<<8|h[3]))return e(3,"wrong scanline width");const m=new Uint8Array(4*d*u);if(!m.length)return e(4,"unable to allocate buffer space");let p=0,f=0;const I=4*g,C=new Uint8Array(4),E=new Uint8Array(I);let B=u;for(;B>0&&f<h.byteLength;){if(f+4>h.byteLength)return e(1);if(C[0]=h[f++],C[1]=h[f++],C[2]=h[f++],C[3]=h[f++],C[0]!=2||C[1]!=2||(C[2]<<8|C[3])!=g)return e(3,"bad rgbe scanline format");let y=0,w;for(;y<I&&f<h.byteLength;){w=h[f++];const x=w>128;if(x&&(w-=128),w===0||y+w>I)return e(3,"bad scanline data");if(x){const S=h[f++];for(let _=0;_<w;_++)E[y++]=S}else E.set(h.subarray(f,f+w),y),y+=w,f+=w}const v=g;for(let x=0;x<v;x++){let S=0;m[p]=E[x+S],S+=g,m[p+1]=E[x+S],S+=g,m[p+2]=E[x+S],S+=g,m[p+3]=E[x+S],p+=4}B--}return m},o=function(h,d,u,g){const m=h[d+3],p=Math.pow(2,m-128)/255;u[g+0]=h[d+0]*p,u[g+1]=h[d+1]*p,u[g+2]=h[d+2]*p,u[g+3]=1},A=function(h,d,u,g){const m=h[d+3],p=Math.pow(2,m-128)/255;u[g+0]=us.toHalfFloat(Math.min(h[d+0]*p,65504)),u[g+1]=us.toHalfFloat(Math.min(h[d+1]*p,65504)),u[g+2]=us.toHalfFloat(Math.min(h[d+2]*p,65504)),u[g+3]=us.toHalfFloat(1)},l=new Uint8Array(t);l.pos=0;const c=n(l);if(c!==-1){const h=c.width,d=c.height,u=r(l.subarray(l.pos),h,d);if(u!==-1){let g,m,p;switch(this.type){case de:p=u.length/4;const f=new Float32Array(p*4);for(let C=0;C<p;C++)o(u,C*4,f,C*4);g=f,m=de;break;case xt:p=u.length/4;const I=new Uint16Array(p*4);for(let C=0;C<p;C++)A(u,C*4,I,C*4);g=I,m=xt;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:h,height:d,data:g,header:c.string,gamma:c.gamma,exposure:c.exposure,type:m}}}return null}setDataType(t){return this.type=t,this}load(t,e,i,s){function n(r,o){switch(r.type){case de:case xt:r.colorSpace=ts,r.minFilter=ce,r.magFilter=ce,r.generateMipmaps=!1,r.flipY=!0;break}e&&e(r,o)}return super.load(t,n,i,s)}}/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class hp extends Kt{constructor(){super(),this.position.y=-3.5;const t=new wn;t.deleteAttribute("uv");const e=new Re({metalness:0,side:ls}),i=new Re({metalness:0}),s=new In(16777215,500,28,2);s.position.set(.418,16.199,.3),this.add(s);const n=new F(t,e);n.position.set(-.757,13.219,.717),n.scale.set(31.713,28.305,28.591),this.add(n);const r=new F(t,i);r.position.set(-10.906,2.009,1.846),r.rotation.set(0,-.195,0),r.scale.set(2.328,7.905,4.651),this.add(r);const o=new F(t,i);o.position.set(-5.607,-.754,-.758),o.rotation.set(0,.994,0),o.scale.set(1.97,1.534,3.955),this.add(o);const A=new F(t,i);A.position.set(6.167,.857,7.803),A.rotation.set(0,.561,0),A.scale.set(3.927,6.285,3.687),this.add(A);const l=new F(t,i);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);const c=new F(t,i);c.position.set(2.291,-.756,-2.621),c.rotation.set(0,-.286,0),c.scale.set(1.546,1.552,1.496),this.add(c);const h=new F(t,i);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const d=new F(t,this.createAreaLightMaterial(50));d.position.set(-16.116,14.37,8.208),d.scale.set(.1,2.428,2.739),this.add(d);const u=new F(t,this.createAreaLightMaterial(50));u.position.set(-16.109,18.021,-8.207),u.scale.set(.1,2.425,2.751),this.add(u);const g=new F(t,this.createAreaLightMaterial(17));g.position.set(14.904,12.198,-1.832),g.scale.set(.15,4.265,6.331),this.add(g);const m=new F(t,this.createAreaLightMaterial(43));m.position.set(-.462,8.89,14.52),m.scale.set(4.38,5.441,.088),this.add(m);const p=new F(t,this.createAreaLightMaterial(20));p.position.set(3.235,11.486,-12.541),p.scale.set(2.5,2,.1),this.add(p);const f=new F(t,this.createAreaLightMaterial(100));f.position.set(0,20,0),f.scale.set(1,.1,1),this.add(f)}createAreaLightMaterial(t){const e=new kt;return e.color.setScalar(t),e}}/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class cp extends Kt{constructor(){super(),this.position.y=-3.5;const t=new wn;t.deleteAttribute("uv");const e=new Re({metalness:0,side:ls}),i=new Re({metalness:0}),s=new In(16777215,400,28,2);s.position.set(.5,14,.5),this.add(s);const n=new F(t,e);n.position.set(0,13.2,0),n.scale.set(31.5,28.5,31.5),this.add(n);const r=new F(t,i);r.position.set(-10.906,-1,1.846),r.rotation.set(0,-.195,0),r.scale.set(2.328,7.905,4.651),this.add(r);const o=new F(t,i);o.position.set(-5.607,-.754,-.758),o.rotation.set(0,.994,0),o.scale.set(1.97,1.534,3.955),this.add(o);const A=new F(t,i);A.position.set(6.167,-.16,7.803),A.rotation.set(0,.561,0),A.scale.set(3.927,6.285,3.687),this.add(A);const l=new F(t,i);l.position.set(-2.017,.018,6.124),l.rotation.set(0,.333,0),l.scale.set(2.002,4.566,2.064),this.add(l);const c=new F(t,i);c.position.set(2.291,-.756,-2.621),c.rotation.set(0,-.286,0),c.scale.set(1.546,1.552,1.496),this.add(c);const h=new F(t,i);h.position.set(-2.193,-.369,-5.547),h.rotation.set(0,.516,0),h.scale.set(3.875,3.487,2.986),this.add(h);const d=new F(t,this.createAreaLightMaterial(80));d.position.set(-14,10,8),d.scale.set(.1,2.5,2.5),this.add(d);const u=new F(t,this.createAreaLightMaterial(80));u.position.set(-14,14,-4),u.scale.set(.1,2.5,2.5),this.add(u);const g=new F(t,this.createAreaLightMaterial(23));g.position.set(14,12,0),g.scale.set(.1,5,5),this.add(g);const m=new F(t,this.createAreaLightMaterial(16));m.position.set(0,9,14),m.scale.set(5,5,.1),this.add(m);const p=new F(t,this.createAreaLightMaterial(80));p.position.set(7,8,-14),p.scale.set(2.5,2.5,.1),this.add(p);const f=new F(t,this.createAreaLightMaterial(80));f.position.set(-7,16,-14),f.scale.set(2.5,2.5,.1),this.add(f);const I=new F(t,this.createAreaLightMaterial(1));I.position.set(0,20,0),I.scale.set(.1,.1,.1),this.add(I)}createAreaLightMaterial(t){const e=new kt;return e.color.setScalar(t),e}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const up=.04,ze=20,dp=/\.hdr(\.js)?$/;class dl extends ci{constructor(t){super(),this.threeRenderer=t,this.lottieLoaderUrl="",this.withCredentials=!1,this._ldrLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}get ldrLoader(){return this._ldrLoader==null&&(this._ldrLoader=new Da),this._ldrLoader.setWithCredentials(this.withCredentials),this._ldrLoader}get hdrLoader(){return this._hdrLoader==null&&(this._hdrLoader=new lp,this._hdrLoader.setDataType(xt)),this._hdrLoader.setWithCredentials(this.withCredentials),this._hdrLoader}getLottieLoader(){return b(this,null,function*(){})}loadImage(t){return b(this,null,function*(){const e=yield new Promise((i,s)=>this.ldrLoader.load(t,i,()=>{},s));return e.name=t,e.flipY=!1,e})}loadLottie(t,e){return b(this,null,function*(){const i=yield this.getLottieLoader();i.setQuality(e);const s=yield new Promise((n,r)=>i.load(t,n,()=>{},r));return s.name=t,s})}loadEquirect(t,e=()=>{}){return b(this,null,function*(){try{const i=dp.test(t),s=i?this.hdrLoader:this.ldrLoader,n=yield new Promise((r,o)=>s.load(t,r,A=>{e(A.loaded/A.total*.9)},o));return e(1),n.name=t,n.mapping=kc,i||(n.encoding=yn),n}finally{e&&e(1)}})}generateEnvironmentMapAndSkybox(t=null,e=null,i=()=>{}){return b(this,null,function*(){const s=e!=="legacy";(e==="legacy"||e==="neutral")&&(e=null),e=Co(e);let n=Promise.resolve(null),r;t&&(n=this.loadEquirectFromUrl(t,i)),e?r=this.loadEquirectFromUrl(e,i):t?r=this.loadEquirectFromUrl(t,i):r=s?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,A]=yield Promise.all([r,n]);if(o==null)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:A}})}loadEquirectFromUrl(t,e){return b(this,null,function*(){if(!this.skyboxCache.has(t)){const i=this.loadEquirect(t,e);this.skyboxCache.set(t,i)}return this.skyboxCache.get(t)})}GenerateEnvironmentMap(t,e){return b(this,null,function*(){yield Lu();const i=this.threeRenderer,s=new Fa(256,{generateMipmaps:!1,type:xt,format:$t,colorSpace:ts,depthBuffer:!0}),n=new ka(.1,100,s),r=n.renderTarget.texture;r.name=e;const o=i.outputColorSpace,A=i.toneMapping;return i.toneMapping=La,i.outputColorSpace=ts,n.update(i,t),this.blurCubemap(s,up),i.toneMapping=A,i.outputColorSpace=o,r})}loadGeneratedEnvironmentMap(){return b(this,null,function*(){return this.generatedEnvironmentMap==null&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new hp,"legacy")),this.generatedEnvironmentMap})}loadGeneratedEnvironmentMapAlt(){return b(this,null,function*(){return this.generatedEnvironmentMapAlt==null&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new cp,"neutral")),this.generatedEnvironmentMapAlt})}blurCubemap(t,e){if(this.blurMaterial==null){this.blurMaterial=this.getBlurShader(ze);const s=new wn,n=new F(s,this.blurMaterial);this.blurScene=new Kt,this.blurScene.add(n)}const i=t.clone();this.halfblur(t,i,e,"latitudinal"),this.halfblur(i,t,e,"longitudinal")}halfblur(t,e,i,s){const n=t.width,r=isFinite(i)?Math.PI/(2*n):2*Math.PI/(2*ze-1),o=i/r,A=isFinite(i)?1+Math.floor(3*o):ze;A>ze&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${A} samples when the maximum is set to ${ze}`);const l=[];let c=0;for(let d=0;d<ze;++d){const u=d/o,g=Math.exp(-u*u/2);l.push(g),d==0?c+=g:d<A&&(c+=2*g)}for(let d=0;d<l.length;d++)l[d]=l[d]/c;const h=this.blurMaterial.uniforms;h.envMap.value=t.texture,h.samples.value=A,h.weights.value=l,h.latitudinal.value=s==="latitudinal",h.dTheta.value=r,new ka(.1,100,e).update(this.threeRenderer,this.blurScene)}getBlurShader(t){const e=new Float32Array(t),i=new R(0,1,0);return new os({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:i}},vertexShader:`
      
      varying vec3 vOutputDirection;
  
      void main() {
  
        vOutputDirection = vec3( position );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  
      }
    `,fragmentShader:`
        varying vec3 vOutputDirection;
  
        uniform samplerCube envMap;
        uniform int samples;
        uniform float weights[ n ];
        uniform bool latitudinal;
        uniform float dTheta;
        uniform vec3 poleAxis;
  
        vec3 getSample( float theta, vec3 axis ) {
  
          float cosTheta = cos( theta );
          // Rodrigues' axis-angle rotation
          vec3 sampleDirection = vOutputDirection * cosTheta
            + cross( axis, vOutputDirection ) * sin( theta )
            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );
  
          return vec3( textureCube( envMap, sampleDirection ) );
  
        }
  
        void main() {
  
          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );
  
          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {
  
            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );
  
          }
  
          axis = normalize( axis );
  
          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );
  
          for ( int i = 1; i < n; i++ ) {
  
            if ( i >= samples ) {
  
              break;
  
            }
  
            float theta = dTheta * float( i );
            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );
  
          }
        }
      `,blending:_c,depthTest:!1,depthWrite:!1,side:ls})}dispose(){return b(this,null,function*(){for(const[,t]of this.skyboxCache)(yield t).dispose();this.generatedEnvironmentMap!=null&&((yield this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),this.generatedEnvironmentMapAlt!=null&&((yield this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),this.blurMaterial!=null&&this.blurMaterial.dispose()})}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const gp=.2,yr=40,wr=60,gl=5,je=[1,.79,.62,.5,.4,.31,.25],pp=3,pl="high-performance";class Bt extends ci{constructor(t){super(),this.loader=new X(Ap),this.width=0,this.height=0,this.dpr=1,this.debugger=null,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=pp,this.avgFrameDuration=(wr+yr)/2,this.onWebGLContextLost=e=>{this.dispatchEvent({type:"contextlost",sourceEvent:e})},this.onWebGLContextRestored=()=>{var e;(e=this.textureUtils)===null||e===void 0||e.dispose(),this.textureUtils=new dl(this.threeRenderer);for(const i of this.scenes)i.element[Cs]()},this.dpr=Pn(),this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new fc({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:t.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.outputColorSpace=gt,this.threeRenderer.useLegacyLights=!1,this.threeRenderer.setPixelRatio(1),this.debugger=t.debug?new np(this):null,this.threeRenderer.debug={checkShaderErrors:!!this.debugger},this.threeRenderer.toneMapping=La}catch(e){console.warn(e)}this.arRenderer=new sp(this),this.textureUtils=this.canRender?new dl(this.threeRenderer):null,X.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}static get singleton(){return this._singleton}static resetSingleton(){const t=this._singleton.dispose();for(const e of t)e.disconnectedCallback();this._singleton=new Bt({powerPreference:(self.ModelViewerElement||{}).powerPreference||pl,debug:yo()});for(const e of t)e.connectedCallback()}get canRender(){return this.threeRenderer!=null}get scaleFactor(){return je[this.scaleStep]}set minScale(t){let e=1;for(;e<je.length&&!(je[e]<t);)++e;this.lastStep=e-1}registerScene(t){this.scenes.add(t),t.forceRescale();const e=new wt;this.threeRenderer.getSize(e),t.canvas.width=e.x,t.canvas.height=e.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop((i,s)=>this.render(i,s)),this.debugger!=null&&this.debugger.addScene(t)}unregisterScene(t){this.scenes.delete(t),this.canvas3D.parentElement===t.canvas.parentElement&&t.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&this.scenes.size===0&&this.threeRenderer.setAnimationLoop(null),this.debugger!=null&&this.debugger.removeScene(t)}displayCanvas(t){return this.multipleScenesVisible?t.element[jr]:this.canvas3D}countVisibleScenes(){const{canvas3D:t}=this;let e=0,i=null;for(const n of this.scenes){const{element:r}=n;r.modelIsVisible&&n.externalRenderer==null&&++e,t.parentElement===n.canvas.parentElement&&(i=n)}const s=e>1;if(i!=null){const n=s&&!this.multipleScenesVisible,r=!i.element.modelIsVisible;if(n||r){const{width:o,height:A}=this.sceneSize(i);this.copyPixels(i,o,A),t.parentElement.removeChild(t)}}this.multipleScenesVisible=s}updateRendererSize(){var t;const e=Pn();if(e!==this.dpr)for(const n of this.scenes){const{element:r}=n;r[ei](r.getBoundingClientRect())}let i=0,s=0;for(const n of this.scenes)i=Math.max(i,n.width),s=Math.max(s,n.height);if(!(i===this.width&&s===this.height&&e===this.dpr)){this.width=i,this.height=s,this.dpr=e,i=Math.ceil(i*e),s=Math.ceil(s*e),this.canRender&&this.threeRenderer.setSize(i,s,!1);for(const n of this.scenes){const{canvas:r}=n;r.width=i,r.height=s,n.forceRescale(),(t=n.effectRenderer)===null||t===void 0||t.setSize(i,s)}}}updateRendererScale(t){const e=this.scaleStep;this.avgFrameDuration+=St(gp*(t-this.avgFrameDuration),-gl,gl),this.avgFrameDuration>wr?++this.scaleStep:this.avgFrameDuration<yr&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),e!==this.scaleStep&&(this.avgFrameDuration=(wr+yr)/2)}shouldRender(t){if(t.shouldRender())t.scaleStep!=this.scaleStep&&(t.scaleStep=this.scaleStep,this.rescaleCanvas(t));else if(t.scaleStep!=0)t.scaleStep=0,this.rescaleCanvas(t);else return!1;return!0}rescaleCanvas(t){const e=je[t.scaleStep],i=Math.ceil(this.width/e),s=Math.ceil(this.height/e),{style:n}=t.canvas;n.width=`${i}px`,n.height=`${s}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${s}px`;const r=this.dpr*e,o=e<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";t.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:r,minimumDpr:this.dpr*je[this.lastStep],pixelWidth:Math.ceil(t.width*r),pixelHeight:Math.ceil(t.height*r),reason:o}}))}sceneSize(t){const{dpr:e}=this,i=je[t.scaleStep],s=Math.min(Math.ceil(t.width*i*e),this.canvas3D.width),n=Math.min(Math.ceil(t.height*i*e),this.canvas3D.height);return{width:s,height:n}}copyPixels(t,e,i){const s=t.context;if(s==null){console.log("could not acquire 2d context");return}s.clearRect(0,0,e,i),s.drawImage(this.canvas3D,0,0,e,i,0,0,e,i),t.canvas.classList.add("show")}orderedScenes(){const t=[];for(const e of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===e&&t.push(i);return t}get isPresenting(){return this.arRenderer.isPresenting}preRender(t,e,i){const{element:s,exposure:n}=t;s[Tt](e,i);const r=typeof n=="number"&&!Number.isNaN(n);this.threeRenderer.toneMappingExposure=r?n:1}render(t,e){if(e!=null){this.arRenderer.onWebXRFrame(t,e);return}const i=t-this.lastTick;if(this.lastTick=t,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:s}=this;for(const n of this.orderedScenes()){const{element:r}=n;if(!r.loaded||!r.modelIsVisible&&n.renderCount>0||(this.preRender(n,t,i),!this.shouldRender(n)))continue;if(n.externalRenderer!=null){const l=n.getCamera();l.updateMatrix();const{matrix:c,projectionMatrix:h}=l,d=c.elements.slice(),u=n.getTarget();d[12]+=u.x,d[13]+=u.y,d[14]+=u.z,n.externalRenderer.render({viewMatrix:d,projectionMatrix:h.elements});continue}if(!r.modelIsVisible&&!this.multipleScenesVisible)for(const l of this.scenes)l.element.modelIsVisible&&l.queueRender();const{width:o,height:A}=this.sceneSize(n);n.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-A,o,A),n.effectRenderer!=null?n.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.render(n,n.camera)),this.multipleScenesVisible||!n.element.modelIsVisible&&n.renderCount===0?this.copyPixels(n,o,A):s.parentElement!==n.canvas.parentElement&&(n.canvas.parentElement.appendChild(s),n.canvas.classList.remove("show")),n.hasRendered(),++n.renderCount,this.renderedLastFrame=!0}}dispose(){this.textureUtils!=null&&this.textureUtils.dispose(),this.threeRenderer!=null&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const t=[];for(const e of this.scenes)t.push(e.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),t}}Bt._singleton=new Bt({powerPreference:(self.ModelViewerElement||{}).powerPreference||pl,debug:yo()});/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Y=Symbol("correlatedObjects"),P=Symbol("sourceObject"),vt=Symbol("onUpdate");class Ti{constructor(t,e,i=null){this[vt]=t,this[P]=e,this[Y]=i}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const ml=new kt,mp=new Zi(2,2);let fp=0;const ie=Symbol("threeTexture");class Ip extends Ti{get[ie](){var t;return console.assert(this[Y]!=null&&this[Y].size>0,"Image correlated object is undefined"),(t=this[Y])===null||t===void 0?void 0:t.values().next().value}constructor(t,e,i){i=i??{name:e&&e.image&&e.image.src?e.image.src.split("/").pop():"adhoc_image",uri:e&&e.image&&e.image.src?e.image.src:"adhoc_image"+fp++},super(t,i,new Set(e?[e]:[]))}get name(){return this[P].name||""}get uri(){return this[P].uri}get bufferView(){return this[P].bufferView}get element(){const t=this[ie];if(t&&(t.isCanvasTexture||t.isVideoTexture))return t.image}get animation(){const t=this[ie];if(t&&t.isCanvasTexture&&t.animation)return t.animation}get type(){return this.uri!=null?"external":"embedded"}set name(t){this[P].name=t}update(){const t=this[ie];t&&t.isCanvasTexture&&!t.animation&&(this[ie].needsUpdate=!0,this[vt]())}createThumbnail(t,e){return b(this,null,function*(){const i=new Kt;ml.map=this[ie];const s=new F(mp,ml);i.add(s);const n=new rs(-1,1,1,-1,0,1),{threeRenderer:r}=Bt.singleton,o=new As(t,e);r.setRenderTarget(o),r.render(i,n),r.setRenderTarget(null);const A=new Uint8Array(t*e*4);r.readRenderTargetPixels(o,0,0,t,e,A),ne.width=t,ne.height=e;const l=ne.getContext("2d"),c=l.createImageData(t,e);return c.data.set(A),l.putImageData(c,0,0),new Promise((h,d)=>b(this,null,function*(){ne.toBlob(u=>{if(!u)return d("Failed to capture thumbnail.");h(URL.createObjectURL(u))},"image/png")}))})}}var It;(function(a){a[a.Nearest=9728]="Nearest",a[a.Linear=9729]="Linear",a[a.NearestMipmapNearest=9984]="NearestMipmapNearest",a[a.LinearMipmapNearest=9985]="LinearMipmapNearest",a[a.NearestMipmapLinear=9986]="NearestMipmapLinear",a[a.LinearMipmapLinear=9987]="LinearMipmapLinear"})(It||(It={}));var Ce;(function(a){a[a.ClampToEdge=33071]="ClampToEdge",a[a.MirroredRepeat=33648]="MirroredRepeat",a[a.Repeat=10497]="Repeat"})(Ce||(Ce={}));/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Cp=(()=>{const a=[It.Nearest,It.Linear,It.NearestMipmapNearest,It.LinearMipmapLinear,It.NearestMipmapLinear,It.LinearMipmapLinear];return t=>a.indexOf(t)>-1})(),Ep=(()=>{const a=[It.Nearest,It.Linear];return t=>a.indexOf(t)>-1})(),Bp=(()=>{const a=[Ce.ClampToEdge,Ce.MirroredRepeat,Ce.Repeat];return t=>a.indexOf(t)>-1})(),yp=(a,t)=>{switch(a){case"minFilter":return Cp(t);case"magFilter":return Ep(t);case"wrapS":case"wrapT":return Bp(t);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${a}" on Sampler`)}},Ps=Symbol("threeTexture"),fl=Symbol("threeTextures"),se=Symbol("setProperty"),We=Symbol("sourceSampler");class wp extends Ti{get[Ps](){var t;return console.assert(this[Y]!=null&&this[Y].size>0,"Sampler correlated object is undefined"),(t=this[Y])===null||t===void 0?void 0:t.values().next().value}get[fl](){return console.assert(this[Y]!=null&&this[Y].size>0,"Sampler correlated object is undefined"),this[Y]}get[We](){return console.assert(this[P]!=null,"Sampler source is undefined"),this[P]}constructor(t,e,i){i=i??{},i.minFilter==null&&(i.minFilter=e?e.minFilter:It.LinearMipmapLinear),i.magFilter==null&&(i.magFilter=e?e.magFilter:It.Linear),i.wrapS==null&&(i.wrapS=e?e.wrapS:Ce.Repeat),i.wrapT==null&&(i.wrapT=e?e.wrapT:Ce.Repeat),super(t,i,new Set(e?[e]:[]))}get name(){return this[P].name||""}get minFilter(){return this[We].minFilter}get magFilter(){return this[We].magFilter}get wrapS(){return this[We].wrapS}get wrapT(){return this[We].wrapT}get rotation(){return this[Ps].rotation}get scale(){return this[Ps].repeat}get offset(){return this[Ps].offset}setMinFilter(t){this[se]("minFilter",t)}setMagFilter(t){this[se]("magFilter",t)}setWrapS(t){this[se]("wrapS",t)}setWrapT(t){this[se]("wrapT",t)}setRotation(t){t==null&&(t=0),this[se]("rotation",t)}setScale(t){t==null&&(t=new wt(1,1)),this[se]("repeat",t)}setOffset(t){t==null&&(t=new wt(0,0)),this[se]("offset",t)}[se](t,e){const i=this[We];if(i!=null){if(yp(t,e)){t!=="rotation"&&t!=="repeat"&&t!=="offset"&&(i[t]=e);for(const s of this[fl])s[t]=e,s.needsUpdate=!0}this[vt]()}}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Il=Symbol("image"),Cl=Symbol("sampler");class El extends Ti{constructor(t,e,i=null,s=null,n=null){super(t,i||{},new Set(e?[e]:[])),this[Cl]=new wp(t,e,s),this[Il]=new Ip(t,e,n)}get name(){return this[P].name||""}set name(t){this[P].name=t}get sampler(){return this[Cl]}get source(){return this[Il]}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Bl,yl,wl;const Ee=Symbol("texture"),Be=Symbol("transform"),Qr=Symbol("materials"),Ql=Symbol("usage"),Xe=Symbol("onUpdate"),Di=Symbol("activeVideo");var Ct;(function(a){a[a.Base=0]="Base",a[a.MetallicRoughness=1]="MetallicRoughness",a[a.Normal=2]="Normal",a[a.Occlusion=3]="Occlusion",a[a.Emissive=4]="Emissive"})(Ct||(Ct={}));class Ri{constructor(t,e,i,s,n,r){if(this[Bl]=null,this[yl]={rotation:0,scale:new wt(1,1),offset:new wt(0,0)},this[wl]=!1,r&&i){const o=n.textures?n.textures[r.index]:null,A=o&&n.samplers?n.samplers[o.sampler]:null,l=o&&n.images?n.images[o.source]:null;this[Be].rotation=i.rotation,this[Be].scale.copy(i.repeat),this[Be].offset.copy(i.offset),this[Ee]=new El(t,i,o,A,l)}this[Xe]=t,this[Qr]=s,this[Ql]=e}get texture(){return this[Ee]}setTexture(t){var e,i;const s=t!=null?t.source[ie]:null,n=(e=this[Ee])===null||e===void 0?void 0:e.source[ie];if(n!=null&&n.isVideoTexture?this[Di]=!1:!((i=this[Ee])===null||i===void 0)&&i.source.animation&&this[Ee].source.animation.removeEventListener("enterFrame",this[Xe]),this[Ee]=t,s!=null&&s.isVideoTexture){const o=s.image;if(this[Di]=!0,o.requestVideoFrameCallback!=null){const A=()=>{!this[Di]||(this[Xe](),o.requestVideoFrameCallback(A))};o.requestVideoFrameCallback(A)}else{const A=()=>{!this[Di]||(this[Xe](),requestAnimationFrame(A))};requestAnimationFrame(A)}}else t?.source.animation!=null&&t.source.animation.addEventListener("enterFrame",this[Xe]);let r=yn;if(this[Qr])for(const o of this[Qr]){switch(this[Ql]){case Ct.Base:o.map=s;break;case Ct.MetallicRoughness:r=vn,o.metalnessMap=s,o.roughnessMap=s;break;case Ct.Normal:r=vn,o.normalMap=s;break;case Ct.Occlusion:r=vn,o.aoMap=s;break;case Ct.Emissive:o.emissiveMap=s;break}o.needsUpdate=!0}s&&(s.encoding=r,s.rotation=this[Be].rotation,s.repeat=this[Be].scale,s.offset=this[Be].offset),this[Xe]()}}Bl=Ee,yl=Be,wl=Di;/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Os=Symbol("threeMaterials"),vl=Symbol("baseColorTexture"),bl=Symbol("metallicRoughnessTexture");class Qp extends Ti{constructor(t,e,i,s){super(t,i,s),i.baseColorFactor==null&&(i.baseColorFactor=[1,1,1,1]),i.roughnessFactor==null&&(i.roughnessFactor=1),i.metallicFactor==null&&(i.metallicFactor=1);const{baseColorTexture:n,metallicRoughnessTexture:r}=i,{map:o,metalnessMap:A}=s.values().next().value;this[vl]=new Ri(t,Ct.Base,o,s,e,n||null),this[bl]=new Ri(t,Ct.MetallicRoughness,A,s,e,r||null)}get[Os](){return this[Y]}get baseColorFactor(){return this[P].baseColorFactor}get metallicFactor(){return this[P].metallicFactor}get roughnessFactor(){return this[P].roughnessFactor}get baseColorTexture(){return this[vl]}get metallicRoughnessTexture(){return this[bl]}setBaseColorFactor(t){const e=new yt;t instanceof Array?e.fromArray(t):e.set(t);for(const s of this[Os])s.color.set(e),t instanceof Array?s.opacity=t[3]:(t=[0,0,0,s.opacity],e.toArray(t));const i=this[P];i.baseColorFactor=t,this[vt]()}setMetallicFactor(t){for(const i of this[Os])i.metalness=t;const e=this[P];e.metallicFactor=t,this[vt]()}setRoughnessFactor(t){for(const i of this[Os])i.roughness=t;const e=this[P];e.roughnessFactor=t,this[vt]()}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var xl;const Sl=Symbol("pbrMetallicRoughness"),Ml=Symbol("normalTexture"),Ll=Symbol("occlusionTexture"),Tl=Symbol("emissiveTexture"),vp=Symbol("backingThreeMaterial"),vr=Symbol("applyAlphaCutoff"),ye=Symbol("lazyLoadGLTFInfo"),br=Symbol("initialize"),xr=Symbol("getLoadedMaterial"),ht=Symbol("ensureMaterialIsLoaded"),Dl=Symbol("gltfIndex"),Fi=Symbol("setActive"),Hs=Symbol("variantIndices"),Sr=Symbol("isActive"),qs=Symbol("variantSet"),Rl=Symbol("modelVariants");class Mr extends Ti{constructor(t,e,i,s,n,r,o,A=void 0){super(t,i,o),this[xl]=new Set,this[Dl]=s,this[Sr]=n,this[Rl]=r,A==null?this[br](e):this[ye]=A}get[(xl=qs,vp)](){return this[Y].values().next().value}[br](t){const e=this[vt],i=this[P],s=this[Y];i.extensions&&i.extensions.KHR_materials_pbrSpecularGlossiness&&console.warn(`Material ${i.name} uses a deprecated extension
          "KHR_materials_pbrSpecularGlossiness", please use
          "pbrMetallicRoughness" instead. Specular Glossiness materials are
          no longer supported; to convert to metal-rough, see 
          https://www.donmccurdy.com/2022/11/28/converting-gltf-pbr-materials-from-specgloss-to-metalrough/.`),i.pbrMetallicRoughness==null&&(i.pbrMetallicRoughness={}),this[Sl]=new Qp(e,t,i.pbrMetallicRoughness,s),i.emissiveFactor==null&&(i.emissiveFactor=[0,0,0]),i.doubleSided==null&&(i.doubleSided=!1),i.alphaMode==null&&(i.alphaMode="OPAQUE"),i.alphaCutoff==null&&(i.alphaCutoff=.5);const{normalTexture:n,occlusionTexture:r,emissiveTexture:o}=i,{normalMap:A,aoMap:l,emissiveMap:c}=s.values().next().value;this[Ml]=new Ri(e,Ct.Normal,A,s,t,n||null),this[Ll]=new Ri(e,Ct.Occlusion,l,s,t,r||null),this[Tl]=new Ri(e,Ct.Emissive,c,s,t,o||null)}[xr](){return b(this,null,function*(){if(this[ye]!=null){const{set:t,material:e}=yield this[ye].doLazyLoad();return this[Y]=t,this[br](this[ye].gltf),this[ye]=void 0,this.ensureLoaded=()=>b(this,null,function*(){}),e}return this[Y].values().next().value})}[ht](){if(this[ye]!=null)throw new Error(`Material "${this.name}" has not been loaded, call 'await
    myMaterial.ensureLoaded()' before using an unloaded material.`)}ensureLoaded(){return b(this,null,function*(){yield this[xr]()})}get isLoaded(){return this[ye]==null}get isActive(){return this[Sr]}[Fi](t){this[Sr]=t}get name(){return this[P].name}set name(t){const e=this[P];if(e!=null&&(e.name=t),this[Y]!=null)for(const i of this[Y])i.name=t}get pbrMetallicRoughness(){return this[ht](),this[Sl]}get normalTexture(){return this[ht](),this[Ml]}get occlusionTexture(){return this[ht](),this[Ll]}get emissiveTexture(){return this[ht](),this[Tl]}get emissiveFactor(){return this[ht](),this[P].emissiveFactor}get index(){return this[Dl]}[Hs](){return this[qs]}hasVariant(t){const e=this[Rl].get(t);return e!=null&&this[qs].has(e.index)}setEmissiveFactor(t){this[ht]();const e=new yt;t instanceof Array?e.fromArray(t):e.set(t);for(const i of this[Y])i.emissive.set(e);this[P].emissiveFactor=e.toArray(),this[vt]()}[vr](){this[ht]();const t=this[P];for(const e of this[Y])this[P].alphaMode==="MASK"?e.alphaTest=t.alphaCutoff:e.alphaTest=void 0,e.needsUpdate=!0}setAlphaCutoff(t){this[ht](),this[P].alphaCutoff=t,this[vr](),this[vt]()}getAlphaCutoff(){return this[ht](),this[P].alphaCutoff}setDoubleSided(t){this[ht]();for(const e of this[Y])e.side=t?Fe:Bn,e.needsUpdate=!0;this[P].doubleSided=t,this[vt]()}getDoubleSided(){return this[ht](),this[P].doubleSided}setAlphaMode(t){this[ht]();const e=(i,s)=>{i.transparent=s,i.depthWrite=!s};this[P].alphaMode=t;for(const i of this[Y])e(i,t==="BLEND"),this[vr](),i.needsUpdate=!0;this[vt]()}getAlphaMode(){return this[ht](),this[P].alphaMode}}class Fl{constructor(t){this.name="",this.children=[],this.name=t}}class Lr extends Fl{constructor(t,e,i,s){super(t.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=t;const{gltf:n,threeGLTF:r,threeObjectMap:o}=s;this.modelVariants=i,this.mesh.userData.variantData=i;const A=o.get(t.material);A.materials!=null?this.initialMaterialIdx=this.activeMaterialIdx=A.materials:console.error(`Primitive (${t.name}) missing initial material reference.`);const l=t.userData.associations||{};if(l.meshes==null){console.error("Mesh is missing primitive index association");return}const c=((n.meshes||[])[l.meshes].primitives||[])[l.primitives];if(c==null){console.error("Mesh primitive definition is missing.");return}if(c.material!=null)this.materials.set(c.material,e[c.material]);else{const h=e.findIndex(d=>d.name==="Default");h>=0?this.materials.set(h,e[h]):console.warn("gltfPrimitive has no material!")}if(c.extensions&&c.extensions.KHR_materials_variants){const h=c.extensions.KHR_materials_variants,d=r.parser.json.extensions.KHR_materials_variants.variants;for(const u of h.mappings){const g=e[u.material];this.materials.set(u.material,g);for(const m of u.variants){const{name:p}=d[m];this.variantToMaterialMap.set(m,g),g[Hs]().add(m),i.has(p)||i.set(p,{name:p,index:m})}}}}setActiveMaterial(t){return b(this,null,function*(){const e=this.materials.get(t);return e!=null&&(this.mesh.material=yield e[xr](),this.activeMaterialIdx=t),this.mesh.material})}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(t){return this.materials.get(t)}enableVariant(t){return b(this,null,function*(){if(t==null)return this.setActiveMaterial(this.initialMaterialIdx);if(this.variantToMaterialMap!=null&&this.modelVariants.has(t)){const e=this.modelVariants.get(t);return this.enableVariantHelper(e.index)}return null})}enableVariantHelper(t){return b(this,null,function*(){if(this.variantToMaterialMap!=null&&t!=null){const e=this.variantToMaterialMap.get(t);if(e!=null)return this.setActiveMaterial(e.index)}return null})}instantiateVariants(){return b(this,null,function*(){if(this.variantToMaterialMap!=null)for(const t of this.variantToMaterialMap.keys()){const e=this.mesh.userData.variantMaterials.get(t);if(e.material!=null)continue;const i=yield this.enableVariantHelper(t);i!=null&&(e.material=i)}})}get variantInfo(){return this.variantToMaterialMap}addVariant(t,e){if(!this.ensureVariantIsUnused(e))return!1;this.modelVariants.has(e)||this.modelVariants.set(e,{name:e,index:this.modelVariants.size});const i=this.modelVariants.get(e).index;return t[Hs]().add(i),this.variantToMaterialMap.set(i,t),this.materials.set(t.index,t),this.updateVariantUserData(i,t),!0}deleteVariant(t){if(this.variantInfo.has(t)){this.variantInfo.delete(t);const e=this.mesh.userData.variantMaterials;e?.delete(t)}}updateVariantUserData(t,e){e[Hs]().add(t),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map,this.mesh.userData.variantMaterials.set(t,{material:e[Y].values().next().value,gltfMaterialIndex:e.index})}ensureVariantIsUnused(t){const e=this.modelVariants.get(t);return e!=null&&this.variantInfo.has(e.index)?(console.warn(`Primitive cannot add variant '${t}' for this material, it already exists.`),!1):!0}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var kl,_l,Ul,Nl,Gl,Pl;const we=Symbol("materials"),Vs=Symbol("hierarchy"),Ol=Symbol("roots"),Ot=Symbol("primitives"),Tr=Symbol("correlatedSceneGraph"),Hl=Symbol("prepareVariantsForExport"),ql=Symbol("switchVariant"),Vl=Symbol("materialFromPoint"),Dr=Symbol("nodeFromPoint"),$l=Symbol("nodeFromIndex"),nt=Symbol("variantData"),Rr=Symbol("availableVariants"),Fr=Symbol("modelOnUpdate"),Jl=Symbol("cloneMaterial");class bp{constructor(t,e,i,s){this.gltf=t,this.gltfElementMap=e,this.mapKey=i,this.doLazyLoad=s}}class xp{constructor(t,e=()=>{}){this[kl]=[],this[_l]=[],this[Ul]=[],this[Nl]=[],this[Gl]=()=>{},this[Pl]=new Map,this[Fr]=e,this[Tr]=t;const{gltf:i,threeGLTF:s,gltfElementMap:n}=t;for(const[A,l]of i.materials.entries()){const c=n.get(l);if(c!=null)this[we].push(new Mr(e,i,l,A,!0,this[nt],c));else{const h=(i.materials||[])[A],d=A,u=()=>b(this,null,function*(){const g=yield s.parser.getDependency("material",d),m=new Set;return n.set(h,m),m.add(g),{set:m,material:g}});this[we].push(new Mr(e,i,h,A,!1,this[nt],c,new bp(i,n,h,u)))}}const r=new Map,o=[];for(const A of s.scene.children)o.push(A);for(;o.length>0;){const A=o.pop();let l=null;A instanceof F?(l=new Lr(A,this.materials,this[nt],t),this[Ot].push(l)):l=new Fl(A.name);const c=r.get(A);c!=null?c.children.push(l):this[Ol].push(l),this[Vs].push(l);for(const h of A.children)o.push(h),r.set(A,l)}}get materials(){return this[we]}[(kl=we,_l=Vs,Ul=Ol,Nl=Ot,Gl=Fr,Pl=nt,Rr)](){const t=Array.from(this[nt].values());return t.sort((e,i)=>e.index-i.index),t.map(e=>e.name)}getMaterialByName(t){const e=this[we].filter(i=>i.name===t);return e.length>0?e[0]:null}[$l](t,e){const i=this[Vs].find(s=>{if(s instanceof Lr){const{meshes:n,primitives:r}=s.mesh.userData.associations;if(n==t&&r==e)return!0}return!1});return i??null}[Dr](t){return this[Vs].find(e=>e instanceof Lr&&e.mesh===t.object)}[Vl](t){return this[Dr](t).getActiveMaterial()}[ql](t){return b(this,null,function*(){for(const e of this[Ot])yield e.enableVariant(t);for(const e of this.materials)e[Fi](!1);for(const e of this[Ot])this.materials[e.getActiveMaterial().index][Fi](!0)})}[Hl](){return b(this,null,function*(){const t=[];for(const e of this[Ot])t.push(e.instantiateVariants());yield Promise.all(t)})}[Jl](t,e){const i=this.materials[t];i.isLoaded||console.error(`Cloning an unloaded material,
           call 'material.ensureLoaded() before cloning the material.`);const s=i[Y],n=JSON.parse(JSON.stringify(i[P]));n.name=e,this[Tr].gltf.materials.push(n);const r=new Set;for(const[A,l]of s.entries()){const c=l.clone();c.name=e+(s.size>1?"_inst"+A:""),r.add(c)}const o=new Mr(this[Fr],this[Tr].gltf,n,this[we].length,!1,this[nt],r);return this[we].push(o),o}createMaterialInstanceForVariant(t,e,i,s=!0){let n=null;for(const r of this[Ot]){const o=this[nt].get(i);o!=null&&r.variantInfo.has(o.index)||r.getMaterial(t)!=null&&(this.hasVariant(i)||this.createVariant(i),n==null&&(n=this[Jl](t,e)),r.addVariant(n,i))}if(s&&n!=null){n[Fi](!0),this.materials[t][Fi](!1);for(const r of this[Ot])r.enableVariant(i)}return n}createVariant(t){this[nt].has(t)?console.warn(`Variant '${t}'' already exists`):this[nt].set(t,{name:t,index:this[nt].size})}hasVariant(t){return this[nt].has(t)}setMaterialToVariant(t,e){if(this[Rr]().find(i=>i===e)==null){console.warn(`Can't add material to '${e}', the variant does not exist.'`);return}if(t<0||t>=this.materials.length){console.error("setMaterialToVariant(): materialIndex is out of bounds.");return}for(const i of this[Ot]){const s=i.getMaterial(t);s!=null&&i.addVariant(s,e)}}updateVariantName(t,e){const i=this[nt].get(t);i!=null&&(i.name=e,this[nt].set(e,i),this[nt].delete(t))}deleteVariant(t){const e=this[nt].get(t);if(e!=null){for(const i of this.materials)i.hasVariant(t)&&i[qs].delete(e.index);for(const i of this[Ot])i.deleteVariant(e.index);this[nt].delete(t)}}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var kr=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};const $s=Symbol("currentGLTF"),Js=Symbol("originalGltfJson"),Qe=Symbol("model"),_r=Symbol("getOnUpdateMethod"),ki=Symbol("buildTexture"),Sp=a=>{var t,e,i;class s extends a{constructor(){super(...arguments),this[t]=void 0,this[e]=null,this[i]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Qe]}get availableVariants(){return this.model?this.model[Rr]():[]}get originalGltfJson(){return this[Js]}[(t=Qe,e=$s,i=Js,_r)](){return()=>{this[ct]()}}[ki](r){return r.encoding=yn,r.wrapS=De,r.wrapT=De,new El(this[_r](),r)}createTexture(r,o="image/png"){return b(this,null,function*(){const{textureUtils:A}=this[O],l=yield A.loadImage(r);return l.userData.mimeType=o,this[ki](l)})}createLottieTexture(r,o=1){return b(this,null,function*(){const{textureUtils:A}=this[O],l=yield A.loadLottie(r,o);return this[ki](l)})}createVideoTexture(r){const o=document.createElement("video");o.src=r,o.muted=!0,o.playsInline=!0,o.loop=!0,o.play();const A=new Uc(o);return this[ki](A)}createCanvasTexture(){const r=document.createElement("canvas"),o=new Nc(r);return this[ki](o)}updated(r){return b(this,null,function*(){if(xn(s.prototype,this,"updated").call(this,r),r.has("variantName")){const o=this[be].beginActivity();o(.1);const A=this[Qe],{variantName:l}=this;A!=null&&(yield A[ql](l),this[ct](),this.dispatchEvent(new CustomEvent("variant-applied"))),o(1)}if(r.has("orientation")||r.has("scale")){if(!this.loaded)return;const o=this[Q];o.applyTransform(),o.updateBoundingBox(),o.updateShadow(),this[O].arRenderer.onUpdateScene(),this[ct]()}})}[re](){super[re]();const{currentGLTF:r}=this[Q];if(r!=null){const{correlatedSceneGraph:o}=r;o!=null&&r!==this[$s]&&(this[Qe]=new xp(o,this[_r]()),this[Js]=JSON.parse(JSON.stringify(o.gltf))),"variants"in r.userData&&this.requestUpdate("variantName")}this[$s]=r}exportScene(r){return b(this,null,function*(){const o=this[Q];return new Promise((A,l)=>b(this,null,function*(){const c={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(c,r),c.animations=o.animations,c.truncateDrawRange=!0;const h=o.shadow;let d=!1;h!=null&&(d=h.visible,h.visible=!1),yield this[Qe][Hl](),new or().register(u=>new ag(u)).parse(o.model,u=>A(new Blob([c.binary?u:JSON.stringify(u)],{type:c.binary?"application/octet-stream":"application/json"})),()=>l("glTF export failed"),c),h!=null&&(h.visible=d)}))})}materialFromPoint(r,o){const A=this[Qe];if(A==null)return null;const l=this[Q],c=l.getNDC(r,o),h=l.hitFromPoint(c);return h==null||h.face==null?null:A[Vl](h)}}return kr([T({type:String,attribute:"variant-name"})],s.prototype,"variantName",void 0),kr([T({type:String,attribute:"orientation"})],s.prototype,"orientation",void 0),kr([T({type:String,attribute:"scale"})],s.prototype,"scale",void 0),s};/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Ks=new R,Ur=new R,Nr=new R,Ys=new dn,Kl=new Ma,Yl=new un;class zl extends Gd{constructor(t){super(document.createElement("div")),this.normal=new R(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=t.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(t.position),this.updateNormal(t.normal),this.surface=t.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){(!this.facingCamera||!this.initialized)&&this.updateVisibility(!0)}hide(){(this.facingCamera||!this.initialized)&&this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,this.referenceCount===0}updatePosition(t){if(t==null)return;const e=Xt(t)[0].terms;for(let i=0;i<3;++i)this.position.setComponent(i,Pt(e[i]).number);this.updateMatrixWorld()}updateNormal(t){if(t==null)return;const e=Xt(t)[0].terms;for(let i=0;i<3;++i)this.normal.setComponent(i,e[i].number)}updateSurface(t){if(!t&&this.initialized)return;const{mesh:e,tri:i,bary:s}=this;if(e==null||i==null||s==null)return;e.getVertexPosition(i.x,Ks),e.getVertexPosition(i.y,Ur),e.getVertexPosition(i.z,Nr),Ks.toArray(Ys.elements,0),Ur.toArray(Ys.elements,3),Nr.toArray(Ys.elements,6),this.position.copy(s).applyMatrix3(Ys);const n=this.parent;n.worldToLocal(e.localToWorld(this.position)),Kl.set(Ks,Ur,Nr),Kl.getNormal(this.normal).transformDirection(e.matrixWorld);const r=n.parent;Yl.setFromAxisAngle(Ks.set(0,1,0),-r.yaw),this.normal.applyQuaternion(Yl)}orient(t){this.pivot.style.transform=`rotate(${t}rad)`}updateVisibility(t){t?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;const i=e,s=i.dataset.visibilityAttribute;if(s!=null){const n=`data-${s}`;t?i.setAttribute(n,""):i.removeAttribute(n)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:t}}))}),this.initialized=!0}}const Mp={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},Lp={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};function jl(a,t,e){return(1-e)*a+e*t}/* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Wl=9,Tp=6,Gr=2,Dp=.3;class Rp extends ui{constructor(t,e,i){super(),this.camera=new rs,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new zc,this.horizontalBlurMaterial=new os(Mp),this.verticalBlurMaterial=new os(Lp),this.intensity=0,this.softness=1,this.boundingBox=new ge,this.size=new R,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:s}=this;s.rotation.x=Math.PI/2,s.left=-.5,s.right=.5,s.bottom=-.5,s.top=.5,this.add(s);const n=new Zi,r=new kt({opacity:1,transparent:!0,side:ls});this.floor=new F(n,r),this.floor.userData.shadow=!0,s.add(this.floor),this.blurPlane=new F(n),this.blurPlane.visible=!1,s.add(this.blurPlane),t.target.add(this),this.depthMaterial.onBeforeCompile=function(o){o.fragmentShader=o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(t,e,i)}setScene(t,e,i){const{boundingBox:s,size:n,rotation:r,position:o}=this;if(this.isAnimated=t.animationNames.length>0,this.boundingBox.copy(t.boundingBox),this.size.copy(t.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?Gr:1),this.boundingBox.getCenter(o),i==="back"){const{min:A,max:l}=s;[A.y,A.z]=[A.z,A.y],[l.y,l.z]=[l.z,l.y],[n.y,n.z]=[n.z,n.y],r.x=Math.PI/2,r.y=Math.PI}else r.x=0,r.y=0;if(this.isAnimated){const A=s.min.y,l=s.max.y;n.y=this.maxDimension,s.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=A,s.max.y=l,n.set(this.maxDimension,l-A,this.maxDimension)}i==="bottom"?o.y=s.min.y:o.z=s.min.y,this.setSoftness(e)}setSoftness(t){this.softness=t;const{size:e,camera:i}=this,s=this.isAnimated?Gr:1,n=s*Math.pow(2,Wl-t*(Wl-Tp));this.setMapSize(n);const r=e.y/2,o=e.y*s;i.near=0,i.far=jl(o,r,t),this.depthMaterial.opacity=1/t,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(t){const{size:e}=this;this.isAnimated&&(t*=Gr);const i=Math.floor(e.x>e.z?t:t*e.x/e.z),s=Math.floor(e.x>e.z?t*e.z/e.x:t),n=10,r=n+i,o=n+s;if(this.renderTarget!=null&&(this.renderTarget.width!==r||this.renderTarget.height!==o)&&(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),this.renderTarget==null){const A={format:$t};this.renderTarget=new As(r,o,A),this.renderTargetBlur=new As(r,o,A),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(e.x*(1+n/i),e.z*(1+n/s),1),this.needsUpdate=!0}setIntensity(t){this.intensity=t,t>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=t*jl(Dp,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(t){this.floor.position.z=-t+.001*this.maxDimension}render(t,e){e.overrideMaterial=this.depthMaterial;const i=t.getClearAlpha();t.setClearAlpha(0),this.floor.visible=!1;const s=t.xr.enabled;t.xr.enabled=!1;const n=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.render(e,this.camera),e.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(t),t.xr.enabled=s,t.setRenderTarget(n),t.setClearAlpha(i)}blurShadow(t){const{camera:e,horizontalBlurMaterial:i,verticalBlurMaterial:s,renderTarget:n,renderTargetBlur:r,blurPlane:o}=this;o.visible=!0,o.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,t.setRenderTarget(r),t.render(o,e),o.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,t.setRenderTarget(n),t.render(o,e),o.visible=!1}dispose(){this.renderTarget!=null&&this.renderTarget.dispose(),this.renderTargetBlur!=null&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Pr=100,Or=new R,Xl=new R,Zl=new R,Hr=new gc,Fp=new R,_i=new wt;class kp extends Kt{constructor({canvas:t,element:e,width:i,height:s}){super(),this.annotationRenderer=new Pd,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.camera=new Xi(45,1,.1,100),this.xrCamera=null,this.url=null,this.target=new ui,this.animationNames=[],this.boundingBox=new ge,this.boundingSphere=new En,this.size=new R,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.canScale=!0,this.isDirty=!1,this.goalTarget=new R,this.targetDamperX=new mt,this.targetDamperY=new mt,this.targetDamperZ=new mt,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.name="ModelScene",this.element=e,this.canvas=t,this.camera=new Xi(45,1,.1,100),this.camera.name="MainCamera",this.add(this.target),this.setSize(i,s),this.target.name="Target",this.mixer=new Jc(this.target);const{domElement:n}=this.annotationRenderer,{style:r}=n;r.display="none",r.pointerEvents="none",r.position="absolute",r.top="0",this.element.shadowRoot.querySelector(".default").appendChild(n),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return this.xrCamera!=null?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}setObject(t){return b(this,null,function*(){this.reset(),this._model=t,this.target.add(t),yield this.setupScene()})}setSource(t,e=()=>{}){return b(this,null,function*(){if(!t||t===this.url){e(1);return}if(this.reset(),this.url=t,this.externalRenderer!=null){const o=yield this.externalRenderer.load(e);this.boundingSphere.radius=o.framedRadius,this.idealAspect=o.fieldOfViewAspect;return}this.cancelPendingSourceChange!=null&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);let i;try{i=yield new Promise((o,A)=>b(this,null,function*(){this.cancelPendingSourceChange=()=>A();try{const l=yield this.element[O].loader.load(t,this.element,e);o(l)}catch(l){A(l)}}))}catch(o){if(o==null)return;throw o}this.cancelPendingSourceChange=null,this.reset(),this.url=t,this._currentGLTF=i,i!=null&&(this._model=i.scene,this.target.add(i.scene));const{animations:s}=i,n=new Map,r=[];for(const o of s)n.set(o.name,o),r.push(o.name);this.animations=s,this.animationsByName=n,this.animationNames=r,yield this.setupScene()})}setupScene(){return b(this,null,function*(){this.applyTransform(),this.updateBoundingBox(),yield this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity)})}reset(){this.url=null,this.renderCount=0,this.queueRender(),this.shadow!=null&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:t}=this;t!=null&&(t.removeFromParent(),this._model=null);const e=this._currentGLTF;e!=null&&(e.dispose(),this._currentGLTF=null),this.currentAnimationAction!=null&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),this.shadow!=null&&(this.shadow.dispose(),this.shadow=null),this.element[$s]=null,this.element[Js]=null,this.element[Qe]=null}get currentGLTF(){return this._currentGLTF}setSize(t,e){if(!(this.width===t&&this.height===e)){if(this.width=Math.max(t,1),this.height=Math.max(e,1),this.annotationRenderer.setSize(t,e),this.aspect=this.width/this.height,this.externalRenderer!=null){const i=Pn();this.externalRenderer.resize(t*i,e*i)}this.queueRender()}}markBakedShadow(t){t.userData.shadow=!0,this.bakedShadows.add(t)}unmarkBakedShadow(t){t.userData.shadow=!1,t.visible=!0,this.bakedShadows.delete(t),this.boundingBox.expandByObject(t)}findBakedShadows(t){const e=new ge;t.traverse(i=>{const s=i;if(!s.material||!s.material.transparent)return;e.setFromObject(s);const n=e.getSize(Fp),r=Math.min(n.x,n.y,n.z);Math.max(n.x,n.y,n.z)<Pr*r||this.markBakedShadow(s)})}checkBakedShadows(){const{min:t,max:e}=this.boundingBox,i=new ge;this.boundingBox.getSize(this.size);for(const s of this.bakedShadows)i.setFromObject(s),!(i.min.y<t.y+this.size.y/Pr&&i.min.x<=t.x&&i.max.x>=e.x&&i.min.z<=t.z&&i.max.z>=e.z)&&(i.min.z<t.z+this.size.z/Pr&&i.min.x<=t.x&&i.max.x>=e.x&&i.min.y<=t.y&&i.max.y>=e.y||this.unmarkBakedShadow(s))}applyTransform(){const{model:t}=this;if(t==null)return;const e=Xt(this.element.orientation)[0].terms,i=Pt(e[0]).number,s=Pt(e[1]).number,n=Pt(e[2]).number;t.quaternion.setFromEuler(new Ra(s,n,i,"YXZ"));const r=Xt(this.element.scale)[0].terms;t.scale.set(r[0].number,r[1].number,r[2].number)}updateBoundingBox(){const{model:t}=this;if(t==null)return;this.target.remove(t),this.findBakedShadows(t);const e=(i,s)=>i.expandByPoint(s);this.setBakedShadowVisibility(!1),this.boundingBox=ys(t,e,new ge),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach(i=>this.unmarkBakedShadow(i)),this.boundingBox=ys(t,e,new ge)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(t)}updateFraming(){return b(this,null,function*(){const{model:t}=this;if(t==null)return;this.target.remove(t),this.setBakedShadowVisibility(!1);const{center:e}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),yield this.element.updateComplete,e.copy(this.getTarget());const i=(n,r)=>Math.max(n,e.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(ys(t,i,0));const s=(n,r)=>{r.sub(e);const o=Math.sqrt(r.x*r.x+r.z*r.z);return Math.max(n,o/(this.idealCameraDistance()-Math.abs(r.y)))};this.idealAspect=ys(t,s,0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(t)})}setBakedShadowVisibility(t=this.shadowIntensity<=0){for(const e of this.bakedShadows)e.visible=t}idealCameraDistance(){const t=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(t)}adjustedFoV(t){const e=Math.tan(t/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(e)*180/Math.PI}getNDC(t,e){if(this.xrCamera!=null)_i.set(t/window.screen.width,e/window.screen.height);else{const i=this.element.getBoundingClientRect();_i.set((t-i.x)/this.width,(e-i.y)/this.height)}return _i.multiplyScalar(2).subScalar(1),_i.y*=-1,_i}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(t,e){this.element[O].arRenderer.presentedScene!==this&&(this.environment=t,this.background=e,this.queueRender())}setTarget(t,e,i){this.goalTarget.set(-t,-e,-i)}setTargetDamperDecayTime(t){this.targetDamperX.setDecayTime(t),this.targetDamperY.setDecayTime(t),this.targetDamperZ.setDecayTime(t)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(lA)}updateTarget(t){const e=this.goalTarget,i=this.target.position;if(e.equals(i))return!1;{const s=this.boundingSphere.radius/10;let{x:n,y:r,z:o}=i;return n=this.targetDamperX.update(n,e.x,t,s),r=this.targetDamperY.update(r,e.y,t,s),o=this.targetDamperZ.update(o,e.z,t,s),this.target.position.set(n,r,o),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(t,e){const{x:i,z:s}=this.position;this.yaw=Math.atan2(t-i,e-s)}get model(){return this._model}set yaw(t){this.rotation.y=t,this.queueRender()}get yaw(){return this.rotation.y}set animationTime(t){this.mixer.setTime(t),this.queueShadowRender()}get animationTime(){if(this.currentAnimationAction!=null){const t=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop===_a&&(t&1)===1?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(t){this.mixer.timeScale=t}get animationTimeScale(){return this.mixer.timeScale}get duration(){return this.currentAnimationAction!=null&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return this.currentAnimationAction!=null}playAnimation(t=null,e=0,i=Ua,s=1/0){if(this._currentGLTF==null)return;const{animations:n}=this;if(n==null||n.length===0)return;let r=null;if(t!=null&&(r=this.animationsByName.get(t),r==null)){const o=parseInt(t);!isNaN(o)&&o>=0&&o<n.length&&(r=n[o])}r==null&&(r=n[0]);try{const{currentAnimationAction:o}=this,A=this.mixer.clipAction(r,this);this.currentAnimationAction=A,this.element.paused?this.mixer.stopAllAction():(A.paused=!1,o!=null&&A!==o?A.crossFadeFrom(o,e,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),A.setLoop(i,s),A.enabled=!0,A.clampWhenFinished=!0,A.play()}catch(o){console.error(o)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(t){this.mixer.update(t),this.queueShadowRender()}subscribeMixerEvent(t,e){this.mixer.addEventListener(t,e)}updateShadow(){const t=this.shadow;if(t!=null){const e=this.element.arPlacement==="wall"?"back":"bottom";t.setScene(this,this.shadowSoftness,e),t.needsUpdate=!0}}renderShadow(t){const e=this.shadow;e!=null&&e.needsUpdate==!0&&(e.render(t,this),e.needsUpdate=!1)}queueShadowRender(){this.shadow!=null&&(this.shadow.needsUpdate=!0)}setShadowIntensity(t){if(this.shadowIntensity=t,this._currentGLTF!=null&&(this.setBakedShadowVisibility(),!(t<=0&&this.shadow==null))){if(this.shadow==null){const e=this.element.arPlacement==="wall"?"back":"bottom";this.shadow=new Rp(this,this.shadowSoftness,e)}this.shadow.setIntensity(t)}}setShadowSoftness(t){this.shadowSoftness=t;const e=this.shadow;e?.setSoftness(t)}setShadowOffset(t){const e=this.shadow;e?.setOffset(t)}hitFromPoint(t,e=this){return Hr.setFromCamera(t,this.getCamera()),Hr.intersectObject(e,!0).find(i=>i.object.visible&&!i.object.userData.shadow)}positionAndNormalFromPoint(t,e=this){var i;const s=this.hitFromPoint(t,e);if(s==null)return null;const n=s.point,r=s.face!=null?s.face.normal.clone().applyNormalMatrix(new dn().getNormalMatrix(s.object.matrixWorld)):Hr.ray.direction.clone().multiplyScalar(-1),o=(i=s.uv)!==null&&i!==void 0?i:null;return{position:n,normal:r,uv:o}}surfaceFromPoint(t,e=this){const i=this.element.model;if(i==null)return null;const s=this.hitFromPoint(t,e);if(s==null||s.face==null)return null;const n=i[Dr](s),{meshes:r,primitives:o}=n.mesh.userData.associations,A=new R,l=new R,c=new R,{a:h,b:d,c:u}=s.face,g=s.object;g.getVertexPosition(h,A),g.getVertexPosition(d,l),g.getVertexPosition(u,c);const m=new Ma(A,l,c),p=new R;return m.getBarycoord(g.worldToLocal(s.point),p),`${r} ${o} ${h} ${d} ${u} ${p.x.toFixed(3)} ${p.y.toFixed(3)} ${p.z.toFixed(3)}`}addHotspot(t){this.target.add(t),this.annotationRenderer.domElement.appendChild(t.element)}removeHotspot(t){this.target.remove(t)}forHotspots(t){const{children:e}=this.target;for(let i=0,s=e.length;i<s;i++){const n=e[i];n instanceof zl&&t(n)}}initializeSurface(t){if(t.surface!=null&&t.mesh==null){const e=Xt(t.surface)[0].terms;if(e.length!=8){console.warn(t.surface+" does not have exactly 8 numbers.");return}const i=this.element.model[$l](e[0].number,e[1].number),s=new R(e[2].number,e[3].number,e[4].number);if(i==null){console.warn(t.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");return}const n=i.mesh.geometry.attributes.position.count;if(s.x>=n||s.y>=n||s.z>=n){console.warn(t.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");return}const r=new R(e[5].number,e[6].number,e[7].number);t.mesh=i.mesh,t.tri=s,t.bary=r}}updateSurfaceHotspots(){const t=!this.element.paused;this.forHotspots(e=>{this.initializeSurface(e),e.updateSurface(t)})}updateHotspotsVisibility(t){this.forHotspots(e=>{Or.copy(t),Xl.setFromMatrixPosition(e.matrixWorld),Or.sub(Xl),Zl.copy(e.normal).transformDirection(this.target.matrixWorld),Or.dot(Zl)<0?e.hide():e.show()})}orientHotspots(t){this.forHotspots(e=>{e.orient(t)})}setHotspotsVisibility(t){this.forHotspots(e=>{e.visible=t})}updateSchema(t){var e;const{schemaElement:i,element:s}=this,{alt:n,poster:r,iosSrc:o}=s;if(t!=null){const A=[{"@type":"MediaObject",contentUrl:t,encodingFormat:((e=t.split(".").pop())===null||e===void 0?void 0:e.toLowerCase())==="gltf"?"model/gltf+json":"model/gltf-binary"}];o&&A.push({"@type":"MediaObject",contentUrl:o,encodingFormat:"model/vnd.usdz+zip"});const l={"@context":"http://schema.org/","@type":"3DModel",image:r??void 0,name:n??void 0,encoding:A};i.textContent=JSON.stringify(l),document.head.appendChild(i)}else i.parentElement!=null&&i.parentElement.removeChild(i)}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class _p extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(){const t={progress:0,completed:!1};return this.ongoingActivities.add(t),this.ongoingActivityCount===1&&this.announceTotalProgress(t,0),e=>{let i;return i=Math.max(St(e,0,1),t.progress),i!==t.progress&&this.announceTotalProgress(t,i),t.progress}}announceTotalProgress(t,e){let i=0,s=0;e==1&&(t.completed=!0);for(const o of this.ongoingActivities){const{progress:A}=o;i+=1-A,o.completed===!0&&s++}const n=t.progress;t.progress=e,this.totalProgress+=(e-n)*(1-this.totalProgress)/i;const r=s===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:r}})),s===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var zs=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},th,eh,ih,sh,nh,rh,ah,oh,Ah,lh,hh,ch,uh;const Up=10,Np=50,Gp=0,Pp=300,Op=150,ne=document.createElement("canvas"),qr=Symbol("fallbackResizeHandler"),dh=Symbol("defaultAriaLabel"),js=Symbol("resizeObserver"),Ze=Symbol("clearModelTimeout"),Vr=Symbol("onContextLost"),ti=Symbol("loaded"),$r=Symbol("status"),Jr=Symbol("onFocus"),Kr=Symbol("onBlur"),ei=Symbol("updateSize"),Ws=Symbol("intersectionObserver"),ve=Symbol("isElementInViewport"),Xs=Symbol("announceModelVisibility"),Ui=Symbol("ariaLabel"),Yr=Symbol("altDefaulted"),Ni=Symbol("statusElement"),zr=Symbol("updateStatus"),Gi=Symbol("loadedTime"),ii=Symbol("updateSource"),gh=Symbol("markLoaded"),Pi=Symbol("container"),Lt=Symbol("input"),jr=Symbol("canvas"),Q=Symbol("scene"),ct=Symbol("needsRender"),Tt=Symbol("tick"),re=Symbol("onModelLoad"),Oi=Symbol("onResize"),O=Symbol("renderer"),be=Symbol("progressTracker"),ph=Symbol("getLoaded"),xe=Symbol("getModelIsVisible"),si=Symbol("shouldAttemptPreload"),ae=a=>({x:a.x,y:a.y,z:a.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),Hp=a=>({u:a.x,v:a.y,toString(){return`${this.u} ${this.v}`}});class Hi extends pe{constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[th]=!1,this[eh]=!1,this[ih]=0,this[sh]="",this[nh]=null,this[rh]=Bo(()=>{const s=this.getBoundingClientRect();this[ei](s)},Np),this[ah]=Bo(s=>{const n=this.modelIsVisible;n!==s&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:n}}))},Gp),this[oh]=null,this[Ah]=null,this[lh]=new _p,this[hh]=()=>{this[Ni].textContent=this[$r]},this[ch]=()=>{this[Ni].textContent=""},this[uh]=s=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:s.sourceEvent}}))},this.attachShadow({mode:"open"});const t=this.shadowRoot;Ou(t),this[Pi]=t.querySelector(".container"),this[Lt]=t.querySelector(".userInput"),this[jr]=t.querySelector("canvas"),this[Ni]=t.querySelector("#status"),this[dh]=this[Lt].getAttribute("aria-label");let e,i;if(this.isConnected){const s=this.getBoundingClientRect();e=s.width,i=s.height}else e=Pp,i=Op;this[Q]=new kp({canvas:this[jr],element:this,width:e,height:i}),Promise.resolve().then(()=>{this[ei](this.getBoundingClientRect())}),Nn&&(this[js]=new ResizeObserver(s=>{if(!this[O].isPresenting)for(let n of s)n.target===this&&this[ei](n.contentRect)})),Gn?this[Ws]=new IntersectionObserver(s=>{for(let n of s)if(n.target===this){const r=this.modelIsVisible;this[ve]=n.isIntersecting,this[Xs](r),this[ve]&&!this.loaded&&this[ii]()}},{root:null,rootMargin:"0px",threshold:1e-5}):this[ve]=!0}static get is(){return"model-viewer"}static set modelCacheSize(t){X[Wt].evictionThreshold=t}static get modelCacheSize(){return X[Wt].evictionThreshold}static set minimumRenderScale(t){t>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),t<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Bt.singleton.minScale=t}static get minimumRenderScale(){return Bt.singleton.minScale}get loaded(){return this[ph]()}get[(th=ve,eh=ti,ih=Gi,sh=$r,nh=Ze,rh=qr,ah=Xs,oh=js,Ah=Ws,lh=be,O)](){return Bt.singleton}get modelIsVisible(){return this[xe]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),Nn?this[js].observe(this):self.addEventListener("resize",this[qr]),Gn&&this[Ws].observe(this),this.addEventListener("focus",this[Jr]),this.addEventListener("blur",this[Kr]);const t=this[O];t.addEventListener("contextlost",this[Vr]),t.registerScene(this[Q]),this[Ze]!=null&&(self.clearTimeout(this[Ze]),this[Ze]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),Nn?this[js].unobserve(this):self.removeEventListener("resize",this[qr]),Gn&&this[Ws].unobserve(this),this.removeEventListener("focus",this[Jr]),this.removeEventListener("blur",this[Kr]);const t=this[O];t.removeEventListener("contextlost",this[Vr]),t.unregisterScene(this[Q]),this[Ze]=self.setTimeout(()=>{this[Q].dispose(),this[Ze]=null},Up)}updated(t){super.updated(t),t.has("src")&&(this.src==null?(this[ti]=!1,this[Gi]=0,this[Q].reset()):this.src!==this[Q].url&&(this[ti]=!1,this[Gi]=0,this[ii]())),t.has("alt")&&this[Lt].setAttribute("aria-label",this[Ui]),t.has("withCredentials")&&(X.withCredentials=this.withCredentials,this[O].textureUtils.withCredentials=this.withCredentials),t.has("generateSchema")&&(this.generateSchema?this[Q].updateSchema(this.src):this[Q].updateSchema(null))}toDataURL(t,e){return this[O].displayCanvas(this[Q]).toDataURL(t,e)}toBlob(t){return b(this,null,function*(){const e=t?t.mimeType:void 0,i=t?t.qualityArgument:void 0,s=t?t.idealAspect:void 0,{width:n,height:r,idealAspect:o,aspect:A}=this[Q],{dpr:l,scaleFactor:c}=this[O];let h=n*c*l,d=r*c*l,u=0,g=0;if(s===!0)if(o>A){const m=d;d=Math.round(h/o),g=(m-d)/2}else{const m=h;h=Math.round(d*o),u=(m-h)/2}ne.width=h,ne.height=d;try{return new Promise((m,p)=>b(this,null,function*(){ne.getContext("2d").drawImage(this[O].displayCanvas(this[Q]),u,g,h,d,0,0,h,d),ne.toBlob(f=>{if(!f)return p(new Error("Unable to retrieve canvas blob"));m(f)},e,i)}))}finally{this[ei]({width:n,height:r})}})}registerEffectComposer(t){t.setRenderer(this[O].threeRenderer),t.setMainCamera(this[Q].getCamera()),t.setMainScene(this[Q]),this[Q].effectRenderer=t}unregisterEffectComposer(){this[Q].effectRenderer=null}registerRenderer(t){this[Q].externalRenderer=t}unregisterRenderer(){this[Q].externalRenderer=null}get[Ui](){return this[Yr]}get[Yr](){return this.alt==null||this.alt==="null"?this[dh]:this.alt}[ph](){return this[ti]}[xe](){return this.loaded&&this[ve]}[si](){return!!this.src&&this[ve]}[ei]({width:t,height:e}){t===0||e===0||(this[Pi].style.width=`${t}px`,this[Pi].style.height=`${e}px`,this[Oi]({width:t,height:e}))}[Tt](t,e){var i;(i=this[Q].effectRenderer)===null||i===void 0||i.beforeRender(t,e)}[gh](){this[ti]||(this[ti]=!0,this[Gi]=performance.now())}[ct](){this[Q].queueRender()}[re](){}[zr](t){this[$r]=t;const e=this.getRootNode();e!=null&&e.activeElement===this&&this[Ni].textContent!=t&&(this[Ni].textContent=t)}[(hh=Jr,ch=Kr,Oi)](t){this[Q].setSize(t.width,t.height)}[(uh=Vr,ii)](){return b(this,null,function*(){const t=this[Q];if(this.loaded||!this[si]()||this.src===t.url)return;this.generateSchema&&t.updateSchema(this.src),this[zr]("Loading"),t.stopAnimation();const e=this[be].beginActivity(),i=this.src;try{const s=t.setSource(i,r=>e(St(r,0,1)*.95)),n=this[Cs]();yield Promise.all([s,n]),this[gh](),this[re](),this.updateComplete.then(()=>{this.dispatchEvent(new CustomEvent("before-render"))}),yield new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),r()})})})}catch(s){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:s}}))}finally{e(1)}})}}zs([T({type:String})],Hi.prototype,"alt",void 0),zs([T({type:String})],Hi.prototype,"src",void 0),zs([T({type:Boolean,attribute:"with-credentials"})],Hi.prototype,"withCredentials",void 0),zs([T({type:Boolean,attribute:"generate-schema"})],Hi.prototype,"generateSchema",void 0);/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Wr=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};const mh=1e3,Zs=Symbol("changeAnimation"),Ht=Symbol("paused"),qp={repetitions:1/0,pingpong:!1},Vp=a=>{var t;class e extends a{constructor(...s){super(s),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[t]=!0,this[Q].subscribeMixerEvent("loop",n=>{const r=n.action._loopCount;this.dispatchEvent(new CustomEvent("loop",{detail:{count:r}}))}),this[Q].subscribeMixerEvent("finished",()=>{this[Ht]=!0,this.dispatchEvent(new CustomEvent("finished"))})}get availableAnimations(){return this.loaded?this[Q].animationNames:[]}get duration(){return this[Q].duration}get paused(){return this[Ht]}get currentTime(){return this[Q].animationTime}set currentTime(s){this[Q].animationTime=s,this[ct]()}get timeScale(){return this[Q].animationTimeScale}set timeScale(s){this[Q].animationTimeScale=s}pause(){this[Ht]||(this[Ht]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(s){this.availableAnimations.length>0&&(this[Ht]=!1,this[Zs](s),this.dispatchEvent(new CustomEvent("play")))}[(t=Ht,re)](){super[re](),this[Ht]=!0,this.animationName!=null&&this[Zs](),this.autoplay&&this.play()}[Tt](s,n){super[Tt](s,n),!(this[Ht]||!this[xe]()&&!this[O].isPresenting)&&(this[Q].updateAnimation(n/mh),this[ct]())}updated(s){super.updated(s),s.has("autoplay")&&this.autoplay&&this.play(),s.has("animationName")&&this[Zs]()}[Zs](s=qp){var n;const r=(n=s.repetitions)!==null&&n!==void 0?n:1/0,o=s.pingpong?_a:r===1?Gc:Ua;this[Q].playAnimation(this.animationName,this.animationCrossfadeDuration/mh,o,r),this[Ht]&&(this[Q].updateAnimation(0),this[ct]())}}return Wr([T({type:Boolean})],e.prototype,"autoplay",void 0),Wr([T({type:String,attribute:"animation-name"})],e.prototype,"animationName",void 0),Wr([T({type:Number,attribute:"animation-crossfade-duration"})],e.prototype,"animationCrossfadeDuration",void 0),e};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Se=Symbol("hotspotMap"),Xr=Symbol("mutationCallback"),qi=Symbol("observer"),Zr=Symbol("addHotspot"),fh=Symbol("removeHotspot"),ta=new Ft,$p=a=>{var t,e,i;class s extends a{constructor(){super(...arguments),this[t]=new Map,this[e]=r=>{r.forEach(o=>{(!(o instanceof MutationRecord)||o.type==="childList")&&(o.addedNodes.forEach(A=>{this[Zr](A)}),o.removedNodes.forEach(A=>{this[fh](A)}),this[ct]())})},this[i]=new MutationObserver(this[Xr])}connectedCallback(){super.connectedCallback();for(let o=0;o<this.children.length;++o)this[Zr](this.children[o]);const{ShadyDOM:r}=self;r==null?this[qi].observe(this,{childList:!0}):this[qi]=r.observeChildren(this,this[Xr])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:r}=self;r==null?this[qi].disconnect():r.unobserveChildren(this[qi])}[(t=Se,e=Xr,i=qi,Tt)](r,o){super[Tt](r,o);const A=this[Q],{annotationRenderer:l}=A,c=A.getCamera();A.shouldRender()&&(A.updateSurfaceHotspots(),A.updateHotspotsVisibility(c.position),l.domElement.style.display="",l.render(A,c))}updateHotspot(r){const o=this[Se].get(r.name);o!=null&&(o.updatePosition(r.position),o.updateNormal(r.normal),o.surface=r.surface,this[ct]())}queryHotspot(r){const o=this[Se].get(r);if(o==null)return null;const A=ae(o.position),l=ae(o.normal),c=o.facingCamera,h=this[Q],d=h.getCamera(),u=new R;u.setFromMatrixPosition(o.matrixWorld),u.project(d);const g=h.width/2,m=h.height/2;u.x=u.x*g+g,u.y=-(u.y*m)+m;const p=ae(new R(u.x,u.y,u.z));return!Number.isFinite(p.x)||!Number.isFinite(p.y)?null:{position:A,normal:l,canvasPosition:p,facingCamera:c}}positionAndNormalFromPoint(r,o){const A=this[Q],l=A.getNDC(r,o),c=A.positionAndNormalFromPoint(l);if(c==null)return null;ta.copy(A.target.matrixWorld).invert();const h=ae(c.position.applyMatrix4(ta)),d=ae(c.normal.transformDirection(ta));let u=null;return c.uv!=null&&(u=Hp(c.uv)),{position:h,normal:d,uv:u}}surfaceFromPoint(r,o){const A=this[Q],l=A.getNDC(r,o);return A.surfaceFromPoint(l)}[Zr](r){if(!(r instanceof HTMLElement&&r.slot.indexOf("hotspot")===0))return;let o=this[Se].get(r.slot);o!=null?o.increment():(o=new zl({name:r.slot,position:r.dataset.position,normal:r.dataset.normal,surface:r.dataset.surface}),this[Se].set(r.slot,o),this[Q].addHotspot(o)),this[Q].queueRender()}[fh](r){if(!(r instanceof HTMLElement))return;const o=this[Se].get(r.slot);!o||(o.decrement()&&(this[Q].removeHotspot(o),this[Se].delete(r.slot)),this[Q].queueRender())}}return s};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Ih=function(a){return URL.createObjectURL(new Blob([a],{type:"text/javascript"}))};try{URL.revokeObjectURL(Ih(""))}catch{Ih=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)}}var ot=Uint8Array,At=Uint16Array,ni=Uint32Array,ea=new ot([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ia=new ot([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ch=new ot([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Eh=function(a,t){for(var e=new At(31),i=0;i<31;++i)e[i]=t+=1<<a[i-1];for(var s=new ni(e[30]),i=1;i<30;++i)for(var n=e[i];n<e[i+1];++n)s[n]=n-e[i]<<5|i;return[e,s]},Bh=Eh(ea,2),Jp=Bh[0],sa=Bh[1];Jp[28]=258,sa[258]=28;for(var Kp=Eh(ia,0),yh=Kp[1],na=new At(32768),$=0;$<32768;++$){var oe=($&43690)>>>1|($&21845)<<1;oe=(oe&52428)>>>2|(oe&13107)<<2,oe=(oe&61680)>>>4|(oe&3855)<<4,na[$]=((oe&65280)>>>8|(oe&255)<<8)>>>1}for(var Vi=function(t,e,i){for(var s=t.length,n=0,r=new At(e);n<s;++n)++r[t[n]-1];var o=new At(e);for(n=0;n<e;++n)o[n]=o[n-1]+r[n-1]<<1;var A;if(i){A=new At(1<<e);var l=15-e;for(n=0;n<s;++n)if(t[n])for(var c=n<<4|t[n],h=e-t[n],d=o[t[n]-1]++<<h,u=d|(1<<h)-1;d<=u;++d)A[na[d]>>>l]=c}else for(A=new At(s),n=0;n<s;++n)t[n]&&(A[n]=na[o[t[n]-1]++]>>>15-t[n]);return A},Me=new ot(288),$=0;$<144;++$)Me[$]=8;for(var $=144;$<256;++$)Me[$]=9;for(var $=256;$<280;++$)Me[$]=7;for(var $=280;$<288;++$)Me[$]=8;for(var tn=new ot(32),$=0;$<32;++$)tn[$]=5;var Yp=Vi(Me,9,0),zp=Vi(tn,5,0),wh=function(a){return(a/8|0)+(a&7&&1)},Qh=function(a,t,e){(t==null||t<0)&&(t=0),(e==null||e>a.length)&&(e=a.length);var i=new(a instanceof At?At:a instanceof ni?ni:ot)(e-t);return i.set(a.subarray(t,e)),i},qt=function(a,t,e){e<<=t&7;var i=t/8|0;a[i]|=e,a[i+1]|=e>>>8},$i=function(a,t,e){e<<=t&7;var i=t/8|0;a[i]|=e,a[i+1]|=e>>>8,a[i+2]|=e>>>16},ra=function(a,t){for(var e=[],i=0;i<a.length;++i)a[i]&&e.push({s:i,f:a[i]});var s=e.length,n=e.slice();if(!s)return[oa,0];if(s==1){var r=new ot(e[0].s+1);return r[e[0].s]=1,[r,1]}e.sort(function(B,y){return B.f-y.f}),e.push({s:-1,f:25001});var o=e[0],A=e[1],l=0,c=1,h=2;for(e[0]={s:-1,f:o.f+A.f,l:o,r:A};c!=s-1;)o=e[e[l].f<e[h].f?l++:h++],A=e[l!=c&&e[l].f<e[h].f?l++:h++],e[c++]={s:-1,f:o.f+A.f,l:o,r:A};for(var d=n[0].s,i=1;i<s;++i)n[i].s>d&&(d=n[i].s);var u=new At(d+1),g=aa(e[c-1],u,0);if(g>t){var i=0,m=0,p=g-t,f=1<<p;for(n.sort(function(y,w){return u[w.s]-u[y.s]||y.f-w.f});i<s;++i){var I=n[i].s;if(u[I]>t)m+=f-(1<<g-u[I]),u[I]=t;else break}for(m>>>=p;m>0;){var C=n[i].s;u[C]<t?m-=1<<t-u[C]++-1:++i}for(;i>=0&&m;--i){var E=n[i].s;u[E]==t&&(--u[E],++m)}g=t}return[new ot(u),g]},aa=function(a,t,e){return a.s==-1?Math.max(aa(a.l,t,e+1),aa(a.r,t,e+1)):t[a.s]=e},vh=function(a){for(var t=a.length;t&&!a[--t];);for(var e=new At(++t),i=0,s=a[0],n=1,r=function(A){e[i++]=A},o=1;o<=t;++o)if(a[o]==s&&o!=t)++n;else{if(!s&&n>2){for(;n>138;n-=138)r(32754);n>2&&(r(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(r(s),--n;n>6;n-=6)r(8304);n>2&&(r(n-3<<5|8208),n=0)}for(;n--;)r(s);n=1,s=a[o]}return[e.subarray(0,i),t]},Ji=function(a,t){for(var e=0,i=0;i<t.length;++i)e+=a[i]*t[i];return e},en=function(a,t,e){var i=e.length,s=wh(t+2);a[s]=i&255,a[s+1]=i>>>8,a[s+2]=a[s]^255,a[s+3]=a[s+1]^255;for(var n=0;n<i;++n)a[s+n+4]=e[n];return(s+4+i)*8},bh=function(a,t,e,i,s,n,r,o,A,l,c){qt(t,c++,e),++s[256];for(var h=ra(s,15),d=h[0],u=h[1],g=ra(n,15),m=g[0],p=g[1],f=vh(d),I=f[0],C=f[1],E=vh(m),B=E[0],y=E[1],w=new At(19),v=0;v<I.length;++v)w[I[v]&31]++;for(var v=0;v<B.length;++v)w[B[v]&31]++;for(var x=ra(w,7),S=x[0],_=x[1],M=19;M>4&&!S[Ch[M-1]];--M);var V=l+5<<3,L=Ji(s,Me)+Ji(n,tn)+r,H=Ji(s,d)+Ji(n,m)+r+14+3*M+Ji(w,S)+(2*w[16]+3*w[17]+7*w[18]);if(V<=L&&V<=H)return en(t,c,a.subarray(A,A+l));var G,D,U,z;if(qt(t,c,1+(H<L)),c+=2,H<L){G=Vi(d,u,0),D=d,U=Vi(m,p,0),z=m;var it=Vi(S,_,0);qt(t,c,C-257),qt(t,c+5,y-1),qt(t,c+10,M-4),c+=14;for(var v=0;v<M;++v)qt(t,c+3*v,S[Ch[v]]);c+=3*M;for(var Z=[I,B],le=0;le<2;++le)for(var Te=Z[le],v=0;v<Te.length;++v){var bt=Te[v]&31;qt(t,c,it[bt]),c+=S[bt],bt>15&&(qt(t,c,Te[v]>>>5&127),c+=Te[v]>>>12)}}else G=Yp,D=Me,U=zp,z=tn;for(var v=0;v<o;++v)if(i[v]>255){var bt=i[v]>>>18&31;$i(t,c,G[bt+257]),c+=D[bt+257],bt>7&&(qt(t,c,i[v]>>>23&31),c+=ea[bt]);var dt=i[v]&31;$i(t,c,U[dt]),c+=z[dt],dt>3&&($i(t,c,i[v]>>>5&8191),c+=ia[dt])}else $i(t,c,G[i[v]]),c+=D[i[v]];return $i(t,c,G[256]),c+D[256]},jp=new ni([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),oa=new ot(0),Wp=function(a,t,e,i,s,n){var r=a.length,o=new ot(i+r+5*(1+Math.ceil(r/7e3))+s),A=o.subarray(i,o.length-s),l=0;if(!t||r<8)for(var c=0;c<=r;c+=65535){var h=c+65535;h<r?l=en(A,l,a.subarray(c,h)):(A[c]=n,l=en(A,l,a.subarray(c,r)))}else{for(var d=jp[t-1],u=d>>>13,g=d&8191,m=(1<<e)-1,p=new At(32768),f=new At(m+1),I=Math.ceil(e/3),C=2*I,E=function(cn){return(a[cn]^a[cn+1]<<I^a[cn+2]<<C)&m},B=new ni(25e3),y=new At(288),w=new At(32),v=0,x=0,c=0,S=0,_=0,M=0;c<r;++c){var V=E(c),L=c&32767,H=f[V];if(p[L]=H,f[V]=L,_<=c){var G=r-c;if((v>7e3||S>24576)&&G>423){l=bh(a,A,0,B,y,w,x,S,M,c-M,l),S=v=x=0,M=c;for(var D=0;D<286;++D)y[D]=0;for(var D=0;D<30;++D)w[D]=0}var U=2,z=0,it=g,Z=L-H&32767;if(G>2&&V==E(c-Z))for(var le=Math.min(u,G)-1,Te=Math.min(32767,c),bt=Math.min(258,G);Z<=Te&&--it&&L!=H;){if(a[c+U]==a[c+U-Z]){for(var dt=0;dt<bt&&a[c+dt]==a[c+dt-Z];++dt);if(dt>U){if(U=dt,z=Z,dt>le)break;for(var sc=Math.min(Z,dt-2),Qa=0,D=0;D<sc;++D){var hn=c-Z+D+32768&32767,nc=p[hn],va=hn-nc+32768&32767;va>Qa&&(Qa=va,H=hn)}}}L=H,H=p[L],Z+=L-H+32768&32767}if(z){B[S++]=268435456|sa[U]<<18|yh[z];var ba=sa[U]&31,xa=yh[z]&31;x+=ea[ba]+ia[xa],++y[257+ba],++w[xa],_=c+U,++v}else B[S++]=a[c],++y[a[c]]}}l=bh(a,A,n,B,y,w,x,S,M,c-M,l),!n&&l&7&&(l=en(A,l+1,oa))}return Qh(o,0,i+wh(l)+s)},Xp=function(){for(var a=new ni(256),t=0;t<256;++t){for(var e=t,i=9;--i;)e=(e&1&&3988292384)^e>>>1;a[t]=e}return a}(),Zp=function(){var a=-1;return{p:function(t){for(var e=a,i=0;i<t.length;++i)e=Xp[e&255^t[i]]^e>>>8;a=e},d:function(){return~a}}},tm=function(a,t,e,i,s){return Wp(a,t.level==null?6:t.level,t.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+t.mem,e,i,!s)},xh=function(a,t){var e={};for(var i in a)e[i]=a[i];for(var i in t)e[i]=t[i];return e},et=function(a,t,e){for(;e;++t)a[t]=e,e>>>=8};function em(a,t){return tm(a,t||{},0,0)}var Sh=function(a,t,e,i){for(var s in a){var n=a[s],r=t+s;n instanceof ot?e[r]=[n,i]:Array.isArray(n)?e[r]=[n[0],xh(i,n[1])]:Sh(n,r+"/",e,i)}},Mh=typeof TextEncoder<"u"&&new TextEncoder,im=typeof TextDecoder<"u"&&new TextDecoder,sm=0;try{im.decode(oa,{stream:!0}),sm=1}catch{}function sn(a,t){if(t){for(var e=new ot(a.length),i=0;i<a.length;++i)e[i]=a.charCodeAt(i);return e}if(Mh)return Mh.encode(a);for(var s=a.length,n=new ot(a.length+(a.length>>1)),r=0,o=function(h){n[r++]=h},i=0;i<s;++i){if(r+5>n.length){var A=new ot(r+8+(s-i<<1));A.set(n),n=A}var l=a.charCodeAt(i);l<128||t?o(l):l<2048?(o(192|l>>6),o(128|l&63)):l>55295&&l<57344?(l=65536+(l&1023<<10)|a.charCodeAt(++i)&1023,o(240|l>>18),o(128|l>>12&63),o(128|l>>6&63),o(128|l&63)):(o(224|l>>12),o(128|l>>6&63),o(128|l&63))}return Qh(n,0,r)}var Aa=function(a){var t=0;if(a)for(var e in a){var i=a[e].length;if(i>65535)throw"extra field too long";t+=i+4}return t},Lh=function(a,t,e,i,s,n,r,o){var A=i.length,l=e.extra,c=o&&o.length,h=Aa(l);et(a,t,r!=null?33639248:67324752),t+=4,r!=null&&(a[t++]=20,a[t++]=e.os),a[t]=20,t+=2,a[t++]=e.flag<<1|(n==null&&8),a[t++]=s&&8,a[t++]=e.compression&255,a[t++]=e.compression>>8;var d=new Date(e.mtime==null?Date.now():e.mtime),u=d.getFullYear()-1980;if(u<0||u>119)throw"date not in range 1980-2099";if(et(a,t,u<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),t+=4,n!=null&&(et(a,t,e.crc),et(a,t+4,n),et(a,t+8,e.size)),et(a,t+12,A),et(a,t+14,h),t+=16,r!=null&&(et(a,t,c),et(a,t+6,e.attrs),et(a,t+10,r),t+=14),a.set(i,t),t+=A,h)for(var g in l){var m=l[g],p=m.length;et(a,t,+g),et(a,t+2,p),a.set(m,t+4),t+=4+p}return c&&(a.set(o,t),t+=c),t},nm=function(a,t,e,i,s){et(a,t,101010256),et(a,t+8,e),et(a,t+10,e),et(a,t+12,i),et(a,t+16,s)};function rm(a,t){t||(t={});var e={},i=[];Sh(a,"",e,t);var s=0,n=0;for(var r in e){var o=e[r],A=o[0],l=o[1],c=l.level==0?0:8,h=sn(r),d=h.length,u=l.comment,g=u&&sn(u),m=g&&g.length,p=Aa(l.extra);if(d>65535)throw"filename too long";var f=c?em(A,l):A,I=f.length,C=Zp();C.p(A),i.push(xh(l,{size:A.length,crc:C.d(),c:f,f:h,m:g,u:d!=r.length||g&&u.length!=m,o:s,compression:c})),s+=30+d+p+I,n+=76+2*(d+p)+(m||0)+I}for(var E=new ot(n+22),B=s,y=n-s,w=0;w<i.length;++w){var h=i[w];Lh(E,h.o,h,h.f,h.u,h.c.length);var v=30+h.f.length+Aa(h.extra);E.set(h.c,h.o+v),Lh(E,s,h,h.f,h.u,h.c.length,h.o,h.m),s+=16+v+(h.m?h.m.length:0)}return nm(E,s,i.length,y,B),E}class am{parse(t){return b(this,arguments,function*(e,i={}){i=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}}},i);const s={},n="model.usda";s[n]=null;let r=Th();r+=Am(i);const o={},A={};e.traverseVisible(c=>{if(c.isMesh){const h=c.geometry,d=c.material;if(d.isMeshStandardMaterial){const u="geometries/Geometry_"+h.id+".usd";if(!(u in s)){const g=um(h);s[u]=hm(g)}d.uuid in o||(o[d.uuid]=d),r+=cm(c,h,d)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",c)}else c.isCamera&&(r+=Cm(c))}),r+=lm(),r+=fm(o,A),s[n]=sn(r),r=null;for(const c in A){const h=A[c],d=c.split("_")[1],u=h.format===1023,g=om(h.image,d,h.flipY),m=yield new Promise(p=>g.toBlob(p,u?"image/png":"image/jpeg",1));s[`textures/Texture_${c}.${u?"png":"jpg"}`]=new Uint8Array(yield m.arrayBuffer())}let l=0;for(const c in s){const h=s[c];l+=34+c.length;const d=l&63;if(d!==4){const u=64-d,g=new Uint8Array(u);s[c]=[h,{extra:{12345:g}}]}l=h.length}return rm(s,{level:0})})}}function om(a,t,e){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const i=document.createElement("canvas");i.width=a.width,i.height=a.height;const s=i.getContext("2d");if(e===!0&&(s.translate(0,i.height),s.scale(1,-1)),s.drawImage(a,0,0,i.width,i.height),t!==void 0){const n=parseInt(t,16),r=(n>>16&255)/255,o=(n>>8&255)/255,A=(n&255)/255,l=s.getImageData(0,0,i.width,i.height),c=l.data;for(let h=0;h<c.length;h+=4)c[h+0]=c[h+0]*r,c[h+1]=c[h+1]*o,c[h+2]=c[h+2]*A;s.putImageData(l,0,0)}return i}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const lt=7;function Th(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Three.js USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)

`}function Am(a){return`def Xform "Root"
{
    def Scope "Scenes" (
        kind = "sceneLibrary"
    )
    {
        def Xform "Scene" (
            customData = {
                bool preliminary_collidesWithEnvironment = 0
                string sceneName = "Scene"
            }
            sceneName = "Scene"
        )
        {
        token preliminary:anchoring:type = "${a.ar.anchoring.type}"
        token preliminary:planeAnchoring:alignment = "${a.ar.planeAnchoring.alignment}"

`}function lm(){return`
        }
    }
}

`}function hm(a){let t=Th();return t+=a,sn(t)}function cm(a,t,e){const i="Object_"+a.id,s=Dh(a.matrixWorld);return a.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",a),`def Xform "${i}" (
    prepend references = @./geometries/Geometry_${t.id}.usd@</Geometry>
)
{
    matrix4d xformOp:transform = ${s}
    uniform token[] xformOpOrder = ["xformOp:transform"]

    rel material:binding = </Materials/Material_${e.id}>
}

`}function Dh(a){const t=a.elements;return`( ${nn(t,0)}, ${nn(t,4)}, ${nn(t,8)}, ${nn(t,12)} )`}function nn(a,t){return`(${a[t+0]}, ${a[t+1]}, ${a[t+2]}, ${a[t+3]})`}function um(a){return`
def "Geometry"
{
  ${dm(a)}
}
`}function dm(a){const t="Geometry",e=a.attributes,i=e.position.count;return`
    def Mesh "${t}"
    {
        int[] faceVertexCounts = [${gm(a)}]
        int[] faceVertexIndices = [${pm(a)}]
        normal3f[] normals = [${Rh(e.normal,i)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${Rh(e.position,i)}]
        float2[] primvars:st = [${mm(e.uv,i)}] (
            interpolation = "vertex"
        )
        uniform token subdivisionScheme = "none"
    }
`}function gm(a){const t=a.index!==null?a.index.count:a.attributes.position.count;return Array(t/3).fill(3).join(", ")}function pm(a){const t=a.index,e=[];if(t!==null)for(let i=0;i<t.count;i++)e.push(t.getX(i));else{const i=a.attributes.position.count;for(let s=0;s<i;s++)e.push(s)}return e.join(", ")}function Rh(a,t){if(a===void 0)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const e=[];for(let i=0;i<a.count;i++){const s=a.getX(i),n=a.getY(i),r=a.getZ(i);e.push(`(${s.toPrecision(lt)}, ${n.toPrecision(lt)}, ${r.toPrecision(lt)})`)}return e.join(", ")}function mm(a,t){if(a===void 0)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const e=[];for(let i=0;i<a.count;i++){const s=a.getX(i),n=a.getY(i);e.push(`(${s.toPrecision(lt)}, ${1-n.toPrecision(lt)})`)}return e.join(", ")}function fm(a,t){const e=[];for(const i in a){const s=a[i];e.push(Im(s,t))}return`def "Materials"
{
${e.join("")}
}

`}function Im(a,t){const e="            ",i=[],s=[];function n(r,o,A){const l=r.id+(A?"_"+A.getHexString():""),c=r.format===1023;return t[l]=r,`
        def Shader "Transform2d_${o}" (
            sdrMetadata = {
                string role = "math"
            }
        )
        {
            uniform token info:id = "UsdTransform2d"
            float2 inputs:in.connect = </Materials/Material_${a.id}/uvReader_st.outputs:result>
            float2 inputs:scale = ${kh(r.repeat)}
            float2 inputs:translation = ${kh(r.offset)}
            float2 outputs:result
        }

        def Shader "Texture_${r.id}_${o}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/Texture_${l}.${c?"png":"jpg"}@
            float2 inputs:st.connect = </Materials/Material_${a.id}/Transform2d_${o}.outputs:result>
            token inputs:wrapS = "repeat"
            token inputs:wrapT = "repeat"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
            ${a.transparent||a.alphaTest>0?"float outputs:a":""}
        }`}return a.side===Fe&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",a),a.map!==null?(i.push(`${e}color3f inputs:diffuseColor.connect = </Materials/Material_${a.id}/Texture_${a.map.id}_diffuse.outputs:rgb>`),a.transparent?i.push(`${e}float inputs:opacity.connect = </Materials/Material_${a.id}/Texture_${a.map.id}_diffuse.outputs:a>`):a.alphaTest>0&&(i.push(`${e}float inputs:opacity.connect = </Materials/Material_${a.id}/Texture_${a.map.id}_diffuse.outputs:a>`),i.push(`${e}float inputs:opacityThreshold = ${a.alphaTest}`)),s.push(n(a.map,"diffuse",a.color))):i.push(`${e}color3f inputs:diffuseColor = ${Fh(a.color)}`),a.emissiveMap!==null?(i.push(`${e}color3f inputs:emissiveColor.connect = </Materials/Material_${a.id}/Texture_${a.emissiveMap.id}_emissive.outputs:rgb>`),s.push(n(a.emissiveMap,"emissive"))):a.emissive.getHex()>0&&i.push(`${e}color3f inputs:emissiveColor = ${Fh(a.emissive)}`),a.normalMap!==null&&(i.push(`${e}normal3f inputs:normal.connect = </Materials/Material_${a.id}/Texture_${a.normalMap.id}_normal.outputs:rgb>`),s.push(n(a.normalMap,"normal"))),a.aoMap!==null&&(i.push(`${e}float inputs:occlusion.connect = </Materials/Material_${a.id}/Texture_${a.aoMap.id}_occlusion.outputs:r>`),s.push(n(a.aoMap,"occlusion"))),a.roughnessMap!==null&&a.roughness===1?(i.push(`${e}float inputs:roughness.connect = </Materials/Material_${a.id}/Texture_${a.roughnessMap.id}_roughness.outputs:g>`),s.push(n(a.roughnessMap,"roughness"))):i.push(`${e}float inputs:roughness = ${a.roughness}`),a.metalnessMap!==null&&a.metalness===1?(i.push(`${e}float inputs:metallic.connect = </Materials/Material_${a.id}/Texture_${a.metalnessMap.id}_metallic.outputs:b>`),s.push(n(a.metalnessMap,"metallic"))):i.push(`${e}float inputs:metallic = ${a.metalness}`),a.alphaMap!==null?(i.push(`${e}float inputs:opacity.connect = </Materials/Material_${a.id}/Texture_${a.alphaMap.id}_opacity.outputs:r>`),i.push(`${e}float inputs:opacityThreshold = 0.0001`),s.push(n(a.alphaMap,"opacity"))):i.push(`${e}float inputs:opacity = ${a.opacity}`),a.isMeshPhysicalMaterial&&(i.push(`${e}float inputs:clearcoat = ${a.clearcoat}`),i.push(`${e}float inputs:clearcoatRoughness = ${a.clearcoatRoughness}`),i.push(`${e}float inputs:ior = ${a.ior}`)),`
    def Material "Material_${a.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${i.join(`
`)}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }

        token outputs:surface.connect = </Materials/Material_${a.id}/PreviewSurface.outputs:surface>
        token inputs:frame:stPrimvarName = "st"

        def Shader "uvReader_st"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            token inputs:varname.connect = </Materials/Material_${a.id}.inputs:frame:stPrimvarName>
            float2 inputs:fallback = (0.0, 0.0)
            float2 outputs:result
        }

${s.join(`
`)}

    }
`}function Fh(a){return`(${a.r}, ${a.g}, ${a.b})`}function kh(a){return`(${a.x}, ${a.y})`}function Cm(a){const t=a.name?a.name:"Camera_"+a.id,e=Dh(a.matrixWorld);return a.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",a),a.isOrthographicCamera?`def Camera "${t}"
		{
			matrix4d xformOp:transform = ${e}
			uniform token[] xformOpOrder = ["xformOp:transform"]
	
			float2 clippingRange = (${a.near.toPrecision(lt)}, ${a.far.toPrecision(lt)})
			float horizontalAperture = ${((Math.abs(a.left)+Math.abs(a.right))*10).toPrecision(lt)}
			float verticalAperture = ${((Math.abs(a.top)+Math.abs(a.bottom))*10).toPrecision(lt)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${t}"
		{
			matrix4d xformOp:transform = ${e}
			uniform token[] xformOpOrder = ["xformOp:transform"]
	
			float2 clippingRange = (${a.near.toPrecision(lt)}, ${a.far.toPrecision(lt)})
			float focalLength = ${a.getFocalLength().toPrecision(lt)}
			float focusDistance = ${a.focus.toPrecision(lt)}
			float horizontalAperture = ${a.getFilmWidth().toPrecision(lt)}
			token projection = "perspective"
			float verticalAperture = ${a.getFilmHeight().toPrecision(lt)}
		}
	
	`}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Em=a=>t=>{try{const e=Xt(t),i=(e.length?e[0].terms:[]).filter(n=>n&&n.type==="ident").map(n=>n.value).filter(n=>a.indexOf(n)>-1),s=new Set;for(const n of i)s.add(n);return s}catch{}return new Set};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var ri=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};let _h=!1,Uh=!1;const Nh="#model-viewer-no-ar-fallback",Bm=Em(["quick-look","scene-viewer","webxr","none"]),ym="webxr scene-viewer quick-look",Et={QUICK_LOOK:"quick-look",SCENE_VIEWER:"scene-viewer",WEBXR:"webxr",NONE:"none"},Vt=Symbol("arButtonContainer"),Gh=Symbol("enterARWithWebXR"),Ph=Symbol("openSceneViewer"),Oh=Symbol("openIOSARQuickLook"),wm=Symbol("canActivateAR"),rn=Symbol("arMode"),la=Symbol("arModes"),ai=Symbol("arAnchor"),an=Symbol("preload"),on=Symbol("onARButtonContainerClick"),ha=Symbol("onARStatus"),ca=Symbol("onARTracking"),ua=Symbol("onARTap"),Ki=Symbol("selectARMode"),da=Symbol("triggerLoad"),Qm=a=>{var t,e,i,s,n,r,o,A,l,c;class h extends a{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes=ym,this.iosSrc=null,this.xrEnvironment=!1,this[t]=!1,this[e]=this.shadowRoot.querySelector(".ar-button"),this[i]=document.createElement("a"),this[s]=new Set,this[n]=Et.NONE,this[r]=!1,this[o]=u=>{u.preventDefault(),this.activateAR()},this[A]=({status:u})=>{(u===ee.NOT_PRESENTING||this[O].arRenderer.presentedScene===this[Q])&&(this.setAttribute("ar-status",u),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:u}})),u===ee.NOT_PRESENTING?this.removeAttribute("ar-tracking"):u===ee.SESSION_STARTED&&this.setAttribute("ar-tracking",Br.TRACKING))},this[l]=({status:u})=>{this.setAttribute("ar-tracking",u),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:u}}))},this[c]=u=>{u.data=="_apple_ar_quicklook_button_tapped"&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[rn]!==Et.NONE}connectedCallback(){super.connectedCallback(),this[O].arRenderer.addEventListener("status",this[ha]),this.setAttribute("ar-status",ee.NOT_PRESENTING),this[O].arRenderer.addEventListener("tracking",this[ca]),this[ai].addEventListener("message",this[ua])}disconnectedCallback(){super.disconnectedCallback(),this[O].arRenderer.removeEventListener("status",this[ha]),this[O].arRenderer.removeEventListener("tracking",this[ca]),this[ai].removeEventListener("message",this[ua])}update(u){super.update(u),u.has("arScale")&&(this[Q].canScale=this.arScale!=="fixed"),u.has("arPlacement")&&(this[Q].updateShadow(),this[ct]()),u.has("arModes")&&(this[la]=Bm(this.arModes)),(u.has("ar")||u.has("arModes")||u.has("src")||u.has("iosSrc"))&&this[Ki]()}activateAR(){return b(this,null,function*(){switch(this[rn]){case Et.QUICK_LOOK:this[Oh]();break;case Et.WEBXR:yield this[Gh]();break;case Et.SCENE_VIEWER:this[Ph]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities");break}})}[(t=wm,e=Vt,i=ai,s=la,n=rn,r=an,o=on,A=ha,l=ca,c=ua,Ki)](){return b(this,null,function*(){let u=Et.NONE;if(this.ar){if(this.src!=null)for(const g of this[la]){if(g==="webxr"&&mo&&!_h&&(yield this[O].arRenderer.supportsPresentation())){u=Et.WEBXR;break}if(g==="scene-viewer"&&vu&&!Uh){u=Et.SCENE_VIEWER;break}if(g==="quick-look"&&Io){u=Et.QUICK_LOOK;break}}u===Et.NONE&&this.iosSrc!=null&&Io&&(u=Et.QUICK_LOOK)}if(u!==Et.NONE)this[Vt].classList.add("enabled"),this[Vt].addEventListener("click",this[on]);else if(this[Vt].classList.contains("enabled")){this[Vt].removeEventListener("click",this[on]),this[Vt].classList.remove("enabled");const g=ee.FAILED;this.setAttribute("ar-status",g),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:g}}))}this[rn]=u})}[Gh](){return b(this,null,function*(){console.log("Attempting to present in AR with WebXR..."),yield this[da]();try{this[Vt].removeEventListener("click",this[on]);const{arRenderer:u}=this[O];u.placeOnWall=this.arPlacement==="wall",yield u.present(this[Q],this.xrEnvironment)}catch(u){console.warn("Error while trying to present in AR with WebXR"),console.error(u),yield this[O].arRenderer.stopPresenting(),_h=!0,console.warn("Falling back to next ar-mode"),yield this[Ki](),this.activateAR()}finally{this[Ki]()}})}[da](){return b(this,null,function*(){this.loaded||(this[an]=!0,this[ii](),yield Tu(this,"load"),this[an]=!1)})}[si](){return super[si]()||this[an]}[Ph](){const u=self.location.toString(),g=new URL(u),m=new URL(this.src,u);m.hash&&(m.hash="");const p=new URLSearchParams(m.search);if(g.hash=Nh,p.set("mode","ar_preferred"),p.has("disable_occlusion")||p.set("disable_occlusion","true"),this.arScale==="fixed"&&p.set("resizable","false"),this.arPlacement==="wall"&&p.set("enable_vertical_placement","true"),p.has("sound")){const C=new URL(p.get("sound"),u);p.set("sound",C.toString())}if(p.has("link")){const C=new URL(p.get("link"),u);p.set("link",C.toString())}const f=`intent://arvr.google.com/scene-viewer/1.0?${p.toString()+"&file="+encodeURIComponent(m.toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(g.toString())};end;`,I=()=>{self.location.hash===Nh&&(Uh=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[Ki]())};self.addEventListener("hashchange",I,{once:!0}),this[ai].setAttribute("href",f),console.log("Attempting to present in AR with Scene Viewer..."),this[ai].click()}[Oh](){return b(this,null,function*(){const u=!this.iosSrc;this[Vt].classList.remove("enabled");const g=u?yield this.prepareUSDZ():this.iosSrc,m=new URL(g,self.location.toString());if(u){const I=self.location.toString(),C=new URL(I),E=new URL(this.src,C);E.hash&&(m.hash=E.hash)}this.arScale==="fixed"&&(m.hash&&(m.hash+="&"),m.hash+="allowsContentScaling=0");const p=this[ai];p.setAttribute("rel","ar");const f=document.createElement("img");p.appendChild(f),p.setAttribute("href",m.toString()),u&&p.setAttribute("download","model.usdz"),p.style.display="none",p.isConnected||this.shadowRoot.appendChild(p),console.log("Attempting to present in AR with Quick Look..."),p.click(),p.removeChild(f),u&&URL.revokeObjectURL(g),this[Vt].classList.add("enabled")})}prepareUSDZ(){return b(this,null,function*(){const u=this[be].beginActivity();yield this[da]();const{model:g,shadow:m}=this[Q];if(g==null)return"";let p=!1;m!=null&&(p=m.visible,m.visible=!1),u(.2);const f=yield new am().parse(g),I=new Blob([f],{type:"model/vnd.usdz+zip"}),C=URL.createObjectURL(I);return u(1),m!=null&&(m.visible=p),C})}}return ri([T({type:Boolean,attribute:"ar"})],h.prototype,"ar",void 0),ri([T({type:String,attribute:"ar-scale"})],h.prototype,"arScale",void 0),ri([T({type:String,attribute:"ar-placement"})],h.prototype,"arPlacement",void 0),ri([T({type:String,attribute:"ar-modes"})],h.prototype,"arModes",void 0),ri([T({type:String,attribute:"ios-src"})],h.prototype,"iosSrc",void 0),ri([T({type:Boolean,attribute:"xr-environment"})],h.prototype,"xrEnvironment",void 0),h};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var ga=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};const vm=100,bm="https://www.gstatic.com/draco/versioned/decoders/1.5.6/",xm="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/",Sm="https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js",pa={AUTO:"auto",MANUAL:"manual"},Hh={AUTO:"auto",LAZY:"lazy",EAGER:"eager"},Le=Symbol("defaultProgressBarElement"),ma=Symbol("posterContainerElement"),oi=Symbol("defaultPosterElement"),Yi=Symbol("shouldDismissPoster"),fa=Symbol("hidePoster"),An=Symbol("modelIsRevealed"),Ia=Symbol("updateProgressBar"),Mm=Symbol("ariaLabelCallToAction"),Ca=Symbol("onProgress"),Lm=a=>{var t,e,i,s,n,r,o,A;class l extends a{constructor(...h){super(...h),this.poster=null,this.reveal=pa.AUTO,this.loading=Hh.AUTO,this[t]=!1,this[e]=!1,this[i]=this.shadowRoot.querySelector(".slot.poster"),this[s]=this.shadowRoot.querySelector("#default-poster"),this[n]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[r]=this[oi].getAttribute("aria-label"),this[o]=Su(p=>{const f=this[Le].parentNode;requestAnimationFrame(()=>{this[Le].style.transform=`scaleX(${p})`,p===0&&(f.removeChild(this[Le]),f.appendChild(this[Le])),p===1?this[Le].classList.add("hide"):this[Le].classList.remove("hide")})},vm),this[A]=p=>{const f=p.detail.totalProgress;f===1&&(this[Ia].flush(),this.loaded&&(this[Yi]||this.reveal===pa.AUTO)&&this[fa]()),this[Ia](f),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:f}}))};const d=self.ModelViewerElement||{},u=d.dracoDecoderLocation||bm;X.setDRACODecoderLocation(u);const g=d.ktx2TranscoderLocation||xm;X.setKTX2TranscoderLocation(g),d.meshoptDecoderLocation&&X.setMeshoptDecoderLocation(d.meshoptDecoderLocation);const m=d.lottieLoaderLocation||Sm;Bt.singleton.textureUtils.lottieLoaderUrl=m}static set dracoDecoderLocation(h){X.setDRACODecoderLocation(h)}static get dracoDecoderLocation(){return X.getDRACODecoderLocation()}static set ktx2TranscoderLocation(h){X.setKTX2TranscoderLocation(h)}static get ktx2TranscoderLocation(){return X.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(h){X.setMeshoptDecoderLocation(h)}static get meshoptDecoderLocation(){return X.getMeshoptDecoderLocation()}static set lottieLoaderLocation(h){Bt.singleton.textureUtils.lottieLoaderUrl=h}static get lottieLoaderLocation(){return Bt.singleton.textureUtils.lottieLoaderUrl}static mapURLs(h){Bt.singleton.loader[fe].manager.setURLModifier(h)}dismissPoster(){this.loaded?this[fa]():(this[Yi]=!0,this[ii]())}showPoster(){const h=this[ma];if(h.classList.contains("show"))return;h.classList.add("show"),this[Lt].classList.remove("show");const d=this[oi];d.removeAttribute("tabindex"),d.removeAttribute("aria-hidden");const u=this.modelIsVisible;this[An]=!1,this[Xs](u)}getDimensions(){return ae(this[Q].size)}getBoundingBoxCenter(){return ae(this[Q].boundingBox.getCenter(new R))}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[be].addEventListener("progress",this[Ca])}disconnectedCallback(){super.disconnectedCallback(),this[be].removeEventListener("progress",this[Ca])}updated(h){return b(this,null,function*(){xn(l.prototype,this,"updated").call(this,h),h.has("poster")&&this.poster!=null&&(this[oi].style.backgroundImage=`url(${this.poster})`),h.has("alt")&&this[oi].setAttribute("aria-label",this[Yr]),(h.has("reveal")||h.has("loading"))&&this[ii]()})}[(t=An,e=Yi,i=ma,s=oi,n=Le,r=Mm,o=Ia,A=Ca,si)](){return!!this.src&&(this[Yi]||this.loading===Hh.EAGER||this.reveal===pa.AUTO&&this[ve])}[fa](){this[Yi]=!1;const h=this[ma];if(!h.classList.contains("show"))return;h.classList.remove("show"),this[Lt].classList.add("show");const d=this.modelIsVisible;this[An]=!0,this[Xs](d);const u=this.getRootNode();u&&u.activeElement===this&&this[Lt].focus();const g=this[oi];g.setAttribute("aria-hidden","true"),g.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[xe](){return super[xe]()&&this[An]}}return ga([T({type:String})],l.prototype,"poster",void 0),ga([T({type:String})],l.prototype,"reveal",void 0),ga([T({type:String})],l.prototype,"loading",void 0),l};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Ea=function(a,t,e,i){for(var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,r,o=a.length-1;o>=0;o--)(r=a[o])&&(n=(s<3?r(n):s>3?r(t,e,n):r(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};const Tm=Math.PI/32,Dm=3e3,Rm={basis:[vs(st(Tm,"rad"))],keywords:{auto:[null]}},Ai=Symbol("autoRotateStartTime"),Ba=Symbol("radiansPerSecond"),qh=Symbol("syncRotationRate"),ya=Symbol("onCameraChange"),Fm=a=>{var t,e,i;class s extends a{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=Dm,this.rotationPerSecond="auto",this[t]=performance.now(),this[e]=0,this[i]=r=>{!this.autoRotate||r.detail.source==="user-interaction"&&(this[Ai]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[ya]),this[Ai]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[ya]),this[Ai]=performance.now()}updated(r){super.updated(r),r.has("autoRotate")&&(this[Ai]=performance.now())}[(t=Ai,e=Ba,qh)](r){this[Ba]=r[0]}[Tt](r,o){if(super[Tt](r,o),!this.autoRotate||!this[xe]()||this[O].isPresenting)return;const A=Math.min(o,r-this[Ai]-this.autoRotateDelay);A>0&&(this[Q].yaw=this.turntableRotation+this[Ba]*A*.001)}get turntableRotation(){return this[Q].yaw}resetTurntableRotation(r=0){this[Q].yaw=r}}return i=ya,Ea([T({type:Boolean,attribute:"auto-rotate"})],s.prototype,"autoRotate",void 0),Ea([T({type:Number,attribute:"auto-rotate-delay"})],s.prototype,"autoRotateDelay",void 0),Ea([te({intrinsics:Rm,updateHandler:qh}),T({type:String,attribute:"rotation-per-second"})],s.prototype,"rotationPerSecond",void 0),s};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Vh=$p(Sp(Fm(_u(qg(Qm(Lm(Vp(Hi))))))));customElements.define("model-viewer",Vh);var km=(a,t,e)=>new Promise((i,s)=>{var n=A=>{try{o(e.next(A))}catch(l){s(l)}},r=A=>{try{o(e.throw(A))}catch(l){s(l)}},o=A=>A.done?i(A.value):Promise.resolve(A.value).then(n,r);o((e=e.apply(a,t)).next())});class _m{parse(t){return km(this,arguments,function*(e,i={}){i=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},quickLookCompatible:!1},i);const s={},n="model.usda";s[n]=null;let r=$h();r+=Nm(i);const o={},A={};e.traverseVisible(c=>{if(c.isMesh){const h=c.geometry,d=c.material;if(d.isMeshStandardMaterial){const u="geometries/Geometry_"+h.id+".usda";if(!(u in s)){const g=Hm(h);s[u]=Pm(g)}d.uuid in o||(o[d.uuid]=d),r+=Om(c,h,d)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",c)}else c.isCamera&&(r+=Wm(c))}),r+=Gm(),r+=Ym(o,A,i.quickLookCompatible),s[n]=bn.strToU8(r),r=null;for(const c in A){const h=A[c],d=Um(h.image,h.flipY),u=yield new Promise(g=>d.toBlob(g,"image/png",1));s[`textures/Texture_${c}.png`]=new Uint8Array(yield u.arrayBuffer())}let l=0;for(const c in s){const h=s[c];l+=34+c.length;const d=l&63;if(d!==4){const u=64-d,g=new Uint8Array(u);s[c]=[h,{extra:{12345:g}}]}l=h.length}return bn.zipSync(s,{level:0})})}}function Um(a,t){if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&a instanceof ImageBitmap){const e=document.createElement("canvas");e.width=a.width,e.height=a.height;const i=e.getContext("2d");return t===!0&&(i.translate(0,e.height),i.scale(1,-1)),i.drawImage(a,0,0,e.width,e.height),e}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const rt=7;function $h(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function Nm(a){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{
		token preliminary:anchoring:type = "${a.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${a.ar.planeAnchoring.alignment}"

`}function Gm(){return`
		}
	}
}

`}function Pm(a){let t=$h();return t+=a,bn.strToU8(t)}function Om(a,t,e){const i="Object_"+a.id,s=Jh(a.matrixWorld);return a.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",a),`def Xform "${i}" (
	prepend references = @./geometries/Geometry_${t.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${s}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${e.id}>
}

`}function Jh(a){const t=a.elements;return`( ${ln(t,0)}, ${ln(t,4)}, ${ln(t,8)}, ${ln(t,12)} )`}function ln(a,t){return`(${a[t+0]}, ${a[t+1]}, ${a[t+2]}, ${a[t+3]})`}function Hm(a){return`
def "Geometry"
{
${qm(a)}
}
`}function qm(a){const t="Geometry",e=a.attributes,i=e.position.count;return`
	def Mesh "${t}"
	{
		int[] faceVertexCounts = [${Vm(a)}]
		int[] faceVertexIndices = [${$m(a)}]
		normal3f[] normals = [${Kh(e.normal,i)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${Kh(e.position,i)}]
${Km(e,i)}
		uniform token subdivisionScheme = "none"
	}
`}function Vm(a){const t=a.index!==null?a.index.count:a.attributes.position.count;return Array(t/3).fill(3).join(", ")}function $m(a){const t=a.index,e=[];if(t!==null)for(let i=0;i<t.count;i++)e.push(t.getX(i));else{const i=a.attributes.position.count;for(let s=0;s<i;s++)e.push(s)}return e.join(", ")}function Kh(a,t){if(a===void 0)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");const e=[];for(let i=0;i<a.count;i++){const s=a.getX(i),n=a.getY(i),r=a.getZ(i);e.push(`(${s.toPrecision(rt)}, ${n.toPrecision(rt)}, ${r.toPrecision(rt)})`)}return e.join(", ")}function Jm(a,t){if(a===void 0)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");const e=[];for(let i=0;i<a.count;i++){const s=a.getX(i),n=a.getY(i);e.push(`(${s.toPrecision(rt)}, ${1-n.toPrecision(rt)})`)}return e.join(", ")}function Km(a,t){let e="";for(let i=0;i<4;i++){const s=i>0?i:"",n=a["uv"+s];n!==void 0&&(e+=`
		texCoord2f[] primvars:st${s} = [${Jm(n,t)}] (
			interpolation = "vertex"
		)`)}return e}function Ym(a,t,e=!1){const i=[];for(const s in a){const n=a[s];i.push(zm(n,t,e))}return`def "Materials"
{
${i.join("")}
}

`}function zm(a,t,e=!1){const i="			",s=[],n=[];function r(o,A,l){const c=o.source.id+"_"+o.flipY;t[c]=o;const h=o.channel>0?"st"+o.channel:"st",d={1e3:"repeat",1001:"clamp",1002:"mirror"},u=o.repeat.clone(),g=o.offset.clone(),m=o.rotation,p=Math.sin(m),f=Math.cos(m);return g.y=1-g.y-u.y,e?(g.x=g.x/u.x,g.y=g.y/u.y,g.x+=p/u.x,g.y+=f-1):(g.x+=p*u.x,g.y+=(1-f)*u.y),`
		def Shader "PrimvarReader_${A}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${h}"
			float2 outputs:result
		}

		def Shader "Transform2d_${A}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${a.id}/PrimvarReader_${A}.outputs:result>
			float inputs:rotation = ${(m*(180/Math.PI)).toFixed(rt)}
			float2 inputs:scale = ${zh(u)}
			float2 inputs:translation = ${zh(g)}
			float2 outputs:result
		}

		def Shader "Texture_${o.id}_${A}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${c}.png@
			float2 inputs:st.connect = </Materials/Material_${a.id}/Transform2d_${A}.outputs:result>
			${l!==void 0?"float4 inputs:scale = "+jm(l):""}
			token inputs:sourceColorSpace = "${o.colorSpace===j.NoColorSpace?"raw":"sRGB"}"
			token inputs:wrapS = "${d[o.wrapS]}"
			token inputs:wrapT = "${d[o.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${a.transparent||a.alphaTest>0?"float outputs:a":""}
		}`}return a.side===j.DoubleSide&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",a),a.map!==null?(s.push(`${i}color3f inputs:diffuseColor.connect = </Materials/Material_${a.id}/Texture_${a.map.id}_diffuse.outputs:rgb>`),a.transparent?s.push(`${i}float inputs:opacity.connect = </Materials/Material_${a.id}/Texture_${a.map.id}_diffuse.outputs:a>`):a.alphaTest>0&&(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${a.id}/Texture_${a.map.id}_diffuse.outputs:a>`),s.push(`${i}float inputs:opacityThreshold = ${a.alphaTest}`)),n.push(r(a.map,"diffuse",a.color))):s.push(`${i}color3f inputs:diffuseColor = ${Yh(a.color)}`),a.emissiveMap!==null?(s.push(`${i}color3f inputs:emissiveColor.connect = </Materials/Material_${a.id}/Texture_${a.emissiveMap.id}_emissive.outputs:rgb>`),n.push(r(a.emissiveMap,"emissive"))):a.emissive.getHex()>0&&s.push(`${i}color3f inputs:emissiveColor = ${Yh(a.emissive)}`),a.normalMap!==null&&(s.push(`${i}normal3f inputs:normal.connect = </Materials/Material_${a.id}/Texture_${a.normalMap.id}_normal.outputs:rgb>`),n.push(r(a.normalMap,"normal"))),a.aoMap!==null&&(s.push(`${i}float inputs:occlusion.connect = </Materials/Material_${a.id}/Texture_${a.aoMap.id}_occlusion.outputs:r>`),n.push(r(a.aoMap,"occlusion"))),a.roughnessMap!==null&&a.roughness===1?(s.push(`${i}float inputs:roughness.connect = </Materials/Material_${a.id}/Texture_${a.roughnessMap.id}_roughness.outputs:g>`),n.push(r(a.roughnessMap,"roughness"))):s.push(`${i}float inputs:roughness = ${a.roughness}`),a.metalnessMap!==null&&a.metalness===1?(s.push(`${i}float inputs:metallic.connect = </Materials/Material_${a.id}/Texture_${a.metalnessMap.id}_metallic.outputs:b>`),n.push(r(a.metalnessMap,"metallic"))):s.push(`${i}float inputs:metallic = ${a.metalness}`),a.alphaMap!==null?(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${a.id}/Texture_${a.alphaMap.id}_opacity.outputs:r>`),s.push(`${i}float inputs:opacityThreshold = 0.0001`),n.push(r(a.alphaMap,"opacity"))):s.push(`${i}float inputs:opacity = ${a.opacity}`),a.isMeshPhysicalMaterial&&(s.push(`${i}float inputs:clearcoat = ${a.clearcoat}`),s.push(`${i}float inputs:clearcoatRoughness = ${a.clearcoatRoughness}`),s.push(`${i}float inputs:ior = ${a.ior}`)),`
	def Material "Material_${a.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${s.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${a.id}/PreviewSurface.outputs:surface>

${n.join(`
`)}

	}
`}function Yh(a){return`(${a.r}, ${a.g}, ${a.b})`}function jm(a){return`(${a.r}, ${a.g}, ${a.b}, 1.0)`}function zh(a){return`(${a.x}, ${a.y})`}function Wm(a){const t=a.name?a.name:"Camera_"+a.id,e=Jh(a.matrixWorld);return a.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",a),a.isOrthographicCamera?`def Camera "${t}"
		{
			matrix4d xformOp:transform = ${e}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${a.near.toPrecision(rt)}, ${a.far.toPrecision(rt)})
			float horizontalAperture = ${((Math.abs(a.left)+Math.abs(a.right))*10).toPrecision(rt)}
			float verticalAperture = ${((Math.abs(a.top)+Math.abs(a.bottom))*10).toPrecision(rt)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${t}"
		{
			matrix4d xformOp:transform = ${e}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${a.near.toPrecision(rt)}, ${a.far.toPrecision(rt)})
			float focalLength = ${a.getFocalLength().toPrecision(rt)}
			float focusDistance = ${a.focus.toPrecision(rt)}
			float horizontalAperture = ${a.getFilmWidth().toPrecision(rt)}
			token projection = "perspective"
			float verticalAperture = ${a.getFilmHeight().toPrecision(rt)}
		}
	
	`}const Xm=`
<svg width="<WIDTH>px" height="<HEIGHT>px" viewBox="0 0 1024 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(1.42378,0,0,-1.42378,37.8056,272.552)">
        <path d="M535.902,111.141L535.902,135.996L516.129,135.996L516.129,40.18L535.902,40.18L535.902,90.087C540.364,74.698 554.364,63.505 570.884,63.505C589.267,63.505 604.519,77.36 607.001,95.441L607.245,97.219L607.245,64.239L626.512,64.239L626.555,66.149C630.504,64.457 634.803,63.668 638.946,63.657C644.567,63.523 650.034,65.021 655.057,68.061L660.825,71.553L651.44,88.59L645.161,84.719C643.29,83.566 641.189,83.086 639.101,83.077C632.262,83.174 627.017,88.662 627.017,95.331L627.017,135.997L607.245,135.997L607.245,101.756L597.204,104.413L607.131,108.728L604.463,115.117C598.904,128.43 585.948,137.724 570.884,137.724C554.364,137.724 540.364,126.53 535.902,111.141ZM515.693,52.455C515.693,60.117 509.874,63.947 504.055,63.947C498.236,63.947 492.417,60.117 492.417,52.455C492.417,37.14 515.693,37.14 515.693,52.455ZM380.282,71.383L380.282,153.041C379.771,153.655 373.607,159.525 373.258,160.065L373.258,135.997L348.352,135.997L348.243,134.69C344.015,136.642 339.458,137.674 335.553,137.747L335.511,137.748C324.933,137.821 315.829,134.433 309.296,128.08C305.974,124.851 303.277,120.825 301.442,115.998L301.442,135.996L273.142,135.996L273.142,97.898C273.142,94.483 272.775,90.902 269.308,90.902C265.617,90.902 263.827,94.498 263.827,98.131L263.827,135.996L235.53,135.996L235.53,98.131C235.53,94.53 234.463,90.671 230.75,90.671C227.046,90.671 225.511,94.483 225.511,98.131L225.511,135.996L197.213,135.996L197.213,64.239L223.485,64.239L223.627,65.183C226.918,63.895 230.419,63.307 233.669,63.307C240.087,63.307 246.447,65.139 251.31,69.669C256.803,65.062 263.137,63.54 270.002,63.54C280.598,63.54 288.388,67.088 293.646,73.141C296.904,76.89 299.223,81.729 300.443,87.587C302.282,81.374 305.504,76.323 309.651,72.435C316.294,66.207 325.463,62.891 335.799,62.957C340.05,62.961 344.191,63.842 347.897,65.413L347.96,64.36L399.852,64.36L400.044,66C404.335,64.016 408.962,63.073 413.227,63.073C426.457,63.073 437.04,68.986 443.35,78.274L443.35,64.239L455.619,64.239L455.619,48.113L475.273,46.066L475.273,64.239L494.056,64.239L494.056,64.005L513.822,64.005L513.822,135.996L494.056,135.996L494.056,132.579L492.809,133.184C488.173,135.434 483.508,136.813 478.88,136.813C471.929,136.813 466.942,134.899 463.359,131.901C458.177,127.565 455.619,120.504 455.619,111.217L455.619,83.076L446.093,83.076C448.504,88.174 449.807,93.997 449.807,100.235C449.807,121.049 436.525,137.4 413.692,137.4C410.081,137.4 405.736,136.78 401.557,135.338L401.557,160.065L373.258,160.065C374.058,159.226 379.595,153.754 380.282,153.041L394.533,153.041L394.533,122.196C398.624,128.502 407.623,130.376 413.692,130.376C432.149,130.376 442.783,117.06 442.783,100.235C442.783,83.299 430.977,70.096 413.227,70.096C406.687,70.096 398.975,72.899 394.533,79.326L393.603,71.383L380.282,71.383ZM528.878,128.972L528.878,47.203L523.153,47.203L523.153,128.972L528.878,128.972ZM508.669,52.455C508.669,55.493 506.362,57.011 504.055,57.011C501.748,57.011 499.441,55.493 499.441,52.455C499.441,46.383 508.669,46.383 508.669,52.455ZM468.249,71.263L468.249,53.859L462.643,54.443L462.643,71.263L450.374,71.263L450.374,76.053L462.643,76.053L462.643,111.217C462.643,122.546 466.615,129.789 478.88,129.789C482.497,129.789 486.12,128.623 489.744,126.865L487.757,122.196C484.837,123.597 481.684,124.532 478.88,124.532C469.888,124.532 468.249,119.041 468.249,111.217L468.249,76.053L487.874,76.053L487.874,71.263L468.249,71.263ZM368.25,71.383L354.58,71.383L354.11,79.326C350.841,73.601 343.484,69.981 335.776,69.981C318.955,69.864 305.75,80.26 305.75,100.118C305.75,120.329 318.371,130.842 335.421,130.725C341.848,130.604 350.841,127.336 354.11,120.565L354.813,128.973L368.25,128.973L368.25,71.383ZM242.554,98.131L242.554,128.972L256.803,128.972L256.803,98.131C256.803,90.537 261.593,83.878 269.308,83.878C277.013,83.878 280.166,90.308 280.166,97.898L280.166,128.972L294.418,128.972L294.418,97.898C294.418,80.608 286.36,70.563 270.002,70.563C262.53,70.563 255.869,72.899 250.729,81.077C247.456,73.136 240.567,70.33 233.669,70.33C228.184,70.33 221.525,72.43 218.487,78.273L217.436,71.263L204.237,71.263L204.237,128.972L218.487,128.972L218.487,98.131C218.487,90.538 223.038,83.648 230.75,83.648C238.581,83.648 242.554,90.537 242.554,98.131ZM548.355,110.081C552.002,119.128 560.713,125.5 570.884,125.5C580.946,125.5 589.582,119.266 593.296,110.373L597.982,112.41C593.492,123.162 583.05,130.7 570.884,130.7C554.619,130.7 541.435,117.229 541.435,100.614C541.435,83.998 554.619,70.528 570.884,70.528C585.747,70.528 598.036,81.778 600.043,96.397L595.072,97.712L595.066,97.66L548.346,110.06C548.347,110.063 548.348,110.065 548.349,110.067C548.35,110.07 548.351,110.072 548.352,110.075L548.323,110.083L548.355,110.081ZM619.645,71.263L619.877,81.547C623.495,73.714 631.678,70.68 639.037,70.68C643.363,70.564 647.56,71.733 651.42,74.07L648.847,78.74C645.815,76.871 642.42,76.053 639.037,76.053C628.285,76.174 619.993,84.816 619.993,95.331L619.993,128.973L614.269,128.973L614.269,71.263L619.645,71.263ZM501.08,71.029L501.08,128.972L506.798,128.972L506.798,71.029L501.08,71.029ZM570.884,75.728C557.432,75.728 546.525,86.87 546.525,100.615C546.525,101.951 546.631,103.261 546.829,104.54L593.773,92.08C590.364,82.54 581.403,75.728 570.884,75.728ZM337.058,117.641C327.596,117.641 320.003,111.095 320.003,100.118C320.003,89.139 327.596,82.712 337.058,82.712C359.486,82.712 359.486,117.641 337.058,117.641ZM554.337,95.28L582.868,87.708C579.76,84.644 575.542,82.752 570.884,82.752C563.085,82.752 556.533,88.04 554.337,95.28ZM494.056,119.062L491.343,112.685L484.719,115.864C482.789,116.789 480.733,117.508 478.88,117.508C477.629,117.508 476.693,117.588 476.133,117.047C475.69,116.618 475.657,115.939 475.534,115.219C475.328,114.012 475.273,112.666 475.273,111.217L475.273,83.076L494.056,83.076L494.056,119.062ZM428.531,100.235C428.531,91.24 422.455,83.878 412.176,83.878C401.893,83.878 395.818,91.24 395.818,100.235C395.818,109.227 402.479,116.593 412.176,116.593C421.876,116.593 428.531,109.227 428.531,100.235ZM337.058,110.617C343.68,110.617 346.855,105.333 346.855,100.176C346.855,95.02 343.68,89.735 337.058,89.735C331.452,89.735 327.027,93.613 327.027,100.118C327.027,106.637 331.439,110.617 337.058,110.617ZM421.507,100.235C421.507,95.103 418.041,90.902 412.176,90.902C406.308,90.902 402.842,95.103 402.842,100.235C402.842,105.366 406.643,109.569 412.176,109.569C417.711,109.569 421.507,105.366 421.507,100.235ZM587.073,107.048L586.815,107.666C584.171,113.998 578.048,118.476 570.884,118.476C566.637,118.476 562.757,116.902 559.752,114.299L587.073,107.048Z" style="fill-opacity:0.3;"/>
    </g>
    <g transform="matrix(1.42378,0,0,-1.42378,28.8272,275.975)">
        <path d="M33.568,124.028C16.878,107.338 16.878,80.238 33.568,63.548L63.65,33.466C80.34,16.776 107.44,16.776 124.13,33.466L154.227,63.563C170.917,80.253 170.917,107.353 154.227,124.043L93.905,184.365L33.568,124.028ZM93.789,63.649L63.526,93.912L93.789,124.175L124.052,93.912L93.789,63.649Z" style="fill-opacity:0.3;"/>
        <path d="M28.601,128.994C9.171,109.563 9.171,78.013 28.601,58.582L58.684,28.5C78.114,9.069 109.665,9.069 129.096,28.5L159.193,58.597C178.624,78.028 178.624,109.578 159.193,129.009L93.905,194.298L28.601,128.994ZM33.568,124.028C16.878,107.338 16.878,80.238 33.568,63.548L63.65,33.466C80.34,16.776 107.44,16.776 124.13,33.466L154.227,63.563C170.917,80.253 170.917,107.353 154.227,124.043L93.905,184.365L33.568,124.028ZM93.789,63.649L63.526,93.912L93.789,124.175L124.052,93.912L93.789,63.649ZM93.789,73.582L73.459,93.912L93.789,114.242L114.119,93.912L93.789,73.582Z" style="fill-opacity:0.3;"/>
    </g>
    <g transform="matrix(1.42378,0,0,-1.42378,37.8056,272.552)">
        <path d="M528.878,128.972L528.878,47.203L523.153,47.203L523.153,128.972L528.878,128.972ZM508.669,52.455C508.669,58.53 499.441,58.53 499.441,52.455C499.441,46.383 508.669,46.383 508.669,52.455ZM501.08,71.029L501.08,128.972L506.798,128.972L506.798,71.029L501.08,71.029ZM468.249,71.263L468.249,53.859L462.643,54.443L462.643,71.263L450.374,71.263L450.374,76.053L462.643,76.053L462.643,111.217C462.643,122.546 466.615,129.789 478.88,129.789C482.497,129.789 486.12,128.623 489.744,126.865L487.757,122.196C484.837,123.597 481.684,124.532 478.88,124.532C469.888,124.532 468.249,119.041 468.249,111.217L468.249,76.053L487.874,76.053L487.874,71.263L468.249,71.263ZM368.25,71.383L354.58,71.383L354.11,79.326C350.841,73.601 343.484,69.981 335.776,69.981C318.955,69.864 305.75,80.26 305.75,100.118C305.75,120.329 318.371,130.842 335.421,130.725C341.848,130.604 350.841,127.336 354.11,120.565L354.813,128.973L368.25,128.973L368.25,71.383ZM337.058,117.641C327.596,117.641 320.003,111.095 320.003,100.118C320.003,89.139 327.596,82.712 337.058,82.712C359.486,82.712 359.486,117.641 337.058,117.641ZM242.554,98.131L242.554,128.972L256.803,128.972L256.803,98.131C256.803,90.537 261.593,83.878 269.308,83.878C277.013,83.878 280.166,90.308 280.166,97.898L280.166,128.972L294.418,128.972L294.418,97.898C294.418,80.608 286.36,70.563 270.002,70.563C262.53,70.563 255.869,72.899 250.729,81.077C247.456,73.136 240.567,70.33 233.669,70.33C228.184,70.33 221.525,72.43 218.487,78.273L217.436,71.263L204.237,71.263L204.237,128.972L218.487,128.972L218.487,98.131C218.487,90.538 223.038,83.648 230.75,83.648C238.581,83.648 242.554,90.537 242.554,98.131ZM380.282,153.041L380.282,71.383L393.603,71.383L394.533,79.326C398.975,72.899 406.687,70.096 413.227,70.096C430.977,70.096 442.783,83.299 442.783,100.235C442.783,117.06 432.149,130.376 413.692,130.376C407.623,130.376 398.624,128.502 394.533,122.196L394.533,153.041L380.282,153.041ZM428.531,100.235C428.531,91.24 422.455,83.878 412.176,83.878C401.893,83.878 395.818,91.24 395.818,100.235C395.818,109.227 402.479,116.593 412.176,116.593C421.876,116.593 428.531,109.227 428.531,100.235ZM619.645,71.263L619.877,81.547C623.495,73.714 631.678,70.68 639.037,70.68C643.363,70.564 647.56,71.733 651.42,74.07L648.847,78.74C645.815,76.871 642.42,76.053 639.037,76.053C628.285,76.174 619.993,84.816 619.993,95.331L619.993,128.973L614.269,128.973L614.269,71.263L619.645,71.263ZM548.355,110.081C552.002,119.128 560.713,125.5 570.884,125.5C580.946,125.5 589.582,119.266 593.296,110.373L597.982,112.41C593.492,123.162 583.05,130.7 570.884,130.7C554.619,130.7 541.435,117.229 541.435,100.614C541.435,83.998 554.619,70.528 570.884,70.528C585.747,70.528 598.036,81.778 600.043,96.397L595.072,97.712C595.07,97.7 595.069,97.689 595.068,97.677L595.066,97.66L548.346,110.06C548.347,110.063 548.348,110.065 548.349,110.067C548.35,110.07 548.351,110.072 548.352,110.075L548.323,110.083L548.355,110.081ZM570.884,75.728C557.432,75.728 546.525,86.87 546.525,100.615C546.525,101.951 546.631,103.261 546.829,104.54L593.773,92.08C590.364,82.54 581.403,75.728 570.884,75.728Z" style="fill:white;"/>
    </g>
    <g transform="matrix(1.42378,-1.58071e-16,-1.58071e-16,-1.42378,37.8056,272.552)">
        <path d="M57.423,151.586C65.597,159.758 87.354,181.938 87.344,181.96C87.265,182.105 108.959,160.323 117.599,151.688L87.459,121.55L57.423,151.586Z" style="fill:rgb(58,24,136);fill-rule:nonzero;"/>
        <path d="M87.459,121.55L117.598,151.688C117.643,151.638 117.698,151.581 117.747,151.536L147.857,121.424L117.72,91.287L87.459,121.55Z" style="fill:rgb(3,161,196);fill-rule:nonzero;"/>
        <path d="M147.857,121.424L147.935,121.346C164.591,104.692 164.604,77.7 147.985,61.025L117.721,91.287L147.857,121.424Z" style="fill:rgb(5,208,223);fill-rule:nonzero;"/>
        <path d="M57.195,91.287L27.164,121.317C27.173,121.328 27.178,121.338 27.189,121.347L57.373,151.536C57.39,151.552 57.408,151.568 57.423,151.586L87.459,121.55L57.195,91.287Z" style="fill:rgb(118,31,232);fill-rule:nonzero;"/>
        <path d="M87.459,61.023L117.72,91.287L147.984,61.025C147.96,61.008 147.951,60.991 147.934,60.974L117.747,30.787C117.74,30.779 117.729,30.77 117.72,30.762L87.459,61.023Z" style="fill:rgb(255,170,1);fill-rule:nonzero;"/>
        <path d="M27.037,61.129C10.529,77.804 10.571,104.696 27.164,121.318L57.195,91.288L27.037,61.129Z" style="fill:rgb(241,23,93);fill-rule:nonzero;"/>
        <path d="M87.458,61.023L57.298,30.863L27.188,60.973C27.136,61.025 27.089,61.08 27.036,61.128L57.195,91.287L87.458,61.023Z" style="fill:rgb(251,58,27);fill-rule:nonzero;"/>
        <path d="M117.722,30.761C101.046,14.116 74.039,14.125 57.374,30.787L57.3,30.863L87.46,61.023L117.722,30.761Z" style="fill:rgb(251,201,53);fill-rule:nonzero;"/>
    </g>
</svg>
`;function Zm(a,t,e=256){return new Promise(i=>{const s=e*.25,n=Xm.replace("<WIDTH>",e.toString()).replace("<HEIGHT>",s.toString()),r=new Image,o=new Blob([n],{type:"image/svg+xml"}),A=URL.createObjectURL(o);r.onload=function(){a.drawImage(r,t,t),URL.revokeObjectURL(A),i()},r.src=A})}var t0=Object.defineProperty,jh=Object.getOwnPropertySymbols,e0=Object.prototype.hasOwnProperty,i0=Object.prototype.propertyIsEnumerable,Wh=(a,t,e)=>t in a?t0(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,Xh=(a,t)=>{for(var e in t||(t={}))e0.call(t,e)&&Wh(a,e,t[e]);if(jh)for(var e of jh(t))i0.call(t,e)&&Wh(a,e,t[e]);return a},ut=(a,t,e)=>new Promise((i,s)=>{var n=A=>{try{o(e.next(A))}catch(l){s(l)}},r=A=>{try{o(e.throw(A))}catch(l){s(l)}},o=A=>A.done?i(A.value):Promise.resolve(A.value).then(n,r);o((e=e.apply(a,t)).next())});/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;const s0=12,Ae=512;function wa(a){a.parentNode.removeChild(a)}function Zh(a,t,e,i=!0){const s=(t+180)/360*Math.pow(2,a),n=(1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,a);return i?{x:Math.floor(s),y:Math.floor(n)}:{x:s,y:n}}function tc(a){const t=document.createElement("canvas");t.width=a.width,t.height=a.height;const e=t.getContext("2d");if(!e)throw new Error("Unable to create a canvas with context.");const i=e.getImageData(0,0,a.width,a.height);return i.data.set(a.pixelData),e.putImageData(i,0,0),t}function n0(a,t,e,i){return ut(this,null,function*(){const s=t.x-a.x+1,n=t.y-a.y+1,r=document.createElement("canvas");r.width=s*Ae,r.height=n*Ae;const o=r.getContext("2d");if(!o)throw new Error("The context is invalid");let A=0,l=0;const c=[];for(let h=a.y;h<=t.y;h+=1){for(let d=a.x;d<=t.x;d+=1){const u=i[~~(Math.random()*i.length)].replace("{x}",d.toString()).replace("{y}",h.toString()).replace("{z}",e.toString());c.push(r0(u,o,[A*Ae,l*Ae])),A++}A=0,l++}return yield Promise.all(c),r})}function r0(a,t,e){return new Promise((i,s)=>{const n=new Image;n.crossOrigin="anonymous",n.src=a,n.onload=function(){t.drawImage(n,e[0],e[1]),i()},n.onerror=function(){i()}})}function a0(a,t,e){var i;const s=a[0],n=a[1],r=t[0],o=t[1],A=document.createElement("canvas");return A.width=r,A.height=o,(i=A.getContext("2d"))==null||i.drawImage(e,s,n,r,o,0,0,r,o),A}function li(a){return new Promise(function(t,e){a.once("idle",()=>{t(!0)})})}const o0={showButton:!0,background:"#FFFFFF",closeButtonClassName:"",arButtonClassName:"",closeButtonContent:`<svg width="100%" height="100%" viewBox="0 0 33 33" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
      <g transform="matrix(0.707107,0.707107,-0.707107,0.707107,16.6768,6.42373)">
          <path d="M7,13.75C6.737,13.75 6.509,13.653 6.315,13.46C6.122,13.266 6.025,13.038 6.025,12.775L6.025,8.225L1.475,8.225C1.212,8.225 0.984,8.128 0.79,7.935C0.597,7.741 0.5,7.513 0.5,7.25C0.5,6.987 0.597,6.759 0.79,6.565C0.984,6.372 1.212,6.275 1.475,6.275L6.025,6.275L6.025,1.725C6.025,1.462 6.122,1.234 6.315,1.04C6.509,0.847 6.737,0.75 7,0.75C7.263,0.75 7.491,0.847 7.685,1.04C7.878,1.234 7.975,1.462 7.975,1.725L7.975,6.275L12.525,6.275C12.788,6.275 13.016,6.372 13.21,6.565C13.403,6.759 13.5,6.987 13.5,7.25C13.5,7.513 13.403,7.741 13.21,7.935C13.016,8.128 12.788,8.225 12.525,8.225L7.975,8.225L7.975,12.775C7.975,13.038 7.878,13.266 7.685,13.46C7.491,13.653 7.263,13.75 7,13.75Z" style="fill:rgb(68,73,82);fill-rule:nonzero;"/>
      </g>
    </svg>`,arButtonContent:`
  <span>
    <svg width="33px" height="33px" viewBox="0 0 48 48" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2; vertical-align: middle;">
      <g transform="matrix(0.718295,0,0,0.718295,6.75661,6.76523)">
          <path d="M22.197,39.734L11.472,33.439C10.949,33.118 10.543,32.696 10.253,32.171C9.963,31.646 9.819,31.082 9.819,30.48L9.819,17.941C9.819,17.34 9.963,16.776 10.253,16.251C10.543,15.726 10.949,15.303 11.472,14.983L22.247,8.576C22.777,8.27 23.362,8.116 24,8.116C24.638,8.116 25.223,8.27 25.753,8.576L36.528,14.983C37.051,15.303 37.457,15.726 37.747,16.251C38.037,16.776 38.182,17.34 38.182,17.941L38.182,30.48C38.182,31.082 38.032,31.646 37.734,32.171C37.436,32.696 37.017,33.118 36.478,33.439L25.603,39.734C25.062,40.048 24.491,40.205 23.892,40.205C23.292,40.205 22.727,40.048 22.197,39.734ZM22.5,35.925L22.5,25.044L13.275,19.741L13.275,30.373L22.5,35.925ZM25.5,35.925L34.775,30.373L34.775,19.741L25.5,25.044L25.5,35.925ZM3.701,13.426L3.701,7.108C3.701,6.159 4.033,5.353 4.696,4.687C5.359,4.022 6.163,3.689 7.108,3.689L13.426,3.689L13.426,6.976L6.976,6.976L6.976,13.426L3.701,13.426ZM13.426,44.299L7.108,44.299C6.163,44.299 5.359,43.967 4.696,43.304C4.033,42.641 3.701,41.837 3.701,40.892L3.701,34.574L6.976,34.574L6.976,41.024L13.426,41.024L13.426,44.299ZM34.574,44.299L34.574,41.024L41.024,41.024L41.024,34.574L44.311,34.574L44.311,40.892C44.311,41.837 43.978,42.641 43.313,43.304C42.647,43.967 41.841,44.299 40.892,44.299L34.574,44.299ZM41.024,13.426L41.024,6.976L34.574,6.976L34.574,3.689L40.892,3.689C41.841,3.689 42.647,4.022 43.313,4.687C43.978,5.353 44.311,6.159 44.311,7.108L44.311,13.426L41.024,13.426ZM24,22.336L33.237,16.991L24,11.685L14.763,16.991L24,22.336Z" style="fill:rgb(36, 189, 240);fill-rule:nonzero;"/>
      </g>
    </svg>
    <span style="vertical-align: middle;">
    View in your space
    </span>
  </span>`,edgeColor:"#7b8487"},ec={position:"absolute",bottom:"0",left:"0",right:"0",margin:"30px auto",fontSize:"1.4em",width:"fit-content",background:"#FFF",border:"1px solid #0000001a",borderRadius:"3px",padding:"2px 9px 2px 6px",color:"#727781","box-shadow":"0 0 6px 2px rgb(0 0 0 / 8%)"},ic={position:"absolute",top:"0",right:"0",margin:"10px",padding:"0px",background:"#FFF",border:"none",borderRadius:"3px",width:"33px",height:"33px","box-shadow":"0 0 6px 2px rgb(0 0 0 / 8%)"};class A0 extends jc{constructor(t={}){super(),this.colorData=null,this.landMaskData=null,this.terrainData=null,this.meterPerPixelCenter=0,this.originalPixelRatio=0,this.itemsToDispose=[],this.gltfExporter=new Wc,this.lock=!1,this.arButton=null,this.closeButton=null,this.modelViewer=null,this.options=Xh(Xh({},o0),t)}onAdd(t){if(this.setMap(t),this.controlButtonContainer=window.document.createElement("div"),this.options.showButton){this.controlButtonContainer.className="maplibregl-ctrl maplibregl-ctrl-group",this.controlButton=window.document.createElement("button"),this.controlButton.className="maptiler-ar-ctrl",this.controlButtonContainer.appendChild(this.controlButton);const e=window.document.createElement("span");e.className="maplibregl-ctrl-icon",e.setAttribute("aria-hidden","true"),this.controlButton.appendChild(e),e.innerHTML=`
      <svg width="100%" height="100%" viewBox="0 0 48 48" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
        <path d="M22.701,35.306L14.997,30.784C14.621,30.554 14.33,30.251 14.121,29.873C13.913,29.496 13.81,29.091 13.81,28.659L13.81,19.652C13.81,19.22 13.913,18.815 14.121,18.438C14.33,18.061 14.621,17.757 14.997,17.527L22.737,12.925C23.117,12.706 23.537,12.595 23.996,12.595C24.454,12.595 24.874,12.706 25.255,12.925L32.994,17.527C33.37,17.757 33.662,18.061 33.87,18.438C34.078,18.815 34.183,19.22 34.183,19.652L34.183,28.659C34.183,29.091 34.075,29.496 33.861,29.873C33.647,30.251 33.346,30.554 32.959,30.784L25.147,35.306C24.759,35.532 24.348,35.644 23.918,35.644C23.487,35.644 23.081,35.532 22.701,35.306ZM25.073,32.57L31.735,28.582L31.735,20.945L25.073,24.754L25.073,32.57ZM22.918,32.57L22.918,24.754L16.292,20.945L16.292,28.582L22.918,32.57ZM23.996,15.159L17.361,18.97L23.996,22.809L30.631,18.97L23.996,15.159Z" style="fill:rgb(68,73,82);"/>
      </svg>
      `,this.controlButton.type="button",this.controlButton.addEventListener("click",i=>ut(this,null,function*(){this.run()}))}return this.init3DScene(),this.controlButtonContainer}run(){return ut(this,null,function*(){try{this.close()}catch{}if(this.lock)return;this.lock=!0,this.emit("computeStart"),yield this.computeTextures();const t=this.getColorData(),e=this.getTerrainData();!t||!e||(yield this.buildMapModel(),this.displayModal(),this.lock=!1)})}onRemove(){var t;this.dispose(),(t=this.controlButtonContainer.parentNode)==null||t.removeChild(this.controlButtonContainer)}setMap(t){this.map=t}getMeterPerPixelCenter(){return this.meterPerPixelCenter}getColorData(){return this.colorData}getLandMaskData(){return this.landMaskData}getTerrainData(){return this.terrainData}saveMapSettings(){this.cameraSettings={center:this.map.getCenter(),zoom:this.map.getZoom(),pitch:this.map.getPitch(),bearing:this.map.getBearing()},this.terrainExaggeration=this.map.getTerrainExaggeration(),this.hasTerrain=this.map.hasTerrain(),this.originalPixelRatio=this.map.getPixelRatio(),this.hasTerrain&&(this.terrainSourceID=this.map.getTerrain().source)}restoreMapSettings(){this.map.triggerRepaint(),this.hasTerrain&&this.map.setTerrain({source:this.terrainSourceID,exaggeration:this.terrainExaggeration}),this.map.jumpTo(this.cameraSettings)}enableTopView(){this.saveMapSettings(),this.hasTerrain&&this.map.setTerrain(null),this.map.triggerRepaint();const t={center:this.cameraSettings.center,zoom:this.cameraSettings.zoom,pitch:0,bearing:0};this.map.jumpTo(t)}grabGlData(){const t=this.map.getCanvas().getContext("webgl2");if(!t)throw new Error("The WebGL context of the map is undefined");const e=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);return t.readPixels(0,0,t.drawingBufferWidth,t.drawingBufferHeight,t.RGBA,t.UNSIGNED_BYTE,e),{width:t.drawingBufferWidth,height:t.drawingBufferHeight,pixelData:e,bounds:this.map.getBounds()}}computeColorData(){return ut(this,null,function*(){this.emit("startComputeColorData"),yield li(this.map),this.colorData=this.grabGlData(),this.emit("endComputeColorData",{})})}computeLandMaskData(){return ut(this,null,function*(){this.emit("startComputeLandMaskData",{}),this.map.addSource("xr_module_global_blackout_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-180,-90],[-180,90],[180,90],[180,-90],[-180,-90]]]}}}),this.map.addLayer({id:"xr_module_global_blackout_layer",type:"fill",source:"xr_module_global_blackout_source",layout:{},paint:{"fill-color":"#000","fill-opacity":1}}),this.map.addSource("xr_module_land_source",{type:"vector",url:"https://api.maptiler.com/tiles/land/tiles.json?key=bod4IIn9bwK8mnZIk49v"}),this.map.addLayer({id:"xr_module_land_layer",type:"fill",source:"xr_module_land_source","source-layer":"land",layout:{},paint:{"fill-color":"#fff","fill-opacity":1}}),yield li(this.map),this.landMaskData=this.grabGlData(),this.map.removeLayer("xr_module_global_blackout_layer"),this.map.removeLayer("xr_module_land_layer"),this.map.removeSource("xr_module_global_blackout_source"),this.map.removeSource("xr_module_land_source"),yield li(this.map),this.emit("endComputeLandMaskData",{})})}computeTerrainData_VIEWPORT(){return ut(this,null,function*(){this.emit("startComputeTerrainData",{}),this.map.addSource("xr_module_terrain_source",{type:"raster",url:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json"}),this.map.addLayer({id:"xr_module_terrain_layer",source:"xr_module_terrain_source",type:"raster",minzoom:0,layout:{visibility:"visible"},paint:{"raster-opacity":1},filter:["all"]}),yield li(this.map),this.terrainData=this.grabGlData(),this.map.removeLayer("xr_module_terrain_layer"),this.map.removeSource("xr_module_terrain_source"),yield li(this.map),this.emit("endComputeTerrainData",{})})}computeTerrainData(){return ut(this,null,function*(){var t;this.emit("startComputeTerrainData",{});const e=Math.min(Math.floor(this.map.getZoom()),s0),i=this.map.getBounds(),s=i.getNorth(),n=i.getSouth(),r=i.getEast(),o=i.getWest(),A=Zh(e,o,s,!1),l={x:Math.floor(A.x),y:Math.floor(A.y)},c=Zh(e,r,n,!1),h={x:Math.floor(c.x),y:Math.floor(c.y)},d=this.map.getSdkConfig(),u=this.map.getMaptilerSessionId(),g=yield n0(l,h,e,[`https://api.maptiler.com/tiles/terrain-rgb-v2/{z}/{x}/{y}.webp?key=${d.apiKey}&mtsid=${u}&module=xr`]),m=[Math.floor(Ae*(A.x-l.x)),Math.floor(Ae*(A.y-l.y))],p=[Math.ceil(Ae*(c.x-A.x)),Math.ceil(Ae*(c.y-A.y))],f=a0(m,p,g),I=(t=f.getContext("2d"))==null?void 0:t.getImageData(0,0,f.width,f.height).data;if(!I)throw new Error("Unable to extract terrain data.");this.terrainData={width:f.width,height:f.height,pixelData:new Uint8Array(I.buffer),bounds:i},this.emit("endComputeTerrainData",{})})}computeTextures(){return ut(this,null,function*(){var t;if(this.enableTopView(),yield this.computeColorData(),yield this.computeTerrainData(),!this.colorData)throw new Error("The color texture is invalid.");this.mapCaptureBounds=this.map.getBounds();const e=this.mapCaptureBounds.getCenter(),i=new Sa(this.mapCaptureBounds.getWest(),e.lat),s=new Sa(this.mapCaptureBounds.getEast(),e.lat).distanceTo(i);this.meterPerPixelCenter=s/((t=this.colorData)==null?void 0:t.width),this.restoreMapSettings(),yield li(this.map)})}init3DScene(){this.threeSceneGLTF=new j.Scene,this.threeTileContainerGLTF=new j.Object3D,this.threeSceneGLTF.add(this.threeTileContainerGLTF),this.threeTileContainerGLTF.rotation.set(-Math.PI/2,0,0),this.threeSceneUSDZ=new j.Scene,this.threeTileContainerUSDZ=new j.Object3D,this.threeSceneUSDZ.add(this.threeTileContainerUSDZ),this.threeTileContainerUSDZ.rotation.set(-Math.PI/2,0,0)}buildMapModel(){return ut(this,null,function*(){if(!this.colorData)throw new Error("Color textures is not ready.");if(!this.terrainData)throw new Error("Terrain textures is not ready.");this.threeTileContainerGLTF.clear(),this.threeTileContainerUSDZ.clear(),this.dispose();const t=tc(this.colorData),e=t.getContext("2d");if(!e)throw new Error("Color texture not available");const i=new j.Color(this.options.edgeColor),s=i.clone().multiplyScalar(.65),n=i.clone().multiplyScalar(.5);e.fillStyle=`#${i.getHexString()}`;const r=Math.ceil(this.colorData.width/this.terrainData.width)*1.5;yield Zm(e,r*2,Math.max(256,t.width/10)),e.fillRect(0,0,t.width-1,r),e.fillRect(0,t.height-1-r,t.width-1,t.height-1),e.fillStyle=`#${s.getHexString()}`,e.fillRect(0,0,r,t.height-1),e.fillRect(t.width-1-r,0,t.width-1,t.height-1);const o=new j.CanvasTexture(t);o.flipY=!1,o.colorSpace=j.SRGBColorSpace,o.colorSpace=j.sRGBEncoding,o.needsUpdate=!0,this.itemsToDispose.push(o),this.gltfMaterial=new j.MeshStandardMaterial({map:o,color:16777215}),this.usdzMaterial=new j.MeshStandardMaterial({map:o}),this.itemsToDispose.push(this.gltfMaterial),this.itemsToDispose.push(this.usdzMaterial);const A=this.mapCaptureBounds,l=A.getSouthEast().distanceTo(A.getSouthWest()),c=A.getSouthEast().distanceTo(A.getNorthEast()),h=new j.PlaneGeometry(l,c,this.terrainData.width-1,this.terrainData.height-1);this.mapMeshGLTF=new j.Mesh(h,this.gltfMaterial),this.mapMeshUSDZ=new j.Mesh(h,this.usdzMaterial);const d=h.attributes.position.array,u=this.terrainData.width,g=this.terrainData.height;let m=1/0;for(let B=0;B<d.length/3;B+=1){const y=this.terrainData.pixelData[B*4],w=this.terrainData.pixelData[B*4+1],v=this.terrainData.pixelData[B*4+2],x=-1e4+(y*256*256+w*256+v)*.1;x<m&&(m=x)}m=Math.max(0,~~(m/100)*100-100);for(let B=0;B<d.length/3;B+=1){const y=this.terrainData.pixelData[B*4],w=this.terrainData.pixelData[B*4+1],v=this.terrainData.pixelData[B*4+2];let x=-1e4+(y*256*256+w*256+v)*.1-m;const S=B%u,_=~~(B/u);(S===0||_===0||S===u-1||_===g-1)&&(x=0),d[B*3+2]=x}h.computeVertexNormals(),this.itemsToDispose.push(h);const p=new j.PlaneGeometry(l,c,1,1),f=new j.MeshStandardMaterial({color:n}),I=new j.Mesh(p,f);I.rotateX(-Math.PI),this.itemsToDispose.push(p),this.itemsToDispose.push(f);const C=1*1/l;this.threeTileContainerGLTF.scale.x=C,this.threeTileContainerGLTF.scale.y=C,this.threeTileContainerGLTF.scale.z=C,this.threeTileContainerGLTF.add(this.mapMeshGLTF),this.threeTileContainerGLTF.add(I),this.threeTileContainerUSDZ.scale.x=C,this.threeTileContainerUSDZ.scale.y=C,this.threeTileContainerUSDZ.scale.z=C;const E=I.clone();this.threeTileContainerUSDZ.add(this.mapMeshUSDZ),this.threeTileContainerUSDZ.add(E)})}dispose(){for(;this.itemsToDispose.length;){const t=this.itemsToDispose.pop();t?.dispose()}}downloadGLTF(t=!1){this.threeTileContainerGLTF.updateMatrix(),this.threeTileContainerGLTF.updateMatrixWorld(),this.gltfExporter.parse(this.threeSceneGLTF,e=>{let i;if(t)i=new Blob([e],{type:"application/octet-stream"});else{const n=JSON.stringify(e,null,2);i=new Blob([n],{type:"text/plain"})}const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=URL.createObjectURL(i),s.download=`maptiler_scene.${t?"glb":"gltf"}`,s.click()},e=>{console.log("error:",e)},{binary:t,maxTextureSize:8192})}downloadUSDZ(){return ut(this,null,function*(){this.threeTileContainerUSDZ.updateMatrix(),this.threeTileContainerUSDZ.updateMatrixWorld();const t=yield this.getModelBlobUSDZ(),e=document.createElement("a");e.style.display="none",document.body.appendChild(e),e.href=URL.createObjectURL(t),e.download="maptiler_scene.usdz",e.click()})}getModelBlobGLB(){return ut(this,null,function*(){return new Promise((t,e)=>{this.gltfExporter.parse(this.threeSceneGLTF,i=>{const s=new Blob([i],{type:"application/octet-stream"});t(s)},i=>{e(i)},{binary:!0,maxTextureSize:8192})})})}getModelBlobUSDZ(){return ut(this,null,function*(){const t=yield new _m().parse(this.threeSceneUSDZ);return new Blob([t],{type:"model/vnd.usdz+zip"})})}displayModal(){return ut(this,null,function*(){const t=this.map.getContainer(),e=yield this.getModelBlobGLB(),i=URL.createObjectURL(e);this.emit("computeEnd"),this.modelViewer=new Vh,this.modelViewer.src=i,this.modelViewer.setAttribute("ar","true"),this.modelViewer.setAttribute("ar-modes","webxr quick-look"),this.modelViewer.setAttribute("camera-controls","true"),this.modelViewer.setAttribute("shadow-intensity","1"),this.modelViewer.style.width="100%",this.modelViewer.style.height="100%",this.modelViewer.style.zIndex="3",this.modelViewer.style.position="absolute",this.modelViewer.style.background=this.options.background,t.appendChild(this.modelViewer),this.arButton=document.createElement("button"),this.arButton.setAttribute("slot","ar-button"),this.arButton.id="maptiler-ar-enable-button",this.options.arButtonClassName?this.arButton.classList.add(this.options.arButtonClassName):Object.keys(ec).forEach(s=>{this.arButton.style[s]=ec[s]}),typeof this.options.arButtonContent=="string"?this.arButton.innerHTML=this.options.arButtonContent:this.arButton.appendChild(this.options.arButtonContent),this.modelViewer.appendChild(this.arButton),this.closeButton=document.createElement("button"),this.closeButton.id="maptiler-ar-close-button",this.options.closeButtonClassName?this.closeButton.classList.add(this.options.closeButtonClassName):Object.keys(ic).forEach(s=>{this.closeButton.style[s]=ic[s]}),typeof this.options.closeButtonContent=="string"?this.closeButton.innerHTML=this.options.closeButtonContent:this.closeButton.appendChild(this.options.closeButtonContent),this.modelViewer.appendChild(this.closeButton),this.closeButton.addEventListener("click",s=>ut(this,null,function*(){this.close()}))})}close(){this.dispose(),wa(this.arButton),wa(this.modelViewer),wa(this.closeButton)}}export{A0 as MaptilerARControl,tc as mapTextureDataToCanvas};
