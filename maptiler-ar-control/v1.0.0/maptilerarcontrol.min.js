(function(nl,ru){typeof exports=="object"&&typeof module<"u"?ru(exports):typeof define=="function"&&define.amd?define(["exports"],ru):(nl=typeof globalThis<"u"?globalThis:nl||self,ru(nl.maptilerarcontrol={}))})(this,function(nl){"use strict";var ru=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Wy={exports:{}};(function(o,e){(function(t,i){o.exports=i()})(ru,function(){var t,i,s;function c(a,m){if(!t)t=m;else if(!i)i=m;else{var A="var sharedChunk = {}; ("+t+")(sharedChunk); ("+i+")(sharedChunk);",x={};t(x),s=m(x),typeof window<"u"&&(s.workerUrl=window.URL.createObjectURL(new Blob([A],{type:"text/javascript"})))}}c(["exports"],function(a){var m=A;function A(l,n,h,p){this.cx=3*l,this.bx=3*(h-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=n,this.p2x=h,this.p2y=p}function x(l,n,h,p){const y=new m(l,n,h,p);return function(v){return y.solve(v)}}A.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,n){if(n===void 0&&(n=1e-6),l<0)return 0;if(l>1)return 1;for(var h=l,p=0;p<8;p++){var y=this.sampleCurveX(h)-l;if(Math.abs(y)<n)return h;var v=this.sampleCurveDerivativeX(h);if(Math.abs(v)<1e-6)break;h-=y/v}var S=0,M=1;for(h=l,p=0;p<20&&(y=this.sampleCurveX(h),!(Math.abs(y-l)<n));p++)l>y?S=h:M=h,h=.5*(M-S)+S;return h},solve:function(l,n){return this.sampleCurveY(this.solveCurveX(l,n))}};const b=x(.25,.1,.25,1);function I(l,n,h){return Math.min(h,Math.max(n,l))}function E(l,n,h){const p=h-n,y=((l-n)%p+p)%p+n;return y===n?h:y}function T(l,...n){for(const h of n)for(const p in h)l[p]=h[p];return l}let U=1;function P(l,n){l.forEach(h=>{n[h]&&(n[h]=n[h].bind(n))})}function R(l,n,h){const p={};for(const y in l)p[y]=n.call(h||this,l[y],y,l);return p}function X(l,n,h){const p={};for(const y in l)n.call(h||this,l[y],y,l)&&(p[y]=l[y]);return p}function G(l){return Array.isArray(l)?l.map(G):typeof l=="object"&&l?R(l,G):l}const J={};function q(l){J[l]||(typeof console<"u"&&console.warn(l),J[l]=!0)}function te(l,n,h){return(h.y-l.y)*(n.x-l.x)>(n.y-l.y)*(h.x-l.x)}function ue(l){let n=0;for(let h,p,y=0,v=l.length,S=v-1;y<v;S=y++)h=l[y],p=l[S],n+=(p.x-h.x)*(h.y+p.y);return n}function _e(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let K=null;function ce(l){if(K==null){const n=l.navigator?l.navigator.userAgent:null;K=!!l.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return K}function Ve(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Me,ve;const ke={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(l){const n=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(l,n=0){return this.getImageCanvasContext(l).getImageData(-n,-n,l.width+2*n,l.height+2*n)},getImageCanvasContext(l){const n=window.document.createElement("canvas"),h=n.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return n.width=l.width,n.height=l.height,h.drawImage(l,0,0,l.width,l.height),h},resolveURL:l=>(Me||(Me=document.createElement("a")),Me.href=l,Me.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ve==null&&(ve=matchMedia("(prefers-reduced-motion: reduce)")),ve.matches)}};var Re=Fe;function Fe(l,n){this.x=l,this.y=n}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,n){return this.clone()._rotateAround(l,n)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var n=l.x-this.x,h=l.y-this.y;return n*n+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,n){return Math.atan2(this.x*n-this.y*l,this.x*l+this.y*n)},_matMult:function(l){var n=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=n,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var n=Math.cos(l),h=Math.sin(l),p=h*this.x+n*this.y;return this.x=n*this.x-h*this.y,this.y=p,this},_rotateAround:function(l,n){var h=Math.cos(l),p=Math.sin(l),y=n.y+p*(this.x-n.x)+h*(this.y-n.y);return this.x=n.x+h*(this.x-n.x)-p*(this.y-n.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(l){return l instanceof Fe?l:Array.isArray(l)?new Fe(l[0],l[1]):l};const Oe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,REGISTERED_PROTOCOLS:{}};class je extends Error{constructor(n,h,p,y){super(`AJAXError: ${h} (${n}): ${p}`),this.status=n,this.statusText=h,this.url=p,this.body=y}}const Je=_e()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function _t(l,n){const h=new AbortController,p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Je(),signal:h.signal});let y=!1,v=!1;return l.type==="json"&&p.headers.set("Accept","application/json"),v||fetch(p).then(S=>S.ok?(M=>{(l.type==="arrayBuffer"?M.arrayBuffer():l.type==="json"?M.json():M.text()).then(L=>{v||(y=!0,n(null,L,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(L=>{v||n(new Error(L.message))})})(S):S.blob().then(M=>n(new je(S.status,S.statusText,l.url,M)))).catch(S=>{S.code!==20&&n(new Error(S.message))}),{cancel:()=>{v=!0,y||h.abort()}}}const yt=function(l,n){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){if(_e()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,n);if(!_e()){const p=l.url.substring(0,l.url.indexOf("://"));return(Oe.REGISTERED_PROTOCOLS[p]||_t)(l,n)}}if(!(/^file:/.test(h=l.url)||/^file:/.test(Je())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return _t(l,n);if(_e()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,n,void 0,!0)}var h;return function(p,y){const v=new XMLHttpRequest;v.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const S in p.headers)v.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=p.credentials==="include",v.onerror=()=>{y(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let S=v.response;if(p.type==="json")try{S=JSON.parse(v.response)}catch(M){return y(M)}y(null,S,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const S=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});y(new je(v.status,v.statusText,p.url,S))}},v.send(p.body),{cancel:()=>v.abort()}}(l,n)},qe=function(l,n){return yt(T(l,{type:"arrayBuffer"}),n)};function Ye(l){const n=window.document.createElement("a");return n.href=l,n.protocol===window.document.location.protocol&&n.host===window.document.location.host}function at(l,n,h){h[l]&&h[l].indexOf(n)!==-1||(h[l]=h[l]||[],h[l].push(n))}function St(l,n,h){if(h&&h[l]){const p=h[l].indexOf(n);p!==-1&&h[l].splice(p,1)}}class Te{constructor(n,h={}){T(this,h),this.type=n}}class Kt extends Te{constructor(n,h={}){super("error",T({error:n},h))}}class Zt{on(n,h){return this._listeners=this._listeners||{},at(n,h,this._listeners),this}off(n,h){return St(n,h,this._listeners),St(n,h,this._oneTimeListeners),this}once(n,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},at(n,h,this._oneTimeListeners),this):new Promise(p=>this.once(n,p))}fire(n,h){typeof n=="string"&&(n=new Te(n,h||{}));const p=n.type;if(this.listens(p)){n.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const M of y)M.call(this,n);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const M of v)St(p,M,this._oneTimeListeners),M.call(this,n);const S=this._eventedParent;S&&(T(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(n))}else n instanceof Kt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,h){return this._eventedParent=n,this._eventedParentData=h,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class $e{constructor(n,h,p,y){this.message=(n?`${n}: `:"")+p,y&&(this.identifier=y),h!=null&&h.__line__&&(this.line=h.__line__)}}function fi(l){const n=l.value;return n?[new $e(l.key,n,"constants have been deprecated as of v8")]:[]}function kt(l,...n){for(const h of n)for(const p in h)l[p]=h[p];return l}function Dt(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Qi(l){if(Array.isArray(l))return l.map(Qi);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const n={};for(const h in l)n[h]=Qi(l[h]);return n}return Dt(l)}class Bi extends Error{constructor(n,h){super(h),this.message=h,this.key=n}}class Ji{constructor(n,h=[]){this.parent=n,this.bindings={};for(const[p,y]of h)this.bindings[p]=y}concat(n){return new Ji(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Ni={kind:"null"},nt={kind:"number"},Ot={kind:"string"},$t={kind:"boolean"},pe={kind:"color"},oe={kind:"object"},Ue={kind:"value"},pt={kind:"collator"},ct={kind:"formatted"},It={kind:"padding"},Xt={kind:"resolvedImage"};function Ct(l,n){return{kind:"array",itemType:l,N:n}}function He(l){if(l.kind==="array"){const n=He(l.itemType);return typeof l.N=="number"?`array<${n}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${n}>`}return l.kind}const qt=[Ni,nt,Ot,$t,pe,ct,oe,Ct(Ue),It,Xt];function Yt(l,n){if(n.kind==="error")return null;if(l.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Yt(l.itemType,n.itemType))&&(typeof l.N!="number"||l.N===n.N))return null}else{if(l.kind===n.kind)return null;if(l.kind==="value"){for(const h of qt)if(!Yt(h,n))return null}}return`Expected ${He(l)} but found ${He(n)} instead.`}function ei(l,n){return n.some(h=>h.kind===l.kind)}function ft(l,n){return n.some(h=>h==="null"?l===null:h==="array"?Array.isArray(l):h==="object"?l&&!Array.isArray(l)&&typeof l=="object":h===typeof l)}var Wt,mi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ii(l){return(l=Math.round(l))<0?0:l>255?255:l}function Ki(l){return Ii(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function Se(l){return(n=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:n>1?1:n;var n}function Xe(l,n,h){return h<0?h+=1:h>1&&(h-=1),6*h<1?l+(n-l)*h*6:2*h<1?n:3*h<2?l+(n-l)*(2/3-h)*6:l}try{Wt={}.parseCSSColor=function(l){var n,h=l.replace(/ /g,"").toLowerCase();if(h in mi)return mi[h].slice();if(h[0]==="#")return h.length===4?(n=parseInt(h.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:h.length===7&&(n=parseInt(h.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var p=h.indexOf("("),y=h.indexOf(")");if(p!==-1&&y+1===h.length){var v=h.substr(0,p),S=h.substr(p+1,y-(p+1)).split(","),M=1;switch(v){case"rgba":if(S.length!==4)return null;M=Se(S.pop());case"rgb":return S.length!==3?null:[Ki(S[0]),Ki(S[1]),Ki(S[2]),M];case"hsla":if(S.length!==4)return null;M=Se(S.pop());case"hsl":if(S.length!==3)return null;var L=(parseFloat(S[0])%360+360)%360/360,k=Se(S[1]),O=Se(S[2]),H=O<=.5?O*(k+1):O+k-O*k,j=2*O-H;return[Ii(255*Xe(j,H,L+1/3)),Ii(255*Xe(j,H,L)),Ii(255*Xe(j,H,L-1/3)),M];default:return null}}return null}}catch{}class Ke{constructor(n,h,p,y=1){this.r=n,this.g=h,this.b=p,this.a=y}static parse(n){if(!n)return;if(n instanceof Ke)return n;if(typeof n!="string")return;const h=Wt(n);return h?new Ke(h[0]/255*h[3],h[1]/255*h[3],h[2]/255*h[3],h[3]):void 0}toString(){const[n,h,p,y]=this.toArray();return`rgba(${Math.round(n)},${Math.round(h)},${Math.round(p)},${y})`}toArray(){const{r:n,g:h,b:p,a:y}=this;return y===0?[0,0,0,0]:[255*n/y,255*h/y,255*p/y,y]}}Ke.black=new Ke(0,0,0,1),Ke.white=new Ke(1,1,1,1),Ke.transparent=new Ke(0,0,0,0),Ke.red=new Ke(1,0,0,1);class Rt{constructor(n,h,p){this.sensitivity=n?h?"variant":"case":h?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,h){return this.collator.compare(n,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Nt{constructor(n,h,p,y,v){this.text=n,this.image=h,this.scale=p,this.fontStack=y,this.textColor=v}}class ci{constructor(n){this.sections=n}static fromString(n){return new ci([new Nt(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof ci?n:ci.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class li{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof li)return n;if(typeof n=="number")return new li([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const h of n)if(typeof h!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new li(n)}}toString(){return JSON.stringify(this.values)}}class ki{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new ki({name:n,available:!1}):null}}function hn(l,n,h,p){return typeof l=="number"&&l>=0&&l<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof h=="number"&&h>=0&&h<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,n,h,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,n,h,p]:[l,n,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oi(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Ke||l instanceof Rt||l instanceof ci||l instanceof li||l instanceof ki)return!0;if(Array.isArray(l)){for(const n of l)if(!Oi(n))return!1;return!0}if(typeof l=="object"){for(const n in l)if(!Oi(l[n]))return!1;return!0}return!1}function ie(l){if(l===null)return Ni;if(typeof l=="string")return Ot;if(typeof l=="boolean")return $t;if(typeof l=="number")return nt;if(l instanceof Ke)return pe;if(l instanceof Rt)return pt;if(l instanceof ci)return ct;if(l instanceof li)return It;if(l instanceof ki)return Xt;if(Array.isArray(l)){const n=l.length;let h;for(const p of l){const y=ie(p);if(h){if(h===y)continue;h=Ue;break}h=y}return Ct(h||Ue,n)}return oe}function V(l){const n=typeof l;return l===null?"":n==="string"||n==="number"||n==="boolean"?String(l):l instanceof Ke||l instanceof ci||l instanceof li||l instanceof ki?l.toString():JSON.stringify(l)}class W{constructor(n,h){this.type=n,this.value=h}static parse(n,h){if(n.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Oi(n[1]))return h.error("invalid value");const p=n[1];let y=ie(p);const v=h.expectedType;return y.kind!=="array"||y.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(y=v),new W(y,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ne{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const de={string:Ot,number:nt,boolean:$t,object:oe};class ye{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");let p,y=1;const v=n[0];if(v==="array"){let M,L;if(n.length>2){const k=n[1];if(typeof k!="string"||!(k in de)||k==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);M=de[k],y++}else M=Ue;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return h.error('The length argument to "array" must be a positive integer literal',2);L=n[2],y++}p=Ct(M,L)}else{if(!de[v])throw new Error(`Types doesn't contain name = ${v}`);p=de[v]}const S=[];for(;y<n.length;y++){const M=h.parse(n[y],y,Ue);if(!M)return null;S.push(M)}return new ye(p,S)}evaluate(n){for(let h=0;h<this.args.length;h++){const p=this.args[h].evaluate(n);if(!Yt(this.type,ie(p)))return p;if(h===this.args.length-1)throw new ne(`Expected value to be of type ${He(this.type)}, but found ${He(ie(p))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Ee={"to-boolean":$t,"to-color":pe,"to-number":nt,"to-string":Ot};class N{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");const p=n[0];if(!Ee[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&n.length!==2)return h.error("Expected one argument.");const y=Ee[p],v=[];for(let S=1;S<n.length;S++){const M=h.parse(n[S],S,Ue);if(!M)return null;v.push(M)}return new N(y,v)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let h,p;for(const y of this.args){if(h=y.evaluate(n),p=null,h instanceof Ke)return h;if(typeof h=="string"){const v=n.parseColor(h);if(v)return v}else if(Array.isArray(h)&&(p=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:hn(h[0],h[1],h[2],h[3]),!p))return new Ke(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new ne(p||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}if(this.type.kind==="padding"){let h;for(const p of this.args){h=p.evaluate(n);const y=li.parse(h);if(y)return y}throw new ne(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}if(this.type.kind==="number"){let h=null;for(const p of this.args){if(h=p.evaluate(n),h===null)return 0;const y=Number(h);if(!isNaN(y))return y}throw new ne(`Could not convert ${JSON.stringify(h)} to number.`)}return this.type.kind==="formatted"?ci.fromString(V(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ki.fromString(V(this.args[0].evaluate(n))):V(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Z=["Unknown","Point","LineString","Polygon"];class se{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Z[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let h=this._parseColorCache[n];return h||(h=this._parseColorCache[n]=Ke.parse(n)),h}}class ae{constructor(n,h,p,y){this.name=n,this.type=h,this._evaluate=p,this.args=y}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,h){const p=n[0],y=ae.definitions[p];if(!y)return h.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,M=S.filter(([k])=>!Array.isArray(k)||k.length===n.length-1);let L=null;for(const[k,O]of M){L=new In(h.registry,h.path,null,h.scope);const H=[];let j=!1;for(let Y=1;Y<n.length;Y++){const ee=n[Y],ge=Array.isArray(k)?k[Y-1]:k.type,me=L.parse(ee,1+H.length,ge);if(!me){j=!0;break}H.push(me)}if(!j)if(Array.isArray(k)&&k.length!==H.length)L.error(`Expected ${k.length} arguments, but found ${H.length} instead.`);else{for(let Y=0;Y<H.length;Y++){const ee=Array.isArray(k)?k[Y]:k.type,ge=H[Y];L.concat(Y+1).checkSubtype(ee,ge.type)}if(L.errors.length===0)return new ae(p,v,O,H)}}if(M.length===1)h.errors.push(...L.errors);else{const k=(M.length?M:S).map(([H])=>{return j=H,Array.isArray(j)?`(${j.map(He).join(", ")})`:`(${He(j.type)}...)`;var j}).join(" | "),O=[];for(let H=1;H<n.length;H++){const j=h.parse(n[H],1+O.length);if(!j)return null;O.push(He(j.type))}h.error(`Expected arguments of type ${k}, but found (${O.join(", ")}) instead.`)}return null}static register(n,h){ae.definitions=h;for(const p in h)n[p]=ae}}class xe{constructor(n,h,p){this.type=pt,this.locale=p,this.caseSensitive=n,this.diacriticSensitive=h}static parse(n,h){if(n.length!==2)return h.error("Expected one argument.");const p=n[1];if(typeof p!="object"||Array.isArray(p))return h.error("Collator options argument must be an object.");const y=h.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,$t);if(!y)return null;const v=h.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,$t);if(!v)return null;let S=null;return p.locale&&(S=h.parse(p.locale,1,Ot),!S)?null:new xe(y,v,S)}evaluate(n){return new Rt(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const De=8192;function st(l,n){l[0]=Math.min(l[0],n[0]),l[1]=Math.min(l[1],n[1]),l[2]=Math.max(l[2],n[0]),l[3]=Math.max(l[3],n[1])}function ht(l,n){return!(l[0]<=n[0]||l[2]>=n[2]||l[1]<=n[1]||l[3]>=n[3])}function ot(l,n){const h=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,y=Math.pow(2,n.z);return[Math.round(h*y*De),Math.round(p*y*De)]}function gt(l,n,h){const p=l[0]-n[0],y=l[1]-n[1],v=l[0]-h[0],S=l[1]-h[1];return p*S-v*y==0&&p*v<=0&&y*S<=0}function Tt(l,n){let h=!1;for(let S=0,M=n.length;S<M;S++){const L=n[S];for(let k=0,O=L.length;k<O-1;k++){if(gt(l,L[k],L[k+1]))return!1;(y=L[k])[1]>(p=l)[1]!=(v=L[k+1])[1]>p[1]&&p[0]<(v[0]-y[0])*(p[1]-y[1])/(v[1]-y[1])+y[0]&&(h=!h)}}var p,y,v;return h}function Ht(l,n){for(let h=0;h<n.length;h++)if(Tt(l,n[h]))return!0;return!1}function zt(l,n,h,p){const y=p[0]-h[0],v=p[1]-h[1],S=(l[0]-h[0])*v-y*(l[1]-h[1]),M=(n[0]-h[0])*v-y*(n[1]-h[1]);return S>0&&M<0||S<0&&M>0}function si(l,n,h){for(const k of h)for(let O=0;O<k.length-1;++O)if((M=[(S=k[O+1])[0]-(v=k[O])[0],S[1]-v[1]])[0]*(L=[(y=n)[0]-(p=l)[0],y[1]-p[1]])[1]-M[1]*L[0]!=0&&zt(p,y,v,S)&&zt(v,S,p,y))return!0;var p,y,v,S,M,L;return!1}function xi(l,n){for(let h=0;h<l.length;++h)if(!Tt(l[h],n))return!1;for(let h=0;h<l.length-1;++h)if(si(l[h],l[h+1],n))return!1;return!0}function Vi(l,n){for(let h=0;h<n.length;h++)if(xi(l,n[h]))return!0;return!1}function bi(l,n,h){const p=[];for(let y=0;y<l.length;y++){const v=[];for(let S=0;S<l[y].length;S++){const M=ot(l[y][S],h);st(n,M),v.push(M)}p.push(v)}return p}function ii(l,n,h){const p=[];for(let y=0;y<l.length;y++){const v=bi(l[y],n,h);p.push(v)}return p}function Is(l,n,h,p){if(l[0]<h[0]||l[0]>h[2]){const y=.5*p;let v=l[0]-h[0]>y?-p:h[0]-l[0]>y?p:0;v===0&&(v=l[0]-h[2]>y?-p:h[2]-l[0]>y?p:0),l[0]+=v}st(n,l)}function En(l,n,h,p){const y=Math.pow(2,p.z)*De,v=[p.x*De,p.y*De],S=[];for(const M of l)for(const L of M){const k=[L.x+v[0],L.y+v[1]];Is(k,n,h,y),S.push(k)}return S}function Cs(l,n,h,p){const y=Math.pow(2,p.z)*De,v=[p.x*De,p.y*De],S=[];for(const L of l){const k=[];for(const O of L){const H=[O.x+v[0],O.y+v[1]];st(n,H),k.push(H)}S.push(k)}if(n[2]-n[0]<=y/2){(M=n)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const L of S)for(const k of L)Is(k,n,h,y)}var M;return S}class Ms{constructor(n,h){this.type=$t,this.geojson=n,this.geometries=h}static parse(n,h){if(n.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Oi(n[1])){const p=n[1];if(p.type==="FeatureCollection")for(let y=0;y<p.features.length;++y){const v=p.features[y].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ms(p,p.features[y].geometry)}else if(p.type==="Feature"){const y=p.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ms(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Ms(p,p)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(h,p){const y=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if(p.type==="Polygon"){const M=bi(p.coordinates,v,S),L=En(h.geometry(),y,v,S);if(!ht(y,v))return!1;for(const k of L)if(!Tt(k,M))return!1}if(p.type==="MultiPolygon"){const M=ii(p.coordinates,v,S),L=En(h.geometry(),y,v,S);if(!ht(y,v))return!1;for(const k of L)if(!Ht(k,M))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(h,p){const y=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],S=h.canonicalID();if(p.type==="Polygon"){const M=bi(p.coordinates,v,S),L=Cs(h.geometry(),y,v,S);if(!ht(y,v))return!1;for(const k of L)if(!xi(k,M))return!1}if(p.type==="MultiPolygon"){const M=ii(p.coordinates,v,S),L=Cs(h.geometry(),y,v,S);if(!ht(y,v))return!1;for(const k of L)if(!Vi(k,M))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Ts(l){if(l instanceof ae&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Ms)return!1;let n=!0;return l.eachChild(h=>{n&&!Ts(h)&&(n=!1)}),n}function Bs(l){if(l instanceof ae&&l.name==="feature-state")return!1;let n=!0;return l.eachChild(h=>{n&&!Bs(h)&&(n=!1)}),n}function un(l,n){if(l instanceof ae&&n.indexOf(l.name)>=0)return!1;let h=!0;return l.eachChild(p=>{h&&!un(p,n)&&(h=!1)}),h}class qr{constructor(n,h){this.type=h.type,this.name=n,this.boundExpression=h}static parse(n,h){if(n.length!==2||typeof n[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const p=n[1];return h.scope.has(p)?new qr(p,h.scope.get(p)):h.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class ja{constructor(n,h=[],p,y=new Ji,v=[]){this.registry=n,this.path=h,this.key=h.map(S=>`[${S}]`).join(""),this.scope=y,this.errors=v,this.expectedType=p}parse(n,h,p,y,v={}){return h?this.concat(h,p,y)._parse(n,v):this._parse(n,v)}_parse(n,h){function p(y,v,S){return S==="assert"?new ye(v,[y]):S==="coerce"?new N(v,[y]):y}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=n[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[y];if(v){let S=v.parse(n,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,L=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||L.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string")if(M.kind!=="padding"||L.kind!=="value"&&L.kind!=="number"&&L.kind!=="array"){if(this.checkSubtype(M,L))return null}else S=p(S,M,h.typeAnnotation||"coerce");else S=p(S,M,h.typeAnnotation||"coerce");else S=p(S,M,h.typeAnnotation||"assert")}if(!(S instanceof W)&&S.type.kind!=="resolvedImage"&&Xa(S)){const M=new se;try{S=new W(S.type,S.evaluate(M))}catch(L){return this.error(L.message),null}}return S}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,h,p){const y=typeof n=="number"?this.path.concat(n):this.path,v=p?this.scope.concat(p):this.scope;return new ja(this.registry,y,h||null,v,this.errors)}error(n,...h){const p=`${this.key}${h.map(y=>`[${y}]`).join("")}`;this.errors.push(new Bi(p,n))}checkSubtype(n,h){const p=Yt(n,h);return p&&this.error(p),p}}var In=ja;function Xa(l){if(l instanceof qr)return Xa(l.boundExpression);if(l instanceof ae&&l.name==="error"||l instanceof xe||l instanceof Ms)return!1;const n=l instanceof N||l instanceof ye;let h=!0;return l.eachChild(p=>{h=n?h&&Xa(p):h&&p instanceof W}),!!h&&Ts(l)&&un(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function No(l,n){const h=l.length-1;let p,y,v=0,S=h,M=0;for(;v<=S;)if(M=Math.floor((v+S)/2),p=l[M],y=l[M+1],p<=n){if(M===h||n<y)return M;v=M+1}else{if(!(p>n))throw new ne("Input is not a number.");S=M-1}return 0}class _a{constructor(n,h,p){this.type=n,this.input=h,this.labels=[],this.outputs=[];for(const[y,v]of p)this.labels.push(y),this.outputs.push(v)}static parse(n,h){if(n.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return h.error("Expected an even number of arguments.");const p=h.parse(n[1],1,nt);if(!p)return null;const y=[];let v=null;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);for(let S=1;S<n.length;S+=2){const M=S===1?-1/0:n[S],L=n[S+1],k=S,O=S+1;if(typeof M!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(y.length&&y[y.length-1][0]>=M)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const H=h.parse(L,O,v);if(!H)return null;v=v||H.type,y.push([M,H])}return new _a(v,p,y)}evaluate(n){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(n);const y=this.input.evaluate(n);if(y<=h[0])return p[0].evaluate(n);const v=h.length;return y>=h[v-1]?p[v-1].evaluate(n):p[No(h,y)].evaluate(n)}eachChild(n){n(this.input);for(const h of this.outputs)n(h)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function sn(l,n,h){return l*(1-h)+n*h}var Ya=Object.freeze({__proto__:null,array:function(l,n,h){return l.map((p,y)=>sn(p,n[y],h))},color:function(l,n,h){return new Ke(sn(l.r,n.r,h),sn(l.g,n.g,h),sn(l.b,n.b,h),sn(l.a,n.a,h))},number:sn,padding:function(l,n,h){const p=l.values,y=n.values;return new li([sn(p[0],y[0],h),sn(p[1],y[1],h),sn(p[2],y[2],h),sn(p[3],y[3],h)])}});const ym=.95047,xm=1.08883,vm=4/29,$r=6/29,mh=3*$r*$r,fd=Math.PI/180,Ul=180/Math.PI;function zi(l){return l>.008856451679035631?Math.pow(l,1/3):l/mh+vm}function md(l){return l>$r?l*l*l:mh*(l-vm)}function Fl(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function gd(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Ad(l){const n=gd(l.r),h=gd(l.g),p=gd(l.b),y=zi((.4124564*n+.3575761*h+.1804375*p)/ym),v=zi((.2126729*n+.7151522*h+.072175*p)/1);return{l:116*v-16,a:500*(y-v),b:200*(v-zi((.0193339*n+.119192*h+.9503041*p)/xm)),alpha:l.a}}function _d(l){let n=(l.l+16)/116,h=isNaN(l.a)?n:n+l.a/500,p=isNaN(l.b)?n:n-l.b/200;return n=1*md(n),h=ym*md(h),p=xm*md(p),new Ke(Fl(3.2404542*h-1.5371385*n-.4985314*p),Fl(-.969266*h+1.8760108*n+.041556*p),Fl(.0556434*h-.2040259*n+1.0572252*p),l.alpha)}function H0(l,n,h){const p=n-l;return l+h*(p>180||p<-180?p-360*Math.round(p/360):p)}const Oo={forward:Ad,reverse:_d,interpolate:function(l,n,h){return{l:sn(l.l,n.l,h),a:sn(l.a,n.a,h),b:sn(l.b,n.b,h),alpha:sn(l.alpha,n.alpha,h)}}},zo={forward:function(l){const{l:n,a:h,b:p}=Ad(l),y=Math.atan2(p,h)*Ul;return{h:y<0?y+360:y,c:Math.sqrt(h*h+p*p),l:n,alpha:l.a}},reverse:function(l){const n=l.h*fd,h=l.c;return _d({l:l.l,a:Math.cos(n)*h,b:Math.sin(n)*h,alpha:l.alpha})},interpolate:function(l,n,h){return{h:H0(l.h,n.h,h),c:sn(l.c,n.c,h),l:sn(l.l,n.l,h),alpha:sn(l.alpha,n.alpha,h)}}};var bm=Object.freeze({__proto__:null,hcl:zo,lab:Oo});class Dr{constructor(n,h,p,y,v){this.type=n,this.operator=h,this.interpolation=p,this.input=y,this.labels=[],this.outputs=[];for(const[S,M]of v)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(n,h,p,y){let v=0;if(n.name==="exponential")v=yd(h,n.base,p,y);else if(n.name==="linear")v=yd(h,1,p,y);else if(n.name==="cubic-bezier"){const S=n.controlPoints;v=new m(S[0],S[1],S[2],S[3]).solve(yd(h,1,p,y))}return v}static parse(n,h){let[p,y,v,...S]=n;if(!Array.isArray(y)||y.length===0)return h.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const k=y[1];if(typeof k!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:k}}else{if(y[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const k=y.slice(1);if(k.length!==4||k.some(O=>typeof O!="number"||O<0||O>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:k}}}if(n.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(v=h.parse(v,2,nt),!v)return null;const M=[];let L=null;p==="interpolate-hcl"||p==="interpolate-lab"?L=pe:h.expectedType&&h.expectedType.kind!=="value"&&(L=h.expectedType);for(let k=0;k<S.length;k+=2){const O=S[k],H=S[k+1],j=k+3,Y=k+4;if(typeof O!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(M.length&&M[M.length-1][0]>=O)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const ee=h.parse(H,Y,L);if(!ee)return null;L=L||ee.type,M.push([O,ee])}return L.kind==="number"||L.kind==="color"||L.kind==="padding"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new Dr(L,p,y,v,M):h.error(`Type ${He(L)} is not interpolatable.`)}evaluate(n){const h=this.labels,p=this.outputs;if(h.length===1)return p[0].evaluate(n);const y=this.input.evaluate(n);if(y<=h[0])return p[0].evaluate(n);const v=h.length;if(y>=h[v-1])return p[v-1].evaluate(n);const S=No(h,y),M=Dr.interpolationFactor(this.interpolation,y,h[S],h[S+1]),L=p[S].evaluate(n),k=p[S+1].evaluate(n);return this.operator==="interpolate"?Ya[this.type.kind.toLowerCase()](L,k,M):this.operator==="interpolate-hcl"?zo.reverse(zo.interpolate(zo.forward(L),zo.forward(k),M)):Oo.reverse(Oo.interpolate(Oo.forward(L),Oo.forward(k),M))}eachChild(n){n(this.input);for(const h of this.outputs)n(h)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function yd(l,n,h,p){const y=p-h,v=l-h;return y===0?0:n===1?v/y:(Math.pow(n,v)-1)/(Math.pow(n,y)-1)}class gh{constructor(n,h){this.type=n,this.args=h}static parse(n,h){if(n.length<2)return h.error("Expectected at least one argument.");let p=null;const y=h.expectedType;y&&y.kind!=="value"&&(p=y);const v=[];for(const M of n.slice(1)){const L=h.parse(M,1+v.length,p,void 0,{typeAnnotation:"omit"});if(!L)return null;p=p||L.type,v.push(L)}if(!p)throw new Error("No output type");const S=y&&v.some(M=>Yt(y,M.type));return new gh(S?Ue:p,v)}evaluate(n){let h,p=null,y=0;for(const v of this.args)if(y++,p=v.evaluate(n),p&&p instanceof ki&&!p.available&&(h||(h=p.name),p=null,y===this.args.length&&(p=h)),p!==null)break;return p}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class kl{constructor(n,h){this.type=h.type,this.bindings=[].concat(n),this.result=h}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const h of this.bindings)n(h[1]);n(this.result)}static parse(n,h){if(n.length<4)return h.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const p=[];for(let v=1;v<n.length-1;v+=2){const S=n[v];if(typeof S!="string")return h.error(`Expected string, but found ${typeof S} instead.`,v);if(/[^a-zA-Z0-9_]/.test(S))return h.error("Variable names must contain only alphanumeric characters or '_'.",v);const M=h.parse(n[v+1],v+1);if(!M)return null;p.push([S,M])}const y=h.parse(n[n.length-1],n.length-1,h.expectedType,p);return y?new kl(p,y):null}outputDefined(){return this.result.outputDefined()}}class Ah{constructor(n,h,p){this.type=n,this.index=h,this.input=p}static parse(n,h){if(n.length!==3)return h.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,nt),y=h.parse(n[2],2,Ct(h.expectedType||Ue));return p&&y?new Ah(y.type.itemType,p,y):null}evaluate(n){const h=this.index.evaluate(n),p=this.input.evaluate(n);if(h<0)throw new ne(`Array index out of bounds: ${h} < 0.`);if(h>=p.length)throw new ne(`Array index out of bounds: ${h} > ${p.length-1}.`);if(h!==Math.floor(h))throw new ne(`Array index must be an integer, but found ${h} instead.`);return p[h]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class xd{constructor(n,h){this.type=$t,this.needle=n,this.haystack=h}static parse(n,h){if(n.length!==3)return h.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Ue),y=h.parse(n[2],2,Ue);return p&&y?ei(p.type,[$t,Ot,nt,Ni,Ue])?new xd(p,y):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(p.type)} instead`):null}evaluate(n){const h=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!p)return!1;if(!ft(h,["boolean","string","number","null"]))throw new ne(`Expected first argument to be of type boolean, string, number or null, but found ${He(ie(h))} instead.`);if(!ft(p,["string","array"]))throw new ne(`Expected second argument to be of type array or string, but found ${He(ie(p))} instead.`);return p.indexOf(h)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class _h{constructor(n,h,p){this.type=nt,this.needle=n,this.haystack=h,this.fromIndex=p}static parse(n,h){if(n.length<=2||n.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Ue),y=h.parse(n[2],2,Ue);if(!p||!y)return null;if(!ei(p.type,[$t,Ot,nt,Ni,Ue]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${He(p.type)} instead`);if(n.length===4){const v=h.parse(n[3],3,nt);return v?new _h(p,y,v):null}return new _h(p,y)}evaluate(n){const h=this.needle.evaluate(n),p=this.haystack.evaluate(n);if(!ft(h,["boolean","string","number","null"]))throw new ne(`Expected first argument to be of type boolean, string, number or null, but found ${He(ie(h))} instead.`);if(!ft(p,["string","array"]))throw new ne(`Expected second argument to be of type array or string, but found ${He(ie(p))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(n);return p.indexOf(h,y)}return p.indexOf(h)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class Nl{constructor(n,h,p,y,v,S){this.inputType=n,this.type=h,this.input=p,this.cases=y,this.outputs=v,this.otherwise=S}static parse(n,h){if(n.length<5)return h.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return h.error("Expected an even number of arguments.");let p,y;h.expectedType&&h.expectedType.kind!=="value"&&(y=h.expectedType);const v={},S=[];for(let k=2;k<n.length-1;k+=2){let O=n[k];const H=n[k+1];Array.isArray(O)||(O=[O]);const j=h.concat(k);if(O.length===0)return j.error("Expected at least one branch label.");for(const ee of O){if(typeof ee!="number"&&typeof ee!="string")return j.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return j.error("Numeric branch labels must be integer values.");if(p){if(j.checkSubtype(p,ie(ee)))return null}else p=ie(ee);if(v[String(ee)]!==void 0)return j.error("Branch labels must be unique.");v[String(ee)]=S.length}const Y=h.parse(H,k,y);if(!Y)return null;y=y||Y.type,S.push(Y)}const M=h.parse(n[1],1,Ue);if(!M)return null;const L=h.parse(n[n.length-1],n.length-1,y);return L?M.type.kind!=="value"&&h.concat(1).checkSubtype(p,M.type)?null:new Nl(p,y,M,v,S,L):null}evaluate(n){const h=this.input.evaluate(n);return(ie(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class vd{constructor(n,h,p){this.type=n,this.branches=h,this.otherwise=p}static parse(n,h){if(n.length<4)return h.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return h.error("Expected an odd number of arguments.");let p;h.expectedType&&h.expectedType.kind!=="value"&&(p=h.expectedType);const y=[];for(let S=1;S<n.length-1;S+=2){const M=h.parse(n[S],S,$t);if(!M)return null;const L=h.parse(n[S+1],S+1,p);if(!L)return null;y.push([M,L]),p=p||L.type}const v=h.parse(n[n.length-1],n.length-1,p);if(!v)return null;if(!p)throw new Error("Can't infer output type");return new vd(p,y,v)}evaluate(n){for(const[h,p]of this.branches)if(h.evaluate(n))return p.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[h,p]of this.branches)n(h),n(p);n(this.otherwise)}outputDefined(){return this.branches.every(([n,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class yh{constructor(n,h,p,y){this.type=n,this.input=h,this.beginIndex=p,this.endIndex=y}static parse(n,h){if(n.length<=2||n.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const p=h.parse(n[1],1,Ue),y=h.parse(n[2],2,nt);if(!p||!y)return null;if(!ei(p.type,[Ct(Ue),Ot,Ue]))return h.error(`Expected first argument to be of type array or string, but found ${He(p.type)} instead`);if(n.length===4){const v=h.parse(n[3],3,nt);return v?new yh(p.type,p,y,v):null}return new yh(p.type,p,y)}evaluate(n){const h=this.input.evaluate(n),p=this.beginIndex.evaluate(n);if(!ft(h,["string","array"]))throw new ne(`Expected first argument to be of type array or string, but found ${He(ie(h))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(n);return h.slice(p,y)}return h.slice(p)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function wm(l,n){return l==="=="||l==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function bd(l,n,h,p){return p.compare(n,h)===0}function Ka(l,n,h){const p=l!=="=="&&l!=="!=";return class JC{constructor(v,S,M){this.type=$t,this.lhs=v,this.rhs=S,this.collator=M,this.hasUntypedArgument=v.type.kind==="value"||S.type.kind==="value"}static parse(v,S){if(v.length!==3&&v.length!==4)return S.error("Expected two or three arguments.");const M=v[0];let L=S.parse(v[1],1,Ue);if(!L)return null;if(!wm(M,L.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${He(L.type)}'.`);let k=S.parse(v[2],2,Ue);if(!k)return null;if(!wm(M,k.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${He(k.type)}'.`);if(L.type.kind!==k.type.kind&&L.type.kind!=="value"&&k.type.kind!=="value")return S.error(`Cannot compare types '${He(L.type)}' and '${He(k.type)}'.`);p&&(L.type.kind==="value"&&k.type.kind!=="value"?L=new ye(k.type,[L]):L.type.kind!=="value"&&k.type.kind==="value"&&(k=new ye(L.type,[k])));let O=null;if(v.length===4){if(L.type.kind!=="string"&&k.type.kind!=="string"&&L.type.kind!=="value"&&k.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(O=S.parse(v[3],3,pt),!O)return null}return new JC(L,k,O)}evaluate(v){const S=this.lhs.evaluate(v),M=this.rhs.evaluate(v);if(p&&this.hasUntypedArgument){const L=ie(S),k=ie(M);if(L.kind!==k.kind||L.kind!=="string"&&L.kind!=="number")throw new ne(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${L.kind}, ${k.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const L=ie(S),k=ie(M);if(L.kind!=="string"||k.kind!=="string")return n(v,S,M)}return this.collator?h(v,S,M,this.collator.evaluate(v)):n(v,S,M)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const W0=Ka("==",function(l,n,h){return n===h},bd),q0=Ka("!=",function(l,n,h){return n!==h},function(l,n,h,p){return!bd(0,n,h,p)}),Em=Ka("<",function(l,n,h){return n<h},function(l,n,h,p){return p.compare(n,h)<0}),Sm=Ka(">",function(l,n,h){return n>h},function(l,n,h,p){return p.compare(n,h)>0}),$0=Ka("<=",function(l,n,h){return n<=h},function(l,n,h,p){return p.compare(n,h)<=0}),j0=Ka(">=",function(l,n,h){return n>=h},function(l,n,h,p){return p.compare(n,h)>=0});class wd{constructor(n,h,p,y,v){this.type=Ot,this.number=n,this.locale=h,this.currency=p,this.minFractionDigits=y,this.maxFractionDigits=v}static parse(n,h){if(n.length!==3)return h.error("Expected two arguments.");const p=h.parse(n[1],1,nt);if(!p)return null;const y=n[2];if(typeof y!="object"||Array.isArray(y))return h.error("NumberFormat options argument must be an object.");let v=null;if(y.locale&&(v=h.parse(y.locale,1,Ot),!v))return null;let S=null;if(y.currency&&(S=h.parse(y.currency,1,Ot),!S))return null;let M=null;if(y["min-fraction-digits"]&&(M=h.parse(y["min-fraction-digits"],1,nt),!M))return null;let L=null;return y["max-fraction-digits"]&&(L=h.parse(y["max-fraction-digits"],1,nt),!L)?null:new wd(p,v,S,M,L)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class xh{constructor(n){this.type=ct,this.sections=n}static parse(n,h){if(n.length<2)return h.error("Expected at least one argument.");const p=n[1];if(!Array.isArray(p)&&typeof p=="object")return h.error("First argument must be an image or text section.");const y=[];let v=!1;for(let S=1;S<=n.length-1;++S){const M=n[S];if(v&&typeof M=="object"&&!Array.isArray(M)){v=!1;let L=null;if(M["font-scale"]&&(L=h.parse(M["font-scale"],1,nt),!L))return null;let k=null;if(M["text-font"]&&(k=h.parse(M["text-font"],1,Ct(Ot)),!k))return null;let O=null;if(M["text-color"]&&(O=h.parse(M["text-color"],1,pe),!O))return null;const H=y[y.length-1];H.scale=L,H.font=k,H.textColor=O}else{const L=h.parse(n[S],1,Ue);if(!L)return null;const k=L.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,y.push({content:L,scale:null,font:null,textColor:null})}}return new xh(y)}evaluate(n){return new ci(this.sections.map(h=>{const p=h.content.evaluate(n);return ie(p)===Xt?new Nt("",p,null,null,null):new Nt(V(p),null,h.scale?h.scale.evaluate(n):null,h.font?h.font.evaluate(n).join(","):null,h.textColor?h.textColor.evaluate(n):null)}))}eachChild(n){for(const h of this.sections)n(h.content),h.scale&&n(h.scale),h.font&&n(h.font),h.textColor&&n(h.textColor)}outputDefined(){return!1}}class Ed{constructor(n){this.type=Xt,this.input=n}static parse(n,h){if(n.length!==2)return h.error("Expected two arguments.");const p=h.parse(n[1],1,Ot);return p?new Ed(p):h.error("No image name provided.")}evaluate(n){const h=this.input.evaluate(n),p=ki.fromString(h);return p&&n.availableImages&&(p.available=n.availableImages.indexOf(h)>-1),p}eachChild(n){n(this.input)}outputDefined(){return!1}}class Sd{constructor(n){this.type=nt,this.input=n}static parse(n,h){if(n.length!==2)return h.error(`Expected 1 argument, but found ${n.length-1} instead.`);const p=h.parse(n[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${He(p.type)} instead.`):new Sd(p):null}evaluate(n){const h=this.input.evaluate(n);if(typeof h=="string"||Array.isArray(h))return h.length;throw new ne(`Expected value to be of type string or array, but found ${He(ie(h))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Go={"==":W0,"!=":q0,">":Sm,"<":Em,">=":j0,"<=":$0,array:ye,at:Ah,boolean:ye,case:vd,coalesce:gh,collator:xe,format:xh,image:Ed,in:xd,"index-of":_h,interpolate:Dr,"interpolate-hcl":Dr,"interpolate-lab":Dr,length:Sd,let:kl,literal:W,match:Nl,number:ye,"number-format":wd,object:ye,slice:yh,step:_a,string:ye,"to-boolean":N,"to-color":N,"to-number":N,"to-string":N,var:qr,within:Ms};function Ri(l,[n,h,p,y]){n=n.evaluate(l),h=h.evaluate(l),p=p.evaluate(l);const v=y?y.evaluate(l):1,S=hn(n,h,p,v);if(S)throw new ne(S);return new Ke(n/255*v,h/255*v,p/255*v,v)}function Im(l,n){return l in n}function Id(l,n){const h=n[l];return h===void 0?null:h}function Za(l){return{type:l}}function Cm(l){return{result:"success",value:l}}function Qo(l){return{result:"error",value:l}}function Vo(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Mm(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Cd(l){return!!l.expression&&l.expression.interpolated}function Gi(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function vh(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function X0(l){return l}function Tm(l,n){const h=n.type==="color",p=l.stops&&typeof l.stops[0][0]=="object",y=p||!(p||l.property!==void 0),v=l.type||(Cd(n)?"exponential":"interval");if(h||n.type==="padding"){const k=h?Ke.parse:li.parse;(l=kt({},l)).stops&&(l.stops=l.stops.map(O=>[O[0],k(O[1])])),l.default=k(l.default?l.default:n.default)}if(l.colorSpace&&l.colorSpace!=="rgb"&&!bm[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let S,M,L;if(v==="exponential")S=Bm;else if(v==="interval")S=K0;else if(v==="categorical"){S=Y0,M=Object.create(null);for(const k of l.stops)M[k[0]]=k[1];L=typeof l.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);S=Z0}if(p){const k={},O=[];for(let Y=0;Y<l.stops.length;Y++){const ee=l.stops[Y],ge=ee[0].zoom;k[ge]===void 0&&(k[ge]={zoom:ge,type:l.type,property:l.property,default:l.default,stops:[]},O.push(ge)),k[ge].stops.push([ee[0].value,ee[1]])}const H=[];for(const Y of O)H.push([k[Y].zoom,Tm(k[Y],n)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:Dr.interpolationFactor.bind(void 0,j),zoomStops:H.map(Y=>Y[0]),evaluate:({zoom:Y},ee)=>Bm({stops:H,base:l.base},n,Y).evaluate(Y,ee)}}if(y){const k=v==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:Dr.interpolationFactor.bind(void 0,k),zoomStops:l.stops.map(O=>O[0]),evaluate:({zoom:O})=>S(l,n,O,M,L)}}return{kind:"source",evaluate(k,O){const H=O&&O.properties?O.properties[l.property]:void 0;return H===void 0?Ol(l.default,n.default):S(l,n,H,M,L)}}}function Ol(l,n,h){return l!==void 0?l:n!==void 0?n:h!==void 0?h:void 0}function Y0(l,n,h,p,y){return Ol(typeof h===y?p[h]:void 0,l.default,n.default)}function K0(l,n,h){if(Gi(h)!=="number")return Ol(l.default,n.default);const p=l.stops.length;if(p===1||h<=l.stops[0][0])return l.stops[0][1];if(h>=l.stops[p-1][0])return l.stops[p-1][1];const y=No(l.stops.map(v=>v[0]),h);return l.stops[y][1]}function Bm(l,n,h){const p=l.base!==void 0?l.base:1;if(Gi(h)!=="number")return Ol(l.default,n.default);const y=l.stops.length;if(y===1||h<=l.stops[0][0])return l.stops[0][1];if(h>=l.stops[y-1][0])return l.stops[y-1][1];const v=No(l.stops.map(O=>O[0]),h),S=function(O,H,j,Y){const ee=Y-j,ge=O-j;return ee===0?0:H===1?ge/ee:(Math.pow(H,ge)-1)/(Math.pow(H,ee)-1)}(h,p,l.stops[v][0],l.stops[v+1][0]),M=l.stops[v][1],L=l.stops[v+1][1];let k=Ya[n.type]||X0;if(l.colorSpace&&l.colorSpace!=="rgb"){const O=bm[l.colorSpace];k=(H,j)=>O.reverse(O.interpolate(O.forward(H),O.forward(j),S))}return typeof M.evaluate=="function"?{evaluate(...O){const H=M.evaluate.apply(void 0,O),j=L.evaluate.apply(void 0,O);if(H!==void 0&&j!==void 0)return k(H,j,S)}}:k(M,L,S)}function Z0(l,n,h){switch(n.type){case"color":h=Ke.parse(h);break;case"formatted":h=ci.fromString(h.toString());break;case"resolvedImage":h=ki.fromString(h.toString());break;case"padding":h=li.parse(h);break;default:Gi(h)===n.type||n.type==="enum"&&n.values[h]||(h=void 0)}return Ol(h,l.default,n.default)}ae.register(Go,{error:[{kind:"error"},[Ot],(l,[n])=>{throw new ne(n.evaluate(l))}],typeof:[Ot,[Ue],(l,[n])=>He(ie(n.evaluate(l)))],"to-rgba":[Ct(nt,4),[pe],(l,[n])=>n.evaluate(l).toArray()],rgb:[pe,[nt,nt,nt],Ri],rgba:[pe,[nt,nt,nt,nt],Ri],has:{type:$t,overloads:[[[Ot],(l,[n])=>Im(n.evaluate(l),l.properties())],[[Ot,oe],(l,[n,h])=>Im(n.evaluate(l),h.evaluate(l))]]},get:{type:Ue,overloads:[[[Ot],(l,[n])=>Id(n.evaluate(l),l.properties())],[[Ot,oe],(l,[n,h])=>Id(n.evaluate(l),h.evaluate(l))]]},"feature-state":[Ue,[Ot],(l,[n])=>Id(n.evaluate(l),l.featureState||{})],properties:[oe,[],l=>l.properties()],"geometry-type":[Ot,[],l=>l.geometryType()],id:[Ue,[],l=>l.id()],zoom:[nt,[],l=>l.globals.zoom],"heatmap-density":[nt,[],l=>l.globals.heatmapDensity||0],"line-progress":[nt,[],l=>l.globals.lineProgress||0],accumulated:[Ue,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[nt,Za(nt),(l,n)=>{let h=0;for(const p of n)h+=p.evaluate(l);return h}],"*":[nt,Za(nt),(l,n)=>{let h=1;for(const p of n)h*=p.evaluate(l);return h}],"-":{type:nt,overloads:[[[nt,nt],(l,[n,h])=>n.evaluate(l)-h.evaluate(l)],[[nt],(l,[n])=>-n.evaluate(l)]]},"/":[nt,[nt,nt],(l,[n,h])=>n.evaluate(l)/h.evaluate(l)],"%":[nt,[nt,nt],(l,[n,h])=>n.evaluate(l)%h.evaluate(l)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(l,[n,h])=>Math.pow(n.evaluate(l),h.evaluate(l))],sqrt:[nt,[nt],(l,[n])=>Math.sqrt(n.evaluate(l))],log10:[nt,[nt],(l,[n])=>Math.log(n.evaluate(l))/Math.LN10],ln:[nt,[nt],(l,[n])=>Math.log(n.evaluate(l))],log2:[nt,[nt],(l,[n])=>Math.log(n.evaluate(l))/Math.LN2],sin:[nt,[nt],(l,[n])=>Math.sin(n.evaluate(l))],cos:[nt,[nt],(l,[n])=>Math.cos(n.evaluate(l))],tan:[nt,[nt],(l,[n])=>Math.tan(n.evaluate(l))],asin:[nt,[nt],(l,[n])=>Math.asin(n.evaluate(l))],acos:[nt,[nt],(l,[n])=>Math.acos(n.evaluate(l))],atan:[nt,[nt],(l,[n])=>Math.atan(n.evaluate(l))],min:[nt,Za(nt),(l,n)=>Math.min(...n.map(h=>h.evaluate(l)))],max:[nt,Za(nt),(l,n)=>Math.max(...n.map(h=>h.evaluate(l)))],abs:[nt,[nt],(l,[n])=>Math.abs(n.evaluate(l))],round:[nt,[nt],(l,[n])=>{const h=n.evaluate(l);return h<0?-Math.round(-h):Math.round(h)}],floor:[nt,[nt],(l,[n])=>Math.floor(n.evaluate(l))],ceil:[nt,[nt],(l,[n])=>Math.ceil(n.evaluate(l))],"filter-==":[$t,[Ot,Ue],(l,[n,h])=>l.properties()[n.value]===h.value],"filter-id-==":[$t,[Ue],(l,[n])=>l.id()===n.value],"filter-type-==":[$t,[Ot],(l,[n])=>l.geometryType()===n.value],"filter-<":[$t,[Ot,Ue],(l,[n,h])=>{const p=l.properties()[n.value],y=h.value;return typeof p==typeof y&&p<y}],"filter-id-<":[$t,[Ue],(l,[n])=>{const h=l.id(),p=n.value;return typeof h==typeof p&&h<p}],"filter->":[$t,[Ot,Ue],(l,[n,h])=>{const p=l.properties()[n.value],y=h.value;return typeof p==typeof y&&p>y}],"filter-id->":[$t,[Ue],(l,[n])=>{const h=l.id(),p=n.value;return typeof h==typeof p&&h>p}],"filter-<=":[$t,[Ot,Ue],(l,[n,h])=>{const p=l.properties()[n.value],y=h.value;return typeof p==typeof y&&p<=y}],"filter-id-<=":[$t,[Ue],(l,[n])=>{const h=l.id(),p=n.value;return typeof h==typeof p&&h<=p}],"filter->=":[$t,[Ot,Ue],(l,[n,h])=>{const p=l.properties()[n.value],y=h.value;return typeof p==typeof y&&p>=y}],"filter-id->=":[$t,[Ue],(l,[n])=>{const h=l.id(),p=n.value;return typeof h==typeof p&&h>=p}],"filter-has":[$t,[Ue],(l,[n])=>n.value in l.properties()],"filter-has-id":[$t,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[$t,[Ct(Ot)],(l,[n])=>n.value.indexOf(l.geometryType())>=0],"filter-id-in":[$t,[Ct(Ue)],(l,[n])=>n.value.indexOf(l.id())>=0],"filter-in-small":[$t,[Ot,Ct(Ue)],(l,[n,h])=>h.value.indexOf(l.properties()[n.value])>=0],"filter-in-large":[$t,[Ot,Ct(Ue)],(l,[n,h])=>function(p,y,v,S){for(;v<=S;){const M=v+S>>1;if(y[M]===p)return!0;y[M]>p?S=M-1:v=M+1}return!1}(l.properties()[n.value],h.value,0,h.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(l,[n,h])=>n.evaluate(l)&&h.evaluate(l)],[Za($t),(l,n)=>{for(const h of n)if(!h.evaluate(l))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(l,[n,h])=>n.evaluate(l)||h.evaluate(l)],[Za($t),(l,n)=>{for(const h of n)if(h.evaluate(l))return!0;return!1}]]},"!":[$t,[$t],(l,[n])=>!n.evaluate(l)],"is-supported-script":[$t,[Ot],(l,[n])=>{const h=l.globals&&l.globals.isSupportedScript;return!h||h(n.evaluate(l))}],upcase:[Ot,[Ot],(l,[n])=>n.evaluate(l).toUpperCase()],downcase:[Ot,[Ot],(l,[n])=>n.evaluate(l).toLowerCase()],concat:[Ot,Za(Ue),(l,n)=>n.map(h=>V(h.evaluate(l))).join("")],"resolved-locale":[Ot,[pt],(l,[n])=>n.evaluate(l).resolvedLocale()]});class Md{constructor(n,h){this.expression=n,this._warningHistory={},this._evaluator=new se,this._defaultValue=h?function(p){return p.type==="color"&&vh(p.default)?new Ke(0,0,0,0):p.type==="color"?Ke.parse(p.default)||null:p.type==="padding"?li.parse(p.default)||null:p.default===void 0?null:p.default}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(n,h,p,y,v,S){return this._evaluator.globals=n,this._evaluator.feature=h,this._evaluator.featureState=p,this._evaluator.canonical=y,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(n,h,p,y,v,S){this._evaluator.globals=n,this._evaluator.feature=h||null,this._evaluator.featureState=p||null,this._evaluator.canonical=y,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ne(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function bh(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Go}function wh(l,n){const h=new In(Go,[],n?function(y){const v={color:pe,string:Ot,number:nt,enum:Ot,boolean:$t,formatted:ct,padding:It,resolvedImage:Xt};return y.type==="array"?Ct(v[y.value]||Ue,y.length):v[y.type]}(n):void 0),p=h.parse(l,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Cm(new Md(p,n)):Qo(h.errors)}class Td{constructor(n,h){this.kind=n,this._styleExpression=h,this.isStateDependent=n!=="constant"&&!Bs(h.expression)}evaluateWithoutErrorHandling(n,h,p,y,v,S){return this._styleExpression.evaluateWithoutErrorHandling(n,h,p,y,v,S)}evaluate(n,h,p,y,v,S){return this._styleExpression.evaluate(n,h,p,y,v,S)}}class Bd{constructor(n,h,p,y){this.kind=n,this.zoomStops=p,this._styleExpression=h,this.isStateDependent=n!=="camera"&&!Bs(h.expression),this.interpolationType=y}evaluateWithoutErrorHandling(n,h,p,y,v,S){return this._styleExpression.evaluateWithoutErrorHandling(n,h,p,y,v,S)}evaluate(n,h,p,y,v,S){return this._styleExpression.evaluate(n,h,p,y,v,S)}interpolationFactor(n,h,p){return this.interpolationType?Dr.interpolationFactor(this.interpolationType,n,h,p):0}}function Rm(l,n){const h=wh(l,n);if(h.result==="error")return h;const p=h.value.expression,y=Ts(p);if(!y&&!Vo(n))return Qo([new Bi("","data expressions not supported")]);const v=un(p,["zoom"]);if(!v&&!Mm(n))return Qo([new Bi("","zoom expressions not supported")]);const S=Sh(p);return S||v?S instanceof Bi?Qo([S]):S instanceof Dr&&!Cd(n)?Qo([new Bi("",'"interpolate" expressions cannot be used with this property')]):Cm(S?new Bd(y?"camera":"composite",h.value,S.labels,S instanceof Dr?S.interpolation:void 0):new Td(y?"constant":"source",h.value)):Qo([new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Eh{constructor(n,h){this._parameters=n,this._specification=h,kt(this,Tm(this._parameters,this._specification))}static deserialize(n){return new Eh(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Sh(l){let n=null;if(l instanceof kl)n=Sh(l.result);else if(l instanceof gh){for(const h of l.args)if(n=Sh(h),n)break}else(l instanceof _a||l instanceof Dr)&&l.input instanceof ae&&l.input.name==="zoom"&&(n=l);return n instanceof Bi||l.eachChild(h=>{const p=Sh(h);p instanceof Bi?n=p:!n&&p?n=new Bi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&p&&n!==p&&(n=new Bi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function jr(l){const n=l.key,h=l.value,p=l.valueSpec||{},y=l.objectElementValidators||{},v=l.style,S=l.styleSpec,M=l.validateSpec;let L=[];const k=Gi(h);if(k!=="object")return[new $e(n,h,`object expected, ${k} found`)];for(const O in h){const H=O.split(".")[0],j=p[H]||p["*"];let Y;if(y[H])Y=y[H];else if(p[H])Y=M;else if(y["*"])Y=y["*"];else{if(!p["*"]){L.push(new $e(n,h[O],`unknown property "${O}"`));continue}Y=M}L=L.concat(Y({key:(n&&`${n}.`)+O,value:h[O],valueSpec:j,style:v,styleSpec:S,object:h,objectKey:O,validateSpec:M},h))}for(const O in p)y[O]||p[O].required&&p[O].default===void 0&&h[O]===void 0&&L.push(new $e(n,h,`missing required property "${O}"`));return L}function Lm(l){const n=l.value,h=l.valueSpec,p=l.style,y=l.styleSpec,v=l.key,S=l.arrayElementValidator||l.validateSpec;if(Gi(n)!=="array")return[new $e(v,n,`array expected, ${Gi(n)} found`)];if(h.length&&n.length!==h.length)return[new $e(v,n,`array length ${h.length} expected, length ${n.length} found`)];if(h["min-length"]&&n.length<h["min-length"])return[new $e(v,n,`array length at least ${h["min-length"]} expected, length ${n.length} found`)];let M={type:h.value,values:h.values};y.$version<7&&(M.function=h.function),Gi(h.value)==="object"&&(M=h.value);let L=[];for(let k=0;k<n.length;k++)L=L.concat(S({array:n,arrayIndex:k,value:n[k],valueSpec:M,validateSpec:l.validateSpec,style:p,styleSpec:y,key:`${v}[${k}]`}));return L}function Rd(l){const n=l.key,h=l.value,p=l.valueSpec;let y=Gi(h);return y==="number"&&h!=h&&(y="NaN"),y!=="number"?[new $e(n,h,`number expected, ${y} found`)]:"minimum"in p&&h<p.minimum?[new $e(n,h,`${h} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&h>p.maximum?[new $e(n,h,`${h} is greater than the maximum value ${p.maximum}`)]:[]}function Dm(l){const n=l.valueSpec,h=Dt(l.value.type);let p,y,v,S={};const M=h!=="categorical"&&l.value.property===void 0,L=!M,k=Gi(l.value.stops)==="array"&&Gi(l.value.stops[0])==="array"&&Gi(l.value.stops[0][0])==="object",O=jr({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(Y){if(h==="identity")return[new $e(Y.key,Y.value,'identity function may not have a "stops" property')];let ee=[];const ge=Y.value;return ee=ee.concat(Lm({key:Y.key,value:ge,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:H})),Gi(ge)==="array"&&ge.length===0&&ee.push(new $e(Y.key,ge,"array must have at least one stop")),ee},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:n,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return h==="identity"&&M&&O.push(new $e(l.key,l.value,'missing required property "property"')),h==="identity"||l.value.stops||O.push(new $e(l.key,l.value,'missing required property "stops"')),h==="exponential"&&l.valueSpec.expression&&!Cd(l.valueSpec)&&O.push(new $e(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(L&&!Vo(l.valueSpec)?O.push(new $e(l.key,l.value,"property functions not supported")):M&&!Mm(l.valueSpec)&&O.push(new $e(l.key,l.value,"zoom functions not supported"))),h!=="categorical"&&!k||l.value.property!==void 0||O.push(new $e(l.key,l.value,'"property" property is required')),O;function H(Y){let ee=[];const ge=Y.value,me=Y.key;if(Gi(ge)!=="array")return[new $e(me,ge,`array expected, ${Gi(ge)} found`)];if(ge.length!==2)return[new $e(me,ge,`array length 2 expected, length ${ge.length} found`)];if(k){if(Gi(ge[0])!=="object")return[new $e(me,ge,`object expected, ${Gi(ge[0])} found`)];if(ge[0].zoom===void 0)return[new $e(me,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new $e(me,ge,"object stop key must have value")];if(v&&v>Dt(ge[0].zoom))return[new $e(me,ge[0].zoom,"stop zoom values must appear in ascending order")];Dt(ge[0].zoom)!==v&&(v=Dt(ge[0].zoom),y=void 0,S={}),ee=ee.concat(jr({key:`${me}[0]`,value:ge[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:Rd,value:j}}))}else ee=ee.concat(j({key:`${me}[0]`,value:ge[0],valueSpec:{},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},ge));return bh(Qi(ge[1]))?ee.concat([new $e(`${me}[1]`,ge[1],"expressions are not allowed in function stops.")]):ee.concat(Y.validateSpec({key:`${me}[1]`,value:ge[1],valueSpec:n,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function j(Y,ee){const ge=Gi(Y.value),me=Dt(Y.value),Le=Y.value!==null?Y.value:ee;if(p){if(ge!==p)return[new $e(Y.key,Le,`${ge} stop domain type must match previous stop domain type ${p}`)]}else p=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new $e(Y.key,Le,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&h!=="categorical"){let Ge=`number expected, ${ge} found`;return Vo(n)&&h===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(Y.key,Le,Ge)]}return h!=="categorical"||ge!=="number"||isFinite(me)&&Math.floor(me)===me?h!=="categorical"&&ge==="number"&&y!==void 0&&me<y?[new $e(Y.key,Le,"stop domain values must appear in ascending order")]:(y=me,h==="categorical"&&me in S?[new $e(Y.key,Le,"stop domain values must be unique")]:(S[me]=!0,[])):[new $e(Y.key,Le,`integer expected, found ${me}`)]}}function Ho(l){const n=(l.expressionContext==="property"?Rm:wh)(Qi(l.value),l.valueSpec);if(n.result==="error")return n.value.map(p=>new $e(`${l.key}${p.key}`,l.value,p.message));const h=n.value.expression||n.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!h.outputDefined())return[new $e(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Bs(h))return[new $e(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Bs(h))return[new $e(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!un(h,["zoom","feature-state"]))return[new $e(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Ts(h))return[new $e(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ih(l){const n=l.key,h=l.value,p=l.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Dt(h))===-1&&y.push(new $e(n,h,`expected one of [${p.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(p.values).indexOf(Dt(h))===-1&&y.push(new $e(n,h,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(h)} found`)),y}function Ch(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const n of l.slice(1))if(!Ch(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const J0={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ld(l){if(l==null)return{filter:()=>!0,needGeometry:!1};Ch(l)||(l=Mh(l));const n=wh(l,J0);if(n.result==="error")throw new Error(n.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,y)=>n.value.evaluate(h,p,{},y),needGeometry:An(l)}}function ey(l,n){return l<n?-1:l>n?1:0}function An(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let n=1;n<l.length;n++)if(An(l[n]))return!0;return!1}function Mh(l){if(!l)return!0;const n=l[0];return l.length<=1?n!=="any":n==="=="?vi(l[1],l[2],"=="):n==="!="?ji(vi(l[1],l[2],"==")):n==="<"||n===">"||n==="<="||n===">="?vi(l[1],l[2],n):n==="any"?(h=l.slice(1),["any"].concat(h.map(Mh))):n==="all"?["all"].concat(l.slice(1).map(Mh)):n==="none"?["all"].concat(l.slice(1).map(Mh).map(ji)):n==="in"?Th(l[1],l.slice(2)):n==="!in"?ji(Th(l[1],l.slice(2))):n==="has"?an(l[1]):n==="!has"?ji(an(l[1])):n!=="within"||l;var h}function vi(l,n,h){switch(l){case"$type":return[`filter-type-${h}`,n];case"$id":return[`filter-id-${h}`,n];default:return[`filter-${h}`,l,n]}}function Th(l,n){if(n.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(h=>typeof h!=typeof n[0])?["filter-in-large",l,["literal",n.sort(ey)]]:["filter-in-small",l,["literal",n]]}}function an(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function ji(l){return["!",l]}function Wo(l){return Ch(Qi(l.value))?Ho(kt({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Dd(l)}function Dd(l){const n=l.value,h=l.key;if(Gi(n)!=="array")return[new $e(h,n,`array expected, ${Gi(n)} found`)];const p=l.styleSpec;let y,v=[];if(n.length<1)return[new $e(h,n,"filter array must have at least 1 element")];switch(v=v.concat(Ih({key:`${h}[0]`,value:n[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),Dt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Dt(n[1])==="$type"&&v.push(new $e(h,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&v.push(new $e(h,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(y=Gi(n[1]),y!=="string"&&v.push(new $e(`${h}[1]`,n[1],`string expected, ${y} found`)));for(let S=2;S<n.length;S++)y=Gi(n[S]),Dt(n[1])==="$type"?v=v.concat(Ih({key:`${h}[${S}]`,value:n[S],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&v.push(new $e(`${h}[${S}]`,n[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<n.length;S++)v=v.concat(Dd({key:`${h}[${S}]`,value:n[S],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":y=Gi(n[1]),n.length!==2?v.push(new $e(h,n,`filter array for "${n[0]}" operator must have 2 elements`)):y!=="string"&&v.push(new $e(`${h}[1]`,n[1],`string expected, ${y} found`));break;case"within":y=Gi(n[1]),n.length!==2?v.push(new $e(h,n,`filter array for "${n[0]}" operator must have 2 elements`)):y!=="object"&&v.push(new $e(`${h}[1]`,n[1],`object expected, ${y} found`))}return v}function Pm(l,n){const h=l.key,p=l.validateSpec,y=l.style,v=l.styleSpec,S=l.value,M=l.objectKey,L=v[`${n}_${l.layerType}`];if(!L)return[];const k=M.match(/^(.*)-transition$/);if(n==="paint"&&k&&L[k[1]]&&L[k[1]].transition)return p({key:h,value:S,valueSpec:v.transition,style:y,styleSpec:v});const O=l.valueSpec||L[M];if(!O)return[new $e(h,S,`unknown property "${M}"`)];let H;if(Gi(S)==="string"&&Vo(O)&&!O.tokens&&(H=/^{([^}]+)}$/.exec(S)))return[new $e(h,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const j=[];return l.layerType==="symbol"&&(M==="text-field"&&y&&!y.glyphs&&j.push(new $e(h,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&vh(Qi(S))&&Dt(S.type)==="identity"&&j.push(new $e(h,S,'"text-font" does not support identity functions'))),j.concat(p({key:l.key,value:S,valueSpec:O,style:y,styleSpec:v,expressionContext:"property",propertyType:n,propertyKey:M}))}function Um(l){return Pm(l,"paint")}function Fm(l){return Pm(l,"layout")}function km(l){let n=[];const h=l.value,p=l.key,y=l.style,v=l.styleSpec;h.type||h.ref||n.push(new $e(p,h,'either "type" or "ref" is required'));let S=Dt(h.type);const M=Dt(h.ref);if(h.id){const L=Dt(h.id);for(let k=0;k<l.arrayIndex;k++){const O=y.layers[k];Dt(O.id)===L&&n.push(new $e(p,h.id,`duplicate layer id "${h.id}", previously used at line ${O.id.__line__}`))}}if("ref"in h){let L;["type","source","source-layer","filter","layout"].forEach(k=>{k in h&&n.push(new $e(p,h[k],`"${k}" is prohibited for ref layers`))}),y.layers.forEach(k=>{Dt(k.id)===M&&(L=k)}),L?L.ref?n.push(new $e(p,h.ref,"ref cannot reference another ref layer")):S=Dt(L.type):n.push(new $e(p,h.ref,`ref layer "${M}" not found`))}else if(S!=="background")if(h.source){const L=y.sources&&y.sources[h.source],k=L&&Dt(L.type);L?k==="vector"&&S==="raster"?n.push(new $e(p,h.source,`layer "${h.id}" requires a raster source`)):k==="raster"&&S!=="raster"?n.push(new $e(p,h.source,`layer "${h.id}" requires a vector source`)):k!=="vector"||h["source-layer"]?k==="raster-dem"&&S!=="hillshade"?n.push(new $e(p,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!h.paint||!h.paint["line-gradient"]||k==="geojson"&&L.lineMetrics||n.push(new $e(p,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new $e(p,h,`layer "${h.id}" must specify a "source-layer"`)):n.push(new $e(p,h.source,`source "${h.source}" not found`))}else n.push(new $e(p,h,'missing required property "source"'));return n=n.concat(jr({key:p,value:h,valueSpec:v.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:h.type,valueSpec:v.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:h,objectKey:"type"}),filter:Wo,layout:L=>jr({layer:h,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":k=>Fm(kt({layerType:S},k))}}),paint:L=>jr({layer:h,key:L.key,value:L.value,style:L.style,styleSpec:L.styleSpec,validateSpec:L.validateSpec,objectElementValidators:{"*":k=>Um(kt({layerType:S},k))}})}})),n}function ya(l){const n=l.value,h=l.key,p=Gi(n);return p!=="string"?[new $e(h,n,`string expected, ${p} found`)]:[]}const Pd={promoteId:function({key:l,value:n}){if(Gi(n)==="string")return ya({key:l,value:n});{const h=[];for(const p in n)h.push(...ya({key:`${l}.${p}`,value:n[p]}));return h}}};function Ud(l){const n=l.value,h=l.key,p=l.styleSpec,y=l.style,v=l.validateSpec;if(!n.type)return[new $e(h,n,'"type" is required')];const S=Dt(n.type);let M;switch(S){case"vector":case"raster":case"raster-dem":return M=jr({key:h,value:n,valueSpec:p[`source_${S.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:Pd,validateSpec:v}),M;case"geojson":if(M=jr({key:h,value:n,valueSpec:p.source_geojson,style:y,styleSpec:p,validateSpec:v,objectElementValidators:Pd}),n.cluster)for(const L in n.clusterProperties){const[k,O]=n.clusterProperties[L],H=typeof k=="string"?[k,["accumulated"],["get",L]]:k;M.push(...Ho({key:`${h}.${L}.map`,value:O,validateSpec:v,expressionContext:"cluster-map"})),M.push(...Ho({key:`${h}.${L}.reduce`,value:H,validateSpec:v,expressionContext:"cluster-reduce"}))}return M;case"video":return jr({key:h,value:n,valueSpec:p.source_video,style:y,validateSpec:v,styleSpec:p});case"image":return jr({key:h,value:n,valueSpec:p.source_image,style:y,validateSpec:v,styleSpec:p});case"canvas":return[new $e(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ih({key:`${h}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,validateSpec:v,styleSpec:p})}}function Fd(l){const n=l.value,h=l.styleSpec,p=h.light,y=l.style;let v=[];const S=Gi(n);if(n===void 0)return v;if(S!=="object")return v=v.concat([new $e("light",n,`object expected, ${S} found`)]),v;for(const M in n){const L=M.match(/^(.*)-transition$/);v=v.concat(L&&p[L[1]]&&p[L[1]].transition?l.validateSpec({key:M,value:n[M],valueSpec:h.transition,validateSpec:l.validateSpec,style:y,styleSpec:h}):p[M]?l.validateSpec({key:M,value:n[M],valueSpec:p[M],validateSpec:l.validateSpec,style:y,styleSpec:h}):[new $e(M,n[M],`unknown property "${M}"`)])}return v}function Bh(l){const n=l.value,h=l.styleSpec,p=h.terrain,y=l.style;let v=[];const S=Gi(n);if(n===void 0)return v;if(S!=="object")return v=v.concat([new $e("terrain",n,`object expected, ${S} found`)]),v;for(const M in n)v=v.concat(p[M]?l.validateSpec({key:M,value:n[M],valueSpec:p[M],validateSpec:l.validateSpec,style:y,styleSpec:h}):[new $e(M,n[M],`unknown property "${M}"`)]);return v}function Nm(l){let n=[];const h=l.value,p=l.key;if(Array.isArray(h)){const y=[],v=[];for(const S in h)h[S].id&&y.includes(h[S].id)&&n.push(new $e(p,h,`all the sprites' ids must be unique, but ${h[S].id} is duplicated`)),y.push(h[S].id),h[S].url&&v.includes(h[S].url)&&n.push(new $e(p,h,`all the sprites' URLs must be unique, but ${h[S].url} is duplicated`)),v.push(h[S].url),n=n.concat(jr({key:`${p}[${S}]`,value:h[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return n}return ya({key:p,value:h})}const Om={"*":()=>[],array:Lm,boolean:function(l){const n=l.value,h=l.key,p=Gi(n);return p!=="boolean"?[new $e(h,n,`boolean expected, ${p} found`)]:[]},number:Rd,color:function(l){const n=l.key,h=l.value,p=Gi(h);return p!=="string"?[new $e(n,h,`color expected, ${p} found`)]:Wt(h)===null?[new $e(n,h,`color expected, "${h}" found`)]:[]},constants:fi,enum:Ih,filter:Wo,function:Dm,layer:km,object:jr,source:Ud,light:Fd,terrain:Bh,string:ya,formatted:function(l){return ya(l).length===0?[]:Ho(l)},resolvedImage:function(l){return ya(l).length===0?[]:Ho(l)},padding:function(l){const n=l.key,h=l.value;if(Gi(h)==="array"){if(h.length<1||h.length>4)return[new $e(n,h,`padding requires 1 to 4 values; ${h.length} values found`)];const p={type:"number"};let y=[];for(let v=0;v<h.length;v++)y=y.concat(l.validateSpec({key:`${n}[${v}]`,value:h[v],validateSpec:l.validateSpec,valueSpec:p}));return y}return Rd({key:n,value:h,valueSpec:{}})},sprite:Nm};function zl(l){const n=l.value,h=l.valueSpec,p=l.styleSpec;return l.validateSpec=zl,h.expression&&vh(Dt(n))?Dm(l):h.expression&&bh(Qi(n))?Ho(l):h.type&&Om[h.type]?Om[h.type](l):jr(kt({},l,{valueSpec:h.type?p[h.type]:h}))}function zm(l){const n=l.value,h=l.key,p=ya(l);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new $e(h,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new $e(h,n,'"glyphs" url must include a "{range}" token'))),p}function Rs(l,n=be){let h=[];return h=h.concat(zl({key:"",value:l,valueSpec:n.$root,styleSpec:n,style:l,validateSpec:zl,objectElementValidators:{glyphs:zm,"*":()=>[]}})),l.constants&&(h=h.concat(fi({key:"constants",value:l.constants,style:l,styleSpec:n,validateSpec:zl}))),Gm(h)}function Zs(l){return function(n){return l({...n,validateSpec:zl})}}function Gm(l){return[].concat(l).sort((n,h)=>n.line-h.line)}function Js(l){return function(...n){return Gm(l.apply(this,n))}}Rs.source=Js(Zs(Ud)),Rs.sprite=Js(Zs(Nm)),Rs.glyphs=Js(Zs(zm)),Rs.light=Js(Zs(Fd)),Rs.terrain=Js(Zs(Bh)),Rs.layer=Js(Zs(km)),Rs.filter=Js(Zs(Wo)),Rs.paintProperty=Js(Zs(Um)),Rs.layoutProperty=Js(Zs(Fm));const qo=Rs,Qm=qo.light,Rh=qo.paintProperty,ty=qo.layoutProperty;function kd(l,n){let h=!1;if(n&&n.length)for(const p of n)l.fire(new Kt(new Error(p.message))),h=!0;return h}class $o{constructor(n,h,p){const y=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const S=new Int32Array(this.arrayBuffer);n=S[0],this.d=(h=S[1])+2*(p=S[2]);for(let L=0;L<this.d*this.d;L++){const k=S[3+L],O=S[3+L+1];y.push(k===O?null:S.subarray(k,O))}const M=S[3+y.length+1];this.keys=S.subarray(S[3+y.length],M),this.bboxes=S.subarray(M),this.insert=this._insertReadonly}else{this.d=h+2*p;for(let S=0;S<this.d*this.d;S++)y.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=n,this.padding=p,this.scale=h/n,this.uid=0;const v=p/h*n;this.min=-v,this.max=n+v}insert(n,h,p,y,v){this._forEachCell(h,p,y,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,h,p,y,v,S){this.cells[v].push(S)}query(n,h,p,y,v){const S=this.min,M=this.max;if(n<=S&&h<=S&&M<=p&&M<=y&&!v)return Array.prototype.slice.call(this.keys);{const L=[];return this._forEachCell(n,h,p,y,this._queryCell,L,{},v),L}}_queryCell(n,h,p,y,v,S,M,L){const k=this.cells[v];if(k!==null){const O=this.keys,H=this.bboxes;for(let j=0;j<k.length;j++){const Y=k[j];if(M[Y]===void 0){const ee=4*Y;(L?L(H[ee+0],H[ee+1],H[ee+2],H[ee+3]):n<=H[ee+2]&&h<=H[ee+3]&&p>=H[ee+0]&&y>=H[ee+1])?(M[Y]=!0,S.push(O[Y])):M[Y]=!1}}}}_forEachCell(n,h,p,y,v,S,M,L){const k=this._convertToCellCoord(n),O=this._convertToCellCoord(h),H=this._convertToCellCoord(p),j=this._convertToCellCoord(y);for(let Y=k;Y<=H;Y++)for(let ee=O;ee<=j;ee++){const ge=this.d*ee+Y;if((!L||L(this._convertFromCellCoord(Y),this._convertFromCellCoord(ee),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(ee+1)))&&v.call(this,n,h,p,y,ge,S,M,L))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,h=3+this.cells.length+1+1;let p=0;for(let S=0;S<this.cells.length;S++)p+=this.cells[S].length;const y=new Int32Array(h+p+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let v=h;for(let S=0;S<n.length;S++){const M=n[S];y[3+S]=v,y.set(M,v),v+=M.length}return y[3+n.length]=v,y.set(this.keys,v),v+=this.keys.length,y[3+n.length+1]=v,y.set(this.bboxes,v),v+=this.bboxes.length,y.buffer}static serialize(n,h){const p=n.toArrayBuffer();return h&&h.push(p),{buffer:p}}static deserialize(n){return new $o(n.buffer)}}const xa={};function Lt(l,n,h={}){if(xa[l])throw new Error(`${l} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:l,writeable:!1}),xa[l]={klass:n,omit:h.omit||[],shallow:h.shallow||[]}}Lt("Object",Object),Lt("TransferableGridIndex",$o),Lt("Color",Ke),Lt("Error",Error),Lt("AJAXError",je),Lt("ResolvedImage",ki),Lt("StylePropertyFunction",Eh),Lt("StyleExpression",Md,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",Bd),Lt("ZoomConstantExpression",Td),Lt("CompoundExpression",ae,{omit:["_evaluate"]});for(const l in Go)Go[l]._classRegistryKey||Lt(`Expression_${l}`,Go[l]);function Gl(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Ja(l,n){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob)return l;if(Gl(l)||Ve(l))return n&&n.push(l),l;if(ArrayBuffer.isView(l)){const h=l;return n&&n.push(h.buffer),h}if(l instanceof ImageData)return n&&n.push(l.data.buffer),l;if(Array.isArray(l)){const h=[];for(const p of l)h.push(Ja(p,n));return h}if(typeof l=="object"){const h=l.constructor,p=h._classRegistryKey;if(!p)throw new Error("can't serialize object of unregistered class");if(!xa[p])throw new Error(`${p} is not registered.`);const y=h.serialize?h.serialize(l,n):{};if(h.serialize){if(n&&y===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in l){if(!l.hasOwnProperty(v)||xa[p].omit.indexOf(v)>=0)continue;const S=l[v];y[v]=xa[p].shallow.indexOf(v)>=0?S:Ja(S,n)}l instanceof Error&&(y.message=l.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(y.$name=p),y}throw new Error("can't serialize object of type "+typeof l)}function eo(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||Gl(l)||Ve(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(eo);if(typeof l=="object"){const n=l.$name||"Object";if(!xa[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:h}=xa[n];if(!h)throw new Error(`can't deserialize unregistered class ${n}`);if(h.deserialize)return h.deserialize(l);const p=Object.create(h.prototype);for(const y of Object.keys(l)){if(y==="$name")continue;const v=l[y];p[y]=xa[n].shallow.indexOf(y)>=0?v:eo(v)}return p}throw new Error("can't deserialize object of type "+typeof l)}class Vm{constructor(){this.first=!0}update(n,h){const p=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=h),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=p,!0))}}const vt={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function Nd(l){for(const n of l)if(Od(n.charCodeAt(0)))return!0;return!1}function iy(l){for(const n of l)if(!ny(n.charCodeAt(0)))return!1;return!0}function ny(l){return!(vt.Arabic(l)||vt["Arabic Supplement"](l)||vt["Arabic Extended-A"](l)||vt["Arabic Presentation Forms-A"](l)||vt["Arabic Presentation Forms-B"](l))}function Od(l){return!(l!==746&&l!==747&&(l<4352||!(vt["Bopomofo Extended"](l)||vt.Bopomofo(l)||vt["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||vt["CJK Compatibility Ideographs"](l)||vt["CJK Compatibility"](l)||vt["CJK Radicals Supplement"](l)||vt["CJK Strokes"](l)||!(!vt["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||vt["CJK Unified Ideographs Extension A"](l)||vt["CJK Unified Ideographs"](l)||vt["Enclosed CJK Letters and Months"](l)||vt["Hangul Compatibility Jamo"](l)||vt["Hangul Jamo Extended-A"](l)||vt["Hangul Jamo Extended-B"](l)||vt["Hangul Jamo"](l)||vt["Hangul Syllables"](l)||vt.Hiragana(l)||vt["Ideographic Description Characters"](l)||vt.Kanbun(l)||vt["Kangxi Radicals"](l)||vt["Katakana Phonetic Extensions"](l)||vt.Katakana(l)&&l!==12540||!(!vt["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!vt["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||vt["Unified Canadian Aboriginal Syllabics"](l)||vt["Unified Canadian Aboriginal Syllabics Extended"](l)||vt["Vertical Forms"](l)||vt["Yijing Hexagram Symbols"](l)||vt["Yi Syllables"](l)||vt["Yi Radicals"](l))))}function Hm(l){return!(Od(l)||function(n){return!!(vt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||vt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||vt["Letterlike Symbols"](n)||vt["Number Forms"](n)||vt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||vt["Control Pictures"](n)&&n!==9251||vt["Optical Character Recognition"](n)||vt["Enclosed Alphanumerics"](n)||vt["Geometric Shapes"](n)||vt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||vt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||vt["CJK Symbols and Punctuation"](n)||vt.Katakana(n)||vt["Private Use Area"](n)||vt["CJK Compatibility Forms"](n)||vt["Small Form Variants"](n)||vt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(l))}function Ql(l){return l>=1424&&l<=2303||vt["Arabic Presentation Forms-A"](l)||vt["Arabic Presentation Forms-B"](l)}function Lh(l,n){return!(!n&&Ql(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||vt.Khmer(l))}function Xr(l){for(const n of l)if(Ql(n.charCodeAt(0)))return!0;return!1}const jo="deferred",zd="loading",Gd="loaded";let Qd=null,Ar="unavailable",Ls=null;const Wm=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Ar="error"),Qd&&Qd(l)};function Vl(){Vd.fire(new Te("pluginStateChange",{pluginStatus:Ar,pluginURL:Ls}))}const Vd=new Zt,to=function(){return Ar},qm=function(){if(Ar!==jo||!Ls)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ar=zd,Vl(),Ls&&qe({url:Ls},l=>{l?Wm(l):(Ar=Gd,Vl())})},_r={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ar===Gd||_r.applyArabicShaping!=null,isLoading:()=>Ar===zd,setState(l){if(!_e())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Ar=l.pluginStatus,Ls=l.pluginURL},isParsed(){if(!_e())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return _r.applyArabicShaping!=null&&_r.processBidirectionalText!=null&&_r.processStyledBidirectionalText!=null},getPluginURL(){if(!_e())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ls}};class en{constructor(n,h){this.zoom=n,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vm,this.transition={})}isSupportedScript(n){return function(h,p){for(const y of h)if(!Lh(y.charCodeAt(0),p))return!1;return!0}(n,_r.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,h=n-Math.floor(n),p=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*h}}}class Xo{constructor(n,h){this.property=n,this.value=h,this.expression=function(p,y){if(vh(p))return new Eh(p,y);if(bh(p)){const v=Rm(p,y);if(v.result==="error")throw new Error(v.value.map(S=>`${S.key}: ${S.message}`).join(", "));return v.value}{let v=p;return y.type==="color"&&typeof p=="string"?v=Ke.parse(p):y.type!=="padding"||typeof p!="number"&&!Array.isArray(p)||(v=li.parse(p)),{kind:"constant",evaluate:()=>v}}}(h===void 0?n.specification.default:h,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,h,p){return this.property.possiblyEvaluate(this,n,h,p)}}class Dh{constructor(n){this.property=n,this.value=new Xo(n,void 0)}transitioned(n,h){return new $m(this.property,this.value,h,T({},n.transition,this.transition),n.now)}untransitioned(){return new $m(this.property,this.value,null,{},0)}}class Hd{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return G(this._values[n].value.value)}setValue(n,h){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Dh(this._values[n].property)),this._values[n].value=new Xo(this._values[n].property,h===null?void 0:G(h))}getTransition(n){return G(this._values[n].transition)}setTransition(n,h){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Dh(this._values[n].property)),this._values[n].transition=G(h)||void 0}serialize(){const n={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(n[h]=p);const y=this.getTransition(h);y!==void 0&&(n[`${h}-transition`]=y)}return n}transitioned(n,h){const p=new Ph(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].transitioned(n,h._values[y]);return p}untransitioned(){const n=new Ph(this._properties);for(const h of Object.keys(this._values))n._values[h]=this._values[h].untransitioned();return n}}class $m{constructor(n,h,p,y,v){this.property=n,this.value=h,this.begin=v+y.delay||0,this.end=this.begin+y.duration||0,n.specification.transition&&(y.delay||y.duration)&&(this.prior=p)}possiblyEvaluate(n,h,p){const y=n.now||0,v=this.value.possiblyEvaluate(n,h,p),S=this.prior;if(S){if(y>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(y<this.begin)return S.possiblyEvaluate(n,h,p);{const M=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(n,h,p),v,function(L){if(L<=0)return 0;if(L>=1)return 1;const k=L*L,O=k*L;return 4*(L<.5?O:3*(L-k)+O-.75)}(M))}}return v}}class Ph{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,h,p){const y=new Fh(this._properties);for(const v of Object.keys(this._values))y._values[v]=this._values[v].possiblyEvaluate(n,h,p);return y}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Uh{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return G(this._values[n].value)}setValue(n,h){this._values[n]=new Xo(this._values[n].property,h===null?void 0:G(h))}serialize(){const n={};for(const h of Object.keys(this._values)){const p=this.getValue(h);p!==void 0&&(n[h]=p)}return n}possiblyEvaluate(n,h,p){const y=new Fh(this._properties);for(const v of Object.keys(this._values))y._values[v]=this._values[v].possiblyEvaluate(n,h,p);return y}}class ss{constructor(n,h,p){this.property=n,this.value=h,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,h,p,y){return this.property.evaluate(this.value,this.parameters,n,h,p,y)}}class Fh{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Qt{constructor(n){this.specification=n}possiblyEvaluate(n,h){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(h)}interpolate(n,h,p){const y=Ya[this.specification.type];return y?y(n,h,p):n}}class ti{constructor(n,h){this.specification=n,this.overrides=h}possiblyEvaluate(n,h,p,y){return new ss(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(h,null,{},p,y)}:n.expression,h)}interpolate(n,h,p){if(n.value.kind!=="constant"||h.value.kind!=="constant")return n;if(n.value.value===void 0||h.value.value===void 0)return new ss(this,{kind:"constant",value:void 0},n.parameters);const y=Ya[this.specification.type];return y?new ss(this,{kind:"constant",value:y(n.value.value,h.value.value,p)},n.parameters):n}evaluate(n,h,p,y,v,S){return n.kind==="constant"?n.value:n.evaluate(h,p,y,v,S)}}class Yo extends ti{possiblyEvaluate(n,h,p,y){if(n.value===void 0)return new ss(this,{kind:"constant",value:void 0},h);if(n.expression.kind==="constant"){const v=n.expression.evaluate(h,null,{},p,y),S=n.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,M=this._calculate(S,S,S,h);return new ss(this,{kind:"constant",value:M},h)}if(n.expression.kind==="camera"){const v=this._calculate(n.expression.evaluate({zoom:h.zoom-1}),n.expression.evaluate({zoom:h.zoom}),n.expression.evaluate({zoom:h.zoom+1}),h);return new ss(this,{kind:"constant",value:v},h)}return new ss(this,n.expression,h)}evaluate(n,h,p,y,v,S){if(n.kind==="source"){const M=n.evaluate(h,p,y,v,S);return this._calculate(M,M,M,h)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(h.zoom)-1},p,y),n.evaluate({zoom:Math.floor(h.zoom)},p,y),n.evaluate({zoom:Math.floor(h.zoom)+1},p,y),h):n.value}_calculate(n,h,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:n,to:h}:{from:p,to:h}}interpolate(n){return n}}class Wd{constructor(n){this.specification=n}possiblyEvaluate(n,h,p,y){if(n.value!==void 0){if(n.expression.kind==="constant"){const v=n.expression.evaluate(h,null,{},p,y);return this._calculate(v,v,v,h)}return this._calculate(n.expression.evaluate(new en(Math.floor(h.zoom-1),h)),n.expression.evaluate(new en(Math.floor(h.zoom),h)),n.expression.evaluate(new en(Math.floor(h.zoom+1),h)),h)}}_calculate(n,h,p,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:n,to:h}:{from:p,to:h}}interpolate(n){return n}}class qd{constructor(n){this.specification=n}possiblyEvaluate(n,h,p,y){return!!n.expression.evaluate(h,null,{},p,y)}interpolate(){return!1}}class yr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in n){const p=n[h];p.specification.overridable&&this.overridableProperties.push(h);const y=this.defaultPropertyValues[h]=new Xo(p,void 0),v=this.defaultTransitionablePropertyValues[h]=new Dh(p);this.defaultTransitioningPropertyValues[h]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=y.possiblyEvaluate({})}}}Lt("DataDrivenProperty",ti),Lt("DataConstantProperty",Qt),Lt("CrossFadedDataDrivenProperty",Yo),Lt("CrossFadedProperty",Wd),Lt("ColorRampProperty",qd);const kh="-transition";class as extends Zt{constructor(n,h){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),h.layout&&(this._unevaluatedLayout=new Uh(h.layout)),h.paint)){this._transitionablePaint=new Hd(h.paint);for(const p in n.paint)this.setPaintProperty(p,n.paint[p],{validate:!1});for(const p in n.layout)this.setLayoutProperty(p,n.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fh(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,h,p={}){h!=null&&this._validate(ty,`layers.${this.id}.layout.${n}`,n,h,p)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,h):this.visibility=h)}getPaintProperty(n){return n.endsWith(kh)?this._transitionablePaint.getTransition(n.slice(0,-kh.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,h,p={}){if(h!=null&&this._validate(Rh,`layers.${this.id}.paint.${n}`,n,h,p))return!1;if(n.endsWith(kh))return this._transitionablePaint.setTransition(n.slice(0,-kh.length),h||void 0),!1;{const y=this._transitionablePaint._values[n],v=y.property.specification["property-type"]==="cross-faded-data-driven",S=y.value.isDataDriven(),M=y.value;this._transitionablePaint.setValue(n,h),this._handleSpecialPaintPropertyUpdate(n);const L=this._transitionablePaint._values[n].value;return L.isDataDriven()||S||v||this._handleOverridablePaintPropertyUpdate(n,M,L)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,h,p){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,h){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,h)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),X(n,(h,p)=>!(h===void 0||p==="layout"&&!Object.keys(h).length||p==="paint"&&!Object.keys(h).length))}_validate(n,h,p,y,v={}){return(!v||v.validate!==!1)&&kd(this,n.call(qo,{key:h,layerType:this.type,objectKey:p,value:y,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const h=this.paint.get(n);if(h instanceof ss&&Vo(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const ry={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Nh{constructor(n,h){this._structArray=n,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class _n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,h){return n._trim(),h&&(n.isTransferred=!0,h.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const h=Object.create(this.prototype);return h.arrayBuffer=n.arrayBuffer,h.length=n.length,h.capacity=n.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Cn(l,n=1){let h=0,p=0;return{members:l.map(y=>{const v=ry[y.type].BYTES_PER_ELEMENT,S=h=jm(h,Math.max(n,v)),M=y.components||1;return p=Math.max(p,v),h+=v*M,{name:y.name,type:y.type,components:M,offset:S}}),size:jm(h,Math.max(p,n)),alignment:n}}function jm(l,n){return Math.ceil(l/n)*n}class Hl extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,h)}emplace(n,h,p){const y=2*n;return this.int16[y+0]=h,this.int16[y+1]=p,n}}Hl.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",Hl);class Oh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,h,p)}emplace(n,h,p,y){const v=3*n;return this.int16[v+0]=h,this.int16[v+1]=p,this.int16[v+2]=y,n}}Oh.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",Oh);class Ko extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,p,y)}emplace(n,h,p,y,v){const S=4*n;return this.int16[S+0]=h,this.int16[S+1]=p,this.int16[S+2]=y,this.int16[S+3]=v,n}}Ko.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",Ko);class $d extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S){const M=this.length;return this.resize(M+1),this.emplace(M,n,h,p,y,v,S)}emplace(n,h,p,y,v,S,M){const L=6*n;return this.int16[L+0]=h,this.int16[L+1]=p,this.int16[L+2]=y,this.int16[L+3]=v,this.int16[L+4]=S,this.int16[L+5]=M,n}}$d.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",$d);class Wl extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S){const M=this.length;return this.resize(M+1),this.emplace(M,n,h,p,y,v,S)}emplace(n,h,p,y,v,S,M){const L=4*n,k=8*n;return this.int16[L+0]=h,this.int16[L+1]=p,this.uint8[k+4]=y,this.uint8[k+5]=v,this.uint8[k+6]=S,this.uint8[k+7]=M,n}}Wl.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",Wl);class ql extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,h)}emplace(n,h,p){const y=2*n;return this.float32[y+0]=h,this.float32[y+1]=p,n}}ql.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",ql);class jd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S,M,L,k,O){const H=this.length;return this.resize(H+1),this.emplace(H,n,h,p,y,v,S,M,L,k,O)}emplace(n,h,p,y,v,S,M,L,k,O,H){const j=10*n;return this.uint16[j+0]=h,this.uint16[j+1]=p,this.uint16[j+2]=y,this.uint16[j+3]=v,this.uint16[j+4]=S,this.uint16[j+5]=M,this.uint16[j+6]=L,this.uint16[j+7]=k,this.uint16[j+8]=O,this.uint16[j+9]=H,n}}jd.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",jd);class Xd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S,M,L,k,O,H,j){const Y=this.length;return this.resize(Y+1),this.emplace(Y,n,h,p,y,v,S,M,L,k,O,H,j)}emplace(n,h,p,y,v,S,M,L,k,O,H,j,Y){const ee=12*n;return this.int16[ee+0]=h,this.int16[ee+1]=p,this.int16[ee+2]=y,this.int16[ee+3]=v,this.uint16[ee+4]=S,this.uint16[ee+5]=M,this.uint16[ee+6]=L,this.uint16[ee+7]=k,this.int16[ee+8]=O,this.int16[ee+9]=H,this.int16[ee+10]=j,this.int16[ee+11]=Y,n}}Xd.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",Xd);class zh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,h,p)}emplace(n,h,p,y){const v=3*n;return this.float32[v+0]=h,this.float32[v+1]=p,this.float32[v+2]=y,n}}zh.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",zh);class Gh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.uint32[1*n+0]=h,n}}Gh.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",Gh);class Yd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S,M,L,k){const O=this.length;return this.resize(O+1),this.emplace(O,n,h,p,y,v,S,M,L,k)}emplace(n,h,p,y,v,S,M,L,k,O){const H=10*n,j=5*n;return this.int16[H+0]=h,this.int16[H+1]=p,this.int16[H+2]=y,this.int16[H+3]=v,this.int16[H+4]=S,this.int16[H+5]=M,this.uint32[j+3]=L,this.uint16[H+8]=k,this.uint16[H+9]=O,n}}Yd.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",Yd);class Kd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S){const M=this.length;return this.resize(M+1),this.emplace(M,n,h,p,y,v,S)}emplace(n,h,p,y,v,S,M){const L=6*n;return this.int16[L+0]=h,this.int16[L+1]=p,this.int16[L+2]=y,this.int16[L+3]=v,this.int16[L+4]=S,this.int16[L+5]=M,n}}Kd.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",Kd);class Zd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v){const S=this.length;return this.resize(S+1),this.emplace(S,n,h,p,y,v)}emplace(n,h,p,y,v,S){const M=4*n,L=8*n;return this.float32[M+0]=h,this.float32[M+1]=p,this.float32[M+2]=y,this.int16[L+6]=v,this.int16[L+7]=S,n}}Zd.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",Zd);class Jd extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,p,y)}emplace(n,h,p,y,v){const S=12*n,M=3*n;return this.uint8[S+0]=h,this.uint8[S+1]=p,this.float32[M+1]=y,this.float32[M+2]=v,n}}Jd.prototype.bytesPerElement=12,Lt("StructArrayLayout2ub2f12",Jd);class Qh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,h,p)}emplace(n,h,p,y){const v=3*n;return this.uint16[v+0]=h,this.uint16[v+1]=p,this.uint16[v+2]=y,n}}Qh.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",Qh);class ep extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge,me,Le){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge,me,Le)}emplace(n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge,me,Le,Ge){const Ce=24*n,ze=12*n,it=48*n;return this.int16[Ce+0]=h,this.int16[Ce+1]=p,this.uint16[Ce+2]=y,this.uint16[Ce+3]=v,this.uint32[ze+2]=S,this.uint32[ze+3]=M,this.uint32[ze+4]=L,this.uint16[Ce+10]=k,this.uint16[Ce+11]=O,this.uint16[Ce+12]=H,this.float32[ze+7]=j,this.float32[ze+8]=Y,this.uint8[it+36]=ee,this.uint8[it+37]=ge,this.uint8[it+38]=me,this.uint32[ze+10]=Le,this.int16[Ce+22]=Ge,n}}ep.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ep);class va extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge,me,Le,Ge,Ce,ze,it,tt,Ft,Gt,wt,xt,At,Et){const bt=this.length;return this.resize(bt+1),this.emplace(bt,n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge,me,Le,Ge,Ce,ze,it,tt,Ft,Gt,wt,xt,At,Et)}emplace(n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge,me,Le,Ge,Ce,ze,it,tt,Ft,Gt,wt,xt,At,Et,bt){const ut=34*n,jt=17*n;return this.int16[ut+0]=h,this.int16[ut+1]=p,this.int16[ut+2]=y,this.int16[ut+3]=v,this.int16[ut+4]=S,this.int16[ut+5]=M,this.int16[ut+6]=L,this.int16[ut+7]=k,this.uint16[ut+8]=O,this.uint16[ut+9]=H,this.uint16[ut+10]=j,this.uint16[ut+11]=Y,this.uint16[ut+12]=ee,this.uint16[ut+13]=ge,this.uint16[ut+14]=me,this.uint16[ut+15]=Le,this.uint16[ut+16]=Ge,this.uint16[ut+17]=Ce,this.uint16[ut+18]=ze,this.uint16[ut+19]=it,this.uint16[ut+20]=tt,this.uint16[ut+21]=Ft,this.uint16[ut+22]=Gt,this.uint32[jt+12]=wt,this.float32[jt+13]=xt,this.float32[jt+14]=At,this.float32[jt+15]=Et,this.float32[jt+16]=bt,n}}va.prototype.bytesPerElement=68,Lt("StructArrayLayout8i15ui1ul4f68",va);class Vh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.float32[1*n+0]=h,n}}Vh.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",Vh);class tp extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,n,h,p)}emplace(n,h,p,y){const v=4*n;return this.uint32[2*n+0]=h,this.uint16[v+2]=p,this.uint16[v+3]=y,n}}tp.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",tp);class ip extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,h)}emplace(n,h,p){const y=2*n;return this.uint16[y+0]=h,this.uint16[y+1]=p,n}}ip.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",ip);class Hh extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const h=this.length;return this.resize(h+1),this.emplace(h,n)}emplace(n,h){return this.uint16[1*n+0]=h,n}}Hh.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",Hh);class np extends _n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,h,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,n,h,p,y)}emplace(n,h,p,y,v){const S=4*n;return this.float32[S+0]=h,this.float32[S+1]=p,this.float32[S+2]=y,this.float32[S+3]=v,n}}np.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",np);class Xm extends Nh{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Re(this.anchorPointX,this.anchorPointY)}}Xm.prototype.size=20;class rp extends Yd{get(n){return new Xm(this,n)}}Lt("CollisionBoxArray",rp);class Wh extends Nh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Wh.prototype.size=48;class sp extends ep{get(n){return new Wh(this,n)}}Lt("PlacedSymbolArray",sp);class qh extends Nh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}qh.prototype.size=68;class Ym extends va{get(n){return new qh(this,n)}}Lt("SymbolInstanceArray",Ym);class io extends Vh{getoffsetX(n){return this.float32[1*n+0]}}Lt("GlyphOffsetArray",io);class $l extends Oh{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Lt("SymbolLineVertexArray",$l);class Zo extends Nh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Zo.prototype.size=8;class Km extends tp{get(n){return new Zo(this,n)}}Lt("FeatureIndexArray",Km);class ap extends Hl{}class jl extends Hl{}class sy extends Hl{}class ay extends $d{}class Zm extends Wl{}class oy extends ql{}class ba extends jd{}class g extends Xd{}class r extends zh{}class d extends Gh{}class f extends Kd{}class _ extends Jd{}class w extends Qh{}class C extends ip{}const B=Cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:D}=B;class F{constructor(n=[]){this.segments=n}prepareSegment(n,h,p,y){let v=this.segments[this.segments.length-1];return n>F.MAX_VERTEX_ARRAY_LENGTH&&q(`Max vertices per segment is ${F.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!v||v.vertexLength+n>F.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==y)&&(v={vertexOffset:h.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},y!==void 0&&(v.sortKey=y),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const n of this.segments)for(const h in n.vaos)n.vaos[h].destroy()}static simpleSegment(n,h,p,y){return new F([{vertexOffset:n,primitiveOffset:h,vertexLength:p,primitiveLength:y,vaos:{},sortKey:0}])}}function Q(l,n){return 256*(l=I(Math.floor(l),0,255))+I(Math.floor(n),0,255)}F.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",F);const z=Cn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var $={},le={get exports(){return $},set exports(l){$=l}},he={};({get exports(){return he},set exports(l){he=l}}).exports=function(l,n){var h,p,y,v,S,M,L,k;for(p=l.length-(h=3&l.length),y=n,S=3432918353,M=461845907,k=0;k<p;)L=255&l.charCodeAt(k)|(255&l.charCodeAt(++k))<<8|(255&l.charCodeAt(++k))<<16|(255&l.charCodeAt(++k))<<24,++k,y=27492+(65535&(v=5*(65535&(y=(y^=L=(65535&(L=(L=(65535&L)*S+(((L>>>16)*S&65535)<<16)&4294967295)<<15|L>>>17))*M+(((L>>>16)*M&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(L=0,h){case 3:L^=(255&l.charCodeAt(k+2))<<16;case 2:L^=(255&l.charCodeAt(k+1))<<8;case 1:y^=L=(65535&(L=(L=(65535&(L^=255&l.charCodeAt(k)))*S+(((L>>>16)*S&65535)<<16)&4294967295)<<15|L>>>17))*M+(((L>>>16)*M&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var re={};({get exports(){return re},set exports(l){re=l}}).exports=function(l,n){for(var h,p=l.length,y=n^p,v=0;p>=4;)h=1540483477*(65535&(h=255&l.charCodeAt(v)|(255&l.charCodeAt(++v))<<8|(255&l.charCodeAt(++v))<<16|(255&l.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:y^=(255&l.charCodeAt(v+2))<<16;case 2:y^=(255&l.charCodeAt(v+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(v)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var Ae=he,Be=re;le.exports=Ae,$.murmur3=Ae,$.murmur2=Be;class Ie{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,h,p,y){this.ids.push(fe(n)),this.positions.push(h,p,y)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=fe(n);let p=0,y=this.ids.length-1;for(;p<y;){const S=p+y>>1;this.ids[S]>=h?y=S:p=S+1}const v=[];for(;this.ids[p]===h;)v.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return v}static serialize(n,h){const p=new Float64Array(n.ids),y=new Uint32Array(n.positions);return Pe(p,y,0,p.length-1),h&&h.push(p.buffer,y.buffer),{ids:p,positions:y}}static deserialize(n){const h=new Ie;return h.ids=n.ids,h.positions=n.positions,h.indexed=!0,h}}function fe(l){const n=+l;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:$(String(l))}function Pe(l,n,h,p){for(;h<p;){const y=l[h+p>>1];let v=h-1,S=p+1;for(;;){do v++;while(l[v]<y);do S--;while(l[S]>y);if(v>=S)break;Qe(l,v,S),Qe(n,3*v,3*S),Qe(n,3*v+1,3*S+1),Qe(n,3*v+2,3*S+2)}S-h<p-S?(Pe(l,n,h,S),h=S+1):(Pe(l,n,S+1,p),p=S)}}function Qe(l,n,h){const p=l[n];l[n]=l[h],l[h]=p}Lt("FeaturePositionMap",Ie);class We{constructor(n,h){this.gl=n.gl,this.location=h}}class Ze extends We{constructor(n,h){super(n,h),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class et extends We{constructor(n,h){super(n,h),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class lt extends We{constructor(n,h){super(n,h),this.current=Ke.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const rt=new Float32Array(16);function mt(l){return[Q(255*l.r,255*l.g),Q(255*l.b,255*l.a)]}class Pt{constructor(n,h,p){this.value=n,this.uniformNames=h.map(y=>`u_${y}`),this.type=p}setUniform(n,h,p){n.set(p.constantOr(this.value))}getBinding(n,h,p){return this.type==="color"?new lt(n,h):new Ze(n,h)}}class ri{constructor(n,h){this.uniformNames=h.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=n.tlbr}setUniform(n,h,p,y){const v=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&n.set(v)}getBinding(n,h,p){return p.substr(0,9)==="u_pattern"?new et(n,h):new Ze(n,h)}}class ai{constructor(n,h,p,y){this.expression=n,this.type=p,this.maxValue=0,this.paintVertexAttributes=h.map(v=>({name:`a_${v}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,h,p,y,v){const S=this.paintVertexArray.length,M=this.expression.evaluate(new en(0),h,{},y,[],v);this.paintVertexArray.resize(n),this._setPaintValue(S,n,M)}updatePaintArray(n,h,p,y){const v=this.expression.evaluate({zoom:0},p,y);this._setPaintValue(n,h,v)}_setPaintValue(n,h,p){if(this.type==="color"){const y=mt(p);for(let v=n;v<h;v++)this.paintVertexArray.emplace(v,y[0],y[1])}else{for(let y=n;y<h;y++)this.paintVertexArray.emplace(y,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ut{constructor(n,h,p,y,v,S){this.expression=n,this.uniformNames=h.map(M=>`u_${M}_t`),this.type=p,this.useIntegerZoom=y,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=h.map(M=>({name:`a_${M}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(n,h,p,y,v){const S=this.expression.evaluate(new en(this.zoom),h,{},y,[],v),M=this.expression.evaluate(new en(this.zoom+1),h,{},y,[],v),L=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(L,n,S,M)}updatePaintArray(n,h,p,y){const v=this.expression.evaluate({zoom:this.zoom},p,y),S=this.expression.evaluate({zoom:this.zoom+1},p,y);this._setPaintValue(n,h,v,S)}_setPaintValue(n,h,p,y){if(this.type==="color"){const v=mt(p),S=mt(y);for(let M=n;M<h;M++)this.paintVertexArray.emplace(M,v[0],v[1],S[0],S[1])}else{for(let v=n;v<h;v++)this.paintVertexArray.emplace(v,p,y);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(y))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,h){const p=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,y=I(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);n.set(y)}getBinding(n,h,p){return new Ze(n,h)}}class Li{constructor(n,h,p,y,v,S){this.expression=n,this.type=h,this.useIntegerZoom=p,this.zoom=y,this.layerId=S,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(n,h,p){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(y,n,h.patterns&&h.patterns[this.layerId],p)}updatePaintArray(n,h,p,y,v){this._setPaintValues(n,h,p.patterns&&p.patterns[this.layerId],v)}_setPaintValues(n,h,p,y){if(!y||!p)return;const{min:v,mid:S,max:M}=p,L=y[v],k=y[S],O=y[M];if(L&&k&&O)for(let H=n;H<h;H++)this.zoomInPaintVertexArray.emplace(H,k.tl[0],k.tl[1],k.br[0],k.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],k.pixelRatio,L.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,k.tl[0],k.tl[1],k.br[0],k.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],k.pixelRatio,O.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,z.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,z.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Di{constructor(n,h,p){this.binders={},this._buffers=[];const y=[];for(const v in n.paint._values){if(!p(v))continue;const S=n.paint.get(v);if(!(S instanceof ss&&Vo(S.property.specification)))continue;const M=Ci(v,n.type),L=S.value,k=S.property.specification.type,O=S.property.useIntegerZoom,H=S.property.specification["property-type"],j=H==="cross-faded"||H==="cross-faded-data-driven";if(L.kind==="constant")this.binders[v]=j?new ri(L.value,M):new Pt(L.value,M,k),y.push(`/u_${v}`);else if(L.kind==="source"||j){const Y=Hi(v,k,"source");this.binders[v]=j?new Li(L,k,O,h,Y,n.id):new ai(L,M,k,Y),y.push(`/a_${v}`)}else{const Y=Hi(v,k,"composite");this.binders[v]=new Ut(L,M,k,O,h,Y),y.push(`/z_${v}`)}}this.cacheKey=y.sort().join("")}getMaxValue(n){const h=this.binders[n];return h instanceof ai||h instanceof Ut?h.maxValue:0}populatePaintArrays(n,h,p,y,v){for(const S in this.binders){const M=this.binders[S];(M instanceof ai||M instanceof Ut||M instanceof Li)&&M.populatePaintArray(n,h,p,y,v)}}setConstantPatternPositions(n,h){for(const p in this.binders){const y=this.binders[p];y instanceof ri&&y.setConstantPatternPositions(n,h)}}updatePaintArrays(n,h,p,y,v){let S=!1;for(const M in n){const L=h.getPositions(M);for(const k of L){const O=p.feature(k.index);for(const H in this.binders){const j=this.binders[H];if((j instanceof ai||j instanceof Ut||j instanceof Li)&&j.expression.isStateDependent===!0){const Y=y.paint.get(H);j.expression=Y.value,j.updatePaintArray(k.start,k.end,O,n[M],v),S=!0}}}}return S}defines(){const n=[];for(const h in this.binders){const p=this.binders[h];(p instanceof Pt||p instanceof ri)&&n.push(...p.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return n}getBinderAttributes(){const n=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof ai||p instanceof Ut)for(let y=0;y<p.paintVertexAttributes.length;y++)n.push(p.paintVertexAttributes[y].name);else if(p instanceof Li)for(let y=0;y<z.members.length;y++)n.push(z.members[y].name)}return n}getBinderUniforms(){const n=[];for(const h in this.binders){const p=this.binders[h];if(p instanceof Pt||p instanceof ri||p instanceof Ut)for(const y of p.uniformNames)n.push(y)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,h){const p=[];for(const y in this.binders){const v=this.binders[y];if(v instanceof Pt||v instanceof ri||v instanceof Ut){for(const S of v.uniformNames)if(h[S]){const M=v.getBinding(n,h[S],S);p.push({name:S,property:y,binding:M})}}}return p}setUniforms(n,h,p,y){for(const{name:v,property:S,binding:M}of h)this.binders[S].setUniform(M,y,p.get(S),v)}updatePaintBuffers(n){this._buffers=[];for(const h in this.binders){const p=this.binders[h];if(n&&p instanceof Li){const y=n.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(p instanceof ai||p instanceof Ut)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(n){for(const h in this.binders){const p=this.binders[h];(p instanceof ai||p instanceof Ut||p instanceof Li)&&p.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const h=this.binders[n];(h instanceof ai||h instanceof Ut||h instanceof Li)&&h.destroy()}}}class di{constructor(n,h,p=()=>!0){this.programConfigurations={};for(const y of n)this.programConfigurations[y.id]=new Di(y,h,p);this.needsUpload=!1,this._featureMap=new Ie,this._bufferOffset=0}populatePaintArrays(n,h,p,y,v,S){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(n,h,y,v,S);h.id!==void 0&&this._featureMap.add(h.id,p,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,h,p,y){for(const v of p)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(n,this._featureMap,h,v,y)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Ci(l,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${n}-`,"").replace(/-/g,"_")]}function Hi(l,n,h){const p={color:{source:ql,composite:np},number:{source:Vh,composite:ql}},y=function(v){return{"line-pattern":{source:ba,composite:ba},"fill-pattern":{source:ba,composite:ba},"fill-extrusion-pattern":{source:ba,composite:ba}}[v]}(l);return y&&y[h]||p[n][h]}Lt("ConstantBinder",Pt),Lt("CrossFadedConstantBinder",ri),Lt("SourceExpressionBinder",ai),Lt("CrossFadedCompositeBinder",Li),Lt("CompositeExpressionBinder",Ut),Lt("ProgramConfiguration",Di,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",di);var Pi=8192;const Yr=Math.pow(2,14)-1,Kr=-Yr-1;function qn(l){const n=Pi/l.extent,h=l.loadGeometry();for(let p=0;p<h.length;p++){const y=h[p];for(let v=0;v<y.length;v++){const S=y[v],M=Math.round(S.x*n),L=Math.round(S.y*n);S.x=I(M,Kr,Yr),S.y=I(L,Kr,Yr),(M<S.x||M>S.x+1||L<S.y||L>S.y+1)&&q("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Pr(l,n){return{type:l.type,id:l.id,properties:l.properties,geometry:n?qn(l):[]}}function ar(l,n,h,p,y){l.emplaceBack(2*n+(p+1)/2,2*h+(y+1)/2)}class os{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new jl,this.indexArray=new w,this.segments=new F,this.programConfigurations=new di(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){const y=this.layers[0],v=[];let S=null,M=!1;y.type==="circle"&&(S=y.layout.get("circle-sort-key"),M=!S.isConstant());for(const{feature:L,id:k,index:O,sourceLayerIndex:H}of n){const j=this.layers[0]._featureFilter.needGeometry,Y=Pr(L,j);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),Y,p))continue;const ee=M?S.evaluate(Y,{},p):void 0,ge={id:k,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:j?Y.geometry:qn(L),patterns:{},sortKey:ee};v.push(ge)}M&&v.sort((L,k)=>L.sortKey-k.sortKey);for(const L of v){const{geometry:k,index:O,sourceLayerIndex:H}=L,j=n[O].feature;this.addFeature(L,k,O,p),h.featureIndex.insert(j,k,O,H,this.index)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,D),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,h,p,y){for(const v of h)for(const S of v){const M=S.x,L=S.y;if(M<0||M>=Pi||L<0||L>=Pi)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),O=k.vertexLength;ar(this.layoutVertexArray,M,L,-1,-1),ar(this.layoutVertexArray,M,L,1,-1),ar(this.layoutVertexArray,M,L,1,1),ar(this.layoutVertexArray,M,L,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,{},y)}}function wa(l,n){for(let h=0;h<l.length;h++)if(ls(n,l[h]))return!0;for(let h=0;h<n.length;h++)if(ls(l,n[h]))return!0;return!!Ui(l,n)}function $h(l,n,h){return!!ls(l,n)||!!lr(n,l,h)}function Mn(l,n){if(l.length===1)return Ds(n,l[0]);for(let h=0;h<n.length;h++){const p=n[h];for(let y=0;y<p.length;y++)if(ls(l,p[y]))return!0}for(let h=0;h<l.length;h++)if(Ds(n,l[h]))return!0;for(let h=0;h<n.length;h++)if(Ui(l,n[h]))return!0;return!1}function on(l,n,h){if(l.length>1){if(Ui(l,n))return!0;for(let p=0;p<n.length;p++)if(lr(n[p],l,h))return!0}for(let p=0;p<l.length;p++)if(lr(l[p],n,h))return!0;return!1}function Ui(l,n){if(l.length===0||n.length===0)return!1;for(let h=0;h<l.length-1;h++){const p=l[h],y=l[h+1];for(let v=0;v<n.length-1;v++)if(or(p,y,n[v],n[v+1]))return!0}return!1}function or(l,n,h,p){return te(l,h,p)!==te(n,h,p)&&te(l,n,h)!==te(l,n,p)}function lr(l,n,h){const p=h*h;if(n.length===1)return l.distSqr(n[0])<p;for(let y=1;y<n.length;y++)if(ln(l,n[y-1],n[y])<p)return!0;return!1}function ln(l,n,h){const p=n.distSqr(h);if(p===0)return l.distSqr(n);const y=((l.x-n.x)*(h.x-n.x)+(l.y-n.y)*(h.y-n.y))/p;return l.distSqr(y<0?n:y>1?h:h.sub(n)._mult(y)._add(n))}function Ds(l,n){let h,p,y,v=!1;for(let S=0;S<l.length;S++){h=l[S];for(let M=0,L=h.length-1;M<h.length;L=M++)p=h[M],y=h[L],p.y>n.y!=y.y>n.y&&n.x<(y.x-p.x)*(n.y-p.y)/(y.y-p.y)+p.x&&(v=!v)}return v}function ls(l,n){let h=!1;for(let p=0,y=l.length-1;p<l.length;y=p++){const v=l[p],S=l[y];v.y>n.y!=S.y>n.y&&n.x<(S.x-v.x)*(n.y-v.y)/(S.y-v.y)+v.x&&(h=!h)}return h}function op(l,n,h){const p=h[0],y=h[2];if(l.x<p.x&&n.x<p.x||l.x>y.x&&n.x>y.x||l.y<p.y&&n.y<p.y||l.y>y.y&&n.y>y.y)return!1;const v=te(l,n,h[0]);return v!==te(l,n,h[1])||v!==te(l,n,h[2])||v!==te(l,n,h[3])}function no(l,n,h){const p=n.paint.get(l).value;return p.kind==="constant"?p.value:h.programConfigurations.get(n.id).getMaxValue(l)}function jh(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Xh(l,n,h,p,y){if(!n[0]&&!n[1])return l;const v=Re.convert(n)._mult(y);h==="viewport"&&v._rotate(-p);const S=[];for(let M=0;M<l.length;M++)S.push(l[M].sub(v));return S}Lt("CircleBucket",os,{omit:["layers"]});const Xl=new yr({"circle-sort-key":new ti(be.layout_circle["circle-sort-key"])});var ly={paint:new yr({"circle-radius":new ti(be.paint_circle["circle-radius"]),"circle-color":new ti(be.paint_circle["circle-color"]),"circle-blur":new ti(be.paint_circle["circle-blur"]),"circle-opacity":new ti(be.paint_circle["circle-opacity"]),"circle-translate":new Qt(be.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ti(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ti(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ti(be.paint_circle["circle-stroke-opacity"])}),layout:Xl},Ln=1e-6,Ea=typeof Float32Array<"u"?Float32Array:Array;function cy(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function GI(l,n,h){var p=n[0],y=n[1],v=n[2],S=n[3],M=n[4],L=n[5],k=n[6],O=n[7],H=n[8],j=n[9],Y=n[10],ee=n[11],ge=n[12],me=n[13],Le=n[14],Ge=n[15],Ce=h[0],ze=h[1],it=h[2],tt=h[3];return l[0]=Ce*p+ze*M+it*H+tt*ge,l[1]=Ce*y+ze*L+it*j+tt*me,l[2]=Ce*v+ze*k+it*Y+tt*Le,l[3]=Ce*S+ze*O+it*ee+tt*Ge,l[4]=(Ce=h[4])*p+(ze=h[5])*M+(it=h[6])*H+(tt=h[7])*ge,l[5]=Ce*y+ze*L+it*j+tt*me,l[6]=Ce*v+ze*k+it*Y+tt*Le,l[7]=Ce*S+ze*O+it*ee+tt*Ge,l[8]=(Ce=h[8])*p+(ze=h[9])*M+(it=h[10])*H+(tt=h[11])*ge,l[9]=Ce*y+ze*L+it*j+tt*me,l[10]=Ce*v+ze*k+it*Y+tt*Le,l[11]=Ce*S+ze*O+it*ee+tt*Ge,l[12]=(Ce=h[12])*p+(ze=h[13])*M+(it=h[14])*H+(tt=h[15])*ge,l[13]=Ce*y+ze*L+it*j+tt*me,l[14]=Ce*v+ze*k+it*Y+tt*Le,l[15]=Ce*S+ze*O+it*ee+tt*Ge,l}Math.hypot||(Math.hypot=function(){for(var l=0,n=arguments.length;n--;)l+=arguments[n]*arguments[n];return Math.sqrt(l)});var lp,X5=GI;function Jm(l,n,h){var p=n[0],y=n[1],v=n[2],S=n[3];return l[0]=h[0]*p+h[4]*y+h[8]*v+h[12]*S,l[1]=h[1]*p+h[5]*y+h[9]*v+h[13]*S,l[2]=h[2]*p+h[6]*y+h[10]*v+h[14]*S,l[3]=h[3]*p+h[7]*y+h[11]*v+h[15]*S,l}function QI(l,n){const h=Jm([],[l.x,l.y,0,1],n);return new Re(h[0]/h[3],h[1]/h[3])}lp=new Ea(4),Ea!=Float32Array&&(lp[0]=0,lp[1]=0,lp[2]=0,lp[3]=0);class VI extends os{}Lt("HeatmapBucket",VI,{omit:["layers"]});var Y5={paint:new yr({"heatmap-radius":new ti(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ti(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qd(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(be.paint_heatmap["heatmap-opacity"])})};function hy(l,{width:n,height:h},p,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==n*h*p)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${n*h*p}`)}else y=new Uint8Array(n*h*p);return l.width=n,l.height=h,l.data=y,l}function HI(l,{width:n,height:h},p){if(n===l.width&&h===l.height)return;const y=hy({},{width:n,height:h},p);uy(l,y,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,n),height:Math.min(l.height,h)},p),l.width=n,l.height=h,l.data=y.data}function uy(l,n,h,p,y,v){if(y.width===0||y.height===0)return n;if(y.width>l.width||y.height>l.height||h.x>l.width-y.width||h.y>l.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>n.width||y.height>n.height||p.x>n.width-y.width||p.y>n.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const S=l.data,M=n.data;if(S===M)throw new Error("srcData equals dstData, so image is already copied");for(let L=0;L<y.height;L++){const k=((h.y+L)*l.width+h.x)*v,O=((p.y+L)*n.width+p.x)*v;for(let H=0;H<y.width*v;H++)M[O+H]=S[k+H]}return n}class cp{constructor(n,h){hy(this,n,1,h)}resize(n){HI(this,n,1)}clone(){return new cp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,h,p,y,v){uy(n,h,p,y,v,1)}}class cs{constructor(n,h){hy(this,n,4,h)}resize(n){HI(this,n,4)}replace(n,h){h?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,h,p,y,v){uy(n,h,p,y,v,4)}}function WI(l){const n={},h=l.resolution||256,p=l.clips?l.clips.length:1,y=l.image||new cs({width:h,height:p});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const v=(S,M,L)=>{n[l.evaluationKey]=L;const k=l.expression.evaluate(n);y.data[S+M+0]=Math.floor(255*k.r/k.a),y.data[S+M+1]=Math.floor(255*k.g/k.a),y.data[S+M+2]=Math.floor(255*k.b/k.a),y.data[S+M+3]=Math.floor(255*k.a)};if(l.clips)for(let S=0,M=0;S<p;++S,M+=4*h)for(let L=0,k=0;L<h;L++,k+=4){const O=L/(h-1),{start:H,end:j}=l.clips[S];v(M,k,H*(1-O)+j*O)}else for(let S=0,M=0;S<h;S++,M+=4)v(0,M,S/(h-1));return y}Lt("AlphaImage",cp),Lt("RGBAImage",cs);var K5={paint:new yr({"hillshade-illumination-direction":new Qt(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qt(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(be.paint_hillshade["hillshade-accent-color"])})};const Z5=Cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:J5}=Z5;var hp={};function eg(l,n,h){h=h||2;var p,y,v,S,M,L,k,O=n&&n.length,H=O?n[0]*h:l.length,j=qI(l,0,H,h,!0),Y=[];if(!j||j.next===j.prev)return Y;if(O&&(j=function(ge,me,Le,Ge){var Ce,ze,it,tt=[];for(Ce=0,ze=me.length;Ce<ze;Ce++)(it=qI(ge,me[Ce]*Ge,Ce<ze-1?me[Ce+1]*Ge:ge.length,Ge,!1))===it.next&&(it.steiner=!0),tt.push(oN(it));for(tt.sort(rN),Ce=0;Ce<tt.length;Ce++)Le=sN(tt[Ce],Le);return Le}(l,n,j,h)),l.length>80*h){p=v=l[0],y=S=l[1];for(var ee=h;ee<H;ee+=h)(M=l[ee])<p&&(p=M),(L=l[ee+1])<y&&(y=L),M>v&&(v=M),L>S&&(S=L);k=(k=Math.max(v-p,S-y))!==0?32767/k:0}return up(j,Y,h,p,y,k,0),Y}function qI(l,n,h,p,y){var v,S;if(y===fy(l,n,h,p)>0)for(v=n;v<h;v+=p)S=XI(v,l[v],l[v+1],S);else for(v=h-p;v>=n;v-=p)S=XI(v,l[v],l[v+1],S);return S&&tg(S,S.next)&&(pp(S),S=S.next),S}function Yl(l,n){if(!l)return l;n||(n=l);var h,p=l;do if(h=!1,p.steiner||!tg(p,p.next)&&Sn(p.prev,p,p.next)!==0)p=p.next;else{if(pp(p),(p=n=p.prev)===p.next)break;h=!0}while(h||p!==n);return n}function up(l,n,h,p,y,v,S){if(l){!S&&v&&function(O,H,j,Y){var ee=O;do ee.z===0&&(ee.z=dy(ee.x,ee.y,H,j,Y)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==O);ee.prevZ.nextZ=null,ee.prevZ=null,function(ge){var me,Le,Ge,Ce,ze,it,tt,Ft,Gt=1;do{for(Le=ge,ge=null,ze=null,it=0;Le;){for(it++,Ge=Le,tt=0,me=0;me<Gt&&(tt++,Ge=Ge.nextZ);me++);for(Ft=Gt;tt>0||Ft>0&&Ge;)tt!==0&&(Ft===0||!Ge||Le.z<=Ge.z)?(Ce=Le,Le=Le.nextZ,tt--):(Ce=Ge,Ge=Ge.nextZ,Ft--),ze?ze.nextZ=Ce:ge=Ce,Ce.prevZ=ze,ze=Ce;Le=Ge}ze.nextZ=null,Gt*=2}while(it>1)}(ee)}(l,p,y,v);for(var M,L,k=l;l.prev!==l.next;)if(M=l.prev,L=l.next,v?tN(l,p,y,v):eN(l))n.push(M.i/h|0),n.push(l.i/h|0),n.push(L.i/h|0),pp(l),l=L.next,k=L.next;else if((l=L)===k){S?S===1?up(l=iN(Yl(l),n,h),n,h,p,y,v,2):S===2&&nN(l,n,h,p,y,v):up(Yl(l),n,h,p,y,v,1);break}}}function eN(l){var n=l.prev,h=l,p=l.next;if(Sn(n,h,p)>=0)return!1;for(var y=n.x,v=h.x,S=p.x,M=n.y,L=h.y,k=p.y,O=y<v?y<S?y:S:v<S?v:S,H=M<L?M<k?M:k:L<k?L:k,j=y>v?y>S?y:S:v>S?v:S,Y=M>L?M>k?M:k:L>k?L:k,ee=p.next;ee!==n;){if(ee.x>=O&&ee.x<=j&&ee.y>=H&&ee.y<=Y&&Yh(y,M,v,L,S,k,ee.x,ee.y)&&Sn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function tN(l,n,h,p){var y=l.prev,v=l,S=l.next;if(Sn(y,v,S)>=0)return!1;for(var M=y.x,L=v.x,k=S.x,O=y.y,H=v.y,j=S.y,Y=M<L?M<k?M:k:L<k?L:k,ee=O<H?O<j?O:j:H<j?H:j,ge=M>L?M>k?M:k:L>k?L:k,me=O>H?O>j?O:j:H>j?H:j,Le=dy(Y,ee,n,h,p),Ge=dy(ge,me,n,h,p),Ce=l.prevZ,ze=l.nextZ;Ce&&Ce.z>=Le&&ze&&ze.z<=Ge;){if(Ce.x>=Y&&Ce.x<=ge&&Ce.y>=ee&&Ce.y<=me&&Ce!==y&&Ce!==S&&Yh(M,O,L,H,k,j,Ce.x,Ce.y)&&Sn(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,ze.x>=Y&&ze.x<=ge&&ze.y>=ee&&ze.y<=me&&ze!==y&&ze!==S&&Yh(M,O,L,H,k,j,ze.x,ze.y)&&Sn(ze.prev,ze,ze.next)>=0))return!1;ze=ze.nextZ}for(;Ce&&Ce.z>=Le;){if(Ce.x>=Y&&Ce.x<=ge&&Ce.y>=ee&&Ce.y<=me&&Ce!==y&&Ce!==S&&Yh(M,O,L,H,k,j,Ce.x,Ce.y)&&Sn(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;ze&&ze.z<=Ge;){if(ze.x>=Y&&ze.x<=ge&&ze.y>=ee&&ze.y<=me&&ze!==y&&ze!==S&&Yh(M,O,L,H,k,j,ze.x,ze.y)&&Sn(ze.prev,ze,ze.next)>=0)return!1;ze=ze.nextZ}return!0}function iN(l,n,h){var p=l;do{var y=p.prev,v=p.next.next;!tg(y,v)&&$I(y,p,p.next,v)&&dp(y,v)&&dp(v,y)&&(n.push(y.i/h|0),n.push(p.i/h|0),n.push(v.i/h|0),pp(p),pp(p.next),p=l=v),p=p.next}while(p!==l);return Yl(p)}function nN(l,n,h,p,y,v){var S=l;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&lN(S,M)){var L=jI(S,M);return S=Yl(S,S.next),L=Yl(L,L.next),up(S,n,h,p,y,v,0),void up(L,n,h,p,y,v,0)}M=M.next}S=S.next}while(S!==l)}function rN(l,n){return l.x-n.x}function sN(l,n){var h=function(y,v){var S,M=v,L=y.x,k=y.y,O=-1/0;do{if(k<=M.y&&k>=M.next.y&&M.next.y!==M.y){var H=M.x+(k-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(H<=L&&H>O&&(O=H,S=M.x<M.next.x?M:M.next,H===L))return S}M=M.next}while(M!==v);if(!S)return null;var j,Y=S,ee=S.x,ge=S.y,me=1/0;M=S;do L>=M.x&&M.x>=ee&&L!==M.x&&Yh(k<ge?L:O,k,ee,ge,k<ge?O:L,k,M.x,M.y)&&(j=Math.abs(k-M.y)/(L-M.x),dp(M,y)&&(j<me||j===me&&(M.x>S.x||M.x===S.x&&aN(S,M)))&&(S=M,me=j)),M=M.next;while(M!==Y);return S}(l,n);if(!h)return n;var p=jI(h,l);return Yl(p,p.next),Yl(h,h.next)}function aN(l,n){return Sn(l.prev,l,n.prev)<0&&Sn(n.next,l,l.next)<0}function dy(l,n,h,p,y){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-h)*y|0)|l<<8))|l<<4))|l<<2))|l<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-p)*y|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function oN(l){var n=l,h=l;do(n.x<h.x||n.x===h.x&&n.y<h.y)&&(h=n),n=n.next;while(n!==l);return h}function Yh(l,n,h,p,y,v,S,M){return(y-S)*(n-M)>=(l-S)*(v-M)&&(l-S)*(p-M)>=(h-S)*(n-M)&&(h-S)*(v-M)>=(y-S)*(p-M)}function lN(l,n){return l.next.i!==n.i&&l.prev.i!==n.i&&!function(h,p){var y=h;do{if(y.i!==h.i&&y.next.i!==h.i&&y.i!==p.i&&y.next.i!==p.i&&$I(y,y.next,h,p))return!0;y=y.next}while(y!==h);return!1}(l,n)&&(dp(l,n)&&dp(n,l)&&function(h,p){var y=h,v=!1,S=(h.x+p.x)/2,M=(h.y+p.y)/2;do y.y>M!=y.next.y>M&&y.next.y!==y.y&&S<(y.next.x-y.x)*(M-y.y)/(y.next.y-y.y)+y.x&&(v=!v),y=y.next;while(y!==h);return v}(l,n)&&(Sn(l.prev,l,n.prev)||Sn(l,n.prev,n))||tg(l,n)&&Sn(l.prev,l,l.next)>0&&Sn(n.prev,n,n.next)>0)}function Sn(l,n,h){return(n.y-l.y)*(h.x-n.x)-(n.x-l.x)*(h.y-n.y)}function tg(l,n){return l.x===n.x&&l.y===n.y}function $I(l,n,h,p){var y=ng(Sn(l,n,h)),v=ng(Sn(l,n,p)),S=ng(Sn(h,p,l)),M=ng(Sn(h,p,n));return y!==v&&S!==M||!(y!==0||!ig(l,h,n))||!(v!==0||!ig(l,p,n))||!(S!==0||!ig(h,l,p))||!(M!==0||!ig(h,n,p))}function ig(l,n,h){return n.x<=Math.max(l.x,h.x)&&n.x>=Math.min(l.x,h.x)&&n.y<=Math.max(l.y,h.y)&&n.y>=Math.min(l.y,h.y)}function ng(l){return l>0?1:l<0?-1:0}function dp(l,n){return Sn(l.prev,l,l.next)<0?Sn(l,n,l.next)>=0&&Sn(l,l.prev,n)>=0:Sn(l,n,l.prev)<0||Sn(l,l.next,n)<0}function jI(l,n){var h=new py(l.i,l.x,l.y),p=new py(n.i,n.x,n.y),y=l.next,v=n.prev;return l.next=n,n.prev=l,h.next=y,y.prev=h,p.next=h,h.prev=p,v.next=p,p.prev=v,p}function XI(l,n,h,p){var y=new py(l,n,h);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function pp(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function py(l,n,h){this.i=l,this.x=n,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fy(l,n,h,p){for(var y=0,v=n,S=h-p;v<h;v+=p)y+=(l[S]-l[v])*(l[v+1]+l[S+1]),S=v;return y}function cN(l,n,h,p,y){YI(l,n,h||0,p||l.length-1,y||hN)}function YI(l,n,h,p,y){for(;p>h;){if(p-h>600){var v=p-h+1,S=n-h+1,M=Math.log(v),L=.5*Math.exp(2*M/3),k=.5*Math.sqrt(M*L*(v-L)/v)*(S-v/2<0?-1:1);YI(l,n,Math.max(h,Math.floor(n-S*L/v+k)),Math.min(p,Math.floor(n+(v-S)*L/v+k)),y)}var O=l[n],H=h,j=p;for(fp(l,h,n),y(l[p],O)>0&&fp(l,h,p);H<j;){for(fp(l,H,j),H++,j--;y(l[H],O)<0;)H++;for(;y(l[j],O)>0;)j--}y(l[h],O)===0?fp(l,h,j):fp(l,++j,p),j<=n&&(h=j+1),n<=j&&(p=j-1)}}function fp(l,n,h){var p=l[n];l[n]=l[h],l[h]=p}function hN(l,n){return l<n?-1:l>n?1:0}function my(l,n){const h=l.length;if(h<=1)return[l];const p=[];let y,v;for(let S=0;S<h;S++){const M=ue(l[S]);M!==0&&(l[S].area=Math.abs(M),v===void 0&&(v=M<0),v===M<0?(y&&p.push(y),y=[l[S]]):y.push(l[S]))}if(y&&p.push(y),n>1)for(let S=0;S<p.length;S++)p[S].length<=n||(cN(p[S],n,1,p[S].length-1,uN),p[S]=p[S].slice(0,n));return p}function uN(l,n){return n.area-l.area}function gy(l,n,h){const p=h.patternDependencies;let y=!1;for(const v of n){const S=v.paint.get(`${l}-pattern`);S.isConstant()||(y=!0);const M=S.constantOr(null);M&&(y=!0,p[M.to]=!0,p[M.from]=!0)}return y}function Ay(l,n,h,p,y){const v=y.patternDependencies;for(const S of n){const M=S.paint.get(`${l}-pattern`).value;if(M.kind!=="constant"){let L=M.evaluate({zoom:p-1},h,{},y.availableImages),k=M.evaluate({zoom:p},h,{},y.availableImages),O=M.evaluate({zoom:p+1},h,{},y.availableImages);L=L&&L.name?L.name:L,k=k&&k.name?k.name:k,O=O&&O.name?O.name:O,v[L]=!0,v[k]=!0,v[O]=!0,h.patterns[S.id]={min:L,mid:k,max:O}}}return h}({get exports(){return hp},set exports(l){hp=l}}).exports=eg,hp.default=eg,eg.deviation=function(l,n,h,p){var y=n&&n.length,v=Math.abs(fy(l,0,y?n[0]*h:l.length,h));if(y)for(var S=0,M=n.length;S<M;S++)v-=Math.abs(fy(l,n[S]*h,S<M-1?n[S+1]*h:l.length,h));var L=0;for(S=0;S<p.length;S+=3){var k=p[S]*h,O=p[S+1]*h,H=p[S+2]*h;L+=Math.abs((l[k]-l[H])*(l[O+1]-l[k+1])-(l[k]-l[O])*(l[H+1]-l[k+1]))}return v===0&&L===0?0:Math.abs((L-v)/v)},eg.flatten=function(l){for(var n=l[0][0].length,h={vertices:[],holes:[],dimensions:n},p=0,y=0;y<l.length;y++){for(var v=0;v<l[y].length;v++)for(var S=0;S<n;S++)h.vertices.push(l[y][v][S]);y>0&&h.holes.push(p+=l[y-1].length)}return h};class _y{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new sy,this.indexArray=new w,this.indexArray2=new C,this.programConfigurations=new di(n.layers,n.zoom),this.segments=new F,this.segments2=new F,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){this.hasPattern=gy("fill",this.layers,h);const y=this.layers[0].layout.get("fill-sort-key"),v=!y.isConstant(),S=[];for(const{feature:M,id:L,index:k,sourceLayerIndex:O}of n){const H=this.layers[0]._featureFilter.needGeometry,j=Pr(M,H);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),j,p))continue;const Y=v?y.evaluate(j,{},p,h.availableImages):void 0,ee={id:L,properties:M.properties,type:M.type,sourceLayerIndex:O,index:k,geometry:H?j.geometry:qn(M),patterns:{},sortKey:Y};S.push(ee)}v&&S.sort((M,L)=>M.sortKey-L.sortKey);for(const M of S){const{geometry:L,index:k,sourceLayerIndex:O}=M;if(this.hasPattern){const H=Ay("fill",this.layers,M,this.zoom,h);this.patternFeatures.push(H)}else this.addFeature(M,L,k,p,{});h.featureIndex.insert(n[k].feature,L,k,O,this.index)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}addFeatures(n,h,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,J5),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,h,p,y,v){for(const S of my(h,500)){let M=0;for(const Y of S)M+=Y.length;const L=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),k=L.vertexLength,O=[],H=[];for(const Y of S){if(Y.length===0)continue;Y!==S[0]&&H.push(O.length/2);const ee=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),ge=ee.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(ge+Y.length-1,ge),O.push(Y[0].x),O.push(Y[0].y);for(let me=1;me<Y.length;me++)this.layoutVertexArray.emplaceBack(Y[me].x,Y[me].y),this.indexArray2.emplaceBack(ge+me-1,ge+me),O.push(Y[me].x),O.push(Y[me].y);ee.vertexLength+=Y.length,ee.primitiveLength+=Y.length}const j=hp(O,H);for(let Y=0;Y<j.length;Y+=3)this.indexArray.emplaceBack(k+j[Y],k+j[Y+1],k+j[Y+2]);L.vertexLength+=M,L.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,v,y)}}Lt("FillBucket",_y,{omit:["layers","patternFeatures"]});const dN=new yr({"fill-sort-key":new ti(be.layout_fill["fill-sort-key"])});var pN={paint:new yr({"fill-antialias":new Qt(be.paint_fill["fill-antialias"]),"fill-opacity":new ti(be.paint_fill["fill-opacity"]),"fill-color":new ti(be.paint_fill["fill-color"]),"fill-outline-color":new ti(be.paint_fill["fill-outline-color"]),"fill-translate":new Qt(be.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yo(be.paint_fill["fill-pattern"])}),layout:dN};const fN=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),mN=Cn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:gN}=fN;var Jo={},AN=Re,KI=Kh;function Kh(l,n,h,p,y){this.properties={},this.extent=h,this.type=0,this._pbf=l,this._geometry=-1,this._keys=p,this._values=y,l.readFields(_N,this,n)}function _N(l,n,h){l==1?n.id=h.readVarint():l==2?function(p,y){for(var v=p.readVarint()+p.pos;p.pos<v;){var S=y._keys[p.readVarint()],M=y._values[p.readVarint()];y.properties[S]=M}}(h,n):l==3?n.type=h.readVarint():l==4&&(n._geometry=h.pos)}function yN(l){for(var n,h,p=0,y=0,v=l.length,S=v-1;y<v;S=y++)p+=((h=l[S]).x-(n=l[y]).x)*(n.y+h.y);return p}Kh.types=["Unknown","Point","LineString","Polygon"],Kh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var n,h=l.readVarint()+l.pos,p=1,y=0,v=0,S=0,M=[];l.pos<h;){if(y<=0){var L=l.readVarint();p=7&L,y=L>>3}if(y--,p===1||p===2)v+=l.readSVarint(),S+=l.readSVarint(),p===1&&(n&&M.push(n),n=[]),n.push(new AN(v,S));else{if(p!==7)throw new Error("unknown command "+p);n&&n.push(n[0].clone())}}return n&&M.push(n),M},Kh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var n=l.readVarint()+l.pos,h=1,p=0,y=0,v=0,S=1/0,M=-1/0,L=1/0,k=-1/0;l.pos<n;){if(p<=0){var O=l.readVarint();h=7&O,p=O>>3}if(p--,h===1||h===2)(y+=l.readSVarint())<S&&(S=y),y>M&&(M=y),(v+=l.readSVarint())<L&&(L=v),v>k&&(k=v);else if(h!==7)throw new Error("unknown command "+h)}return[S,L,M,k]},Kh.prototype.toGeoJSON=function(l,n,h){var p,y,v=this.extent*Math.pow(2,h),S=this.extent*l,M=this.extent*n,L=this.loadGeometry(),k=Kh.types[this.type];function O(Y){for(var ee=0;ee<Y.length;ee++){var ge=Y[ee];Y[ee]=[360*(ge.x+S)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+M)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(p=0;p<L.length;p++)H[p]=L[p][0];O(L=H);break;case 2:for(p=0;p<L.length;p++)O(L[p]);break;case 3:for(L=function(Y){var ee=Y.length;if(ee<=1)return[Y];for(var ge,me,Le=[],Ge=0;Ge<ee;Ge++){var Ce=yN(Y[Ge]);Ce!==0&&(me===void 0&&(me=Ce<0),me===Ce<0?(ge&&Le.push(ge),ge=[Y[Ge]]):ge.push(Y[Ge]))}return ge&&Le.push(ge),Le}(L),p=0;p<L.length;p++)for(y=0;y<L[p].length;y++)O(L[p][y])}L.length===1?L=L[0]:k="Multi"+k;var j={type:"Feature",geometry:{type:k,coordinates:L},properties:this.properties};return"id"in this&&(j.id=this.id),j};var xN=KI,ZI=JI;function JI(l,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(vN,this,n),this.length=this._features.length}function vN(l,n,h){l===15?n.version=h.readVarint():l===1?n.name=h.readString():l===5?n.extent=h.readVarint():l===2?n._features.push(h.pos):l===3?n._keys.push(h.readString()):l===4&&n._values.push(function(p){for(var y=null,v=p.readVarint()+p.pos;p.pos<v;){var S=p.readVarint()>>3;y=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return y}(h))}JI.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var n=this._pbf.readVarint()+this._pbf.pos;return new xN(this._pbf,n,this.extent,this._keys,this._values)};var bN=ZI;function wN(l,n,h){if(l===3){var p=new bN(h,h.readVarint()+h.pos);p.length&&(n[p.name]=p)}}Jo.VectorTile=function(l,n){this.layers=l.readFields(wN,{},n)},Jo.VectorTileFeature=KI,Jo.VectorTileLayer=ZI;const EN=Jo.VectorTileFeature.types,yy=Math.pow(2,13);function mp(l,n,h,p,y,v,S,M){l.emplaceBack(n,h,2*Math.floor(p*yy)+S,y*yy*2,v*yy*2,Math.round(M))}class xy{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ay,this.centroidVertexArray=new ap,this.indexArray=new w,this.programConfigurations=new di(n.layers,n.zoom),this.segments=new F,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){this.features=[],this.hasPattern=gy("fill-extrusion",this.layers,h);for(const{feature:y,id:v,index:S,sourceLayerIndex:M}of n){const L=this.layers[0]._featureFilter.needGeometry,k=Pr(y,L);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),k,p))continue;const O={id:v,sourceLayerIndex:M,index:S,geometry:L?k.geometry:qn(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(Ay("fill-extrusion",this.layers,O,this.zoom,h)):this.addFeature(O,O.geometry,S,p,{}),h.featureIndex.insert(y,O.geometry,S,M,this.index,!0)}}addFeatures(n,h,p){for(const y of this.features){const{geometry:v}=y;this.addFeature(y,v,y.index,h,p)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,gN),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,mN.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,h,p,y,v){const S={x:0,y:0,vertexCount:0};for(const M of my(h,500)){let L=0;for(const ee of M)L+=ee.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ee of M){if(ee.length===0||IN(ee))continue;let ge=0;for(let me=0;me<ee.length;me++){const Le=ee[me];if(me>=1){const Ge=ee[me-1];if(!SN(Le,Ge)){k.vertexLength+4>F.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ce=Le.sub(Ge)._perp()._unit(),ze=Ge.dist(Le);ge+ze>32768&&(ge=0),mp(this.layoutVertexArray,Le.x,Le.y,Ce.x,Ce.y,0,0,ge),mp(this.layoutVertexArray,Le.x,Le.y,Ce.x,Ce.y,0,1,ge),S.x+=2*Le.x,S.y+=2*Le.y,S.vertexCount+=2,ge+=ze,mp(this.layoutVertexArray,Ge.x,Ge.y,Ce.x,Ce.y,0,0,ge),mp(this.layoutVertexArray,Ge.x,Ge.y,Ce.x,Ce.y,0,1,ge),S.x+=2*Ge.x,S.y+=2*Ge.y,S.vertexCount+=2;const it=k.vertexLength;this.indexArray.emplaceBack(it,it+2,it+1),this.indexArray.emplaceBack(it+1,it+2,it+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+L>F.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),EN[n.type]!=="Polygon")continue;const O=[],H=[],j=k.vertexLength;for(const ee of M)if(ee.length!==0){ee!==M[0]&&H.push(O.length/2);for(let ge=0;ge<ee.length;ge++){const me=ee[ge];mp(this.layoutVertexArray,me.x,me.y,0,0,1,1,0),S.x+=me.x,S.y+=me.y,S.vertexCount+=1,O.push(me.x),O.push(me.y)}}const Y=hp(O,H);for(let ee=0;ee<Y.length;ee+=3)this.indexArray.emplaceBack(j+Y[ee],j+Y[ee+2],j+Y[ee+1]);k.primitiveLength+=Y.length/3,k.vertexLength+=L}for(let M=0;M<S.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,v,y)}}function SN(l,n){return l.x===n.x&&(l.x<0||l.x>Pi)||l.y===n.y&&(l.y<0||l.y>Pi)}function IN(l){return l.every(n=>n.x<0)||l.every(n=>n.x>Pi)||l.every(n=>n.y<0)||l.every(n=>n.y>Pi)}Lt("FillExtrusionBucket",xy,{omit:["layers","features"]});var CN={paint:new yr({"fill-extrusion-opacity":new Qt(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ti(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yo(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ti(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ti(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qt(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function gp(l,n){return l.x*n.x+l.y*n.y}function eC(l,n){if(l.length===1){let h=0;const p=n[h++];let y;for(;!y||p.equals(y);)if(y=n[h++],!y)return 1/0;for(;h<n.length;h++){const v=n[h],S=l[0],M=y.sub(p),L=v.sub(p),k=S.sub(p),O=gp(M,M),H=gp(M,L),j=gp(L,L),Y=gp(k,M),ee=gp(k,L),ge=O*j-H*H,me=(j*Y-H*ee)/ge,Le=(O*ee-H*Y)/ge,Ge=p.z*(1-me-Le)+y.z*me+v.z*Le;if(isFinite(Ge))return Ge}return 1/0}{let h=1/0;for(const p of n)h=Math.min(h,p.z);return h}}const MN=Cn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:TN}=MN,BN=Cn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:RN}=BN,LN=Jo.VectorTileFeature.types,DN=Math.cos(Math.PI/180*37.5),tC=Math.pow(2,14)/.5;class vy{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(h=>h.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Zm,this.layoutVertexArray2=new oy,this.indexArray=new w,this.programConfigurations=new di(n.layers,n.zoom),this.segments=new F,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(n,h,p){this.hasPattern=gy("line",this.layers,h);const y=this.layers[0].layout.get("line-sort-key"),v=!y.isConstant(),S=[];for(const{feature:M,id:L,index:k,sourceLayerIndex:O}of n){const H=this.layers[0]._featureFilter.needGeometry,j=Pr(M,H);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),j,p))continue;const Y=v?y.evaluate(j,{},p):void 0,ee={id:L,properties:M.properties,type:M.type,sourceLayerIndex:O,index:k,geometry:H?j.geometry:qn(M),patterns:{},sortKey:Y};S.push(ee)}v&&S.sort((M,L)=>M.sortKey-L.sortKey);for(const M of S){const{geometry:L,index:k,sourceLayerIndex:O}=M;if(this.hasPattern){const H=Ay("line",this.layers,M,this.zoom,h);this.patternFeatures.push(H)}else this.addFeature(M,L,k,p,{});h.featureIndex.insert(n[k].feature,L,k,O,this.index)}}update(n,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,h,this.stateDependentLayers,p)}addFeatures(n,h,p){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,RN)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,TN),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,h,p,y,v){const S=this.layers[0].layout,M=S.get("line-join").evaluate(n,{}),L=S.get("line-cap"),k=S.get("line-miter-limit"),O=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const H of h)this.addLine(H,n,M,L,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,p,v,y)}addLine(n,h,p,y,v,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Le=0;Le<n.length-1;Le++)this.totalDistance+=n[Le].dist(n[Le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=LN[h.type]==="Polygon";let L=n.length;for(;L>=2&&n[L-1].equals(n[L-2]);)L--;let k=0;for(;k<L-1&&n[k].equals(n[k+1]);)k++;if(L<(M?3:2))return;p==="bevel"&&(v=1.05);const O=this.overscaling<=16?122880/(512*this.overscaling):0,H=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let j,Y,ee,ge,me;this.e1=this.e2=-1,M&&(j=n[L-2],me=n[k].sub(j)._unit()._perp());for(let Le=k;Le<L;Le++){if(ee=Le===L-1?M?n[k+1]:void 0:n[Le+1],ee&&n[Le].equals(ee))continue;me&&(ge=me),j&&(Y=j),j=n[Le],me=ee?ee.sub(j)._unit()._perp():ge,ge=ge||me;let Ge=ge.add(me);Ge.x===0&&Ge.y===0||Ge._unit();const Ce=ge.x*me.x+ge.y*me.y,ze=Ge.x*me.x+Ge.y*me.y,it=ze!==0?1/ze:1/0,tt=2*Math.sqrt(2-2*ze),Ft=ze<DN&&Y&&ee,Gt=ge.x*me.y-ge.y*me.x>0;if(Ft&&Le>k){const At=j.dist(Y);if(At>2*O){const Et=j.sub(j.sub(Y)._mult(O/At)._round());this.updateDistance(Y,Et),this.addCurrentVertex(Et,ge,0,0,H),Y=Et}}const wt=Y&&ee;let xt=wt?p:M?"butt":y;if(wt&&xt==="round"&&(it<S?xt="miter":it<=2&&(xt="fakeround")),xt==="miter"&&it>v&&(xt="bevel"),xt==="bevel"&&(it>2&&(xt="flipbevel"),it<v&&(xt="miter")),Y&&this.updateDistance(Y,j),xt==="miter")Ge._mult(it),this.addCurrentVertex(j,Ge,0,0,H);else if(xt==="flipbevel"){if(it>100)Ge=me.mult(-1);else{const At=it*ge.add(me).mag()/ge.sub(me).mag();Ge._perp()._mult(At*(Gt?-1:1))}this.addCurrentVertex(j,Ge,0,0,H),this.addCurrentVertex(j,Ge.mult(-1),0,0,H)}else if(xt==="bevel"||xt==="fakeround"){const At=-Math.sqrt(it*it-1),Et=Gt?At:0,bt=Gt?0:At;if(Y&&this.addCurrentVertex(j,ge,Et,bt,H),xt==="fakeround"){const ut=Math.round(180*tt/Math.PI/20);for(let jt=1;jt<ut;jt++){let Vt=jt/ut;if(Vt!==.5){const tn=Vt-.5;Vt+=Vt*tn*(Vt-1)*((1.0904+Ce*(Ce*(3.55645-1.43519*Ce)-3.2452))*tn*tn+(.848013+Ce*(.215638*Ce-1.06021)))}const gi=me.sub(ge)._mult(Vt)._add(ge)._unit()._mult(Gt?-1:1);this.addHalfVertex(j,gi.x,gi.y,!1,Gt,0,H)}}ee&&this.addCurrentVertex(j,me,-Et,-bt,H)}else if(xt==="butt")this.addCurrentVertex(j,Ge,0,0,H);else if(xt==="square"){const At=Y?1:-1;this.addCurrentVertex(j,Ge,At,At,H)}else xt==="round"&&(Y&&(this.addCurrentVertex(j,ge,0,0,H),this.addCurrentVertex(j,ge,1,1,H,!0)),ee&&(this.addCurrentVertex(j,me,-1,-1,H,!0),this.addCurrentVertex(j,me,0,0,H)));if(Ft&&Le<L-1){const At=j.dist(ee);if(At>2*O){const Et=j.add(ee.sub(j)._mult(O/At)._round());this.updateDistance(j,Et),this.addCurrentVertex(Et,me,0,0,H),j=Et}}}}addCurrentVertex(n,h,p,y,v,S=!1){const M=h.y*y-h.x,L=-h.y-h.x*y;this.addHalfVertex(n,h.x+h.y*p,h.y-h.x*p,S,!1,p,v),this.addHalfVertex(n,M,L,S,!0,-y,v),this.distance>tC/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,h,p,y,v,S))}addHalfVertex({x:n,y:h},p,y,v,S,M,L){const k=.5*(this.lineClips?this.scaledDistance*(tC-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(v?1:0),(h<<1)+(S?1:0),Math.round(63*p)+128,Math.round(63*y)+128,1+(M===0?0:M<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),L.primitiveLength++),S?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,h){this.distance+=n.dist(h),this.updateScaledDistance()}}Lt("LineBucket",vy,{omit:["layers","patternFeatures"]});const PN=new yr({"line-cap":new Qt(be.layout_line["line-cap"]),"line-join":new ti(be.layout_line["line-join"]),"line-miter-limit":new Qt(be.layout_line["line-miter-limit"]),"line-round-limit":new Qt(be.layout_line["line-round-limit"]),"line-sort-key":new ti(be.layout_line["line-sort-key"])});var iC={paint:new yr({"line-opacity":new ti(be.paint_line["line-opacity"]),"line-color":new ti(be.paint_line["line-color"]),"line-translate":new Qt(be.paint_line["line-translate"]),"line-translate-anchor":new Qt(be.paint_line["line-translate-anchor"]),"line-width":new ti(be.paint_line["line-width"]),"line-gap-width":new ti(be.paint_line["line-gap-width"]),"line-offset":new ti(be.paint_line["line-offset"]),"line-blur":new ti(be.paint_line["line-blur"]),"line-dasharray":new Wd(be.paint_line["line-dasharray"]),"line-pattern":new Yo(be.paint_line["line-pattern"]),"line-gradient":new qd(be.paint_line["line-gradient"])}),layout:PN};const nC=new class extends ti{possiblyEvaluate(l,n){return n=new en(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(l,n)}evaluate(l,n,h,p){return n=T({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(l,n,h,p)}}(iC.paint.properties["line-width"].specification);function rC(l,n){return n>0?n+2*l:l}nC.useIntegerZoom=!0;const UN=Cn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),FN=Cn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Cn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const kN=Cn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Cn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sC=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),NN=Cn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ON(l,n,h){return l.sections.forEach(p=>{p.text=function(y,v,S){const M=v.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?y=y.toLocaleUpperCase():M==="lowercase"&&(y=y.toLocaleLowerCase()),_r.applyArabicShaping&&(y=_r.applyArabicShaping(y)),y}(p.text,n,h)}),l}Cn([{name:"triangle",components:3,type:"Uint16"}]),Cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Cn([{type:"Float32",name:"offsetX"}]),Cn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ap={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var On=24,by=Wi,aC=function(l,n,h,p,y){var v,S,M=8*y-p-1,L=(1<<M)-1,k=L>>1,O=-7,H=h?y-1:0,j=h?-1:1,Y=l[n+H];for(H+=j,v=Y&(1<<-O)-1,Y>>=-O,O+=M;O>0;v=256*v+l[n+H],H+=j,O-=8);for(S=v&(1<<-O)-1,v>>=-O,O+=p;O>0;S=256*S+l[n+H],H+=j,O-=8);if(v===0)v=1-k;else{if(v===L)return S?NaN:1/0*(Y?-1:1);S+=Math.pow(2,p),v-=k}return(Y?-1:1)*S*Math.pow(2,v-p)},oC=function(l,n,h,p,y,v){var S,M,L,k=8*v-y-1,O=(1<<k)-1,H=O>>1,j=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=p?0:v-1,ee=p?1:-1,ge=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(M=isNaN(n)?1:0,S=O):(S=Math.floor(Math.log(n)/Math.LN2),n*(L=Math.pow(2,-S))<1&&(S--,L*=2),(n+=S+H>=1?j/L:j*Math.pow(2,1-H))*L>=2&&(S++,L/=2),S+H>=O?(M=0,S=O):S+H>=1?(M=(n*L-1)*Math.pow(2,y),S+=H):(M=n*Math.pow(2,H-1)*Math.pow(2,y),S=0));y>=8;l[h+Y]=255&M,Y+=ee,M/=256,y-=8);for(S=S<<y|M,k+=y;k>0;l[h+Y]=255&S,Y+=ee,S/=256,k-=8);l[h+Y-ee]|=128*ge};function Wi(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}Wi.Varint=0,Wi.Fixed64=1,Wi.Bytes=2,Wi.Fixed32=5;var el,wy=4294967296,lC=1/wy,cC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ro(l){return l.type===Wi.Bytes?l.readVarint()+l.pos:l.pos+1}function Zh(l,n,h){return h?4294967296*n+(l>>>0):4294967296*(n>>>0)+(l>>>0)}function hC(l,n,h){var p=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));h.realloc(p);for(var y=h.pos-1;y>=l;y--)h.buf[y+p]=h.buf[y]}function zN(l,n){for(var h=0;h<l.length;h++)n.writeVarint(l[h])}function GN(l,n){for(var h=0;h<l.length;h++)n.writeSVarint(l[h])}function QN(l,n){for(var h=0;h<l.length;h++)n.writeFloat(l[h])}function VN(l,n){for(var h=0;h<l.length;h++)n.writeDouble(l[h])}function HN(l,n){for(var h=0;h<l.length;h++)n.writeBoolean(l[h])}function WN(l,n){for(var h=0;h<l.length;h++)n.writeFixed32(l[h])}function qN(l,n){for(var h=0;h<l.length;h++)n.writeSFixed32(l[h])}function $N(l,n){for(var h=0;h<l.length;h++)n.writeFixed64(l[h])}function jN(l,n){for(var h=0;h<l.length;h++)n.writeSFixed64(l[h])}function rg(l,n){return(l[n]|l[n+1]<<8|l[n+2]<<16)+16777216*l[n+3]}function Jh(l,n,h){l[h]=n,l[h+1]=n>>>8,l[h+2]=n>>>16,l[h+3]=n>>>24}function uC(l,n){return(l[n]|l[n+1]<<8|l[n+2]<<16)+(l[n+3]<<24)}function XN(l,n,h){l===1&&h.readMessage(YN,n)}function YN(l,n,h){if(l===3){const{id:p,bitmap:y,width:v,height:S,left:M,top:L,advance:k}=h.readMessage(KN,{});n.push({id:p,bitmap:new cp({width:v+6,height:S+6},y),metrics:{width:v,height:S,left:M,top:L,advance:k}})}}function KN(l,n,h){l===1?n.id=h.readVarint():l===2?n.bitmap=h.readBytes():l===3?n.width=h.readVarint():l===4?n.height=h.readVarint():l===5?n.left=h.readSVarint():l===6?n.top=h.readSVarint():l===7&&(n.advance=h.readVarint())}function dC(l){let n=0,h=0;for(const S of l)n+=S.w*S.h,h=Math.max(h,S.w);l.sort((S,M)=>M.h-S.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),h),h:1/0}];let y=0,v=0;for(const S of l)for(let M=p.length-1;M>=0;M--){const L=p[M];if(!(S.w>L.w||S.h>L.h)){if(S.x=L.x,S.y=L.y,v=Math.max(v,S.y+S.h),y=Math.max(y,S.x+S.w),S.w===L.w&&S.h===L.h){const k=p.pop();M<p.length&&(p[M]=k)}else S.h===L.h?(L.x+=S.w,L.w-=S.w):S.w===L.w?(L.y+=S.h,L.h-=S.h):(p.push({x:L.x+S.w,y:L.y,w:L.w-S.w,h:S.h}),L.y+=S.h,L.h-=S.h);break}}return{w:y,h:v,fill:n/(y*v)||0}}Wi.prototype={destroy:function(){this.buf=null},readFields:function(l,n,h){for(h=h||this.length;this.pos<h;){var p=this.readVarint(),y=p>>3,v=this.pos;this.type=7&p,l(y,n,this),this.pos===v&&this.skip(p)}return n},readMessage:function(l,n){return this.readFields(l,n,this.readVarint()+this.pos)},readFixed32:function(){var l=rg(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=uC(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=rg(this.buf,this.pos)+rg(this.buf,this.pos+4)*wy;return this.pos+=8,l},readSFixed64:function(){var l=rg(this.buf,this.pos)+uC(this.buf,this.pos+4)*wy;return this.pos+=8,l},readFloat:function(){var l=aC(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=aC(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var n,h,p=this.buf;return n=127&(h=p[this.pos++]),h<128?n:(n|=(127&(h=p[this.pos++]))<<7,h<128?n:(n|=(127&(h=p[this.pos++]))<<14,h<128?n:(n|=(127&(h=p[this.pos++]))<<21,h<128?n:function(y,v,S){var M,L,k=S.buf;if(M=(112&(L=k[S.pos++]))>>4,L<128||(M|=(127&(L=k[S.pos++]))<<3,L<128)||(M|=(127&(L=k[S.pos++]))<<10,L<128)||(M|=(127&(L=k[S.pos++]))<<17,L<128)||(M|=(127&(L=k[S.pos++]))<<24,L<128)||(M|=(1&(L=k[S.pos++]))<<31,L<128))return Zh(y,M,v);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(h=p[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var l=this.readVarint()+this.pos,n=this.pos;return this.pos=l,l-n>=12&&cC?function(h,p,y){return cC.decode(h.subarray(p,y))}(this.buf,n,l):function(h,p,y){for(var v="",S=p;S<y;){var M,L,k,O=h[S],H=null,j=O>239?4:O>223?3:O>191?2:1;if(S+j>y)break;j===1?O<128&&(H=O):j===2?(192&(M=h[S+1]))==128&&(H=(31&O)<<6|63&M)<=127&&(H=null):j===3?(L=h[S+2],(192&(M=h[S+1]))==128&&(192&L)==128&&((H=(15&O)<<12|(63&M)<<6|63&L)<=2047||H>=55296&&H<=57343)&&(H=null)):j===4&&(L=h[S+2],k=h[S+3],(192&(M=h[S+1]))==128&&(192&L)==128&&(192&k)==128&&((H=(15&O)<<18|(63&M)<<12|(63&L)<<6|63&k)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,j=1):H>65535&&(H-=65536,v+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),v+=String.fromCharCode(H),S+=j}return v}(this.buf,n,l)},readBytes:function(){var l=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,l);return this.pos=l,n},readPackedVarint:function(l,n){if(this.type!==Wi.Bytes)return l.push(this.readVarint(n));var h=ro(this);for(l=l||[];this.pos<h;)l.push(this.readVarint(n));return l},readPackedSVarint:function(l){if(this.type!==Wi.Bytes)return l.push(this.readSVarint());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==Wi.Bytes)return l.push(this.readBoolean());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==Wi.Bytes)return l.push(this.readFloat());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==Wi.Bytes)return l.push(this.readDouble());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==Wi.Bytes)return l.push(this.readFixed32());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==Wi.Bytes)return l.push(this.readSFixed32());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==Wi.Bytes)return l.push(this.readFixed64());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==Wi.Bytes)return l.push(this.readSFixed64());var n=ro(this);for(l=l||[];this.pos<n;)l.push(this.readSFixed64());return l},skip:function(l){var n=7&l;if(n===Wi.Varint)for(;this.buf[this.pos++]>127;);else if(n===Wi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Wi.Fixed32)this.pos+=4;else{if(n!==Wi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(l,n){this.writeVarint(l<<3|n)},realloc:function(l){for(var n=this.length||16;n<this.pos+l;)n*=2;if(n!==this.length){var h=new Uint8Array(n);h.set(this.buf),this.buf=h,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Jh(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Jh(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Jh(this.buf,-1&l,this.pos),Jh(this.buf,Math.floor(l*lC),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Jh(this.buf,-1&l,this.pos),Jh(this.buf,Math.floor(l*lC),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(n,h){var p,y;if(n>=0?(p=n%4294967296|0,y=n/4294967296|0):(y=~(-n/4294967296),4294967295^(p=~(-n%4294967296))?p=p+1|0:(p=0,y=y+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(v,S,M){M.buf[M.pos++]=127&v|128,v>>>=7,M.buf[M.pos++]=127&v|128,v>>>=7,M.buf[M.pos++]=127&v|128,v>>>=7,M.buf[M.pos++]=127&v|128,M.buf[M.pos]=127&(v>>>=7)}(p,0,h),function(v,S){var M=(7&v)<<4;S.buf[S.pos++]|=M|((v>>>=3)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v|((v>>>=7)?128:0),v&&(S.buf[S.pos++]=127&v)))))}(y,h)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(Boolean(l))},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var n=this.pos;this.pos=function(p,y,v){for(var S,M,L=0;L<y.length;L++){if((S=y.charCodeAt(L))>55295&&S<57344){if(!M){S>56319||L+1===y.length?(p[v++]=239,p[v++]=191,p[v++]=189):M=S;continue}if(S<56320){p[v++]=239,p[v++]=191,p[v++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(p[v++]=239,p[v++]=191,p[v++]=189,M=null);S<128?p[v++]=S:(S<2048?p[v++]=S>>6|192:(S<65536?p[v++]=S>>12|224:(p[v++]=S>>18|240,p[v++]=S>>12&63|128),p[v++]=S>>6&63|128),p[v++]=63&S|128)}return v}(this.buf,l,this.pos);var h=this.pos-n;h>=128&&hC(n,h,this),this.pos=n-1,this.writeVarint(h),this.pos+=h},writeFloat:function(l){this.realloc(4),oC(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),oC(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var n=l.length;this.writeVarint(n),this.realloc(n);for(var h=0;h<n;h++)this.buf[this.pos++]=l[h]},writeRawMessage:function(l,n){this.pos++;var h=this.pos;l(n,this);var p=this.pos-h;p>=128&&hC(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p},writeMessage:function(l,n,h){this.writeTag(l,Wi.Bytes),this.writeRawMessage(n,h)},writePackedVarint:function(l,n){n.length&&this.writeMessage(l,zN,n)},writePackedSVarint:function(l,n){n.length&&this.writeMessage(l,GN,n)},writePackedBoolean:function(l,n){n.length&&this.writeMessage(l,HN,n)},writePackedFloat:function(l,n){n.length&&this.writeMessage(l,QN,n)},writePackedDouble:function(l,n){n.length&&this.writeMessage(l,VN,n)},writePackedFixed32:function(l,n){n.length&&this.writeMessage(l,WN,n)},writePackedSFixed32:function(l,n){n.length&&this.writeMessage(l,qN,n)},writePackedFixed64:function(l,n){n.length&&this.writeMessage(l,$N,n)},writePackedSFixed64:function(l,n){n.length&&this.writeMessage(l,jN,n)},writeBytesField:function(l,n){this.writeTag(l,Wi.Bytes),this.writeBytes(n)},writeFixed32Field:function(l,n){this.writeTag(l,Wi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(l,n){this.writeTag(l,Wi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(l,n){this.writeTag(l,Wi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(l,n){this.writeTag(l,Wi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(l,n){this.writeTag(l,Wi.Varint),this.writeVarint(n)},writeSVarintField:function(l,n){this.writeTag(l,Wi.Varint),this.writeSVarint(n)},writeStringField:function(l,n){this.writeTag(l,Wi.Bytes),this.writeString(n)},writeFloatField:function(l,n){this.writeTag(l,Wi.Fixed32),this.writeFloat(n)},writeDoubleField:function(l,n){this.writeTag(l,Wi.Fixed64),this.writeDouble(n)},writeBooleanField:function(l,n){this.writeVarintField(l,Boolean(n))}};class Ey{constructor(n,{pixelRatio:h,version:p,stretchX:y,stretchY:v,content:S}){this.paddedRect=n,this.pixelRatio=h,this.stretchX=y,this.stretchY=v,this.content=S,this.version=p}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class pC{constructor(n,h){const p={},y={};this.haveRenderCallbacks=[];const v=[];this.addImages(n,p,v),this.addImages(h,y,v);const{w:S,h:M}=dC(v),L=new cs({width:S||1,height:M||1});for(const k in n){const O=n[k],H=p[k].paddedRect;cs.copy(O.data,L,{x:0,y:0},{x:H.x+1,y:H.y+1},O.data)}for(const k in h){const O=h[k],H=y[k].paddedRect,j=H.x+1,Y=H.y+1,ee=O.data.width,ge=O.data.height;cs.copy(O.data,L,{x:0,y:0},{x:j,y:Y},O.data),cs.copy(O.data,L,{x:0,y:ge-1},{x:j,y:Y-1},{width:ee,height:1}),cs.copy(O.data,L,{x:0,y:0},{x:j,y:Y+ge},{width:ee,height:1}),cs.copy(O.data,L,{x:ee-1,y:0},{x:j-1,y:Y},{width:1,height:ge}),cs.copy(O.data,L,{x:0,y:0},{x:j+ee,y:Y},{width:1,height:ge})}this.image=L,this.iconPositions=p,this.patternPositions=y}addImages(n,h,p){for(const y in n){const v=n[y],S={x:0,y:0,w:v.data.width+2,h:v.data.height+2};p.push(S),h[y]=new Ey(S,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(n,h){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in n.updatedImages)this.patchUpdatedImage(this.iconPositions[p],n.getImage(p),h),this.patchUpdatedImage(this.patternPositions[p],n.getImage(p),h)}patchUpdatedImage(n,h,p){if(!n||!h||n.version===h.version)return;n.version=h.version;const[y,v]=n.tl;p.update(h.data,void 0,{x:y,y:v})}}Lt("ImagePosition",Ey),Lt("ImageAtlas",pC),a.WritingMode=void 0,(el=a.WritingMode||(a.WritingMode={}))[el.none=0]="none",el[el.horizontal=1]="horizontal",el[el.vertical=2]="vertical",el[el.horizontalOnly=3]="horizontalOnly";const sg=-17;class _p{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,h){const p=new _p;return p.scale=n||1,p.fontStack=h,p}static forImage(n){const h=new _p;return h.imageName=n,h}}class eu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,h){const p=new eu;for(let y=0;y<n.sections.length;y++){const v=n.sections[y];v.image?p.addImageSection(v):p.addTextSection(v,h)}return p}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let h="";for(let p=0;p<n.length;p++){const y=n.charCodeAt(p+1)||null,v=n.charCodeAt(p-1)||null;h+=y&&Hm(y)&&!Ap[n[p+1]]||v&&Hm(v)&&!Ap[n[p-1]]||!Ap[n[p]]?n[p]:Ap[n[p]]}return h}(this.text)}trim(){let n=0;for(let p=0;p<this.text.length&&og[this.text.charCodeAt(p)];p++)n++;let h=this.text.length;for(let p=this.text.length-1;p>=0&&p>=n&&og[this.text.charCodeAt(p)];p--)h--;this.text=this.text.substring(n,h),this.sectionIndex=this.sectionIndex.slice(n,h)}substring(n,h){const p=new eu;return p.text=this.text.substring(n,h),p.sectionIndex=this.sectionIndex.slice(n,h),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,h)=>Math.max(n,this.sections[h].scale),0)}addTextSection(n,h){this.text+=n.text,this.sections.push(_p.forText(n.scale,n.fontStack||h));const p=this.sections.length-1;for(let y=0;y<n.text.length;++y)this.sectionIndex.push(p)}addImageSection(n){const h=n.image?n.image.name:"";if(h.length===0)return void q("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(_p.forImage(h)),this.sectionIndex.push(this.sections.length-1)):q("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ag(l,n,h,p,y,v,S,M,L,k,O,H,j,Y,ee,ge){const me=eu.fromFeature(l,y);let Le;H===a.WritingMode.vertical&&me.verticalizePunctuation();const{processBidirectionalText:Ge,processStyledBidirectionalText:Ce}=_r;if(Ge&&me.sections.length===1){Le=[];const tt=Ge(me.toString(),Sy(me,k,v,n,p,Y,ee));for(const Ft of tt){const Gt=new eu;Gt.text=Ft,Gt.sections=me.sections;for(let wt=0;wt<Ft.length;wt++)Gt.sectionIndex.push(0);Le.push(Gt)}}else if(Ce){Le=[];const tt=Ce(me.text,me.sectionIndex,Sy(me,k,v,n,p,Y,ee));for(const Ft of tt){const Gt=new eu;Gt.text=Ft[0],Gt.sectionIndex=Ft[1],Gt.sections=me.sections,Le.push(Gt)}}else Le=function(tt,Ft){const Gt=[],wt=tt.text;let xt=0;for(const At of Ft)Gt.push(tt.substring(xt,At)),xt=At;return xt<wt.length&&Gt.push(tt.substring(xt,wt.length)),Gt}(me,Sy(me,k,v,n,p,Y,ee));const ze=[],it={positionedLines:ze,text:me.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(tt,Ft,Gt,wt,xt,At,Et,bt,ut,jt,Vt,gi){let tn=0,cn=sg,Dn=0,us=0;const $n=bt==="right"?1:bt==="left"?0:.5;let Tn=0;for(const Bn of xt){Bn.trim();const Xn=Bn.getMaxScale(),hr=(Xn-1)*On,xr={positionedGlyphs:[],lineOffset:0};tt.positionedLines[Tn]=xr;const Fr=xr.positionedGlyphs;let kr=0;if(!Bn.length()){cn+=At,++Tn;continue}for(let Yn=0;Yn<Bn.length();Yn++){const Ai=Bn.getSection(Yn),Zr=Bn.getSectionIndex(Yn),Kn=Bn.getCharCode(Yn);let ur=0,Ps=null,ea=null,ta=null,ao=On;const Us=!(ut===a.WritingMode.horizontal||!Vt&&!Od(Kn)||Vt&&(og[Kn]||(Fn=Kn,vt.Arabic(Fn)||vt["Arabic Supplement"](Fn)||vt["Arabic Extended-A"](Fn)||vt["Arabic Presentation Forms-A"](Fn)||vt["Arabic Presentation Forms-B"](Fn))));if(Ai.imageName){const ds=wt[Ai.imageName];if(!ds)continue;ta=Ai.imageName,tt.iconsInText=tt.iconsInText||!0,ea=ds.paddedRect;const Nr=ds.displaySize;Ai.scale=Ai.scale*On/gi,Ps={width:Nr[0],height:Nr[1],left:1,top:-3,advance:Us?Nr[1]:Nr[0]},ur=hr+(On-Nr[1]*Ai.scale),ao=Ps.advance;const oo=Us?Nr[0]*Ai.scale-On*Xn:Nr[1]*Ai.scale-On*Xn;oo>0&&oo>kr&&(kr=oo)}else{const ds=Gt[Ai.fontStack],Nr=ds&&ds[Kn];if(Nr&&Nr.rect)ea=Nr.rect,Ps=Nr.metrics;else{const oo=Ft[Ai.fontStack],bp=oo&&oo[Kn];if(!bp)continue;Ps=bp.metrics}ur=(Xn-Ai.scale)*On}Us?(tt.verticalizable=!0,Fr.push({glyph:Kn,imageName:ta,x:tn,y:cn+ur,vertical:Us,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:Zr,metrics:Ps,rect:ea}),tn+=ao*Ai.scale+jt):(Fr.push({glyph:Kn,imageName:ta,x:tn,y:cn+ur,vertical:Us,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:Zr,metrics:Ps,rect:ea}),tn+=Ps.advance*Ai.scale+jt)}Fr.length!==0&&(Dn=Math.max(tn-jt,Dn),eO(Fr,0,Fr.length-1,$n,kr)),tn=0;const xn=At*Xn+kr;xr.lineOffset=Math.max(kr,hr),cn+=xn,us=Math.max(xn,us),++Tn}var Fn;const jn=cn-sg,{horizontalAlign:cr,verticalAlign:Ur}=Iy(Et);(function(Bn,Xn,hr,xr,Fr,kr,xn,Yn,Ai){const Zr=(Xn-hr)*Fr;let Kn=0;Kn=kr!==xn?-Yn*xr-sg:(-xr*Ai+.5)*xn;for(const ur of Bn)for(const Ps of ur.positionedGlyphs)Ps.x+=Zr,Ps.y+=Kn})(tt.positionedLines,$n,cr,Ur,Dn,us,At,jn,xt.length),tt.top+=-Ur*jn,tt.bottom=tt.top+jn,tt.left+=-cr*Dn,tt.right=tt.left+Dn}(it,n,h,p,Le,S,M,L,H,k,j,ge),!function(tt){for(const Ft of tt)if(Ft.positionedGlyphs.length!==0)return!1;return!0}(ze)&&it}const og={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ZN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fC(l,n,h,p,y,v){if(n.imageName){const S=p[n.imageName];return S?S.displaySize[0]*n.scale*On/v+y:0}{const S=h[n.fontStack],M=S&&S[l];return M?M.metrics.advance*n.scale+y:0}}function mC(l,n,h,p){const y=Math.pow(l-n,2);return p?l<n?y/2:2*y:y+Math.abs(h)*h}function JN(l,n,h){let p=0;return l===10&&(p-=1e4),h&&(p+=150),l!==40&&l!==65288||(p+=50),n!==41&&n!==65289||(p+=50),p}function gC(l,n,h,p,y,v){let S=null,M=mC(n,h,y,v);for(const L of p){const k=mC(n-L.x,h,y,v)+L.badness;k<=M&&(S=L,M=k)}return{index:l,x:n,priorBreak:S,badness:M}}function AC(l){return l?AC(l.priorBreak).concat(l.index):[]}function Sy(l,n,h,p,y,v,S){if(v!=="point")return[];if(!l)return[];const M=[],L=function(j,Y,ee,ge,me,Le){let Ge=0;for(let Ce=0;Ce<j.length();Ce++){const ze=j.getSection(Ce);Ge+=fC(j.getCharCode(Ce),ze,ge,me,Y,Le)}return Ge/Math.max(1,Math.ceil(Ge/ee))}(l,n,h,p,y,S),k=l.text.indexOf("\u200B")>=0;let O=0;for(let j=0;j<l.length();j++){const Y=l.getSection(j),ee=l.getCharCode(j);if(og[ee]||(O+=fC(ee,Y,p,y,n,S)),j<l.length()-1){const ge=!((H=ee)<11904||!(vt["Bopomofo Extended"](H)||vt.Bopomofo(H)||vt["CJK Compatibility Forms"](H)||vt["CJK Compatibility Ideographs"](H)||vt["CJK Compatibility"](H)||vt["CJK Radicals Supplement"](H)||vt["CJK Strokes"](H)||vt["CJK Symbols and Punctuation"](H)||vt["CJK Unified Ideographs Extension A"](H)||vt["CJK Unified Ideographs"](H)||vt["Enclosed CJK Letters and Months"](H)||vt["Halfwidth and Fullwidth Forms"](H)||vt.Hiragana(H)||vt["Ideographic Description Characters"](H)||vt["Kangxi Radicals"](H)||vt["Katakana Phonetic Extensions"](H)||vt.Katakana(H)||vt["Vertical Forms"](H)||vt["Yi Radicals"](H)||vt["Yi Syllables"](H)));(ZN[ee]||ge||Y.imageName)&&M.push(gC(j+1,O,L,M,JN(ee,l.getCharCode(j+1),ge&&k),!1))}}var H;return AC(gC(l.length(),O,L,M,0,!0))}function Iy(l){let n=.5,h=.5;switch(l){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:n,verticalAlign:h}}function eO(l,n,h,p,y){if(!p&&!y)return;const v=l[h],S=(l[h].x+v.metrics.advance*v.scale)*p;for(let M=n;M<=h;M++)l[M].x-=S,l[M].y+=y}function tO(l,n,h){const{horizontalAlign:p,verticalAlign:y}=Iy(h),v=n[0]-l.displaySize[0]*p,S=n[1]-l.displaySize[1]*y;return{image:l,top:S,bottom:S+l.displaySize[1],left:v,right:v+l.displaySize[0]}}function _C(l,n,h,p,y,v){const S=l.image;let M;if(S.content){const me=S.content,Le=S.pixelRatio||1;M=[me[0]/Le,me[1]/Le,S.displaySize[0]-me[2]/Le,S.displaySize[1]-me[3]/Le]}const L=n.left*v,k=n.right*v;let O,H,j,Y;h==="width"||h==="both"?(Y=y[0]+L-p[3],H=y[0]+k+p[1]):(Y=y[0]+(L+k-S.displaySize[0])/2,H=Y+S.displaySize[0]);const ee=n.top*v,ge=n.bottom*v;return h==="height"||h==="both"?(O=y[1]+ee-p[0],j=y[1]+ge+p[2]):(O=y[1]+(ee+ge-S.displaySize[1])/2,j=O+S.displaySize[1]),{image:S,top:O,right:H,bottom:j,left:Y,collisionPadding:M}}const so=128;function yC(l,n){const{expression:h}=n;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new en(l+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:y}=h;let v=0;for(;v<p.length&&p[v]<=l;)v++;v=Math.max(0,v-1);let S=v;for(;S<p.length&&p[S]<l+1;)S++;S=Math.min(p.length-1,S);const M=p[v],L=p[S];return h.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:L,interpolationType:y}:{kind:"camera",minZoom:M,maxZoom:L,minSize:h.evaluate(new en(M)),maxSize:h.evaluate(new en(L)),interpolationType:y}}}class tl extends Re{constructor(n,h,p,y){super(n,h),this.angle=p,y!==void 0&&(this.segment=y)}clone(){return new tl(this.x,this.y,this.angle,this.segment)}}function xC(l,n,h,p,y){if(n.segment===void 0)return!0;let v=n,S=n.segment+1,M=0;for(;M>-h/2;){if(S--,S<0)return!1;M-=l[S].dist(v),v=l[S]}M+=l[S].dist(l[S+1]),S++;const L=[];let k=0;for(;M<h/2;){const O=l[S],H=l[S+1];if(!H)return!1;let j=l[S-1].angleTo(O)-O.angleTo(H);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:M,angleDelta:j}),k+=j;M-L[0].distance>p;)k-=L.shift().angleDelta;if(k>y)return!1;S++,M+=O.dist(H)}return!0}function vC(l){let n=0;for(let h=0;h<l.length-1;h++)n+=l[h].dist(l[h+1]);return n}function bC(l,n,h){return l?.6*n*h:0}function wC(l,n){return Math.max(l?l.right-l.left:0,n?n.right-n.left:0)}function iO(l,n,h,p,y,v){const S=bC(h,y,v),M=wC(h,p)*v;let L=0;const k=vC(l)/2;for(let O=0;O<l.length-1;O++){const H=l[O],j=l[O+1],Y=H.dist(j);if(L+Y>k){const ee=(k-L)/Y,ge=sn(H.x,j.x,ee),me=sn(H.y,j.y,ee),Le=new tl(ge,me,j.angleTo(H),O);return Le._round(),!S||xC(l,Le,M,S,n)?Le:void 0}L+=Y}}function nO(l,n,h,p,y,v,S,M,L){const k=bC(p,v,S),O=wC(p,y),H=O*S,j=l[0].x===0||l[0].x===L||l[0].y===0||l[0].y===L;return n-H<n/4&&(n=H+n/4),EC(l,j?n/2*M%n:(O/2+2*v)*S*M%n,n,k,h,H,j,!1,L)}function EC(l,n,h,p,y,v,S,M,L){const k=v/2,O=vC(l);let H=0,j=n-h,Y=[];for(let ee=0;ee<l.length-1;ee++){const ge=l[ee],me=l[ee+1],Le=ge.dist(me),Ge=me.angleTo(ge);for(;j+h<H+Le;){j+=h;const Ce=(j-H)/Le,ze=sn(ge.x,me.x,Ce),it=sn(ge.y,me.y,Ce);if(ze>=0&&ze<L&&it>=0&&it<L&&j-k>=0&&j+k<=O){const tt=new tl(ze,it,Ge,ee);tt._round(),p&&!xC(l,tt,v,p,y)||Y.push(tt)}}H+=Le}return M||Y.length||S||(Y=EC(l,H/2,h,p,y,v,S,!0,L)),Y}function SC(l,n,h,p,y){const v=[];for(let S=0;S<l.length;S++){const M=l[S];let L;for(let k=0;k<M.length-1;k++){let O=M[k],H=M[k+1];O.x<n&&H.x<n||(O.x<n?O=new Re(n,O.y+(n-O.x)/(H.x-O.x)*(H.y-O.y))._round():H.x<n&&(H=new Re(n,O.y+(n-O.x)/(H.x-O.x)*(H.y-O.y))._round()),O.y<h&&H.y<h||(O.y<h?O=new Re(O.x+(h-O.y)/(H.y-O.y)*(H.x-O.x),h)._round():H.y<h&&(H=new Re(O.x+(h-O.y)/(H.y-O.y)*(H.x-O.x),h)._round()),O.x>=p&&H.x>=p||(O.x>=p?O=new Re(p,O.y+(p-O.x)/(H.x-O.x)*(H.y-O.y))._round():H.x>=p&&(H=new Re(p,O.y+(p-O.x)/(H.x-O.x)*(H.y-O.y))._round()),O.y>=y&&H.y>=y||(O.y>=y?O=new Re(O.x+(y-O.y)/(H.y-O.y)*(H.x-O.x),y)._round():H.y>=y&&(H=new Re(O.x+(y-O.y)/(H.y-O.y)*(H.x-O.x),y)._round()),L&&O.equals(L[L.length-1])||(L=[O],v.push(L)),L.push(H)))))}}return v}function IC(l,n,h,p){const y=[],v=l.image,S=v.pixelRatio,M=v.paddedRect.w-2,L=v.paddedRect.h-2,k=l.right-l.left,O=l.bottom-l.top,H=v.stretchX||[[0,M]],j=v.stretchY||[[0,L]],Y=(At,Et)=>At+Et[1]-Et[0],ee=H.reduce(Y,0),ge=j.reduce(Y,0),me=M-ee,Le=L-ge;let Ge=0,Ce=ee,ze=0,it=ge,tt=0,Ft=me,Gt=0,wt=Le;if(v.content&&p){const At=v.content;Ge=lg(H,0,At[0]),ze=lg(j,0,At[1]),Ce=lg(H,At[0],At[2]),it=lg(j,At[1],At[3]),tt=At[0]-Ge,Gt=At[1]-ze,Ft=At[2]-At[0]-Ce,wt=At[3]-At[1]-it}const xt=(At,Et,bt,ut)=>{const jt=cg(At.stretch-Ge,Ce,k,l.left),Vt=hg(At.fixed-tt,Ft,At.stretch,ee),gi=cg(Et.stretch-ze,it,O,l.top),tn=hg(Et.fixed-Gt,wt,Et.stretch,ge),cn=cg(bt.stretch-Ge,Ce,k,l.left),Dn=hg(bt.fixed-tt,Ft,bt.stretch,ee),us=cg(ut.stretch-ze,it,O,l.top),$n=hg(ut.fixed-Gt,wt,ut.stretch,ge),Tn=new Re(jt,gi),Fn=new Re(cn,gi),jn=new Re(cn,us),cr=new Re(jt,us),Ur=new Re(Vt/S,tn/S),Bn=new Re(Dn/S,$n/S),Xn=n*Math.PI/180;if(Xn){const Fr=Math.sin(Xn),kr=Math.cos(Xn),xn=[kr,-Fr,Fr,kr];Tn._matMult(xn),Fn._matMult(xn),cr._matMult(xn),jn._matMult(xn)}const hr=At.stretch+At.fixed,xr=Et.stretch+Et.fixed;return{tl:Tn,tr:Fn,bl:cr,br:jn,tex:{x:v.paddedRect.x+1+hr,y:v.paddedRect.y+1+xr,w:bt.stretch+bt.fixed-hr,h:ut.stretch+ut.fixed-xr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ur,pixelOffsetBR:Bn,minFontScaleX:Ft/S/k,minFontScaleY:wt/S/O,isSDF:h}};if(p&&(v.stretchX||v.stretchY)){const At=CC(H,me,ee),Et=CC(j,Le,ge);for(let bt=0;bt<At.length-1;bt++){const ut=At[bt],jt=At[bt+1];for(let Vt=0;Vt<Et.length-1;Vt++)y.push(xt(ut,Et[Vt],jt,Et[Vt+1]))}}else y.push(xt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:L+1}));return y}function lg(l,n,h){let p=0;for(const y of l)p+=Math.max(n,Math.min(h,y[1]))-Math.max(n,Math.min(h,y[0]));return p}function CC(l,n,h){const p=[{fixed:-1,stretch:0}];for(const[y,v]of l){const S=p[p.length-1];p.push({fixed:y-S.stretch,stretch:S.stretch}),p.push({fixed:y-S.stretch,stretch:S.stretch+(v-y)})}return p.push({fixed:n+1,stretch:h}),p}function cg(l,n,h,p){return l/n*h+p}function hg(l,n,h,p){return l-n*h/p}Lt("Anchor",tl);class ug{constructor(n,h,p,y,v,S,M,L,k,O){if(this.boxStartIndex=n.length,k){let H=S.top,j=S.bottom;const Y=S.collisionPadding;Y&&(H-=Y[1],j+=Y[3]);let ee=j-H;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{let H=S.top*M-L[0],j=S.bottom*M+L[2],Y=S.left*M-L[3],ee=S.right*M+L[1];const ge=S.collisionPadding;if(ge&&(Y-=ge[0]*M,H-=ge[1]*M,ee+=ge[2]*M,j+=ge[3]*M),O){const me=new Re(Y,H),Le=new Re(ee,H),Ge=new Re(Y,j),Ce=new Re(ee,j),ze=O*Math.PI/180;me._rotate(ze),Le._rotate(ze),Ge._rotate(ze),Ce._rotate(ze),Y=Math.min(me.x,Le.x,Ge.x,Ce.x),ee=Math.max(me.x,Le.x,Ge.x,Ce.x),H=Math.min(me.y,Le.y,Ge.y,Ce.y),j=Math.max(me.y,Le.y,Ge.y,Ce.y)}n.emplaceBack(h.x,h.y,Y,H,ee,j,p,y,v)}this.boxEndIndex=n.length}}class rO{constructor(n=[],h=sO){if(this.data=n,this.length=this.data.length,this.compare=h,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:h,compare:p}=this,y=h[n];for(;n>0;){const v=n-1>>1,S=h[v];if(p(y,S)>=0)break;h[n]=S,n=v}h[n]=y}_down(n){const{data:h,compare:p}=this,y=this.length>>1,v=h[n];for(;n<y;){let S=1+(n<<1),M=h[S];const L=S+1;if(L<this.length&&p(h[L],M)<0&&(S=L,M=h[L]),p(M,v)>=0)break;h[n]=M,n=S}h[n]=v}}function sO(l,n){return l<n?-1:l>n?1:0}function aO(l,n=1,h=!1){let p=1/0,y=1/0,v=-1/0,S=-1/0;const M=l[0];for(let Y=0;Y<M.length;Y++){const ee=M[Y];(!Y||ee.x<p)&&(p=ee.x),(!Y||ee.y<y)&&(y=ee.y),(!Y||ee.x>v)&&(v=ee.x),(!Y||ee.y>S)&&(S=ee.y)}const L=Math.min(v-p,S-y);let k=L/2;const O=new rO([],oO);if(L===0)return new Re(p,y);for(let Y=p;Y<v;Y+=L)for(let ee=y;ee<S;ee+=L)O.push(new tu(Y+k,ee+k,k,l));let H=function(Y){let ee=0,ge=0,me=0;const Le=Y[0];for(let Ge=0,Ce=Le.length,ze=Ce-1;Ge<Ce;ze=Ge++){const it=Le[Ge],tt=Le[ze],Ft=it.x*tt.y-tt.x*it.y;ge+=(it.x+tt.x)*Ft,me+=(it.y+tt.y)*Ft,ee+=3*Ft}return new tu(ge/ee,me/ee,0,Y)}(l),j=O.length;for(;O.length;){const Y=O.pop();(Y.d>H.d||!H.d)&&(H=Y,h&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,j)),Y.max-H.d<=n||(k=Y.h/2,O.push(new tu(Y.p.x-k,Y.p.y-k,k,l)),O.push(new tu(Y.p.x+k,Y.p.y-k,k,l)),O.push(new tu(Y.p.x-k,Y.p.y+k,k,l)),O.push(new tu(Y.p.x+k,Y.p.y+k,k,l)),j+=4)}return h&&(console.log(`num probes: ${j}`),console.log(`best distance: ${H.d}`)),H.p}function oO(l,n){return n.max-l.max}function tu(l,n,h,p){this.p=new Re(l,n),this.h=h,this.d=function(y,v){let S=!1,M=1/0;for(let L=0;L<v.length;L++){const k=v[L];for(let O=0,H=k.length,j=H-1;O<H;j=O++){const Y=k[O],ee=k[j];Y.y>y.y!=ee.y>y.y&&y.x<(ee.x-Y.x)*(y.y-Y.y)/(ee.y-Y.y)+Y.x&&(S=!S),M=Math.min(M,ln(y,Y,ee))}}return(S?1:-1)*Math.sqrt(M)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}const Cy=Number.POSITIVE_INFINITY;function MC(l,n){return n[1]!==Cy?function(h,p,y){let v=0,S=0;switch(p=Math.abs(p),y=Math.abs(y),h){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(h){case"top-right":case"bottom-right":case"right":v=-p;break;case"top-left":case"bottom-left":case"left":v=p}return[v,S]}(l,n[0],n[1]):function(h,p){let y=0,v=0;p<0&&(p=0);const S=p/Math.sqrt(2);switch(h){case"top-right":case"top-left":v=S-7;break;case"bottom-right":case"bottom-left":v=7-S;break;case"bottom":v=7-p;break;case"top":v=p-7}switch(h){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=p;break;case"right":y=-p}return[y,v]}(l,n[0])}function My(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function lO(l,n,h,p,y,v,S,M,L,k,O){let H=v.textMaxSize.evaluate(n,{});H===void 0&&(H=S);const j=l.layers[0].layout,Y=j.get("icon-offset").evaluate(n,{},O),ee=BC(h.horizontal),ge=S/24,me=l.tilePixelRatio*ge,Le=l.tilePixelRatio*H/24,Ge=l.tilePixelRatio*M,Ce=l.tilePixelRatio*j.get("symbol-spacing"),ze=j.get("text-padding")*l.tilePixelRatio,it=function(ut,jt,Vt,gi=1){const tn=ut.get("icon-padding").evaluate(jt,{},Vt),cn=tn&&tn.values;return[cn[0]*gi,cn[1]*gi,cn[2]*gi,cn[3]*gi]}(j,n,O,l.tilePixelRatio),tt=j.get("text-max-angle")/180*Math.PI,Ft=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Gt=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",wt=j.get("symbol-placement"),xt=Ce/2,At=j.get("icon-text-fit");let Et;p&&At!=="none"&&(l.allowVerticalPlacement&&h.vertical&&(Et=_C(p,h.vertical,At,j.get("icon-text-fit-padding"),Y,ge)),ee&&(p=_C(p,ee,At,j.get("icon-text-fit-padding"),Y,ge)));const bt=(ut,jt)=>{jt.x<0||jt.x>=Pi||jt.y<0||jt.y>=Pi||function(Vt,gi,tn,cn,Dn,us,$n,Tn,Fn,jn,cr,Ur,Bn,Xn,hr,xr,Fr,kr,xn,Yn,Ai,Zr,Kn,ur,Ps){const ea=Vt.addToLineVertexArray(gi,tn);let ta,ao,Us,ds,Nr=0,oo=0,bp=0,jC=0,Gy=-1,Qy=-1;const lo={};let XC=$(""),Vy=0,Hy=0;if(Tn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Vy,Hy]=Tn.layout.get("text-offset").evaluate(Ai,{},ur).map(Or=>Or*On):(Vy=Tn.layout.get("text-radial-offset").evaluate(Ai,{},ur)*On,Hy=Cy),Vt.allowVerticalPlacement&&cn.vertical){const Or=Tn.layout.get("text-rotate").evaluate(Ai,{},ur)+90;Us=new ug(Fn,gi,jn,cr,Ur,cn.vertical,Bn,Xn,hr,Or),$n&&(ds=new ug(Fn,gi,jn,cr,Ur,$n,Fr,kr,hr,Or))}if(Dn){const Or=Tn.layout.get("icon-rotate").evaluate(Ai,{}),Sa=Tn.layout.get("icon-text-fit")!=="none",wp=IC(Dn,Or,Kn,Sa),Ep=$n?IC($n,Or,Kn,Sa):void 0;ao=new ug(Fn,gi,jn,cr,Ur,Dn,Fr,kr,!1,Or),Nr=4*wp.length;const ZC=Vt.iconSizeData;let Kl=null;ZC.kind==="source"?(Kl=[so*Tn.layout.get("icon-size").evaluate(Ai,{})],Kl[0]>il&&q(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ZC.kind==="composite"&&(Kl=[so*Zr.compositeIconSizes[0].evaluate(Ai,{},ur),so*Zr.compositeIconSizes[1].evaluate(Ai,{},ur)],(Kl[0]>il||Kl[1]>il)&&q(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Vt.addSymbols(Vt.icon,wp,Kl,Yn,xn,Ai,a.WritingMode.none,gi,ea.lineStartIndex,ea.lineLength,-1,ur),Gy=Vt.icon.placedSymbolArray.length-1,Ep&&(oo=4*Ep.length,Vt.addSymbols(Vt.icon,Ep,Kl,Yn,xn,Ai,a.WritingMode.vertical,gi,ea.lineStartIndex,ea.lineLength,-1,ur),Qy=Vt.icon.placedSymbolArray.length-1)}const YC=Object.keys(cn.horizontal);for(const Or of YC){const Sa=cn.horizontal[Or];if(!ta){XC=$(Sa.text);const Ep=Tn.layout.get("text-rotate").evaluate(Ai,{},ur);ta=new ug(Fn,gi,jn,cr,Ur,Sa,Bn,Xn,hr,Ep)}const wp=Sa.positionedLines.length===1;if(bp+=TC(Vt,gi,Sa,us,Tn,hr,Ai,xr,ea,cn.vertical?a.WritingMode.horizontal:a.WritingMode.horizontalOnly,wp?YC:[Or],lo,Gy,Zr,ur),wp)break}cn.vertical&&(jC+=TC(Vt,gi,cn.vertical,us,Tn,hr,Ai,xr,ea,a.WritingMode.vertical,["vertical"],lo,Qy,Zr,ur));const wO=ta?ta.boxStartIndex:Vt.collisionBoxArray.length,EO=ta?ta.boxEndIndex:Vt.collisionBoxArray.length,SO=Us?Us.boxStartIndex:Vt.collisionBoxArray.length,IO=Us?Us.boxEndIndex:Vt.collisionBoxArray.length,CO=ao?ao.boxStartIndex:Vt.collisionBoxArray.length,MO=ao?ao.boxEndIndex:Vt.collisionBoxArray.length,TO=ds?ds.boxStartIndex:Vt.collisionBoxArray.length,BO=ds?ds.boxEndIndex:Vt.collisionBoxArray.length;let ia=-1;const gg=(Or,Sa)=>Or&&Or.circleDiameter?Math.max(Or.circleDiameter,Sa):Sa;ia=gg(ta,ia),ia=gg(Us,ia),ia=gg(ao,ia),ia=gg(ds,ia);const KC=ia>-1?1:0;KC&&(ia*=Ps/On),Vt.glyphOffsetArray.length>=iu.MAX_GLYPHS&&q("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ai.sortKey!==void 0&&Vt.addToSortKeyRanges(Vt.symbolInstances.length,Ai.sortKey),Vt.symbolInstances.emplaceBack(gi.x,gi.y,lo.right>=0?lo.right:-1,lo.center>=0?lo.center:-1,lo.left>=0?lo.left:-1,lo.vertical||-1,Gy,Qy,XC,wO,EO,SO,IO,CO,MO,TO,BO,jn,bp,jC,Nr,oo,KC,0,Bn,Vy,Hy,ia)}(l,jt,ut,h,p,y,Et,l.layers[0],l.collisionBoxArray,n.index,n.sourceLayerIndex,l.index,me,[ze,ze,ze,ze],Ft,L,Ge,it,Gt,Y,n,v,k,O,S)};if(wt==="line")for(const ut of SC(n.geometry,0,0,Pi,Pi)){const jt=nO(ut,Ce,tt,h.vertical||ee,p,24,Le,l.overscaling,Pi);for(const Vt of jt)ee&&cO(l,ee.text,xt,Vt)||bt(ut,Vt)}else if(wt==="line-center"){for(const ut of n.geometry)if(ut.length>1){const jt=iO(ut,tt,h.vertical||ee,p,24,Le);jt&&bt(ut,jt)}}else if(n.type==="Polygon")for(const ut of my(n.geometry,0)){const jt=aO(ut,16);bt(ut[0],new tl(jt.x,jt.y,0))}else if(n.type==="LineString")for(const ut of n.geometry)bt(ut,new tl(ut[0].x,ut[0].y,0));else if(n.type==="Point")for(const ut of n.geometry)for(const jt of ut)bt([jt],new tl(jt.x,jt.y,0))}const il=32640;function TC(l,n,h,p,y,v,S,M,L,k,O,H,j,Y,ee){const ge=function(Ge,Ce,ze,it,tt,Ft,Gt,wt){const xt=it.layout.get("text-rotate").evaluate(Ft,{})*Math.PI/180,At=[];for(const Et of Ce.positionedLines)for(const bt of Et.positionedGlyphs){if(!bt.rect)continue;const ut=bt.rect||{};let jt=4,Vt=!0,gi=1,tn=0;const cn=(tt||wt)&&bt.vertical,Dn=bt.metrics.advance*bt.scale/2;if(wt&&Ce.verticalizable&&(tn=Et.lineOffset/2-(bt.imageName?-(On-bt.metrics.width*bt.scale)/2:(bt.scale-1)*On)),bt.imageName){const xn=Gt[bt.imageName];Vt=xn.sdf,gi=xn.pixelRatio,jt=1/gi}const us=tt?[bt.x+Dn,bt.y]:[0,0];let $n=tt?[0,0]:[bt.x+Dn+ze[0],bt.y+ze[1]-tn],Tn=[0,0];cn&&(Tn=$n,$n=[0,0]);const Fn=(bt.metrics.left-jt)*bt.scale-Dn+$n[0],jn=(-bt.metrics.top-jt)*bt.scale+$n[1],cr=Fn+ut.w*bt.scale/gi,Ur=jn+ut.h*bt.scale/gi,Bn=new Re(Fn,jn),Xn=new Re(cr,jn),hr=new Re(Fn,Ur),xr=new Re(cr,Ur);if(cn){const xn=new Re(-Dn,Dn-sg),Yn=-Math.PI/2,Ai=12-Dn,Zr=new Re(22-Ai,-(bt.imageName?Ai:0)),Kn=new Re(...Tn);Bn._rotateAround(Yn,xn)._add(Zr)._add(Kn),Xn._rotateAround(Yn,xn)._add(Zr)._add(Kn),hr._rotateAround(Yn,xn)._add(Zr)._add(Kn),xr._rotateAround(Yn,xn)._add(Zr)._add(Kn)}if(xt){const xn=Math.sin(xt),Yn=Math.cos(xt),Ai=[Yn,-xn,xn,Yn];Bn._matMult(Ai),Xn._matMult(Ai),hr._matMult(Ai),xr._matMult(Ai)}const Fr=new Re(0,0),kr=new Re(0,0);At.push({tl:Bn,tr:Xn,bl:hr,br:xr,tex:ut,writingMode:Ce.writingMode,glyphOffset:us,sectionIndex:bt.sectionIndex,isSDF:Vt,pixelOffsetTL:Fr,pixelOffsetBR:kr,minFontScaleX:0,minFontScaleY:0})}return At}(0,h,M,y,v,S,p,l.allowVerticalPlacement),me=l.textSizeData;let Le=null;me.kind==="source"?(Le=[so*y.layout.get("text-size").evaluate(S,{})],Le[0]>il&&q(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):me.kind==="composite"&&(Le=[so*Y.compositeTextSizes[0].evaluate(S,{},ee),so*Y.compositeTextSizes[1].evaluate(S,{},ee)],(Le[0]>il||Le[1]>il)&&q(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,ge,Le,M,v,S,k,n,L.lineStartIndex,L.lineLength,j,ee);for(const Ge of O)H[Ge]=l.text.placedSymbolArray.length-1;return 4*ge.length}function BC(l){for(const n in l)return l[n];return null}function cO(l,n,h,p){const y=l.compareText;if(n in y){const v=y[n];for(let S=v.length-1;S>=0;S--)if(p.dist(v[S])<h)return!0}else y[n]=[];return y[n].push(p),!1}const hO=Jo.VectorTileFeature.types,uO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dg(l,n,h,p,y,v,S,M,L,k,O,H,j){const Y=M?Math.min(il,Math.round(M[0])):0,ee=M?Math.min(il,Math.round(M[1])):0;l.emplaceBack(n,h,Math.round(32*p),Math.round(32*y),v,S,(Y<<1)+(L?1:0),ee,16*k,16*O,256*H,256*j)}function Ty(l,n,h){l.emplaceBack(n.x,n.y,h),l.emplaceBack(n.x,n.y,h),l.emplaceBack(n.x,n.y,h),l.emplaceBack(n.x,n.y,h)}function dO(l){for(const n of l.sections)if(Xr(n.text))return!0;return!1}class By{constructor(n){this.layoutVertexArray=new g,this.indexArray=new w,this.programConfigurations=n,this.segments=new F,this.dynamicLayoutVertexArray=new r,this.opacityVertexArray=new d,this.hasVisibleVertices=!1,this.placedSymbolArray=new sp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,h,p,y){this.isEmpty()||(p&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,UN.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,FN.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,uO,!0),this.opacityVertexBuffer.itemSize=1),(p||y)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",By);class Ry{constructor(n,h,p){this.layoutVertexArray=new n,this.layoutAttributes=h,this.indexArray=new p,this.segments=new F,this.collisionVertexArray=new _}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,kN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",Ry);class iu{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(S=>S.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cy([]),this.placementViewportMatrix=cy([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yC(this.zoom,h["text-size"]),this.iconSizeData=yC(this.zoom,h["icon-size"]);const p=this.layers[0].layout,y=p.get("symbol-sort-key"),v=p.get("symbol-z-order");this.canOverlap=Dy(p,"text-overlap","text-allow-overlap")!=="never"||Dy(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(S=>a.WritingMode[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=n.sourceID}createArrays(){this.text=new By(new di(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new By(new di(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new io,this.lineVertexArray=new $l,this.symbolInstances=new Ym}calculateGlyphDependencies(n,h,p,y,v){for(let S=0;S<n.length;S++)if(h[n.charCodeAt(S)]=!0,(p||y)&&v){const M=Ap[n.charAt(S)];M&&(h[M.charCodeAt(0)]=!0)}}populate(n,h,p){const y=this.layers[0],v=y.layout,S=v.get("text-font"),M=v.get("text-field"),L=v.get("icon-image"),k=(M.value.kind!=="constant"||M.value.value instanceof ci&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),O=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,H=v.get("symbol-sort-key");if(this.features=[],!k&&!O)return;const j=h.iconDependencies,Y=h.glyphDependencies,ee=h.availableImages,ge=new en(this.zoom);for(const{feature:me,id:Le,index:Ge,sourceLayerIndex:Ce}of n){const ze=y._featureFilter.needGeometry,it=Pr(me,ze);if(!y._featureFilter.filter(ge,it,p))continue;let tt,Ft;if(ze||(it.geometry=qn(me)),k){const wt=y.getValueAndResolveTokens("text-field",it,p,ee),xt=ci.factory(wt);dO(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||to()==="unavailable"||this.hasRTLText&&_r.isParsed())&&(tt=ON(xt,y,it))}if(O){const wt=y.getValueAndResolveTokens("icon-image",it,p,ee);Ft=wt instanceof ki?wt:ki.fromString(wt)}if(!tt&&!Ft)continue;const Gt=this.sortFeaturesByKey?H.evaluate(it,{},p):void 0;if(this.features.push({id:Le,text:tt,icon:Ft,index:Ge,sourceLayerIndex:Ce,geometry:it.geometry,properties:me.properties,type:hO[me.type],sortKey:Gt}),Ft&&(j[Ft.name]=!0),tt){const wt=S.evaluate(it,{},p).join(","),xt=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.WritingMode.vertical)>=0;for(const At of tt.sections)if(At.image)j[At.image.name]=!0;else{const Et=Nd(tt.toString()),bt=At.fontStack||wt,ut=Y[bt]=Y[bt]||{};this.calculateGlyphDependencies(At.text,ut,xt,this.allowVerticalPlacement,Et)}}}v.get("symbol-placement")==="line"&&(this.features=function(me){const Le={},Ge={},Ce=[];let ze=0;function it(wt){Ce.push(me[wt]),ze++}function tt(wt,xt,At){const Et=Ge[wt];return delete Ge[wt],Ge[xt]=Et,Ce[Et].geometry[0].pop(),Ce[Et].geometry[0]=Ce[Et].geometry[0].concat(At[0]),Et}function Ft(wt,xt,At){const Et=Le[xt];return delete Le[xt],Le[wt]=Et,Ce[Et].geometry[0].shift(),Ce[Et].geometry[0]=At[0].concat(Ce[Et].geometry[0]),Et}function Gt(wt,xt,At){const Et=At?xt[0][xt[0].length-1]:xt[0][0];return`${wt}:${Et.x}:${Et.y}`}for(let wt=0;wt<me.length;wt++){const xt=me[wt],At=xt.geometry,Et=xt.text?xt.text.toString():null;if(!Et){it(wt);continue}const bt=Gt(Et,At),ut=Gt(Et,At,!0);if(bt in Ge&&ut in Le&&Ge[bt]!==Le[ut]){const jt=Ft(bt,ut,At),Vt=tt(bt,ut,Ce[jt].geometry);delete Le[bt],delete Ge[ut],Ge[Gt(Et,Ce[Vt].geometry,!0)]=Vt,Ce[jt].geometry=null}else bt in Ge?tt(bt,ut,At):ut in Le?Ft(bt,ut,At):(it(wt),Le[bt]=ze-1,Ge[ut]=ze-1)}return Ce.filter(wt=>wt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,Le)=>me.sortKey-Le.sortKey)}update(n,h,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,h,this.layers,p),this.icon.programConfigurations.updatePaintArrays(n,h,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,h){const p=this.lineVertexArray.length;if(n.segment!==void 0){let y=n.dist(h[n.segment+1]),v=n.dist(h[n.segment]);const S={};for(let M=n.segment+1;M<h.length;M++)S[M]={x:h[M].x,y:h[M].y,tileUnitDistanceFromAnchor:y},M<h.length-1&&(y+=h[M+1].dist(h[M]));for(let M=n.segment||0;M>=0;M--)S[M]={x:h[M].x,y:h[M].y,tileUnitDistanceFromAnchor:v},M>0&&(v+=h[M-1].dist(h[M]));for(let M=0;M<h.length;M++){const L=S[M];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(n,h,p,y,v,S,M,L,k,O,H,j){const Y=n.indexArray,ee=n.layoutVertexArray,ge=n.segments.prepareSegment(4*h.length,ee,Y,this.canOverlap?S.sortKey:void 0),me=this.glyphOffsetArray.length,Le=ge.vertexLength,Ge=this.allowVerticalPlacement&&M===a.WritingMode.vertical?Math.PI/2:0,Ce=S.text&&S.text.sections;for(let ze=0;ze<h.length;ze++){const{tl:it,tr:tt,bl:Ft,br:Gt,tex:wt,pixelOffsetTL:xt,pixelOffsetBR:At,minFontScaleX:Et,minFontScaleY:bt,glyphOffset:ut,isSDF:jt,sectionIndex:Vt}=h[ze],gi=ge.vertexLength,tn=ut[1];dg(ee,L.x,L.y,it.x,tn+it.y,wt.x,wt.y,p,jt,xt.x,xt.y,Et,bt),dg(ee,L.x,L.y,tt.x,tn+tt.y,wt.x+wt.w,wt.y,p,jt,At.x,xt.y,Et,bt),dg(ee,L.x,L.y,Ft.x,tn+Ft.y,wt.x,wt.y+wt.h,p,jt,xt.x,At.y,Et,bt),dg(ee,L.x,L.y,Gt.x,tn+Gt.y,wt.x+wt.w,wt.y+wt.h,p,jt,At.x,At.y,Et,bt),Ty(n.dynamicLayoutVertexArray,L,Ge),Y.emplaceBack(gi,gi+1,gi+2),Y.emplaceBack(gi+1,gi+2,gi+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),ze!==h.length-1&&Vt===h[ze+1].sectionIndex||n.programConfigurations.populatePaintArrays(ee.length,S,S.index,{},j,Ce&&Ce[Vt])}n.placedSymbolArray.emplaceBack(L.x,L.y,me,this.glyphOffsetArray.length-me,Le,k,O,L.segment,p?p[0]:0,p?p[1]:0,y[0],y[1],M,0,!1,0,H)}_addCollisionDebugVertex(n,h,p,y,v,S){return h.emplaceBack(0,0),n.emplaceBack(p.x,p.y,y,v,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(n,h,p,y,v,S,M){const L=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=L.vertexLength,O=v.layoutVertexArray,H=v.collisionVertexArray,j=M.anchorX,Y=M.anchorY;this._addCollisionDebugVertex(O,H,S,j,Y,new Re(n,h)),this._addCollisionDebugVertex(O,H,S,j,Y,new Re(p,h)),this._addCollisionDebugVertex(O,H,S,j,Y,new Re(p,y)),this._addCollisionDebugVertex(O,H,S,j,Y,new Re(n,y)),L.vertexLength+=4;const ee=v.indexArray;ee.emplaceBack(k,k+1),ee.emplaceBack(k+1,k+2),ee.emplaceBack(k+2,k+3),ee.emplaceBack(k+3,k),L.primitiveLength+=4}addDebugCollisionBoxes(n,h,p,y){for(let v=n;v<h;v++){const S=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,y?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ry(f,sC.members,C),this.iconCollisionBox=new Ry(f,sC.members,C);for(let n=0;n<this.symbolInstances.length;n++){const h=this.symbolInstances.get(n);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(n,h,p,y,v,S,M,L,k){const O={};for(let H=h;H<p;H++){const j=n.get(H);O.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.textFeatureIndex=j.featureIndex;break}for(let H=y;H<v;H++){const j=n.get(H);O.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.verticalTextFeatureIndex=j.featureIndex;break}for(let H=S;H<M;H++){const j=n.get(H);O.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.iconFeatureIndex=j.featureIndex;break}for(let H=L;H<k;H++){const j=n.get(H);O.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.verticalIconFeatureIndex=j.featureIndex;break}return O}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,h){const p=n.placedSymbolArray.get(h),y=p.vertexStartIndex+4*p.numGlyphs;for(let v=p.vertexStartIndex;v<y;v+=4)n.indexArray.emplaceBack(v,v+1,v+2),n.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(n),p=Math.cos(n),y=[],v=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const L=this.symbolInstances.get(M);y.push(0|Math.round(h*L.anchorX+p*L.anchorY)),v.push(L.featureIndex)}return S.sort((M,L)=>y[M]-y[L]||v[L]-v[M]),S}addToSortKeyRanges(n,h){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===h?p.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const p=this.symbolInstances.get(h);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((y,v,S)=>{y>=0&&S.indexOf(y)===v&&this.addIndicesForPlacedSymbol(this.text,y)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Lt("SymbolBucket",iu,{omit:["layers","collisionBoxArray","features","compareText"]}),iu.MAX_GLYPHS=65535,iu.addDynamicAttributes=Ty;const pO=new yr({"symbol-placement":new Qt(be.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ti(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qt(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qt(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qt(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new ti(be.layout_symbol["icon-size"]),"icon-text-fit":new Qt(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new ti(be.layout_symbol["icon-image"]),"icon-rotate":new ti(be.layout_symbol["icon-rotate"]),"icon-padding":new ti(be.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(be.layout_symbol["icon-keep-upright"]),"icon-offset":new ti(be.layout_symbol["icon-offset"]),"icon-anchor":new ti(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(be.layout_symbol["text-rotation-alignment"]),"text-field":new ti(be.layout_symbol["text-field"]),"text-font":new ti(be.layout_symbol["text-font"]),"text-size":new ti(be.layout_symbol["text-size"]),"text-max-width":new ti(be.layout_symbol["text-max-width"]),"text-line-height":new Qt(be.layout_symbol["text-line-height"]),"text-letter-spacing":new ti(be.layout_symbol["text-letter-spacing"]),"text-justify":new ti(be.layout_symbol["text-justify"]),"text-radial-offset":new ti(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(be.layout_symbol["text-variable-anchor"]),"text-anchor":new ti(be.layout_symbol["text-anchor"]),"text-max-angle":new Qt(be.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(be.layout_symbol["text-writing-mode"]),"text-rotate":new ti(be.layout_symbol["text-rotate"]),"text-padding":new Qt(be.layout_symbol["text-padding"]),"text-keep-upright":new Qt(be.layout_symbol["text-keep-upright"]),"text-transform":new ti(be.layout_symbol["text-transform"]),"text-offset":new ti(be.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(be.layout_symbol["text-allow-overlap"]),"text-overlap":new Qt(be.layout_symbol["text-overlap"]),"text-ignore-placement":new Qt(be.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(be.layout_symbol["text-optional"])});var Ly={paint:new yr({"icon-opacity":new ti(be.paint_symbol["icon-opacity"]),"icon-color":new ti(be.paint_symbol["icon-color"]),"icon-halo-color":new ti(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new ti(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ti(be.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new ti(be.paint_symbol["text-opacity"]),"text-color":new ti(be.paint_symbol["text-color"],{runtimeType:pe,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new ti(be.paint_symbol["text-halo-color"]),"text-halo-width":new ti(be.paint_symbol["text-halo-width"]),"text-halo-blur":new ti(be.paint_symbol["text-halo-blur"]),"text-translate":new Qt(be.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(be.paint_symbol["text-translate-anchor"])}),layout:pO};class RC{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Ni,this.defaultValue=n}evaluate(n){if(n.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(n.formattedSection))return h.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",RC,{omit:["defaultValue"]});class pg extends as{constructor(n){super(n,Ly)}recalculate(n,h){if(super.recalculate(n,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const y=[];for(const v of p)y.indexOf(v)<0&&y.push(v);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,h,p,y){const v=this.layout.get(n).evaluate(h,{},p,y),S=this._unevaluatedLayout._values[n];return S.isDataDriven()||bh(S.value)||!v?v:function(M,L){return L.replace(/{([^{}]+)}/g,(k,O)=>O in M?String(M[O]):"")}(h.properties,v)}createBucket(n){return new iu(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Ly.paint.overridableProperties){if(!pg.hasPaintOverride(this.layout,n))continue;const h=this.paint.get(n),p=new RC(h),y=new Md(p,h.property.specification);let v=null;v=h.value.kind==="constant"||h.value.kind==="source"?new Td("source",y):new Bd("composite",y,h.value.zoomStops),this.paint._values[n]=new ss(h.property,v,h.parameters)}}_handleOverridablePaintPropertyUpdate(n,h,p){return!(!this.layout||h.isDataDriven()||p.isDataDriven())&&pg.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,h){const p=n.get("text-field"),y=Ly.paint.properties[h];let v=!1;const S=M=>{for(const L of M)if(y.overrides&&y.overrides.hasOverride(L))return void(v=!0)};if(p.value.kind==="constant"&&p.value.value instanceof ci)S(p.value.value.sections);else if(p.value.kind==="source"){const M=k=>{v||(k instanceof W&&ie(k.value)===ct?S(k.value.sections):k instanceof xh?S(k.sections):k.eachChild(M))},L=p.value;L._styleExpression&&M(L._styleExpression.expression)}return v}}function Dy(l,n,h){let p="never";const y=l.get(n);return y?p=y:l.get(h)&&(p="always"),p}var fO={paint:new yr({"background-color":new Qt(be.paint_background["background-color"]),"background-pattern":new Wd(be.paint_background["background-pattern"]),"background-opacity":new Qt(be.paint_background["background-opacity"])})},mO={paint:new yr({"raster-opacity":new Qt(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qt(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(be.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(be.paint_raster["raster-saturation"]),"raster-contrast":new Qt(be.paint_raster["raster-contrast"]),"raster-resampling":new Qt(be.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(be.paint_raster["raster-fade-duration"])})};class gO extends as{constructor(n){super(n,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const AO={circle:class extends as{constructor(l){super(l,ly)}createBucket(l){return new os(l)}queryRadius(l){const n=l;return no("circle-radius",this,n)+no("circle-stroke-width",this,n)+jh(this.paint.get("circle-translate"))}queryIntersectsFeature(l,n,h,p,y,v,S,M){const L=Xh(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,S),k=this.paint.get("circle-radius").evaluate(n,h)+this.paint.get("circle-stroke-width").evaluate(n,h),O=this.paint.get("circle-pitch-alignment")==="map",H=O?L:function(Y,ee){return Y.map(ge=>QI(ge,ee))}(L,M),j=O?k*S:k;for(const Y of p)for(const ee of Y){const ge=O?ee:QI(ee,M);let me=j;const Le=Jm([],[ee.x,ee.y,0,1],M);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?me*=Le[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(me*=v.cameraToCenterDistance/Le[3]),$h(H,ge,me))return!0}return!1}},heatmap:class extends as{createBucket(l){return new VI(l)}constructor(l){super(l,Y5),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=WI({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends as{constructor(l){super(l,K5)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends as{constructor(l){super(l,pN)}recalculate(l,n){super.recalculate(l,n);const h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new _y(l)}queryRadius(){return jh(this.paint.get("fill-translate"))}queryIntersectsFeature(l,n,h,p,y,v,S){return Mn(Xh(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,S),p)}isTileClipped(){return!0}},"fill-extrusion":class extends as{constructor(l){super(l,CN)}createBucket(l){return new xy(l)}queryRadius(){return jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,n,h,p,y,v,S,M){const L=Xh(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,S),k=this.paint.get("fill-extrusion-height").evaluate(n,h),O=this.paint.get("fill-extrusion-base").evaluate(n,h),H=function(Y,ee,ge,me){const Le=[];for(const Ge of Y){const Ce=[Ge.x,Ge.y,0,1];Jm(Ce,Ce,ee),Le.push(new Re(Ce[0]/Ce[3],Ce[1]/Ce[3]))}return Le}(L,M),j=function(Y,ee,ge,me){const Le=[],Ge=[],Ce=me[8]*ee,ze=me[9]*ee,it=me[10]*ee,tt=me[11]*ee,Ft=me[8]*ge,Gt=me[9]*ge,wt=me[10]*ge,xt=me[11]*ge;for(const At of Y){const Et=[],bt=[];for(const ut of At){const jt=ut.x,Vt=ut.y,gi=me[0]*jt+me[4]*Vt+me[12],tn=me[1]*jt+me[5]*Vt+me[13],cn=me[2]*jt+me[6]*Vt+me[14],Dn=me[3]*jt+me[7]*Vt+me[15],us=cn+it,$n=Dn+tt,Tn=gi+Ft,Fn=tn+Gt,jn=cn+wt,cr=Dn+xt,Ur=new Re((gi+Ce)/$n,(tn+ze)/$n);Ur.z=us/$n,Et.push(Ur);const Bn=new Re(Tn/cr,Fn/cr);Bn.z=jn/cr,bt.push(Bn)}Le.push(Et),Ge.push(bt)}return[Le,Ge]}(p,O,k,M);return function(Y,ee,ge){let me=1/0;Mn(ge,ee)&&(me=eC(ge,ee[0]));for(let Le=0;Le<ee.length;Le++){const Ge=ee[Le],Ce=Y[Le];for(let ze=0;ze<Ge.length-1;ze++){const it=Ge[ze],tt=[it,Ge[ze+1],Ce[ze+1],Ce[ze],it];wa(ge,tt)&&(me=Math.min(me,eC(ge,tt)))}}return me!==1/0&&me}(j[0],j[1],H)}},line:class extends as{constructor(l){super(l,iC),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof _a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,n){super.recalculate(l,n),this.paint._values["line-floorwidth"]=nC.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new vy(l)}queryRadius(l){const n=l,h=rC(no("line-width",this,n),no("line-gap-width",this,n)),p=no("line-offset",this,n);return h/2+Math.abs(p)+jh(this.paint.get("line-translate"))}queryIntersectsFeature(l,n,h,p,y,v,S){const M=Xh(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,S),L=S/2*rC(this.paint.get("line-width").evaluate(n,h),this.paint.get("line-gap-width").evaluate(n,h)),k=this.paint.get("line-offset").evaluate(n,h);return k&&(p=function(O,H){const j=[];for(let Y=0;Y<O.length;Y++){const ee=O[Y],ge=[];for(let me=0;me<ee.length;me++){const Le=ee[me-1],Ge=ee[me],Ce=ee[me+1],ze=me===0?new Re(0,0):Ge.sub(Le)._unit()._perp(),it=me===ee.length-1?new Re(0,0):Ce.sub(Ge)._unit()._perp(),tt=ze._add(it)._unit(),Ft=tt.x*it.x+tt.y*it.y;Ft!==0&&tt._mult(1/Ft),ge.push(tt._mult(H)._add(Ge))}j.push(ge)}return j}(p,k*S)),function(O,H,j){for(let Y=0;Y<H.length;Y++){const ee=H[Y];if(O.length>=3){for(let ge=0;ge<ee.length;ge++)if(ls(O,ee[ge]))return!0}if(on(O,ee,j))return!0}return!1}(M,p,L)}isTileClipped(){return!0}},symbol:pg,background:class extends as{constructor(l){super(l,fO)}},raster:class extends as{constructor(l){super(l,mO)}}};class _O{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Py=63710088e-1;class yn{constructor(n,h){if(isNaN(n)||isNaN(h))throw new Error(`Invalid LngLat object: (${n}, ${h})`);if(this.lng=+n,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yn(E(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const h=Math.PI/180,p=this.lat*h,y=n.lat*h,v=Math.sin(p)*Math.sin(y)+Math.cos(p)*Math.cos(y)*Math.cos((n.lng-this.lng)*h);return Py*Math.acos(Math.min(v,1))}toBounds(n=0){const h=360*n/40075017,p=h/Math.cos(Math.PI/180*this.lat);return new LC(new yn(this.lng-p,this.lat-h),new yn(this.lng+p,this.lat+h))}static convert(n){if(n instanceof yn)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new yn(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new yn(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class nu{constructor(n,h){n&&(h?this.setSouthWest(n).setNorthEast(h):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof yn?new yn(n.lng,n.lat):yn.convert(n),this}setSouthWest(n){return this._sw=n instanceof yn?new yn(n.lng,n.lat):yn.convert(n),this}extend(n){const h=this._sw,p=this._ne;let y,v;if(n instanceof yn)y=n,v=n;else{if(!(n instanceof nu))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(nu.convert(n)):this.extend(yn.convert(n)):this;if(y=n._sw,v=n._ne,!y||!v)return this}return h||p?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),p.lng=Math.max(v.lng,p.lng),p.lat=Math.max(v.lat,p.lat)):(this._sw=new yn(y.lng,y.lat),this._ne=new yn(v.lng,v.lat)),this}getCenter(){return new yn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new yn(this.getWest(),this.getNorth())}getSouthEast(){return new yn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:h,lat:p}=yn.convert(n);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y}static convert(n){return n instanceof nu?n:n&&new nu(n)}}var LC=nu;const DC=2*Math.PI*Py;function PC(l){return DC*Math.cos(l*Math.PI/180)}function UC(l){return(180+l)/360}function FC(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function kC(l,n){return l/PC(n)}function Uy(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}class fg{constructor(n,h,p=0){this.x=+n,this.y=+h,this.z=+p}static fromLngLat(n,h=0){const p=yn.convert(n);return new fg(UC(p.lng),FC(p.lat),kC(h,p.lat))}toLngLat(){return new yn(360*this.x-180,Uy(this.y))}toAltitude(){return this.z*PC(Uy(this.y))}meterInMercatorCoordinateUnits(){return 1/DC*(n=Uy(this.y),1/Math.cos(n*Math.PI/180));var n}}function NC(l,n,h){var p=2*Math.PI*6378137/256/Math.pow(2,h);return[l*p-2*Math.PI*6378137/2,n*p-2*Math.PI*6378137/2]}class Fy{constructor(n,h,p){if(n<0||n>25||p<0||p>=Math.pow(2,n)||h<0||h>=Math.pow(2,n))throw new Error(`x=${h}, y=${p}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=h,this.y=p,this.key=yp(0,n,n,h,p)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,h,p){const y=(S=this.y,M=this.z,L=NC(256*(v=this.x),256*(S=Math.pow(2,M)-S-1),M),k=NC(256*(v+1),256*(S+1),M),L[0]+","+L[1]+","+k[0]+","+k[1]);var v,S,M,L,k;const O=function(H,j,Y){let ee,ge="";for(let me=H;me>0;me--)ee=1<<me-1,ge+=(j&ee?1:0)+(Y&ee?2:0);return ge}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,y)}isChildOf(n){const h=this.z-n.z;return h>0&&n.x===this.x>>h&&n.y===this.y>>h}getTilePoint(n){const h=Math.pow(2,this.z);return new Re((n.x*h-this.x)*Pi,(n.y*h-this.y)*Pi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class OC{constructor(n,h){this.wrap=n,this.canonical=h,this.key=yp(n,h.z,h.z,h.x,h.y)}}class hs{constructor(n,h,p,y,v){if(n<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${p}`);this.overscaledZ=n,this.wrap=h,this.canonical=new Fy(p,+y,+v),this.key=yp(h,n,p,y,v)}clone(){return new hs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-n;return n>this.canonical.z?new hs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hs(n,this.wrap,n,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(n,h){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-n;return n>this.canonical.z?yp(this.wrap*+h,n,this.canonical.z,this.canonical.x,this.canonical.y):yp(this.wrap*+h,n,n,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const h=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>h&&n.canonical.y===this.canonical.y>>h}children(n){if(this.overscaledZ>=n)return[new hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,p=2*this.canonical.x,y=2*this.canonical.y;return[new hs(h,this.wrap,h,p,y),new hs(h,this.wrap,h,p+1,y),new hs(h,this.wrap,h,p,y+1),new hs(h,this.wrap,h,p+1,y+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new hs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new OC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new fg(n.x-this.wrap,n.y))}}function yp(l,n,h,p,y){(l*=2)<0&&(l=-1*l-1);const v=1<<h;return(v*v*l+v*y+p).toString(36)+h.toString(36)+n.toString(36)}Lt("CanonicalTileID",Fy),Lt("OverscaledTileID",hs,{omit:["posMatrix"]});class zC{constructor(n,h,p){if(this.uid=n,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void q(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=h.height;const y=this.dim=h.height-2;this.data=new Uint32Array(h.data.buffer),this.encoding=p||"mapbox";for(let v=0;v<y;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(y,v)]=this.data[this._idx(y-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,y)]=this.data[this._idx(v,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<y;v++)for(let S=0;S<y;S++){const M=this.get(v,S);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(n,h){const p=new Uint8Array(this.data.buffer),y=4*this._idx(n,h);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[y],p[y+1],p[y+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(n,h){if(n<-1||n>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(n+1)}_unpackMapbox(n,h,p){return(256*n*256+256*h+p)/10-1e4}_unpackTerrarium(n,h,p){return 256*n+h+p/256-32768}getPixels(){return new cs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,h,p){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let y=h*this.dim,v=h*this.dim+this.dim,S=p*this.dim,M=p*this.dim+this.dim;switch(h){case-1:y=v-1;break;case 1:v=y+1}switch(p){case-1:S=M-1;break;case 1:M=S+1}const L=-h*this.dim,k=-p*this.dim;for(let O=S;O<M;O++)for(let H=y;H<v;H++)this.data[this._idx(H,O)]=n.data[this._idx(H+L,O+k)]}}Lt("DEMData",zC);class GC{constructor(n){this._stringToNumber={},this._numberToString=[];for(let h=0;h<n.length;h++){const p=n[h];this._stringToNumber[p]=h,this._numberToString[h]=p}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class QC{constructor(n,h,p,y,v){this.type="Feature",this._vectorTileFeature=n,n._z=h,n._x=p,n._y=y,this.properties=n.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(n[h]=this[h]);return n}}class VC{constructor(n,h){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new $o(Pi,16,0),this.grid3D=new $o(Pi,16,0),this.featureIndexArray=new Km,this.promoteId=h}insert(n,h,p,y,v,S){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,y,v);const L=S?this.grid3D:this.grid;for(let k=0;k<h.length;k++){const O=h[k],H=[1/0,1/0,-1/0,-1/0];for(let j=0;j<O.length;j++){const Y=O[j];H[0]=Math.min(H[0],Y.x),H[1]=Math.min(H[1],Y.y),H[2]=Math.max(H[2],Y.x),H[3]=Math.max(H[3],Y.y)}H[0]<Pi&&H[1]<Pi&&H[2]>=0&&H[3]>=0&&L.insert(M,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Jo.VectorTile(new by(this.rawTileData)).layers,this.sourceLayerCoder=new GC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,h,p,y){this.loadVTLayers();const v=n.params||{},S=Pi/n.tileSize/n.scale,M=Ld(v.filter),L=n.queryGeometry,k=n.queryPadding*S,O=WC(L),H=this.grid.query(O.minX-k,O.minY-k,O.maxX+k,O.maxY+k),j=WC(n.cameraQueryGeometry),Y=this.grid3D.query(j.minX-k,j.minY-k,j.maxX+k,j.maxY+k,(me,Le,Ge,Ce)=>function(ze,it,tt,Ft,Gt){for(const xt of ze)if(it<=xt.x&&tt<=xt.y&&Ft>=xt.x&&Gt>=xt.y)return!0;const wt=[new Re(it,tt),new Re(it,Gt),new Re(Ft,Gt),new Re(Ft,tt)];if(ze.length>2){for(const xt of wt)if(ls(ze,xt))return!0}for(let xt=0;xt<ze.length-1;xt++)if(op(ze[xt],ze[xt+1],wt))return!0;return!1}(n.cameraQueryGeometry,me-k,Le-k,Ge+k,Ce+k));for(const me of Y)H.push(me);H.sort(yO);const ee={};let ge;for(let me=0;me<H.length;me++){const Le=H[me];if(Le===ge)continue;ge=Le;const Ge=this.featureIndexArray.get(Le);let Ce=null;this.loadMatchingFeature(ee,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,M,v.layers,v.availableImages,h,p,y,(ze,it,tt)=>(Ce||(Ce=qn(ze)),it.queryIntersectsFeature(L,ze,tt,Ce,this.z,n.transform,S,n.pixelPosMatrix)))}return ee}loadMatchingFeature(n,h,p,y,v,S,M,L,k,O,H){const j=this.bucketLayerIDs[h];if(S&&!function(me,Le){for(let Ge=0;Ge<me.length;Ge++)if(Le.indexOf(me[Ge])>=0)return!0;return!1}(S,j))return;const Y=this.sourceLayerCoder.decode(p),ee=this.vtLayers[Y].feature(y);if(v.needGeometry){const me=Pr(ee,!0);if(!v.filter(new en(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!v.filter(new en(this.tileID.overscaledZ),ee))return;const ge=this.getId(ee,Y);for(let me=0;me<j.length;me++){const Le=j[me];if(S&&S.indexOf(Le)<0)continue;const Ge=L[Le];if(!Ge)continue;let Ce={};ge&&O&&(Ce=O.getState(Ge.sourceLayer||"_geojsonTileLayer",ge));const ze=T({},k[Le]);ze.paint=HC(ze.paint,Ge.paint,ee,Ce,M),ze.layout=HC(ze.layout,Ge.layout,ee,Ce,M);const it=!H||H(ee,Ge,Ce);if(!it)continue;const tt=new QC(ee,this.z,this.x,this.y,ge);tt.layer=ze;let Ft=n[Le];Ft===void 0&&(Ft=n[Le]=[]),Ft.push({featureIndex:y,feature:tt,intersectionZ:it})}}lookupSymbolFeatures(n,h,p,y,v,S,M,L){const k={};this.loadVTLayers();const O=Ld(v);for(const H of n)this.loadMatchingFeature(k,p,y,H,O,S,M,L,h);return k}hasLayer(n){for(const h of this.bucketLayerIDs)for(const p of h)if(n===p)return!0;return!1}getId(n,h){let p=n.id;return this.promoteId&&(p=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof p=="boolean"&&(p=Number(p))),p}}function HC(l,n,h,p,y){return R(l,(v,S)=>{const M=n instanceof Fh?n.get(S):null;return M&&M.evaluate?M.evaluate(h,p,y):M})}function WC(l){let n=1/0,h=1/0,p=-1/0,y=-1/0;for(const v of l)n=Math.min(n,v.x),h=Math.min(h,v.y),p=Math.max(p,v.x),y=Math.max(y,v.y);return{minX:n,minY:h,maxX:p,maxY:y}}function yO(l,n){return n-l}function ky(l,n,h,p,y,v){if(y-p<=h)return;const S=p+y>>1;qC(l,n,S,p,y,v%2),ky(l,n,h,p,S-1,v+1),ky(l,n,h,S+1,y,v+1)}function qC(l,n,h,p,y,v){for(;y>p;){if(y-p>600){const k=y-p+1,O=h-p+1,H=Math.log(k),j=.5*Math.exp(2*H/3),Y=.5*Math.sqrt(H*j*(k-j)/k)*(O-k/2<0?-1:1);qC(l,n,h,Math.max(p,Math.floor(h-O*j/k+Y)),Math.min(y,Math.floor(h+(k-O)*j/k+Y)),v)}const S=n[2*h+v];let M=p,L=y;for(xp(l,n,p,h),n[2*y+v]>S&&xp(l,n,p,y);M<L;){for(xp(l,n,M,L),M++,L--;n[2*M+v]<S;)M++;for(;n[2*L+v]>S;)L--}n[2*p+v]===S?xp(l,n,p,L):(L++,xp(l,n,L,y)),L<=h&&(p=L+1),h<=L&&(y=L-1)}}function xp(l,n,h,p){Ny(l,h,p),Ny(n,2*h,2*p),Ny(n,2*h+1,2*p+1)}function Ny(l,n,h){const p=l[n];l[n]=l[h],l[h]=p}function $C(l,n,h,p){const y=l-h,v=n-p;return y*y+v*v}Lt("FeatureIndex",VC,{omit:["rawTileData","sourceLayerCoder"]});const xO=l=>l[0],vO=l=>l[1];var Oy;a.PerformanceMarkers=void 0,(Oy=a.PerformanceMarkers||(a.PerformanceMarkers={})).create="create",Oy.load="load",Oy.fullLoad="fullLoad";let mg=null,vp=[];const zy=1e3/30,bO={mark(l){performance.mark(l)},frame(l){const n=l;mg!=null&&vp.push(n-mg),mg=n},clearMetrics(){mg=null,vp=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const l in a.PerformanceMarkers)performance.clearMarks(a.PerformanceMarkers[l])},getPerformanceMetrics(){performance.measure("loadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.load),performance.measure("fullLoadTime",a.PerformanceMarkers.create,a.PerformanceMarkers.fullLoad);const l=performance.getEntriesByName("loadTime")[0].duration,n=performance.getEntriesByName("fullLoadTime")[0].duration,h=vp.length,p=1/(vp.reduce((v,S)=>v+S,0)/h/1e3),y=vp.filter(v=>v>zy).reduce((v,S)=>v+(S-zy)/zy,0);return{loadTime:l,fullLoadTime:n,fps:p,percentDroppedFrames:y/(h+y)*100}}};a.AJAXError=je,a.ARRAY_TYPE=Ea,a.Actor=class{constructor(l,n,h){this.target=l,this.parent=n,this.mapId=h,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},P(["receive","process"],this),this.invoker=new _O(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=_e()?l:window}send(l,n,h,p,y=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(this.callbacks[v]=h);const S=ce(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:l,hasCallback:!!h,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Ja(n,S)},S),{cancel:()=>{h&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(l){const n=l.data,h=n.id;if(h&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){delete this.tasks[h];const p=this.cancelCallbacks[h];delete this.cancelCallbacks[h],p&&p()}else _e()||n.mustQueue?(this.tasks[h]=n,this.taskQueue.push(h),this.invoker.trigger()):this.processTask(h,n)}process(){if(!this.taskQueue.length)return;const l=this.taskQueue.shift(),n=this.tasks[l];delete this.tasks[l],this.taskQueue.length&&this.invoker.trigger(),n&&this.processTask(l,n)}processTask(l,n){if(n.type==="<response>"){const h=this.callbacks[l];delete this.callbacks[l],h&&(n.error?h(eo(n.error)):h(null,eo(n.data)))}else{let h=!1;const p=ce(this.globalScope)?void 0:[],y=n.hasCallback?(M,L)=>{h=!0,delete this.cancelCallbacks[l],this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:M?Ja(M):null,data:Ja(L,p)},p)}:M=>{h=!0};let v=null;const S=eo(n.data);if(this.parent[n.type])v=this.parent[n.type](n.sourceMapId,S,y);else if(this.parent.getWorkerSource){const M=n.type.split(".");v=this.parent.getWorkerSource(n.sourceMapId,M[0],S.source)[M[1]](S,y)}else y(new Error(`Could not find function ${n.type}`));!h&&v&&v.cancel&&(this.cancelCallbacks[l]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.AlphaImage=cp,a.CanonicalTileID=Fy,a.CollisionBoxArray=rp,a.CollisionCircleLayoutArray=class extends Zd{},a.Color=Ke,a.DEMData=zC,a.DataConstantProperty=Qt,a.DictionaryCoder=GC,a.EXTENT=Pi,a.ErrorEvent=Kt,a.EvaluationParameters=en,a.Event=Te,a.Evented=Zt,a.FeatureIndex=VC,a.FillBucket=_y,a.FillExtrusionBucket=xy,a.GeoJSONFeature=QC,a.ImageAtlas=pC,a.ImagePosition=Ey,a.KDBush=class{constructor(l,n=xO,h=vO,p=64,y=Float64Array){this.nodeSize=p,this.points=l;const v=l.length<65536?Uint16Array:Uint32Array,S=this.ids=new v(l.length),M=this.coords=new y(2*l.length);for(let L=0;L<l.length;L++)S[L]=L,M[2*L]=n(l[L]),M[2*L+1]=h(l[L]);ky(S,M,p,0,S.length-1,0)}range(l,n,h,p){return function(y,v,S,M,L,k,O){const H=[0,y.length-1,0],j=[];let Y,ee;for(;H.length;){const ge=H.pop(),me=H.pop(),Le=H.pop();if(me-Le<=O){for(let ze=Le;ze<=me;ze++)Y=v[2*ze],ee=v[2*ze+1],Y>=S&&Y<=L&&ee>=M&&ee<=k&&j.push(y[ze]);continue}const Ge=Math.floor((Le+me)/2);Y=v[2*Ge],ee=v[2*Ge+1],Y>=S&&Y<=L&&ee>=M&&ee<=k&&j.push(y[Ge]);const Ce=(ge+1)%2;(ge===0?S<=Y:M<=ee)&&(H.push(Le),H.push(Ge-1),H.push(Ce)),(ge===0?L>=Y:k>=ee)&&(H.push(Ge+1),H.push(me),H.push(Ce))}return j}(this.ids,this.coords,l,n,h,p,this.nodeSize)}within(l,n,h){return function(p,y,v,S,M,L){const k=[0,p.length-1,0],O=[],H=M*M;for(;k.length;){const j=k.pop(),Y=k.pop(),ee=k.pop();if(Y-ee<=L){for(let Ce=ee;Ce<=Y;Ce++)$C(y[2*Ce],y[2*Ce+1],v,S)<=H&&O.push(p[Ce]);continue}const ge=Math.floor((ee+Y)/2),me=y[2*ge],Le=y[2*ge+1];$C(me,Le,v,S)<=H&&O.push(p[ge]);const Ge=(j+1)%2;(j===0?v-M<=me:S-M<=Le)&&(k.push(ee),k.push(ge-1),k.push(Ge)),(j===0?v+M>=me:S+M>=Le)&&(k.push(ge+1),k.push(Y),k.push(Ge))}return O}(this.ids,this.coords,l,n,h,this.nodeSize)}},a.LineBucket=vy,a.LineStripIndexArray=class extends Hh{},a.LngLat=yn,a.LngLatBounds=LC,a.MercatorCoordinate=fg,a.ONE_EM=On,a.OverscaledTileID=hs,a.PerformanceUtils=bO,a.Pos3dArray=class extends Oh{},a.PosArray=ap,a.Properties=yr,a.QuadTriangleArray=class extends Qh{},a.RGBAImage=cs,a.RasterBoundsArray=class extends Ko{},a.RequestPerformance=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},a.SegmentVector=F,a.SymbolBucket=iu,a.Transitionable=Hd,a.TriangleIndexArray=w,a.Uniform1f=Ze,a.Uniform1i=class extends We{constructor(l,n){super(l,n),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},a.Uniform2f=class extends We{constructor(l,n){super(l,n),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},a.Uniform3f=class extends We{constructor(l,n){super(l,n),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},a.Uniform4f=et,a.UniformColor=lt,a.UniformMatrix4f=class extends We{constructor(l,n){super(l,n),this.current=rt}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let n=1;n<16;n++)if(l[n]!==this.current[n]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},a.UnwrappedTileID=OC,a.ValidationError=$e,a.ZoomHistory=Vm,a.addDynamicAttributes=Ty,a.arrayBufferToImage=function(l,n){const h=new Image;h.onload=()=>{n(null,h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Ne})},h.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(l)],{type:"image/png"});h.src=l.byteLength?URL.createObjectURL(p):Ne},a.arrayBufferToImageBitmap=function(l,n){const h=new Blob([new Uint8Array(l)],{type:"image/png"});createImageBitmap(h).then(p=>{n(null,p)}).catch(p=>{n(new Error(`Could not load image because of ${p.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},a.asyncAll=function(l,n,h){if(!l.length)return h(null,[]);let p=l.length;const y=new Array(l.length);let v=null;l.forEach((S,M)=>{n(S,(L,k)=>{L&&(v=L),y[M]=k,--p==0&&h(v,y)})})},a.bezier=x,a.bindAll=P,a.clamp=I,a.clipLine=SC,a.clone=function(l){var n=new Ea(16);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=l[3],n[4]=l[4],n[5]=l[5],n[6]=l[6],n[7]=l[7],n[8]=l[8],n[9]=l[9],n[10]=l[10],n[11]=l[11],n[12]=l[12],n[13]=l[13],n[14]=l[14],n[15]=l[15],n},a.clone$1=G,a.collisionCircleLayout=NN,a.config=Oe,a.copy=function(l,n){return l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15],l},a.create=function(){var l=new Ea(16);return Ea!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},a.createExpression=wh,a.createFilter=Ld,a.createLayout=Cn,a.createStyleLayer=function(l){return l.type==="custom"?new gO(l):new AO[l.type](l)},a.dot=function(l,n){return l[0]*n[0]+l[1]*n[1]+l[2]*n[2]+l[3]*n[3]},a.earthRadius=Py,a.ease=b,a.emitValidationErrors=kd,a.equals=function(l,n){var h=l[0],p=l[1],y=l[2],v=l[3],S=l[4],M=l[5],L=l[6],k=l[7],O=l[8],H=l[9],j=l[10],Y=l[11],ee=l[12],ge=l[13],me=l[14],Le=l[15],Ge=n[0],Ce=n[1],ze=n[2],it=n[3],tt=n[4],Ft=n[5],Gt=n[6],wt=n[7],xt=n[8],At=n[9],Et=n[10],bt=n[11],ut=n[12],jt=n[13],Vt=n[14],gi=n[15];return Math.abs(h-Ge)<=Ln*Math.max(1,Math.abs(h),Math.abs(Ge))&&Math.abs(p-Ce)<=Ln*Math.max(1,Math.abs(p),Math.abs(Ce))&&Math.abs(y-ze)<=Ln*Math.max(1,Math.abs(y),Math.abs(ze))&&Math.abs(v-it)<=Ln*Math.max(1,Math.abs(v),Math.abs(it))&&Math.abs(S-tt)<=Ln*Math.max(1,Math.abs(S),Math.abs(tt))&&Math.abs(M-Ft)<=Ln*Math.max(1,Math.abs(M),Math.abs(Ft))&&Math.abs(L-Gt)<=Ln*Math.max(1,Math.abs(L),Math.abs(Gt))&&Math.abs(k-wt)<=Ln*Math.max(1,Math.abs(k),Math.abs(wt))&&Math.abs(O-xt)<=Ln*Math.max(1,Math.abs(O),Math.abs(xt))&&Math.abs(H-At)<=Ln*Math.max(1,Math.abs(H),Math.abs(At))&&Math.abs(j-Et)<=Ln*Math.max(1,Math.abs(j),Math.abs(Et))&&Math.abs(Y-bt)<=Ln*Math.max(1,Math.abs(Y),Math.abs(bt))&&Math.abs(ee-ut)<=Ln*Math.max(1,Math.abs(ee),Math.abs(ut))&&Math.abs(ge-jt)<=Ln*Math.max(1,Math.abs(ge),Math.abs(jt))&&Math.abs(me-Vt)<=Ln*Math.max(1,Math.abs(me),Math.abs(Vt))&&Math.abs(Le-gi)<=Ln*Math.max(1,Math.abs(Le),Math.abs(gi))},a.evaluateSizeForFeature=function(l,{uSize:n,uSizeT:h},{lowerSize:p,upperSize:y}){return l.kind==="source"?p/so:l.kind==="composite"?sn(p/so,y/so,h):n},a.evaluateSizeForZoom=function(l,n){let h=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:y,minZoom:v,maxZoom:S}=l,M=y?I(Dr.interpolationFactor(y,n,v,S),0,1):0;l.kind==="camera"?p=sn(l.minSize,l.maxSize,M):h=M}return{uSizeT:h,uSize:p}},a.evaluateVariableOffset=MC,a.evented=Vd,a.exported=ke,a.extend=T,a.filterObject=X,a.fromScaling=function(l,n){return l[0]=n[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=n[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=n[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},a.getAnchorAlignment=Iy,a.getAnchorJustification=My,a.getArrayBuffer=qe,a.getJSON=function(l,n){return yt(T(l,{type:"json"}),n)},a.getOverlapMode=Dy,a.getRTLTextPluginStatus=to,a.getReferrer=Je,a.getVideo=function(l,n){const h=window.document.createElement("video");h.muted=!0,h.onloadstart=function(){n(null,h)};for(let p=0;p<l.length;p++){const y=window.document.createElement("source");Ye(l[p])||(h.crossOrigin="Anonymous"),y.src=l[p],h.appendChild(y)}return{cancel:()=>{}}},a.identity=cy,a.invert=function(l,n){var h=n[0],p=n[1],y=n[2],v=n[3],S=n[4],M=n[5],L=n[6],k=n[7],O=n[8],H=n[9],j=n[10],Y=n[11],ee=n[12],ge=n[13],me=n[14],Le=n[15],Ge=h*M-p*S,Ce=h*L-y*S,ze=h*k-v*S,it=p*L-y*M,tt=p*k-v*M,Ft=y*k-v*L,Gt=O*ge-H*ee,wt=O*me-j*ee,xt=O*Le-Y*ee,At=H*me-j*ge,Et=H*Le-Y*ge,bt=j*Le-Y*me,ut=Ge*bt-Ce*Et+ze*At+it*xt-tt*wt+Ft*Gt;return ut?(l[0]=(M*bt-L*Et+k*At)*(ut=1/ut),l[1]=(y*Et-p*bt-v*At)*ut,l[2]=(ge*Ft-me*tt+Le*it)*ut,l[3]=(j*tt-H*Ft-Y*it)*ut,l[4]=(L*xt-S*bt-k*wt)*ut,l[5]=(h*bt-y*xt+v*wt)*ut,l[6]=(me*ze-ee*Ft-Le*Ce)*ut,l[7]=(O*Ft-j*ze+Y*Ce)*ut,l[8]=(S*Et-M*xt+k*Gt)*ut,l[9]=(p*xt-h*Et-v*Gt)*ut,l[10]=(ee*tt-ge*ze+Le*Ge)*ut,l[11]=(H*ze-O*tt-Y*Ge)*ut,l[12]=(M*wt-S*At-L*Gt)*ut,l[13]=(h*At-p*wt+y*Gt)*ut,l[14]=(ge*Ce-ee*it-me*Ge)*ut,l[15]=(O*it-H*Ce+j*Ge)*ut,l):null},a.isImageBitmap=Ve,a.isSafari=ce,a.isWorker=_e,a.keysDifference=function(l,n){const h=[];for(const p in l)p in n||h.push(p);return h},a.lazyLoadRTLTextPlugin=function(){_r.isLoading()||_r.isLoaded()||to()!=="deferred"||qm()},a.makeRequest=yt,a.mapObject=R,a.mercatorXfromLng=UC,a.mercatorYfromLat=FC,a.mercatorZfromAltitude=kC,a.mul=X5,a.mul$1=function(l,n,h){return l[0]=n[0]*h[0],l[1]=n[1]*h[1],l[2]=n[2]*h[2],l[3]=n[3]*h[3],l},a.multiply=GI,a.nextPowerOfTwo=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},a.number=sn,a.ortho=function(l,n,h,p,y,v,S){var M=1/(n-h),L=1/(p-y),k=1/(v-S);return l[0]=-2*M,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*L,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*k,l[11]=0,l[12]=(n+h)*M,l[13]=(y+p)*L,l[14]=(S+v)*k,l[15]=1,l},a.parseCacheControl=function(l){const n={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,p,y,v)=>{const S=y||v;return n[p]=!S||S.toLowerCase(),""}),n["max-age"]){const h=parseInt(n["max-age"],10);isNaN(h)?delete n["max-age"]:n["max-age"]=h}return n},a.parseGlyphPbf=function(l){return new by(l).readFields(XN,[])},a.pbf=by,a.performSymbolLayout=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=Pi/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const n=l.bucket.layers[0].layout,h=l.bucket.layers[0]._unevaluatedLayout._values,p={layoutIconSize:h["icon-size"].possiblyEvaluate(new en(l.bucket.zoom+1),l.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new en(l.bucket.zoom+1),l.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new en(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:k}=l.bucket.textSizeData;p.compositeTextSizes=[h["text-size"].possiblyEvaluate(new en(L),l.canonical),h["text-size"].possiblyEvaluate(new en(k),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:k}=l.bucket.iconSizeData;p.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new en(L),l.canonical),h["icon-size"].possiblyEvaluate(new en(k),l.canonical)]}const y=n.get("text-line-height")*On,v=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",S=n.get("text-keep-upright"),M=n.get("text-size");for(const L of l.bucket.features){const k=n.get("text-font").evaluate(L,{},l.canonical).join(","),O=M.evaluate(L,{},l.canonical),H=p.layoutTextSize.evaluate(L,{},l.canonical),j=p.layoutIconSize.evaluate(L,{},l.canonical),Y={horizontal:{},vertical:void 0},ee=L.text;let ge,me=[0,0];if(ee){const Ce=ee.toString(),ze=n.get("text-letter-spacing").evaluate(L,{},l.canonical)*On,it=iy(Ce)?ze:0,tt=n.get("text-anchor").evaluate(L,{},l.canonical),Ft=n.get("text-variable-anchor");if(!Ft){const Et=n.get("text-radial-offset").evaluate(L,{},l.canonical);me=Et?MC(tt,[Et*On,Cy]):n.get("text-offset").evaluate(L,{},l.canonical).map(bt=>bt*On)}let Gt=v?"center":n.get("text-justify").evaluate(L,{},l.canonical);const wt=n.get("symbol-placement"),xt=wt==="point"?n.get("text-max-width").evaluate(L,{},l.canonical)*On:0,At=()=>{l.bucket.allowVerticalPlacement&&Nd(Ce)&&(Y.vertical=ag(ee,l.glyphMap,l.glyphPositions,l.imagePositions,k,xt,y,tt,"left",it,me,a.WritingMode.vertical,!0,wt,H,O))};if(!v&&Ft){const Et=Gt==="auto"?Ft.map(ut=>My(ut)):[Gt];let bt=!1;for(let ut=0;ut<Et.length;ut++){const jt=Et[ut];if(!Y.horizontal[jt])if(bt)Y.horizontal[jt]=Y.horizontal[0];else{const Vt=ag(ee,l.glyphMap,l.glyphPositions,l.imagePositions,k,xt,y,"center",jt,it,me,a.WritingMode.horizontal,!1,wt,H,O);Vt&&(Y.horizontal[jt]=Vt,bt=Vt.positionedLines.length===1)}}At()}else{Gt==="auto"&&(Gt=My(tt));const Et=ag(ee,l.glyphMap,l.glyphPositions,l.imagePositions,k,xt,y,tt,Gt,it,me,a.WritingMode.horizontal,!1,wt,H,O);Et&&(Y.horizontal[Gt]=Et),At(),Nd(Ce)&&v&&S&&(Y.vertical=ag(ee,l.glyphMap,l.glyphPositions,l.imagePositions,k,xt,y,tt,Gt,it,me,a.WritingMode.vertical,!1,wt,H,O))}}let Le=!1;if(L.icon&&L.icon.name){const Ce=l.imageMap[L.icon.name];Ce&&(ge=tO(l.imagePositions[L.icon.name],n.get("icon-offset").evaluate(L,{},l.canonical),n.get("icon-anchor").evaluate(L,{},l.canonical)),Le=!!Ce.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=Le:l.bucket.sdfIcons!==Le&&q("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ce.pixelRatio!==l.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const Ge=BC(Y.horizontal)||Y.vertical;l.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||ge)&&lO(l.bucket,L,Y,ge,l.imageMap,p,H,j,me,Le,l.canonical)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},a.perspective=function(l,n,h,p,y){var v,S=1/Math.tan(n/2);return l[0]=S/h,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=S,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,y!=null&&y!==1/0?(l[10]=(y+p)*(v=1/(p-y)),l[14]=2*y*p*v):(l[10]=-1,l[14]=-2*p),l},a.pick=function(l,n){const h={};for(let p=0;p<n.length;p++){const y=n[p];y in l&&(h[y]=l[y])}return h},a.plugin=_r,a.pointGeometry=Re,a.polygonIntersectsPolygon=wa,a.potpack=dC,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.register=Lt,a.registerForPluginStateChange=function(l){return l({pluginStatus:Ar,pluginURL:Ls}),Vd.on("pluginStateChange",l),l},a.renderColorRamp=WI,a.rotateX=function(l,n,h){var p=Math.sin(h),y=Math.cos(h),v=n[4],S=n[5],M=n[6],L=n[7],k=n[8],O=n[9],H=n[10],j=n[11];return n!==l&&(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[4]=v*y+k*p,l[5]=S*y+O*p,l[6]=M*y+H*p,l[7]=L*y+j*p,l[8]=k*y-v*p,l[9]=O*y-S*p,l[10]=H*y-M*p,l[11]=j*y-L*p,l},a.rotateZ=function(l,n,h){var p=Math.sin(h),y=Math.cos(h),v=n[0],S=n[1],M=n[2],L=n[3],k=n[4],O=n[5],H=n[6],j=n[7];return n!==l&&(l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=v*y+k*p,l[1]=S*y+O*p,l[2]=M*y+H*p,l[3]=L*y+j*p,l[4]=k*y-v*p,l[5]=O*y-S*p,l[6]=H*y-M*p,l[7]=j*y-L*p,l},a.scale=function(l,n,h){var p=h[0],y=h[1],v=h[2];return l[0]=n[0]*p,l[1]=n[1]*p,l[2]=n[2]*p,l[3]=n[3]*p,l[4]=n[4]*y,l[5]=n[5]*y,l[6]=n[6]*y,l[7]=n[7]*y,l[8]=n[8]*v,l[9]=n[9]*v,l[10]=n[10]*v,l[11]=n[11]*v,l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15],l},a.setRTLTextPlugin=function(l,n,h=!1){if(Ar===jo||Ar===zd||Ar===Gd)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ls=ke.resolveURL(l),Ar=jo,Qd=n,Vl(),h||qm()},a.spec=be,a.sphericalToCartesian=function([l,n,h]){return n+=90,n*=Math.PI/180,h*=Math.PI/180,{x:l*Math.cos(n)*Math.sin(h),y:l*Math.sin(n)*Math.sin(h),z:l*Math.cos(h)}},a.toEvaluationFeature=Pr,a.transformMat4=Jm,a.translate=function(l,n,h){var p,y,v,S,M,L,k,O,H,j,Y,ee,ge=h[0],me=h[1],Le=h[2];return n===l?(l[12]=n[0]*ge+n[4]*me+n[8]*Le+n[12],l[13]=n[1]*ge+n[5]*me+n[9]*Le+n[13],l[14]=n[2]*ge+n[6]*me+n[10]*Le+n[14],l[15]=n[3]*ge+n[7]*me+n[11]*Le+n[15]):(y=n[1],v=n[2],S=n[3],M=n[4],L=n[5],k=n[6],O=n[7],H=n[8],j=n[9],Y=n[10],ee=n[11],l[0]=p=n[0],l[1]=y,l[2]=v,l[3]=S,l[4]=M,l[5]=L,l[6]=k,l[7]=O,l[8]=H,l[9]=j,l[10]=Y,l[11]=ee,l[12]=p*ge+M*me+H*Le+n[12],l[13]=y*ge+L*me+j*Le+n[13],l[14]=v*ge+k*me+Y*Le+n[14],l[15]=S*ge+O*me+ee*Le+n[15]),l},a.triggerPluginCompletionEvent=Wm,a.unicodeBlockLookup=vt,a.uniqueId=function(){return U++},a.validateCustomStyleLayer=function(l){const n=[],h=l.id;return h===void 0&&n.push({message:`layers.${h}: missing required property "id"`}),l.render===void 0&&n.push({message:`layers.${h}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&n.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),n},a.validateLight=Qm,a.validateStyle=qo,a.vectorTile=Jo,a.warnOnce=q,a.wrap=E}),c(["./shared"],function(a){function m(ie){const V=typeof ie;if(V==="number"||V==="boolean"||V==="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let de="[";for(const ye of ie)de+=`${m(ye)},`;return`${de}]`}const W=Object.keys(ie).sort();let ne="{";for(let de=0;de<W.length;de++)ne+=`${JSON.stringify(W[de])}:${m(ie[W[de]])},`;return`${ne}}`}function A(ie){let V="";for(const W of a.refProperties)V+=`/${m(ie[W])}`;return V}class x{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,W){for(const de of V){this._layerConfigs[de.id]=de;const ye=this._layers[de.id]=a.createStyleLayer(de);ye._featureFilter=a.createFilter(ye.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of W)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const ne=function(de,ye){const Ee={};for(let Z=0;Z<de.length;Z++){const se=ye&&ye[de[Z].id]||A(de[Z]);ye&&(ye[de[Z].id]=se);let ae=Ee[se];ae||(ae=Ee[se]=[]),ae.push(de[Z])}const N=[];for(const Z in Ee)N.push(Ee[Z]);return N}(Object.values(this._layerConfigs),this.keyCache);for(const de of ne){const ye=de.map(xe=>this._layers[xe.id]),Ee=ye[0];if(Ee.visibility==="none")continue;const N=Ee.source||"";let Z=this.familiesBySource[N];Z||(Z=this.familiesBySource[N]={});const se=Ee.sourceLayer||"_geojsonTileLayer";let ae=Z[se];ae||(ae=Z[se]=[]),ae.push(ye)}}}class b{constructor(V){const W={},ne=[];for(const N in V){const Z=V[N],se=W[N]={};for(const ae in Z){const xe=Z[+ae];if(!xe||xe.bitmap.width===0||xe.bitmap.height===0)continue;const De={x:0,y:0,w:xe.bitmap.width+2,h:xe.bitmap.height+2};ne.push(De),se[ae]={rect:De,metrics:xe.metrics}}}const{w:de,h:ye}=a.potpack(ne),Ee=new a.AlphaImage({width:de||1,height:ye||1});for(const N in V){const Z=V[N];for(const se in Z){const ae=Z[+se];if(!ae||ae.bitmap.width===0||ae.bitmap.height===0)continue;const xe=W[N][se].rect;a.AlphaImage.copy(ae.bitmap,Ee,{x:0,y:0},{x:xe.x+1,y:xe.y+1},ae.bitmap)}}this.image=Ee,this.positions=W}}a.register("GlyphAtlas",b);class I{constructor(V){this.tileID=new a.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId}parse(V,W,ne,de,ye){this.status="parsing",this.data=V,this.collisionBoxArray=new a.CollisionBoxArray;const Ee=new a.DictionaryCoder(Object.keys(V.layers).sort()),N=new a.FeatureIndex(this.tileID,this.promoteId);N.bucketLayerIDs=[];const Z={},se={featureIndex:N,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},ae=W.familiesBySource[this.source];for(const zt in ae){const si=V.layers[zt];if(!si)continue;si.version===1&&a.warnOnce(`Vector tile source "${this.source}" layer "${zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xi=Ee.encode(zt),Vi=[];for(let bi=0;bi<si.length;bi++){const ii=si.feature(bi),Is=N.getId(ii,zt);Vi.push({feature:ii,id:Is,index:bi,sourceLayerIndex:xi})}for(const bi of ae[zt]){const ii=bi[0];ii.source!==this.source&&a.warnOnce(`layer.source = ${ii.source} does not equal this.source = ${this.source}`),ii.minzoom&&this.zoom<Math.floor(ii.minzoom)||ii.maxzoom&&this.zoom>=ii.maxzoom||ii.visibility!=="none"&&(E(bi,this.zoom,ne),(Z[ii.id]=ii.createBucket({index:N.bucketLayerIDs.length,layers:bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xi,sourceID:this.source})).populate(Vi,se,this.tileID.canonical),N.bucketLayerIDs.push(bi.map(Is=>Is.id)))}}let xe,De,st,ht;const ot=a.mapObject(se.glyphDependencies,zt=>Object.keys(zt).map(Number));Object.keys(ot).length?de.send("getGlyphs",{uid:this.uid,stacks:ot,source:this.source,tileID:this.tileID,type:"glyphs"},(zt,si)=>{xe||(xe=zt,De=si,Ht.call(this))}):De={};const gt=Object.keys(se.iconDependencies);gt.length?de.send("getImages",{icons:gt,source:this.source,tileID:this.tileID,type:"icons"},(zt,si)=>{xe||(xe=zt,st=si,Ht.call(this))}):st={};const Tt=Object.keys(se.patternDependencies);function Ht(){if(xe)return ye(xe);if(De&&st&&ht){const zt=new b(De),si=new a.ImageAtlas(st,ht);for(const xi in Z){const Vi=Z[xi];Vi instanceof a.SymbolBucket?(E(Vi.layers,this.zoom,ne),a.performSymbolLayout({bucket:Vi,glyphMap:De,glyphPositions:zt.positions,imageMap:st,imagePositions:si.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vi.hasPattern&&(Vi instanceof a.LineBucket||Vi instanceof a.FillBucket||Vi instanceof a.FillExtrusionBucket)&&(E(Vi.layers,this.zoom,ne),Vi.addFeatures(se,this.tileID.canonical,si.patternPositions))}this.status="done",ye(null,{buckets:Object.values(Z).filter(xi=>!xi.isEmpty()),featureIndex:N,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zt.image,imageAtlas:si,glyphMap:this.returnDependencies?De:null,iconMap:this.returnDependencies?st:null,glyphPositions:this.returnDependencies?zt.positions:null})}}Tt.length?de.send("getImages",{icons:Tt,source:this.source,tileID:this.tileID,type:"patterns"},(zt,si)=>{xe||(xe=zt,ht=si,Ht.call(this))}):ht={},Ht.call(this)}}function E(ie,V,W){const ne=new a.EvaluationParameters(V);for(const de of ie)de.recalculate(ne,W)}function T(ie,V){const W=a.getArrayBuffer(ie.request,(ne,de,ye,Ee)=>{ne?V(ne):de&&V(null,{vectorTile:new a.vectorTile.VectorTile(new a.pbf(de)),rawData:de,cacheControl:ye,expires:Ee})});return()=>{W.cancel(),V()}}class U{constructor(V,W,ne,de){this.actor=V,this.layerIndex=W,this.availableImages=ne,this.loadVectorData=de||T,this.loading={},this.loaded={}}loadTile(V,W){const ne=V.uid;this.loading||(this.loading={});const de=!!(V&&V.request&&V.request.collectResourceTiming)&&new a.RequestPerformance(V.request),ye=this.loading[ne]=new I(V);ye.abort=this.loadVectorData(V,(Ee,N)=>{if(delete this.loading[ne],Ee||!N)return ye.status="done",this.loaded[ne]=ye,W(Ee);const Z=N.rawData,se={};N.expires&&(se.expires=N.expires),N.cacheControl&&(se.cacheControl=N.cacheControl);const ae={};if(de){const xe=de.finish();xe&&(ae.resourceTiming=JSON.parse(JSON.stringify(xe)))}ye.vectorTile=N.vectorTile,ye.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor,(xe,De)=>{if(xe||!De)return W(xe);W(null,a.extend({rawTileData:Z.slice(0)},De,se,ae))}),this.loaded=this.loaded||{},this.loaded[ne]=ye})}reloadTile(V,W){const ne=this.loaded,de=V.uid,ye=this;if(ne&&ne[de]){const Ee=ne[de];Ee.showCollisionBoxes=V.showCollisionBoxes;const N=(Z,se)=>{const ae=Ee.reloadCallback;ae&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,ye.layerIndex,this.availableImages,ye.actor,ae)),W(Z,se)};Ee.status==="parsing"?Ee.reloadCallback=N:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,N):N())}}abortTile(V,W){const ne=this.loading,de=V.uid;ne&&ne[de]&&ne[de].abort&&(ne[de].abort(),delete ne[de]),W()}removeTile(V,W){const ne=this.loaded,de=V.uid;ne&&ne[de]&&delete ne[de],W()}}class P{constructor(){this.loaded={}}loadTile(V,W){const{uid:ne,encoding:de,rawImageData:ye}=V,Ee=a.isImageBitmap(ye)?this.getImageData(ye):ye,N=new a.DEMData(ne,Ee,de);this.loaded=this.loaded||{},this.loaded[ne]=N,W(null,N)}getImageData(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const W=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:W.width,height:W.height},W.data)}removeTile(V){const W=this.loaded,ne=V.uid;W&&W[ne]&&delete W[ne]}}var R=function ie(V,W){var ne,de=V&&V.type;if(de==="FeatureCollection")for(ne=0;ne<V.features.length;ne++)ie(V.features[ne],W);else if(de==="GeometryCollection")for(ne=0;ne<V.geometries.length;ne++)ie(V.geometries[ne],W);else if(de==="Feature")ie(V.geometry,W);else if(de==="Polygon")X(V.coordinates,W);else if(de==="MultiPolygon")for(ne=0;ne<V.coordinates.length;ne++)X(V.coordinates[ne],W);return V};function X(ie,V){if(ie.length!==0){G(ie[0],V);for(var W=1;W<ie.length;W++)G(ie[W],!V)}}function G(ie,V){for(var W=0,ne=0,de=0,ye=ie.length,Ee=ye-1;de<ye;Ee=de++){var N=(ie[de][0]-ie[Ee][0])*(ie[Ee][1]+ie[de][1]),Z=W+N;ne+=Math.abs(W)>=Math.abs(N)?W-Z+N:N-Z+W,W=Z}W+ne>=0!=!!V&&ie.reverse()}const J=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;var q={},te={get exports(){return q},set exports(ie){q=ie}},ue=a.pointGeometry,_e=a.vectorTile.VectorTileFeature,K=ce;function ce(ie,V){this.options=V||{},this.features=ie,this.length=ie.length}function Ve(ie,V){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=V||4096}ce.prototype.feature=function(ie){return new Ve(this.features[ie],this.options.extent)},Ve.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var V=0;V<ie.length;V++){for(var W=ie[V],ne=[],de=0;de<W.length;de++)ne.push(new ue(W[de][0],W[de][1]));this.geometry.push(ne)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,V=1/0,W=-1/0,ne=1/0,de=-1/0,ye=0;ye<ie.length;ye++)for(var Ee=ie[ye],N=0;N<Ee.length;N++){var Z=Ee[N];V=Math.min(V,Z.x),W=Math.max(W,Z.x),ne=Math.min(ne,Z.y),de=Math.max(de,Z.y)}return[V,ne,W,de]},Ve.prototype.toGeoJSON=_e.prototype.toGeoJSON;var Ne=a.pbf,Me=K;function ve(ie){var V=new Ne;return function(W,ne){for(var de in W.layers)ne.writeMessage(3,ke,W.layers[de])}(ie,V),V.finish()}function ke(ie,V){var W;V.writeVarintField(15,ie.version||1),V.writeStringField(1,ie.name||""),V.writeVarintField(5,ie.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for(W=0;W<ie.length;W++)ne.feature=ie.feature(W),V.writeMessage(2,Re,ne);var de=ne.keys;for(W=0;W<de.length;W++)V.writeStringField(3,de[W]);var ye=ne.values;for(W=0;W<ye.length;W++)V.writeMessage(4,_t,ye[W])}function Re(ie,V){var W=ie.feature;W.id!==void 0&&V.writeVarintField(1,W.id),V.writeMessage(2,Fe,ie),V.writeVarintField(3,W.type),V.writeMessage(4,Je,W)}function Fe(ie,V){var W=ie.feature,ne=ie.keys,de=ie.values,ye=ie.keycache,Ee=ie.valuecache;for(var N in W.properties){var Z=W.properties[N],se=ye[N];if(Z!==null){se===void 0&&(ne.push(N),ye[N]=se=ne.length-1),V.writeVarint(se);var ae=typeof Z;ae!=="string"&&ae!=="boolean"&&ae!=="number"&&(Z=JSON.stringify(Z));var xe=ae+":"+Z,De=Ee[xe];De===void 0&&(de.push(Z),Ee[xe]=De=de.length-1),V.writeVarint(De)}}}function Oe(ie,V){return(V<<3)+(7&ie)}function je(ie){return ie<<1^ie>>31}function Je(ie,V){for(var W=ie.loadGeometry(),ne=ie.type,de=0,ye=0,Ee=W.length,N=0;N<Ee;N++){var Z=W[N],se=1;ne===1&&(se=Z.length),V.writeVarint(Oe(1,se));for(var ae=ne===3?Z.length-1:Z.length,xe=0;xe<ae;xe++){xe===1&&ne!==1&&V.writeVarint(Oe(2,ae-1));var De=Z[xe].x-de,st=Z[xe].y-ye;V.writeVarint(je(De)),V.writeVarint(je(st)),de+=De,ye+=st}ne===3&&V.writeVarint(Oe(7,1))}}function _t(ie,V){var W=typeof ie;W==="string"?V.writeStringField(1,ie):W==="boolean"?V.writeBooleanField(7,ie):W==="number"&&(ie%1!=0?V.writeDoubleField(3,ie):ie<0?V.writeSVarintField(6,ie):V.writeVarintField(5,ie))}te.exports=ve,q.fromVectorTileJs=ve,q.fromGeojsonVt=function(ie,V){V=V||{};var W={};for(var ne in ie)W[ne]=new Me(ie[ne].features,V),W[ne].name=ne,W[ne].version=V.version,W[ne].extent=V.extent;return ve({layers:W})},q.GeoJSONWrapper=Me;const yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},qe=Math.fround||(Ye=new Float32Array(1),ie=>(Ye[0]=+ie,Ye[0]));var Ye;class at{constructor(V){this.options=kt(Object.create(yt),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:W,minZoom:ne,maxZoom:de,nodeSize:ye}=this.options;W&&console.time("total time");const Ee=`prepare ${V.length} points`;W&&console.time(Ee),this.points=V;let N=[];for(let Z=0;Z<V.length;Z++)V[Z].geometry&&N.push(Te(V[Z],Z));this.trees[de+1]=new a.KDBush(N,Dt,Qi,ye,Float32Array),W&&console.timeEnd(Ee);for(let Z=de;Z>=ne;Z--){const se=+Date.now();N=this._cluster(N,Z),this.trees[Z]=new a.KDBush(N,Dt,Qi,ye,Float32Array),W&&console.log("z%d: %d clusters in %dms",Z,N.length,+Date.now()-se)}return W&&console.timeEnd("total time"),this}getClusters(V,W){let ne=((V[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,V[1]));let ye=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ne=-180,ye=180;else if(ne>ye){const ae=this.getClusters([ne,de,180,Ee],W),xe=this.getClusters([-180,de,ye,Ee],W);return ae.concat(xe)}const N=this.trees[this._limitZoom(W)],Z=N.range(be(ne),$e(Ee),be(ye),$e(de)),se=[];for(const ae of Z){const xe=N.points[ae];se.push(xe.numPoints?Kt(xe):this.points[xe.index])}return se}getChildren(V){const W=this._getOriginId(V),ne=this._getOriginZoom(V),de="No cluster with the specified id.",ye=this.trees[ne];if(!ye)throw new Error(de);const Ee=ye.points[W];if(!Ee)throw new Error(de);const N=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Z=ye.within(Ee.x,Ee.y,N),se=[];for(const ae of Z){const xe=ye.points[ae];xe.parentId===V&&se.push(xe.numPoints?Kt(xe):this.points[xe.index])}if(se.length===0)throw new Error(de);return se}getLeaves(V,W,ne){const de=[];return this._appendLeaves(de,V,W=W||10,ne=ne||0,0),de}getTile(V,W,ne){const de=this.trees[this._limitZoom(V)],ye=Math.pow(2,V),{extent:Ee,radius:N}=this.options,Z=N/Ee,se=(ne-Z)/ye,ae=(ne+1+Z)/ye,xe={features:[]};return this._addTileFeatures(de.range((W-Z)/ye,se,(W+1+Z)/ye,ae),de.points,W,ne,ye,xe),W===0&&this._addTileFeatures(de.range(1-Z/ye,se,1,ae),de.points,ye,ne,ye,xe),W===ye-1&&this._addTileFeatures(de.range(0,se,Z/ye,ae),de.points,-1,ne,ye,xe),xe.features.length?xe:null}getClusterExpansionZoom(V){let W=this._getOriginZoom(V)-1;for(;W<=this.options.maxZoom;){const ne=this.getChildren(V);if(W++,ne.length!==1)break;V=ne[0].properties.cluster_id}return W}_appendLeaves(V,W,ne,de,ye){const Ee=this.getChildren(W);for(const N of Ee){const Z=N.properties;if(Z&&Z.cluster?ye+Z.point_count<=de?ye+=Z.point_count:ye=this._appendLeaves(V,Z.cluster_id,ne,de,ye):ye<de?ye++:V.push(N),V.length===ne)break}return ye}_addTileFeatures(V,W,ne,de,ye,Ee){for(const N of V){const Z=W[N],se=Z.numPoints;let ae,xe,De;if(se)ae=Zt(Z),xe=Z.x,De=Z.y;else{const ot=this.points[Z.index];ae=ot.properties,xe=be(ot.geometry.coordinates[0]),De=$e(ot.geometry.coordinates[1])}const st={type:1,geometry:[[Math.round(this.options.extent*(xe*ye-ne)),Math.round(this.options.extent*(De*ye-de))]],tags:ae};let ht;se?ht=Z.id:this.options.generateId?ht=Z.index:this.points[Z.index].id&&(ht=this.points[Z.index].id),ht!==void 0&&(st.id=ht),Ee.features.push(st)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,W){const ne=[],{radius:de,extent:ye,reduce:Ee,minPoints:N}=this.options,Z=de/(ye*Math.pow(2,W));for(let se=0;se<V.length;se++){const ae=V[se];if(ae.zoom<=W)continue;ae.zoom=W;const xe=this.trees[W+1],De=xe.within(ae.x,ae.y,Z),st=ae.numPoints||1;let ht=st;for(const ot of De){const gt=xe.points[ot];gt.zoom>W&&(ht+=gt.numPoints||1)}if(ht>st&&ht>=N){let ot=ae.x*st,gt=ae.y*st,Tt=Ee&&st>1?this._map(ae,!0):null;const Ht=(se<<5)+(W+1)+this.points.length;for(const zt of De){const si=xe.points[zt];if(si.zoom<=W)continue;si.zoom=W;const xi=si.numPoints||1;ot+=si.x*xi,gt+=si.y*xi,si.parentId=Ht,Ee&&(Tt||(Tt=this._map(ae,!0)),Ee(Tt,this._map(si)))}ae.parentId=Ht,ne.push(St(ot/ht,gt/ht,Ht,ht,Tt))}else if(ne.push(ae),ht>1)for(const ot of De){const gt=xe.points[ot];gt.zoom<=W||(gt.zoom=W,ne.push(gt))}}return ne}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,W){if(V.numPoints)return W?kt({},V.properties):V.properties;const ne=this.points[V.index].properties,de=this.options.map(ne);return W&&de===ne?kt({},de):de}}function St(ie,V,W,ne,de){return{x:qe(ie),y:qe(V),zoom:1/0,id:W,parentId:-1,numPoints:ne,properties:de}}function Te(ie,V){const[W,ne]=ie.geometry.coordinates;return{x:qe(be(W)),y:qe($e(ne)),zoom:1/0,index:V,parentId:-1}}function Kt(ie){return{type:"Feature",id:ie.id,properties:Zt(ie),geometry:{type:"Point",coordinates:[(V=ie.x,360*(V-.5)),fi(ie.y)]}};var V}function Zt(ie){const V=ie.numPoints,W=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return kt(kt({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:V,point_count_abbreviated:W})}function be(ie){return ie/360+.5}function $e(ie){const V=Math.sin(ie*Math.PI/180),W=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return W<0?0:W>1?1:W}function fi(ie){const V=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function kt(ie,V){for(const W in V)ie[W]=V[W];return ie}function Dt(ie){return ie.x}function Qi(ie){return ie.y}function Bi(ie,V,W,ne){for(var de,ye=ne,Ee=W-V>>1,N=W-V,Z=ie[V],se=ie[V+1],ae=ie[W],xe=ie[W+1],De=V+3;De<W;De+=3){var st=Ji(ie[De],ie[De+1],Z,se,ae,xe);if(st>ye)de=De,ye=st;else if(st===ye){var ht=Math.abs(De-Ee);ht<N&&(de=De,N=ht)}}ye>ne&&(de-V>3&&Bi(ie,V,de,ne),ie[de+2]=ye,W-de>3&&Bi(ie,de,W,ne))}function Ji(ie,V,W,ne,de,ye){var Ee=de-W,N=ye-ne;if(Ee!==0||N!==0){var Z=((ie-W)*Ee+(V-ne)*N)/(Ee*Ee+N*N);Z>1?(W=de,ne=ye):Z>0&&(W+=Ee*Z,ne+=N*Z)}return(Ee=ie-W)*Ee+(N=V-ne)*N}function Ni(ie,V,W,ne){var de={id:ie===void 0?null:ie,type:V,geometry:W,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Ee=ye.geometry,N=ye.type;if(N==="Point"||N==="MultiPoint"||N==="LineString")nt(ye,Ee);else if(N==="Polygon"||N==="MultiLineString")for(var Z=0;Z<Ee.length;Z++)nt(ye,Ee[Z]);else if(N==="MultiPolygon")for(Z=0;Z<Ee.length;Z++)for(var se=0;se<Ee[Z].length;se++)nt(ye,Ee[Z][se])}(de),de}function nt(ie,V){for(var W=0;W<V.length;W+=3)ie.minX=Math.min(ie.minX,V[W]),ie.minY=Math.min(ie.minY,V[W+1]),ie.maxX=Math.max(ie.maxX,V[W]),ie.maxY=Math.max(ie.maxY,V[W+1])}function Ot(ie,V,W,ne){if(V.geometry){var de=V.geometry.coordinates,ye=V.geometry.type,Ee=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),N=[],Z=V.id;if(W.promoteId?Z=V.properties[W.promoteId]:W.generateId&&(Z=ne||0),ye==="Point")$t(de,N);else if(ye==="MultiPoint")for(var se=0;se<de.length;se++)$t(de[se],N);else if(ye==="LineString")pe(de,N,Ee,!1);else if(ye==="MultiLineString"){if(W.lineMetrics){for(se=0;se<de.length;se++)pe(de[se],N=[],Ee,!1),ie.push(Ni(Z,"LineString",N,V.properties));return}oe(de,N,Ee,!1)}else if(ye==="Polygon")oe(de,N,Ee,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(se=0;se<V.geometry.geometries.length;se++)Ot(ie,{id:Z,geometry:V.geometry.geometries[se],properties:V.properties},W,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<de.length;se++){var ae=[];oe(de[se],ae,Ee,!0),N.push(ae)}}ie.push(Ni(Z,ye,N,V.properties))}}function $t(ie,V){V.push(Ue(ie[0])),V.push(pt(ie[1])),V.push(0)}function pe(ie,V,W,ne){for(var de,ye,Ee=0,N=0;N<ie.length;N++){var Z=Ue(ie[N][0]),se=pt(ie[N][1]);V.push(Z),V.push(se),V.push(0),N>0&&(Ee+=ne?(de*se-Z*ye)/2:Math.sqrt(Math.pow(Z-de,2)+Math.pow(se-ye,2))),de=Z,ye=se}var ae=V.length-3;V[2]=1,Bi(V,0,ae,W),V[ae+2]=1,V.size=Math.abs(Ee),V.start=0,V.end=V.size}function oe(ie,V,W,ne){for(var de=0;de<ie.length;de++){var ye=[];pe(ie[de],ye,W,ne),V.push(ye)}}function Ue(ie){return ie/360+.5}function pt(ie){var V=Math.sin(ie*Math.PI/180),W=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return W<0?0:W>1?1:W}function ct(ie,V,W,ne,de,ye,Ee,N){if(ne/=V,ye>=(W/=V)&&Ee<ne)return ie;if(Ee<W||ye>=ne)return null;for(var Z=[],se=0;se<ie.length;se++){var ae=ie[se],xe=ae.geometry,De=ae.type,st=de===0?ae.minX:ae.minY,ht=de===0?ae.maxX:ae.maxY;if(st>=W&&ht<ne)Z.push(ae);else if(!(ht<W||st>=ne)){var ot=[];if(De==="Point"||De==="MultiPoint")It(xe,ot,W,ne,de);else if(De==="LineString")Xt(xe,ot,W,ne,de,!1,N.lineMetrics);else if(De==="MultiLineString")He(xe,ot,W,ne,de,!1);else if(De==="Polygon")He(xe,ot,W,ne,de,!0);else if(De==="MultiPolygon")for(var gt=0;gt<xe.length;gt++){var Tt=[];He(xe[gt],Tt,W,ne,de,!0),Tt.length&&ot.push(Tt)}if(ot.length){if(N.lineMetrics&&De==="LineString"){for(gt=0;gt<ot.length;gt++)Z.push(Ni(ae.id,De,ot[gt],ae.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(ot.length===1?(De="LineString",ot=ot[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=ot.length===3?"Point":"MultiPoint"),Z.push(Ni(ae.id,De,ot,ae.tags))}}}return Z.length?Z:null}function It(ie,V,W,ne,de){for(var ye=0;ye<ie.length;ye+=3){var Ee=ie[ye+de];Ee>=W&&Ee<=ne&&(V.push(ie[ye]),V.push(ie[ye+1]),V.push(ie[ye+2]))}}function Xt(ie,V,W,ne,de,ye,Ee){for(var N,Z,se=Ct(ie),ae=de===0?Yt:ei,xe=ie.start,De=0;De<ie.length-3;De+=3){var st=ie[De],ht=ie[De+1],ot=ie[De+2],gt=ie[De+3],Tt=ie[De+4],Ht=de===0?st:ht,zt=de===0?gt:Tt,si=!1;Ee&&(N=Math.sqrt(Math.pow(st-gt,2)+Math.pow(ht-Tt,2))),Ht<W?zt>W&&(Z=ae(se,st,ht,gt,Tt,W),Ee&&(se.start=xe+N*Z)):Ht>ne?zt<ne&&(Z=ae(se,st,ht,gt,Tt,ne),Ee&&(se.start=xe+N*Z)):qt(se,st,ht,ot),zt<W&&Ht>=W&&(Z=ae(se,st,ht,gt,Tt,W),si=!0),zt>ne&&Ht<=ne&&(Z=ae(se,st,ht,gt,Tt,ne),si=!0),!ye&&si&&(Ee&&(se.end=xe+N*Z),V.push(se),se=Ct(ie)),Ee&&(xe+=N)}var xi=ie.length-3;st=ie[xi],ht=ie[xi+1],ot=ie[xi+2],(Ht=de===0?st:ht)>=W&&Ht<=ne&&qt(se,st,ht,ot),xi=se.length-3,ye&&xi>=3&&(se[xi]!==se[0]||se[xi+1]!==se[1])&&qt(se,se[0],se[1],se[2]),se.length&&V.push(se)}function Ct(ie){var V=[];return V.size=ie.size,V.start=ie.start,V.end=ie.end,V}function He(ie,V,W,ne,de,ye){for(var Ee=0;Ee<ie.length;Ee++)Xt(ie[Ee],V,W,ne,de,ye,!1)}function qt(ie,V,W,ne){ie.push(V),ie.push(W),ie.push(ne)}function Yt(ie,V,W,ne,de,ye){var Ee=(ye-V)/(ne-V);return ie.push(ye),ie.push(W+(de-W)*Ee),ie.push(1),Ee}function ei(ie,V,W,ne,de,ye){var Ee=(ye-W)/(de-W);return ie.push(V+(ne-V)*Ee),ie.push(ye),ie.push(1),Ee}function ft(ie,V){for(var W=[],ne=0;ne<ie.length;ne++){var de,ye=ie[ne],Ee=ye.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")de=Wt(ye.geometry,V);else if(Ee==="MultiLineString"||Ee==="Polygon"){de=[];for(var N=0;N<ye.geometry.length;N++)de.push(Wt(ye.geometry[N],V))}else if(Ee==="MultiPolygon")for(de=[],N=0;N<ye.geometry.length;N++){for(var Z=[],se=0;se<ye.geometry[N].length;se++)Z.push(Wt(ye.geometry[N][se],V));de.push(Z)}W.push(Ni(ye.id,Ee,de,ye.tags))}return W}function Wt(ie,V){var W=[];W.size=ie.size,ie.start!==void 0&&(W.start=ie.start,W.end=ie.end);for(var ne=0;ne<ie.length;ne+=3)W.push(ie[ne]+V,ie[ne+1],ie[ne+2]);return W}function mi(ie,V){if(ie.transformed)return ie;var W,ne,de,ye=1<<ie.z,Ee=ie.x,N=ie.y;for(W=0;W<ie.features.length;W++){var Z=ie.features[W],se=Z.geometry,ae=Z.type;if(Z.geometry=[],ae===1)for(ne=0;ne<se.length;ne+=2)Z.geometry.push(Ii(se[ne],se[ne+1],V,ye,Ee,N));else for(ne=0;ne<se.length;ne++){var xe=[];for(de=0;de<se[ne].length;de+=2)xe.push(Ii(se[ne][de],se[ne][de+1],V,ye,Ee,N));Z.geometry.push(xe)}}return ie.transformed=!0,ie}function Ii(ie,V,W,ne,de,ye){return[Math.round(W*(ie*ne-de)),Math.round(W*(V*ne-ye))]}function Ki(ie,V,W,ne,de){for(var ye=V===de.maxZoom?0:de.tolerance/((1<<V)*de.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:W,y:ne,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},N=0;N<ie.length;N++){Ee.numFeatures++,Se(Ee,ie[N],ye,de);var Z=ie[N].minX,se=ie[N].minY,ae=ie[N].maxX,xe=ie[N].maxY;Z<Ee.minX&&(Ee.minX=Z),se<Ee.minY&&(Ee.minY=se),ae>Ee.maxX&&(Ee.maxX=ae),xe>Ee.maxY&&(Ee.maxY=xe)}return Ee}function Se(ie,V,W,ne){var de=V.geometry,ye=V.type,Ee=[];if(ye==="Point"||ye==="MultiPoint")for(var N=0;N<de.length;N+=3)Ee.push(de[N]),Ee.push(de[N+1]),ie.numPoints++,ie.numSimplified++;else if(ye==="LineString")Xe(Ee,de,ie,W,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(N=0;N<de.length;N++)Xe(Ee,de[N],ie,W,ye==="Polygon",N===0);else if(ye==="MultiPolygon")for(var Z=0;Z<de.length;Z++){var se=de[Z];for(N=0;N<se.length;N++)Xe(Ee,se[N],ie,W,!0,N===0)}if(Ee.length){var ae=V.tags||null;if(ye==="LineString"&&ne.lineMetrics){for(var xe in ae={},V.tags)ae[xe]=V.tags[xe];ae.mapbox_clip_start=de.start/de.size,ae.mapbox_clip_end=de.end/de.size}var De={geometry:Ee,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:ae};V.id!==null&&(De.id=V.id),ie.features.push(De)}}function Xe(ie,V,W,ne,de,ye){var Ee=ne*ne;if(ne>0&&V.size<(de?Ee:ne))W.numPoints+=V.length/3;else{for(var N=[],Z=0;Z<V.length;Z+=3)(ne===0||V[Z+2]>Ee)&&(W.numSimplified++,N.push(V[Z]),N.push(V[Z+1])),W.numPoints++;de&&function(se,ae){for(var xe=0,De=0,st=se.length,ht=st-2;De<st;ht=De,De+=2)xe+=(se[De]-se[ht])*(se[De+1]+se[ht+1]);if(xe>0===ae)for(De=0,st=se.length;De<st/2;De+=2){var ot=se[De],gt=se[De+1];se[De]=se[st-2-De],se[De+1]=se[st-1-De],se[st-2-De]=ot,se[st-1-De]=gt}}(N,ye),ie.push(N)}}function Ke(ie,V){var W=(V=this.options=function(de,ye){for(var Ee in ye)de[Ee]=ye[Ee];return de}(Object.create(this.options),V)).debug;if(W&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ne=function(de,ye){var Ee=[];if(de.type==="FeatureCollection")for(var N=0;N<de.features.length;N++)Ot(Ee,de.features[N],ye,N);else Ot(Ee,de.type==="Feature"?de:{geometry:de},ye);return Ee}(ie,V);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=function(de,ye){var Ee=ye.buffer/ye.extent,N=de,Z=ct(de,1,-1-Ee,Ee,0,-1,2,ye),se=ct(de,1,1-Ee,2+Ee,0,-1,2,ye);return(Z||se)&&(N=ct(de,1,-Ee,1+Ee,0,-1,2,ye)||[],Z&&(N=ft(Z,1).concat(N)),se&&(N=N.concat(ft(se,-1)))),N}(ne,V),ne.length&&this.splitTile(ne,0,0,0),W&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Rt(ie,V,W){return 32*((1<<ie)*W+V)+ie}function Nt(ie,V){return V?ie.properties[V]:ie.id}function ci(ie,V){if(ie==null)return!0;if(ie.type==="Feature")return Nt(ie,V)!=null;if(ie.type==="FeatureCollection"){const W=new Set;for(const ne of ie.features){const de=Nt(ne,V);if(de==null||W.has(de))return!1;W.add(de)}return!0}return!1}function li(ie,V){const W=new Map;if(ie!=null)if(ie.type==="Feature")W.set(Nt(ie,V),ie);else for(const ne of ie.features)W.set(Nt(ne,V),ne);return W}function ki(ie,V){const W=ie.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const ne=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ne)return V(null,null);const de=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(N){this._feature=N,this.extent=a.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const Z of this._feature.geometry)N.push([new a.pointGeometry(Z[0],Z[1])]);return N}{const N=[];for(const Z of this._feature.geometry){const se=[];for(const ae of Z)se.push(new a.pointGeometry(ae[0],ae[1]));N.push(se)}return N}}toGeoJSON(N,Z,se){return J.call(this,N,Z,se)}}(this._features[Ee])}}(ne.features);let ye=q(de);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),V(null,{vectorTile:de,rawData:ye.buffer})}Ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ke.prototype.splitTile=function(ie,V,W,ne,de,ye,Ee){for(var N=[ie,V,W,ne],Z=this.options,se=Z.debug;N.length;){ne=N.pop(),W=N.pop(),V=N.pop(),ie=N.pop();var ae=1<<V,xe=Rt(V,W,ne),De=this.tiles[xe];if(!De&&(se>1&&console.time("creation"),De=this.tiles[xe]=Ki(ie,V,W,ne,Z),this.tileCoords.push({z:V,x:W,y:ne}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,W,ne,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));var st="z"+V;this.stats[st]=(this.stats[st]||0)+1,this.total++}if(De.source=ie,de){if(V===Z.maxZoom||V===de)continue;var ht=1<<de-V;if(W!==Math.floor(ye/ht)||ne!==Math.floor(Ee/ht))continue}else if(V===Z.indexMaxZoom||De.numPoints<=Z.indexMaxPoints)continue;if(De.source=null,ie.length!==0){se>1&&console.time("clipping");var ot,gt,Tt,Ht,zt,si,xi=.5*Z.buffer/Z.extent,Vi=.5-xi,bi=.5+xi,ii=1+xi;ot=gt=Tt=Ht=null,zt=ct(ie,ae,W-xi,W+bi,0,De.minX,De.maxX,Z),si=ct(ie,ae,W+Vi,W+ii,0,De.minX,De.maxX,Z),ie=null,zt&&(ot=ct(zt,ae,ne-xi,ne+bi,1,De.minY,De.maxY,Z),gt=ct(zt,ae,ne+Vi,ne+ii,1,De.minY,De.maxY,Z),zt=null),si&&(Tt=ct(si,ae,ne-xi,ne+bi,1,De.minY,De.maxY,Z),Ht=ct(si,ae,ne+Vi,ne+ii,1,De.minY,De.maxY,Z),si=null),se>1&&console.timeEnd("clipping"),N.push(ot||[],V+1,2*W,2*ne),N.push(gt||[],V+1,2*W,2*ne+1),N.push(Tt||[],V+1,2*W+1,2*ne),N.push(Ht||[],V+1,2*W+1,2*ne+1)}}},Ke.prototype.getTile=function(ie,V,W){var ne=this.options,de=ne.extent,ye=ne.debug;if(ie<0||ie>24)return null;var Ee=1<<ie,N=Rt(ie,V=(V%Ee+Ee)%Ee,W);if(this.tiles[N])return mi(this.tiles[N],de);ye>1&&console.log("drilling down to z%d-%d-%d",ie,V,W);for(var Z,se=ie,ae=V,xe=W;!Z&&se>0;)se--,ae=Math.floor(ae/2),xe=Math.floor(xe/2),Z=this.tiles[Rt(se,ae,xe)];return Z&&Z.source?(ye>1&&console.log("found parent tile z%d-%d-%d",se,ae,xe),ye>1&&console.time("drilling down"),this.splitTile(Z.source,se,ae,xe,ie,V,W),ye>1&&console.timeEnd("drilling down"),this.tiles[N]?mi(this.tiles[N],de):null):null};class hn extends U{constructor(V,W,ne,de){super(V,W,ne,ki),this._dataUpdateable=new Map,this.loadGeoJSON=(ye,Ee)=>{const{promoteId:N}=ye;if(ye.request)return a.getJSON(ye.request,(Z,se,ae,xe)=>{this._dataUpdateable=ci(se,N)?li(se,N):void 0,Ee(Z,se,ae,xe)});if(typeof ye.data=="string")try{const Z=JSON.parse(ye.data);this._dataUpdateable=ci(Z,N)?li(Z,N):void 0,Ee(null,Z)}catch{Ee(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`))}else ye.dataDiff?this._dataUpdateable?(function(Z,se,ae){var xe,De,st,ht;if(se.removeAll&&Z.clear(),se.remove)for(const ot of se.remove)Z.delete(ot);if(se.add)for(const ot of se.add){const gt=Nt(ot,ae);gt!=null&&Z.set(gt,ot)}if(se.update)for(const ot of se.update){let gt=Z.get(ot.id);if(gt==null)continue;const Tt=!ot.removeAllProperties&&(((xe=ot.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((De=ot.addOrUpdateProperties)===null||De===void 0?void 0:De.length)>0);if((ot.newGeometry||ot.removeAllProperties||Tt)&&(gt={...gt},Z.set(ot.id,gt),Tt&&(gt.properties={...gt.properties})),ot.newGeometry&&(gt.geometry=ot.newGeometry),ot.removeAllProperties)gt.properties={};else if(((st=ot.removeProperties)===null||st===void 0?void 0:st.length)>0)for(const Ht of ot.removeProperties)Object.prototype.hasOwnProperty.call(gt.properties,Ht)&&delete gt.properties[Ht];if(((ht=ot.addOrUpdateProperties)===null||ht===void 0?void 0:ht.length)>0)for(const{key:Ht,value:zt}of ot.addOrUpdateProperties)gt.properties[Ht]=zt}}(this._dataUpdateable,ye.dataDiff,N),Ee(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):Ee(new Error(`Cannot update existing geojson data in ${ye.source}`)):Ee(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},de&&(this.loadGeoJSON=de)}loadData(V,W){var ne;(ne=this._pendingRequest)===null||ne===void 0||ne.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const de=!!(V&&V.request&&V.request.collectResourceTiming)&&new a.RequestPerformance(V.request);this._pendingCallback=W,this._pendingRequest=this.loadGeoJSON(V,(ye,Ee)=>{if(delete this._pendingCallback,delete this._pendingRequest,ye||!Ee)return W(ye);if(typeof Ee!="object")return W(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{R(Ee,!0);try{if(V.filter){const Z=a.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(ae=>`${ae.key}: ${ae.message}`).join(", "));const se=Ee.features.filter(ae=>Z.value.evaluate({zoom:0},ae));Ee={type:"FeatureCollection",features:se}}this._geoJSONIndex=V.cluster?new at(function({superclusterOptions:Z,clusterProperties:se}){if(!se||!Z)return Z;const ae={},xe={},De={accumulated:null,zoom:0},st={properties:null},ht=Object.keys(se);for(const ot of ht){const[gt,Tt]=se[ot],Ht=a.createExpression(Tt),zt=a.createExpression(typeof gt=="string"?[gt,["accumulated"],["get",ot]]:gt);ae[ot]=Ht.value,xe[ot]=zt.value}return Z.map=ot=>{st.properties=ot;const gt={};for(const Tt of ht)gt[Tt]=ae[Tt].evaluate(De,st);return gt},Z.reduce=(ot,gt)=>{st.properties=gt;for(const Tt of ht)De.accumulated=ot[Tt],ot[Tt]=xe[Tt].evaluate(De,st)},Z}(V)).load(Ee.features):function(Z,se){return new Ke(Z,se)}(Ee,V.geojsonVtOptions)}catch(Z){return W(Z)}this.loaded={};const N={};if(de){const Z=de.finish();Z&&(N.resourceTiming={},N.resourceTiming[V.source]=JSON.parse(JSON.stringify(Z)))}W(null,N)}})}reloadTile(V,W){const ne=this.loaded;return ne&&ne[V.uid]?super.reloadTile(V,W):this.loadTile(V,W)}removeSource(V,W){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),W()}getClusterExpansionZoom(V,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ne){W(ne)}}getClusterChildren(V,W){try{W(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ne){W(ne)}}getClusterLeaves(V,W){try{W(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ne){W(ne)}}}class Oi{constructor(V){this.self=V,this.actor=new a.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:U,geojson:hn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(W,ne)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=ne},this.self.registerRTLTextPlugin=W=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=W.applyArabicShaping,a.plugin.processBidirectionalText=W.processBidirectionalText,a.plugin.processStyledBidirectionalText=W.processStyledBidirectionalText}}setReferrer(V,W){this.referrer=W}setImages(V,W,ne){this.availableImages[V]=W;for(const de in this.workerSources[V]){const ye=this.workerSources[V][de];for(const Ee in ye)ye[Ee].availableImages=W}ne()}setLayers(V,W,ne){this.getLayerIndex(V).replace(W),ne()}updateLayers(V,W,ne){this.getLayerIndex(V).update(W.layers,W.removedIds),ne()}loadTile(V,W,ne){this.getWorkerSource(V,W.type,W.source).loadTile(W,ne)}loadDEMTile(V,W,ne){this.getDEMWorkerSource(V,W.source).loadTile(W,ne)}reloadTile(V,W,ne){this.getWorkerSource(V,W.type,W.source).reloadTile(W,ne)}abortTile(V,W,ne){this.getWorkerSource(V,W.type,W.source).abortTile(W,ne)}removeTile(V,W,ne){this.getWorkerSource(V,W.type,W.source).removeTile(W,ne)}removeDEMTile(V,W){this.getDEMWorkerSource(V,W.source).removeTile(W)}removeSource(V,W,ne){if(!this.workerSources[V]||!this.workerSources[V][W.type]||!this.workerSources[V][W.type][W.source])return;const de=this.workerSources[V][W.type][W.source];delete this.workerSources[V][W.type][W.source],de.removeSource!==void 0?de.removeSource(W,ne):ne()}loadWorkerSource(V,W,ne){try{this.self.importScripts(W.url),ne()}catch(de){ne(de.toString())}}syncRTLPluginState(V,W,ne){try{a.plugin.setState(W);const de=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&de!=null){this.self.importScripts(de);const ye=a.plugin.isParsed();ne(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),ye)}}catch(de){ne(de.toString())}}getAvailableImages(V){let W=this.availableImages[V];return W||(W=[]),W}getLayerIndex(V){let W=this.layerIndexes[V];return W||(W=this.layerIndexes[V]=new x),W}getWorkerSource(V,W,ne){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][W]||(this.workerSources[V][W]={}),!this.workerSources[V][W][ne]){const de={send:(ye,Ee,N)=>{this.actor.send(ye,Ee,N,V)}};this.workerSources[V][W][ne]=new this.workerSourceTypes[W](de,this.getLayerIndex(V),this.getAvailableImages(V))}return this.workerSources[V][W][ne]}getDEMWorkerSource(V,W){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][W]||(this.demWorkerSources[V][W]=new P),this.demWorkerSources[V][W]}}return a.isWorker()&&(self.worker=new Oi(self)),Oi}),c(["./shared"],function(a){var m=A;function A(g){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,w=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(w);try{_=new Worker(C),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(C),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var w=_.getImageData(0,0,1,1);return w&&w.width===f.width}()?(x[d=r&&r.failIfMajorPerformanceCaveat]===void 0&&(x[d]=function(f){var _,w=function(C){var B=document.createElement("canvas"),D=Object.create(A.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=C,B.getContext("webgl",D)||B.getContext("experimental-webgl",D)}(f);if(!w)return!1;try{_=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!_||w.isContextLost())&&(w.shaderSource(_,"void main() {}"),w.compileShader(_),w.getShaderParameter(_,w.COMPILE_STATUS)===!0)}(d)),x[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(g)}var x={};A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var b="3.0.0-pre.4";function I(g,r){if(Array.isArray(g)){if(!Array.isArray(r)||g.length!==r.length)return!1;for(let d=0;d<g.length;d++)if(!I(g[d],r[d]))return!1;return!0}if(typeof g=="object"&&g!==null&&r!==null){if(typeof r!="object"||Object.keys(g).length!==Object.keys(r).length)return!1;for(const d in g)if(!I(g[d],r[d]))return!1;return!0}return g===r}class E{static testProp(r){if(!E.docStyle)return r[0];for(let d=0;d<r.length;d++)if(r[d]in E.docStyle)return r[d];return r[0]}static create(r,d,f){const _=window.document.createElement(r);return d!==void 0&&(_.className=d),f&&f.appendChild(_),_}static createNS(r,d){return window.document.createElementNS(r,d)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(r,d){r.style[E.transformProp]=d}static addEventListener(r,d,f,_={}){r.addEventListener(d,f,"passive"in _?_:_.capture)}static removeEventListener(r,d,f,_={}){r.removeEventListener(d,f,"passive"in _?_:_.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static mousePos(r,d){const f=r.getBoundingClientRect();return new a.pointGeometry(d.clientX-f.left-r.clientLeft,d.clientY-f.top-r.clientTop)}static touchPos(r,d){const f=r.getBoundingClientRect(),_=[];for(let w=0;w<d.length;w++)_.push(new a.pointGeometry(d[w].clientX-f.left-r.clientLeft,d[w].clientY-f.top-r.clientTop));return _}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(g){!R&&P&&(X?G(g):U=g)}};let U,P,R=!1,X=!1;function G(g){const r=g.createTexture();g.bindTexture(g.TEXTURE_2D,r);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,P),g.isContextLost())return;T.supported=!0}catch{}g.deleteTexture(r),R=!0}var J;typeof document<"u"&&(P=document.createElement("img"),P.onload=function(){U&&G(U),U=null,X=!0},P.onerror=function(){R=!0,U=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(g){let r,d,f,_;g.resetRequestQueue=()=>{r=[],d=0,f=0,_={}},g.addThrottleControl=B=>{const D=f++;return _[D]=B,D},g.removeThrottleControl=B=>{delete _[B]};const w=()=>{const B=Object.keys(_);let D=!1;if(B.length>0){for(const F of B)if(D=_[F](),D)break}return D};g.getImage=(B,D)=>{T.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*");const F={requestParameters:B,callback:D,cancelled:!1,completed:!1,cancel:()=>{}};return r.push(F),w()||g.processQueue(),F};const C=B=>{const{requestParameters:D,callback:F}=B;return a.getArrayBuffer(D,(Q,z,$,le)=>{Q?F(Q):z&&((he,re)=>{typeof createImageBitmap=="function"?a.arrayBufferToImageBitmap(he,re):a.arrayBufferToImage(he,re)})(z,(he,re)=>{he!=null?F(he):re!=null&&F(null,re,{cacheControl:$,expires:le})}),B.cancelled||(B.completed=!0,d--,w()||g.processQueue())})};g.processQueue=(B=0)=>{B<=0&&(B=w()?a.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.config.MAX_PARALLEL_IMAGE_REQUESTS);for(let D=d;D<B&&r.length>0;D++){const F=r.shift();if(F.cancelled)continue;const Q=C(F);d++,F.innerRequest=Q,F.cancel=()=>{var z;(z=F).completed||z.cancelled||(d--,z.cancelled=!0,z.innerRequest.cancel(),g.processQueue())}}return r.length}}(J||(J={})),J.resetRequestQueue();var q,te=J;(function(g){g.Glyphs="Glyphs",g.Image="Image",g.Source="Source",g.SpriteImage="SpriteImage",g.SpriteJSON="SpriteJSON",g.Style="Style",g.Tile="Tile",g.Unknown="Unknown"})(q||(q={}));class ue{constructor(r){this._transformRequestFn=r}transformRequest(r,d){return this._transformRequestFn&&this._transformRequestFn(r,d)||{url:r}}normalizeSpriteURL(r,d,f){const _=function(w){const C=w.match(_e);if(!C)throw new Error(`Unable to parse URL "${w}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(r);return _.path+=`${d}${f}`,function(w){const C=w.params.length?`?${w.params.join("&")}`:"";return`${w.protocol}://${w.authority}${w.path}${C}`}(_)}setTransformRequest(r){this._transformRequestFn=r}}const _e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(g){var r=new a.ARRAY_TYPE(3);return r[0]=g[0],r[1]=g[1],r[2]=g[2],r}var ce,Ve=function(g,r,d){return g[0]=r[0]-d[0],g[1]=r[1]-d[1],g[2]=r[2]-d[2],g};ce=new a.ARRAY_TYPE(3),a.ARRAY_TYPE!=Float32Array&&(ce[0]=0,ce[1]=0,ce[2]=0);var Ne=function(g){var r=g[0],d=g[1];return r*r+d*d};function Me(g){return typeof g=="string"?[{id:"default",url:g}]:g??[]}(function(){var g=new a.ARRAY_TYPE(2);a.ARRAY_TYPE!=Float32Array&&(g[0]=0,g[1]=0)})();class ve{constructor(r,d,f,_){this.context=r,this.format=f,this.texture=r.gl.createTexture(),this.update(d,_)}update(r,d,f){const{width:_,height:w}=r,C=!(this.size&&this.size[0]===_&&this.size[1]===w||f),{context:B}=this,{gl:D}=B;if(this.useMipmap=Boolean(d&&d.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!d||d.premultiply!==!1)),C)this.size=[_,w],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.isImageBitmap(r)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,r):D.texImage2D(D.TEXTURE_2D,0,this.format,_,w,0,this.format,D.UNSIGNED_BYTE,r.data);else{const{x:F,y:Q}=f||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.isImageBitmap(r)?D.texSubImage2D(D.TEXTURE_2D,0,F,Q,D.RGBA,D.UNSIGNED_BYTE,r):D.texSubImage2D(D.TEXTURE_2D,0,F,Q,_,w,D.RGBA,D.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(r,d,f){const{context:_}=this,{gl:w}=_;w.bindTexture(w.TEXTURE_2D,this.texture),f!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=w.LINEAR),r!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,r),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,f||r),this.filter=r),d!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,d),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function ke(g){const{userImage:r}=g;return!!(r&&r.render&&r.render())&&(g.data.replace(new Uint8Array(r.data.buffer)),!0)}class Re extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:d,callback:f}of this.requestors)this._notify(d,f);this.requestors=[]}}getImage(r){const d=this.images[r];if(d&&!d.data&&d.spriteData){const f=d.spriteData;d.data=new a.RGBAImage({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),d.spriteData=null}return d}addImage(r,d){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,d)&&(this.images[r]=d)}_validate(r,d){let f=!0;const _=d.data||d.spriteData;return this._validateStretch(d.stretchX,_&&_.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(d.stretchY,_&&_.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(d.content,d)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,d){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||d<_[1])return!1;f=_[1]}return!0}_validateContent(r,d){if(!r)return!0;if(r.length!==4)return!1;const f=d.spriteData,_=f&&f.width||d.data.width,w=f&&f.height||d.data.height;return!(r[0]<0||_<r[0]||r[1]<0||w<r[1]||r[2]<0||_<r[2]||r[3]<0||w<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,d,f=!0){const _=this.getImage(r);if(f&&(_.data.width!==d.data.width||_.data.height!==d.data.height))throw new Error(`size mismatch between old image (${_.data.width}x${_.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=_.version+1,this.images[r]=d,this.updatedImages[r]=!0}removeImage(r){const d=this.images[r];delete this.images[r],delete this.patterns[r],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,d){let f=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(f=!1);this.isLoaded()||f?this._notify(r,d):this.requestors.push({ids:r,callback:d})}_notify(r,d){const f={};for(const _ of r){const w=this.getImage(_);w?f[_]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:Boolean(w.userImage&&w.userImage.render)}:(this.fire(new a.Event("styleimagemissing",{id:_})),a.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`))}d(null,f)}getPixelSize(){const{width:r,height:d}=this.atlasImage;return{width:r,height:d}}getPattern(r){const d=this.patterns[r],f=this.getImage(r);if(!f)return null;if(d&&d.position.version===f.version)return d.position;if(d)d.position.version=f.version;else{const _={w:f.data.width+2,h:f.data.height+2,x:0,y:0},w=new a.ImagePosition(_,f);this.patterns[r]={bin:_,position:w}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const d=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ve(r,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const w in this.patterns)r.push(this.patterns[w].bin);const{w:d,h:f}=a.potpack(r),_=this.atlasImage;_.resize({width:d||1,height:f||1});for(const w in this.patterns){const{bin:C}=this.patterns[w],B=C.x+1,D=C.y+1,F=this.getImage(w).data,Q=F.width,z=F.height;a.RGBAImage.copy(F,_,{x:0,y:0},{x:B,y:D},{width:Q,height:z}),a.RGBAImage.copy(F,_,{x:0,y:z-1},{x:B,y:D-1},{width:Q,height:1}),a.RGBAImage.copy(F,_,{x:0,y:0},{x:B,y:D+z},{width:Q,height:1}),a.RGBAImage.copy(F,_,{x:Q-1,y:0},{x:B-1,y:D},{width:1,height:z}),a.RGBAImage.copy(F,_,{x:0,y:0},{x:B+Q,y:D},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const d of r){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const f=this.getImage(d);f||a.warnOnce(`Image with ID: "${d}" was not found`),ke(f)&&this.updateImage(d,f)}}}const Fe=1e20;function Oe(g,r,d,f,_,w,C,B,D){for(let F=r;F<r+f;F++)je(g,d*w+F,w,_,C,B,D);for(let F=d;F<d+_;F++)je(g,F*w+r,1,f,C,B,D)}function je(g,r,d,f,_,w,C){w[0]=0,C[0]=-Fe,C[1]=Fe,_[0]=g[r];for(let B=1,D=0,F=0;B<f;B++){_[B]=g[r+B*d];const Q=B*B;do{const z=w[D];F=(_[B]-_[z]+Q-z*z)/(B-z)/2}while(F<=C[D]&&--D>-1);D++,w[D]=B,C[D]=F,C[D+1]=Fe}for(let B=0,D=0;B<f;B++){for(;C[D+1]<B;)D++;const F=w[D],Q=B-F;g[r+B*d]=_[F]+Q*Q}}class Je{constructor(r,d){this.requestManager=r,this.localIdeographFontFamily=d,this.entries={}}setURL(r){this.url=r}getGlyphs(r,d){const f=[];for(const _ in r)for(const w of r[_])f.push({stack:_,id:w});a.asyncAll(f,({stack:_,id:w},C)=>{let B=this.entries[_];B||(B=this.entries[_]={glyphs:{},requests:{},ranges:{}});let D=B.glyphs[w];if(D!==void 0)return void C(null,{stack:_,id:w,glyph:D});if(D=this._tinySDF(B,_,w),D)return B.glyphs[w]=D,void C(null,{stack:_,id:w,glyph:D});const F=Math.floor(w/256);if(256*F>65535)return void C(new Error("glyphs > 65535 not supported"));if(B.ranges[F])return void C(null,{stack:_,id:w,glyph:D});if(!this.url)return void C(new Error("glyphsUrl is not set"));let Q=B.requests[F];Q||(Q=B.requests[F]=[],Je.loadGlyphRange(_,F,this.url,this.requestManager,(z,$)=>{if($){for(const le in $)this._doesCharSupportLocalGlyph(+le)||(B.glyphs[+le]=$[+le]);B.ranges[F]=!0}for(const le of Q)le(z,$);delete B.requests[F]})),Q.push((z,$)=>{z?C(z):$&&C(null,{stack:_,id:w,glyph:$[w]||null})})},(_,w)=>{if(_)d(_);else if(w){const C={};for(const{stack:B,id:D,glyph:F}of w)(C[B]||(C[B]={}))[D]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics};d(null,C)}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(a.unicodeBlockLookup["CJK Unified Ideographs"](r)||a.unicodeBlockLookup["Hangul Syllables"](r)||a.unicodeBlockLookup.Hiragana(r)||a.unicodeBlockLookup.Katakana(r))}_tinySDF(r,d,f){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(f))return;let w=r.tinySDF;if(!w){let B="400";/bold/i.test(d)?B="900":/medium/i.test(d)?B="500":/light/i.test(d)&&(B="200"),w=r.tinySDF=new Je.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:B})}const C=w.draw(String.fromCharCode(f));return{id:f,bitmap:new a.AlphaImage({width:C.width||30,height:C.height||30},C.data),metrics:{width:C.glyphWidth||24,height:C.glyphHeight||24,left:C.glyphLeft||0,top:C.glyphTop-27||-8,advance:C.glyphAdvance||24}}}}Je.loadGlyphRange=function(g,r,d,f,_){const w=256*r,C=w+255,B=f.transformRequest(d.replace("{fontstack}",g).replace("{range}",`${w}-${C}`),q.Glyphs);a.getArrayBuffer(B,(D,F)=>{if(D)_(D);else if(F){const Q={};for(const z of a.parseGlyphPbf(F))Q[z.id]=z;_(null,Q)}})},Je.TinySDF=class{constructor({fontSize:g=24,buffer:r=3,radius:d=8,cutoff:f=.25,fontFamily:_="sans-serif",fontWeight:w="normal",fontStyle:C="normal"}={}){this.buffer=r,this.cutoff=f,this.radius=d;const B=this.size=g+4*r,D=this._createCanvas(B),F=this.ctx=D.getContext("2d",{willReadFrequently:!0});F.font=`${C} ${w} ${g}px ${_}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(g){const r=document.createElement("canvas");return r.width=r.height=g,r}draw(g){const{width:r,actualBoundingBoxAscent:d,actualBoundingBoxDescent:f,actualBoundingBoxLeft:_,actualBoundingBoxRight:w}=this.ctx.measureText(g),C=Math.ceil(d),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-_))),D=Math.min(this.size-this.buffer,C+Math.ceil(f)),F=B+2*this.buffer,Q=D+2*this.buffer,z=Math.max(F*Q,0),$=new Uint8ClampedArray(z),le={data:$,width:F,height:Q,glyphWidth:B,glyphHeight:D,glyphTop:C,glyphLeft:0,glyphAdvance:r};if(B===0||D===0)return le;const{ctx:he,buffer:re,gridInner:Ae,gridOuter:Be}=this;he.clearRect(re,re,B,D),he.fillText(g,re,re+C);const Ie=he.getImageData(re,re,B,D);Be.fill(Fe,0,z),Ae.fill(0,0,z);for(let fe=0;fe<D;fe++)for(let Pe=0;Pe<B;Pe++){const Qe=Ie.data[4*(fe*B+Pe)+3]/255;if(Qe===0)continue;const We=(fe+re)*F+Pe+re;if(Qe===1)Be[We]=0,Ae[We]=Fe;else{const Ze=.5-Qe;Be[We]=Ze>0?Ze*Ze:0,Ae[We]=Ze<0?Ze*Ze:0}}Oe(Be,0,0,F,Q,F,this.f,this.v,this.z),Oe(Ae,re,re,B,D,F,this.f,this.v,this.z);for(let fe=0;fe<z;fe++){const Pe=Math.sqrt(Be[fe])-Math.sqrt(Ae[fe]);$[fe]=Math.round(255-255*(Pe/this.radius+this.cutoff))}return le}};const _t=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(g,r){return a.sphericalToCartesian(g.expression.evaluate(r))}interpolate(g,r,d){return{x:a.number(g.x,r.x,d),y:a.number(g.y,r.y,d),z:a.number(g.z,r.z,d)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),yt="-transition";class qe extends a.Evented{constructor(r){super(),this._transitionable=new a.Transitionable(_t),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,d={}){if(!this._validate(a.validateLight,r,d))for(const f in r){const _=r[f];f.endsWith(yt)?this._transitionable.setTransition(f.slice(0,-yt.length),_):this._transitionable.setValue(f,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,d,f){return(!f||f.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Ye{constructor(r,d){this.width=r,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,d){const f=r.join(",")+String(d);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(r,d)),this.dashEntry[f]}getDashRanges(r,d,f){const _=[];let w=r.length%2==1?-r[r.length-1]*f:0,C=r[0]*f,B=!0;_.push({left:w,right:C,isDash:B,zeroLength:r[0]===0});let D=r[0];for(let F=1;F<r.length;F++){B=!B;const Q=r[F];w=D*f,D+=Q,C=D*f,_.push({left:w,right:C,isDash:B,zeroLength:Q===0})}return _}addRoundDash(r,d,f){const _=d/2;for(let w=-f;w<=f;w++){const C=this.width*(this.nextRow+f+w);let B=0,D=r[B];for(let F=0;F<this.width;F++){F/D.right>1&&(D=r[++B]);const Q=Math.abs(F-D.left),z=Math.abs(F-D.right),$=Math.min(Q,z);let le;const he=w/f*(_+1);if(D.isDash){const re=_-Math.abs(he);le=Math.sqrt($*$+re*re)}else le=_-Math.sqrt($*$+he*he);this.data[C+F]=Math.max(0,Math.min(255,le+128))}}}addRegularDash(r){for(let B=r.length-1;B>=0;--B){const D=r[B],F=r[B+1];D.zeroLength?r.splice(B,1):F&&F.isDash===D.isDash&&(F.left=D.left,r.splice(B,1))}const d=r[0],f=r[r.length-1];d.isDash===f.isDash&&(d.left=f.left-this.width,f.right=d.right+this.width);const _=this.width*this.nextRow;let w=0,C=r[w];for(let B=0;B<this.width;B++){B/C.right>1&&(C=r[++w]);const D=Math.abs(B-C.left),F=Math.abs(B-C.right),Q=Math.min(D,F);this.data[_+B]=Math.max(0,Math.min(255,(C.isDash?Q:-Q)+128))}}addDash(r,d){const f=d?7:0,_=2*f+1;if(this.nextRow+_>this.height)return a.warnOnce("LineAtlas out of space"),null;let w=0;for(let B=0;B<r.length;B++)w+=r[B];if(w!==0){const B=this.width/w,D=this.getDashRanges(r,this.width,B);d?this.addRoundDash(D,B,f):this.addRegularDash(D)}const C={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:w};return this.nextRow+=_,this.dirty=!0,C}bind(r){const d=r.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class at{constructor(r,d,f){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=f;const _=this.workerPool.acquire(f);for(let w=0;w<_.length;w++){const C=new at.Actor(_[w],d,f);C.name=`Worker ${w}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,d,f){a.asyncAll(this.actors,(_,w)=>{_.send(r,d,w)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}}function St(g,r,d){const f=function(_,w){if(_)return d(_);if(w){const C=a.pick(a.extend(w,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(C.vectorLayers=w.vector_layers,C.vectorLayerIds=C.vectorLayers.map(B=>B.id)),d(null,C)}};return g.url?a.getJSON(r.transformRequest(g.url,q.Source),f):a.exported.frame(()=>f(null,g))}at.Actor=a.Actor;class Te{constructor(r,d,f){this.bounds=a.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=d||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const d=Math.pow(2,r.z),f=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*d),_=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*d),w=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*d),C=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*d);return r.x>=f&&r.x<w&&r.y>=_&&r.y<C}}class Kt extends a.Evented{constructor(r,d,f,_){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(d,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=St(this._options,this.map._requestManager,(r,d)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r?this.fire(new a.ErrorEvent(r)):d&&(a.extend(this,d),d.bounds&&(this.tileBounds=new Te(d.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.cancel(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(r,d){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,q.Tile),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function w(C,B){return delete r.request,r.aborted?d(null):C&&C.status!==404?d(C):(B&&B.resourceTiming&&(r.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&r.setExpiryData(B),r.loadVectorData(B,this.map.painter),d(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired"?r.state==="loading"?r.reloadCallback=d:r.request=r.actor.send("reloadTile",_,w.bind(this)):(r.actor=this.dispatcher.getActor(),r.request=r.actor.send("loadTile",_,w.bind(this)))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id},void 0)}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Zt extends a.Evented{constructor(r,d,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},d),a.extend(this,a.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=St(this._options,this.map._requestManager,(r,d)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):d&&(a.extend(this,d),d.bounds&&(this.tileBounds=new Te(d.bounds,this.minzoom,this.maxzoom)),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,d){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.request=te.getImage(this.map._requestManager.transformRequest(f,q.Tile),(_,w,C)=>{if(delete r.request,r.aborted)r.state="unloaded",d(null);else if(_)r.state="errored",d(_);else if(w){this.map._refreshExpiredTiles&&r.setExpiryData(C);const B=this.map.painter.context,D=B.gl;r.texture=this.map.painter.getTileTexture(w.width),r.texture?r.texture.update(w,{useMipmap:!0}):(r.texture=new ve(B,w,D.RGBA,{useMipmap:!0}),r.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&D.texParameterf(D.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),r.state="loaded",d(null)}})}abortTile(r,d){r.request&&(r.request.cancel(),delete r.request),d()}unloadTile(r,d){r.texture&&this.map.painter.saveTileTexture(r.texture),d()}hasTransition(){return!1}}let be;class $e extends Zt{constructor(r,d,f,_){super(r,d,f,_),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(r,d){const f=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(w,C){w&&(r.state="errored",d(w)),C&&(r.dem=C,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded",d(null))}r.request=te.getImage(this.map._requestManager.transformRequest(f,q.Tile),function(w,C){if(delete r.request,r.aborted)r.state="unloaded",d(null);else if(w)r.state="errored",d(w);else if(C){this.map._refreshExpiredTiles&&r.setExpiryData(C),delete C.cacheControl,delete C.expires;const B=a.isImageBitmap(C)&&(be==null&&(be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),be)?C:a.exported.getImageData(C,1),D={uid:r.uid,coord:r.tileID,source:this.id,rawImageData:B,encoding:this.encoding};r.actor&&r.state!=="expired"||(r.actor=this.dispatcher.getActor(),r.actor.send("loadDEMTile",D,_.bind(this)))}}.bind(this)),r.neighboringTiles=this._getNeighboringTiles(r.tileID)}_getNeighboringTiles(r){const d=r.canonical,f=Math.pow(2,d.z),_=(d.x-1+f)%f,w=d.x===0?r.wrap-1:r.wrap,C=(d.x+1+f)%f,B=d.x+1===f?r.wrap+1:r.wrap,D={};return D[new a.OverscaledTileID(r.overscaledZ,w,d.z,_,d.y).key]={backfilled:!1},D[new a.OverscaledTileID(r.overscaledZ,B,d.z,C,d.y).key]={backfilled:!1},d.y>0&&(D[new a.OverscaledTileID(r.overscaledZ,w,d.z,_,d.y-1).key]={backfilled:!1},D[new a.OverscaledTileID(r.overscaledZ,r.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},D[new a.OverscaledTileID(r.overscaledZ,B,d.z,C,d.y-1).key]={backfilled:!1}),d.y+1<f&&(D[new a.OverscaledTileID(r.overscaledZ,w,d.z,_,d.y+1).key]={backfilled:!1},D[new a.OverscaledTileID(r.overscaledZ,r.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},D[new a.OverscaledTileID(r.overscaledZ,B,d.z,C,d.y+1).key]={backfilled:!1}),D}unloadTile(r){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&r.actor.send("removeDEMTile",{uid:r.uid,source:this.id})}}class fi extends a.Evented{constructor(r,d,f,_){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(_),this._data=d.data,this._options=a.extend({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const w=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*w,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*w,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:a.EXTENT,radius:(d.clusterRadius||50)*w,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:r,source:this.id},d),this}getClusterChildren(r,d){return this.actor.send("geojson.getClusterChildren",{clusterId:r,source:this.id},d),this}getClusterLeaves(r,d,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:r,limit:d,offset:f},_),this}_updateWorkerData(r){const d=a.extend({},this.workerOptions);r?d.dataDiff=r:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(a.exported.resolveURL(this._data),q.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(f,_)=>{if(this._pendingLoads--,this._removed||_&&_.abandoned)return void this.fire(new a.Event("dataabort",{dataType:"source"}));let w=null;if(_&&_.resourceTiming&&_.resourceTiming[this.id]&&(w=_.resourceTiming[this.id].slice(0)),f)return void this.fire(new a.ErrorEvent(f));const C={dataType:"source"};this._collectResourceTiming&&w&&w.length>0&&a.extend(C,{resourceTiming:w}),this.fire(new a.Event("data",{...C,sourceDataType:"metadata"})),this.fire(new a.Event("data",{...C,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(r,d){const f=r.actor?"reloadTile":"loadTile";r.actor=this.actor;const _={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.request=this.actor.send(f,_,(w,C)=>(delete r.request,r.unloadVectorData(),r.aborted?d(null):w?d(w):(r.loadVectorData(C,this.map.painter,f==="reloadTile"),d(null))))}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.aborted=!0}unloadTile(r){r.unloadVectorData(),this.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var kt=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Dt extends a.Evented{constructor(r,d,f,_){super(),this.id=r,this.dispatcher=f,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=d}load(r,d){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=te.getImage(this.map._requestManager.transformRequest(this.url,q.Image),(f,_)=>{this._request=null,this._loaded=!0,f?this.fire(new a.ErrorEvent(f)):_&&(this.image=_,r&&(this.coordinates=r),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(r){this.coordinates=r;const d=r.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(_){let w=1/0,C=1/0,B=-1/0,D=-1/0;for(const $ of _)w=Math.min(w,$.x),C=Math.min(C,$.y),B=Math.max(B,$.x),D=Math.max(D,$.y);const F=Math.max(B-w,D-C),Q=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),z=Math.pow(2,Q);return new a.CanonicalTileID(Q,Math.floor((w+B)/2*z),Math.floor((C+D)/2*z))}(d),this.minzoom=this.maxzoom=this.tileID.z;const f=d.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new a.RasterBoundsArray,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,d=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,kt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ve(r,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(r,d){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},d(null)):(r.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Qi extends Dt{constructor(r,d,f,_){super(r,d,f,_),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const r=this.options;this.urls=[];for(const d of r.urls)this.urls.push(this.map._requestManager.transformRequest(d,q.Source).url);a.getVideo(this.urls,(d,f)=>{this._loaded=!0,d?this.fire(new a.ErrorEvent(d)):f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const d=this.video.seekable;r<d.start(0)||r>d.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,d=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,kt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new ve(r,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Bi extends Dt{constructor(r,d,f,_){super(r,d,f,_),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(C=>typeof C!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${r}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${r}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,f=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,kt.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ve(d,this.canvas,f.RGBA,{premultiply:!0});for(const _ in this.tiles){const w=this.tiles[_];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Ji={vector:Kt,raster:Zt,"raster-dem":$e,geojson:fi,video:Qi,image:Dt,canvas:Bi};function Ni(g,r){const d=a.create();return a.translate(d,d,[1,1,0]),a.scale(d,d,[.5*g.width,.5*g.height,1]),a.multiply(d,d,g.calculatePosMatrix(r.toUnwrapped()))}function nt(g,r,d,f,_,w){const C=function(z,$,le){if(z)for(const he of z){const re=$[he];if(re&&re.source===le&&re.type==="fill-extrusion")return!0}else for(const he in $){const re=$[he];if(re.source===le&&re.type==="fill-extrusion")return!0}return!1}(_&&_.layers,r,g.id),B=w.maxPitchScaleFactor(),D=g.tilesIn(f,B,C);D.sort(Ot);const F=[];for(const z of D)F.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(r,d,g._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,_,w,B,Ni(g.transform,z.tileID))});const Q=function(z){const $={},le={};for(const he of z){const re=he.queryResults,Ae=he.wrappedTileID,Be=le[Ae]=le[Ae]||{};for(const Ie in re){const fe=re[Ie],Pe=Be[Ie]=Be[Ie]||{},Qe=$[Ie]=$[Ie]||[];for(const We of fe)Pe[We.featureIndex]||(Pe[We.featureIndex]=!0,Qe.push(We))}}return $}(F);for(const z in Q)Q[z].forEach($=>{const le=$.feature,he=g.getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=he});return Q}function Ot(g,r){const d=g.tileID,f=r.tileID;return d.overscaledZ-f.overscaledZ||d.canonical.y-f.canonical.y||d.wrap-f.wrap||d.canonical.x-f.canonical.x}class $t{constructor(r,d){this.tileID=r,this.uid=a.uniqueId(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const d=r+this.timeAdded;d<a.exported.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,d,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(_,w){const C={};if(!w)return C;for(const B of _){const D=B.layerIds.map(F=>w.getLayer(F)).filter(Boolean);if(D.length!==0){B.layers=D,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map(F=>D.filter(Q=>Q.id===F)[0]));for(const F of D)C[F.id]=B}}return C}(r.buckets,d.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const w=this.buckets[_];if(w instanceof a.SymbolBucket){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const w=this.buckets[_];if(w instanceof a.SymbolBucket&&w.hasRTLText){this.hasRTLText=!0,a.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const w=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(_).queryRadius(w))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new a.CollisionBoxArray}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const f in this.buckets){const _=this.buckets[f];_.uploadPending()&&_.upload(r)}const d=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ve(r,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ve(r,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,d,f,_,w,C,B,D,F,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:w,scale:C,tileSize:this.tileSize,pixelPosMatrix:Q,transform:D,params:B,queryPadding:this.queryPadding*F},r,d,f):{}}querySourceFeatures(r,d){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),w=d&&d.sourceLayer?d.sourceLayer:"",C=_._geojsonTileLayer||_[w];if(!C)return;const B=a.createFilter(d&&d.filter),{z:D,x:F,y:Q}=this.tileID.canonical,z={z:D,x:F,y:Q};for(let $=0;$<C.length;$++){const le=C.feature($);if(B.needGeometry){const Ae=a.toEvaluationFeature(le,!0);if(!B.filter(new a.EvaluationParameters(this.tileID.overscaledZ),Ae,this.tileID.canonical))continue}else if(!B.filter(new a.EvaluationParameters(this.tileID.overscaledZ),le))continue;const he=f.getId(le,w),re=new a.GeoJSONFeature(le,D,F,Q,he);re.tile=z,r.push(re)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const d=this.expirationTime;if(r.cacheControl){const f=a.parseCacheControl(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(d)if(this.expirationTime<d)_=!0;else{const w=this.expirationTime-d;w?this.expirationTime=f+Math.max(w,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!d.style.hasLayer(_))continue;const w=this.buckets[_],C=w.layers[0].sourceLayer||"_geojsonTileLayer",B=f[C],D=r[C];if(!B||!D||Object.keys(D).length===0)continue;w.update(D,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=d&&d.style&&d.style.getLayer(_);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=a.exported.now()+r}setDependencies(r,d){const f={};for(const _ of d)f[_]=!0;this.dependencies[r]=f}hasDependency(r,d){for(const f of r){const _=this.dependencies[f];if(_){for(const w of d)if(_[w])return!0}}return!1}}class pe{constructor(r,d){this.max=r,this.onRemove=d,this.reset()}reset(){for(const r in this.data)for(const d of this.data[r])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(r,d,f){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const w={value:d,timeout:void 0};if(f!==void 0&&(w.timeout=setTimeout(()=>{this.remove(r,w)},f)),this.data[_].push(w),this.order.push(_),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const d=this.data[r].shift();return d.timeout&&clearTimeout(d.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),d.value}getByKey(r){const d=this.data[r];return d?d[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,d){if(!this.has(r))return this;const f=r.wrapped().key,_=d===void 0?0:this.data[f].indexOf(d),w=this.data[f][_];return this.data[f].splice(_,1),w.timeout&&clearTimeout(w.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(w.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(r){const d=[];for(const f in this.data)for(const _ of this.data[f])r(_.value)||d.push(_);for(const f of d)this.remove(f.value.tileID,f)}}class oe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,d,f){const _=String(d);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},a.extend(this.stateChanges[r][_],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const w in this.state[r])w!==_&&(this.deletedStates[r][w]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const w in this.state[r][_])f[w]||(this.deletedStates[r][_][w]=null)}else for(const w in f)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][w]===null&&delete this.deletedStates[r][_][w]}removeFeatureState(r,d,f){if(this.deletedStates[r]===null)return;const _=String(d);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&d!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][f]=null);else if(d!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(f in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][f]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,d){const f=String(d),_=a.extend({},(this.state[r]||{})[f],(this.stateChanges[r]||{})[f]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const w=this.deletedStates[r][d];if(w===null)return{};for(const C in w)delete _[C]}return _}initializeTileState(r,d){r.setFeatureState(this.state,d)}coalesceChanges(r,d){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const w={};for(const C in this.stateChanges[_])this.state[_][C]||(this.state[_][C]={}),a.extend(this.state[_][C],this.stateChanges[_][C]),w[C]=this.state[_][C];f[_]=w}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const w={};if(this.deletedStates[_]===null)for(const C in this.state[_])w[C]={},this.state[_][C]={};else for(const C in this.deletedStates[_]){if(this.deletedStates[_][C]===null)this.state[_][C]={};else for(const B of Object.keys(this.deletedStates[_][C]))delete this.state[_][C][B];w[C]=this.state[_][C]}f[_]=f[_]||{},a.extend(f[_],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in r)r[_].setFeatureState(f,d)}}class Ue extends a.Evented{constructor(r,d,f){super(),this.id=r,this.dispatcher=f,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,w,C,B){const D=new Ji[w.type](_,w,C,B);if(D.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${D.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],D),D}(r,d,f,this),this._tiles={},this._cache=new pe(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new oe}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const d=this._tiles[r];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,d){return this._source.loadTile(r,d)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){this._source.abortTile&&this._source.abortTile(r,()=>{}),this._source.fire(new a.Event("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const f=this._tiles[d];f.upload(r),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(pt).map(r=>r.key)}getRenderableIds(r){const d=[];for(const f in this._tiles)this._isIdRenderable(f,r)&&d.push(this._tiles[f]);return r?d.sort((f,_)=>{const w=f.tileID,C=_.tileID,B=new a.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),D=new a.pointGeometry(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-C.overscaledZ||D.y-B.y||D.x-B.x}).map(f=>f.tileID.key):d.map(f=>f.tileID).sort(pt).map(f=>f.key)}hasRenderableParent(r){const d=this.findLoadedParent(r,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(r,d){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(d||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,d){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=d),this._loadTile(f,this._tileLoaded.bind(this,f,r,d)))}_tileLoaded(r,d,f,_){if(_)return r.state="errored",void(_.status!==404?this._source.fire(new a.ErrorEvent(_,{tile:r})):this.update(this.transform,this.terrain));r.timeAdded=a.exported.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(d,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new a.Event("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const d=this.getRenderableIds();for(let _=0;_<d.length;_++){const w=d[_];if(r.neighboringTiles&&r.neighboringTiles[w]){const C=this.getTileByID(w);f(r,C),f(C,r)}}function f(_,w){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let C=w.tileID.canonical.x-_.tileID.canonical.x;const B=w.tileID.canonical.y-_.tileID.canonical.y,D=Math.pow(2,_.tileID.canonical.z),F=w.tileID.key;C===0&&B===0||Math.abs(B)>1||(Math.abs(C)>1&&(Math.abs(C+D)===1?C+=D:Math.abs(C-D)===1&&(C-=D)),w.dem&&_.dem&&(_.dem.backfillBorder(w.dem,C,B),_.neighboringTiles&&_.neighboringTiles[F]&&(_.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,d,f,_){for(const w in this._tiles){let C=this._tiles[w];if(_[w]||!C.hasData()||C.tileID.overscaledZ<=d||C.tileID.overscaledZ>f)continue;let B=C.tileID;for(;C&&C.tileID.overscaledZ>d+1;){const F=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[F.key],C&&C.hasData()&&(B=F)}let D=B;for(;D.overscaledZ>d;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){_[B.key]=B;break}}}findLoadedParent(r,d){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=d?f:null}for(let f=r.overscaledZ-1;f>=d;f--){const _=r.scaledTo(f),w=this._getLoadedTile(_);if(w)return w}}_getLoadedTile(r){const d=this._tiles[r.key];return d&&d.hasData()?d:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const d=Math.ceil(r.width/this._source.tileSize)+1,f=Math.ceil(r.height/this._source.tileSize)+1,_=Math.floor(d*f*5),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(w)}handleWrapJump(r){const d=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,d){const f={};for(const _ in this._tiles){const w=this._tiles[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+d),f[w.tileID.key]=w}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(r,d){if(this.transform=r,this.terrain=d,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new a.OverscaledTileID(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(f=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(f=f.filter(F=>this._source.hasTile(F)))):f=[];const _=r.coveringZoomLevel(this._source),w=Math.max(_-Ue.maxOverzooming,this._source.minzoom),C=Math.max(_+Ue.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const Q of f)if(Q.canonical.z>this._source.minzoom){const z=Q.scaledTo(Q.canonical.z-1);F[z.key]=z;const $=Q.scaledTo(Math.max(this._source.minzoom,Math.min(Q.canonical.z,5)));F[$.key]=$}f=f.concat(Object.values(F))}const B=this._updateRetainedTiles(f,_);if(ct(this._source.type)){const F={},Q={},z=Object.keys(B);for(const $ of z){const le=B[$],he=this._tiles[$];if(!he||he.fadeEndTime&&he.fadeEndTime<=a.exported.now())continue;const re=this.findLoadedParent(le,w);re&&(this._addTile(re.tileID),F[re.tileID.key]=re.tileID),Q[$]=le}this._retainLoadedChildren(Q,_,C,B);for(const $ in F)B[$]||(this._coveredTiles[$]=!0,B[$]=F[$]);if(d){const $={},le={};for(const he of f)this._tiles[he.key].hasData()?$[he.key]=he:le[he.key]=he;for(const he in le){const re=le[he].children(this._source.maxzoom);this._tiles[re[0].key]&&this._tiles[re[1].key]&&this._tiles[re[2].key]&&this._tiles[re[3].key]&&($[re[0].key]=B[re[0].key]=re[0],$[re[1].key]=B[re[1].key]=re[1],$[re[2].key]=B[re[2].key]=re[2],$[re[3].key]=B[re[3].key]=re[3],delete le[he])}for(const he in le){const re=this.findLoadedParent(le[he],this._source.minzoom);if(re){$[re.tileID.key]=B[re.tileID.key]=re.tileID;for(const Ae in $)$[Ae].isChildOf(re.tileID)&&delete $[Ae]}}for(const he in this._tiles)$[he]||(this._coveredTiles[he]=!0)}}for(const F in B)this._tiles[F].clearFadeHold();const D=a.keysDifference(this._tiles,B);for(const F of D){const Q=this._tiles[F];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,d){const f={},_={},w=Math.max(d-Ue.maxOverzooming,this._source.minzoom),C=Math.max(d+Ue.maxUnderzooming,this._source.minzoom),B={};for(const D of r){const F=this._addTile(D);f[D.key]=D,F.hasData()||d<this._source.maxzoom&&(B[D.key]=D)}this._retainLoadedChildren(B,d,C,f);for(const D of r){let F=this._tiles[D.key];if(F.hasData())continue;if(d+1>this._source.maxzoom){const z=D.children(this._source.maxzoom)[0],$=this.getTile(z);if($&&$.hasData()){f[z.key]=z;continue}}else{const z=D.children(this._source.maxzoom);if(f[z[0].key]&&f[z[1].key]&&f[z[2].key]&&f[z[3].key])continue}let Q=F.wasRequested();for(let z=D.overscaledZ-1;z>=w;--z){const $=D.scaledTo(z);if(_[$.key]||(_[$.key]=!0,F=this.getTile($),!F&&Q&&(F=this._addTile($)),F&&(f[$.key]=$,Q=F.wasRequested(),F.hasData())))break}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const d=[];let f,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}d.push(_.key);const w=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(w),f)break;_=w}for(const w of d)this._loadedParentTiles[w]=f}}_addTile(r){let d=this._tiles[r.key];if(d)return d;d=this._cache.getAndRemove(r),d&&(this._setTileReloadTimer(r.key,d),d.tileID=r,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,d)));const f=d;return d||(d=new $t(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,r.key,d.state))),d.uses++,this._tiles[r.key]=d,f||this._source.fire(new a.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(r,d){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=d.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const d=this._tiles[r];d&&(d.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,d,f){const _=[],w=this.transform;if(!w)return _;const C=f?w.getCameraQueryGeometry(r):r,B=r.map(he=>w.pointCoordinate(he,this.terrain)),D=C.map(he=>w.pointCoordinate(he,this.terrain)),F=this.getIds();let Q=1/0,z=1/0,$=-1/0,le=-1/0;for(const he of D)Q=Math.min(Q,he.x),z=Math.min(z,he.y),$=Math.max($,he.x),le=Math.max(le,he.y);for(let he=0;he<F.length;he++){const re=this._tiles[F[he]];if(re.holdingForFade())continue;const Ae=re.tileID,Be=Math.pow(2,w.zoom-re.tileID.overscaledZ),Ie=d*re.queryPadding*a.EXTENT/re.tileSize/Be,fe=[Ae.getTilePoint(new a.MercatorCoordinate(Q,z)),Ae.getTilePoint(new a.MercatorCoordinate($,le))];if(fe[0].x-Ie<a.EXTENT&&fe[0].y-Ie<a.EXTENT&&fe[1].x+Ie>=0&&fe[1].y+Ie>=0){const Pe=B.map(We=>Ae.getTilePoint(We)),Qe=D.map(We=>Ae.getTilePoint(We));_.push({tile:re,tileID:Ae,queryGeometry:Pe,cameraQueryGeometry:Qe,scale:Be})}}return _}getVisibleCoordinates(r){const d=this.getRenderableIds(r).map(f=>this._tiles[f].tileID);for(const f of d)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(ct(this._source.type))for(const r in this._tiles){const d=this._tiles[r];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=a.exported.now())return!0}return!1}setFeatureState(r,d,f){this._state.updateState(r=r||"_geojsonTileLayer",d,f)}removeFeatureState(r,d,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",d,f)}getFeatureState(r,d){return this._state.getState(r=r||"_geojsonTileLayer",d)}setDependencies(r,d,f){const _=this._tiles[r];_&&_.setDependencies(d,f)}reloadTilesForDependencies(r,d){for(const f in this._tiles)this._tiles[f].hasDependency(r,d)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(r,d))}}function pt(g,r){const d=Math.abs(2*g.wrap)-+(g.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return g.overscaledZ-r.overscaledZ||f-d||r.canonical.y-g.canonical.y||r.canonical.x-g.canonical.x}function ct(g){return g==="raster"||g==="image"||g==="video"}Ue.maxOverzooming=10,Ue.maxUnderzooming=3;const It="mapboxgl_preloaded_worker_pool";class Xt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Xt.workerCount;)this.workers.push(new Worker(ba.workerUrl));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}const Ct=Math.floor(a.exported.hardwareConcurrency/2);let He;function qt(){return He||(He=new Xt),He}function Yt(g,r){const d={};for(const f in g)f!=="ref"&&(d[f]=g[f]);return a.refProperties.forEach(f=>{f in r&&(d[f]=r[f])}),d}function ei(g){g=g.slice();const r=Object.create(null);for(let d=0;d<g.length;d++)r[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Yt(g[d],r[g[d].ref]));return g}Xt.workerCount=Math.max(Math.min(Ct,6),1);const ft={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Wt(g,r,d){d.push({command:ft.addSource,args:[g,r[g]]})}function mi(g,r,d){r.push({command:ft.removeSource,args:[g]}),d[g]=!0}function Ii(g,r,d,f){mi(g,d,f),Wt(g,r,d)}function Ki(g,r,d){let f;for(f in g[d])if(Object.prototype.hasOwnProperty.call(g[d],f)&&f!=="data"&&!I(g[d][f],r[d][f]))return!1;for(f in r[d])if(Object.prototype.hasOwnProperty.call(r[d],f)&&f!=="data"&&!I(g[d][f],r[d][f]))return!1;return!0}function Se(g,r,d,f,_,w){let C;for(C in r=r||{},g=g||{})Object.prototype.hasOwnProperty.call(g,C)&&(I(g[C],r[C])||d.push({command:w,args:[f,C,r[C],_]}));for(C in r)Object.prototype.hasOwnProperty.call(r,C)&&!Object.prototype.hasOwnProperty.call(g,C)&&(I(g[C],r[C])||d.push({command:w,args:[f,C,r[C],_]}))}function Xe(g){return g.id}function Ke(g,r){return g[r.id]=r,g}class Rt{constructor(r,d){this.reset(r,d)}reset(r,d){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.clamp(r,0,1);let d=1,f=this._distances[d];const _=r*this.paddedLength+this.padding;for(;f<_&&d<this._distances.length;)f=this._distances[++d];const w=d-1,C=this._distances[w],B=f-C,D=B>0?(_-C)/B:0;return this.points[w].mult(1-D).add(this.points[d].mult(D))}}function Nt(g,r){let d=!0;return g==="always"||g!=="never"&&r!=="never"||(d=!1),d}class ci{constructor(r,d,f){const _=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(d/f);for(let C=0;C<this.xCellCount*this.yCellCount;C++)_.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=d,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,d,f,_,w){this._forEachCell(d,f,_,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}insertCircle(r,d,f,_){this._forEachCell(d-_,f-_,d+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(d),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,d,f,_,w,C){this.boxCells[w].push(C)}_insertCircleCell(r,d,f,_,w,C){this.circleCells[w].push(C)}_query(r,d,f,_,w,C,B){if(f<0||r>this.width||_<0||d>this.height)return[];const D=[];if(r<=0&&d<=0&&this.width<=f&&this.height<=_){if(w)return[{key:null,x1:r,y1:d,x2:f,y2:_}];for(let F=0;F<this.boxKeys.length;F++)D.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const Q=this.circles[3*F],z=this.circles[3*F+1],$=this.circles[3*F+2];D.push({key:this.circleKeys[F],x1:Q-$,y1:z-$,x2:Q+$,y2:z+$})}}else this._forEachCell(r,d,f,_,this._queryCell,D,{hitTest:w,overlapMode:C,seenUids:{box:{},circle:{}}},B);return D}query(r,d,f,_){return this._query(r,d,f,_,!1,null)}hitTest(r,d,f,_,w,C){return this._query(r,d,f,_,!0,w,C).length>0}hitTestCircle(r,d,f,_,w){const C=r-f,B=r+f,D=d-f,F=d+f;if(B<0||C>this.width||F<0||D>this.height)return!1;const Q=[];return this._forEachCell(C,D,B,F,this._queryCellCircle,Q,{hitTest:!0,overlapMode:_,circle:{x:r,y:d,radius:f},seenUids:{box:{},circle:{}}},w),Q.length>0}_queryCell(r,d,f,_,w,C,B,D){const{seenUids:F,hitTest:Q,overlapMode:z}=B,$=this.boxCells[w];if($!==null){const he=this.bboxes;for(const re of $)if(!F.box[re]){F.box[re]=!0;const Ae=4*re,Be=this.boxKeys[re];if(r<=he[Ae+2]&&d<=he[Ae+3]&&f>=he[Ae+0]&&_>=he[Ae+1]&&(!D||D(Be))&&(!Q||!Nt(z,Be.overlapMode))&&(C.push({key:Be,x1:he[Ae],y1:he[Ae+1],x2:he[Ae+2],y2:he[Ae+3]}),Q))return!0}}const le=this.circleCells[w];if(le!==null){const he=this.circles;for(const re of le)if(!F.circle[re]){F.circle[re]=!0;const Ae=3*re,Be=this.circleKeys[re];if(this._circleAndRectCollide(he[Ae],he[Ae+1],he[Ae+2],r,d,f,_)&&(!D||D(Be))&&(!Q||!Nt(z,Be.overlapMode))){const Ie=he[Ae],fe=he[Ae+1],Pe=he[Ae+2];if(C.push({key:Be,x1:Ie-Pe,y1:fe-Pe,x2:Ie+Pe,y2:fe+Pe}),Q)return!0}}}return!1}_queryCellCircle(r,d,f,_,w,C,B,D){const{circle:F,seenUids:Q,overlapMode:z}=B,$=this.boxCells[w];if($!==null){const he=this.bboxes;for(const re of $)if(!Q.box[re]){Q.box[re]=!0;const Ae=4*re,Be=this.boxKeys[re];if(this._circleAndRectCollide(F.x,F.y,F.radius,he[Ae+0],he[Ae+1],he[Ae+2],he[Ae+3])&&(!D||D(Be))&&!Nt(z,Be.overlapMode))return C.push(!0),!0}}const le=this.circleCells[w];if(le!==null){const he=this.circles;for(const re of le)if(!Q.circle[re]){Q.circle[re]=!0;const Ae=3*re,Be=this.circleKeys[re];if(this._circlesCollide(he[Ae],he[Ae+1],he[Ae+2],F.x,F.y,F.radius)&&(!D||D(Be))&&!Nt(z,Be.overlapMode))return C.push(!0),!0}}}_forEachCell(r,d,f,_,w,C,B,D){const F=this._convertToXCellCoord(r),Q=this._convertToYCellCoord(d),z=this._convertToXCellCoord(f),$=this._convertToYCellCoord(_);for(let le=F;le<=z;le++)for(let he=Q;he<=$;he++)if(w.call(this,r,d,f,_,this.xCellCount*he+le,C,B,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,d,f,_,w,C){const B=_-r,D=w-d,F=f+C;return F*F>B*B+D*D}_circleAndRectCollide(r,d,f,_,w,C,B){const D=(C-_)/2,F=Math.abs(r-(_+D));if(F>D+f)return!1;const Q=(B-w)/2,z=Math.abs(d-(w+Q));if(z>Q+f)return!1;if(F<=D||z<=Q)return!0;const $=F-D,le=z-Q;return $*$+le*le<=f*f}}function li(g,r,d,f,_){const w=a.create();return r?(a.scale(w,w,[1/_,1/_,1]),d||a.rotateZ(w,w,f.angle)):a.multiply(w,f.labelPlaneMatrix,g),w}function ki(g,r,d,f,_){if(r){const w=a.clone(g);return a.scale(w,w,[_,_,1]),d||a.rotateZ(w,w,-f.angle),w}return f.glCoordMatrix}function hn(g,r,d){let f;d?(f=[g.x,g.y,d(g.x,g.y),1],a.transformMat4(f,f,r)):(f=[g.x,g.y,0,1],se(f,f,r));const _=f[3];return{point:new a.pointGeometry(f[0]/_,f[1]/_),signedDistanceFromCamera:_}}function Oi(g,r){return .5+g/r*.5}function ie(g,r){const d=g[0]/g[3],f=g[1]/g[3];return d>=-r[0]&&d<=r[0]&&f>=-r[1]&&f<=r[1]}function V(g,r,d,f,_,w,C,B,D,F){const Q=f?g.textSizeData:g.iconSizeData,z=a.evaluateSizeForZoom(Q,d.transform.zoom),$=[256/d.width*2+1,256/d.height*2+1],le=f?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;le.clear();const he=g.lineVertexArray,re=f?g.text.placedSymbolArray:g.icon.placedSymbolArray,Ae=d.transform.width/d.transform.height;let Be=!1;for(let Ie=0;Ie<re.length;Ie++){const fe=re.get(Ie);if(fe.hidden||fe.writingMode===a.WritingMode.vertical&&!Be){Z(fe.numGlyphs,le);continue}let Pe;if(Be=!1,F?(Pe=[fe.anchorX,fe.anchorY,F(fe.anchorX,fe.anchorY),1],a.transformMat4(Pe,Pe,r)):(Pe=[fe.anchorX,fe.anchorY,0,1],se(Pe,Pe,r)),!ie(Pe,$)){Z(fe.numGlyphs,le);continue}const Qe=Oi(d.transform.cameraToCenterDistance,Pe[3]),We=a.evaluateSizeForFeature(Q,z,fe),Ze=C?We/Qe:We*Qe,et=new a.pointGeometry(fe.anchorX,fe.anchorY),lt=hn(et,_,F).point,rt={},mt=de(fe,Ze,!1,B,r,_,w,g.glyphOffsetArray,he,le,lt,et,rt,Ae,D,F);Be=mt.useVertical,(mt.notEnoughRoom||Be||mt.needsFlipping&&de(fe,Ze,!0,B,r,_,w,g.glyphOffsetArray,he,le,lt,et,rt,Ae,D,F).notEnoughRoom)&&Z(fe.numGlyphs,le)}f?g.text.dynamicLayoutVertexBuffer.updateData(le):g.icon.dynamicLayoutVertexBuffer.updateData(le)}function W(g,r,d,f,_,w,C,B,D,F,Q,z,$){const le=B.glyphStartIndex+B.numGlyphs,he=B.lineStartIndex,re=B.lineStartIndex+B.lineLength,Ae=r.getoffsetX(B.glyphStartIndex),Be=r.getoffsetX(le-1),Ie=Ee(g*Ae,d,f,_,w,C,B.segment,he,re,D,F,Q,z,$);if(!Ie)return null;const fe=Ee(g*Be,d,f,_,w,C,B.segment,he,re,D,F,Q,z,$);return fe?{first:Ie,last:fe}:null}function ne(g,r,d,f){return g===a.WritingMode.horizontal&&Math.abs(d.y-r.y)>Math.abs(d.x-r.x)*f?{useVertical:!0}:(g===a.WritingMode.vertical?r.y<d.y:r.x>d.x)?{needsFlipping:!0}:null}function de(g,r,d,f,_,w,C,B,D,F,Q,z,$,le,he,re){const Ae=r/24,Be=g.lineOffsetX*Ae,Ie=g.lineOffsetY*Ae;let fe;if(g.numGlyphs>1){const Pe=g.glyphStartIndex+g.numGlyphs,Qe=g.lineStartIndex,We=g.lineStartIndex+g.lineLength,Ze=W(Ae,B,Be,Ie,d,Q,z,g,D,w,$,he,re);if(!Ze)return{notEnoughRoom:!0};const et=hn(Ze.first.point,C,re).point,lt=hn(Ze.last.point,C,re).point;if(f&&!d){const rt=ne(g.writingMode,et,lt,le);if(rt)return rt}fe=[Ze.first];for(let rt=g.glyphStartIndex+1;rt<Pe-1;rt++)fe.push(Ee(Ae*B.getoffsetX(rt),Be,Ie,d,Q,z,g.segment,Qe,We,D,w,$,he,re));fe.push(Ze.last)}else{if(f&&!d){const Qe=hn(z,_,re).point,We=g.lineStartIndex+g.segment+1,Ze=new a.pointGeometry(D.getx(We),D.gety(We)),et=hn(Ze,_,re),lt=et.signedDistanceFromCamera>0?et.point:ye(z,Ze,Qe,1,_,re),rt=ne(g.writingMode,Qe,lt,le);if(rt)return rt}const Pe=Ee(Ae*B.getoffsetX(g.glyphStartIndex),Be,Ie,d,Q,z,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,D,w,$,he,re);if(!Pe)return{notEnoughRoom:!0};fe=[Pe]}for(const Pe of fe)a.addDynamicAttributes(F,Pe.point,Pe.angle);return{}}function ye(g,r,d,f,_,w){const C=hn(g.add(g.sub(r)._unit()),_,w).point,B=d.sub(C);return d.add(B._mult(f/B.mag()))}function Ee(g,r,d,f,_,w,C,B,D,F,Q,z,$,le){const he=f?g-r:g+r;let re=he>0?1:-1,Ae=0;f&&(re*=-1,Ae=Math.PI),re<0&&(Ae+=Math.PI);let Be=re>0?B+C:B+C+1,Ie=_,fe=_,Pe=0,Qe=0;const We=Math.abs(he),Ze=[];for(;Pe+Qe<=We;){if(Be+=re,Be<B||Be>=D)return null;if(fe=Ie,Ze.push(Ie),Ie=z[Be],Ie===void 0){const Pt=new a.pointGeometry(F.getx(Be),F.gety(Be)),ri=hn(Pt,Q,le);if(ri.signedDistanceFromCamera>0)Ie=z[Be]=ri.point;else{const ai=Be-re;Ie=ye(Pe===0?w:new a.pointGeometry(F.getx(ai),F.gety(ai)),Pt,fe,We-Pe+1,Q,le)}}Pe+=Qe,Qe=fe.dist(Ie)}const et=(We-Pe)/Qe,lt=Ie.sub(fe),rt=lt.mult(et)._add(fe);rt._add(lt._unit()._perp()._mult(d*re));const mt=Ae+Math.atan2(Ie.y-fe.y,Ie.x-fe.x);return Ze.push(rt),{point:rt,angle:$?mt:0,path:Ze}}const N=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Z(g,r){for(let d=0;d<g;d++){const f=r.length;r.resize(f+4),r.float32.set(N,3*f)}}function se(g,r,d){const f=r[0],_=r[1];return g[0]=d[0]*f+d[4]*_+d[12],g[1]=d[1]*f+d[5]*_+d[13],g[3]=d[3]*f+d[7]*_+d[15],g}const ae=100;class xe{constructor(r,d=new ci(r.width+200,r.height+200,25),f=new ci(r.width+200,r.height+200,25)){this.transform=r,this.grid=d,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ae,this.screenBottomBoundary=r.height+ae,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,d,f,_,w,C){const B=this.projectAndGetPerspectiveRatio(_,r.anchorPointX,r.anchorPointY,C),D=f*B.perspectiveRatio,F=r.x1*D+B.point.x,Q=r.y1*D+B.point.y,z=r.x2*D+B.point.x,$=r.y2*D+B.point.y;return!this.isInsideGrid(F,Q,z,$)||d!=="always"&&this.grid.hitTest(F,Q,z,$,d,w)||B.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,Q,z,$],offscreen:this.isOffscreen(F,Q,z,$)}}placeCollisionCircles(r,d,f,_,w,C,B,D,F,Q,z,$,le,he){const re=[],Ae=new a.pointGeometry(d.anchorX,d.anchorY),Be=hn(Ae,C,he),Ie=Oi(this.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),fe=(Q?w/Ie:w*Ie)/a.ONE_EM,Pe=hn(Ae,B,he).point,Qe=W(fe,_,d.lineOffsetX*fe,d.lineOffsetY*fe,!1,Pe,Ae,d,f,B,{},!1,he);let We=!1,Ze=!1,et=!0;if(Qe){const lt=.5*$*Ie+le,rt=new a.pointGeometry(-100,-100),mt=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Pt=new Rt,ri=Qe.first,ai=Qe.last;let Ut=[];for(let di=ri.path.length-1;di>=1;di--)Ut.push(ri.path[di]);for(let di=1;di<ai.path.length;di++)Ut.push(ai.path[di]);const Li=2.5*lt;if(D){const di=Ut.map(Ci=>hn(Ci,D,he));Ut=di.some(Ci=>Ci.signedDistanceFromCamera<=0)?[]:di.map(Ci=>Ci.point)}let Di=[];if(Ut.length>0){const di=Ut[0].clone(),Ci=Ut[0].clone();for(let Hi=1;Hi<Ut.length;Hi++)di.x=Math.min(di.x,Ut[Hi].x),di.y=Math.min(di.y,Ut[Hi].y),Ci.x=Math.max(Ci.x,Ut[Hi].x),Ci.y=Math.max(Ci.y,Ut[Hi].y);Di=di.x>=rt.x&&Ci.x<=mt.x&&di.y>=rt.y&&Ci.y<=mt.y?[Ut]:Ci.x<rt.x||di.x>mt.x||Ci.y<rt.y||di.y>mt.y?[]:a.clipLine([Ut],rt.x,rt.y,mt.x,mt.y)}for(const di of Di){Pt.reset(di,.25*lt);let Ci=0;Ci=Pt.length<=.5*lt?1:Math.ceil(Pt.paddedLength/Li)+1;for(let Hi=0;Hi<Ci;Hi++){const Pi=Hi/Math.max(Ci-1,1),Yr=Pt.lerp(Pi),Kr=Yr.x+ae,qn=Yr.y+ae;re.push(Kr,qn,lt,0);const Pr=Kr-lt,ar=qn-lt,os=Kr+lt,wa=qn+lt;if(et=et&&this.isOffscreen(Pr,ar,os,wa),Ze=Ze||this.isInsideGrid(Pr,ar,os,wa),r!=="always"&&this.grid.hitTestCircle(Kr,qn,lt,r,z)&&(We=!0,!F))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!F&&We||!Ze||Ie<this.perspectiveRatioCutoff?[]:re,offscreen:et,collisionDetected:We}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let f=1/0,_=1/0,w=-1/0,C=-1/0;for(const Q of r){const z=new a.pointGeometry(Q.x+ae,Q.y+ae);f=Math.min(f,z.x),_=Math.min(_,z.y),w=Math.max(w,z.x),C=Math.max(C,z.y),d.push(z)}const B=this.grid.query(f,_,w,C).concat(this.ignoredGrid.query(f,_,w,C)),D={},F={};for(const Q of B){const z=Q.key;if(D[z.bucketInstanceId]===void 0&&(D[z.bucketInstanceId]={}),D[z.bucketInstanceId][z.featureIndex])continue;const $=[new a.pointGeometry(Q.x1,Q.y1),new a.pointGeometry(Q.x2,Q.y1),new a.pointGeometry(Q.x2,Q.y2),new a.pointGeometry(Q.x1,Q.y2)];a.polygonIntersectsPolygon(d,$)&&(D[z.bucketInstanceId][z.featureIndex]=!0,F[z.bucketInstanceId]===void 0&&(F[z.bucketInstanceId]=[]),F[z.bucketInstanceId].push(z.featureIndex))}return F}insertCollisionBox(r,d,f,_,w,C){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:w,collisionGroupID:C,overlapMode:d},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,d,f,_,w,C){const B=f?this.ignoredGrid:this.grid,D={bucketInstanceId:_,featureIndex:w,collisionGroupID:C,overlapMode:d};for(let F=0;F<r.length;F+=4)B.insertCircle(D,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,d,f,_){let w;return _?(w=[d,f,_(d,f),1],a.transformMat4(w,w,r)):(w=[d,f,0,1],se(w,w,r)),{point:new a.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+ae,(-w[1]/w[3]+1)/2*this.transform.height+ae),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w[3]*.5}}isOffscreen(r,d,f,_){return f<ae||r>=this.screenRightBoundary||_<ae||d>this.screenBottomBoundary}isInsideGrid(r,d,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const r=a.identity([]);return a.translate(r,r,[-100,-100,0]),r}}function De(g,r,d){return r*(a.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}class st{constructor(r,d,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?d:-d))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ht{constructor(r,d,f,_,w){this.text=new st(r?r.text:null,d,f,w),this.icon=new st(r?r.icon:null,d,_,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ot{constructor(r,d,f){this.text=r,this.icon=d,this.skipFade=f}}class gt{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Tt{constructor(r,d,f,_,w){this.bucketInstanceId=r,this.featureIndex=d,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=w}}class Ht{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const d=++this.maxGroupID;this.collisionGroups[r]={ID:d,predicate:f=>f.collisionGroupID===d}}return this.collisionGroups[r]}}function zt(g,r,d,f,_){const{horizontalAlign:w,verticalAlign:C}=a.getAnchorAlignment(g),B=-(w-.5)*r,D=-(C-.5)*d,F=a.evaluateVariableOffset(g,f);return new a.pointGeometry(B+F[0]*_,D+F[1]*_)}function si(g,r,d,f,_,w){const{x1:C,x2:B,y1:D,y2:F,anchorPointX:Q,anchorPointY:z}=g,$=new a.pointGeometry(r,d);return f&&$._rotate(_?w:-w),{x1:C+$.x,y1:D+$.y,x2:B+$.x,y2:F+$.y,anchorPointX:Q,anchorPointY:z}}class xi{constructor(r,d,f,_,w){this.transform=r.clone(),this.terrain=d,this.collisionIndex=new xe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Ht(_),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,d,f,_){const w=f.getBucket(d),C=f.latestFeatureIndex;if(!w||!C||d.id!==w.layerIds[0])return;const B=f.collisionBoxArray,D=w.layers[0].layout,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),Q=f.tileSize/a.EXTENT,z=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),$=D.get("text-pitch-alignment")==="map",le=D.get("text-rotation-alignment")==="map",he=De(f,1,this.transform.zoom),re=li(z,$,le,this.transform,he);let Ae=null;if($){const Ie=ki(z,$,le,this.transform,he);Ae=a.multiply([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[w.bucketInstanceId]=new Tt(w.bucketInstanceId,C,w.sourceLayerIndex,w.index,f.tileID);const Be={bucket:w,layout:D,posMatrix:z,textLabelPlaneMatrix:re,labelToScreenMatrix:Ae,scale:F,textPixelRatio:Q,holdingForFade:f.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(_)for(const Ie of w.sortKeyRanges){const{sortKey:fe,symbolInstanceStart:Pe,symbolInstanceEnd:Qe}=Ie;r.push({sortKey:fe,symbolInstanceStart:Pe,symbolInstanceEnd:Qe,parameters:Be})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(r,d,f,_,w,C,B,D,F,Q,z,$,le,he,re,Ae){const Be=[$.textOffset0,$.textOffset1],Ie=zt(r,f,_,Be,w),fe=this.collisionIndex.placeCollisionBox(si(d,Ie.x,Ie.y,C,B,this.transform.angle),z,D,F,Q.predicate,Ae);if((!re||this.collisionIndex.placeCollisionBox(si(re,Ie.x,Ie.y,C,B,this.transform.angle),z,D,F,Q.predicate,Ae).box.length!==0)&&fe.box.length>0){let Pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Be,width:f,height:_,anchor:r,textBoxScale:w,prevAnchor:Pe},this.markUsedJustification(le,r,$,he),le.allowVerticalPlacement&&(this.markUsedOrientation(le,he,$),this.placedOrientations[$.crossTileID]=he),{shift:Ie,placedGlyphBoxes:fe}}}placeLayerBucketPart(r,d,f){const{bucket:_,layout:w,posMatrix:C,textLabelPlaneMatrix:B,labelToScreenMatrix:D,textPixelRatio:F,holdingForFade:Q,collisionBoxArray:z,partiallyEvaluatedTextSize:$,collisionGroup:le}=r.parameters,he=w.get("text-optional"),re=w.get("icon-optional"),Ae=a.getOverlapMode(w,"text-overlap","text-allow-overlap"),Be=Ae==="always",Ie=a.getOverlapMode(w,"icon-overlap","icon-allow-overlap"),fe=Ie==="always",Pe=w.get("text-rotation-alignment")==="map",Qe=w.get("text-pitch-alignment")==="map",We=w.get("icon-text-fit")!=="none",Ze=w.get("symbol-z-order")==="viewport-y",et=Be&&(fe||!_.hasIconData()||re),lt=fe&&(Be||!_.hasTextData()||he);!_.collisionArrays&&z&&_.deserializeCollisionBoxes(z);const rt=(mt,Pt)=>{if(d[mt.crossTileID])return;if(Q)return void(this.placements[mt.crossTileID]=new ot(!1,!1,!1));let ri=!1,ai=!1,Ut=!0,Li=null,Di={box:null,offscreen:null},di={box:null,offscreen:null},Ci=null,Hi=null,Pi=null,Yr=0,Kr=0,qn=0;Pt.textFeatureIndex?Yr=Pt.textFeatureIndex:mt.useRuntimeCollisionCircles&&(Yr=mt.featureIndex),Pt.verticalTextFeatureIndex&&(Kr=Pt.verticalTextFeatureIndex);const Pr=this.retainedQueryData[_.bucketInstanceId].tileID,ar=this.terrain?(Mn,on)=>this.terrain.getElevation(Pr,Mn,on):null;for(const Mn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const on=Pt[Mn];on&&(on.elevation=ar?ar(on.anchorPointX,on.anchorPointY):0)}const os=Pt.textBox;if(os){const Mn=Ui=>{let or=a.WritingMode.horizontal;if(_.allowVerticalPlacement&&!Ui&&this.prevPlacement){const lr=this.prevPlacement.placedOrientations[mt.crossTileID];lr&&(this.placedOrientations[mt.crossTileID]=lr,or=lr,this.markUsedOrientation(_,or,mt))}return or},on=(Ui,or)=>{if(_.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&Pt.verticalTextBox){for(const lr of _.writingModes)if(lr===a.WritingMode.vertical?(Di=or(),di=Di):Di=Ui(),Di&&Di.box&&Di.box.length)break}else Di=Ui()};if(w.get("text-variable-anchor")){let Ui=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[mt.crossTileID]){const ln=this.prevPlacement.variableOffsets[mt.crossTileID];Ui.indexOf(ln.anchor)>0&&(Ui=Ui.filter(Ds=>Ds!==ln.anchor),Ui.unshift(ln.anchor))}const or=(ln,Ds,ls)=>{const op=ln.x2-ln.x1,no=ln.y2-ln.y1,jh=mt.textBoxScale,Xh=We&&Ie==="never"?Ds:null;let Xl={box:[],offscreen:!1};const ly=Ae!=="never"?2*Ui.length:Ui.length;for(let Ln=0;Ln<ly;++Ln){const Ea=this.attemptAnchorPlacement(Ui[Ln%Ui.length],ln,op,no,jh,Pe,Qe,F,C,le,Ln>=Ui.length?Ae:"never",mt,_,ls,Xh,ar);if(Ea&&(Xl=Ea.placedGlyphBoxes,Xl&&Xl.box&&Xl.box.length)){ri=!0,Li=Ea.shift;break}}return Xl};on(()=>or(os,Pt.iconBox,a.WritingMode.horizontal),()=>{const ln=Pt.verticalTextBox;return _.allowVerticalPlacement&&!(Di&&Di.box&&Di.box.length)&&mt.numVerticalGlyphVertices>0&&ln?or(ln,Pt.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),Di&&(ri=Di.box,Ut=Di.offscreen);const lr=Mn(Di&&Di.box);if(!ri&&this.prevPlacement){const ln=this.prevPlacement.variableOffsets[mt.crossTileID];ln&&(this.variableOffsets[mt.crossTileID]=ln,this.markUsedJustification(_,ln.anchor,mt,lr))}}else{const Ui=(or,lr)=>{const ln=this.collisionIndex.placeCollisionBox(or,Ae,F,C,le.predicate,ar);return ln&&ln.box&&ln.box.length&&(this.markUsedOrientation(_,lr,mt),this.placedOrientations[mt.crossTileID]=lr),ln};on(()=>Ui(os,a.WritingMode.horizontal),()=>{const or=Pt.verticalTextBox;return _.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&or?Ui(or,a.WritingMode.vertical):{box:null,offscreen:null}}),Mn(Di&&Di.box&&Di.box.length)}}if(Ci=Di,ri=Ci&&Ci.box&&Ci.box.length>0,Ut=Ci&&Ci.offscreen,mt.useRuntimeCollisionCircles){const Mn=_.text.placedSymbolArray.get(mt.centerJustifiedTextSymbolIndex),on=a.evaluateSizeForFeature(_.textSizeData,$,Mn),Ui=w.get("text-padding");Hi=this.collisionIndex.placeCollisionCircles(Ae,Mn,_.lineVertexArray,_.glyphOffsetArray,on,C,B,D,f,Qe,le.predicate,mt.collisionCircleDiameter,Ui,ar),Hi.circles.length&&Hi.collisionDetected&&!f&&a.warnOnce("Collisions detected, but collision boxes are not shown"),ri=Be||Hi.circles.length>0&&!Hi.collisionDetected,Ut=Ut&&Hi.offscreen}if(Pt.iconFeatureIndex&&(qn=Pt.iconFeatureIndex),Pt.iconBox){const Mn=on=>{const Ui=We&&Li?si(on,Li.x,Li.y,Pe,Qe,this.transform.angle):on;return this.collisionIndex.placeCollisionBox(Ui,Ie,F,C,le.predicate,ar)};di&&di.box&&di.box.length&&Pt.verticalIconBox?(Pi=Mn(Pt.verticalIconBox),ai=Pi.box.length>0):(Pi=Mn(Pt.iconBox),ai=Pi.box.length>0),Ut=Ut&&Pi.offscreen}const wa=he||mt.numHorizontalGlyphVertices===0&&mt.numVerticalGlyphVertices===0,$h=re||mt.numIconVertices===0;if(wa||$h?$h?wa||(ai=ai&&ri):ri=ai&&ri:ai=ri=ai&&ri,ri&&Ci&&Ci.box&&this.collisionIndex.insertCollisionBox(Ci.box,Ae,w.get("text-ignore-placement"),_.bucketInstanceId,di&&di.box&&Kr?Kr:Yr,le.ID),ai&&Pi&&this.collisionIndex.insertCollisionBox(Pi.box,Ie,w.get("icon-ignore-placement"),_.bucketInstanceId,qn,le.ID),Hi&&(ri&&this.collisionIndex.insertCollisionCircles(Hi.circles,Ae,w.get("text-ignore-placement"),_.bucketInstanceId,Yr,le.ID),f)){const Mn=_.bucketInstanceId;let on=this.collisionCircleArrays[Mn];on===void 0&&(on=this.collisionCircleArrays[Mn]=new gt);for(let Ui=0;Ui<Hi.circles.length;Ui+=4)on.circles.push(Hi.circles[Ui+0]),on.circles.push(Hi.circles[Ui+1]),on.circles.push(Hi.circles[Ui+2]),on.circles.push(Hi.collisionDetected?1:0)}if(mt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[mt.crossTileID]=new ot(ri||et,ai||lt,Ut||_.justReloaded),d[mt.crossTileID]=!0};if(Ze){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const mt=_.getSortedSymbolIndexes(this.transform.angle);for(let Pt=mt.length-1;Pt>=0;--Pt){const ri=mt[Pt];rt(_.symbolInstances.get(ri),_.collisionArrays[ri])}}else for(let mt=r.symbolInstanceStart;mt<r.symbolInstanceEnd;mt++)rt(_.symbolInstances.get(mt),_.collisionArrays[mt]);if(f&&_.bucketInstanceId in this.collisionCircleArrays){const mt=this.collisionCircleArrays[_.bucketInstanceId];a.invert(mt.invProjMatrix,C),mt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(r,d,f,_){let w;w=_===a.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(d)];const C=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const B of C)B>=0&&(r.text.placedSymbolArray.get(B).crossTileID=w>=0&&B!==w?0:f.crossTileID)}markUsedOrientation(r,d,f){const _=d===a.WritingMode.horizontal||d===a.WritingMode.horizontalOnly?d:0,w=d===a.WritingMode.vertical?d:0,C=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const B of C)r.text.placedSymbolArray.get(B).placedOrientation=_;f.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let f=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const _=d?d.symbolFadeChange(r):1,w=d?d.opacities:{},C=d?d.variableOffsets:{},B=d?d.placedOrientations:{};for(const D in this.placements){const F=this.placements[D],Q=w[D];Q?(this.opacities[D]=new ht(Q,_,F.text,F.icon),f=f||F.text!==Q.text.placed||F.icon!==Q.icon.placed):(this.opacities[D]=new ht(null,_,F.text,F.icon,F.skipFade),f=f||F.text||F.icon)}for(const D in w){const F=w[D];if(!this.opacities[D]){const Q=new ht(F,_,!1,!1);Q.isHidden()||(this.opacities[D]=Q,f=f||F.text.placed||F.icon.placed)}}for(const D in C)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=C[D]);for(const D in B)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=B[D]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:r)}updateLayerOpacities(r,d){const f={};for(const _ of d){const w=_.getBucket(r);w&&_.latestFeatureIndex&&r.id===w.layerIds[0]&&this.updateBucketOpacities(w,f,_.collisionBoxArray)}}updateBucketOpacities(r,d,f){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,w=new ht(null,0,!1,!1,!0),C=_.get("text-allow-overlap"),B=_.get("icon-allow-overlap"),D=_.get("text-variable-anchor"),F=_.get("text-rotation-alignment")==="map",Q=_.get("text-pitch-alignment")==="map",z=_.get("icon-text-fit")!=="none",$=new ht(null,0,C&&(B||!r.hasIconData()||_.get("icon-optional")),B&&(C||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);const le=(he,re,Ae)=>{for(let Be=0;Be<re/4;Be++)he.opacityVertexArray.emplaceBack(Ae);he.hasVisibleVertices=he.hasVisibleVertices||Ae!==un};for(let he=0;he<r.symbolInstances.length;he++){const re=r.symbolInstances.get(he),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:Be,crossTileID:Ie}=re;let fe=this.opacities[Ie];d[Ie]?fe=w:fe||(fe=$,this.opacities[Ie]=fe),d[Ie]=!0;const Pe=re.numIconVertices>0,Qe=this.placedOrientations[re.crossTileID],We=Qe===a.WritingMode.vertical,Ze=Qe===a.WritingMode.horizontal||Qe===a.WritingMode.horizontalOnly;if(Ae>0||Be>0){const et=Bs(fe.text);le(r.text,Ae,We?un:et),le(r.text,Be,Ze?un:et);const lt=fe.text.isHidden();[re.rightJustifiedTextSymbolIndex,re.centerJustifiedTextSymbolIndex,re.leftJustifiedTextSymbolIndex].forEach(Pt=>{Pt>=0&&(r.text.placedSymbolArray.get(Pt).hidden=lt||We?1:0)}),re.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(re.verticalPlacedTextSymbolIndex).hidden=lt||Ze?1:0);const rt=this.variableOffsets[re.crossTileID];rt&&this.markUsedJustification(r,rt.anchor,re,Qe);const mt=this.placedOrientations[re.crossTileID];mt&&(this.markUsedJustification(r,"left",re,mt),this.markUsedOrientation(r,mt,re))}if(Pe){const et=Bs(fe.icon),lt=!(z&&re.verticalPlacedIconSymbolIndex&&We);re.placedIconSymbolIndex>=0&&(le(r.icon,re.numIconVertices,lt?et:un),r.icon.placedSymbolArray.get(re.placedIconSymbolIndex).hidden=fe.icon.isHidden()),re.verticalPlacedIconSymbolIndex>=0&&(le(r.icon,re.numVerticalIconVertices,lt?un:et),r.icon.placedSymbolArray.get(re.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const et=r.collisionArrays[he];if(et){let lt=new a.pointGeometry(0,0);if(et.textBox||et.verticalTextBox){let mt=!0;if(D){const Pt=this.variableOffsets[Ie];Pt?(lt=zt(Pt.anchor,Pt.width,Pt.height,Pt.textOffset,Pt.textBoxScale),F&&lt._rotate(Q?this.transform.angle:-this.transform.angle)):mt=!1}et.textBox&&Vi(r.textCollisionBox.collisionVertexArray,fe.text.placed,!mt||We,lt.x,lt.y),et.verticalTextBox&&Vi(r.textCollisionBox.collisionVertexArray,fe.text.placed,!mt||Ze,lt.x,lt.y)}const rt=Boolean(!Ze&&et.verticalIconBox);et.iconBox&&Vi(r.iconCollisionBox.collisionVertexArray,fe.icon.placed,rt,z?lt.x:0,z?lt.y:0),et.verticalIconBox&&Vi(r.iconCollisionBox.collisionVertexArray,fe.icon.placed,!rt,z?lt.x:0,z?lt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=he.invProjMatrix,r.placementViewportMatrix=he.viewportMatrix,r.collisionCircleArray=he.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,d){const f=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function Vi(g,r,d,f,_){g.emplaceBack(r?1:0,d?1:0,f||0,_||0),g.emplaceBack(r?1:0,d?1:0,f||0,_||0),g.emplaceBack(r?1:0,d?1:0,f||0,_||0),g.emplaceBack(r?1:0,d?1:0,f||0,_||0)}const bi=Math.pow(2,25),ii=Math.pow(2,24),Is=Math.pow(2,17),En=Math.pow(2,16),Cs=Math.pow(2,9),Ms=Math.pow(2,8),Ts=Math.pow(2,1);function Bs(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const r=g.placed?1:0,d=Math.floor(127*g.opacity);return d*bi+r*ii+d*Is+r*En+d*Cs+r*Ms+d*Ts+r}const un=0;class qr{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,d,f,_,w){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(d.getBucketParts(C,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((B,D)=>B.sortKey-D.sortKey));this._currentPartIndex<C.length;)if(d.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,w())return!0;return!1}}class ja{constructor(r,d,f,_,w,C,B,D){this.placement=new xi(r,d,C,B,D),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(r,d,f){const _=a.exported.now(),w=()=>{const C=a.exported.now()-_;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=d[r[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=B)&&(!C.maxzoom||C.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new qr(C)),this._inProgressLayer.continuePlacement(f[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const In=512/a.EXTENT/2;class Xa{constructor(r,d,f){this.tileID=r,this.bucketInstanceId=f,this._symbolsByKey={};const _=new Map;for(let w=0;w<d.length;w++){const C=d.get(w),B=C.key,D=_.get(B);D?D.push(C):_.set(B,[C])}for(const[w,C]of _){const B={positions:C.map(D=>({x:Math.floor(D.anchorX*In),y:Math.floor(D.anchorY*In)})),crossTileIDs:C.map(D=>D.crossTileID)};if(B.positions.length>128){const D=new a.KDBush(B.positions,F=>F.x,F=>F.y,16,Uint16Array);delete D.points,delete B.positions,B.index=D}this._symbolsByKey[w]=B}}getScaledCoordinates(r,d){const{x:f,y:_,z:w}=this.tileID.canonical,{x:C,y:B,z:D}=d.canonical,F=In/Math.pow(2,D-w),Q=(B*a.EXTENT+r.anchorY)*F,z=_*a.EXTENT*In;return{x:Math.floor((C*a.EXTENT+r.anchorX)*F-f*a.EXTENT*In),y:Math.floor(Q-z)}}findMatches(r,d,f){const _=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let w=0;w<r.length;w++){const C=r.get(w);if(C.crossTileID)continue;const B=this._symbolsByKey[C.key];if(!B)continue;const D=this.getScaledCoordinates(C,d);if(B.index){const F=B.index.range(D.x-_,D.y-_,D.x+_,D.y+_).sort();for(const Q of F){const z=B.crossTileIDs[Q];if(!f[z]){f[z]=!0,C.crossTileID=z;break}}}else if(B.positions)for(let F=0;F<B.positions.length;F++){const Q=B.positions[F],z=B.crossTileIDs[F];if(Math.abs(Q.x-D.x)<=_&&Math.abs(Q.y-D.y)<=_&&!f[z]){f[z]=!0,C.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class No{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _a{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const d=Math.round((r-this.lng)/360);if(d!==0)for(const f in this.indexes){const _=this.indexes[f],w={};for(const C in _){const B=_[C];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+d),w[B.tileID.key]=B}this.indexes[f]=w}this.lng=r}addBucket(r,d,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let w=0;w<d.symbolInstances.length;w++)d.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const w in this.indexes){const C=this.indexes[w];if(Number(w)>r.overscaledZ)for(const B in C){const D=C[B];D.tileID.isChildOf(r)&&D.findMatches(d.symbolInstances,r,_)}else{const B=C[r.scaledTo(Number(w)).key];B&&B.findMatches(d.symbolInstances,r,_)}}for(let w=0;w<d.symbolInstances.length;w++){const C=d.symbolInstances.get(w);C.crossTileID||(C.crossTileID=f.generate(),_[C.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Xa(r,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(r,d){for(const f of d.getCrossTileIDsLists())for(const _ of f)delete this.usedCrossTileIDs[r][_]}removeStaleBuckets(r){let d=!1;for(const f in this.indexes){const _=this.indexes[f];for(const w in _)r[_[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[w]),delete _[w],d=!0)}return d}}class sn{constructor(){this.layerIndexes={},this.crossTileIDs=new No,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,d,f){let _=this.layerIndexes[r.id];_===void 0&&(_=this.layerIndexes[r.id]=new _a);let w=!1;const C={};_.handleWrapJump(f);for(const B of d){const D=B.getBucket(r);D&&r.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(B.tileID,D,this.crossTileIDs)&&(w=!0),C[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(C)&&(w=!0),w}pruneUnusedLayers(r){const d={};r.forEach(f=>{d[f]=!0});for(const f in this.layerIndexes)d[f]||delete this.layerIndexes[f]}}const Ya=(g,r)=>a.emitValidationErrors(g,r&&r.filter(d=>d.identifier!=="source.canvas")),ym=a.pick(ft,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),xm=a.pick(ft,["setCenter","setZoom","setBearing","setPitch"]),vm=function(){const g={},r=a.spec.$version;for(const d in a.spec.$root){const f=a.spec.$root[d];if(f.required){let _=null;_=d==="version"?r:f.type==="array"?[]:{},_!=null&&(g[d]=_)}}return g}();class $r extends a.Evented{constructor(r,d={}){super(),this.map=r,this.dispatcher=new at(qt(),this,r._getMapId()),this.imageManager=new Re,this.imageManager.setEventedParent(this),this.glyphManager=new Je(r._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Ye(256,512),this.crossTileSymbolIndex=new sn,this._spritesImagesIds={},this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const f=this;this._rtlTextPluginCallback=$r.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(w,C)=>{if(a.triggerPluginCompletionEvent(w),C&&C.every(B=>B))for(const B in f.sourceCaches)f.sourceCaches[B].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const w=this.sourceCaches[_.sourceId];if(!w)return;const C=w.getSource();if(C&&C.vectorLayerIds)for(const B in this._layers){const D=this._layers[B];D.source===C.id&&this._validateLayer(D)}})}loadURL(r,d={},f){this.fire(new a.Event("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const _=this.map._requestManager.transformRequest(r,q.Style);this._request=a.getJSON(_,(w,C)=>{this._request=null,w?this.fire(new a.ErrorEvent(w)):C&&this._load(C,d,f)})}loadJSON(r,d={},f){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,d.validate=d.validate!==!1,this._load(r,d,f)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(vm,{validate:!1})}_load(r,d,f){const _=d.transformStyle?d.transformStyle(f,r):r;if(d.validate&&Ya(this,a.validateStyle(_)))return;this._loaded=!0,this.stylesheet=_;for(const C in _.sources)this.addSource(C,_.sources[C],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs);const w=ei(this.stylesheet.layers);this._order=w.map(C=>C.id),this._layers={},this._serializedLayers={};for(let C of w)C=a.createStyleLayer(C),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new qe(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(r,d=!1,f){this.imageManager.setLoaded(!1),this._spriteRequest=function(_,w,C,B){const D=Me(_),F=C>1?"@2x":"";let Q;const z=[],$=[],le={},he={};for(const{id:Ae,url:Be}of D){const Ie=z.push(a.getJSON(w.transformRequest(w.normalizeSpriteURL(Be,F,".json"),q.SpriteJSON),(Pe,Qe)=>{z.splice(Ie,1),Q||(Q=Pe,le[Ae]=Qe,re())})),fe=$.push(te.getImage(w.transformRequest(w.normalizeSpriteURL(Be,F,".png"),q.SpriteImage),(Pe,Qe)=>{$.splice(fe,1),Q||(Q=Pe,he[Ae]=Qe,re())}))}function re(){const Ae=Object.values(le).length,Be=Object.values(he).length;if(Q)B(Q);else if(D.length===Ae&&Ae===Be){const Ie={};for(const fe in le){Ie[fe]={};const Pe=a.exported.getImageCanvasContext(he[fe]),Qe=le[fe];for(const We in Qe){const{width:Ze,height:et,x:lt,y:rt,sdf:mt,pixelRatio:Pt,stretchX:ri,stretchY:ai,content:Ut}=Qe[We];Ie[fe][We]={data:null,pixelRatio:Pt,sdf:mt,stretchX:ri,stretchY:ai,content:Ut,spriteData:{width:Ze,height:et,x:lt,y:rt,context:Pe}}}}B(null,Ie)}}return{cancel(){if(z.length)for(const Ae of z)Ae.cancel(),z.splice(z.indexOf(Ae),1);if($.length)for(const Ae of $)Ae.cancel(),$.splice($.indexOf(Ae),1)}}}(r,this.map._requestManager,this.map.getPixelRatio(),(_,w)=>{if(this._spriteRequest=null,_)this.fire(new a.ErrorEvent(_));else if(w)for(const C in w){this._spritesImagesIds[C]=[];const B=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(D=>!(D in w)):[];for(const D of B)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in w[C]){const F=C==="default"?D:`${C}:${D}`;this._spritesImagesIds[C].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,w[C][D],!1):this.imageManager.addImage(F,w[C][D]),d&&(this._changedImages[F]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"})),f&&f(_)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}_validateLayer(r){const d=this.sourceCaches[r.source];if(!d)return;const f=r.sourceLayer;if(!f)return;const _=d.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(f)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${_.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const d=[];for(const f of r){const _=this._layers[f];_.type!=="custom"&&d.push(_.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const d=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(_.length||w.length)&&this._updateWorkerLayers(_,w);for(const C in this._updatedSources){const B=this._updatedSources[C];if(B==="reload")this._reloadSource(C);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const f={};for(const _ in this.sourceCaches){const w=this.sourceCaches[_];f[_]=w.used,w.used=!1}for(const _ of this._order){const w=this._layers[_];w.recalculate(r,this._availableImages),!w.isHidden(r.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const _ in f){const w=this.sourceCaches[_];f[_]!==w.used&&w.fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(r),this.z=r.zoom,d&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,d={}){if(this._checkLoaded(),r=d.transformStyle?d.transformStyle(this.serialize(),r):r,Ya(this,a.validateStyle(r)))return!1;(r=a.clone$1(r)).layers=ei(r.layers);const f=function(w,C){if(!w)return[{command:ft.setStyle,args:[C]}];let B=[];try{if(!I(w.version,C.version))return[{command:ft.setStyle,args:[C]}];I(w.center,C.center)||B.push({command:ft.setCenter,args:[C.center]}),I(w.zoom,C.zoom)||B.push({command:ft.setZoom,args:[C.zoom]}),I(w.bearing,C.bearing)||B.push({command:ft.setBearing,args:[C.bearing]}),I(w.pitch,C.pitch)||B.push({command:ft.setPitch,args:[C.pitch]}),I(w.sprite,C.sprite)||B.push({command:ft.setSprite,args:[C.sprite]}),I(w.glyphs,C.glyphs)||B.push({command:ft.setGlyphs,args:[C.glyphs]}),I(w.transition,C.transition)||B.push({command:ft.setTransition,args:[C.transition]}),I(w.light,C.light)||B.push({command:ft.setLight,args:[C.light]});const D={},F=[];(function(z,$,le,he){let re;for(re in $=$||{},z=z||{})Object.prototype.hasOwnProperty.call(z,re)&&(Object.prototype.hasOwnProperty.call($,re)||mi(re,le,he));for(re in $)Object.prototype.hasOwnProperty.call($,re)&&(Object.prototype.hasOwnProperty.call(z,re)?I(z[re],$[re])||(z[re].type==="geojson"&&$[re].type==="geojson"&&Ki(z,$,re)?le.push({command:ft.setGeoJSONSourceData,args:[re,$[re].data]}):Ii(re,$,le,he)):Wt(re,$,le))})(w.sources,C.sources,F,D);const Q=[];w.layers&&w.layers.forEach(z=>{D[z.source]?B.push({command:ft.removeLayer,args:[z.id]}):Q.push(z)}),B=B.concat(F),function(z,$,le){$=$||[];const he=(z=z||[]).map(Xe),re=$.map(Xe),Ae=z.reduce(Ke,{}),Be=$.reduce(Ke,{}),Ie=he.slice(),fe=Object.create(null);let Pe,Qe,We,Ze,et,lt,rt;for(Pe=0,Qe=0;Pe<he.length;Pe++)We=he[Pe],Object.prototype.hasOwnProperty.call(Be,We)?Qe++:(le.push({command:ft.removeLayer,args:[We]}),Ie.splice(Ie.indexOf(We,Qe),1));for(Pe=0,Qe=0;Pe<re.length;Pe++)We=re[re.length-1-Pe],Ie[Ie.length-1-Pe]!==We&&(Object.prototype.hasOwnProperty.call(Ae,We)?(le.push({command:ft.removeLayer,args:[We]}),Ie.splice(Ie.lastIndexOf(We,Ie.length-Qe),1)):Qe++,lt=Ie[Ie.length-Pe],le.push({command:ft.addLayer,args:[Be[We],lt]}),Ie.splice(Ie.length-Pe,0,We),fe[We]=!0);for(Pe=0;Pe<re.length;Pe++)if(We=re[Pe],Ze=Ae[We],et=Be[We],!fe[We]&&!I(Ze,et))if(I(Ze.source,et.source)&&I(Ze["source-layer"],et["source-layer"])&&I(Ze.type,et.type)){for(rt in Se(Ze.layout,et.layout,le,We,null,ft.setLayoutProperty),Se(Ze.paint,et.paint,le,We,null,ft.setPaintProperty),I(Ze.filter,et.filter)||le.push({command:ft.setFilter,args:[We,et.filter]}),I(Ze.minzoom,et.minzoom)&&I(Ze.maxzoom,et.maxzoom)||le.push({command:ft.setLayerZoomRange,args:[We,et.minzoom,et.maxzoom]}),Ze)Object.prototype.hasOwnProperty.call(Ze,rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&(rt.indexOf("paint.")===0?Se(Ze[rt],et[rt],le,We,rt.slice(6),ft.setPaintProperty):I(Ze[rt],et[rt])||le.push({command:ft.setLayerProperty,args:[We,rt,et[rt]]}));for(rt in et)Object.prototype.hasOwnProperty.call(et,rt)&&!Object.prototype.hasOwnProperty.call(Ze,rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&(rt.indexOf("paint.")===0?Se(Ze[rt],et[rt],le,We,rt.slice(6),ft.setPaintProperty):I(Ze[rt],et[rt])||le.push({command:ft.setLayerProperty,args:[We,rt,et[rt]]}))}else le.push({command:ft.removeLayer,args:[We]}),lt=Ie[Ie.lastIndexOf(We)+1],le.push({command:ft.addLayer,args:[et,lt]})}(Q,C.layers,B)}catch(D){console.warn("Unable to compute style diff:",D),B=[{command:ft.setStyle,args:[C]}]}return B}(this.serialize(),r).filter(w=>!(w.command in xm));if(f.length===0)return!1;const _=f.filter(w=>!(w.command in ym));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);return f.forEach(w=>{w.command!=="setTransition"&&this[w.command].apply(this,w.args)}),this.stylesheet=r,!0}addImage(r,d){if(this.getImage(r))return this.fire(new a.ErrorEvent(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,d),this._afterImageUpdated(r)}updateImage(r,d){this.imageManager.updateImage(r,d)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.ErrorEvent(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,d,f={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(a.validateStyle.source,`sources.${r}`,d,null,f))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const _=this.sourceCaches[r]=new Ue(r,d,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:r})),_.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));const d=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],d.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,d){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const f=this.sourceCaches[r].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(d),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,d,f={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new a.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let w;if(r.type==="custom"){if(Ya(this,a.validateCustomStyleLayer(r)))return;w=a.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=a.clone$1(r),r=a.extend(r,{source:_})),this._validate(a.validateStyle.layer,`layers.${_}`,r,{arrayIndex:-1},f))return;w=a.createStyleLayer(r),this._validateLayer(w),w.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[w.id]=w.serialize()}const C=d?this._order.indexOf(d):this._order.length;if(d&&C===-1)this.fire(new a.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${d}".`)));else{if(this._order.splice(C,0,_),this._layerOrderChanged=!0,this._layers[_]=w,this._removedLayers[_]&&w.source&&w.type!=="custom"){const B=this._removedLayers[_];delete this._removedLayers[_],B.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(r,d){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===d)return;const f=this._order.indexOf(r);this._order.splice(f,1);const _=d?this._order.indexOf(d):this._order.length;d&&_===-1?this.fire(new a.ErrorEvent(new Error(`Cannot move layer "${r}" before non-existing layer "${d}".`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const d=this._layers[r];if(!d)return void this.fire(new a.ErrorEvent(new Error(`Cannot remove non-existing layer "${r}".`)));d.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=d,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],d.onRemove&&d.onRemove(this.map)}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,d,f){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===d&&_.maxzoom===f||(d!=null&&(_.minzoom=d),f!=null&&(_.maxzoom=f),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,d,f={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!I(_.filter,d))return d==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(a.validateStyle.filter,`layers.${_.id}.filter`,d,null,f)||(_.filter=a.clone$1(d),this._updateLayer(_)))}else this.fire(new a.ErrorEvent(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return a.clone$1(this.getLayer(r).filter)}setLayoutProperty(r,d,f,_={}){this._checkLoaded();const w=this.getLayer(r);w?I(w.getLayoutProperty(d),f)||(w.setLayoutProperty(d,f,_),this._updateLayer(w)):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,d){const f=this.getLayer(r);if(f)return f.getLayoutProperty(d);this.fire(new a.ErrorEvent(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,d,f,_={}){this._checkLoaded();const w=this.getLayer(r);w?I(w.getPaintProperty(d),f)||(w.setPaintProperty(d,f,_)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new a.ErrorEvent(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,d){return this.getLayer(r).getPaintProperty(d)}setFeatureState(r,d){this._checkLoaded();const f=r.source,_=r.sourceLayer,w=this.sourceCaches[f];if(w===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const C=w.getSource().type;C==="geojson"&&_?this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||_?(r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),w.setFeatureState(_,r.id,d)):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,d){this._checkLoaded();const f=r.source,_=this.sourceCaches[f];if(_===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const w=_.getSource().type,C=w==="vector"?r.sourceLayer:void 0;w!=="vector"||C?d&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(C,r.id,d):this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const d=r.source,f=r.sourceLayer,_=this.sourceCaches[d];if(_!==void 0)return _.getSource().type!=="vector"||f?(r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(f,r.id)):void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:a.mapObject(this.sourceCaches,r=>r.serialize()),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(r){const d=C=>this._layers[C].type==="fill-extrusion",f={},_=[];for(let C=this._order.length-1;C>=0;C--){const B=this._order[C];if(d(B)){f[B]=C;for(const D of r){const F=D[B];if(F)for(const Q of F)_.push(Q)}}}_.sort((C,B)=>B.intersectionZ-C.intersectionZ);const w=[];for(let C=this._order.length-1;C>=0;C--){const B=this._order[C];if(d(B))for(let D=_.length-1;D>=0;D--){const F=_[D].feature;if(f[F.layer.id]<C)break;w.push(F),_.pop()}else for(const D of r){const F=D[B];if(F)for(const Q of F)w.push(Q.feature)}}return w}queryRenderedFeatures(r,d,f){d&&d.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const _={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of d.layers){const B=this._layers[C];if(!B)return this.fire(new a.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];_[B.source]=!0}}const w=[];d.availableImages=this._availableImages;for(const C in this.sourceCaches)d.layers&&!_[C]||w.push(nt(this.sourceCaches[C],this._layers,this._serializedLayers,r,d,f));return this.placement&&w.push(function(C,B,D,F,Q,z,$){const le={},he=z.queryRenderedSymbols(F),re=[];for(const Ae of Object.keys(he).map(Number))re.push($[Ae]);re.sort(Ot);for(const Ae of re){const Be=Ae.featureIndex.lookupSymbolFeatures(he[Ae.bucketInstanceId],B,Ae.bucketIndex,Ae.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,C);for(const Ie in Be){const fe=le[Ie]=le[Ie]||[],Pe=Be[Ie];Pe.sort((Qe,We)=>{const Ze=Ae.featureSortOrder;if(Ze){const et=Ze.indexOf(Qe.featureIndex);return Ze.indexOf(We.featureIndex)-et}return We.featureIndex-Qe.featureIndex});for(const Qe of Pe)fe.push(Qe)}}for(const Ae in le)le[Ae].forEach(Be=>{const Ie=Be.feature,fe=D[C[Ae].source].getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=fe});return le}(this._layers,this._serializedLayers,this.sourceCaches,r,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(r,d){d&&d.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const f=this.sourceCaches[r];return f?function(_,w){const C=_.getRenderableIds().map(F=>_.getTileByID(F)),B=[],D={};for(let F=0;F<C.length;F++){const Q=C[F],z=Q.tileID.canonical.key;D[z]||(D[z]=!0,Q.querySourceFeatures(B,w))}return B}(f,d):[]}addSourceType(r,d,f){return $r.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):($r.setSourceType(r,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:d.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(r,d={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const C in r)if(!I(r[C],f[C])){_=!0;break}if(!_)return;const w={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,d),this.light.updateTransitions(w)}_validate(r,d,f,_,w={}){return(!w||w.validate!==!1)&&Ya(this,r.call(a.validateStyle,a.extend({key:d,style:this.serialize(),value:f,styleSpec:a.spec},_)))}_remove(r=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const f=this.sourceCaches[d];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const d in this.sourceCaches)this.sourceCaches[d].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,d,f,_,w=!1){let C=!1,B=!1;const D={};for(const F of this._order){const Q=this._layers[F];if(Q.type!=="symbol")continue;if(!D[Q.source]){const $=this.sourceCaches[Q.source];D[Q.source]=$.getRenderableIds(!0).map(le=>$.getTileByID(le)).sort((le,he)=>he.tileID.overscaledZ-le.tileID.overscaledZ||(le.tileID.isLessThan(he.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(Q,D[Q.source],r.center.lng);C=C||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),r.zoom))&&(this.pauseablePlacement=new ja(r,this.map.terrain,this._order,w,d,f,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),B=!0),C&&this.pauseablePlacement.placement.setStale()),B||C)for(const F of this._order){const Q=this._layers[F];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,D[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,d,f){this.imageManager.getImages(d.icons,f),this._updateTilesForChangedImages();const _=this.sourceCaches[d.source];_&&_.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(r,d,f){this.glyphManager.getGlyphs(d.stacks,f);const _=this.sourceCaches[d.source];_&&_.setDependencies(d.tileID.key,d.type,[""])}getResource(r,d,f){return a.makeRequest(d,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,d={}){this._checkLoaded(),r&&this._validate(a.validateStyle.glyphs,"glyphs",r,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,d,f={},_){this._checkLoaded();const w=[{id:r,url:d}],C=[...Me(this.stylesheet.sprite),...w];this._validate(a.validateStyle.sprite,"sprite",C,null,f)||(this.stylesheet.sprite=C,this._loadSprite(w,!0,_))}removeSprite(r){this._checkLoaded();const d=Me(this.stylesheet.sprite);if(d.find(f=>f.id===r)){if(this._spritesImagesIds[r])for(const f of this._spritesImagesIds[r])this.imageManager.removeImage(f),this._changedImages[f]=!0;d.splice(d.findIndex(f=>f.id===r),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}else this.fire(new a.ErrorEvent(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Me(this.stylesheet.sprite)}setSprite(r,d={},f){this._checkLoaded(),r&&this._validate(a.validateStyle.sprite,"sprite",r,null,d)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,f):(this._unloadSprite(),f(null)))}}$r.getSourceType=function(g){return Ji[g]},$r.setSourceType=function(g,r){Ji[g]=r},$r.registerForPluginStateChange=a.registerForPluginStateChange;var mh=a.createLayout([{name:"a_pos",type:"Int16",components:2}]),fd="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ul={prelude:zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",fd),terrainDepth:zi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",fd),terrainCoords:zi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",fd)};function zi(g,r){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=r.match(/attribute ([\w]+) ([\w]+)/g),_=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=w?w.concat(_):_,B={};return{fragmentSource:g=g.replace(d,(D,F,Q,z,$)=>(B[$]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${Q} ${z} ${$};
#else
uniform ${Q} ${z} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${Q} ${z} ${$} = u_${$};
#endif
`)),vertexSource:r=r.replace(d,(D,F,Q,z,$)=>{const le=z==="float"?"vec2":"vec4",he=$.match(/color/)?"color":le;return B[$]?F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${Q} ${le} a_${$};
varying ${Q} ${z} ${$};
#else
uniform ${Q} ${z} u_${$};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${Q} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${he}(a_${$}, u_${$}_t);
#else
    ${Q} ${z} ${$} = u_${$};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${Q} ${le} a_${$};
#else
uniform ${Q} ${z} u_${$};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${Q} ${z} ${$} = a_${$};
#else
    ${Q} ${z} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${Q} ${z} ${$} = unpack_mix_${he}(a_${$}, u_${$}_t);
#else
    ${Q} ${z} ${$} = u_${$};
#endif
`}),staticAttributes:f,staticUniforms:C}}class md{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,d,f,_,w,C,B,D,F){this.context=r;let Q=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!Q&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(Q=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===f&&!Q&&this.boundIndexBuffer===w&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===B&&this.boundDynamicVertexBuffer2===D&&this.boundDynamicVertexBuffer3===F?(r.bindVertexArrayOES.set(this.vao),B&&B.bind(),w&&w.dynamicDraw&&w.bind(),D&&D.bind(),F&&F.bind()):this.freshBind(d,f,_,w,C,B,D,F)}freshBind(r,d,f,_,w,C,B,D){let F;const Q=r.numAttributes,z=this.context,$=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=r,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=D;else{F=z.currentNumAttributes||0;for(let le=Q;le<F;le++)$.disableVertexAttribArray(le)}d.enableAttributes($,r);for(const le of f)le.enableAttributes($,r);C&&C.enableAttributes($,r),B&&B.enableAttributes($,r),D&&D.enableAttributes($,r),d.bind(),d.setVertexAttribPointers($,r,w);for(const le of f)le.bind(),le.setVertexAttribPointers($,r,w);C&&(C.bind(),C.setVertexAttribPointers($,r,w)),_&&_.bind(),B&&(B.bind(),B.setVertexAttribPointers($,r,w)),D&&(D.bind(),D.setVertexAttribPointers($,r,w)),z.currentNumAttributes=Q}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Fl(g){const r=[];for(let d=0;d<g.length;d++){if(g[d]===null)continue;const f=g[d].split(" ");r.push(f.pop())}return r}class gd{constructor(r,d,f,_,w,C,B){const D=r.gl;this.program=D.createProgram();const F=Fl(f.staticAttributes),Q=_?_.getBinderAttributes():[],z=F.concat(Q),$=Ul.prelude.staticUniforms?Fl(Ul.prelude.staticUniforms):[],le=f.staticUniforms?Fl(f.staticUniforms):[],he=_?_.getBinderUniforms():[],re=$.concat(le).concat(he),Ae=[];for(const Ze of re)Ae.indexOf(Ze)<0&&Ae.push(Ze);const Be=_?_.defines():[];C&&Be.push("#define OVERDRAW_INSPECTOR;"),B&&Be.push("#define TERRAIN3D;");const Ie=Be.concat(Ul.prelude.fragmentSource,f.fragmentSource).join(`
`),fe=Be.concat(Ul.prelude.vertexSource,f.vertexSource).join(`
`),Pe=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(Pe,Ie),D.compileShader(Pe),D.attachShader(this.program,Pe);const Qe=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(Qe,fe),D.compileShader(Qe),D.attachShader(this.program,Qe),this.attributes={};const We={};this.numAttributes=z.length;for(let Ze=0;Ze<this.numAttributes;Ze++)z[Ze]&&(D.bindAttribLocation(this.program,Ze,z[Ze]),this.attributes[z[Ze]]=Ze);D.linkProgram(this.program),D.deleteShader(Qe),D.deleteShader(Pe);for(let Ze=0;Ze<Ae.length;Ze++){const et=Ae[Ze];if(et&&!We[et]){const lt=D.getUniformLocation(this.program,et);lt&&(We[et]=lt)}}this.fixedUniforms=w(r,We),this.terrainUniforms=((Ze,et)=>({u_depth:new a.Uniform1i(Ze,et.u_depth),u_terrain:new a.Uniform1i(Ze,et.u_terrain),u_terrain_dim:new a.Uniform1f(Ze,et.u_terrain_dim),u_terrain_matrix:new a.UniformMatrix4f(Ze,et.u_terrain_matrix),u_terrain_unpack:new a.Uniform4f(Ze,et.u_terrain_unpack),u_terrain_exaggeration:new a.Uniform1f(Ze,et.u_terrain_exaggeration)}))(r,We),this.binderUniforms=_?_.getUniforms(r,We):[]}draw(r,d,f,_,w,C,B,D,F,Q,z,$,le,he,re,Ae,Be,Ie){const fe=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(f),r.setStencilMode(_),r.setColorMode(w),r.setCullFace(C),D){r.activeTexture.set(fe.TEXTURE2),fe.bindTexture(fe.TEXTURE_2D,D.depthTexture),r.activeTexture.set(fe.TEXTURE3),fe.bindTexture(fe.TEXTURE_2D,D.texture);for(const Qe in this.terrainUniforms)this.terrainUniforms[Qe].set(D[Qe])}for(const Qe in this.fixedUniforms)this.fixedUniforms[Qe].set(B[Qe]);re&&re.setUniforms(r,this.binderUniforms,le,{zoom:he});let Pe=0;switch(d){case fe.LINES:Pe=2;break;case fe.TRIANGLES:Pe=3;break;case fe.LINE_STRIP:Pe=1}for(const Qe of $.get()){const We=Qe.vaos||(Qe.vaos={});(We[F]||(We[F]=new md)).bind(r,this,Q,re?re.getPaintVertexBuffers():[],z,Qe.vertexOffset,Ae,Be,Ie),fe.drawElements(d,Qe.primitiveLength*Pe,fe.UNSIGNED_SHORT,Qe.primitiveOffset*Pe*2)}}}function Ad(g,r,d){const f=1/De(d,1,r.transform.tileZoom),_=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,r.transform.tileZoom)/_,C=w*(d.tileID.canonical.x+d.tileID.wrap*_),B=w*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[f,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[C>>16,B>>16],u_pixel_coord_lower:[65535&C,65535&B]}}const _d=(g,r,d,f)=>{const _=r.style.light,w=_.properties.get("position"),C=[w.x,w.y,w.z],B=function(){var F=new a.ARRAY_TYPE(9);return a.ARRAY_TYPE!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();_.properties.get("anchor")==="viewport"&&function(F,Q){var z=Math.sin(Q),$=Math.cos(Q);F[0]=$,F[1]=z,F[2]=0,F[3]=-z,F[4]=$,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(B,-r.transform.angle),function(F,Q,z){var $=Q[0],le=Q[1],he=Q[2];F[0]=$*z[0]+le*z[3]+he*z[6],F[1]=$*z[1]+le*z[4]+he*z[7],F[2]=$*z[2]+le*z[5]+he*z[8]}(C,C,B);const D=_.properties.get("color");return{u_matrix:g,u_lightpos:C,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+d,u_opacity:f}},H0=(g,r,d,f,_,w,C)=>a.extend(_d(g,r,d,f),Ad(w,r,C),{u_height_factor:-Math.pow(2,_.overscaledZ)/C.tileSize/8}),Oo=g=>({u_matrix:g}),zo=(g,r,d,f)=>a.extend(Oo(g),Ad(d,r,f)),bm=(g,r)=>({u_matrix:g,u_world:r}),Dr=(g,r,d,f,_)=>a.extend(zo(g,r,d,f),{u_world:_}),yd=(g,r,d,f)=>{const _=g.transform;let w,C;if(f.paint.get("circle-pitch-alignment")==="map"){const B=De(d,1,_.zoom);w=!0,C=[B,B]}else w=!1,C=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:g.translatePosMatrix(r.posMatrix,d,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:C}},gh=(g,r,d)=>{const f=De(d,1,r.zoom),_=Math.pow(2,r.zoom-d.tileID.overscaledZ),w=d.tileID.overscaleFactor();return{u_matrix:g,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[r.pixelsToGLUnits[0]/(f*_),r.pixelsToGLUnits[1]/(f*_)],u_overscale_factor:w}},kl=(g,r,d=1)=>({u_matrix:g,u_color:r,u_overlay:0,u_overlay_scale:d}),Ah=g=>({u_matrix:g}),xd=(g,r,d,f)=>({u_matrix:g,u_extrude_scale:De(r,1,d),u_intensity:f});function _h(g,r){const d=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new a.MercatorCoordinate(0,f/d).toLngLat().lat,new a.MercatorCoordinate(0,(f+1)/d).toLngLat().lat]}const Nl=(g,r,d,f)=>{const _=g.transform;return{u_matrix:Ka(g,r,d,f),u_ratio:1/De(r,1,_.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},vd=(g,r,d,f,_)=>a.extend(Nl(g,r,d,_),{u_image:0,u_image_height:f}),yh=(g,r,d,f,_)=>{const w=g.transform,C=bd(r,w);return{u_matrix:Ka(g,r,d,_),u_texsize:r.imageAtlasTexture.size,u_ratio:1/De(r,1,w.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[C,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},wm=(g,r,d,f,_,w)=>{const C=g.lineAtlas,B=bd(r,g.transform),D=d.layout.get("line-cap")==="round",F=C.getDash(f.from,D),Q=C.getDash(f.to,D),z=F.width*_.fromScale,$=Q.width*_.toScale;return a.extend(Nl(g,r,d,w),{u_patternscale_a:[B/z,-F.height/2],u_patternscale_b:[B/$,-Q.height/2],u_sdfgamma:C.width/(256*Math.min(z,$)*g.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:Q.y,u_mix:_.t})};function bd(g,r){return 1/De(g,1,r.tileZoom)}function Ka(g,r,d,f){return g.translatePosMatrix(f?f.posMatrix:r.tileID.posMatrix,r,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const W0=(g,r,d,f,_)=>{return{u_matrix:g,u_tl_parent:r,u_scale_parent:d,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(C=_.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:q0(_.paint.get("raster-hue-rotate"))};var w,C};function q0(g){g*=Math.PI/180;const r=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*r-d+1)/3,(Math.sqrt(3)*r-d+1)/3]}const Em=(g,r,d,f,_,w,C,B,D,F)=>{const Q=_.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:Q.width/Q.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:B,u_is_text:+D,u_pitch_with_map:+f,u_texsize:F,u_texture:0}},Sm=(g,r,d,f,_,w,C,B,D,F,Q)=>{const z=_.transform;return a.extend(Em(g,r,d,f,_,w,C,B,D,F),{u_gamma_scale:f?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+Q})},$0=(g,r,d,f,_,w,C,B,D,F)=>a.extend(Sm(g,r,d,f,_,w,C,B,!0,D,!0),{u_texsize_icon:F,u_texture_icon:1}),j0=(g,r,d)=>({u_matrix:g,u_opacity:r,u_color:d}),wd=(g,r,d,f,_,w)=>a.extend(function(C,B,D,F){const Q=D.imageManager.getPattern(C.from.toString()),z=D.imageManager.getPattern(C.to.toString()),{width:$,height:le}=D.imageManager.getPixelSize(),he=Math.pow(2,F.tileID.overscaledZ),re=F.tileSize*Math.pow(2,D.transform.tileZoom)/he,Ae=re*(F.tileID.canonical.x+F.tileID.wrap*he),Be=re*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[$,le],u_mix:B.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/De(F,1,D.transform.tileZoom),u_pixel_coord_upper:[Ae>>16,Be>>16],u_pixel_coord_lower:[65535&Ae,65535&Be]}}(f,w,d,_),{u_matrix:g,u_opacity:r}),xh={fillExtrusion:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_lightpos:new a.Uniform3f(g,r.u_lightpos),u_lightintensity:new a.Uniform1f(g,r.u_lightintensity),u_lightcolor:new a.Uniform3f(g,r.u_lightcolor),u_vertical_gradient:new a.Uniform1f(g,r.u_vertical_gradient),u_opacity:new a.Uniform1f(g,r.u_opacity)}),fillExtrusionPattern:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_lightpos:new a.Uniform3f(g,r.u_lightpos),u_lightintensity:new a.Uniform1f(g,r.u_lightintensity),u_lightcolor:new a.Uniform3f(g,r.u_lightcolor),u_vertical_gradient:new a.Uniform1f(g,r.u_vertical_gradient),u_height_factor:new a.Uniform1f(g,r.u_height_factor),u_image:new a.Uniform1i(g,r.u_image),u_texsize:new a.Uniform2f(g,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(g,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(g,r.u_scale),u_fade:new a.Uniform1f(g,r.u_fade),u_opacity:new a.Uniform1f(g,r.u_opacity)}),fill:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix)}),fillPattern:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_image:new a.Uniform1i(g,r.u_image),u_texsize:new a.Uniform2f(g,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(g,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(g,r.u_scale),u_fade:new a.Uniform1f(g,r.u_fade)}),fillOutline:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_world:new a.Uniform2f(g,r.u_world)}),fillOutlinePattern:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_world:new a.Uniform2f(g,r.u_world),u_image:new a.Uniform1i(g,r.u_image),u_texsize:new a.Uniform2f(g,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(g,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(g,r.u_scale),u_fade:new a.Uniform1f(g,r.u_fade)}),circle:(g,r)=>({u_camera_to_center_distance:new a.Uniform1f(g,r.u_camera_to_center_distance),u_scale_with_map:new a.Uniform1i(g,r.u_scale_with_map),u_pitch_with_map:new a.Uniform1i(g,r.u_pitch_with_map),u_extrude_scale:new a.Uniform2f(g,r.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(g,r.u_matrix)}),collisionBox:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_camera_to_center_distance:new a.Uniform1f(g,r.u_camera_to_center_distance),u_pixels_to_tile_units:new a.Uniform1f(g,r.u_pixels_to_tile_units),u_extrude_scale:new a.Uniform2f(g,r.u_extrude_scale),u_overscale_factor:new a.Uniform1f(g,r.u_overscale_factor)}),collisionCircle:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_inv_matrix:new a.UniformMatrix4f(g,r.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(g,r.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(g,r.u_viewport_size)}),debug:(g,r)=>({u_color:new a.UniformColor(g,r.u_color),u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_overlay:new a.Uniform1i(g,r.u_overlay),u_overlay_scale:new a.Uniform1f(g,r.u_overlay_scale)}),clippingMask:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix)}),heatmap:(g,r)=>({u_extrude_scale:new a.Uniform1f(g,r.u_extrude_scale),u_intensity:new a.Uniform1f(g,r.u_intensity),u_matrix:new a.UniformMatrix4f(g,r.u_matrix)}),heatmapTexture:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_world:new a.Uniform2f(g,r.u_world),u_image:new a.Uniform1i(g,r.u_image),u_color_ramp:new a.Uniform1i(g,r.u_color_ramp),u_opacity:new a.Uniform1f(g,r.u_opacity)}),hillshade:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_image:new a.Uniform1i(g,r.u_image),u_latrange:new a.Uniform2f(g,r.u_latrange),u_light:new a.Uniform2f(g,r.u_light),u_shadow:new a.UniformColor(g,r.u_shadow),u_highlight:new a.UniformColor(g,r.u_highlight),u_accent:new a.UniformColor(g,r.u_accent)}),hillshadePrepare:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_image:new a.Uniform1i(g,r.u_image),u_dimension:new a.Uniform2f(g,r.u_dimension),u_zoom:new a.Uniform1f(g,r.u_zoom),u_unpack:new a.Uniform4f(g,r.u_unpack)}),line:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_ratio:new a.Uniform1f(g,r.u_ratio),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(g,r.u_units_to_pixels)}),lineGradient:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_ratio:new a.Uniform1f(g,r.u_ratio),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(g,r.u_units_to_pixels),u_image:new a.Uniform1i(g,r.u_image),u_image_height:new a.Uniform1f(g,r.u_image_height)}),linePattern:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_texsize:new a.Uniform2f(g,r.u_texsize),u_ratio:new a.Uniform1f(g,r.u_ratio),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_image:new a.Uniform1i(g,r.u_image),u_units_to_pixels:new a.Uniform2f(g,r.u_units_to_pixels),u_scale:new a.Uniform3f(g,r.u_scale),u_fade:new a.Uniform1f(g,r.u_fade)}),lineSDF:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_ratio:new a.Uniform1f(g,r.u_ratio),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(g,r.u_units_to_pixels),u_patternscale_a:new a.Uniform2f(g,r.u_patternscale_a),u_patternscale_b:new a.Uniform2f(g,r.u_patternscale_b),u_sdfgamma:new a.Uniform1f(g,r.u_sdfgamma),u_image:new a.Uniform1i(g,r.u_image),u_tex_y_a:new a.Uniform1f(g,r.u_tex_y_a),u_tex_y_b:new a.Uniform1f(g,r.u_tex_y_b),u_mix:new a.Uniform1f(g,r.u_mix)}),raster:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_tl_parent:new a.Uniform2f(g,r.u_tl_parent),u_scale_parent:new a.Uniform1f(g,r.u_scale_parent),u_buffer_scale:new a.Uniform1f(g,r.u_buffer_scale),u_fade_t:new a.Uniform1f(g,r.u_fade_t),u_opacity:new a.Uniform1f(g,r.u_opacity),u_image0:new a.Uniform1i(g,r.u_image0),u_image1:new a.Uniform1i(g,r.u_image1),u_brightness_low:new a.Uniform1f(g,r.u_brightness_low),u_brightness_high:new a.Uniform1f(g,r.u_brightness_high),u_saturation_factor:new a.Uniform1f(g,r.u_saturation_factor),u_contrast_factor:new a.Uniform1f(g,r.u_contrast_factor),u_spin_weights:new a.Uniform3f(g,r.u_spin_weights)}),symbolIcon:(g,r)=>({u_is_size_zoom_constant:new a.Uniform1i(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(g,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(g,r.u_size_t),u_size:new a.Uniform1f(g,r.u_size),u_camera_to_center_distance:new a.Uniform1f(g,r.u_camera_to_center_distance),u_pitch:new a.Uniform1f(g,r.u_pitch),u_rotate_symbol:new a.Uniform1i(g,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(g,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(g,r.u_fade_change),u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(g,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(g,r.u_coord_matrix),u_is_text:new a.Uniform1i(g,r.u_is_text),u_pitch_with_map:new a.Uniform1i(g,r.u_pitch_with_map),u_texsize:new a.Uniform2f(g,r.u_texsize),u_texture:new a.Uniform1i(g,r.u_texture)}),symbolSDF:(g,r)=>({u_is_size_zoom_constant:new a.Uniform1i(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(g,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(g,r.u_size_t),u_size:new a.Uniform1f(g,r.u_size),u_camera_to_center_distance:new a.Uniform1f(g,r.u_camera_to_center_distance),u_pitch:new a.Uniform1f(g,r.u_pitch),u_rotate_symbol:new a.Uniform1i(g,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(g,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(g,r.u_fade_change),u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(g,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(g,r.u_coord_matrix),u_is_text:new a.Uniform1i(g,r.u_is_text),u_pitch_with_map:new a.Uniform1i(g,r.u_pitch_with_map),u_texsize:new a.Uniform2f(g,r.u_texsize),u_texture:new a.Uniform1i(g,r.u_texture),u_gamma_scale:new a.Uniform1f(g,r.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(g,r.u_is_halo)}),symbolTextAndIcon:(g,r)=>({u_is_size_zoom_constant:new a.Uniform1i(g,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(g,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(g,r.u_size_t),u_size:new a.Uniform1f(g,r.u_size),u_camera_to_center_distance:new a.Uniform1f(g,r.u_camera_to_center_distance),u_pitch:new a.Uniform1f(g,r.u_pitch),u_rotate_symbol:new a.Uniform1i(g,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(g,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(g,r.u_fade_change),u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(g,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(g,r.u_coord_matrix),u_is_text:new a.Uniform1i(g,r.u_is_text),u_pitch_with_map:new a.Uniform1i(g,r.u_pitch_with_map),u_texsize:new a.Uniform2f(g,r.u_texsize),u_texsize_icon:new a.Uniform2f(g,r.u_texsize_icon),u_texture:new a.Uniform1i(g,r.u_texture),u_texture_icon:new a.Uniform1i(g,r.u_texture_icon),u_gamma_scale:new a.Uniform1f(g,r.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(g,r.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(g,r.u_is_halo)}),background:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_opacity:new a.Uniform1f(g,r.u_opacity),u_color:new a.UniformColor(g,r.u_color)}),backgroundPattern:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_opacity:new a.Uniform1f(g,r.u_opacity),u_image:new a.Uniform1i(g,r.u_image),u_pattern_tl_a:new a.Uniform2f(g,r.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(g,r.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(g,r.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(g,r.u_pattern_br_b),u_texsize:new a.Uniform2f(g,r.u_texsize),u_mix:new a.Uniform1f(g,r.u_mix),u_pattern_size_a:new a.Uniform2f(g,r.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(g,r.u_pattern_size_b),u_scale_a:new a.Uniform1f(g,r.u_scale_a),u_scale_b:new a.Uniform1f(g,r.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(g,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(g,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(g,r.u_tile_units_to_pixels)}),terrain:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_texture:new a.Uniform1i(g,r.u_texture),u_ele_delta:new a.Uniform1f(g,r.u_ele_delta)}),terrainDepth:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_ele_delta:new a.Uniform1f(g,r.u_ele_delta)}),terrainCoords:(g,r)=>({u_matrix:new a.UniformMatrix4f(g,r.u_matrix),u_texture:new a.Uniform1i(g,r.u_texture),u_terrain_coords_id:new a.Uniform1f(g,r.u_terrain_coords_id),u_ele_delta:new a.Uniform1f(g,r.u_ele_delta)})};class Ed{constructor(r,d,f){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Go{constructor(r,d,f,_){this.length=d.length,this.attributes=f,this.itemSize=d.bytesPerElement,this.dynamicDraw=_,this.context=r;const w=r.gl;this.buffer=w.createBuffer(),r.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,d){for(let f=0;f<this.attributes.length;f++){const _=d.attributes[this.attributes[f].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,d,f){for(let _=0;_<this.attributes.length;_++){const w=this.attributes[_],C=d.attributes[w.name];C!==void 0&&r.vertexAttribPointer(C,w.components,r[Sd[w.type]],!1,this.itemSize,w.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ri{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Im extends Ri{getDefault(){return a.Color.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Id extends Ri{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Za extends Ri{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Cm extends Ri{getDefault(){return[!0,!0,!0,!0]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Qo extends Ri{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Vo extends Ri{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Mm extends Ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const d=this.current;(r.func!==d.func||r.ref!==d.ref||r.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Cd extends Ri{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Gi extends Ri{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=r,this.dirty=!1}}class vh extends Ri{getDefault(){return[0,1]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class X0 extends Ri{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=r,this.dirty=!1}}class Tm extends Ri{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Ol extends Ri{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.BLEND):d.disable(d.BLEND),this.current=r,this.dirty=!1}}class Y0 extends Ri{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class K0 extends Ri{getDefault(){return a.Color.transparent}set(r){const d=this.current;(r.r!==d.r||r.g!==d.g||r.b!==d.b||r.a!==d.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Bm extends Ri{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Z0 extends Ri{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;r?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=r,this.dirty=!1}}class Md extends Ri{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class bh extends Ri{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class wh extends Ri{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Td extends Ri{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Bd extends Ri{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const d=this.current;(r[0]!==d[0]||r[1]!==d[1]||r[2]!==d[2]||r[3]!==d[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Rm extends Ri{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Eh extends Ri{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Sh extends Ri{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class jr extends Ri{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Lm extends Ri{getDefault(){return null}set(r){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Rd extends Ri{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Dm extends Ri{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Ho extends Ri{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ih extends Ri{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Ch extends Ri{constructor(r,d){super(r),this.context=r,this.parent=d}getDefault(){return null}}class J0 extends Ch{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ld extends Ch{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ey{constructor(r,d,f,_){this.context=r,this.width=d,this.height=f;const w=r.gl,C=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new J0(r,C),_&&(this.depthAttachment=new Ld(r,C)),w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,d=this.colorAttachment.get();if(d&&r.deleteTexture(d),this.depthAttachment){const f=this.depthAttachment.get();f&&r.deleteRenderbuffer(f)}r.deleteFramebuffer(this.framebuffer)}}class An{constructor(r,d,f){this.blendFunction=r,this.blendColor=d,this.mask=f}}An.Replace=[1,0],An.disabled=new An(An.Replace,a.Color.transparent,[!1,!1,!1,!1]),An.unblended=new An(An.Replace,a.Color.transparent,[!0,!0,!0,!0]),An.alphaBlended=new An([1,771],a.Color.transparent,[!0,!0,!0,!0]);class Mh{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Im(this),this.clearDepth=new Id(this),this.clearStencil=new Za(this),this.colorMask=new Cm(this),this.depthMask=new Qo(this),this.stencilMask=new Vo(this),this.stencilFunc=new Mm(this),this.stencilOp=new Cd(this),this.stencilTest=new Gi(this),this.depthRange=new vh(this),this.depthTest=new X0(this),this.depthFunc=new Tm(this),this.blend=new Ol(this),this.blendFunc=new Y0(this),this.blendColor=new K0(this),this.blendEquation=new Bm(this),this.cullFace=new Z0(this),this.cullFaceSide=new Md(this),this.frontFace=new bh(this),this.program=new wh(this),this.activeTexture=new Td(this),this.viewport=new Bd(this),this.bindFramebuffer=new Rm(this),this.bindRenderbuffer=new Eh(this),this.bindTexture=new Sh(this),this.bindVertexBuffer=new jr(this),this.bindElementBuffer=new Lm(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Rd(this),this.pixelStoreUnpack=new Dm(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new Ih(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,d){return new Ed(this,r,d)}createVertexBuffer(r,d,f){return new Go(this,r,d,f)}createRenderbuffer(r,d,f){const _=this.gl,w=_.createRenderbuffer();return this.bindRenderbuffer.set(w),_.renderbufferStorage(_.RENDERBUFFER,r,d,f),this.bindRenderbuffer.set(null),w}createFramebuffer(r,d,f){return new ey(this,r,d,f)}clear({color:r,depth:d}){const f=this.gl;let _=0;r&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),f.clear(_)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){I(r.blendFunction,An.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class vi{constructor(r,d,f){this.func=r,this.mask=d,this.range=f}}vi.ReadOnly=!1,vi.ReadWrite=!0,vi.disabled=new vi(519,vi.ReadOnly,[0,1]);const Th=7680;class an{constructor(r,d,f,_,w,C){this.test=r,this.ref=d,this.mask=f,this.fail=_,this.depthFail=w,this.pass=C}}an.disabled=new an({func:519,mask:0},0,0,Th,Th,Th);class ji{constructor(r,d,f){this.enable=r,this.mode=d,this.frontFace=f}}let Wo;function Dd(g,r,d,f,_,w,C){const B=g.context,D=B.gl,F=g.useProgram("collisionBox"),Q=[];let z=0,$=0;for(let fe=0;fe<f.length;fe++){const Pe=f[fe],Qe=r.getTile(Pe),We=Qe.getBucket(d);if(!We)continue;let Ze=Pe.posMatrix;_[0]===0&&_[1]===0||(Ze=g.translatePosMatrix(Pe.posMatrix,Qe,_,w));const et=C?We.textCollisionBox:We.iconCollisionBox,lt=We.collisionCircleArray;if(lt.length>0){const rt=a.create(),mt=Ze;a.mul(rt,We.placementInvProjMatrix,g.transform.glCoordMatrix),a.mul(rt,rt,We.placementViewportMatrix),Q.push({circleArray:lt,circleOffset:$,transform:mt,invTransform:rt,coord:Pe}),z+=lt.length/4,$=z}et&&F.draw(B,D.LINES,vi.disabled,an.disabled,g.colorModeForRenderPass(),ji.disabled,gh(Ze,g.transform,Qe),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Pe),d.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,null,g.transform.zoom,null,null,et.collisionVertexBuffer)}if(!C||!Q.length)return;const le=g.useProgram("collisionCircle"),he=new a.CollisionCircleLayoutArray;he.resize(4*z),he._trim();let re=0;for(const fe of Q)for(let Pe=0;Pe<fe.circleArray.length/4;Pe++){const Qe=4*Pe,We=fe.circleArray[Qe+0],Ze=fe.circleArray[Qe+1],et=fe.circleArray[Qe+2],lt=fe.circleArray[Qe+3];he.emplace(re++,We,Ze,et,lt,0),he.emplace(re++,We,Ze,et,lt,1),he.emplace(re++,We,Ze,et,lt,2),he.emplace(re++,We,Ze,et,lt,3)}(!Wo||Wo.length<2*z)&&(Wo=function(fe){const Pe=2*fe,Qe=new a.QuadTriangleArray;Qe.resize(Pe),Qe._trim();for(let We=0;We<Pe;We++){const Ze=6*We;Qe.uint16[Ze+0]=4*We+0,Qe.uint16[Ze+1]=4*We+1,Qe.uint16[Ze+2]=4*We+2,Qe.uint16[Ze+3]=4*We+2,Qe.uint16[Ze+4]=4*We+3,Qe.uint16[Ze+5]=4*We+0}return Qe}(z));const Ae=B.createIndexBuffer(Wo,!0),Be=B.createVertexBuffer(he,a.collisionCircleLayout.members,!0);for(const fe of Q){const Pe={u_matrix:fe.transform,u_inv_matrix:fe.invTransform,u_camera_to_center_distance:(Ie=g.transform).cameraToCenterDistance,u_viewport_size:[Ie.width,Ie.height]};le.draw(B,D.TRIANGLES,vi.disabled,an.disabled,g.colorModeForRenderPass(),ji.disabled,Pe,g.style.map.terrain&&g.style.map.terrain.getTerrainData(fe.coord),d.id,Be,Ae,a.SegmentVector.simpleSegment(0,2*fe.circleOffset,fe.circleArray.length,fe.circleArray.length/2),null,g.transform.zoom,null,null,null)}var Ie;Be.destroy(),Ae.destroy()}ji.disabled=new ji(!1,1029,2305),ji.backCCW=new ji(!0,1029,2305);const Pm=a.identity(new Float32Array(16));function Um(g,r,d,f,_,w){const{horizontalAlign:C,verticalAlign:B}=a.getAnchorAlignment(g),D=-(C-.5)*r,F=-(B-.5)*d,Q=a.evaluateVariableOffset(g,f);return new a.pointGeometry((D/_+Q[0])*w,(F/_+Q[1])*w)}function Fm(g,r,d,f,_,w,C,B,D,F,Q){const z=g.text.placedSymbolArray,$=g.text.dynamicLayoutVertexArray,le=g.icon.dynamicLayoutVertexArray,he={};$.clear();for(let re=0;re<z.length;re++){const Ae=z.get(re),Be=Ae.hidden||!Ae.crossTileID||g.allowVerticalPlacement&&!Ae.placedOrientation?null:f[Ae.crossTileID];if(Be){const Ie=new a.pointGeometry(Ae.anchorX,Ae.anchorY),fe=hn(Ie,d?C:w,Q),Pe=Oi(_.cameraToCenterDistance,fe.signedDistanceFromCamera);let Qe=a.evaluateSizeForFeature(g.textSizeData,D,Ae)*Pe/a.ONE_EM;d&&(Qe*=g.tilePixelRatio/B);const{width:We,height:Ze,anchor:et,textOffset:lt,textBoxScale:rt}=Be,mt=Um(et,We,Ze,lt,rt,Qe),Pt=d?hn(Ie.add(mt),w,Q).point:fe.point.add(r?mt.rotate(-_.angle):mt),ri=g.allowVerticalPlacement&&Ae.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let ai=0;ai<Ae.numGlyphs;ai++)a.addDynamicAttributes($,Pt,ri);F&&Ae.associatedIconIndex>=0&&(he[Ae.associatedIconIndex]={shiftedAnchor:Pt,angle:ri})}else Z(Ae.numGlyphs,$)}if(F){le.clear();const re=g.icon.placedSymbolArray;for(let Ae=0;Ae<re.length;Ae++){const Be=re.get(Ae);if(Be.hidden)Z(Be.numGlyphs,le);else{const Ie=he[Ae];if(Ie)for(let fe=0;fe<Be.numGlyphs;fe++)a.addDynamicAttributes(le,Ie.shiftedAnchor,Ie.angle);else Z(Be.numGlyphs,le)}}g.icon.dynamicLayoutVertexBuffer.updateData(le)}g.text.dynamicLayoutVertexBuffer.updateData($)}function km(g,r,d){return d.iconsInText&&r?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function ya(g,r,d,f,_,w,C,B,D,F,Q,z){const $=g.context,le=$.gl,he=g.transform,re=B==="map",Ae=D==="map",Be=B!=="viewport"&&d.layout.get("symbol-placement")!=="point",Ie=re&&!Ae&&!Be,fe=!d.layout.get("symbol-sort-key").isConstant();let Pe=!1;const Qe=g.depthModeForSublayer(0,vi.ReadOnly),We=d.layout.get("text-variable-anchor"),Ze=[];for(const et of f){const lt=r.getTile(et),rt=lt.getBucket(d);if(!rt)continue;const mt=_?rt.text:rt.icon;if(!mt||!mt.segments.get().length||!mt.hasVisibleVertices)continue;const Pt=mt.programConfigurations.get(d.id),ri=_||rt.sdfIcons,ai=_?rt.textSizeData:rt.iconSizeData,Ut=Ae||he.pitch!==0,Li=g.useProgram(km(ri,_,rt),Pt),Di=a.evaluateSizeForZoom(ai,he.zoom),di=g.style.map.terrain&&g.style.map.terrain.getTerrainData(et);let Ci,Hi,Pi,Yr,Kr=[0,0],qn=null;if(_)Hi=lt.glyphAtlasTexture,Pi=le.LINEAR,Ci=lt.glyphAtlasTexture.size,rt.iconsInText&&(Kr=lt.imageAtlasTexture.size,qn=lt.imageAtlasTexture,Yr=Ut||g.options.rotating||g.options.zooming||ai.kind==="composite"||ai.kind==="camera"?le.LINEAR:le.NEAREST);else{const Ds=d.layout.get("icon-size").constantOr(0)!==1||rt.iconsNeedLinear;Hi=lt.imageAtlasTexture,Pi=ri||g.options.rotating||g.options.zooming||Ds||Ut?le.LINEAR:le.NEAREST,Ci=lt.imageAtlasTexture.size}const Pr=De(lt,1,g.transform.zoom),ar=li(et.posMatrix,Ae,re,g.transform,Pr),os=ki(et.posMatrix,Ae,re,g.transform,Pr),wa=We&&rt.hasTextData(),$h=d.layout.get("icon-text-fit")!=="none"&&wa&&rt.hasIconData();if(Be){const Ds=g.style.map.terrain?(op,no)=>g.style.map.terrain.getElevation(et,op,no):null,ls=d.layout.get("text-rotation-alignment")==="map";V(rt,et.posMatrix,g,_,ar,os,Ae,F,ls,Ds)}const Mn=g.translatePosMatrix(et.posMatrix,lt,w,C),on=Be||_&&We||$h?Pm:ar,Ui=g.translatePosMatrix(os,lt,w,C,!0),or=ri&&d.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let lr;lr=ri?rt.iconsInText?$0(ai.kind,Di,Ie,Ae,g,Mn,on,Ui,Ci,Kr):Sm(ai.kind,Di,Ie,Ae,g,Mn,on,Ui,_,Ci,!0):Em(ai.kind,Di,Ie,Ae,g,Mn,on,Ui,_,Ci);const ln={program:Li,buffers:mt,uniformValues:lr,atlasTexture:Hi,atlasTextureIcon:qn,atlasInterpolation:Pi,atlasInterpolationIcon:Yr,isSDF:ri,hasHalo:or};if(fe&&rt.canOverlap){Pe=!0;const Ds=mt.segments.get();for(const ls of Ds)Ze.push({segments:new a.SegmentVector([ls]),sortKey:ls.sortKey,state:ln,terrainData:di})}else Ze.push({segments:mt.segments,sortKey:0,state:ln,terrainData:di})}Pe&&Ze.sort((et,lt)=>et.sortKey-lt.sortKey);for(const et of Ze){const lt=et.state;if($.activeTexture.set(le.TEXTURE0),lt.atlasTexture.bind(lt.atlasInterpolation,le.CLAMP_TO_EDGE),lt.atlasTextureIcon&&($.activeTexture.set(le.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,le.CLAMP_TO_EDGE)),lt.isSDF){const rt=lt.uniformValues;lt.hasHalo&&(rt.u_is_halo=1,Pd(lt.buffers,et.segments,d,g,lt.program,Qe,Q,z,rt,et.terrainData)),rt.u_is_halo=0}Pd(lt.buffers,et.segments,d,g,lt.program,Qe,Q,z,lt.uniformValues,et.terrainData)}}function Pd(g,r,d,f,_,w,C,B,D,F){const Q=f.context;_.draw(Q,Q.gl.TRIANGLES,w,C,B,ji.disabled,D,F,d.id,g.layoutVertexBuffer,g.indexBuffer,r,d.paint,f.transform.zoom,g.programConfigurations.get(d.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Ud(g,r,d,f,_){if(!d||!f||!f.imageAtlas)return;const w=f.imageAtlas.patternPositions;let C=w[d.to.toString()],B=w[d.from.toString()];if(!C||!B){const D=_.getPaintProperty(r);C=w[D],B=w[D]}C&&B&&g.setConstantPatternPositions(C,B)}function Fd(g,r,d,f,_,w,C){const B=g.context.gl,D="fill-pattern",F=d.paint.get(D),Q=F&&F.constantOr(1),z=d.getCrossfadeParameters();let $,le,he,re,Ae;C?(le=Q&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=B.LINES):(le=Q?"fillPattern":"fill",$=B.TRIANGLES);const Be=F.constantOr(null);for(const Ie of f){const fe=r.getTile(Ie);if(Q&&!fe.patternsLoaded())continue;const Pe=fe.getBucket(d);if(!Pe)continue;const Qe=Pe.programConfigurations.get(d.id),We=g.useProgram(le,Qe),Ze=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ie);Q&&(g.context.activeTexture.set(B.TEXTURE0),fe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Qe.updatePaintBuffers(z)),Ud(Qe,D,Be,fe,d);const et=Ze?Ie:null,lt=g.translatePosMatrix(et?et.posMatrix:Ie.posMatrix,fe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(C){re=Pe.indexBuffer2,Ae=Pe.segments2;const rt=[B.drawingBufferWidth,B.drawingBufferHeight];he=le==="fillOutlinePattern"&&Q?Dr(lt,g,z,fe,rt):bm(lt,rt)}else re=Pe.indexBuffer,Ae=Pe.segments,he=Q?zo(lt,g,z,fe):Oo(lt);We.draw(g.context,$,_,g.stencilModeForClipping(Ie),w,ji.disabled,he,Ze,d.id,Pe.layoutVertexBuffer,re,Ae,d.paint,g.transform.zoom,Qe)}}function Bh(g,r,d,f,_,w,C){const B=g.context,D=B.gl,F="fill-extrusion-pattern",Q=d.paint.get(F),z=Q.constantOr(1),$=d.getCrossfadeParameters(),le=d.paint.get("fill-extrusion-opacity"),he=Q.constantOr(null);for(const re of f){const Ae=r.getTile(re),Be=Ae.getBucket(d);if(!Be)continue;const Ie=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),fe=Be.programConfigurations.get(d.id),Pe=g.useProgram(z?"fillExtrusionPattern":"fillExtrusion",fe);z&&(g.context.activeTexture.set(D.TEXTURE0),Ae.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),fe.updatePaintBuffers($)),Ud(fe,F,he,Ae,d);const Qe=g.translatePosMatrix(re.posMatrix,Ae,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),We=d.paint.get("fill-extrusion-vertical-gradient"),Ze=z?H0(Qe,g,We,le,re,$,Ae):_d(Qe,g,We,le);Pe.draw(B,B.gl.TRIANGLES,_,w,C,ji.backCCW,Ze,Ie,d.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,d.paint,g.transform.zoom,fe,g.style.map.terrain&&Be.centroidVertexBuffer)}}function Nm(g,r,d,f,_,w,C){const B=g.context,D=B.gl,F=d.fbo;if(!F)return;const Q=g.useProgram("hillshade"),z=g.style.map.terrain&&g.style.map.terrain.getTerrainData(r);B.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,F.colorAttachment.get()),Q.draw(B,D.TRIANGLES,_,w,C,ji.disabled,(($,le,he,re)=>{const Ae=he.paint.get("hillshade-shadow-color"),Be=he.paint.get("hillshade-highlight-color"),Ie=he.paint.get("hillshade-accent-color");let fe=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);he.paint.get("hillshade-illumination-anchor")==="viewport"&&(fe-=$.transform.angle);const Pe=!$.options.moving;return{u_matrix:re?re.posMatrix:$.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:_h(0,le.tileID),u_light:[he.paint.get("hillshade-exaggeration"),fe],u_shadow:Ae,u_highlight:Be,u_accent:Ie}})(g,d,f,z?r:null),z,f.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}function Om(g,r,d,f,_,w){const C=g.context,B=C.gl,D=r.dem;if(D&&D.data){const F=D.dim,Q=D.stride,z=D.getPixels();if(C.activeTexture.set(B.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||g.getTileTexture(Q),r.demTexture){const le=r.demTexture;le.update(z,{premultiply:!1}),le.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else r.demTexture=new ve(C,z,B.RGBA,{premultiply:!1}),r.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);C.activeTexture.set(B.TEXTURE0);let $=r.fbo;if(!$){const le=new ve(C,{width:F,height:F,data:null},B.RGBA);le.bind(B.LINEAR,B.CLAMP_TO_EDGE),$=r.fbo=C.createFramebuffer(F,F,!0),$.colorAttachment.set(le.texture)}C.bindFramebuffer.set($.framebuffer),C.viewport.set([0,0,F,F]),g.useProgram("hillshadePrepare").draw(C,B.TRIANGLES,f,_,w,ji.disabled,((le,he)=>{const re=he.stride,Ae=a.create();return a.ortho(Ae,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(Ae,Ae,[0,-a.EXTENT,0]),{u_matrix:Ae,u_image:1,u_dimension:[re,re],u_zoom:le.overscaledZ,u_unpack:he.getUnpackVector()}})(r.tileID,D),null,d.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function zl(g,r,d,f,_,w){const C=f.paint.get("raster-fade-duration");if(!w&&C>0){const B=a.exported.now(),D=(B-g.timeAdded)/C,F=r?(B-r.timeAdded)/C:-1,Q=d.getSource(),z=_.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),$=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(g.tileID.overscaledZ-z),le=$&&g.refreshedUponExpiration?1:a.clamp($?D:1-F,0,1);return g.refreshedUponExpiration&&D>=1&&(g.refreshedUponExpiration=!1),r?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}const zm=new a.Color(1,0,0,1),Rs=new a.Color(0,1,0,1),Zs=new a.Color(0,0,1,1),Gm=new a.Color(1,0,1,1),Js=new a.Color(0,1,1,1);function qo(g,r,d,f){Rh(g,0,r+d/2,g.transform.width,d,f)}function Qm(g,r,d,f){Rh(g,r-d/2,0,d,g.transform.height,f)}function Rh(g,r,d,f,_,w){const C=g.context,B=C.gl;B.enable(B.SCISSOR_TEST),B.scissor(r*g.pixelRatio,d*g.pixelRatio,f*g.pixelRatio,_*g.pixelRatio),C.clear({color:w}),B.disable(B.SCISSOR_TEST)}function ty(g,r,d){const f=g.context,_=f.gl,w=d.posMatrix,C=g.useProgram("debug"),B=vi.disabled,D=an.disabled,F=g.colorModeForRenderPass(),Q="$debug",z=g.style.map.terrain&&g.style.map.terrain.getTerrainData(d);f.activeTexture.set(_.TEXTURE0),g.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const $=r.getTileByID(d.key).latestRawTileData,le=Math.floor(($&&$.byteLength||0)/1024),he=r.getTile(d).tileSize,re=512/Math.min(he,512)*(d.overscaledZ/g.transform.zoom)*.5;let Ae=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Ae+=` => ${d.overscaledZ}`),function(Be,Ie){Be.initDebugOverlayCanvas();const fe=Be.debugOverlayCanvas,Pe=Be.context.gl,Qe=Be.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,fe.width,fe.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(Ie,5,5),Qe.strokeText(Ie,5,5),Be.debugOverlayTexture.update(fe),Be.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}(g,`${Ae} ${le}kB`),C.draw(f,_.TRIANGLES,B,D,An.alphaBlended,ji.disabled,kl(w,a.Color.transparent,re),null,Q,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),C.draw(f,_.LINE_STRIP,B,D,F,ji.disabled,kl(w,a.Color.red),z,Q,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function kd(g,r,d){const f=g.context,_=f.gl,w=g.colorModeForRenderPass(),C=new vi(_.LEQUAL,vi.ReadWrite,g.depthRangeFor3D),B=g.useProgram("terrain"),D=r.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,g.width,g.height]);for(const F of d){const Q=g.renderToTexture.getTexture(F),z=r.getTerrainData(F.tileID);f.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,Q.texture);const $={u_matrix:g.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(g.transform.zoom)};B.draw(f,_.TRIANGLES,C,an.disabled,w,ji.backCCW,$,z,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}const $o={symbol:function(g,r,d,f,_){if(g.renderPass!=="translucent")return;const w=an.disabled,C=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(B,D,F,Q,z,$,le){const he=D.transform,re=z==="map",Ae=$==="map";for(const Be of B){const Ie=Q.getTile(Be),fe=Ie.getBucket(F);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const Pe=a.evaluateSizeForZoom(fe.textSizeData,he.zoom),Qe=De(Ie,1,D.transform.zoom),We=li(Be.posMatrix,Ae,re,D.transform,Qe),Ze=F.layout.get("icon-text-fit")!=="none"&&fe.hasIconData();if(Pe){const et=Math.pow(2,he.zoom-Ie.tileID.overscaledZ);Fm(fe,re,Ae,le,he,We,Be.posMatrix,et,Pe,Ze,D.style.map.terrain?(lt,rt)=>D.style.map.terrain.getElevation(Be,lt,rt):null)}}}(f,g,d,r,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),_),d.paint.get("icon-opacity").constantOr(1)!==0&&ya(g,r,d,f,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),w,C),d.paint.get("text-opacity").constantOr(1)!==0&&ya(g,r,d,f,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),w,C),r.map.showCollisionBoxes&&(Dd(g,r,d,f,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),Dd(g,r,d,f,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,r,d,f){if(g.renderPass!=="translucent")return;const _=d.paint.get("circle-opacity"),w=d.paint.get("circle-stroke-width"),C=d.paint.get("circle-stroke-opacity"),B=!d.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(w.constantOr(1)===0||C.constantOr(1)===0))return;const D=g.context,F=D.gl,Q=g.depthModeForSublayer(0,vi.ReadOnly),z=an.disabled,$=g.colorModeForRenderPass(),le=[];for(let he=0;he<f.length;he++){const re=f[he],Ae=r.getTile(re),Be=Ae.getBucket(d);if(!Be)continue;const Ie=Be.programConfigurations.get(d.id),fe=g.useProgram("circle",Ie),Pe=Be.layoutVertexBuffer,Qe=Be.indexBuffer,We=g.style.map.terrain&&g.style.map.terrain.getTerrainData(re),Ze={programConfiguration:Ie,program:fe,layoutVertexBuffer:Pe,indexBuffer:Qe,uniformValues:yd(g,re,Ae,d),terrainData:We};if(B){const et=Be.segments.get();for(const lt of et)le.push({segments:new a.SegmentVector([lt]),sortKey:lt.sortKey,state:Ze})}else le.push({segments:Be.segments,sortKey:0,state:Ze})}B&&le.sort((he,re)=>he.sortKey-re.sortKey);for(const he of le){const{programConfiguration:re,program:Ae,layoutVertexBuffer:Be,indexBuffer:Ie,uniformValues:fe,terrainData:Pe}=he.state;Ae.draw(D,F.TRIANGLES,Q,z,$,ji.disabled,fe,Pe,d.id,Be,Ie,he.segments,d.paint,g.transform.zoom,re)}},heatmap:function(g,r,d,f){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const _=g.context,w=_.gl,C=an.disabled,B=new An([w.ONE,w.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(D,F,Q){const z=D.gl;D.activeTexture.set(z.TEXTURE1),D.viewport.set([0,0,F.width/4,F.height/4]);let $=Q.heatmapFbo;if($)z.bindTexture(z.TEXTURE_2D,$.colorAttachment.get()),D.bindFramebuffer.set($.framebuffer);else{const le=z.createTexture();z.bindTexture(z.TEXTURE_2D,le),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.LINEAR),$=Q.heatmapFbo=D.createFramebuffer(F.width/4,F.height/4,!1),function(he,re,Ae,Be){const Ie=he.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,Ie.RGBA,re.width/4,re.height/4,0,Ie.RGBA,he.extRenderToTextureHalfFloat?he.extTextureHalfFloat.HALF_FLOAT_OES:Ie.UNSIGNED_BYTE,null),Be.colorAttachment.set(Ae)}(D,F,le,$)}})(_,g,d),_.clear({color:a.Color.transparent});for(let D=0;D<f.length;D++){const F=f[D];if(r.hasRenderableParent(F))continue;const Q=r.getTile(F),z=Q.getBucket(d);if(!z)continue;const $=z.programConfigurations.get(d.id),le=g.useProgram("heatmap",$),{zoom:he}=g.transform;le.draw(_,w.TRIANGLES,vi.disabled,C,B,ji.disabled,xd(F.posMatrix,Q,he,d.paint.get("heatmap-intensity")),null,d.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,d.paint,g.transform.zoom,$)}_.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(_,w){const C=_.context,B=C.gl,D=w.heatmapFbo;if(!D)return;C.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,D.colorAttachment.get()),C.activeTexture.set(B.TEXTURE1);let F=w.colorRampTexture;F||(F=w.colorRampTexture=new ve(C,w.colorRamp,B.RGBA)),F.bind(B.LINEAR,B.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(C,B.TRIANGLES,vi.disabled,an.disabled,_.colorModeForRenderPass(),ji.disabled,((Q,z,$,le)=>{const he=a.create();a.ortho(he,0,Q.width,Q.height,0,0,1);const re=Q.context.gl;return{u_matrix:he,u_world:[re.drawingBufferWidth,re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}})(_,w),null,w.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,w.paint,_.transform.zoom)}(g,d))},line:function(g,r,d,f){if(g.renderPass!=="translucent")return;const _=d.paint.get("line-opacity"),w=d.paint.get("line-width");if(_.constantOr(1)===0||w.constantOr(1)===0)return;const C=g.depthModeForSublayer(0,vi.ReadOnly),B=g.colorModeForRenderPass(),D=d.paint.get("line-dasharray"),F=d.paint.get("line-pattern"),Q=F.constantOr(1),z=d.paint.get("line-gradient"),$=d.getCrossfadeParameters(),le=Q?"linePattern":D?"lineSDF":z?"lineGradient":"line",he=g.context,re=he.gl;let Ae=!0;for(const Be of f){const Ie=r.getTile(Be);if(Q&&!Ie.patternsLoaded())continue;const fe=Ie.getBucket(d);if(!fe)continue;const Pe=fe.programConfigurations.get(d.id),Qe=g.context.program.get(),We=g.useProgram(le,Pe),Ze=Ae||We.program!==Qe,et=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Be),lt=F.constantOr(null);if(lt&&Ie.imageAtlas){const Pt=Ie.imageAtlas,ri=Pt.patternPositions[lt.to.toString()],ai=Pt.patternPositions[lt.from.toString()];ri&&ai&&Pe.setConstantPatternPositions(ri,ai)}const rt=et?Be:null,mt=Q?yh(g,Ie,d,$,rt):D?wm(g,Ie,d,D,$,rt):z?vd(g,Ie,d,fe.lineClipsArray.length,rt):Nl(g,Ie,d,rt);if(Q)he.activeTexture.set(re.TEXTURE0),Ie.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Pe.updatePaintBuffers($);else if(D&&(Ze||g.lineAtlas.dirty))he.activeTexture.set(re.TEXTURE0),g.lineAtlas.bind(he);else if(z){const Pt=fe.gradients[d.id];let ri=Pt.texture;if(d.gradientVersion!==Pt.version){let ai=256;if(d.stepInterpolant){const Ut=r.getSource().maxzoom,Li=Be.canonical.z===Ut?Math.ceil(1<<g.transform.maxZoom-Be.canonical.z):1;ai=a.clamp(a.nextPowerOfTwo(fe.maxLineLength/a.EXTENT*1024*Li),256,he.maxTextureSize)}Pt.gradient=a.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:ai,image:Pt.gradient||void 0,clips:fe.lineClipsArray}),Pt.texture?Pt.texture.update(Pt.gradient):Pt.texture=new ve(he,Pt.gradient,re.RGBA),Pt.version=d.gradientVersion,ri=Pt.texture}he.activeTexture.set(re.TEXTURE0),ri.bind(d.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}We.draw(he,re.TRIANGLES,C,g.stencilModeForClipping(Be),B,ji.disabled,mt,et,d.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,d.paint,g.transform.zoom,Pe,fe.layoutVertexBuffer2),Ae=!1}},fill:function(g,r,d,f){const _=d.paint.get("fill-color"),w=d.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const C=g.colorModeForRenderPass(),B=d.paint.get("fill-pattern"),D=g.opaquePassEnabledForLayer()&&!B.constantOr(1)&&_.constantOr(a.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===D){const F=g.depthModeForSublayer(1,g.renderPass==="opaque"?vi.ReadWrite:vi.ReadOnly);Fd(g,r,d,f,F,C,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const F=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,vi.ReadOnly);Fd(g,r,d,f,F,C,!0)}},"fill-extrusion":function(g,r,d,f){const _=d.paint.get("fill-extrusion-opacity");if(_!==0&&g.renderPass==="translucent"){const w=new vi(g.context.gl.LEQUAL,vi.ReadWrite,g.depthRangeFor3D);if(_!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Bh(g,r,d,f,w,an.disabled,An.disabled),Bh(g,r,d,f,w,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const C=g.colorModeForRenderPass();Bh(g,r,d,f,w,an.disabled,C)}}},hillshade:function(g,r,d,f){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const _=g.context,w=g.depthModeForSublayer(0,vi.ReadOnly),C=g.colorModeForRenderPass(),[B,D]=g.renderPass==="translucent"?g.stencilConfigForOverlap(f):[{},f];for(const F of D){const Q=r.getTile(F);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&g.renderPass==="offscreen"?Om(g,Q,d,w,an.disabled,C):g.renderPass==="translucent"&&Nm(g,F,Q,d,w,B[F.overscaledZ],C)}_.viewport.set([0,0,g.width,g.height])},raster:function(g,r,d,f){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!f.length)return;const _=g.context,w=_.gl,C=r.getSource(),B=g.useProgram("raster"),D=g.colorModeForRenderPass(),[F,Q]=C instanceof Dt?[{},f]:g.stencilConfigForOverlap(f),z=Q[Q.length-1].overscaledZ,$=!g.options.moving;for(const le of Q){const he=g.depthModeForSublayer(le.overscaledZ-z,d.paint.get("raster-opacity")===1?vi.ReadWrite:vi.ReadOnly,w.LESS),re=r.getTile(le);re.registerFadeDuration(d.paint.get("raster-fade-duration"));const Ae=r.findLoadedParent(le,0),Be=zl(re,Ae,r,d,g.transform,g.style.map.terrain);let Ie,fe;const Pe=d.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;_.activeTexture.set(w.TEXTURE0),re.texture.bind(Pe,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(w.TEXTURE1),Ae?(Ae.texture.bind(Pe,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Ie=Math.pow(2,Ae.tileID.overscaledZ-re.tileID.overscaledZ),fe=[re.tileID.canonical.x*Ie%1,re.tileID.canonical.y*Ie%1]):re.texture.bind(Pe,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);const Qe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(le),We=Qe?le:null,Ze=We?We.posMatrix:g.transform.calculatePosMatrix(le.toUnwrapped(),$),et=W0(Ze,fe||[0,0],Ie||1,Be,d);C instanceof Dt?B.draw(_,w.TRIANGLES,he,an.disabled,D,ji.disabled,et,Qe,d.id,C.boundsBuffer,g.quadTriangleIndexBuffer,C.boundsSegments):B.draw(_,w.TRIANGLES,he,F[le.overscaledZ],D,ji.disabled,et,Qe,d.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}},background:function(g,r,d,f){const _=d.paint.get("background-color"),w=d.paint.get("background-opacity");if(w===0)return;const C=g.context,B=C.gl,D=g.transform,F=D.tileSize,Q=d.paint.get("background-pattern");if(g.isPatternMissing(Q))return;const z=!Q&&_.a===1&&w===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==z)return;const $=an.disabled,le=g.depthModeForSublayer(0,z==="opaque"?vi.ReadWrite:vi.ReadOnly),he=g.colorModeForRenderPass(),re=g.useProgram(Q?"backgroundPattern":"background"),Ae=f||D.coveringTiles({tileSize:F,terrain:g.style.map.terrain});Q&&(C.activeTexture.set(B.TEXTURE0),g.imageManager.bind(g.context));const Be=d.getCrossfadeParameters();for(const Ie of Ae){const fe=f?Ie.posMatrix:g.transform.calculatePosMatrix(Ie.toUnwrapped()),Pe=Q?wd(fe,w,g,Q,{tileID:Ie,tileSize:F},Be):j0(fe,w,_),Qe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Ie);re.draw(C,B.TRIANGLES,le,$,he,ji.disabled,Pe,Qe,d.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}},debug:function(g,r,d){for(let f=0;f<d.length;f++)ty(g,r,d[f])},custom:function(g,r,d){const f=g.context,_=d.implementation;if(g.renderPass==="offscreen"){const w=_.prerender;w&&(g.setCustomLayerDefaults(),f.setColorMode(g.colorModeForRenderPass()),w.call(_,f.gl,g.transform.customLayerMatrix()),f.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),f.setColorMode(g.colorModeForRenderPass()),f.setStencilMode(an.disabled);const w=_.renderingMode==="3d"?new vi(g.context.gl.LEQUAL,vi.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,vi.ReadOnly);f.setDepthMode(w),_.render(f.gl,g.transform.customLayerMatrix()),f.setDirty(),g.setBaseState(),f.bindFramebuffer.set(null)}}};class xa{constructor(r,d){this.context=new Mh(r),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.create(),renderTime:0},this.setup(),this.numSublayers=Ue.maxUnderzooming+Ue.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sn,this.gpuTimers={}}resize(r,d,f){if(this.width=r*f,this.height=d*f,this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const r=this.context,d=new a.PosArray;d.emplaceBack(0,0),d.emplaceBack(a.EXTENT,0),d.emplaceBack(0,a.EXTENT),d.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(d,mh.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.PosArray;f.emplaceBack(0,0),f.emplaceBack(a.EXTENT,0),f.emplaceBack(0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=r.createVertexBuffer(f,mh.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const _=new a.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(a.EXTENT,0,a.EXTENT,0),_.emplaceBack(0,a.EXTENT,0,a.EXTENT),_.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(_,kt.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const w=new a.PosArray;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(w,mh.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const C=new a.LineStripIndexArray;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(C);const B=new a.TriangleIndexArray;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(B),this.emptyTexture=new ve(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA);const D=this.context.gl;this.stencilClearMode=new an({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const r=this.context,d=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=a.create();a.ortho(f,0,this.width,this.height,0,0,1),a.scale(f,f,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,d.TRIANGLES,vi.disabled,this.stencilClearMode,An.disabled,ji.disabled,Ah(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,d){if(this.currentStencilSource===r.source||!r.isTileClipped()||!d||!d.length)return;this.currentStencilSource=r.source;const f=this.context,_=f.gl;this.nextStencilID+d.length>256&&this.clearStencil(),f.setColorMode(An.disabled),f.setDepthMode(vi.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of d){const B=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);w.draw(f,_.TRIANGLES,vi.disabled,new an({func:_.ALWAYS,mask:0},B,255,_.KEEP,_.KEEP,_.REPLACE),An.disabled,ji.disabled,Ah(C.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,d=this.context.gl;return new an({func:d.NOTEQUAL,mask:255},r,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(r){const d=this.context.gl;return new an({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(r){const d=this.context.gl,f=r.sort((C,B)=>B.overscaledZ-C.overscaledZ),_=f[f.length-1].overscaledZ,w=f[0].overscaledZ-_+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const C={};for(let B=0;B<w;B++)C[B+_]=new an({func:d.GEQUAL,mask:255},B+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=w,[C,f]}return[{[_]:an.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new An([r.CONSTANT_COLOR,r.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?An.unblended:An.alphaBlended}depthModeForSublayer(r,d,f){if(!this.opaquePassEnabledForLayer())return vi.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new vi(f||this.context.gl.LEQUAL,d,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,d){this.style=r,this.options=d,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const f=this.style._order,_=this.style.sourceCaches,w={},C={},B={};for(const D in _){const F=_[D];F.used&&F.prepare(this.context),w[D]=F.getVisibleCoordinates(),C[D]=w[D].slice().reverse(),B[D]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<f.length;D++)if(this.style._layers[f[D]].is3D()){this.opaquePassCutoff=D;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const D=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!a.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||D.length)&&(a.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(F,Q){const z=F.context,$=z.gl,le=An.unblended,he=new vi($.LEQUAL,vi.ReadWrite,[0,1]),re=Q.getTerrainMesh(),Ae=Q.sourceCache.getRenderableTiles(),Be=F.useProgram("terrainDepth");z.bindFramebuffer.set(Q.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),z.clear({color:a.Color.transparent,depth:1});for(const Ie of Ae){const fe=Q.getTerrainData(Ie.tileID),Pe={u_matrix:F.transform.calculatePosMatrix(Ie.tileID.toUnwrapped()),u_ele_delta:Q.getMeshFrameDelta(F.transform.zoom)};Be.draw(z,$.TRIANGLES,he,an.disabled,le,ji.backCCW,Pe,fe,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain),function(F,Q){const z=F.context,$=z.gl,le=An.unblended,he=new vi($.LEQUAL,vi.ReadWrite,[0,1]),re=Q.getTerrainMesh(),Ae=Q.getCoordsTexture(),Be=Q.sourceCache.getRenderableTiles(),Ie=F.useProgram("terrainCoords");z.bindFramebuffer.set(Q.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,F.width/devicePixelRatio,F.height/devicePixelRatio]),z.clear({color:a.Color.transparent,depth:1}),Q.coordsIndex=[];for(const fe of Be){const Pe=Q.getTerrainData(fe.tileID);z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Ae.texture);const Qe={u_matrix:F.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_terrain_coords_id:(255-Q.coordsIndex.length)/255,u_texture:0,u_ele_delta:Q.getMeshFrameDelta(F.transform.zoom)};Ie.draw(z,$.TRIANGLES,he,an.disabled,le,ji.backCCW,Qe,Pe,"terrain",re.vertexBuffer,re.indexBuffer,re.segments),Q.coordsIndex.push(fe.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,F.width,F.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const D of f){const F=this.style._layers[D];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const Q=C[F.source];(F.type==="custom"||Q.length)&&this.renderLayer(this,_[F.source],F,Q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[f[this.currentLayer]],F=_[D.source],Q=w[D.source];this._renderTileClippingMasks(D,Q),this.renderLayer(this,F,D,Q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const D=this.style._layers[f[this.currentLayer]],F=_[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const Q=(D.type==="symbol"?B:C)[D.source];this._renderTileClippingMasks(D,w[D.source]),this.renderLayer(this,F,D,Q)}if(this.options.showTileBoundaries){const D=function(F,Q){let z=null;const $=Object.values(F._layers).flatMap(Ae=>Ae.source&&!Ae.isHidden(Q)?[F.sourceCaches[Ae.source]]:[]),le=$.filter(Ae=>Ae.getSource().type==="vector"),he=$.filter(Ae=>Ae.getSource().type!=="vector"),re=Ae=>{(!z||z.getSource().maxzoom<Ae.getSource().maxzoom)&&(z=Ae)};return le.forEach(Ae=>re(Ae)),z||he.forEach(Ae=>re(Ae)),z}(this.style,this.transform.zoom);D&&$o.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const F=D.transform.padding;qo(D,D.transform.height-(F.top||0),3,zm),qo(D,F.bottom||0,3,Rs),Qm(D,F.left||0,3,Zs),Qm(D,D.transform.width-(F.right||0),3,Gm);const Q=D.transform.centerPoint;(function(z,$,le,he){Rh(z,$-1,le-10,2,20,he),Rh(z,$-10,le-1,20,2,he)})(D,Q.x,D.transform.height-Q.y,Js)}(this),this.context.setDefault()}renderLayer(r,d,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(_||[]).length)&&(this.id=f.id,this.gpuTimingStart(f),$o[f.type](r,d,f,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let f=this.gpuTimers[r.id];f||(f=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),f.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const d={};for(const f in r){const _=r[f],w=this.context.extTimerQuery,C=w.getQueryObjectEXT(_.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(_.query),d[f]=C}return d}translatePosMatrix(r,d,f,_,w){if(!f[0]&&!f[1])return r;const C=w?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(C){const F=Math.sin(C),Q=Math.cos(C);f=[f[0]*Q-f[1]*F,f[0]*F+f[1]*Q]}const B=[w?f[0]:De(d,f[0],this.transform.zoom),w?f[1]:De(d,f[1],this.transform.zoom),0],D=new Float32Array(16);return a.translate(D,r,B),D}saveTileTexture(r){const d=this._tileTextures[r.size[0]];d?d.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const d=this._tileTextures[r];return d&&d.length>0?d.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const d=this.imageManager.getPattern(r.from.toString()),f=this.imageManager.getPattern(r.to.toString());return!d||!f}useProgram(r,d){this.cache=this.cache||{};const f=r+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new gd(this.context,r,Ul[r],d,xh[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ve(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Lt{constructor(r,d){this.points=r,this.planes=d}static fromInvProjectionMatrix(r,d,f){const _=Math.pow(2,f),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const D=1/(B=a.transformMat4([],B,r))[3]/d*_;return a.mul$1(B,B,[D,D,1/B[3],D])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const D=function($,le){var he=le[0],re=le[1],Ae=le[2],Be=he*he+re*re+Ae*Ae;return Be>0&&(Be=1/Math.sqrt(Be)),$[0]=le[0]*Be,$[1]=le[1]*Be,$[2]=le[2]*Be,$}([],function($,le,he){var re=le[0],Ae=le[1],Be=le[2],Ie=he[0],fe=he[1],Pe=he[2];return $[0]=Ae*Pe-Be*fe,$[1]=Be*Ie-re*Pe,$[2]=re*fe-Ae*Ie,$}([],Ve([],w[B[0]],w[B[1]]),Ve([],w[B[2]],w[B[1]]))),F=-((Q=D)[0]*(z=w[B[1]])[0]+Q[1]*z[1]+Q[2]*z[2]);var Q,z;return D.concat(F)});return new Lt(w,C)}}class Gl{constructor(r,d){this.min=r,this.max=d,this.center=function(f,_,w){return f[0]=.5*_[0],f[1]=.5*_[1],f[2]=.5*_[2],f}([],function(f,_,w){return f[0]=_[0]+w[0],f[1]=_[1]+w[1],f[2]=_[2]+w[2],f}([],this.min,this.max))}quadrant(r){const d=[r%2==0,r<2],f=K(this.min),_=K(this.max);for(let w=0;w<d.length;w++)f[w]=d[w]?this.min[w]:this.center[w],_[w]=d[w]?this.center[w]:this.max[w];return _[2]=this.max[2],new Gl(f,_)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let _=0;_<r.planes.length;_++){const w=r.planes[_];let C=0;for(let B=0;B<d.length;B++)a.dot(w,d[B])>=0&&C++;if(C===0)return 0;C!==d.length&&(f=!1)}if(f)return 2;for(let _=0;_<3;_++){let w=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let B=0;B<r.points.length;B++){const D=r.points[B][_]-this.min[_];w=Math.min(w,D),C=Math.max(C,D)}if(C<0||w>this.max[_]-this.min[_])return 0}return 1}}class Ja{constructor(r=0,d=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(d)||d<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=d,this.left=f,this.right=_}interpolate(r,d,f){return d.top!=null&&r.top!=null&&(this.top=a.number(r.top,d.top,f)),d.bottom!=null&&r.bottom!=null&&(this.bottom=a.number(r.bottom,d.bottom,f)),d.left!=null&&r.left!=null&&(this.left=a.number(r.left,d.left,f)),d.right!=null&&r.right!=null&&(this.right=a.number(r.right,d.right,f)),this}getCenter(r,d){const f=a.clamp((this.left+r-this.right)/2,0,r),_=a.clamp((this.top+d-this.bottom)/2,0,d);return new a.pointGeometry(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Ja(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class eo{constructor(r,d,f,_,w){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=w===void 0||!!w,this._minZoom=r||0,this._maxZoom=d||22,this._minPitch=f??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ja,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const r=new eo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r._center=this._center,r._elevation=this._elevation,r.zoom=this.zoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const d=-a.wrap(r,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var f=new a.ARRAY_TYPE(4);return a.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,_,w){var C=_[0],B=_[1],D=_[2],F=_[3],Q=Math.sin(w),z=Math.cos(w);f[0]=C*z+D*Q,f[1]=B*z+F*Q,f[2]=C*-Q+D*z,f[3]=B*-Q+F*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const d=a.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const d=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,d,f){this._unmodified=!1,this._edgeInsets.interpolate(r,d,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const d=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(r){const d=[new a.UnwrappedTileID(0,r)];if(this._renderWorldCopies){const f=this.pointCoordinate(new a.pointGeometry(0,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,0)),w=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),C=this.pointCoordinate(new a.pointGeometry(0,this.height)),B=Math.floor(Math.min(f.x,_.x,w.x,C.x)),D=Math.floor(Math.max(f.x,_.x,w.x,C.x)),F=1;for(let Q=B-F;Q<=D+F;Q++)Q!==0&&d.push(new a.UnwrappedTileID(Q,r))}return d}coveringTiles(r){var d,f;let _=this.coveringZoomLevel(r);const w=_;if(r.minzoom!==void 0&&_<r.minzoom)return[];r.maxzoom!==void 0&&_>r.maxzoom&&(_=r.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),B=a.MercatorCoordinate.fromLngLat(this.center),D=Math.pow(2,_),F=[D*C.x,D*C.y,0],Q=[D*B.x,D*B.y,0],z=Lt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let $=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=_);const le=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,he=fe=>({aabb:new Gl([fe*D,0,0],[(fe+1)*D,D,0]),zoom:0,x:0,y:0,wrap:fe,fullyVisible:!1}),re=[],Ae=[],Be=_,Ie=r.reparseOverscaled?w:_;if(this._renderWorldCopies)for(let fe=1;fe<=3;fe++)re.push(he(-fe)),re.push(he(fe));for(re.push(he(0));re.length>0;){const fe=re.pop(),Pe=fe.x,Qe=fe.y;let We=fe.fullyVisible;if(!We){const mt=fe.aabb.intersects(z);if(mt===0)continue;We=mt===2}const Ze=r.terrain?F:Q,et=fe.aabb.distanceX(Ze),lt=fe.aabb.distanceY(Ze),rt=Math.max(Math.abs(et),Math.abs(lt));if(fe.zoom===Be||rt>le+(1<<Be-fe.zoom)-2&&fe.zoom>=$){const mt=Be-fe.zoom,Pt=F[0]-.5-(Pe<<mt),ri=F[1]-.5-(Qe<<mt);Ae.push({tileID:new a.OverscaledTileID(fe.zoom===Be?Ie:fe.zoom,fe.wrap,fe.zoom,Pe,Qe),distanceSq:Ne([Q[0]-.5-Pe,Q[1]-.5-Qe]),tileDistanceToCamera:Math.sqrt(Pt*Pt+ri*ri)})}else for(let mt=0;mt<4;mt++){const Pt=(Pe<<1)+mt%2,ri=(Qe<<1)+(mt>>1),ai=fe.zoom+1;let Ut=fe.aabb.quadrant(mt);if(r.terrain){const Li=new a.OverscaledTileID(ai,fe.wrap,ai,Pt,ri),Di=r.terrain.getMinMaxElevation(Li),di=(d=Di.minElevation)!==null&&d!==void 0?d:this.elevation,Ci=(f=Di.maxElevation)!==null&&f!==void 0?f:this.elevation;Ut=new Gl([Ut.min[0],Ut.min[1],di],[Ut.max[0],Ut.max[1],Ci])}re.push({aabb:Ut,zoom:ai,x:Pt,y:ri,wrap:fe.wrap,fullyVisible:We})}}return Ae.sort((fe,Pe)=>fe.distanceSq-Pe.distanceSq).map(fe=>fe.tileID)}resize(r,d){this.width=r,this.height=d,this.pixelsToGLUnits=[2/r,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const d=a.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(r.lng)*this.worldSize,a.mercatorYfromLat(d)*this.worldSize)}unproject(r){return new a.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(r){this.freezeElevation||(this.elevation=r?this.getElevation(this._center,r):0)}getElevation(r,d){const f=a.MercatorCoordinate.fromLngLat(r),_=(1<<this.tileZoom)*a.EXTENT,w=f.x*_,C=f.y*_,B=Math.floor(w/a.EXTENT),D=Math.floor(C/a.EXTENT),F=new a.OverscaledTileID(this.tileZoom,0,this.tileZoom,B,D);return d.getElevation(F,w%a.EXTENT,C%a.EXTENT,a.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const d=this.pointLocation(this.centerPoint,r),f=this.getElevation(d,r);if(!(this.elevation-f))return;const _=this.getCameraPosition(),w=a.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),C=a.MercatorCoordinate.fromLngLat(d,f),B=w.x-C.x,D=w.y-C.y,F=w.z-C.z,Q=Math.sqrt(B*B+D*D+F*F),z=this.scaleZoom(this.cameraToCenterDistance/Q/this.tileSize);this._elevation=f,this._center=d,this.zoom=z}setLocationAtPoint(r,d){const f=this.pointCoordinate(d),_=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(r),C=new a.MercatorCoordinate(w.x-(f.x-_.x),w.y-(f.y-_.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,d){return d?this.coordinatePoint(this.locationCoordinate(r),this.getElevation(r,d),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,d){return this.coordinateLocation(this.pointCoordinate(r,d))}locationCoordinate(r){return a.MercatorCoordinate.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,d){if(d){const $=d.pointCoordinate(r);if($!=null)return $}const f=[r.x,r.y,0,1],_=[r.x,r.y,1,1];a.transformMat4(f,f,this.pixelMatrixInverse),a.transformMat4(_,_,this.pixelMatrixInverse);const w=f[3],C=_[3],B=f[1]/w,D=_[1]/C,F=f[2]/w,Q=_[2]/C,z=F===Q?0:(0-F)/(Q-F);return new a.MercatorCoordinate(a.number(f[0]/w,_[0]/C,z)/this.worldSize,a.number(B,D,z)/this.worldSize)}coordinatePoint(r,d=0,f=this.pixelMatrix){const _=[r.x*this.worldSize,r.y*this.worldSize,d,1];return a.transformMat4(_,_,f),new a.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new a.LngLatBounds().extend(this.pointLocation(new a.pointGeometry(0,r))).extend(this.pointLocation(new a.pointGeometry(this.width,r))).extend(this.pointLocation(new a.pointGeometry(this.width,this.height))).extend(this.pointLocation(new a.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(r,d=!1){const f=r.key,_=d?this._alignedPosMatrixCache:this._posMatrixCache;if(_[f])return _[f];const w=r.canonical,C=this.worldSize/this.zoomScale(w.z),B=w.x+Math.pow(2,w.z)*r.wrap,D=a.identity(new Float64Array(16));return a.translate(D,D,[B*C,w.y*C,0]),a.scale(D,D,[C/a.EXTENT,C/a.EXTENT,1]),a.multiply(D,d?this.alignedProjMatrix:this.projMatrix,D),_[f]=new Float32Array(D),_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,d,f,_,w=-90,C=90,B=-180,D=180;const F=this.size,Q=this._unmodified;if(this.latRange){const le=this.latRange;w=a.mercatorYfromLat(le[1])*this.worldSize,C=a.mercatorYfromLat(le[0])*this.worldSize,r=C-w<F.y?F.y/(C-w):0}if(this.lngRange){const le=this.lngRange;B=a.wrap(a.mercatorXfromLng(le[0])*this.worldSize,0,this.worldSize),D=a.wrap(a.mercatorXfromLng(le[1])*this.worldSize,0,this.worldSize),D<B&&(D+=this.worldSize),d=D-B<F.x?F.x/(D-B):0}const z=this.point,$=Math.max(d||0,r||0);if($)return this.center=this.unproject(new a.pointGeometry(d?(D+B)/2:z.x,r?(C+w)/2:z.y)),this.zoom+=this.scaleZoom($),this._unmodified=Q,void(this._constraining=!1);if(this.latRange){const le=z.y,he=F.y/2;le-he<w&&(_=w+he),le+he>C&&(_=C-he)}if(this.lngRange){const le=(B+D)/2,he=a.wrap(z.x,le-this.worldSize/2,le+this.worldSize/2),re=F.x/2;he-re<B&&(f=B+re),he+re>D&&(f=D-re)}f===void 0&&_===void 0||(this.center=this.unproject(new a.pointGeometry(f!==void 0?f:z.x,_!==void 0?_:z.y)).wrap()),this._unmodified=Q,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,d=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=a.identity(new Float64Array(16));a.scale(_,_,[this.width/2,-this.height/2,1]),a.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=a.identity(new Float64Array(16)),a.scale(_,_,[1,-1,1]),a.translate(_,_,[-1,-1,0]),a.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const w=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,C=Math.PI/2+this._pitch,B=this._fov*(.5+r.y/this.height),D=Math.sin(B)*w/Math.sin(a.clamp(Math.PI-C-B,.01,Math.PI-.01)),F=this.getHorizon(),Q=2*Math.atan(F/this.cameraToCenterDistance)*(.5+r.y/(2*F)),z=Math.sin(Q)*w/Math.sin(a.clamp(Math.PI-C-Q,.01,Math.PI-.01)),$=Math.min(D,z),le=1.01*(Math.cos(Math.PI/2-this._pitch)*$+w),he=this.height/50;_=new Float64Array(16),a.perspective(_,this._fov,this.width/this.height,he,le),_[8]=2*-r.x/this.width,_[9]=2*r.y/this.height,a.scale(_,_,[1,-1,1]),a.translate(_,_,[0,0,-this.cameraToCenterDistance]),a.rotateX(_,_,this._pitch),a.rotateZ(_,_,this.angle),a.translate(_,_,[-d,-f,0]),this.mercatorMatrix=a.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),a.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,_),a.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=a.invert([],_),this.pixelMatrix3D=a.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const re=this.width%2/2,Ae=this.height%2/2,Be=Math.cos(this.angle),Ie=Math.sin(this.angle),fe=d-Math.round(d)+Be*re+Ie*Ae,Pe=f-Math.round(f)+Be*Ae+Ie*re,Qe=new Float64Array(_);if(a.translate(Qe,Qe,[fe>.5?fe-1:fe,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=Qe,_=a.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new a.pointGeometry(0,0)),d=[r.x*this.worldSize,r.y*this.worldSize,0,1];return a.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,r))}getCameraQueryGeometry(r){const d=this.getCameraPoint();if(r.length===1)return[r[0],d];{let f=d.x,_=d.y,w=d.x,C=d.y;for(const B of r)f=Math.min(f,B.x),_=Math.min(_,B.y),w=Math.max(w,B.x),C=Math.max(C,B.y);return[new a.pointGeometry(f,_),new a.pointGeometry(w,_),new a.pointGeometry(w,C),new a.pointGeometry(f,C),new a.pointGeometry(f,_)]}}}class Vm{constructor(r){this._hashName=r&&encodeURIComponent(r),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(d,f){let _=!1,w=null;const C=()=>{w=null,_&&(d(),w=setTimeout(C,300),_=!1)};return()=>(_=!0,w||C(),w)}(this._updateHashUnthrottled.bind(this))}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const d=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,_),C=Math.round(d.lng*w)/w,B=Math.round(d.lat*w)/w,D=this._map.getBearing(),F=this._map.getPitch();let Q="";if(Q+=r?`/${C}/${B}/${f}`:`${f}/${B}/${C}`,(D||F)&&(Q+="/"+Math.round(10*D)/10),F&&(Q+=`/${Math.round(F)}`),this._hashName){const z=this._hashName;let $=!1;const le=window.location.hash.slice(1).split("&").map(he=>{const re=he.split("=")[0];return re===z?($=!0,`${re}=${Q}`):he}).filter(he=>he);return $||le.push(`${z}=${Q}`),`#${le.join("&")}`}return`#${Q}`}_getCurrentHash(){const r=window.location.hash.replace("#","");if(this._hashName){let d;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(d=f)}),(d&&d[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:d,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,r)}catch{}}}const vt={linearity:.3,easing:a.bezier(0,0,.3,1)},Nd=a.extend({deceleration:2500,maxSpeed:1400},vt),iy=a.extend({deceleration:20,maxSpeed:1400},vt),ny=a.extend({deceleration:1e3,maxSpeed:360},vt),Od=a.extend({deceleration:1e3,maxSpeed:90},vt);class Hm{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,d=a.exported.now();for(;r.length>0&&d-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)d.zoom+=w.zoomDelta||0,d.bearing+=w.bearingDelta||0,d.pitch+=w.pitchDelta||0,w.panDelta&&d.pan._add(w.panDelta),w.around&&(d.around=w.around),w.pinchAround&&(d.pinchAround=w.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(d.pan.mag()){const w=Lh(d.pan.mag(),f,a.extend({},Nd,r||{}));_.offset=d.pan.mult(w.amount/d.pan.mag()),_.center=this._map.transform.center,Ql(_,w)}if(d.zoom){const w=Lh(d.zoom,f,iy);_.zoom=this._map.transform.zoom+w.amount,Ql(_,w)}if(d.bearing){const w=Lh(d.bearing,f,ny);_.bearing=this._map.transform.bearing+a.clamp(w.amount,-179,179),Ql(_,w)}if(d.pitch){const w=Lh(d.pitch,f,Od);_.pitch=this._map.transform.pitch+w.amount,Ql(_,w)}if(_.zoom||_.bearing){const w=d.pinchAround===void 0?d.around:d.pinchAround;_.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),a.extend(_,{noMoveStart:!0})}}function Ql(g,r){(!g.duration||g.duration<r.duration)&&(g.duration=r.duration,g.easing=r.easing)}function Lh(g,r,d){const{maxSpeed:f,linearity:_,deceleration:w}=d,C=a.clamp(g*_/(r/1e3),-f,f),B=Math.abs(C)/(w*_);return{easing:d.easing,duration:1e3*B,amount:C*(B/2)}}class Xr extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,f,_={}){const w=E.mousePos(d.getCanvasContainer(),f),C=d.unproject(w);super(r,a.extend({point:w,lngLat:C,originalEvent:f},_)),this._defaultPrevented=!1,this.target=d}}class jo extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,f){const _=r==="touchend"?f.changedTouches:f.touches,w=E.touchPos(d.getCanvasContainer(),_),C=w.map(D=>d.unproject(D)),B=w.reduce((D,F,Q,z)=>D.add(F.div(z.length)),new a.pointGeometry(0,0));super(r,{points:w,point:B,lngLats:C,lngLat:d.unproject(B),originalEvent:f}),this._defaultPrevented=!1}}class zd extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,d,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}}class Gd{constructor(r,d){this._map=r,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new zd(r.type,this._map,r))}mousedown(r,d){return this._mousedownPos=d,this._firePreventable(new Xr(r.type,this._map,r))}mouseup(r){this._map.fire(new Xr(r.type,this._map,r))}click(r,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Xr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new Xr(r.type,this._map,r))}mouseover(r){this._map.fire(new Xr(r.type,this._map,r))}mouseout(r){this._map.fire(new Xr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new jo(r.type,this._map,r))}touchmove(r){this._map.fire(new jo(r.type,this._map,r))}touchend(r){this._map.fire(new jo(r.type,this._map,r))}touchcancel(r){this._map.fire(new jo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qd{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new Xr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new Xr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ar{constructor(r,d){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,d){this.isEnabled()&&r.shiftKey&&r.button===0&&(E.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(r,d){if(!this._active)return;const f=d;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=f,this._box||(this._box=E.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(_.x,f.x),C=Math.max(_.x,f.x),B=Math.min(_.y,f.y),D=Math.max(_.y,f.y);E.setTransform(this._box,`translate(${w}px,${B}px)`),this._box.style.width=C-w+"px",this._box.style.height=D-B+"px"}mouseupWindow(r,d){if(!this._active||r.button!==0)return;const f=this._startPos,_=d;if(this.reset(),E.suppressClick(),f.x!==_.x||f.y!==_.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:w=>w.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,d){return this._map.fire(new a.Event(r,{originalEvent:d}))}}function Ls(g,r){if(g.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${r.length}`);const d={};for(let f=0;f<g.length;f++)d[g[f].identifier]=r[f];return d}class Wm{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,d,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const w=new a.pointGeometry(0,0);for(const C of _)w._add(C);return w.div(_.length)}(d),this.touches=Ls(f,d)))}touchmove(r,d,f){if(this.aborted||!this.centroid)return;const _=Ls(f,d);for(const w in this.touches){const C=_[w];(!C||C.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(r,d,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Vl{constructor(r){this.singleTap=new Wm(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,d,f){this.singleTap.touchstart(r,d,f)}touchmove(r,d,f){this.singleTap.touchmove(r,d,f)}touchend(r,d,f){const _=this.singleTap.touchend(r,d,f);if(_){const w=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(_)<30;if(w&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Vd{constructor(){this._zoomIn=new Vl({numTouches:1,numTaps:2}),this._zoomOut=new Vl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,d,f){this._zoomIn.touchstart(r,d,f),this._zoomOut.touchstart(r,d,f)}touchmove(r,d,f){this._zoomIn.touchmove(r,d,f),this._zoomOut.touchmove(r,d,f)}touchend(r,d,f){const _=this._zoomIn.touchend(r,d,f),w=this._zoomOut.touchend(r,d,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(_)},{originalEvent:r})}):w?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class to{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const d=this._moveFunction(...r);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(r,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,d){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const _=d.length?d[0]:d;return!this._moved&&_.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=_,this._move(f,_))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&E.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const qm={0:1,2:2};class _r{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const d=E.mouseButton(r);this._eventButton=d}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(d,f){const _=qm[f];return d.buttons===void 0||(d.buttons&_)!==_}(r,this._eventButton)}isValidEndEvent(r){return E.mouseButton(r)===this._eventButton}}class en{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const Xo=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=function(r){r.preventDefault()}},Dh=({enable:g,clickTolerance:r,bearingDegreesPerPixelMoved:d=.8})=>{const f=new _r({checkCorrectEvent:_=>E.mouseButton(_)===0&&_.ctrlKey||E.mouseButton(_)===2});return new to({clickTolerance:r,move:(_,w)=>({bearingDelta:(w.x-_.x)*d}),moveStateManager:f,enable:g,assignEvents:Xo})},Hd=({enable:g,clickTolerance:r,pitchDegreesPerPixelMoved:d=-.5})=>{const f=new _r({checkCorrectEvent:_=>E.mouseButton(_)===0&&_.ctrlKey||E.mouseButton(_)===2});return new to({clickTolerance:r,move:(_,w)=>({pitchDelta:(w.y-_.y)*d}),moveStateManager:f,enable:g,assignEvents:Xo})};class $m{constructor(r,d){this._minTouches=r.cooperativeGestures?2:1,this._clickTolerance=r.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(r,d,f){return this._calculateTransform(r,d,f)}touchmove(r,d,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(r,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,d,f)}touchend(r,d,f){this._calculateTransform(r,d,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,d,f){f.length>0&&(this._active=!0);const _=Ls(f,d),w=new a.pointGeometry(0,0),C=new a.pointGeometry(0,0);let B=0;for(const F in _){const Q=_[F],z=this._touches[F];z&&(w._add(Q),C._add(Q.sub(z)),B++,_[F]=Q)}if(this._touches=_,B<this._minTouches||!C.mag())return;const D=C.div(B);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(B),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ph{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,d,f){return{}}touchstart(r,d,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([d[0],d[1]]))}touchmove(r,d,f){if(!this._firstTwoTouches)return;r.preventDefault();const[_,w]=this._firstTwoTouches,C=Uh(f,d,_),B=Uh(f,d,w);if(!C||!B)return;const D=this._aroundCenter?null:C.add(B).div(2);return this._move([C,B],D,r)}touchend(r,d,f){if(!this._firstTwoTouches)return;const[_,w]=this._firstTwoTouches,C=Uh(f,d,_),B=Uh(f,d,w);C&&B||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Uh(g,r,d){for(let f=0;f<g.length;f++)if(g[f].identifier===d)return r[f]}function ss(g,r){return Math.log(g/r)/Math.LN2}class Fh extends Ph{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,d){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ss(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ss(this._distance,f),pinchAround:d}}}function Qt(g,r){return 180*g.angleWith(r)/Math.PI}class ti extends Ph{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,d){const f=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qt(this._vector,f),pinchAround:d}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const d=25/(Math.PI*this._minDiameter)*360,f=Qt(r,this._startVector);return Math.abs(f)<d}}function Yo(g){return Math.abs(g.y)>Math.abs(g.x)}class Wd extends Ph{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,d,f){super.touchstart(r,d,f),this._currentTouchCount=f.length}_start(r){this._lastPoints=r,Yo(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,d,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=r[0].sub(this._lastPoints[0]),w=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,w,f.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(_.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(r,d,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,w=d.mag()>=2;if(!_&&!w)return;if(!_||!w)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const C=r.y>0==d.y>0;return Yo(r)&&Yo(d)&&C}}const qd={panStep:100,bearingStep:15,pitchStep:10};class yr{constructor(){const r=qd;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let d=0,f=0,_=0,w=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),w=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),w=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:B=>{const D=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:kh,zoom:d?Math.round(D)+d*(r.shiftKey?2:1):D,bearing:B.getBearing()+f*this._bearingStep,pitch:B.getPitch()+_*this._pitchStep,offset:[-w*this._panStep,-C*this._panStep],center:B.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kh(g){return g*(2-g)}const as=4.000244140625;class ry{constructor(r,d){this._map=r,this._el=r.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;r.preventDefault()}let d=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=a.exported.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,d!==0&&d%as==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),r.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=r,this._delta-=d,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=E.mousePos(this._el,r);this._around=a.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;if(this._delta!==0){const B=this._type==="wheel"&&Math.abs(this._delta)>as?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&D!==0&&(D=1/D);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*D))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,f=this._startZoom,_=this._easing;let w,C=!1;if(this._type==="wheel"&&f&&_){const B=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),D=_(B);w=a.number(f,d,D),B<1?this._frameId||(this._frameId=!0):C=!0}else w=d,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:w-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let d=a.ease;if(this._prevEase){const f=this._prevEase,_=(a.exported.now()-f.start)/f.duration,w=f.easing(_+.01)-f.easing(_),C=.27/Math.sqrt(w*w+1e-4)*.01,B=Math.sqrt(.0729-C*C);d=a.bezier(C,B,.25,1)}return this._prevEase={start:a.exported.now(),duration:r,easing:d},d}reset(){this._active=!1}}class Nh{constructor(r,d){this._clickZoom=r,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _n{constructor(){this.reset()}reset(){this._active=!1}dblclick(r,d){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(d)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cn{constructor(){this._tap=new Vl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,d,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=d[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,d,f))}touchmove(r,d,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=d[0],w=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(r,d,f)}touchend(r,d,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,d,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jm{constructor(r,d,f){this._el=r,this._mousePan=d,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hl{constructor(r,d,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=d,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oh{constructor(r,d,f,_){this._el=r,this._touchZoom=d,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ko=g=>g.zoom||g.drag||g.pitch||g.rotate;class $d extends a.Event{}function Wl(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class ql{constructor(r,d){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hm(r),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),a.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,w,C]of this._listeners)E.addEventListener(_,w,_===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[r,d,f]of this._listeners)E.removeEventListener(r,d,r===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(r){const d=this._map,f=d.getCanvasContainer();this._add("mapEvent",new Gd(d,r));const _=d.boxZoom=new Ar(d,r);this._add("boxZoom",_);const w=new Vd,C=new _n;d.doubleClickZoom=new Nh(C,w),this._add("tapZoom",w),this._add("clickZoom",C);const B=new Cn;this._add("tapDragZoom",B);const D=d.touchPitch=new Wd(d);this._add("touchPitch",D);const F=Dh(r),Q=Hd(r);d.dragRotate=new Hl(r,F,Q),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]);const z=(({enable:Be,clickTolerance:Ie})=>{const fe=new _r({checkCorrectEvent:Pe=>E.mouseButton(Pe)===0&&!Pe.ctrlKey});return new to({clickTolerance:Ie,move:(Pe,Qe)=>({around:Qe,panDelta:Qe.sub(Pe)}),activateOnStart:!0,moveStateManager:fe,enable:Be,assignEvents:Xo})})(r),$=new $m(r,d);d.dragPan=new jm(f,z,$),this._add("mousePan",z),this._add("touchPan",$,["touchZoom","touchRotate"]);const le=new ti,he=new Fh;d.touchZoomRotate=new Oh(f,he,le,B),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",he,["touchPan","touchRotate"]);const re=d.scrollZoom=new ry(d,this);this._add("scrollZoom",re,["mousePan"]);const Ae=d.keyboard=new yr;this._add("keyboard",Ae),this._add("blockableMapEvent",new Qd(d));for(const Be of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[Be]&&d[Be].enable(r[Be])}_add(r,d,f){this._handlers.push({handlerName:r,handler:d,allowed:f}),this._handlersById[r]=d}stop(r){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ko(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,d,f){for(const _ in r)if(_!==f&&(!d||d.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const d=[];for(const f of r)this._el.contains(f.target)&&d.push(f);return d}handleEvent(r,d){if(r.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=r.type==="renderFrame"?void 0:r,_={needsRenderFrame:!1},w={},C={},B=r.touches,D=B?this._getMapTouches(B):void 0,F=D?E.touchPos(this._el,D):E.mousePos(this._el,r);for(const{handlerName:$,handler:le,allowed:he}of this._handlers){if(!le.isEnabled())continue;let re;this._blockedByActive(C,he,$)?le.reset():le[d||r.type]&&(re=le[d||r.type](r,F,D),this.mergeHandlerResult(_,w,re,$,f),re&&re.needsRenderFrame&&this._triggerRenderFrame()),(re||le.isActive())&&(C[$]=le)}const Q={};for(const $ in this._previousActiveHandlers)C[$]||(Q[$]=f);this._previousActiveHandlers=C,(Object.keys(Q).length||Wl(_))&&(this._changes.push([_,w,Q]),this._triggerRenderFrame()),(Object.keys(C).length||Wl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=_;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(r,d,f,_,w){if(!f)return;a.extend(r,f);const C={handlerName:_,originalEvent:f.originalEvent||w};f.zoomDelta!==void 0&&(d.zoom=C),f.panDelta!==void 0&&(d.drag=C),f.pitchDelta!==void 0&&(d.pitch=C),f.bearingDelta!==void 0&&(d.rotate=C)}_applyChanges(){const r={},d={},f={};for(const[_,w,C]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new a.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),a.extend(d,w),a.extend(f,C);this._updateMapTransform(r,d,f),this._changes=[]}_updateMapTransform(r,d,f){const _=this._map,w=_.transform,C=_.terrain;if(!(Wl(r)||C&&this._terrainMovement))return this._fireEvents(d,f,!0);let{panDelta:B,zoomDelta:D,bearingDelta:F,pitchDelta:Q,around:z,pinchAround:$}=r;$!==void 0&&(z=$),_._stop(!0),z=z||_.transform.centerPoint;const le=w.pointLocation(B?z.sub(B):z);F&&(w.bearing+=F),Q&&(w.pitch+=Q),D&&(w.zoom+=D),C?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(B)):w.setLocationAtPoint(le,z):(this._terrainMovement=!0,w.freezeElevation=!0,w.setLocationAtPoint(le,z),this._map.once("moveend",()=>{w.freezeElevation=!1,this._terrainMovement=!1,w.recalculateZoom(_.terrain)})):w.setLocationAtPoint(le,z),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(d,f,!0)}_fireEvents(r,d,f){const _=Ko(this._eventsInProgress),w=Ko(r),C={};for(const Q in r){const{originalEvent:z}=r[Q];this._eventsInProgress[Q]||(C[`${Q}start`]=z),this._eventsInProgress[Q]=r[Q]}!_&&w&&this._fireEvent("movestart",w.originalEvent);for(const Q in C)this._fireEvent(Q,C[Q]);w&&this._fireEvent("move",w.originalEvent);for(const Q in r){const{originalEvent:z}=r[Q];this._fireEvent(Q,z)}const B={};let D;for(const Q in this._eventsInProgress){const{handlerName:z,originalEvent:$}=this._eventsInProgress[Q];this._handlersById[z].isActive()||(delete this._eventsInProgress[Q],D=d[z]||$,B[`${Q}end`]=D)}for(const Q in B)this._fireEvent(Q,B[Q]);const F=Ko(this._eventsInProgress);if(f&&(_||w)&&!F){this._updatingCamera=!0;const Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;Q?(z(Q.bearing||this._map.getBearing())&&(Q.bearing=0),Q.freezeElevation=!0,this._map.easeTo(Q,{originalEvent:D})):(this._map.fire(new a.Event("moveend",{originalEvent:D})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,d){this._map.fire(new a.Event(r,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new $d("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const jd={extend:(g,...r)=>a.extend(g,...r),run(g){g()},logToElement(g,r=!1,d="log"){const f=window.document.getElementById(d);f&&(r&&(f.innerHTML=""),f.innerHTML+=`<br>${g}`)}};class Xd extends a.Evented{constructor(r,d){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=d.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,d){return this.jumpTo({center:r},d)}panBy(r,d,f){return r=a.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,a.extend({offset:r},d),f)}panTo(r,d,f){return this.easeTo(a.extend({center:r},d),f)}getZoom(){return this.transform.zoom}setZoom(r,d){return this.jumpTo({zoom:r},d),this}zoomTo(r,d,f){return this.easeTo(a.extend({zoom:r},d),f)}zoomIn(r,d){return this.zoomTo(this.getZoom()+1,r,d),this}zoomOut(r,d){return this.zoomTo(this.getZoom()-1,r,d),this}getBearing(){return this.transform.bearing}setBearing(r,d){return this.jumpTo({bearing:r},d),this}getPadding(){return this.transform.padding}setPadding(r,d){return this.jumpTo({padding:r},d),this}rotateTo(r,d,f){return this.easeTo(a.extend({bearing:r},d),f)}resetNorth(r,d){return this.rotateTo(0,a.extend({duration:1e3},r),d),this}resetNorthPitch(r,d){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},r),d),this}snapToNorth(r,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,d):this}getPitch(){return this.transform.pitch}setPitch(r,d){return this.jumpTo({pitch:r},d),this}cameraForBounds(r,d){r=a.LngLatBounds.convert(r);const f=d&&d.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),f,d)}_cameraForBoxAndBearing(r,d,f,_){const w={top:0,bottom:0,right:0,left:0};if(typeof(_=a.extend({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const Qe=_.padding;_.padding={top:Qe,bottom:Qe,right:Qe,left:Qe}}_.padding=a.extend(w,_.padding);const C=this.transform,B=C.padding,D=C.project(a.LngLat.convert(r)),F=C.project(a.LngLat.convert(d)),Q=D.rotate(-f*Math.PI/180),z=F.rotate(-f*Math.PI/180),$=new a.pointGeometry(Math.max(Q.x,z.x),Math.max(Q.y,z.y)),le=new a.pointGeometry(Math.min(Q.x,z.x),Math.min(Q.y,z.y)),he=$.sub(le),re=(C.width-(B.left+B.right+_.padding.left+_.padding.right))/he.x,Ae=(C.height-(B.top+B.bottom+_.padding.top+_.padding.bottom))/he.y;if(Ae<0||re<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Be=Math.min(C.scaleZoom(C.scale*Math.min(re,Ae)),_.maxZoom),Ie=a.pointGeometry.convert(_.offset),fe=new a.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(f*Math.PI/180),Pe=Ie.add(fe).mult(C.scale/C.zoomScale(Be));return{center:C.unproject(D.add(F).div(2).sub(Pe)),zoom:Be,bearing:f}}fitBounds(r,d,f){return this._fitInternal(this.cameraForBounds(r,d),d,f)}fitScreenCoordinates(r,d,f,_,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(r)),this.transform.pointLocation(a.pointGeometry.convert(d)),f,_),_,w)}_fitInternal(r,d,f){return r?(delete(d=a.extend(r,d)).padding,d.linear?this.easeTo(d,f):this.flyTo(d,f)):this}jumpTo(r,d){this.stop();const f=this.transform;let _=!1,w=!1,C=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=a.LngLat.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(w=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(C=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),this.fire(new a.Event("movestart",d)).fire(new a.Event("move",d)),_&&this.fire(new a.Event("zoomstart",d)).fire(new a.Event("zoom",d)).fire(new a.Event("zoomend",d)),w&&this.fire(new a.Event("rotatestart",d)).fire(new a.Event("rotate",d)).fire(new a.Event("rotateend",d)),C&&this.fire(new a.Event("pitchstart",d)).fire(new a.Event("pitch",d)).fire(new a.Event("pitchend",d)),this.fire(new a.Event("moveend",d))}calculateCameraOptionsFromTo(r,d,f,_=0){const w=a.MercatorCoordinate.fromLngLat(r,d),C=a.MercatorCoordinate.fromLngLat(f,_),B=C.x-w.x,D=C.y-w.y,F=C.z-w.z,Q=Math.hypot(B,D,F);if(Q===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(B,D),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Q/this.transform.tileSize),le=180*Math.atan2(B,-D)/Math.PI;let he=180*Math.acos(z/Q)/Math.PI;return he=F<0?90-he:90+he,{center:C.toLngLat(),zoom:$,pitch:he,bearing:le}}easeTo(r,d){this._stop(!1,r.easeId),((r=a.extend({offset:[0,0],duration:500,easing:a.ease},r)).animate===!1||!r.essential&&a.exported.prefersReducedMotion)&&(r.duration=0);const f=this.transform,_=this.getZoom(),w=this.getBearing(),C=this.getPitch(),B=this.getPadding(),D="zoom"in r?+r.zoom:_,F="bearing"in r?this._normalizeBearing(r.bearing,w):w,Q="pitch"in r?+r.pitch:C,z="padding"in r?r.padding:f.padding,$=a.pointGeometry.convert(r.offset);let le=f.centerPoint.add($);const he=f.pointLocation(le),re=a.LngLat.convert(r.center||he);this._normalizeCenter(re);const Ae=f.project(he),Be=f.project(re).sub(Ae),Ie=f.zoomScale(D-_);let fe,Pe;r.around&&(fe=a.LngLat.convert(r.around),Pe=f.locationPoint(fe));const Qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||D!==_,this._rotating=this._rotating||w!==F,this._pitching=this._pitching||Q!==C,this._padding=!f.isPaddingEqual(z),this._easeId=r.easeId,this._prepareEase(d,r.noMoveStart,Qe),this.terrain&&this._prepareElevation(re),this._ease(We=>{if(this._zooming&&(f.zoom=a.number(_,D,We)),this._rotating&&(f.bearing=a.number(w,F,We)),this._pitching&&(f.pitch=a.number(C,Q,We)),this._padding&&(f.interpolatePadding(B,z,We),le=f.centerPoint.add($)),this.terrain&&!r.freezeElevation&&this._updateElevation(We),fe)f.setLocationAtPoint(fe,Pe);else{const Ze=f.zoomScale(f.zoom-_),et=D>_?Math.min(2,Ie):Math.max(.5,Ie),lt=Math.pow(et,1-We),rt=f.unproject(Ae.add(Be.mult(We*lt)).mult(Ze));f.setLocationAtPoint(f.renderWorldCopies?rt.wrap():rt,le)}this._fireMoveEvents(d)},We=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,We)},r),this}_prepareEase(r,d,f={}){this._moving=!0,d||f.moving||this.fire(new a.Event("movestart",r)),this._zooming&&!f.zooming&&this.fire(new a.Event("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new a.Event("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new a.Event("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(r,this.terrain),this.transform.freezeElevation=!0}_updateElevation(r){const d=this.transform.getElevation(this._elevationCenter,this.terrain);if(r<1&&d!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(f-(d-(f*r+this._elevationStart))/(1-r)),this._elevationTarget=d}this.transform.elevation=a.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_fireMoveEvents(r){this.fire(new a.Event("move",r)),this._zooming&&this.fire(new a.Event("zoom",r)),this._rotating&&this.fire(new a.Event("rotate",r)),this._pitching&&this.fire(new a.Event("pitch",r))}_afterEase(r,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const f=this._zooming,_=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new a.Event("zoomend",r)),_&&this.fire(new a.Event("rotateend",r)),w&&this.fire(new a.Event("pitchend",r)),this.fire(new a.Event("moveend",r))}flyTo(r,d){if(!r.essential&&a.exported.prefersReducedMotion){const Ut=a.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ut,d)}this.stop(),r=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},r);const f=this.transform,_=this.getZoom(),w=this.getBearing(),C=this.getPitch(),B=this.getPadding(),D="zoom"in r?a.clamp(+r.zoom,f.minZoom,f.maxZoom):_,F="bearing"in r?this._normalizeBearing(r.bearing,w):w,Q="pitch"in r?+r.pitch:C,z="padding"in r?r.padding:f.padding,$=f.zoomScale(D-_),le=a.pointGeometry.convert(r.offset);let he=f.centerPoint.add(le);const re=f.pointLocation(he),Ae=a.LngLat.convert(r.center||re);this._normalizeCenter(Ae);const Be=f.project(re),Ie=f.project(Ae).sub(Be);let fe=r.curve;const Pe=Math.max(f.width,f.height),Qe=Pe/$,We=Ie.mag();if("minZoom"in r){const Ut=a.clamp(Math.min(r.minZoom,_,D),f.minZoom,f.maxZoom),Li=Pe/f.zoomScale(Ut-_);fe=Math.sqrt(Li/We*2)}const Ze=fe*fe;function et(Ut){const Li=(Qe*Qe-Pe*Pe+(Ut?-1:1)*Ze*Ze*We*We)/(2*(Ut?Qe:Pe)*Ze*We);return Math.log(Math.sqrt(Li*Li+1)-Li)}function lt(Ut){return(Math.exp(Ut)-Math.exp(-Ut))/2}function rt(Ut){return(Math.exp(Ut)+Math.exp(-Ut))/2}const mt=et(0);let Pt=function(Ut){return rt(mt)/rt(mt+fe*Ut)},ri=function(Ut){return Pe*((rt(mt)*(lt(Li=mt+fe*Ut)/rt(Li))-lt(mt))/Ze)/We;var Li},ai=(et(1)-mt)/fe;if(Math.abs(We)<1e-6||!isFinite(ai)){if(Math.abs(Pe-Qe)<1e-6)return this.easeTo(r,d);const Ut=Qe<Pe?-1:1;ai=Math.abs(Math.log(Qe/Pe))/fe,ri=function(){return 0},Pt=function(Li){return Math.exp(Ut*fe*Li)}}return r.duration="duration"in r?+r.duration:1e3*ai/("screenSpeed"in r?+r.screenSpeed/fe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=w!==F,this._pitching=Q!==C,this._padding=!f.isPaddingEqual(z),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(Ae),this._ease(Ut=>{const Li=Ut*ai,Di=1/Pt(Li);f.zoom=Ut===1?D:_+f.scaleZoom(Di),this._rotating&&(f.bearing=a.number(w,F,Ut)),this._pitching&&(f.pitch=a.number(C,Q,Ut)),this._padding&&(f.interpolatePadding(B,z,Ut),he=f.centerPoint.add(le)),this.terrain&&!r.freezeElevation&&this._updateElevation(Ut);const di=Ut===1?Ae:f.unproject(Be.add(Ie.mult(ri(Li))).mult(Di));f.setLocationAtPoint(f.renderWorldCopies?di.wrap():di,he),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,d)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,d,f){f.animate===!1||f.duration===0?(r(1),d()):(this._easeStart=a.exported.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,d){r=a.wrap(r,-180,180);const f=Math.abs(r-d);return Math.abs(r-360-d)<f&&(r-=360),Math.abs(r+360-d)<f&&(r+=360),r}_normalizeCenter(r){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const f=r.lng-d.center.lng;r.lng+=f>180?-360:f<-180?360:0}}class zh{constructor(r={}){this.options=r,a.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options&&this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,d){const f=this._map._getUIString(`AttributionControl.${d}`);r.title=f,r.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const d=this._map.style.sourceCaches;for(const _ in d){const w=d[_];if(w.used||w.usedForTerrain){const C=w.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r=r.filter(_=>String(_).trim()),r.sort((_,w)=>_.length-w.length),r=r.filter((_,w)=>{for(let C=w+1;C<r.length;C++)if(r[C].indexOf(_)>=0)return!1;return!0});const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class Gh{constructor(r={}){this.options=r,a.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl");const d=E.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const r=this._container.children;if(r.length){const d=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}}}class Yd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const d=++this._id;return this._queue.push({callback:r,id:d,cancelled:!1}),d}remove(r){const d=this._currentlyRunning,f=d?this._queue.concat(d):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const f of d)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Kd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Zd=a.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class Jd extends a.Evented{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,d){this.sourceCache.update(r,d),this._renderableTilesKeys=[];const f={};for(const _ of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))f[_.key]=!0,this._renderableTilesKeys.push(_.key),this._tiles[_.key]||(_.posMatrix=new Float64Array(16),a.ortho(_.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),this._tiles[_.key]=new $t(_,this.tileSize));for(const _ in this._tiles)f[_]||delete this._tiles[_]}freeRtt(r){for(const d in this._tiles){const f=this._tiles[d];(!r||f.tileID.equals(r)||f.tileID.isChildOf(r)||r.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const d={};for(const f of this._renderableTilesKeys){const _=this._tiles[f].tileID;if(_.canonical.equals(r.canonical)){const w=r.clone();w.posMatrix=new Float64Array(16),a.ortho(w.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),d[f]=w}else if(_.canonical.isChildOf(r.canonical)){const w=r.clone();w.posMatrix=new Float64Array(16);const C=_.canonical.z-r.canonical.z,B=_.canonical.x-(_.canonical.x>>C<<C),D=_.canonical.y-(_.canonical.y>>C<<C),F=a.EXTENT>>C;a.ortho(w.posMatrix,0,F,0,F,0,1),a.translate(w.posMatrix,w.posMatrix,[-B*F,-D*F,0]),d[f]=w}else if(r.canonical.isChildOf(_.canonical)){const w=r.clone();w.posMatrix=new Float64Array(16);const C=r.canonical.z-_.canonical.z,B=r.canonical.x-(r.canonical.x>>C<<C),D=r.canonical.y-(r.canonical.y>>C<<C),F=a.EXTENT>>C;a.ortho(w.posMatrix,0,a.EXTENT,0,a.EXTENT,0,1),a.translate(w.posMatrix,w.posMatrix,[B*F,D*F,0]),a.scale(w.posMatrix,w.posMatrix,[1/2**C,1/2**C,0]),d[f]=w}}return d}getSourceTile(r,d){const f=this.sourceCache._source;let _=r.overscaledZ-this.deltaZoom;if(_>f.maxzoom&&(_=f.maxzoom),_<f.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(_).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!w||!w.dem)&&d)for(;_>=f.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(r.scaledTo(_--).key);return w}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=r)}}class Qh{constructor(r,d,f){this.painter=r,this.sourceCache=new Jd(d),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,d,f,_=a.EXTENT){if(!(d>=0&&d<_&&f>=0&&f<_))return 0;let w=0;const C=this.getTerrainData(r);if(C.tile&&C.tile.dem){const B=function(he,re,Ae){var Be=re[0],Ie=re[1];return he[0]=Ae[0]*Be+Ae[4]*Ie+Ae[12],he[1]=Ae[1]*Be+Ae[5]*Ie+Ae[13],he}([],[d/_*a.EXTENT,f/_*a.EXTENT],C.u_terrain_matrix),D=[B[0]*C.tile.dem.dim,B[1]*C.tile.dem.dim],F=[Math.floor(D[0]),Math.floor(D[1])],Q=C.tile.dem.get(F[0],F[1]),z=C.tile.dem.get(F[0],F[1]+1),$=C.tile.dem.get(F[0]+1,F[1]),le=C.tile.dem.get(F[0]+1,F[1]+1);w=a.number(a.number(Q,z,D[0]-F[0]),a.number($,le,D[0]-F[0]),D[1]-F[1])}return w}getElevation(r,d,f,_=a.EXTENT){return this.getDEMElevation(r,d,f,_)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const _=this.painter.context,w=new a.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ve(_,w,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ve(_,new a.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.identity([])}const d=this.sourceCache.getSourceTile(r,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const _=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new ve(_,d.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),d.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const f=d&&d+d.tileID.key+r.key;if(f&&!this._demMatrixCache[f]){const _=this.sourceCache.sourceCache._source.maxzoom;let w=r.canonical.z-d.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=_?w=r.canonical.z-_:a.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=r.canonical.x-(r.canonical.x>>w<<w),B=r.canonical.y-(r.canonical.y>>w<<w),D=a.fromScaling(new Float64Array(16),[1/(a.EXTENT<<w),1/(a.EXTENT<<w),0]);a.translate(D,D,[C*a.EXTENT,B*a.EXTENT,0]),this._demMatrixCache[r.key]={matrix:D,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(r){const d=this.painter,f=d.width/devicePixelRatio,_=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ve(d.context,{width:f,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ve(d.context,{width:f,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(f,_,!0),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,f,_))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,C=0;w<this._coordsTextureSize;w++)for(let B=0;B<this._coordsTextureSize;B++,C+=4)d[C+0]=255&B,d[C+1]=255&w,d[C+2]=B>>8<<4|w>>8,d[C+3]=0;const f=new a.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),_=new ve(r,f,r.gl.RGBA,{premultiply:!1});return _.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(r){const d=new Uint8Array(4),f=this.painter.context,_=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),_.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,_.RGBA,_.UNSIGNED_BYTE,d),f.bindFramebuffer.set(null);const w=d[0]+(d[2]>>4<<8),C=d[1]+((15&d[2])<<8),B=this.coordsIndex[255-d[3]],D=B&&this.sourceCache.getTileByID(B);if(!D)return null;const F=this._coordsTextureSize,Q=(1<<D.tileID.canonical.z)*F;return new a.MercatorCoordinate((D.tileID.canonical.x*F+w)/Q,(D.tileID.canonical.y*F+C)/Q,this.getElevation(D.tileID,w,C,F))}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,d=new a.Pos3dArray,f=new a.TriangleIndexArray,_=this.meshSize,w=a.EXTENT/_,C=_*_;for(let z=0;z<=_;z++)for(let $=0;$<=_;$++)d.emplaceBack($*w,z*w,0);for(let z=0;z<C;z+=_+1)for(let $=0;$<_;$++)f.emplaceBack($+z,_+$+z+1,_+$+z+2),f.emplaceBack($+z,_+$+z+2,$+z+1);const B=d.length,D=B+2*(_+1);for(const z of[0,1])for(let $=0;$<=_;$++)for(const le of[0,1])d.emplaceBack($*w,z*a.EXTENT,le);for(let z=0;z<2*_;z+=2)f.emplaceBack(D+z,D+z+1,D+z+3),f.emplaceBack(D+z,D+z+3,D+z+2),f.emplaceBack(B+z,B+z+3,B+z+1),f.emplaceBack(B+z,B+z+2,B+z+3);const F=d.length,Q=F+2*(_+1);for(const z of[0,1])for(let $=0;$<=_;$++)for(const le of[0,1])d.emplaceBack(z*a.EXTENT,$*w,le);for(let z=0;z<2*_;z+=2)f.emplaceBack(F+z,F+z+1,F+z+3),f.emplaceBack(F+z,F+z+3,F+z+2),f.emplaceBack(Q+z,Q+z+3,Q+z+1),f.emplaceBack(Q+z,Q+z+2,Q+z+3);return this._mesh={indexBuffer:r.createIndexBuffer(f),vertexBuffer:r.createVertexBuffer(d,Zd.members),segments:a.SegmentVector.simpleSegment(0,0,d.length,f.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*a.earthRadius/Math.pow(2,r)/5}getMinMaxElevation(r){const d=this.getTerrainData(r).tile,f={minElevation:null,maxElevation:null};return d&&d.dem&&(f.minElevation=d.dem.min*this.exaggeration,f.maxElevation=d.dem.max*this.exaggeration),f}}class ep{constructor(r,d,f){this._context=r,this._size=d,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0),f=new ve(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_COMPONENT16,this._tileSize,this._tileSize)),d.colorAttachment.set(f.texture),{id:r,fbo:d,texture:f,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>r.id!==d),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const va={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Vh{constructor(r,d){this.painter=r,this.terrain=d,this.pool=new ep(r.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(f=>!r._layers[f].isHidden(d)),this._coordsDescendingInv={};for(const f in r.sourceCaches){this._coordsDescendingInv[f]={};const _=r.sourceCaches[f].getVisibleCoordinates();for(const w of _){const C=this.terrain.sourceCache.getTerrainCoords(w);for(const B in C)this._coordsDescendingInv[f][B]||(this._coordsDescendingInv[f][B]=[]),this._coordsDescendingInv[f][B].push(C[B])}}this._coordsDescendingInvStr={};for(const f of r._order){const _=r._layers[f],w=_.source;if(va[_.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const C in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][C]=this._coordsDescendingInv[w][C].map(B=>B.key).sort().join()}}for(const f of this._renderableTiles)for(const _ in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[_][f.tileID.key];w&&w!==f.rttCoords[_]&&(f.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const d=r.type,f=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(va[d]&&(this._prevType&&va[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(r.id),!_))return!0;if(va[this._prevType]||va[d]&&_){this._prevType=d;const w=this._stacks.length-1,C=this._stacks[w]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(kd(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[w]){const F=this.pool.getObjectForId(B.rtt[w].id);if(F.stamp===B.rtt[w].stamp){this.pool.useObject(F);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),B.rtt[w]={id:D.id,stamp:D.stamp},f.context.bindFramebuffer.set(D.fbo.framebuffer),f.context.clear({color:a.Color.transparent});for(let F=0;F<C.length;F++){const Q=f.style._layers[C[F]],z=Q.source?this._coordsDescendingInv[Q.source][B.tileID.key]:[B.tileID];f.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),f._renderTileClippingMasks(Q,z),f.renderLayer(f,f.style.sourceCaches[Q.source],Q,z),Q.source&&(B.rttCoords[Q.source]=this._coordsDescendingInvStr[Q.source][B.tileID.key])}}return kd(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),va[d]}return!1}}const tp=b,ip={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Hh=g=>{g.touchstart=g.dragStart,g.touchmoveWindow=g.dragMove,g.touchend=g.dragEnd},np={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xm{constructor(r,d,f=!1){this._clickTolerance=10;const _=r.dragRotate._mouseRotate.getClickTolerance(),w=r.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Dh({clickTolerance:_,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:B,bearingDegreesPerPixelMoved:D=.8})=>{const F=new en;return new to({clickTolerance:B,move:(Q,z)=>({bearingDelta:(z.x-Q.x)*D}),moveStateManager:F,enable:C,assignEvents:Hh})})({clickTolerance:_,enable:!0}),this.map=r,f&&(this.mousePitch=Hd({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:B,pitchDegreesPerPixelMoved:D=-.5})=>{const F=new en;return new to({clickTolerance:B,move:(Q,z)=>({pitchDelta:(z.y-Q.y)*D}),moveStateManager:F,enable:C,assignEvents:Hh})})({clickTolerance:w,enable:!0})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),E.addEventListener(d,"mousedown",this.mousedown),E.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(d,"touchcancel",this.reset)}startMouse(r,d){this.mouseRotate.dragStart(r,d),this.mousePitch&&this.mousePitch.dragStart(r,d),E.disableDrag()}startTouch(r,d){this.touchRotate.dragStart(r,d),this.touchPitch&&this.touchPitch.dragStart(r,d),E.disableDrag()}moveMouse(r,d){const f=this.map,{bearingDelta:_}=this.mouseRotate.dragMove(r,d)||{};if(_&&f.setBearing(f.getBearing()+_),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(r,d)||{};w&&f.setPitch(f.getPitch()+w)}}moveTouch(r,d){const f=this.map,{bearingDelta:_}=this.touchRotate.dragMove(r,d)||{};if(_&&f.setBearing(f.getBearing()+_),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(r,d)||{};w&&f.setPitch(f.getPitch()+w)}}off(){const r=this.element;E.removeEventListener(r,"mousedown",this.mousedown),E.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend),E.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend)}mousedown(r){this.startMouse(a.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),E.mousePos(this.element,r)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)}mousemove(r){this.moveMouse(r,E.mousePos(this.element,r))}mouseup(r){this.mouseRotate.dragEnd(r),this.mousePitch&&this.mousePitch.dragEnd(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,r.targetTouches)[0],this.startTouch(r,this._startPos),E.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.addEventListener(window,"touchend",this.touchend))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,r.targetTouches)[0],this.moveTouch(r,this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function rp(g,r,d){if(g=new a.LngLat(g.lng,g.lat),r){const f=new a.LngLat(g.lng-360,g.lat),_=new a.LngLat(g.lng+360,g.lat),w=d.locationPoint(g).distSqr(r);d.locationPoint(f).distSqr(r)<w?g=f:d.locationPoint(_).distSqr(r)<w&&(g=_)}for(;Math.abs(g.lng-d.center.lng)>180;){const f=d.locationPoint(g);if(f.x>=0&&f.y>=0&&f.x<=d.width&&f.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Wh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sp(g,r,d){const f=g.classList;for(const _ in Wh)f.remove(`maplibregl-${d}-anchor-${_}`);f.add(`maplibregl-${d}-anchor-${r}`)}class qh extends a.Evented{constructor(r,d){if(super(),(r instanceof HTMLElement||d)&&(r=a.extend({element:r},d)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=a.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div"),this._element.setAttribute("aria-label","Map marker");const f=E.createNS("http://www.w3.org/2000/svg","svg"),_=41,w=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${w}px`),f.setAttributeNS(null,"viewBox",`0 0 ${w} ${_}`);const C=E.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const B=E.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");const D=E.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const F=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of F){const fe=E.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",Ie.rx),fe.setAttributeNS(null,"ry",Ie.ry),D.appendChild(fe)}const Q=E.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const z=E.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(z);const $=E.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const le=E.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(le);const he=E.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(6.0, 7.0)"),he.setAttributeNS(null,"fill","#FFFFFF");const re=E.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ae=E.createNS("http://www.w3.org/2000/svg","circle");Ae.setAttributeNS(null,"fill","#000000"),Ae.setAttributeNS(null,"opacity","0.25"),Ae.setAttributeNS(null,"cx","5.5"),Ae.setAttributeNS(null,"cy","5.5"),Ae.setAttributeNS(null,"r","5.4999962");const Be=E.createNS("http://www.w3.org/2000/svg","circle");Be.setAttributeNS(null,"fill","#FFFFFF"),Be.setAttributeNS(null,"cx","5.5"),Be.setAttributeNS(null,"cy","5.5"),Be.setAttributeNS(null,"r","5.4999962"),re.appendChild(Ae),re.appendChild(Be),B.appendChild(D),B.appendChild(Q),B.appendChild($),B.appendChild(he),B.appendChild(re),f.appendChild(B),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",w*this._scale+"px"),this._element.appendChild(f),this._offset=a.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),sp(this._element,this._anchor,"marker"),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(r){const d=r.code,f=r.charCode||r.keyCode;d!=="Space"&&d!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const d=r.originalEvent.target,f=this._element;this._popup&&(d===f||f.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=rp(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),r&&r.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${Wh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${d}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(r){return this._offset=a.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Ym={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let io,$l=0,Zo=!1;const Km={maxWidth:100,unit:"metric"};function ap(g,r,d){const f=d&&d.maxWidth||100,_=g._container.clientHeight/2,w=g.unproject([0,_]),C=g.unproject([f,_]),B=w.distanceTo(C);if(d&&d.unit==="imperial"){const D=3.2808*B;D>5280?jl(r,f,D/5280,g._getUIString("ScaleControl.Miles")):jl(r,f,D,g._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?jl(r,f,B/1852,g._getUIString("ScaleControl.NauticalMiles")):B>=1e3?jl(r,f,B/1e3,g._getUIString("ScaleControl.Kilometers")):jl(r,f,B,g._getUIString("ScaleControl.Meters"))}function jl(g,r,d,f){const _=function(w){const C=Math.pow(10,`${Math.floor(w)}`.length-1);let B=w/C;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(D){const F=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*F)/F}(B),C*B}(d);g.style.width=r*(_/d)+"px",g.innerHTML=`${_}&nbsp;${f}`}const sy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ay=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zm(g){if(g){if(typeof g=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(g,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,g),"top-left":new a.pointGeometry(r,r),"top-right":new a.pointGeometry(-r,r),bottom:new a.pointGeometry(0,-g),"bottom-left":new a.pointGeometry(r,-r),"bottom-right":new a.pointGeometry(-r,-r),left:new a.pointGeometry(g,0),right:new a.pointGeometry(-g,0)}}if(g instanceof a.pointGeometry||Array.isArray(g)){const r=a.pointGeometry.convert(g);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:a.pointGeometry.convert(g.center||[0,0]),top:a.pointGeometry.convert(g.top||[0,0]),"top-left":a.pointGeometry.convert(g["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(g["top-right"]||[0,0]),bottom:a.pointGeometry.convert(g.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(g["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(g["bottom-right"]||[0,0]),left:a.pointGeometry.convert(g.left||[0,0]),right:a.pointGeometry.convert(g.right||[0,0])}}return Zm(new a.pointGeometry(0,0))}const oy=b,ba={supported:m,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Xd{constructor(g){var r;if(a.PerformanceUtils.mark(a.PerformanceMarkers.create),(g=a.extend({},ip,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new eo(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),{bearingSnap:g.bearingSnap}),this._interactive=g.interactive,this._cooperativeGestures=g.cooperativeGestures,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Yd,this._controls=[],this._mapId=a.uniqueId(),this._locale=a.extend({},Kd,g.locale),this._clickTolerance=g.clickTolerance,this._pixelRatio=(r=g.pixelRatio)!==null&&r!==void 0?r:devicePixelRatio,this._imageQueueHandle=te.addThrottleControl(()=>this.isMoving()),this._requestManager=new ue(g.transformRequest),typeof g.container=="string"){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}g.maxBounds&&this.setMaxBounds(g.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ql(this,g),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=g.hash&&new Vm(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,a.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new zh({customAttribution:g.customAttribution})),g.maplibreLogo&&this.addControl(new Gh,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.Event(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.Event(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new a.Event("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(g,r){if(r===void 0&&(r=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(d,f.firstChild):f.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(g);return r>-1&&this._controls.splice(r,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,r,d,f){return f==null&&this.terrain&&(f=this.transform.getElevation(d,this.terrain)),super.calculateCameraOptionsFromTo(g,r,d,f)}resize(g){const r=this._containerDimensions(),d=r[0],f=r[1];this._resizeCanvas(d,f,this.getPixelRatio()),this.transform.resize(d,f),this.painter.resize(d,f,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new a.Event("movestart",g)).fire(new a.Event("move",g))),this.fire(new a.Event("resize",g)),_&&this.fire(new a.Event("moveend",g)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(g){const[r,d]=this._containerDimensions();this._pixelRatio=g,this._resizeCanvas(r,d,g),this.painter.resize(r,d,g)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(a.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this._update()}project(g){return this.transform.locationPoint(a.LngLat.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.pointLocation(a.pointGeometry.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,r,d){if(g==="mouseenter"||g==="mouseover"){let f=!1;return{layer:r,listener:d,delegates:{mousemove:w=>{const C=this.getLayer(r)?this.queryRenderedFeatures(w.point,{layers:[r]}):[];C.length?f||(f=!0,d.call(this,new Xr(g,this,w.originalEvent,{features:C}))):f=!1},mouseout:()=>{f=!1}}}}if(g==="mouseleave"||g==="mouseout"){let f=!1;return{layer:r,listener:d,delegates:{mousemove:C=>{(this.getLayer(r)?this.queryRenderedFeatures(C.point,{layers:[r]}):[]).length?f=!0:f&&(f=!1,d.call(this,new Xr(g,this,C.originalEvent)))},mouseout:C=>{f&&(f=!1,d.call(this,new Xr(g,this,C.originalEvent)))}}}}{const f=_=>{const w=this.getLayer(r)?this.queryRenderedFeatures(_.point,{layers:[r]}):[];w.length&&(_.features=w,d.call(this,_),delete _.features)};return{layer:r,listener:d,delegates:{[g]:f}}}}on(g,r,d){if(d===void 0)return super.on(g,r);const f=this._createDelegatedListener(g,r,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(g,r,d){if(d===void 0)return super.once(g,r);const f=this._createDelegatedListener(g,r,d);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(g,r,d){return d===void 0?super.off(g,r):(this._delegatedListeners&&this._delegatedListeners[g]&&(f=>{const _=this._delegatedListeners[g];for(let w=0;w<_.length;w++){const C=_[w];if(C.layer===r&&C.listener===d){for(const B in C.delegates)this.off(B,C.delegates[B]);return _.splice(w,1),this}}})(),this)}queryRenderedFeatures(g,r){if(!this.style)return[];let d;const f=g instanceof a.pointGeometry||Array.isArray(g),_=f?g:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(f?{}:g)||{},_ instanceof a.pointGeometry||typeof _[0]=="number")d=[a.pointGeometry.convert(_)];else{const w=a.pointGeometry.convert(_[0]),C=a.pointGeometry.convert(_[1]);d=[w,new a.pointGeometry(C.x,w.y),C,new a.pointGeometry(w.x,C.y),w]}return this.style.queryRenderedFeatures(d,r,this.transform)}querySourceFeatures(g,r){return this.style.querySourceFeatures(g,r)}setStyle(g,r){return(r=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(g,r))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const r=this._locale[g];if(r==null)throw new Error(`Missing UI string '${g}'`);return r}_updateStyle(g,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(g,r));const d=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new $r(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,r,d):this.style.loadJSON(g,r,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $r(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,r){if(typeof g=="string"){const d=this._requestManager.transformRequest(g,q.Style);a.getJSON(d,(f,_)=>{f?this.fire(new a.ErrorEvent(f)):_&&this._updateDiff(_,r)})}else typeof g=="object"&&this._updateDiff(g,r)}_updateDiff(g,r){try{this.style.setState(g,r)&&this._update(!0)}catch(d){a.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(g,r){return this._lazyInitEmptyStyle(),this.style.addSource(g,r),this._update(!0)}isSourceLoaded(g){const r=this.style&&this.style.sourceCaches[g];if(r!==void 0)return r.loaded();this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const r=this.style.sourceCaches[g.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain=new Qh(this.painter,r,g),this.painter.renderToTexture=new Vh(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId===g.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new a.Event("terrain",{terrain:g})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const r in g){const d=g[r]._tiles;for(const f in d){const _=d[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(g,r,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,r,d)}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,r,{pixelRatio:d=1,sdf:f=!1,stretchX:_,stretchY:w,content:C}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||a.isImageBitmap(r)){const{width:B,height:D,data:F}=a.exported.getImageData(r);this.style.addImage(g,{data:new a.RGBAImage({width:B,height:D},F),pixelRatio:d,stretchX:_,stretchY:w,content:C,sdf:f,version:0})}else{if(r.width===void 0||r.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:D,data:F}=r,Q=r;this.style.addImage(g,{data:new a.RGBAImage({width:B,height:D},new Uint8Array(F)),pixelRatio:d,stretchX:_,stretchY:w,content:C,sdf:f,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,g)}}}updateImage(g,r){const d=this.style.getImage(g);if(!d)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof HTMLImageElement||a.isImageBitmap(r)?a.exported.getImageData(r):r,{width:_,height:w,data:C}=f;if(_===void 0||w===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==d.data.width||w!==d.data.height)return this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(r instanceof HTMLImageElement||a.isImageBitmap(r));d.data.replace(C,B),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,r){te.getImage(this._requestManager.transformRequest(g,q.Image),r)}listImages(){return this.style.listImages()}addLayer(g,r){return this._lazyInitEmptyStyle(),this.style.addLayer(g,r),this._update(!0)}moveLayer(g,r){return this.style.moveLayer(g,r),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,r,d){return this.style.setLayerZoomRange(g,r,d),this._update(!0)}setFilter(g,r,d={}){return this.style.setFilter(g,r,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,r,d,f={}){return this.style.setPaintProperty(g,r,d,f),this._update(!0)}getPaintProperty(g,r){return this.style.getPaintProperty(g,r)}setLayoutProperty(g,r,d,f={}){return this.style.setLayoutProperty(g,r,d,f),this._update(!0)}getLayoutProperty(g,r){return this.style.getLayoutProperty(g,r)}setGlyphs(g,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,r,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,r,d,f=>{f||this._update(!0)}),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,r,d=>{d||this._update(!0)}),this}setLight(g,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(g,r){return this.style.setFeatureState(g,r),this._update()}removeFeatureState(g,r){return this.style.removeFeatureState(g,r),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,r=0;return this._container&&(g=this._container.clientWidth||400,r=this._container.clientHeight||300),[g,r]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const r=this._canvasContainer=E.create("div","maplibregl-canvas-container",g);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions();this._resizeCanvas(d[0],d[1],this.getPixelRatio());const f=this._controlContainer=E.create("div","maplibregl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{_[w]=E.create("div",`maplibregl-ctrl-${w} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const g=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=E.create("div","maplibregl-cooperative-gesture-screen",g);let r="Control",d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",r="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",f=>{f.key===r&&(this._metaPress=!0)}),document.addEventListener("keyup",f=>{f.key===r&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",f=>{this._onCooperativeGesture(f,this._metaPress,1)},!1),this._canvasContainer.classList.remove("maplibregl-touch-drag-pan")}_resizeCanvas(g,r,d){this._canvas.width=d*g,this._canvas.height=d*r,this._canvas.style.width=`${g}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const g=a.extend({},m.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1});let r=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{r={requestedAttributes:g},f&&(r.statusMessage=f.statusMessage,r.type=f.type)},{once:!0});const d=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);if(!d){const f="Failed to initialize WebGL";throw r?(r.message=f,new Error(JSON.stringify(r))):new Error(f)}this.painter=new xa(d,this.transform),T.testSupport(d)}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(g,r,d){return!r&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){let r,d=0;const f=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,r),d=a.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,B=a.exported.now();this.style.zoomHistory.update(C,B);const D=new a.EvaluationParameters(C,{now:B,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=D.crossFadingFactor();F===1&&F===this._crossFadingFactor||(_=!0,this._crossFadingFactor=F),this.style.update(D)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._imageQueueDirty=te.processQueue()>0,this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.load),this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const C=a.exported.now()-d;f.endQueryEXT(f.TIME_ELAPSED_EXT,r),setTimeout(()=>{const B=f.getQueryObjectEXT(r,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(r),this.fire(new a.Event("gpu-timing-frame",{cpuTime:C,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(C);this.fire(new a.Event("gpu-timing-layer",{layerTimes:B}))},50)}const w=this._sourcesDirty||this._styleDirty||this._placementDirty||this._imageQueueDirty;return w||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.Event("idle")),!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,a.PerformanceUtils.mark(a.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1)),te.removeThrottleControl(this._imageQueueHandle);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._cooperativeGestures&&E.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map"),a.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=a.exported.frame(g=>{a.PerformanceUtils.frame(g),this._frame=null,this._render(g)}))}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return tp}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(g){this.options=a.extend({},np,g),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),E.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),E.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map.getZoom(),r=g===this._map.getMaxZoom(),d=g===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const g=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=g}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xm(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,r){const d=E.create("button",g,this._container);return d.type="button",d.addEventListener("click",r),d}_setButtonTitle(g,r){const d=this._map._getUIString(`NavigationControl.${r}`);g.title=d,g.setAttribute("aria-label",d)}},GeolocateControl:class extends a.Evented{constructor(g){super(),this.options=a.extend({},Ym,g),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(g){var r;return this._map=g,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),r=this._setupUI,io!==void 0?r(io):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{io=d.state!=="denied",r(io)}):(io=!!window.navigator.geolocation,r(io)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$l=0,Zo=!1}_isOutOfMapMaxBounds(g){const r=this._map.getMaxBounds(),d=g.coords;return r&&(d.longitude<r.getWest()||d.longitude>r.getEast()||d.latitude<r.getSouth()||d.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.Event("geolocate",g)),this._finish()}}_updateCamera(g){const r=new a.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,f=this._map.getBearing(),_=a.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(d),_,{geolocateSource:!0})}_updateMarker(g){if(g){const r=new a.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map._container.clientHeight/2,r=this._map.unproject([0,g]),d=this._map.unproject([1,g]),f=r.distanceTo(d),_=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&Zo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qh(this._dotElement),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$l--,Zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$l++,$l>1?(g={maximumAge:6e5,timeout:0},Zo=!0):(g=this.options.positionOptions,Zo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:zh,LogoControl:Gh,ScaleControl:class{constructor(g){this.options=a.extend({},Km,g),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ap(this._map,this._container,this.options)}onAdd(g){return this._map=g,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(g){this.options.unit=g,ap(this._map,this._container,this.options)}},FullscreenControl:class extends a.Evented{constructor(g={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this.fire(new a.Event(this._fullscreen?"fullscreenstart":"fullscreenend"))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(g){this.options=g,a.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(g){return this._map=g,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends a.Evented{constructor(g){super(),this.options=a.extend(Object.create(sy),g),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=a.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const r=document.createDocumentFragment(),d=document.createElement("body");let f;for(d.innerHTML=g;f=d.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){this._container&&this._container.classList.add(g)}removeClassName(g){this._container&&this._container.classList.remove(g)}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(g){this._update(g.point)}_onMouseMove(g){this._update(g.point)}_onDrag(g){this._update(g.point)}_update(g){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=E.create("div","maplibregl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(w=>this._container.classList.add(w)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rp(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!g))return;const r=this._pos=this._trackPointer&&g?g:this._map.project(this._lngLat);let d=this.options.anchor;const f=Zm(this.options.offset);if(!d){const w=this._container.offsetWidth,C=this._container.offsetHeight;let B;B=r.y+f.bottom.y<C?["top"]:r.y>this._map.transform.height-C?["bottom"]:[],r.x<w/2?B.push("left"):r.x>this._map.transform.width-w/2&&B.push("right"),d=B.length===0?"bottom":B.join("-")}const _=r.add(f[d]).round();E.setTransform(this._container,`${Wh[d]} translate(${_.x}px,${_.y}px)`),sp(this._container,d,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(ay);g&&g.focus()}_onClose(){this.remove()}},Marker:qh,Style:$r,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,Evented:a.Evented,AJAXError:a.AJAXError,config:a.config,CanvasSource:Bi,GeoJSONSource:fi,ImageSource:Dt,RasterDEMTileSource:$e,RasterTileSource:Zt,VectorTileSource:Kt,VideoSource:Qi,prewarm:function(){qt().acquire(It)},clearPrewarmedResources:function(){const g=He;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(It),He=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return oy},get workerCount(){return Xt.workerCount},set workerCount(g){Xt.workerCount=g},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.config.MAX_PARALLEL_IMAGE_REQUESTS=g},workerUrl:"",addProtocol(g,r){a.config.REGISTERED_PROTOCOLS[g]=r},removeProtocol(g){delete a.config.REGISTERED_PROTOCOLS[g]}};return jd.extend(ba,{isSafari:a.isSafari,getPerformanceMetrics:a.PerformanceUtils.getPerformanceMetrics}),ba});var u=s;return u})})(Wy);var _i=Wy.exports;const qy="3.7.5",e2=qy,t2=typeof atob=="function",i2=typeof btoa=="function",Zl=typeof Buffer=="function",$y=typeof TextDecoder=="function"?new TextDecoder:void 0,jy=typeof TextEncoder=="function"?new TextEncoder:void 0,n2="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",su=Array.prototype.slice.call(n2),Sp=(o=>{let e={};return o.forEach((t,i)=>e[t]=i),e})(su),r2=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Zn=String.fromCharCode.bind(String),Xy=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):o=>new Uint8Array(Array.prototype.slice.call(o,0)),Yy=o=>o.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Ky=o=>o.replace(/[^A-Za-z0-9\+\/]/g,""),Zy=o=>{let e,t,i,s,c="";const u=o.length%3;for(let a=0;a<o.length;){if((t=o.charCodeAt(a++))>255||(i=o.charCodeAt(a++))>255||(s=o.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=t<<16|i<<8|s,c+=su[e>>18&63]+su[e>>12&63]+su[e>>6&63]+su[e&63]}return u?c.slice(0,u-3)+"===".substring(u):c},Ag=i2?o=>btoa(o):Zl?o=>Buffer.from(o,"binary").toString("base64"):Zy,_g=Zl?o=>Buffer.from(o).toString("base64"):o=>{let t=[];for(let i=0,s=o.length;i<s;i+=4096)t.push(Zn.apply(null,o.subarray(i,i+4096)));return Ag(t.join(""))},Ip=(o,e=!1)=>e?Yy(_g(o)):_g(o),s2=o=>{if(o.length<2){var e=o.charCodeAt(0);return e<128?o:e<2048?Zn(192|e>>>6)+Zn(128|e&63):Zn(224|e>>>12&15)+Zn(128|e>>>6&63)+Zn(128|e&63)}else{var e=65536+(o.charCodeAt(0)-55296)*1024+(o.charCodeAt(1)-56320);return Zn(240|e>>>18&7)+Zn(128|e>>>12&63)+Zn(128|e>>>6&63)+Zn(128|e&63)}},a2=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Jy=o=>o.replace(a2,s2),ex=Zl?o=>Buffer.from(o,"utf8").toString("base64"):jy?o=>_g(jy.encode(o)):o=>Ag(Jy(o)),Jl=(o,e=!1)=>e?Yy(ex(o)):ex(o),tx=o=>Jl(o,!0),o2=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,l2=o=>{switch(o.length){case 4:var e=(7&o.charCodeAt(0))<<18|(63&o.charCodeAt(1))<<12|(63&o.charCodeAt(2))<<6|63&o.charCodeAt(3),t=e-65536;return Zn((t>>>10)+55296)+Zn((t&1023)+56320);case 3:return Zn((15&o.charCodeAt(0))<<12|(63&o.charCodeAt(1))<<6|63&o.charCodeAt(2));default:return Zn((31&o.charCodeAt(0))<<6|63&o.charCodeAt(1))}},ix=o=>o.replace(o2,l2),nx=o=>{if(o=o.replace(/\s+/g,""),!r2.test(o))throw new TypeError("malformed base64.");o+="==".slice(2-(o.length&3));let e,t="",i,s;for(let c=0;c<o.length;)e=Sp[o.charAt(c++)]<<18|Sp[o.charAt(c++)]<<12|(i=Sp[o.charAt(c++)])<<6|(s=Sp[o.charAt(c++)]),t+=i===64?Zn(e>>16&255):s===64?Zn(e>>16&255,e>>8&255):Zn(e>>16&255,e>>8&255,e&255);return t},yg=t2?o=>atob(Ky(o)):Zl?o=>Buffer.from(o,"base64").toString("binary"):nx,rx=Zl?o=>Xy(Buffer.from(o,"base64")):o=>Xy(yg(o).split("").map(e=>e.charCodeAt(0))),sx=o=>rx(ax(o)),c2=Zl?o=>Buffer.from(o,"base64").toString("utf8"):$y?o=>$y.decode(rx(o)):o=>ix(yg(o)),ax=o=>Ky(o.replace(/[-_]/g,e=>e=="-"?"+":"/")),xg=o=>c2(ax(o)),h2=o=>{if(typeof o!="string")return!1;const e=o.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},ox=o=>({value:o,enumerable:!1,writable:!0,configurable:!0}),lx=function(){const o=(e,t)=>Object.defineProperty(String.prototype,e,ox(t));o("fromBase64",function(){return xg(this)}),o("toBase64",function(e){return Jl(this,e)}),o("toBase64URI",function(){return Jl(this,!0)}),o("toBase64URL",function(){return Jl(this,!0)}),o("toUint8Array",function(){return sx(this)})},cx=function(){const o=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,ox(t));o("toBase64",function(e){return Ip(this,e)}),o("toBase64URI",function(){return Ip(this,!0)}),o("toBase64URL",function(){return Ip(this,!0)})},u2={version:qy,VERSION:e2,atob:yg,atobPolyfill:nx,btoa:Ag,btoaPolyfill:Zy,fromBase64:xg,toBase64:Jl,encode:Jl,encodeURI:tx,encodeURL:tx,utob:Jy,btou:ix,decode:xg,isValid:h2,fromUint8Array:Ip,toUint8Array:sx,extendString:lx,extendUint8Array:cx,extendBuiltins:()=>{lx(),cx()}};let Cp;const d2=new Uint8Array(16);function p2(){if(!Cp&&(Cp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Cp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Cp(d2)}const Jn=[];for(let o=0;o<256;++o)Jn.push((o+256).toString(16).slice(1));function f2(o,e=0){return(Jn[o[e+0]]+Jn[o[e+1]]+Jn[o[e+2]]+Jn[o[e+3]]+"-"+Jn[o[e+4]]+Jn[o[e+5]]+"-"+Jn[o[e+6]]+Jn[o[e+7]]+"-"+Jn[o[e+8]]+Jn[o[e+9]]+"-"+Jn[o[e+10]]+Jn[o[e+11]]+Jn[o[e+12]]+Jn[o[e+13]]+Jn[o[e+14]]+Jn[o[e+15]]).toLowerCase()}var hx={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function m2(o,e,t){if(hx.randomUUID&&!e&&!o)return hx.randomUUID();o=o||{};const i=o.random||(o.rng||p2)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=i[s];return e}return f2(i)}var g2;function co(){}co.prototype=Object.create(null);function Xi(){Xi.init.call(this)}Xi.EventEmitter=Xi,Xi.usingDomains=!1,Xi.prototype.domain=void 0,Xi.prototype._events=void 0,Xi.prototype._maxListeners=void 0,Xi.defaultMaxListeners=10,Xi.init=function(){this.domain=null,Xi.usingDomains&&g2.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new co,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Xi.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this};function ux(o){return o._maxListeners===void 0?Xi.defaultMaxListeners:o._maxListeners}Xi.prototype.getMaxListeners=function(){return ux(this)};function A2(o,e,t){if(e)o.call(t);else for(var i=o.length,s=au(o,i),c=0;c<i;++c)s[c].call(t)}function _2(o,e,t,i){if(e)o.call(t,i);else for(var s=o.length,c=au(o,s),u=0;u<s;++u)c[u].call(t,i)}function y2(o,e,t,i,s){if(e)o.call(t,i,s);else for(var c=o.length,u=au(o,c),a=0;a<c;++a)u[a].call(t,i,s)}function x2(o,e,t,i,s,c){if(e)o.call(t,i,s,c);else for(var u=o.length,a=au(o,u),m=0;m<u;++m)a[m].call(t,i,s,c)}function v2(o,e,t,i){if(e)o.apply(t,i);else for(var s=o.length,c=au(o,s),u=0;u<s;++u)c[u].apply(t,i)}Xi.prototype.emit=function(e){var t,i,s,c,u,a,m,A=e==="error";if(a=this._events,a)A=A&&a.error==null;else if(!A)return!1;if(m=this.domain,A){if(t=arguments[1],m)t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=m,t.domainThrown=!1,m.emit("error",t);else{if(t instanceof Error)throw t;var x=new Error('Uncaught, unspecified "error" event. ('+t+")");throw x.context=t,x}return!1}if(i=a[e],!i)return!1;var b=typeof i=="function";switch(s=arguments.length,s){case 1:A2(i,b,this);break;case 2:_2(i,b,this,arguments[1]);break;case 3:y2(i,b,this,arguments[1],arguments[2]);break;case 4:x2(i,b,this,arguments[1],arguments[2],arguments[3]);break;default:for(c=new Array(s-1),u=1;u<s;u++)c[u-1]=arguments[u];v2(i,b,this,c)}return!0};function dx(o,e,t,i){var s,c,u;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(c=o._events,c?(c.newListener&&(o.emit("newListener",e,t.listener?t.listener:t),c=o._events),u=c[e]):(c=o._events=new co,o._eventsCount=0),!u)u=c[e]=t,++o._eventsCount;else if(typeof u=="function"?u=c[e]=i?[t,u]:[u,t]:i?u.unshift(t):u.push(t),!u.warned&&(s=ux(o),s&&s>0&&u.length>s)){u.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=o,a.type=e,a.count=u.length,b2(a)}return o}function b2(o){typeof console.warn=="function"?console.warn(o):console.log(o)}Xi.prototype.addListener=function(e,t){return dx(this,e,t,!1)},Xi.prototype.on=Xi.prototype.addListener,Xi.prototype.prependListener=function(e,t){return dx(this,e,t,!0)};function px(o,e,t){var i=!1;function s(){o.removeListener(e,s),i||(i=!0,t.apply(o,arguments))}return s.listener=t,s}Xi.prototype.once=function(e,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.on(e,px(this,e,t)),this},Xi.prototype.prependOnceListener=function(e,t){if(typeof t!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(e,px(this,e,t)),this},Xi.prototype.removeListener=function(e,t){var i,s,c,u,a;if(typeof t!="function")throw new TypeError('"listener" argument must be a function');if(s=this._events,!s)return this;if(i=s[e],!i)return this;if(i===t||i.listener&&i.listener===t)--this._eventsCount===0?this._events=new co:(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(c=-1,u=i.length;u-- >0;)if(i[u]===t||i[u].listener&&i[u].listener===t){a=i[u].listener,c=u;break}if(c<0)return this;if(i.length===1){if(i[0]=void 0,--this._eventsCount===0)return this._events=new co,this;delete s[e]}else w2(i,c);s.removeListener&&this.emit("removeListener",e,a||t)}return this},Xi.prototype.off=function(o,e){return this.removeListener(o,e)},Xi.prototype.removeAllListeners=function(e){var t,i;if(i=this._events,!i)return this;if(!i.removeListener)return arguments.length===0?(this._events=new co,this._eventsCount=0):i[e]&&(--this._eventsCount===0?this._events=new co:delete i[e]),this;if(arguments.length===0){for(var s=Object.keys(i),c=0,u;c<s.length;++c)u=s[c],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=new co,this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t)do this.removeListener(e,t[t.length-1]);while(t[0]);return this},Xi.prototype.listeners=function(e){var t,i,s=this._events;return s?(t=s[e],t?typeof t=="function"?i=[t.listener||t]:i=E2(t):i=[]):i=[],i},Xi.listenerCount=function(o,e){return typeof o.listenerCount=="function"?o.listenerCount(e):fx.call(o,e)},Xi.prototype.listenerCount=fx;function fx(o){var e=this._events;if(e){var t=e[o];if(typeof t=="function")return 1;if(t)return t.length}return 0}Xi.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function w2(o,e){for(var t=e,i=t+1,s=o.length;i<s;t+=1,i+=1)o[t]=o[i];o.pop()}function au(o,e){for(var t=new Array(e);e--;)t[e]=o[e];return t}function E2(o){for(var e=new Array(o.length),t=0;t<e.length;++t)e[t]=o[t].listener||o[t];return e}function S2(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class I2{constructor(){this._apiKey="",this._fetch=S2()}set apiKey(e){this._apiKey=e}get apiKey(){return this._apiKey}set fetch(e){this._fetch=e}get fetch(){return this._fetch}}const ec=new I2,C2={AUTO:"auto",ALBANIAN:"sq",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HUNGARIAN:"hu",ICELANDIC:"is",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALTESE:"mt",NORWEGIAN:"no",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"};new Set(Object.values(C2));var M2=(o,e,t)=>new Promise((i,s)=>{var c=m=>{try{a(t.next(m))}catch(A){s(A)}},u=m=>{try{a(t.throw(m))}catch(A){s(A)}},a=m=>m.done?i(m.value):Promise.resolve(m.value).then(c,u);a((t=t.apply(o,e)).next())});function T2(o){return M2(this,arguments,function*(e,t={}){if(ec.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(e).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return ec.fetch(e,t)})}const mx={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(mx);class B2 extends Error{constructor(e,t=""){super(`Call to enpoint ${e.url} failed with the status code ${e.status}. ${t}`),this.res=e}}var R2=(o,e,t)=>new Promise((i,s)=>{var c=m=>{try{a(t.next(m))}catch(A){s(A)}},u=m=>{try{a(t.throw(m))}catch(A){s(A)}},a=m=>m.done?i(m.value):Promise.resolve(m.value).then(c,u);a((t=t.apply(o,e)).next())});const gx={403:"Key is missing, invalid or restricted"};function L2(){return R2(this,arguments,function*(o={}){var e;const t=new URL("geolocation/ip.json",mx.maptilerApiURL);t.searchParams.set("key",(e=o.apiKey)!=null?e:ec.apiKey);const i=t.toString(),s=yield T2(i);if(!s.ok)throw new B2(s,s.status in gx?gx[s.status]:"");return yield s.json()})}const Ax={info:L2};function _x(o){const e=/^maptiler:\/\/(.*)/;let t;const i=o.trim();let s;return i.startsWith("http://")||i.startsWith("https://")?s=i:(t=e.exec(i))!==null?s=`https://api.maptiler.com/maps/${t[1]}/style.json`:s=`https://api.maptiler.com/maps/${i}/style.json`,s}class yx{constructor(e,t,i,s,c,u){this.name=e,this.variantType=t,this.id=i,this.referenceStyle=s,this.description=c,this.imageURL=u}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(e){return this.referenceStyle.hasVariant(e)}getVariant(e){return this.referenceStyle.getVariant(e)}getVariants(){return this.referenceStyle.getVariants().filter(e=>e!==this)}getImageURL(){return this.imageURL}getExpandedStyleURL(){return _x(this.getId())}}class xx{constructor(e,t){this.name=e,this.id=t,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(e){this.variants[e.getType()]=e,this.orderedVariants.push(e)}hasVariant(e){return e in this.variants}getVariant(e){return e in this.variants?this.variants[e]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0]}}const vg=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]}];function D2(o){return new Proxy(o,{get(e,t,i){return e.hasVariant(t)?e.getVariant(t):t.toString().toUpperCase()===t?o.getDefaultVariant():Reflect.get(e,t,i)}})}function P2(){const o={};for(let e=0;e<vg.length;e+=1){const t=vg[e],i=D2(new xx(t.name,t.referenceStyleID));for(let s=0;s<t.variants.length;s+=1){const c=t.variants[s],u=new yx(c.name,c.variantType,c.id,i,c.description,c.imageURL);i.addVariant(u)}o[t.referenceStyleID]=i}return o}const U2=P2(),Fs={AUTO:"auto",STYLE_LOCK:"style_lock",LATIN:"latin",NON_LATIN:"nonlatin",LOCAL:"",ALBANIAN:"sq",AMHARIC:"am",ARABIC:"ar",ARMENIAN:"hy",AZERBAIJANI:"az",BASQUE:"eu",BELORUSSIAN:"be",BOSNIAN:"bs",BRETON:"br",BULGARIAN:"bg",CATALAN:"ca",CHINESE:"zh",CORSICAN:"co",CROATIAN:"hr",CZECH:"cs",DANISH:"da",DUTCH:"nl",ENGLISH:"en",ESPERANTO:"eo",ESTONIAN:"et",FINNISH:"fi",FRENCH:"fr",FRISIAN:"fy",GEORGIAN:"ka",GERMAN:"de",GREEK:"el",HEBREW:"he",HINDI:"hi",HUNGARIAN:"hu",ICELANDIC:"is",INDONESIAN:"id",IRISH:"ga",ITALIAN:"it",JAPANESE:"ja",JAPANESE_HIRAGANA:"ja-Hira",JAPANESE_KANA:"ja_kana",JAPANESE_LATIN:"ja_rm",JAPANESE_2018:"ja-Latn",KANNADA:"kn",KAZAKH:"kk",KOREAN:"ko",KOREAN_LATIN:"ko-Latn",KURDISH:"ku",ROMAN_LATIN:"la",LATVIAN:"lv",LITHUANIAN:"lt",LUXEMBOURGISH:"lb",MACEDONIAN:"mk",MALAYALAM:"ml",MALTESE:"mt",NORWEGIAN:"no",OCCITAN:"oc",POLISH:"pl",PORTUGUESE:"pt",ROMANIAN:"ro",ROMANSH:"rm",RUSSIAN:"ru",SCOTTISH_GAELIC:"gd",SERBIAN_CYRILLIC:"sr",SERBIAN_LATIN:"sr-Latn",SLOVAK:"sk",SLOVENE:"sl",SPANISH:"es",SWEDISH:"sv",TAMIL:"ta",TELUGU:"te",THAI:"th",TURKISH:"tr",UKRAINIAN:"uk",WELSH:"cy"},F2=new Set(Object.values(Fs));function vx(o){return F2.has(o)}const k2=new Set(Object.values(Fs));function bg(){if(typeof navigator>"u")return Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];const o=Array.from(new Set(navigator.languages.map(e=>e.split("-")[0]))).filter(e=>k2.has(e));return o.length?o[0]:Fs.LATIN}class N2 extends Xi{constructor(){super(),this.primaryLanguage=Fs.AUTO,this.secondaryLanguage=null,this.session=!0,this._unit="metric",this._apiKey=""}set unit(e){this._unit=e,this.emit("unit",e)}get unit(){return this._unit}set apiKey(e){this._apiKey=e,ec.apiKey=e,this.emit("apiKey",e)}get apiKey(){return this._apiKey}set fetch(e){ec.fetch=e}get fetch(){return ec.fetch}}const na=new N2,zr={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Fs.AUTO,secondaryLanguage:Fs.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(zr);class O2 extends _i.LogoControl{onAdd(e){return super.onAdd(e)}}class bx extends O2{constructor(e={}){var t,i;super(e),this.logoURL="",this.linkURL="",this.logoURL=(t=e.logoURL)!=null?t:zr.maptilerLogoURL,this.linkURL=(i=e.linkURL)!=null?i:zr.maptilerURL}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const t=window.document.createElement("a");return t.style.backgroundRepeat="no-repeat",t.style.cursor="pointer",t.style.display="block",t.style.height="23px",t.style.margin="0 0 -4px -4px",t.style.overflow="hidden",t.style.width="88px",t.style.backgroundImage=`url(${this.logoURL})`,t.style.backgroundSize="100px 30px",t.style.width="100px",t.style.height="30px",t.target="_blank",t.rel="noopener nofollow",t.href=this.linkURL,t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}}function z2(){_i.getRTLTextPluginStatus()==="unavailable"&&_i.setRTLTextPlugin(zr.rtlPluginURL,null,!0)}function G2(o,e){o.forEach(t=>{!e[t]||(e[t]=e[t].bind(e))})}function rl(o,e,t){const i=window.document.createElement(o);return e!==void 0&&(i.className=e),t&&t.appendChild(i),i}function Q2(o){o.parentNode&&o.parentNode.removeChild(o)}function wx(o){return o?typeof o=="string"||o instanceof String?!o.startsWith("http")&&o.toLowerCase().includes(".json")?o:_x(o):o instanceof yx?o.getExpandedStyleURL():o instanceof xx?o.getDefaultVariant().getExpandedStyleURL():o:U2[vg[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL()}class V2{constructor(){G2(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(e){return this._map=e,this._container=rl("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=rl("button","maplibregl-ctrl-terrain",this._container),rl("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q2(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.hasTerrain()?this._map.disableTerrain():this._map.enableTerrain(),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}}class H2 extends _i.NavigationControl{onAdd(e){return super.onAdd(e)}}class W2 extends H2{constructor(){super({showCompass:!0,showZoom:!0,visualizePitch:!0}),this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",e=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})}_createButton(e,t){const i=super._createButton(e,t);return i.clickFunction=t,i}_rotateCompassArrow(){const e=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5))}) rotateX(${Math.min(70,this._map.transform.pitch)}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e}}class q2 extends _i.GeolocateControl{onAdd(e){return super.onAdd(e)}}var $2=Object.defineProperty,j2=Object.defineProperties,X2=Object.getOwnPropertyDescriptors,Ex=Object.getOwnPropertySymbols,Y2=Object.prototype.hasOwnProperty,K2=Object.prototype.propertyIsEnumerable,Sx=(o,e,t)=>e in o?$2(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,Z2=(o,e)=>{for(var t in e||(e={}))Y2.call(e,t)&&Sx(o,t,e[t]);if(Ex)for(var t of Ex(e))K2.call(e,t)&&Sx(o,t,e[t]);return o},J2=(o,e)=>j2(o,X2(e));const Ix=_i.Marker,Cx=_i.LngLat;class eM extends q2{constructor(){super(...arguments),this.lastUpdatedCenter=new Cx(0,0)}_updateCamera(e){const t=new Cx(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,s=this._map.getBearing(),c=J2(Z2({bearing:s},this.options.fitBoundsOptions),{linear:!0}),u=this._map.getZoom();u>this.options.fitBoundsOptions.maxZoom&&(c.zoom=u),this._map.fitBounds(t.toBounds(i),c,{geolocateSource:!0});let a=!1;const m=()=>{a=!0};this._map.once("click",m),this._map.once("dblclick",m),this._map.once("dragstart",m),this._map.once("mousedown",m),this._map.once("touchstart",m),this._map.once("wheel",m),this._map.once("moveend",()=>{this._map.off("click",m),this._map.off("dblclick",m),this._map.off("dragstart",m),this._map.off("mousedown",m),this._map.off("touchstart",m),this._map.off("wheel",m),!a&&(this.lastUpdatedCenter=this._map.getCenter())})}_setupUI(e){if(this.lastUpdatedCenter=this._map.getCenter(),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=rl("button","maplibregl-ctrl-geolocate",this._container),rl("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=rl("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ix(this._dotElement),this._circleElement=rl("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ix({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",t=>{const i=t.originalEvent&&t.originalEvent.type==="resize",s=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!t.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!i&&s>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const e=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],t=this._map.project(e),i=this._map.unproject([t.x,t.y]),s=this._map.unproject([t.x+20,t.y]),c=i.distanceTo(s)/20,u=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}}class tM extends _i.AttributionControl{onAdd(e){return super.onAdd(e)}}class iM extends _i.ScaleControl{onAdd(e){return super.onAdd(e)}}class nM extends _i.FullscreenControl{onAdd(e){return super.onAdd(e)}}var rM=Object.defineProperty,sM=Object.defineProperties,aM=Object.getOwnPropertyDescriptors,Mx=Object.getOwnPropertySymbols,oM=Object.prototype.hasOwnProperty,lM=Object.prototype.propertyIsEnumerable,Tx=(o,e,t)=>e in o?rM(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,cM=(o,e)=>{for(var t in e||(e={}))oM.call(e,t)&&Tx(o,t,e[t]);if(Mx)for(var t of Mx(e))lM.call(e,t)&&Tx(o,t,e[t]);return o},hM=(o,e)=>sM(o,aM(e)),ho=(o,e,t)=>new Promise((i,s)=>{var c=m=>{try{a(t.next(m))}catch(A){s(A)}},u=m=>{try{a(t.throw(m))}catch(A){s(A)}},a=m=>m.done?i(m.value):Promise.resolve(m.value).then(c,u);a((t=t.apply(o,e)).next())});const Bx=m2(),uM={POINT:"POINT",COUNTRY:"COUNTRY"};class DO extends _i.Map{constructor(e){var t,i,s;e.apiKey&&(na.apiKey=e.apiKey);const c=wx(e.style),u=location.hash;na.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!"),super(hM(cM({},e),{style:c,maplibreLogo:!1,transformRequest:b=>{let I=null;try{I=new URL(b)}catch{return{url:b,headers:{}}}return I.host===zr.maptilerApiHost&&(I.searchParams.has("key")||I.searchParams.append("key",na.apiKey),na.session&&I.searchParams.append("mtsid",Bx)),{url:I.href,headers:{}}}})),this.isTerrainEnabled=!1,this.terrainExaggeration=1,this.primaryLanguage=null,this.secondaryLanguage=null,this.terrainGrowing=!1,this.terrainFlattening=!1,this.primaryLanguage=(t=e.language)!=null?t:na.primaryLanguage,this.secondaryLanguage=na.secondaryLanguage,this.terrainExaggeration=(i=e.terrainExaggeration)!=null?i:this.terrainExaggeration,this.once("styledata",()=>ho(this,null,function*(){if(!e.geolocate||e.center||e.hash&&!!u)return;try{if(e.geolocate===uM.COUNTRY){yield this.fitToIpBounds();return}}catch(E){console.warn(E.message)}let b=null;try{yield this.centerOnIpPoint(e.zoom),b=this.getCameraHash()}catch(E){console.warn(E.message)}(yield navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(E=>{b===this.getCameraHash()&&(this.terrain?this.easeTo({center:[E.coords.longitude,E.coords.latitude],zoom:e.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[E.coords.longitude,E.coords.latitude],zoom:e.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})})),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage),this.setSecondaryLanguage(this.secondaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",()=>ho(this,null,function*(){z2()})),this.once("load",()=>ho(this,null,function*(){let b={logo:null};try{const I=Object.keys(this.style.sourceCaches).map(U=>this.getSource(U)).filter(U=>typeof U.url=="string"&&U.url.includes("tiles.json")),E=new URL(I[0].url);E.searchParams.has("key")||E.searchParams.append("key",na.apiKey),b=yield(yield fetch(E.href)).json()}catch{}if("logo"in b&&b.logo){const I=b.logo;this.addControl(new bx({logoURL:I}),e.logoPosition),e.attributionControl===!1&&this.addControl(new tM(e))}else e.maptilerLogo&&this.addControl(new bx,e.logoPosition);if(e.scaleControl){const I=e.scaleControl===!0||e.scaleControl===void 0?"bottom-right":e.scaleControl,E=new iM({unit:na.unit});this.addControl(E,I),na.on("unit",T=>{E.setUnit(T)})}if(e.navigationControl!==!1){const I=e.navigationControl===!0||e.navigationControl===void 0?"top-right":e.navigationControl;this.addControl(new W2,I)}if(e.geolocateControl!==!1){const I=e.geolocateControl===!0||e.geolocateControl===void 0?"top-right":e.geolocateControl;this.addControl(new eM({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),I)}if(e.terrainControl){const I=e.terrainControl===!0||e.terrainControl===void 0?"top-right":e.terrainControl;this.addControl(new V2,I)}if(e.fullscreenControl){const I=e.fullscreenControl===!0||e.fullscreenControl===void 0?"top-right":e.fullscreenControl;this.addControl(new nM({}),I)}}));let a=!1,m=!1,A=null;this.once("load",b=>{a=!0,m&&this.fire("loadWithTerrain",A)});const x=b=>{!b.terrain||(m=!0,A={type:"loadWithTerrain",target:this,terrain:b.terrain},this.off("terrain",x),a&&this.fire("loadWithTerrain",A))};this.on("terrain",x),e.terrain&&this.enableTerrain((s=e.terrainExaggeration)!=null?s:this.terrainExaggeration)}onLoadAsync(){return ho(this,null,function*(){return new Promise((e,t)=>{if(this.loaded())return e(this);this.once("load",i=>{e(this)})})})}onLoadWithTerrainAsync(){return ho(this,null,function*(){return new Promise((e,t)=>{if(this.loaded()&&this.terrain)return e(this);this.once("loadWithTerrain",i=>{e(this)})})})}setStyle(e,t){return super.setStyle(wx(e),t)}setLanguage(e=zr.primaryLanguage){if(e===Fs.AUTO)return this.setLanguage(bg());this.setPrimaryLanguage(e)}setPrimaryLanguage(e=zr.primaryLanguage){if(this.primaryLanguage===Fs.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}!vx(e)||(this.primaryLanguage=e,this.onStyleReady(()=>{if(e===Fs.AUTO)return this.setPrimaryLanguage(bg());const t=this.getStyle().layers,i=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,s=/^\s*name\s*(:\s*(\S*))?\s*$/,c=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/,u=/^(.*)({\s*name\s*(:\s*(\S*))?\s*})(.*)$/,a=e?`name:${e}`:"name",m=["case",["has",a],["get",a],["get","name"]];for(let A=0;A<t.length;A+=1){const x=t[A],b=x.layout;if(!b||!b["text-field"])continue;const I=this.getLayoutProperty(x.id,"text-field");let E;if(Array.isArray(I)&&I.length>=2&&I[0].trim().toLowerCase()==="concat"){const T=I.slice();for(let U=0;U<I.length;U+=1){const P=I[U];if((typeof P=="string"||P instanceof String)&&i.exec(P.toString())){T[U]=m;break}else if(Array.isArray(P)&&P.length>=2&&P[0].trim().toLowerCase()==="get"&&s.exec(P[1].toString())){T[U]=m;break}else if(Array.isArray(P)&&P.length===4&&P[0].trim().toLowerCase()==="case"){T[U]=m;break}}this.setLayoutProperty(x.id,"text-field",T)}else if(Array.isArray(I)&&I.length>=2&&I[0].trim().toLowerCase()==="get"&&s.exec(I[1].toString())){const T=m;this.setLayoutProperty(x.id,"text-field",T)}else if((typeof I=="string"||I instanceof String)&&i.exec(I.toString())){const T=m;this.setLayoutProperty(x.id,"text-field",T)}else if(Array.isArray(I)&&I.length===4&&I[0].trim().toLowerCase()==="case"){const T=m;this.setLayoutProperty(x.id,"text-field",T)}else if((typeof I=="string"||I instanceof String)&&(E=c.exec(I.toString()))!==null){const T=`{${a}}${E[3]}{name${E[4]||""}}`;this.setLayoutProperty(x.id,"text-field",T)}else if((typeof I=="string"||I instanceof String)&&(E=u.exec(I.toString()))!==null){const T=`${E[1]}{${a}}${E[5]}`;this.setLayoutProperty(x.id,"text-field",T)}}}))}setSecondaryLanguage(e=zr.secondaryLanguage){if(this.primaryLanguage===Fs.STYLE_LOCK){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}!vx(e)||(this.secondaryLanguage=e,this.onStyleReady(()=>{if(e===Fs.AUTO)return this.setSecondaryLanguage(bg());const t=this.getStyle().layers,i=/^\s*{\s*name\s*(:\s*(\S*))?\s*}$/,s=/^\s*name\s*(:\s*(\S*))?\s*$/,c=/^\s*{\s*name\s*(:\s*(\S*))?\s*}(\s*){\s*name\s*(:\s*(\S*))?\s*}$/;let u;for(let a=0;a<t.length;a+=1){const m=t[a],A=m.layout;if(!A||!A["text-field"])continue;const x=this.getLayoutProperty(m.id,"text-field");let b;if(Array.isArray(x)&&x.length>=2&&x[0].trim().toLowerCase()==="concat"){b=x.slice();let I=0;for(let E=0;E<x.length;E+=1){const T=x[E];if((typeof T=="string"||T instanceof String)&&i.exec(T.toString())){if(I===1){b[E]=`{name:${e}}`;break}I+=1}else if(Array.isArray(T)&&T.length>=2&&T[0].trim().toLowerCase()==="get"&&s.exec(T[1].toString())){if(I===1){b[E][1]=`name:${e}`;break}I+=1}else if(Array.isArray(T)&&T.length===4&&T[0].trim().toLowerCase()==="case"){if(I===1){b[E]=["get",`name:${e}`];break}I+=1}}this.setLayoutProperty(m.id,"text-field",b)}else if((typeof x=="string"||x instanceof String)&&(u=c.exec(x.toString()))!==null){const I=e?`name:${e}`:"name";b=`{name${u[1]||""}}${u[3]}{${I}}`,this.setLayoutProperty(m.id,"text-field",b)}}}))}getPrimaryLanguage(){return this.primaryLanguage}getSecondaryLanguage(){return this.secondaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(e,t=1e3){if(!this.terrain)return;const i=performance.now(),s=this.terrain.exaggeration,c=e-s,u=()=>{if(!this.terrain||this.terrainFlattening)return;const a=(performance.now()-i)/t;if(a<.99){const m=1-Math.pow(1-a,4),A=s+m*c;this.terrain.exaggeration=A,requestAnimationFrame(u)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=e;this.triggerRepaint()};this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(u)}enableTerrain(e=this.terrainExaggeration){if(e<0){console.warn("Terrain exaggeration cannot be negative.");return}const t=s=>ho(this,null,function*(){!this.terrain||s.type!=="data"||s.dataType!=="source"||!("source"in s)||s.sourceId!=="maptiler-terrain"||s.source.type!=="raster-dem"||!s.isSourceLoaded||(this.off("data",t),this.growTerrain(e))}),i=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=e,this.on("data",t),this.addSource(zr.terrainSourceId,{type:"raster-dem",url:zr.terrainSourceURL}),this.setTerrain({source:zr.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(e);return}this.loaded()||this.isTerrainEnabled?i():this.once("load",()=>{this.getTerrain()&&this.getSource(zr.terrainSourceId)||i()})}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const e=1*1e3,t=performance.now(),i=this.terrain.exaggeration,s=()=>{if(!this.terrain||this.terrainGrowing)return;const c=(performance.now()-t)/e;if(c<.99){const u=Math.pow(1-c,4),a=i*u;this.terrain.exaggeration=a,requestAnimationFrame(s)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(null),this.getSource(zr.terrainSourceId)&&this.removeSource(zr.terrainSourceId);this.triggerRepaint()};this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(s)}setTerrainExaggeration(e,t=!0){!t&&this.terrain?(this.terrainExaggeration=e,this.terrain.exaggeration=e,this.triggerRepaint()):this.enableTerrain(e)}onStyleReady(e){this.isStyleLoaded()?e():this.once("styledata",()=>{e()})}fitToIpBounds(){return ho(this,null,function*(){const e=yield Ax.info();this.fitBounds(e.country_bounds,{duration:0,padding:100})})}centerOnIpPoint(e){return ho(this,null,function*(){const t=yield Ax.info();this.jumpTo({center:[t.longitude,t.latitude],zoom:e||11})})}getCameraHash(){const e=new Float32Array(5),t=this.getCenter();return e[0]=t.lng,e[1]=t.lat,e[2]=this.getZoom(),e[3]=this.getPitch(),e[4]=this.getBearing(),u2.fromUint8Array(new Uint8Array(e.buffer))}getSdkConfig(){return na}getMaptilerSessionId(){return Bx}}class PO extends _i.Marker{addTo(e){return super.addTo(e)}}class UO extends _i.Popup{addTo(e){return super.addTo(e)}}class FO extends _i.Style{constructor(e,t={}){super(e,t)}}class kO extends _i.CanvasSource{onAdd(e){super.onAdd(e)}}class NO extends _i.GeoJSONSource{onAdd(e){super.onAdd(e)}}class OO extends _i.ImageSource{onAdd(e){super.onAdd(e)}}class zO extends _i.RasterTileSource{onAdd(e){super.onAdd(e)}}class GO extends _i.RasterDEMTileSource{onAdd(e){super.onAdd(e)}}class QO extends _i.VectorTileSource{onAdd(e){super.onAdd(e)}}class VO extends _i.VideoSource{onAdd(e){super.onAdd(e)}}class HO extends _i.TerrainControl{onAdd(e){return super.onAdd(e)}}const{supported:WO,setRTLTextPlugin:qO,getRTLTextPluginStatus:$O,LngLat:Rx,LngLatBounds:jO,MercatorCoordinate:XO,Evented:YO,AJAXError:KO,prewarm:ZO,clearPrewarmedResources:JO,version:ez,workerCount:tz,maxParallelImageRequests:iz,workerUrl:nz,addProtocol:rz,removeProtocol:sz}=_i;_i.Map,_i.Marker,_i.Popup,_i.Style,_i.CanvasSource,_i.GeoJSONSource,_i.ImageSource,_i.RasterTileSource,_i.RasterDEMTileSource,_i.VectorTileSource,_i.VideoSource,_i.NavigationControl,_i.GeolocateControl,_i.AttributionControl,_i.LogoControl,_i.ScaleControl,_i.FullscreenControl,_i.TerrainControl;var Lx=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},ra=[],ps=[],dM=typeof Uint8Array<"u"?Uint8Array:Array,wg=!1;function Dx(){wg=!0;for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,t=o.length;e<t;++e)ra[e]=o[e],ps[o.charCodeAt(e)]=e;ps["-".charCodeAt(0)]=62,ps["_".charCodeAt(0)]=63}function pM(o){wg||Dx();var e,t,i,s,c,u,a=o.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");c=o[a-2]==="="?2:o[a-1]==="="?1:0,u=new dM(a*3/4-c),i=c>0?a-4:a;var m=0;for(e=0,t=0;e<i;e+=4,t+=3)s=ps[o.charCodeAt(e)]<<18|ps[o.charCodeAt(e+1)]<<12|ps[o.charCodeAt(e+2)]<<6|ps[o.charCodeAt(e+3)],u[m++]=s>>16&255,u[m++]=s>>8&255,u[m++]=s&255;return c===2?(s=ps[o.charCodeAt(e)]<<2|ps[o.charCodeAt(e+1)]>>4,u[m++]=s&255):c===1&&(s=ps[o.charCodeAt(e)]<<10|ps[o.charCodeAt(e+1)]<<4|ps[o.charCodeAt(e+2)]>>2,u[m++]=s>>8&255,u[m++]=s&255),u}function fM(o){return ra[o>>18&63]+ra[o>>12&63]+ra[o>>6&63]+ra[o&63]}function mM(o,e,t){for(var i,s=[],c=e;c<t;c+=3)i=(o[c]<<16)+(o[c+1]<<8)+o[c+2],s.push(fM(i));return s.join("")}function Px(o){wg||Dx();for(var e,t=o.length,i=t%3,s="",c=[],u=16383,a=0,m=t-i;a<m;a+=u)c.push(mM(o,a,a+u>m?m:a+u));return i===1?(e=o[t-1],s+=ra[e>>2],s+=ra[e<<4&63],s+="=="):i===2&&(e=(o[t-2]<<8)+o[t-1],s+=ra[e>>10],s+=ra[e>>4&63],s+=ra[e<<2&63],s+="="),c.push(s),c.join("")}function Mp(o,e,t,i,s){var c,u,a=s*8-i-1,m=(1<<a)-1,A=m>>1,x=-7,b=t?s-1:0,I=t?-1:1,E=o[e+b];for(b+=I,c=E&(1<<-x)-1,E>>=-x,x+=a;x>0;c=c*256+o[e+b],b+=I,x-=8);for(u=c&(1<<-x)-1,c>>=-x,x+=i;x>0;u=u*256+o[e+b],b+=I,x-=8);if(c===0)c=1-A;else{if(c===m)return u?NaN:(E?-1:1)*(1/0);u=u+Math.pow(2,i),c=c-A}return(E?-1:1)*u*Math.pow(2,c-i)}function Ux(o,e,t,i,s,c){var u,a,m,A=c*8-s-1,x=(1<<A)-1,b=x>>1,I=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=i?0:c-1,T=i?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,u=x):(u=Math.floor(Math.log(e)/Math.LN2),e*(m=Math.pow(2,-u))<1&&(u--,m*=2),u+b>=1?e+=I/m:e+=I*Math.pow(2,1-b),e*m>=2&&(u++,m/=2),u+b>=x?(a=0,u=x):u+b>=1?(a=(e*m-1)*Math.pow(2,s),u=u+b):(a=e*Math.pow(2,b-1)*Math.pow(2,s),u=0));s>=8;o[t+E]=a&255,E+=T,a/=256,s-=8);for(u=u<<s|a,A+=s;A>0;o[t+E]=u&255,E+=T,u/=256,A-=8);o[t+E-T]|=U*128}var gM={}.toString,Fx=Array.isArray||function(o){return gM.call(o)=="[object Array]"},AM=50;dt.TYPED_ARRAY_SUPPORT=Lx.TYPED_ARRAY_SUPPORT!==void 0?Lx.TYPED_ARRAY_SUPPORT:!0,Tp();function Tp(){return dt.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Ia(o,e){if(Tp()<e)throw new RangeError("Invalid typed array length");return dt.TYPED_ARRAY_SUPPORT?(o=new Uint8Array(e),o.__proto__=dt.prototype):(o===null&&(o=new dt(e)),o.length=e),o}function dt(o,e,t){if(!dt.TYPED_ARRAY_SUPPORT&&!(this instanceof dt))return new dt(o,e,t);if(typeof o=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return Eg(this,o)}return kx(this,o,e,t)}dt.poolSize=8192,dt._augment=function(o){return o.__proto__=dt.prototype,o};function kx(o,e,t,i){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?xM(o,e,t,i):typeof e=="string"?yM(o,e,t):vM(o,e)}dt.from=function(o,e,t){return kx(null,o,e,t)},dt.TYPED_ARRAY_SUPPORT&&(dt.prototype.__proto__=Uint8Array.prototype,dt.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&dt[Symbol.species]);function Nx(o){if(typeof o!="number")throw new TypeError('"size" argument must be a number');if(o<0)throw new RangeError('"size" argument must not be negative')}function _M(o,e,t,i){return Nx(e),e<=0?Ia(o,e):t!==void 0?typeof i=="string"?Ia(o,e).fill(t,i):Ia(o,e).fill(t):Ia(o,e)}dt.alloc=function(o,e,t){return _M(null,o,e,t)};function Eg(o,e){if(Nx(e),o=Ia(o,e<0?0:Ig(e)|0),!dt.TYPED_ARRAY_SUPPORT)for(var t=0;t<e;++t)o[t]=0;return o}dt.allocUnsafe=function(o){return Eg(null,o)},dt.allocUnsafeSlow=function(o){return Eg(null,o)};function yM(o,e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!dt.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var i=Ox(e,t)|0;o=Ia(o,i);var s=o.write(e,t);return s!==i&&(o=o.slice(0,s)),o}function Sg(o,e){var t=e.length<0?0:Ig(e.length)|0;o=Ia(o,t);for(var i=0;i<t;i+=1)o[i]=e[i]&255;return o}function xM(o,e,t,i){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(i||0))throw new RangeError("'length' is out of bounds");return t===void 0&&i===void 0?e=new Uint8Array(e):i===void 0?e=new Uint8Array(e,t):e=new Uint8Array(e,t,i),dt.TYPED_ARRAY_SUPPORT?(o=e,o.__proto__=dt.prototype):o=Sg(o,e),o}function vM(o,e){if(sa(e)){var t=Ig(e.length)|0;return o=Ia(o,t),o.length===0||e.copy(o,0,0,t),o}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||zM(e.length)?Ia(o,0):Sg(o,e);if(e.type==="Buffer"&&Fx(e.data))return Sg(o,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function Ig(o){if(o>=Tp())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Tp().toString(16)+" bytes");return o|0}dt.isBuffer=GM;function sa(o){return!!(o!=null&&o._isBuffer)}dt.compare=function(e,t){if(!sa(e)||!sa(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,s=t.length,c=0,u=Math.min(i,s);c<u;++c)if(e[c]!==t[c]){i=e[c],s=t[c];break}return i<s?-1:s<i?1:0},dt.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},dt.concat=function(e,t){if(!Fx(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return dt.alloc(0);var i;if(t===void 0)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var s=dt.allocUnsafe(t),c=0;for(i=0;i<e.length;++i){var u=e[i];if(!sa(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(s,c),c+=u.length}return s};function Ox(o,e){if(sa(o))return o.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(o)||o instanceof ArrayBuffer))return o.byteLength;typeof o!="string"&&(o=""+o);var t=o.length;if(t===0)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return Lp(o).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return jx(o).length;default:if(i)return Lp(o).length;e=(""+e).toLowerCase(),i=!0}}dt.byteLength=Ox;function bM(o,e,t){var i=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(o||(o="utf8");;)switch(o){case"hex":return LM(this,e,t);case"utf8":case"utf-8":return Vx(this,e,t);case"ascii":return BM(this,e,t);case"latin1":case"binary":return RM(this,e,t);case"base64":return MM(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return DM(this,e,t);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(o+"").toLowerCase(),i=!0}}dt.prototype._isBuffer=!0;function sl(o,e,t){var i=o[e];o[e]=o[t],o[t]=i}dt.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)sl(this,t,t+1);return this},dt.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)sl(this,t,t+3),sl(this,t+1,t+2);return this},dt.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)sl(this,t,t+7),sl(this,t+1,t+6),sl(this,t+2,t+5),sl(this,t+3,t+4);return this},dt.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?Vx(this,0,e):bM.apply(this,arguments)},dt.prototype.equals=function(e){if(!sa(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:dt.compare(this,e)===0},dt.prototype.inspect=function(){var e="",t=AM;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},dt.prototype.compare=function(e,t,i,s,c){if(!sa(e))throw new TypeError("Argument must be a Buffer");if(t===void 0&&(t=0),i===void 0&&(i=e?e.length:0),s===void 0&&(s=0),c===void 0&&(c=this.length),t<0||i>e.length||s<0||c>this.length)throw new RangeError("out of range index");if(s>=c&&t>=i)return 0;if(s>=c)return-1;if(t>=i)return 1;if(t>>>=0,i>>>=0,s>>>=0,c>>>=0,this===e)return 0;for(var u=c-s,a=i-t,m=Math.min(u,a),A=this.slice(s,c),x=e.slice(t,i),b=0;b<m;++b)if(A[b]!==x[b]){u=A[b],a=x[b];break}return u<a?-1:a<u?1:0};function zx(o,e,t,i,s){if(o.length===0)return-1;if(typeof t=="string"?(i=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=s?0:o.length-1),t<0&&(t=o.length+t),t>=o.length){if(s)return-1;t=o.length-1}else if(t<0)if(s)t=0;else return-1;if(typeof e=="string"&&(e=dt.from(e,i)),sa(e))return e.length===0?-1:Gx(o,e,t,i,s);if(typeof e=="number")return e=e&255,dt.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(o,e,t):Uint8Array.prototype.lastIndexOf.call(o,e,t):Gx(o,[e],t,i,s);throw new TypeError("val must be string, number or Buffer")}function Gx(o,e,t,i,s){var c=1,u=o.length,a=e.length;if(i!==void 0&&(i=String(i).toLowerCase(),i==="ucs2"||i==="ucs-2"||i==="utf16le"||i==="utf-16le")){if(o.length<2||e.length<2)return-1;c=2,u/=2,a/=2,t/=2}function m(E,T){return c===1?E[T]:E.readUInt16BE(T*c)}var A;if(s){var x=-1;for(A=t;A<u;A++)if(m(o,A)===m(e,x===-1?0:A-x)){if(x===-1&&(x=A),A-x+1===a)return x*c}else x!==-1&&(A-=A-x),x=-1}else for(t+a>u&&(t=u-a),A=t;A>=0;A--){for(var b=!0,I=0;I<a;I++)if(m(o,A+I)!==m(e,I)){b=!1;break}if(b)return A}return-1}dt.prototype.includes=function(e,t,i){return this.indexOf(e,t,i)!==-1},dt.prototype.indexOf=function(e,t,i){return zx(this,e,t,i,!0)},dt.prototype.lastIndexOf=function(e,t,i){return zx(this,e,t,i,!1)};function wM(o,e,t,i){t=Number(t)||0;var s=o.length-t;i?(i=Number(i),i>s&&(i=s)):i=s;var c=e.length;if(c%2!==0)throw new TypeError("Invalid hex string");i>c/2&&(i=c/2);for(var u=0;u<i;++u){var a=parseInt(e.substr(u*2,2),16);if(isNaN(a))return u;o[t+u]=a}return u}function EM(o,e,t,i){return Dp(Lp(e,o.length-t),o,t,i)}function Qx(o,e,t,i){return Dp(NM(e),o,t,i)}function SM(o,e,t,i){return Qx(o,e,t,i)}function IM(o,e,t,i){return Dp(jx(e),o,t,i)}function CM(o,e,t,i){return Dp(OM(e,o.length-t),o,t,i)}dt.prototype.write=function(e,t,i,s){if(t===void 0)s="utf8",i=this.length,t=0;else if(i===void 0&&typeof t=="string")s=t,i=this.length,t=0;else if(isFinite(t))t=t|0,isFinite(i)?(i=i|0,s===void 0&&(s="utf8")):(s=i,i=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var c=this.length-t;if((i===void 0||i>c)&&(i=c),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var u=!1;;)switch(s){case"hex":return wM(this,e,t,i);case"utf8":case"utf-8":return EM(this,e,t,i);case"ascii":return Qx(this,e,t,i);case"latin1":case"binary":return SM(this,e,t,i);case"base64":return IM(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return CM(this,e,t,i);default:if(u)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),u=!0}},dt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function MM(o,e,t){return e===0&&t===o.length?Px(o):Px(o.slice(e,t))}function Vx(o,e,t){t=Math.min(o.length,t);for(var i=[],s=e;s<t;){var c=o[s],u=null,a=c>239?4:c>223?3:c>191?2:1;if(s+a<=t){var m,A,x,b;switch(a){case 1:c<128&&(u=c);break;case 2:m=o[s+1],(m&192)===128&&(b=(c&31)<<6|m&63,b>127&&(u=b));break;case 3:m=o[s+1],A=o[s+2],(m&192)===128&&(A&192)===128&&(b=(c&15)<<12|(m&63)<<6|A&63,b>2047&&(b<55296||b>57343)&&(u=b));break;case 4:m=o[s+1],A=o[s+2],x=o[s+3],(m&192)===128&&(A&192)===128&&(x&192)===128&&(b=(c&15)<<18|(m&63)<<12|(A&63)<<6|x&63,b>65535&&b<1114112&&(u=b))}}u===null?(u=65533,a=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|u&1023),i.push(u),s+=a}return TM(i)}var Hx=4096;function TM(o){var e=o.length;if(e<=Hx)return String.fromCharCode.apply(String,o);for(var t="",i=0;i<e;)t+=String.fromCharCode.apply(String,o.slice(i,i+=Hx));return t}function BM(o,e,t){var i="";t=Math.min(o.length,t);for(var s=e;s<t;++s)i+=String.fromCharCode(o[s]&127);return i}function RM(o,e,t){var i="";t=Math.min(o.length,t);for(var s=e;s<t;++s)i+=String.fromCharCode(o[s]);return i}function LM(o,e,t){var i=o.length;(!e||e<0)&&(e=0),(!t||t<0||t>i)&&(t=i);for(var s="",c=e;c<t;++c)s+=kM(o[c]);return s}function DM(o,e,t){for(var i=o.slice(e,t),s="",c=0;c<i.length;c+=2)s+=String.fromCharCode(i[c]+i[c+1]*256);return s}dt.prototype.slice=function(e,t){var i=this.length;e=~~e,t=t===void 0?i:~~t,e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),t<e&&(t=e);var s;if(dt.TYPED_ARRAY_SUPPORT)s=this.subarray(e,t),s.__proto__=dt.prototype;else{var c=t-e;s=new dt(c,void 0);for(var u=0;u<c;++u)s[u]=this[u+e]}return s};function zn(o,e,t){if(o%1!==0||o<0)throw new RangeError("offset is not uint");if(o+e>t)throw new RangeError("Trying to access beyond buffer length")}dt.prototype.readUIntLE=function(e,t,i){e=e|0,t=t|0,i||zn(e,t,this.length);for(var s=this[e],c=1,u=0;++u<t&&(c*=256);)s+=this[e+u]*c;return s},dt.prototype.readUIntBE=function(e,t,i){e=e|0,t=t|0,i||zn(e,t,this.length);for(var s=this[e+--t],c=1;t>0&&(c*=256);)s+=this[e+--t]*c;return s},dt.prototype.readUInt8=function(e,t){return t||zn(e,1,this.length),this[e]},dt.prototype.readUInt16LE=function(e,t){return t||zn(e,2,this.length),this[e]|this[e+1]<<8},dt.prototype.readUInt16BE=function(e,t){return t||zn(e,2,this.length),this[e]<<8|this[e+1]},dt.prototype.readUInt32LE=function(e,t){return t||zn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},dt.prototype.readUInt32BE=function(e,t){return t||zn(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},dt.prototype.readIntLE=function(e,t,i){e=e|0,t=t|0,i||zn(e,t,this.length);for(var s=this[e],c=1,u=0;++u<t&&(c*=256);)s+=this[e+u]*c;return c*=128,s>=c&&(s-=Math.pow(2,8*t)),s},dt.prototype.readIntBE=function(e,t,i){e=e|0,t=t|0,i||zn(e,t,this.length);for(var s=t,c=1,u=this[e+--s];s>0&&(c*=256);)u+=this[e+--s]*c;return c*=128,u>=c&&(u-=Math.pow(2,8*t)),u},dt.prototype.readInt8=function(e,t){return t||zn(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},dt.prototype.readInt16LE=function(e,t){t||zn(e,2,this.length);var i=this[e]|this[e+1]<<8;return i&32768?i|4294901760:i},dt.prototype.readInt16BE=function(e,t){t||zn(e,2,this.length);var i=this[e+1]|this[e]<<8;return i&32768?i|4294901760:i},dt.prototype.readInt32LE=function(e,t){return t||zn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},dt.prototype.readInt32BE=function(e,t){return t||zn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},dt.prototype.readFloatLE=function(e,t){return t||zn(e,4,this.length),Mp(this,e,!0,23,4)},dt.prototype.readFloatBE=function(e,t){return t||zn(e,4,this.length),Mp(this,e,!1,23,4)},dt.prototype.readDoubleLE=function(e,t){return t||zn(e,8,this.length),Mp(this,e,!0,52,8)},dt.prototype.readDoubleBE=function(e,t){return t||zn(e,8,this.length),Mp(this,e,!1,52,8)};function Gr(o,e,t,i,s,c){if(!sa(o))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<c)throw new RangeError('"value" argument is out of bounds');if(t+i>o.length)throw new RangeError("Index out of range")}dt.prototype.writeUIntLE=function(e,t,i,s){if(e=+e,t=t|0,i=i|0,!s){var c=Math.pow(2,8*i)-1;Gr(this,e,t,i,c,0)}var u=1,a=0;for(this[t]=e&255;++a<i&&(u*=256);)this[t+a]=e/u&255;return t+i},dt.prototype.writeUIntBE=function(e,t,i,s){if(e=+e,t=t|0,i=i|0,!s){var c=Math.pow(2,8*i)-1;Gr(this,e,t,i,c,0)}var u=i-1,a=1;for(this[t+u]=e&255;--u>=0&&(a*=256);)this[t+u]=e/a&255;return t+i},dt.prototype.writeUInt8=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,1,255,0),dt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e&255,t+1};function Bp(o,e,t,i){e<0&&(e=65535+e+1);for(var s=0,c=Math.min(o.length-t,2);s<c;++s)o[t+s]=(e&255<<8*(i?s:1-s))>>>(i?s:1-s)*8}dt.prototype.writeUInt16LE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,2,65535,0),dt.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Bp(this,e,t,!0),t+2},dt.prototype.writeUInt16BE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,2,65535,0),dt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Bp(this,e,t,!1),t+2};function Rp(o,e,t,i){e<0&&(e=4294967295+e+1);for(var s=0,c=Math.min(o.length-t,4);s<c;++s)o[t+s]=e>>>(i?s:3-s)*8&255}dt.prototype.writeUInt32LE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,4,4294967295,0),dt.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255):Rp(this,e,t,!0),t+4},dt.prototype.writeUInt32BE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,4,4294967295,0),dt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Rp(this,e,t,!1),t+4},dt.prototype.writeIntLE=function(e,t,i,s){if(e=+e,t=t|0,!s){var c=Math.pow(2,8*i-1);Gr(this,e,t,i,c-1,-c)}var u=0,a=1,m=0;for(this[t]=e&255;++u<i&&(a*=256);)e<0&&m===0&&this[t+u-1]!==0&&(m=1),this[t+u]=(e/a>>0)-m&255;return t+i},dt.prototype.writeIntBE=function(e,t,i,s){if(e=+e,t=t|0,!s){var c=Math.pow(2,8*i-1);Gr(this,e,t,i,c-1,-c)}var u=i-1,a=1,m=0;for(this[t+u]=e&255;--u>=0&&(a*=256);)e<0&&m===0&&this[t+u+1]!==0&&(m=1),this[t+u]=(e/a>>0)-m&255;return t+i},dt.prototype.writeInt8=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,1,127,-128),dt.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e&255,t+1},dt.prototype.writeInt16LE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,2,32767,-32768),dt.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Bp(this,e,t,!0),t+2},dt.prototype.writeInt16BE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,2,32767,-32768),dt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Bp(this,e,t,!1),t+2},dt.prototype.writeInt32LE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,4,2147483647,-2147483648),dt.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Rp(this,e,t,!0),t+4},dt.prototype.writeInt32BE=function(e,t,i){return e=+e,t=t|0,i||Gr(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),dt.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Rp(this,e,t,!1),t+4};function Wx(o,e,t,i,s,c){if(t+i>o.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function qx(o,e,t,i,s){return s||Wx(o,e,t,4),Ux(o,e,t,i,23,4),t+4}dt.prototype.writeFloatLE=function(e,t,i){return qx(this,e,t,!0,i)},dt.prototype.writeFloatBE=function(e,t,i){return qx(this,e,t,!1,i)};function $x(o,e,t,i,s){return s||Wx(o,e,t,8),Ux(o,e,t,i,52,8),t+8}dt.prototype.writeDoubleLE=function(e,t,i){return $x(this,e,t,!0,i)},dt.prototype.writeDoubleBE=function(e,t,i){return $x(this,e,t,!1,i)},dt.prototype.copy=function(e,t,i,s){if(i||(i=0),!s&&s!==0&&(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<i&&(s=i),s===i||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-i&&(s=e.length-t+i);var c=s-i,u;if(this===e&&i<t&&t<s)for(u=c-1;u>=0;--u)e[u+t]=this[u+i];else if(c<1e3||!dt.TYPED_ARRAY_SUPPORT)for(u=0;u<c;++u)e[u+t]=this[u+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+c),t);return c},dt.prototype.fill=function(e,t,i,s){if(typeof e=="string"){if(typeof t=="string"?(s=t,t=0,i=this.length):typeof i=="string"&&(s=i,i=this.length),e.length===1){var c=e.charCodeAt(0);c<256&&(e=c)}if(s!==void 0&&typeof s!="string")throw new TypeError("encoding must be a string");if(typeof s=="string"&&!dt.isEncoding(s))throw new TypeError("Unknown encoding: "+s)}else typeof e=="number"&&(e=e&255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;t=t>>>0,i=i===void 0?this.length:i>>>0,e||(e=0);var u;if(typeof e=="number")for(u=t;u<i;++u)this[u]=e;else{var a=sa(e)?e:Lp(new dt(e,s).toString()),m=a.length;for(u=0;u<i-t;++u)this[u+t]=a[u%m]}return this};var PM=/[^+\/0-9A-Za-z-_]/g;function UM(o){if(o=FM(o).replace(PM,""),o.length<2)return"";for(;o.length%4!==0;)o=o+"=";return o}function FM(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function kM(o){return o<16?"0"+o.toString(16):o.toString(16)}function Lp(o,e){e=e||1/0;for(var t,i=o.length,s=null,c=[],u=0;u<i;++u){if(t=o.charCodeAt(u),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&c.push(239,191,189);continue}else if(u+1===i){(e-=3)>-1&&c.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&c.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&c.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;c.push(t)}else if(t<2048){if((e-=2)<0)break;c.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;c.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;c.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return c}function NM(o){for(var e=[],t=0;t<o.length;++t)e.push(o.charCodeAt(t)&255);return e}function OM(o,e){for(var t,i,s,c=[],u=0;u<o.length&&!((e-=2)<0);++u)t=o.charCodeAt(u),i=t>>8,s=t%256,c.push(s),c.push(i);return c}function jx(o){return pM(UM(o))}function Dp(o,e,t,i){for(var s=0;s<i&&!(s+t>=e.length||s>=o.length);++s)e[s+t]=o[s];return s}function zM(o){return o!==o}function GM(o){return o!=null&&(!!o._isBuffer||Xx(o)||QM(o))}function Xx(o){return!!o.constructor&&typeof o.constructor.isBuffer=="function"&&o.constructor.isBuffer(o)}function QM(o){return typeof o.readFloatLE=="function"&&typeof o.slice=="function"&&Xx(o.slice(0,0))}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Cg="152",VM=0,Yx=1,HM=2,Kx=1,WM=2,Ca=3,ks=0,Gn=1,er=2,Ma=0,tc=1,Zx=2,Jx=3,ev=4,qM=5,ic=100,$M=101,jM=102,tv=103,iv=104,XM=200,YM=201,KM=202,ZM=203,nv=204,rv=205,JM=206,eT=207,tT=208,iT=209,nT=210,rT=0,sT=1,aT=2,Mg=3,oT=4,lT=5,cT=6,hT=7,sv=0,uT=1,dT=2,Ns=0,pT=1,fT=2,mT=3,gT=4,AT=5,av=300,nc=301,rc=302,Pp=303,Tg=304,Up=306,aa=1e3,tr=1001,sc=1002,Pn=1003,ou=1004,ac=1005,dn=1006,Fp=1007,Os=1008,vr=1009,_T=1010,yT=1011,ov=1012,xT=1013,al=1014,br=1015,wr=1016,vT=1017,bT=1018,oc=1020,wT=1021,Rn=1023,ET=1024,ST=1025,ol=1026,lc=1027,lu=1028,IT=1029,cu=1030,CT=1031,MT=1033,kp=33776,Bg=33777,Rg=33778,Np=33779,Lg=35840,lv=35841,Dg=35842,cv=35843,hv=36196,Pg=37492,Ug=37496,Fg=37808,uv=37809,dv=37810,pv=37811,fv=37812,mv=37813,gv=37814,Av=37815,_v=37816,yv=37817,xv=37818,vv=37819,bv=37820,wv=37821,Op=36492,TT=36283,Ev=36284,Sv=36285,Iv=36286,Cv=2200,kg=2201,Ng=2202,ll=2300,uo=2301,Og=2302,cc=2400,hc=2401,zp=2402,zg=2500,BT=2501,RT=0,Mv=1,Gg=2,hu=3e3,zs=3001,LT=3200,DT=3201,Tv=0,PT=1,fs="",ni="srgb",Qr="srgb-linear",Bv="display-p3",Qg=7680,UT=519,Vg=35044,Rv="300 es",Hg=1035;class ms{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const c=s.indexOf(t);c!==-1&&s.splice(c,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let c=0,u=s.length;c<u;c++)s[c].call(this,e);e.target=null}}}const dr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Lv=1234567;const uu=Math.PI/180,uc=180/Math.PI;function Gs(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(dr[o&255]+dr[o>>8&255]+dr[o>>16&255]+dr[o>>24&255]+"-"+dr[e&255]+dr[e>>8&255]+"-"+dr[e>>16&15|64]+dr[e>>24&255]+"-"+dr[t&63|128]+dr[t>>8&255]+"-"+dr[t>>16&255]+dr[t>>24&255]+dr[i&255]+dr[i>>8&255]+dr[i>>16&255]+dr[i>>24&255]).toLowerCase()}function Qn(o,e,t){return Math.max(e,Math.min(t,o))}function Wg(o,e){return(o%e+e)%e}function FT(o,e,t,i,s){return i+(o-e)*(s-i)/(t-e)}function kT(o,e,t){return o!==e?(t-o)/(e-o):0}function du(o,e,t){return(1-t)*o+t*e}function NT(o,e,t,i){return du(o,e,1-Math.exp(-t*i))}function OT(o,e=1){return e-Math.abs(Wg(o,e*2)-e)}function zT(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*(3-2*o))}function GT(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*o*(o*(o*6-15)+10))}function QT(o,e){return o+Math.floor(Math.random()*(e-o+1))}function VT(o,e){return o+Math.random()*(e-o)}function HT(o){return o*(.5-Math.random())}function WT(o){o!==void 0&&(Lv=o);let e=Lv+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function qT(o){return o*uu}function $T(o){return o*uc}function qg(o){return(o&o-1)===0&&o!==0}function Dv(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Pv(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function jT(o,e,t,i,s){const c=Math.cos,u=Math.sin,a=c(t/2),m=u(t/2),A=c((e+i)/2),x=u((e+i)/2),b=c((e-i)/2),I=u((e-i)/2),E=c((i-e)/2),T=u((i-e)/2);switch(s){case"XYX":o.set(a*x,m*b,m*I,a*A);break;case"YZY":o.set(m*I,a*x,m*b,a*A);break;case"ZXZ":o.set(m*b,m*I,a*x,a*A);break;case"XZX":o.set(a*x,m*T,m*E,a*A);break;case"YXY":o.set(m*E,a*x,m*T,a*A);break;case"ZYZ":o.set(m*T,m*E,a*x,a*A);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ta(o,e){switch(e.constructor){case Float32Array:return o;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function nn(o,e){switch(e.constructor){case Float32Array:return o;case Uint16Array:return Math.round(o*65535);case Uint8Array:return Math.round(o*255);case Int16Array:return Math.round(o*32767);case Int8Array:return Math.round(o*127);default:throw new Error("Invalid component type.")}}const cl={DEG2RAD:uu,RAD2DEG:uc,generateUUID:Gs,clamp:Qn,euclideanModulo:Wg,mapLinear:FT,inverseLerp:kT,lerp:du,damp:NT,pingpong:OT,smoothstep:zT,smootherstep:GT,randInt:QT,randFloat:VT,randFloatSpread:HT,seededRandom:WT,degToRad:qT,radToDeg:$T,isPowerOfTwo:qg,ceilPowerOfTwo:Dv,floorPowerOfTwo:Pv,setQuaternionFromProperEuler:jT,normalize:nn,denormalize:Ta};class yi{constructor(e=0,t=0){yi.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Qn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),c=this.x-e.x,u=this.y-e.y;return this.x=c*i-u*s+e.x,this.y=c*s+u*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ei{constructor(){Ei.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,s,c,u,a,m,A){const x=this.elements;return x[0]=e,x[1]=s,x[2]=a,x[3]=t,x[4]=c,x[5]=m,x[6]=i,x[7]=u,x[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,c=this.elements,u=i[0],a=i[3],m=i[6],A=i[1],x=i[4],b=i[7],I=i[2],E=i[5],T=i[8],U=s[0],P=s[3],R=s[6],X=s[1],G=s[4],J=s[7],q=s[2],te=s[5],ue=s[8];return c[0]=u*U+a*X+m*q,c[3]=u*P+a*G+m*te,c[6]=u*R+a*J+m*ue,c[1]=A*U+x*X+b*q,c[4]=A*P+x*G+b*te,c[7]=A*R+x*J+b*ue,c[2]=I*U+E*X+T*q,c[5]=I*P+E*G+T*te,c[8]=I*R+E*J+T*ue,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],c=e[3],u=e[4],a=e[5],m=e[6],A=e[7],x=e[8];return t*u*x-t*a*A-i*c*x+i*a*m+s*c*A-s*u*m}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],c=e[3],u=e[4],a=e[5],m=e[6],A=e[7],x=e[8],b=x*u-a*A,I=a*m-x*c,E=A*c-u*m,T=t*b+i*I+s*E;if(T===0)return this.set(0,0,0,0,0,0,0,0,0);const U=1/T;return e[0]=b*U,e[1]=(s*A-x*i)*U,e[2]=(a*i-s*u)*U,e[3]=I*U,e[4]=(x*t-s*m)*U,e[5]=(s*c-a*t)*U,e[6]=E*U,e[7]=(i*m-A*t)*U,e[8]=(u*t-i*c)*U,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,c,u,a){const m=Math.cos(c),A=Math.sin(c);return this.set(i*m,i*A,-i*(m*u+A*a)+u+e,-s*A,s*m,-s*(-A*u+m*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply($g.makeScale(e,t)),this}rotate(e){return this.premultiply($g.makeRotation(-e)),this}translate(e,t){return this.premultiply($g.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const $g=new Ei;function Uv(o){for(let e=o.length-1;e>=0;--e)if(o[e]>=65535)return!0;return!1}function pu(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}const Fv={};function fu(o){o in Fv||(Fv[o]=!0,console.warn(o))}function dc(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function jg(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}const XT=new Ei().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),YT=new Ei().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function KT(o){return o.convertSRGBToLinear().applyMatrix3(YT)}function ZT(o){return o.applyMatrix3(XT).convertLinearToSRGB()}const JT={[Qr]:o=>o,[ni]:o=>o.convertSRGBToLinear(),[Bv]:KT},eB={[Qr]:o=>o,[ni]:o=>o.convertLinearToSRGB(),[Bv]:ZT},Qs={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(o){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!o},get workingColorSpace(){return Qr},set workingColorSpace(o){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;const i=JT[e],s=eB[t];if(i===void 0||s===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return s(i(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this.workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this.workingColorSpace)}};let pc;class kv{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{pc===void 0&&(pc=pu("canvas")),pc.width=e.width,pc.height=e.height;const i=pc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=pc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=pu("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),c=s.data;for(let u=0;u<c.length;u++)c[u]=dc(c[u]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(dc(t[i]/255)*255):t[i]=dc(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Gp{constructor(e=null){this.isSource=!0,this.uuid=Gs(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let c;if(Array.isArray(s)){c=[];for(let u=0,a=s.length;u<a;u++)s[u].isDataTexture?c.push(Xg(s[u].image)):c.push(Xg(s[u]))}else c=Xg(s);i.url=c}return t||(e.images[this.uuid]=i),i}}function Xg(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?kv.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let tB=0;class vn extends ms{constructor(e=vn.DEFAULT_IMAGE,t=vn.DEFAULT_MAPPING,i=tr,s=tr,c=dn,u=Os,a=Rn,m=vr,A=vn.DEFAULT_ANISOTROPY,x=fs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:tB++}),this.uuid=Gs(),this.name="",this.source=new Gp(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=c,this.minFilter=u,this.anisotropy=A,this.format=a,this.internalFormat=null,this.type=m,this.offset=new yi(0,0),this.repeat=new yi(1,1),this.center=new yi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ei,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof x=="string"?this.colorSpace=x:(fu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=x===zs?ni:fs),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==av)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case aa:e.x=e.x-Math.floor(e.x);break;case tr:e.x=e.x<0?0:1;break;case sc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case aa:e.y=e.y-Math.floor(e.y);break;case tr:e.y=e.y<0?0:1;break;case sc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return fu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ni?zs:hu}set encoding(e){fu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===zs?ni:fs}}vn.DEFAULT_IMAGE=null,vn.DEFAULT_MAPPING=av,vn.DEFAULT_ANISOTROPY=1;class rn{constructor(e=0,t=0,i=0,s=1){rn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,c=this.w,u=e.elements;return this.x=u[0]*t+u[4]*i+u[8]*s+u[12]*c,this.y=u[1]*t+u[5]*i+u[9]*s+u[13]*c,this.z=u[2]*t+u[6]*i+u[10]*s+u[14]*c,this.w=u[3]*t+u[7]*i+u[11]*s+u[15]*c,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,c;const m=e.elements,A=m[0],x=m[4],b=m[8],I=m[1],E=m[5],T=m[9],U=m[2],P=m[6],R=m[10];if(Math.abs(x-I)<.01&&Math.abs(b-U)<.01&&Math.abs(T-P)<.01){if(Math.abs(x+I)<.1&&Math.abs(b+U)<.1&&Math.abs(T+P)<.1&&Math.abs(A+E+R-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const G=(A+1)/2,J=(E+1)/2,q=(R+1)/2,te=(x+I)/4,ue=(b+U)/4,_e=(T+P)/4;return G>J&&G>q?G<.01?(i=0,s=.707106781,c=.707106781):(i=Math.sqrt(G),s=te/i,c=ue/i):J>q?J<.01?(i=.707106781,s=0,c=.707106781):(s=Math.sqrt(J),i=te/s,c=_e/s):q<.01?(i=.707106781,s=.707106781,c=0):(c=Math.sqrt(q),i=ue/c,s=_e/c),this.set(i,s,c,t),this}let X=Math.sqrt((P-T)*(P-T)+(b-U)*(b-U)+(I-x)*(I-x));return Math.abs(X)<.001&&(X=1),this.x=(P-T)/X,this.y=(b-U)/X,this.z=(I-x)/X,this.w=Math.acos((A+E+R-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Vs extends ms{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new rn(0,0,e,t),this.scissorTest=!1,this.viewport=new rn(0,0,e,t);const s={width:e,height:t,depth:1};i.encoding!==void 0&&(fu("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===zs?ni:fs),this.texture=new vn(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:dn,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Gp(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Nv extends vn{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Pn,this.minFilter=Pn,this.wrapR=tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ov extends vn{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Pn,this.minFilter=Pn,this.wrapR=tr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class gs{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,c,u,a){let m=i[s+0],A=i[s+1],x=i[s+2],b=i[s+3];const I=c[u+0],E=c[u+1],T=c[u+2],U=c[u+3];if(a===0){e[t+0]=m,e[t+1]=A,e[t+2]=x,e[t+3]=b;return}if(a===1){e[t+0]=I,e[t+1]=E,e[t+2]=T,e[t+3]=U;return}if(b!==U||m!==I||A!==E||x!==T){let P=1-a;const R=m*I+A*E+x*T+b*U,X=R>=0?1:-1,G=1-R*R;if(G>Number.EPSILON){const q=Math.sqrt(G),te=Math.atan2(q,R*X);P=Math.sin(P*te)/q,a=Math.sin(a*te)/q}const J=a*X;if(m=m*P+I*J,A=A*P+E*J,x=x*P+T*J,b=b*P+U*J,P===1-a){const q=1/Math.sqrt(m*m+A*A+x*x+b*b);m*=q,A*=q,x*=q,b*=q}}e[t]=m,e[t+1]=A,e[t+2]=x,e[t+3]=b}static multiplyQuaternionsFlat(e,t,i,s,c,u){const a=i[s],m=i[s+1],A=i[s+2],x=i[s+3],b=c[u],I=c[u+1],E=c[u+2],T=c[u+3];return e[t]=a*T+x*b+m*E-A*I,e[t+1]=m*T+x*I+A*b-a*E,e[t+2]=A*T+x*E+a*I-m*b,e[t+3]=x*T-a*b-m*I-A*E,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,s=e._y,c=e._z,u=e._order,a=Math.cos,m=Math.sin,A=a(i/2),x=a(s/2),b=a(c/2),I=m(i/2),E=m(s/2),T=m(c/2);switch(u){case"XYZ":this._x=I*x*b+A*E*T,this._y=A*E*b-I*x*T,this._z=A*x*T+I*E*b,this._w=A*x*b-I*E*T;break;case"YXZ":this._x=I*x*b+A*E*T,this._y=A*E*b-I*x*T,this._z=A*x*T-I*E*b,this._w=A*x*b+I*E*T;break;case"ZXY":this._x=I*x*b-A*E*T,this._y=A*E*b+I*x*T,this._z=A*x*T+I*E*b,this._w=A*x*b-I*E*T;break;case"ZYX":this._x=I*x*b-A*E*T,this._y=A*E*b+I*x*T,this._z=A*x*T-I*E*b,this._w=A*x*b+I*E*T;break;case"YZX":this._x=I*x*b+A*E*T,this._y=A*E*b+I*x*T,this._z=A*x*T-I*E*b,this._w=A*x*b-I*E*T;break;case"XZY":this._x=I*x*b-A*E*T,this._y=A*E*b-I*x*T,this._z=A*x*T+I*E*b,this._w=A*x*b+I*E*T;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],c=t[8],u=t[1],a=t[5],m=t[9],A=t[2],x=t[6],b=t[10],I=i+a+b;if(I>0){const E=.5/Math.sqrt(I+1);this._w=.25/E,this._x=(x-m)*E,this._y=(c-A)*E,this._z=(u-s)*E}else if(i>a&&i>b){const E=2*Math.sqrt(1+i-a-b);this._w=(x-m)/E,this._x=.25*E,this._y=(s+u)/E,this._z=(c+A)/E}else if(a>b){const E=2*Math.sqrt(1+a-i-b);this._w=(c-A)/E,this._x=(s+u)/E,this._y=.25*E,this._z=(m+x)/E}else{const E=2*Math.sqrt(1+b-i-a);this._w=(u-s)/E,this._x=(c+A)/E,this._y=(m+x)/E,this._z=.25*E}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Qn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,c=e._z,u=e._w,a=t._x,m=t._y,A=t._z,x=t._w;return this._x=i*x+u*a+s*A-c*m,this._y=s*x+u*m+c*a-i*A,this._z=c*x+u*A+i*m-s*a,this._w=u*x-i*a-s*m-c*A,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,c=this._z,u=this._w;let a=u*e._w+i*e._x+s*e._y+c*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=u,this._x=i,this._y=s,this._z=c,this;const m=1-a*a;if(m<=Number.EPSILON){const E=1-t;return this._w=E*u+t*this._w,this._x=E*i+t*this._x,this._y=E*s+t*this._y,this._z=E*c+t*this._z,this.normalize(),this._onChangeCallback(),this}const A=Math.sqrt(m),x=Math.atan2(A,a),b=Math.sin((1-t)*x)/A,I=Math.sin(t*x)/A;return this._w=u*b+this._w*I,this._x=i*b+this._x*I,this._y=s*b+this._y*I,this._z=c*b+this._z*I,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),c=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(c),i*Math.cos(c),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class we{constructor(e=0,t=0,i=0){we.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(zv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(zv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,c=e.elements;return this.x=c[0]*t+c[3]*i+c[6]*s,this.y=c[1]*t+c[4]*i+c[7]*s,this.z=c[2]*t+c[5]*i+c[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,c=e.elements,u=1/(c[3]*t+c[7]*i+c[11]*s+c[15]);return this.x=(c[0]*t+c[4]*i+c[8]*s+c[12])*u,this.y=(c[1]*t+c[5]*i+c[9]*s+c[13])*u,this.z=(c[2]*t+c[6]*i+c[10]*s+c[14])*u,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,c=e.x,u=e.y,a=e.z,m=e.w,A=m*t+u*s-a*i,x=m*i+a*t-c*s,b=m*s+c*i-u*t,I=-c*t-u*i-a*s;return this.x=A*m+I*-c+x*-a-b*-u,this.y=x*m+I*-u+b*-c-A*-a,this.z=b*m+I*-a+A*-u-x*-c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,c=e.elements;return this.x=c[0]*t+c[4]*i+c[8]*s,this.y=c[1]*t+c[5]*i+c[9]*s,this.z=c[2]*t+c[6]*i+c[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,c=e.z,u=t.x,a=t.y,m=t.z;return this.x=s*m-c*a,this.y=c*u-i*m,this.z=i*a-s*u,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Yg.copy(this).projectOnVector(e),this.sub(Yg)}reflect(e){return this.sub(Yg.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Qn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Yg=new we,zv=new gs;class Er{constructor(e=new we(1/0,1/0,1/0),t=new we(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Ra.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Ra.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ra.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),fc.copy(e.boundingBox),fc.applyMatrix4(e.matrixWorld),this.union(fc);else{const s=e.geometry;if(s!==void 0)if(t&&s.attributes!==void 0&&s.attributes.position!==void 0){const c=s.attributes.position;for(let u=0,a=c.count;u<a;u++)Ra.fromBufferAttribute(c,u).applyMatrix4(e.matrixWorld),this.expandByPoint(Ra)}else s.boundingBox===null&&s.computeBoundingBox(),fc.copy(s.boundingBox),fc.applyMatrix4(e.matrixWorld),this.union(fc)}const i=e.children;for(let s=0,c=i.length;s<c;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ra),Ra.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(mu),Qp.subVectors(this.max,mu),mc.subVectors(e.a,mu),gc.subVectors(e.b,mu),Ac.subVectors(e.c,mu),po.subVectors(gc,mc),fo.subVectors(Ac,gc),hl.subVectors(mc,Ac);let t=[0,-po.z,po.y,0,-fo.z,fo.y,0,-hl.z,hl.y,po.z,0,-po.x,fo.z,0,-fo.x,hl.z,0,-hl.x,-po.y,po.x,0,-fo.y,fo.x,0,-hl.y,hl.x,0];return!Kg(t,mc,gc,Ac,Qp)||(t=[1,0,0,0,1,0,0,0,1],!Kg(t,mc,gc,Ac,Qp))?!1:(Vp.crossVectors(po,fo),t=[Vp.x,Vp.y,Vp.z],Kg(t,mc,gc,Ac,Qp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ra).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ra).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ba[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ba[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ba[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ba[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ba[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ba[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ba[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ba[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ba),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ba=[new we,new we,new we,new we,new we,new we,new we,new we],Ra=new we,fc=new Er,mc=new we,gc=new we,Ac=new we,po=new we,fo=new we,hl=new we,mu=new we,Qp=new we,Vp=new we,ul=new we;function Kg(o,e,t,i,s){for(let c=0,u=o.length-3;c<=u;c+=3){ul.fromArray(o,c);const a=s.x*Math.abs(ul.x)+s.y*Math.abs(ul.y)+s.z*Math.abs(ul.z),m=e.dot(ul),A=t.dot(ul),x=i.dot(ul);if(Math.max(-Math.max(m,A,x),Math.min(m,A,x))>a)return!1}return!0}const iB=new Er,gu=new we,Zg=new we;class As{constructor(e=new we,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):iB.setFromPoints(e).getCenter(i);let s=0;for(let c=0,u=e.length;c<u;c++)s=Math.max(s,i.distanceToSquared(e[c]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;gu.subVectors(e,this.center);const t=gu.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(gu,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Zg.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(gu.copy(e.center).add(Zg)),this.expandByPoint(gu.copy(e.center).sub(Zg))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const La=new we,Jg=new we,Hp=new we,mo=new we,eA=new we,Wp=new we,tA=new we;class qp{constructor(e=new we,t=new we(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,La)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=La.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(La.copy(this.origin).addScaledVector(this.direction,t),La.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){Jg.copy(e).add(t).multiplyScalar(.5),Hp.copy(t).sub(e).normalize(),mo.copy(this.origin).sub(Jg);const c=e.distanceTo(t)*.5,u=-this.direction.dot(Hp),a=mo.dot(this.direction),m=-mo.dot(Hp),A=mo.lengthSq(),x=Math.abs(1-u*u);let b,I,E,T;if(x>0)if(b=u*m-a,I=u*a-m,T=c*x,b>=0)if(I>=-T)if(I<=T){const U=1/x;b*=U,I*=U,E=b*(b+u*I+2*a)+I*(u*b+I+2*m)+A}else I=c,b=Math.max(0,-(u*I+a)),E=-b*b+I*(I+2*m)+A;else I=-c,b=Math.max(0,-(u*I+a)),E=-b*b+I*(I+2*m)+A;else I<=-T?(b=Math.max(0,-(-u*c+a)),I=b>0?-c:Math.min(Math.max(-c,-m),c),E=-b*b+I*(I+2*m)+A):I<=T?(b=0,I=Math.min(Math.max(-c,-m),c),E=I*(I+2*m)+A):(b=Math.max(0,-(u*c+a)),I=b>0?c:Math.min(Math.max(-c,-m),c),E=-b*b+I*(I+2*m)+A);else I=u>0?-c:c,b=Math.max(0,-(u*I+a)),E=-b*b+I*(I+2*m)+A;return i&&i.copy(this.origin).addScaledVector(this.direction,b),s&&s.copy(Jg).addScaledVector(Hp,I),E}intersectSphere(e,t){La.subVectors(e.center,this.origin);const i=La.dot(this.direction),s=La.dot(La)-i*i,c=e.radius*e.radius;if(s>c)return null;const u=Math.sqrt(c-s),a=i-u,m=i+u;return m<0?null:a<0?this.at(m,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,c,u,a,m;const A=1/this.direction.x,x=1/this.direction.y,b=1/this.direction.z,I=this.origin;return A>=0?(i=(e.min.x-I.x)*A,s=(e.max.x-I.x)*A):(i=(e.max.x-I.x)*A,s=(e.min.x-I.x)*A),x>=0?(c=(e.min.y-I.y)*x,u=(e.max.y-I.y)*x):(c=(e.max.y-I.y)*x,u=(e.min.y-I.y)*x),i>u||c>s||((c>i||isNaN(i))&&(i=c),(u<s||isNaN(s))&&(s=u),b>=0?(a=(e.min.z-I.z)*b,m=(e.max.z-I.z)*b):(a=(e.max.z-I.z)*b,m=(e.min.z-I.z)*b),i>m||a>s)||((a>i||i!==i)&&(i=a),(m<s||s!==s)&&(s=m),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,La)!==null}intersectTriangle(e,t,i,s,c){eA.subVectors(t,e),Wp.subVectors(i,e),tA.crossVectors(eA,Wp);let u=this.direction.dot(tA),a;if(u>0){if(s)return null;a=1}else if(u<0)a=-1,u=-u;else return null;mo.subVectors(this.origin,e);const m=a*this.direction.dot(Wp.crossVectors(mo,Wp));if(m<0)return null;const A=a*this.direction.dot(eA.cross(mo));if(A<0||m+A>u)return null;const x=-a*mo.dot(tA);return x<0?null:this.at(x/u,c)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pi{constructor(){pi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,s,c,u,a,m,A,x,b,I,E,T,U,P){const R=this.elements;return R[0]=e,R[4]=t,R[8]=i,R[12]=s,R[1]=c,R[5]=u,R[9]=a,R[13]=m,R[2]=A,R[6]=x,R[10]=b,R[14]=I,R[3]=E,R[7]=T,R[11]=U,R[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pi().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/_c.setFromMatrixColumn(e,0).length(),c=1/_c.setFromMatrixColumn(e,1).length(),u=1/_c.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*c,t[5]=i[5]*c,t[6]=i[6]*c,t[7]=0,t[8]=i[8]*u,t[9]=i[9]*u,t[10]=i[10]*u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,c=e.z,u=Math.cos(i),a=Math.sin(i),m=Math.cos(s),A=Math.sin(s),x=Math.cos(c),b=Math.sin(c);if(e.order==="XYZ"){const I=u*x,E=u*b,T=a*x,U=a*b;t[0]=m*x,t[4]=-m*b,t[8]=A,t[1]=E+T*A,t[5]=I-U*A,t[9]=-a*m,t[2]=U-I*A,t[6]=T+E*A,t[10]=u*m}else if(e.order==="YXZ"){const I=m*x,E=m*b,T=A*x,U=A*b;t[0]=I+U*a,t[4]=T*a-E,t[8]=u*A,t[1]=u*b,t[5]=u*x,t[9]=-a,t[2]=E*a-T,t[6]=U+I*a,t[10]=u*m}else if(e.order==="ZXY"){const I=m*x,E=m*b,T=A*x,U=A*b;t[0]=I-U*a,t[4]=-u*b,t[8]=T+E*a,t[1]=E+T*a,t[5]=u*x,t[9]=U-I*a,t[2]=-u*A,t[6]=a,t[10]=u*m}else if(e.order==="ZYX"){const I=u*x,E=u*b,T=a*x,U=a*b;t[0]=m*x,t[4]=T*A-E,t[8]=I*A+U,t[1]=m*b,t[5]=U*A+I,t[9]=E*A-T,t[2]=-A,t[6]=a*m,t[10]=u*m}else if(e.order==="YZX"){const I=u*m,E=u*A,T=a*m,U=a*A;t[0]=m*x,t[4]=U-I*b,t[8]=T*b+E,t[1]=b,t[5]=u*x,t[9]=-a*x,t[2]=-A*x,t[6]=E*b+T,t[10]=I-U*b}else if(e.order==="XZY"){const I=u*m,E=u*A,T=a*m,U=a*A;t[0]=m*x,t[4]=-b,t[8]=A*x,t[1]=I*b+U,t[5]=u*x,t[9]=E*b-T,t[2]=T*b-E,t[6]=a*x,t[10]=U*b+I}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nB,e,rB)}lookAt(e,t,i){const s=this.elements;return Jr.subVectors(e,t),Jr.lengthSq()===0&&(Jr.z=1),Jr.normalize(),go.crossVectors(i,Jr),go.lengthSq()===0&&(Math.abs(i.z)===1?Jr.x+=1e-4:Jr.z+=1e-4,Jr.normalize(),go.crossVectors(i,Jr)),go.normalize(),$p.crossVectors(Jr,go),s[0]=go.x,s[4]=$p.x,s[8]=Jr.x,s[1]=go.y,s[5]=$p.y,s[9]=Jr.y,s[2]=go.z,s[6]=$p.z,s[10]=Jr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,c=this.elements,u=i[0],a=i[4],m=i[8],A=i[12],x=i[1],b=i[5],I=i[9],E=i[13],T=i[2],U=i[6],P=i[10],R=i[14],X=i[3],G=i[7],J=i[11],q=i[15],te=s[0],ue=s[4],_e=s[8],K=s[12],ce=s[1],Ve=s[5],Ne=s[9],Me=s[13],ve=s[2],ke=s[6],Re=s[10],Fe=s[14],Oe=s[3],je=s[7],Je=s[11],_t=s[15];return c[0]=u*te+a*ce+m*ve+A*Oe,c[4]=u*ue+a*Ve+m*ke+A*je,c[8]=u*_e+a*Ne+m*Re+A*Je,c[12]=u*K+a*Me+m*Fe+A*_t,c[1]=x*te+b*ce+I*ve+E*Oe,c[5]=x*ue+b*Ve+I*ke+E*je,c[9]=x*_e+b*Ne+I*Re+E*Je,c[13]=x*K+b*Me+I*Fe+E*_t,c[2]=T*te+U*ce+P*ve+R*Oe,c[6]=T*ue+U*Ve+P*ke+R*je,c[10]=T*_e+U*Ne+P*Re+R*Je,c[14]=T*K+U*Me+P*Fe+R*_t,c[3]=X*te+G*ce+J*ve+q*Oe,c[7]=X*ue+G*Ve+J*ke+q*je,c[11]=X*_e+G*Ne+J*Re+q*Je,c[15]=X*K+G*Me+J*Fe+q*_t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],c=e[12],u=e[1],a=e[5],m=e[9],A=e[13],x=e[2],b=e[6],I=e[10],E=e[14],T=e[3],U=e[7],P=e[11],R=e[15];return T*(+c*m*b-s*A*b-c*a*I+i*A*I+s*a*E-i*m*E)+U*(+t*m*E-t*A*I+c*u*I-s*u*E+s*A*x-c*m*x)+P*(+t*A*b-t*a*E-c*u*b+i*u*E+c*a*x-i*A*x)+R*(-s*a*x-t*m*b+t*a*I+s*u*b-i*u*I+i*m*x)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],c=e[3],u=e[4],a=e[5],m=e[6],A=e[7],x=e[8],b=e[9],I=e[10],E=e[11],T=e[12],U=e[13],P=e[14],R=e[15],X=b*P*A-U*I*A+U*m*E-a*P*E-b*m*R+a*I*R,G=T*I*A-x*P*A-T*m*E+u*P*E+x*m*R-u*I*R,J=x*U*A-T*b*A+T*a*E-u*U*E-x*a*R+u*b*R,q=T*b*m-x*U*m-T*a*I+u*U*I+x*a*P-u*b*P,te=t*X+i*G+s*J+c*q;if(te===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ue=1/te;return e[0]=X*ue,e[1]=(U*I*c-b*P*c-U*s*E+i*P*E+b*s*R-i*I*R)*ue,e[2]=(a*P*c-U*m*c+U*s*A-i*P*A-a*s*R+i*m*R)*ue,e[3]=(b*m*c-a*I*c-b*s*A+i*I*A+a*s*E-i*m*E)*ue,e[4]=G*ue,e[5]=(x*P*c-T*I*c+T*s*E-t*P*E-x*s*R+t*I*R)*ue,e[6]=(T*m*c-u*P*c-T*s*A+t*P*A+u*s*R-t*m*R)*ue,e[7]=(u*I*c-x*m*c+x*s*A-t*I*A-u*s*E+t*m*E)*ue,e[8]=J*ue,e[9]=(T*b*c-x*U*c-T*i*E+t*U*E+x*i*R-t*b*R)*ue,e[10]=(u*U*c-T*a*c+T*i*A-t*U*A-u*i*R+t*a*R)*ue,e[11]=(x*a*c-u*b*c-x*i*A+t*b*A+u*i*E-t*a*E)*ue,e[12]=q*ue,e[13]=(x*U*s-T*b*s+T*i*I-t*U*I-x*i*P+t*b*P)*ue,e[14]=(T*a*s-u*U*s-T*i*m+t*U*m+u*i*P-t*a*P)*ue,e[15]=(u*b*s-x*a*s+x*i*m-t*b*m-u*i*I+t*a*I)*ue,this}scale(e){const t=this.elements,i=e.x,s=e.y,c=e.z;return t[0]*=i,t[4]*=s,t[8]*=c,t[1]*=i,t[5]*=s,t[9]*=c,t[2]*=i,t[6]*=s,t[10]*=c,t[3]*=i,t[7]*=s,t[11]*=c,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),c=1-i,u=e.x,a=e.y,m=e.z,A=c*u,x=c*a;return this.set(A*u+i,A*a-s*m,A*m+s*a,0,A*a+s*m,x*a+i,x*m-s*u,0,A*m-s*a,x*m+s*u,c*m*m+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,c,u){return this.set(1,i,c,0,e,1,u,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,c=t._x,u=t._y,a=t._z,m=t._w,A=c+c,x=u+u,b=a+a,I=c*A,E=c*x,T=c*b,U=u*x,P=u*b,R=a*b,X=m*A,G=m*x,J=m*b,q=i.x,te=i.y,ue=i.z;return s[0]=(1-(U+R))*q,s[1]=(E+J)*q,s[2]=(T-G)*q,s[3]=0,s[4]=(E-J)*te,s[5]=(1-(I+R))*te,s[6]=(P+X)*te,s[7]=0,s[8]=(T+G)*ue,s[9]=(P-X)*ue,s[10]=(1-(I+U))*ue,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let c=_c.set(s[0],s[1],s[2]).length();const u=_c.set(s[4],s[5],s[6]).length(),a=_c.set(s[8],s[9],s[10]).length();this.determinant()<0&&(c=-c),e.x=s[12],e.y=s[13],e.z=s[14],Hs.copy(this);const A=1/c,x=1/u,b=1/a;return Hs.elements[0]*=A,Hs.elements[1]*=A,Hs.elements[2]*=A,Hs.elements[4]*=x,Hs.elements[5]*=x,Hs.elements[6]*=x,Hs.elements[8]*=b,Hs.elements[9]*=b,Hs.elements[10]*=b,t.setFromRotationMatrix(Hs),i.x=c,i.y=u,i.z=a,this}makePerspective(e,t,i,s,c,u){const a=this.elements,m=2*c/(t-e),A=2*c/(i-s),x=(t+e)/(t-e),b=(i+s)/(i-s),I=-(u+c)/(u-c),E=-2*u*c/(u-c);return a[0]=m,a[4]=0,a[8]=x,a[12]=0,a[1]=0,a[5]=A,a[9]=b,a[13]=0,a[2]=0,a[6]=0,a[10]=I,a[14]=E,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,s,c,u){const a=this.elements,m=1/(t-e),A=1/(i-s),x=1/(u-c),b=(t+e)*m,I=(i+s)*A,E=(u+c)*x;return a[0]=2*m,a[4]=0,a[8]=0,a[12]=-b,a[1]=0,a[5]=2*A,a[9]=0,a[13]=-I,a[2]=0,a[6]=0,a[10]=-2*x,a[14]=-E,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const _c=new we,Hs=new pi,nB=new we(0,0,0),rB=new we(1,1,1),go=new we,$p=new we,Jr=new we,Gv=new pi,Qv=new gs;class yc{constructor(e=0,t=0,i=0,s=yc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,c=s[0],u=s[4],a=s[8],m=s[1],A=s[5],x=s[9],b=s[2],I=s[6],E=s[10];switch(t){case"XYZ":this._y=Math.asin(Qn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-x,E),this._z=Math.atan2(-u,c)):(this._x=Math.atan2(I,A),this._z=0);break;case"YXZ":this._x=Math.asin(-Qn(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(a,E),this._z=Math.atan2(m,A)):(this._y=Math.atan2(-b,c),this._z=0);break;case"ZXY":this._x=Math.asin(Qn(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-b,E),this._z=Math.atan2(-u,A)):(this._y=0,this._z=Math.atan2(m,c));break;case"ZYX":this._y=Math.asin(-Qn(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(I,E),this._z=Math.atan2(m,c)):(this._x=0,this._z=Math.atan2(-u,A));break;case"YZX":this._z=Math.asin(Qn(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(-x,A),this._y=Math.atan2(-b,c)):(this._x=0,this._y=Math.atan2(a,E));break;case"XZY":this._z=Math.asin(-Qn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(I,A),this._y=Math.atan2(a,c)):(this._x=Math.atan2(-x,E),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Gv.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Gv,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Qv.setFromEuler(this),this.setFromQuaternion(Qv,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yc.DEFAULT_ORDER="XYZ";class iA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let sB=0;const Vv=new we,xc=new gs,Da=new pi,jp=new we,Au=new we,aB=new we,oB=new gs,Hv=new we(1,0,0),Wv=new we(0,1,0),qv=new we(0,0,1),lB={type:"added"},$v={type:"removed"};class Zi extends ms{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:sB++}),this.uuid=Gs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zi.DEFAULT_UP.clone();const e=new we,t=new yc,i=new gs,s=new we(1,1,1);function c(){i.setFromEuler(t,!1)}function u(){t.setFromQuaternion(i,void 0,!1)}t._onChange(c),i._onChange(u),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new pi},normalMatrix:{value:new Ei}}),this.matrix=new pi,this.matrixWorld=new pi,this.matrixAutoUpdate=Zi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new iA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return xc.setFromAxisAngle(e,t),this.quaternion.multiply(xc),this}rotateOnWorldAxis(e,t){return xc.setFromAxisAngle(e,t),this.quaternion.premultiply(xc),this}rotateX(e){return this.rotateOnAxis(Hv,e)}rotateY(e){return this.rotateOnAxis(Wv,e)}rotateZ(e){return this.rotateOnAxis(qv,e)}translateOnAxis(e,t){return Vv.copy(e).applyQuaternion(this.quaternion),this.position.add(Vv.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Hv,e)}translateY(e){return this.translateOnAxis(Wv,e)}translateZ(e){return this.translateOnAxis(qv,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Da.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?jp.copy(e):jp.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Au.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Da.lookAt(Au,jp,this.up):Da.lookAt(jp,Au,this.up),this.quaternion.setFromRotationMatrix(Da),s&&(Da.extractRotation(s.matrixWorld),xc.setFromRotationMatrix(Da),this.quaternion.premultiply(xc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(lB)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent($v)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent($v)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Da.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Da.multiply(e.parent.matrixWorld)),e.applyMatrix4(Da),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const u=this.children[i].getObjectByProperty(e,t);if(u!==void 0)return u}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let s=0,c=this.children.length;s<c;s++){const u=this.children[s].getObjectsByProperty(e,t);u.length>0&&(i=i.concat(u))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Au,e,aB),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Au,oB,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++){const c=t[i];(c.matrixWorldAutoUpdate===!0||e===!0)&&c.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let c=0,u=s.length;c<u;c++){const a=s[c];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function c(a,m){return a[m.uuid]===void 0&&(a[m.uuid]=m.toJSON(e)),m.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=c(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const m=a.shapes;if(Array.isArray(m))for(let A=0,x=m.length;A<x;A++){const b=m[A];c(e.shapes,b)}else c(e.shapes,m)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let m=0,A=this.material.length;m<A;m++)a.push(c(e.materials,this.material[m]));s.material=a}else s.material=c(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const m=this.animations[a];s.animations.push(c(e.animations,m))}}if(t){const a=u(e.geometries),m=u(e.materials),A=u(e.textures),x=u(e.images),b=u(e.shapes),I=u(e.skeletons),E=u(e.animations),T=u(e.nodes);a.length>0&&(i.geometries=a),m.length>0&&(i.materials=m),A.length>0&&(i.textures=A),x.length>0&&(i.images=x),b.length>0&&(i.shapes=b),I.length>0&&(i.skeletons=I),E.length>0&&(i.animations=E),T.length>0&&(i.nodes=T)}return i.object=s,i;function u(a){const m=[];for(const A in a){const x=a[A];delete x.metadata,m.push(x)}return m}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Zi.DEFAULT_UP=new we(0,1,0),Zi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ws=new we,Pa=new we,nA=new we,Ua=new we,vc=new we,bc=new we,jv=new we,rA=new we,sA=new we,aA=new we;let Xp=!1;class es{constructor(e=new we,t=new we,i=new we){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),Ws.subVectors(e,t),s.cross(Ws);const c=s.lengthSq();return c>0?s.multiplyScalar(1/Math.sqrt(c)):s.set(0,0,0)}static getBarycoord(e,t,i,s,c){Ws.subVectors(s,t),Pa.subVectors(i,t),nA.subVectors(e,t);const u=Ws.dot(Ws),a=Ws.dot(Pa),m=Ws.dot(nA),A=Pa.dot(Pa),x=Pa.dot(nA),b=u*A-a*a;if(b===0)return c.set(-2,-1,-1);const I=1/b,E=(A*m-a*x)*I,T=(u*x-a*m)*I;return c.set(1-E-T,T,E)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Ua),Ua.x>=0&&Ua.y>=0&&Ua.x+Ua.y<=1}static getUV(e,t,i,s,c,u,a,m){return Xp===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Xp=!0),this.getInterpolation(e,t,i,s,c,u,a,m)}static getInterpolation(e,t,i,s,c,u,a,m){return this.getBarycoord(e,t,i,s,Ua),m.setScalar(0),m.addScaledVector(c,Ua.x),m.addScaledVector(u,Ua.y),m.addScaledVector(a,Ua.z),m}static isFrontFacing(e,t,i,s){return Ws.subVectors(i,t),Pa.subVectors(e,t),Ws.cross(Pa).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ws.subVectors(this.c,this.b),Pa.subVectors(this.a,this.b),Ws.cross(Pa).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return es.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return es.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,c){return Xp===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Xp=!0),es.getInterpolation(e,this.a,this.b,this.c,t,i,s,c)}getInterpolation(e,t,i,s,c){return es.getInterpolation(e,this.a,this.b,this.c,t,i,s,c)}containsPoint(e){return es.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return es.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,c=this.c;let u,a;vc.subVectors(s,i),bc.subVectors(c,i),rA.subVectors(e,i);const m=vc.dot(rA),A=bc.dot(rA);if(m<=0&&A<=0)return t.copy(i);sA.subVectors(e,s);const x=vc.dot(sA),b=bc.dot(sA);if(x>=0&&b<=x)return t.copy(s);const I=m*b-x*A;if(I<=0&&m>=0&&x<=0)return u=m/(m-x),t.copy(i).addScaledVector(vc,u);aA.subVectors(e,c);const E=vc.dot(aA),T=bc.dot(aA);if(T>=0&&E<=T)return t.copy(c);const U=E*A-m*T;if(U<=0&&A>=0&&T<=0)return a=A/(A-T),t.copy(i).addScaledVector(bc,a);const P=x*T-E*b;if(P<=0&&b-x>=0&&E-T>=0)return jv.subVectors(c,s),a=(b-x)/(b-x+(E-T)),t.copy(s).addScaledVector(jv,a);const R=1/(P+U+I);return u=U*R,a=I*R,t.copy(i).addScaledVector(vc,u).addScaledVector(bc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let cB=0;class qs extends ms{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:cB++}),this.uuid=Gs(),this.name="",this.type="Material",this.blending=tc,this.side=ks,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=nv,this.blendDst=rv,this.blendEquation=ic,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Mg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=UT,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Qg,this.stencilZFail=Qg,this.stencilZPass=Qg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==tc&&(i.blending=this.blending),this.side!==ks&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(c){const u=[];for(const a in c){const m=c[a];delete m.metadata,u.push(m)}return u}if(t){const c=s(e.textures),u=s(e.images);c.length>0&&(i.textures=c),u.length>0&&(i.images=u)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let c=0;c!==s;++c)i[c]=t[c].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const Xv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$s={h:0,s:0,l:0},Yp={h:0,s:0,l:0};function oA(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}class hi{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ni){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Qs.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=Qs.workingColorSpace){return this.r=e,this.g=t,this.b=i,Qs.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=Qs.workingColorSpace){if(e=Wg(e,1),t=Qn(t,0,1),i=Qn(i,0,1),t===0)this.r=this.g=this.b=i;else{const c=i<=.5?i*(1+t):i+t-i*t,u=2*i-c;this.r=oA(u,c,e+1/3),this.g=oA(u,c,e),this.b=oA(u,c,e-1/3)}return Qs.toWorkingColorSpace(this,s),this}setStyle(e,t=ni){function i(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let c;const u=s[1],a=s[2];switch(u){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(c[4]),this.setRGB(Math.min(255,parseInt(c[1],10))/255,Math.min(255,parseInt(c[2],10))/255,Math.min(255,parseInt(c[3],10))/255,t);if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(c[4]),this.setRGB(Math.min(100,parseInt(c[1],10))/100,Math.min(100,parseInt(c[2],10))/100,Math.min(100,parseInt(c[3],10))/100,t);break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(c[4]),this.setHSL(parseFloat(c[1])/360,parseFloat(c[2])/100,parseFloat(c[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const c=s[1],u=c.length;if(u===3)return this.setRGB(parseInt(c.charAt(0),16)/15,parseInt(c.charAt(1),16)/15,parseInt(c.charAt(2),16)/15,t);if(u===6)return this.setHex(parseInt(c,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ni){const i=Xv[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=dc(e.r),this.g=dc(e.g),this.b=dc(e.b),this}copyLinearToSRGB(e){return this.r=jg(e.r),this.g=jg(e.g),this.b=jg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ni){return Qs.fromWorkingColorSpace(pr.copy(this),e),Math.round(Qn(pr.r*255,0,255))*65536+Math.round(Qn(pr.g*255,0,255))*256+Math.round(Qn(pr.b*255,0,255))}getHexString(e=ni){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Qs.workingColorSpace){Qs.fromWorkingColorSpace(pr.copy(this),t);const i=pr.r,s=pr.g,c=pr.b,u=Math.max(i,s,c),a=Math.min(i,s,c);let m,A;const x=(a+u)/2;if(a===u)m=0,A=0;else{const b=u-a;switch(A=x<=.5?b/(u+a):b/(2-u-a),u){case i:m=(s-c)/b+(s<c?6:0);break;case s:m=(c-i)/b+2;break;case c:m=(i-s)/b+4;break}m/=6}return e.h=m,e.s=A,e.l=x,e}getRGB(e,t=Qs.workingColorSpace){return Qs.fromWorkingColorSpace(pr.copy(this),t),e.r=pr.r,e.g=pr.g,e.b=pr.b,e}getStyle(e=ni){Qs.fromWorkingColorSpace(pr.copy(this),e);const t=pr.r,i=pr.g,s=pr.b;return e!==ni?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL($s),$s.h+=e,$s.s+=t,$s.l+=i,this.setHSL($s.h,$s.s,$s.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL($s),e.getHSL(Yp);const i=du($s.h,Yp.h,t),s=du($s.s,Yp.s,t),c=du($s.l,Yp.l,t);return this.setHSL(i,s,c),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,c=e.elements;return this.r=c[0]*t+c[3]*i+c[6]*s,this.g=c[1]*t+c[4]*i+c[7]*s,this.b=c[2]*t+c[5]*i+c[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const pr=new hi;hi.NAMES=Xv;class js extends qs{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new hi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=sv,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Fa=hB();function hB(){const o=new ArrayBuffer(4),e=new Float32Array(o),t=new Uint32Array(o),i=new Uint32Array(512),s=new Uint32Array(512);for(let m=0;m<256;++m){const A=m-127;A<-27?(i[m]=0,i[m|256]=32768,s[m]=24,s[m|256]=24):A<-14?(i[m]=1024>>-A-14,i[m|256]=1024>>-A-14|32768,s[m]=-A-1,s[m|256]=-A-1):A<=15?(i[m]=A+15<<10,i[m|256]=A+15<<10|32768,s[m]=13,s[m|256]=13):A<128?(i[m]=31744,i[m|256]=64512,s[m]=24,s[m|256]=24):(i[m]=31744,i[m|256]=64512,s[m]=13,s[m|256]=13)}const c=new Uint32Array(2048),u=new Uint32Array(64),a=new Uint32Array(64);for(let m=1;m<1024;++m){let A=m<<13,x=0;for(;(A&8388608)===0;)A<<=1,x-=8388608;A&=-8388609,x+=947912704,c[m]=A|x}for(let m=1024;m<2048;++m)c[m]=939524096+(m-1024<<13);for(let m=1;m<31;++m)u[m]=m<<23;u[31]=1199570944,u[32]=2147483648;for(let m=33;m<63;++m)u[m]=2147483648+(m-32<<23);u[63]=3347054592;for(let m=1;m<64;++m)m!==32&&(a[m]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:s,mantissaTable:c,exponentTable:u,offsetTable:a}}function uB(o){Math.abs(o)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),o=Qn(o,-65504,65504),Fa.floatView[0]=o;const e=Fa.uint32View[0],t=e>>23&511;return Fa.baseTable[t]+((e&8388607)>>Fa.shiftTable[t])}function dB(o){const e=o>>10;return Fa.uint32View[0]=Fa.mantissaTable[Fa.offsetTable[e]+(o&1023)]+Fa.exponentTable[e],Fa.floatView[0]}const Kp={toHalfFloat:uB,fromHalfFloat:dB},Un=new we,Zp=new yi;class pn{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Vg,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,c=this.itemSize;s<c;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Zp.fromBufferAttribute(this,t),Zp.applyMatrix3(e),this.setXY(t,Zp.x,Zp.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.applyMatrix3(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.applyMatrix4(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.applyNormalMatrix(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Un.fromBufferAttribute(this,t),Un.transformDirection(e),this.setXYZ(t,Un.x,Un.y,Un.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ta(t,this.array)),t}setX(e,t){return this.normalized&&(t=nn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ta(t,this.array)),t}setY(e,t){return this.normalized&&(t=nn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ta(t,this.array)),t}setZ(e,t){return this.normalized&&(t=nn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ta(t,this.array)),t}setW(e,t){return this.normalized&&(t=nn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=nn(t,this.array),i=nn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=nn(t,this.array),i=nn(i,this.array),s=nn(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,c){return e*=this.itemSize,this.normalized&&(t=nn(t,this.array),i=nn(i,this.array),s=nn(s,this.array),c=nn(c,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=c,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Vg&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Yv extends pn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Kv extends pn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class oa extends pn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let pB=0;const _s=new pi,lA=new Zi,wc=new we,ts=new Er,_u=new Er,Vn=new we;class ys extends ms{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:pB++}),this.uuid=Gs(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Uv(e)?Kv:Yv)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const c=new Ei().getNormalMatrix(e);i.applyNormalMatrix(c),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _s.makeRotationFromQuaternion(e),this.applyMatrix4(_s),this}rotateX(e){return _s.makeRotationX(e),this.applyMatrix4(_s),this}rotateY(e){return _s.makeRotationY(e),this.applyMatrix4(_s),this}rotateZ(e){return _s.makeRotationZ(e),this.applyMatrix4(_s),this}translate(e,t,i){return _s.makeTranslation(e,t,i),this.applyMatrix4(_s),this}scale(e,t,i){return _s.makeScale(e,t,i),this.applyMatrix4(_s),this}lookAt(e){return lA.lookAt(e),lA.updateMatrix(),this.applyMatrix4(lA.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wc).negate(),this.translate(wc.x,wc.y,wc.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const c=e[i];t.push(c.x,c.y,c.z||0)}return this.setAttribute("position",new oa(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Er);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new we(-1/0,-1/0,-1/0),new we(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const c=t[i];ts.setFromBufferAttribute(c),this.morphTargetsRelative?(Vn.addVectors(this.boundingBox.min,ts.min),this.boundingBox.expandByPoint(Vn),Vn.addVectors(this.boundingBox.max,ts.max),this.boundingBox.expandByPoint(Vn)):(this.boundingBox.expandByPoint(ts.min),this.boundingBox.expandByPoint(ts.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new As);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new we,1/0);return}if(e){const i=this.boundingSphere.center;if(ts.setFromBufferAttribute(e),t)for(let c=0,u=t.length;c<u;c++){const a=t[c];_u.setFromBufferAttribute(a),this.morphTargetsRelative?(Vn.addVectors(ts.min,_u.min),ts.expandByPoint(Vn),Vn.addVectors(ts.max,_u.max),ts.expandByPoint(Vn)):(ts.expandByPoint(_u.min),ts.expandByPoint(_u.max))}ts.getCenter(i);let s=0;for(let c=0,u=e.count;c<u;c++)Vn.fromBufferAttribute(e,c),s=Math.max(s,i.distanceToSquared(Vn));if(t)for(let c=0,u=t.length;c<u;c++){const a=t[c],m=this.morphTargetsRelative;for(let A=0,x=a.count;A<x;A++)Vn.fromBufferAttribute(a,A),m&&(wc.fromBufferAttribute(e,A),Vn.add(wc)),s=Math.max(s,i.distanceToSquared(Vn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,s=t.position.array,c=t.normal.array,u=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new pn(new Float32Array(4*a),4));const m=this.getAttribute("tangent").array,A=[],x=[];for(let ce=0;ce<a;ce++)A[ce]=new we,x[ce]=new we;const b=new we,I=new we,E=new we,T=new yi,U=new yi,P=new yi,R=new we,X=new we;function G(ce,Ve,Ne){b.fromArray(s,ce*3),I.fromArray(s,Ve*3),E.fromArray(s,Ne*3),T.fromArray(u,ce*2),U.fromArray(u,Ve*2),P.fromArray(u,Ne*2),I.sub(b),E.sub(b),U.sub(T),P.sub(T);const Me=1/(U.x*P.y-P.x*U.y);!isFinite(Me)||(R.copy(I).multiplyScalar(P.y).addScaledVector(E,-U.y).multiplyScalar(Me),X.copy(E).multiplyScalar(U.x).addScaledVector(I,-P.x).multiplyScalar(Me),A[ce].add(R),A[Ve].add(R),A[Ne].add(R),x[ce].add(X),x[Ve].add(X),x[Ne].add(X))}let J=this.groups;J.length===0&&(J=[{start:0,count:i.length}]);for(let ce=0,Ve=J.length;ce<Ve;++ce){const Ne=J[ce],Me=Ne.start,ve=Ne.count;for(let ke=Me,Re=Me+ve;ke<Re;ke+=3)G(i[ke+0],i[ke+1],i[ke+2])}const q=new we,te=new we,ue=new we,_e=new we;function K(ce){ue.fromArray(c,ce*3),_e.copy(ue);const Ve=A[ce];q.copy(Ve),q.sub(ue.multiplyScalar(ue.dot(Ve))).normalize(),te.crossVectors(_e,Ve);const Me=te.dot(x[ce])<0?-1:1;m[ce*4]=q.x,m[ce*4+1]=q.y,m[ce*4+2]=q.z,m[ce*4+3]=Me}for(let ce=0,Ve=J.length;ce<Ve;++ce){const Ne=J[ce],Me=Ne.start,ve=Ne.count;for(let ke=Me,Re=Me+ve;ke<Re;ke+=3)K(i[ke+0]),K(i[ke+1]),K(i[ke+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new pn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let I=0,E=i.count;I<E;I++)i.setXYZ(I,0,0,0);const s=new we,c=new we,u=new we,a=new we,m=new we,A=new we,x=new we,b=new we;if(e)for(let I=0,E=e.count;I<E;I+=3){const T=e.getX(I+0),U=e.getX(I+1),P=e.getX(I+2);s.fromBufferAttribute(t,T),c.fromBufferAttribute(t,U),u.fromBufferAttribute(t,P),x.subVectors(u,c),b.subVectors(s,c),x.cross(b),a.fromBufferAttribute(i,T),m.fromBufferAttribute(i,U),A.fromBufferAttribute(i,P),a.add(x),m.add(x),A.add(x),i.setXYZ(T,a.x,a.y,a.z),i.setXYZ(U,m.x,m.y,m.z),i.setXYZ(P,A.x,A.y,A.z)}else for(let I=0,E=t.count;I<E;I+=3)s.fromBufferAttribute(t,I+0),c.fromBufferAttribute(t,I+1),u.fromBufferAttribute(t,I+2),x.subVectors(u,c),b.subVectors(s,c),x.cross(b),i.setXYZ(I+0,x.x,x.y,x.z),i.setXYZ(I+1,x.x,x.y,x.z),i.setXYZ(I+2,x.x,x.y,x.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Vn.fromBufferAttribute(e,t),Vn.normalize(),e.setXYZ(t,Vn.x,Vn.y,Vn.z)}toNonIndexed(){function e(a,m){const A=a.array,x=a.itemSize,b=a.normalized,I=new A.constructor(m.length*x);let E=0,T=0;for(let U=0,P=m.length;U<P;U++){a.isInterleavedBufferAttribute?E=m[U]*a.data.stride+a.offset:E=m[U]*x;for(let R=0;R<x;R++)I[T++]=A[E++]}return new pn(I,x,b)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ys,i=this.index.array,s=this.attributes;for(const a in s){const m=s[a],A=e(m,i);t.setAttribute(a,A)}const c=this.morphAttributes;for(const a in c){const m=[],A=c[a];for(let x=0,b=A.length;x<b;x++){const I=A[x],E=e(I,i);m.push(E)}t.morphAttributes[a]=m}t.morphTargetsRelative=this.morphTargetsRelative;const u=this.groups;for(let a=0,m=u.length;a<m;a++){const A=u[a];t.addGroup(A.start,A.count,A.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const m=this.parameters;for(const A in m)m[A]!==void 0&&(e[A]=m[A]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const m in i){const A=i[m];e.data.attributes[m]=A.toJSON(e.data)}const s={};let c=!1;for(const m in this.morphAttributes){const A=this.morphAttributes[m],x=[];for(let b=0,I=A.length;b<I;b++){const E=A[b];x.push(E.toJSON(e.data))}x.length>0&&(s[m]=x,c=!0)}c&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const u=this.groups;u.length>0&&(e.data.groups=JSON.parse(JSON.stringify(u)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const A in s){const x=s[A];this.setAttribute(A,x.clone(t))}const c=e.morphAttributes;for(const A in c){const x=[],b=c[A];for(let I=0,E=b.length;I<E;I++)x.push(b[I].clone(t));this.morphAttributes[A]=x}this.morphTargetsRelative=e.morphTargetsRelative;const u=e.groups;for(let A=0,x=u.length;A<x;A++){const b=u[A];this.addGroup(b.start,b.count,b.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const m=e.boundingSphere;return m!==null&&(this.boundingSphere=m.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Zv=new pi,la=new qp,Jp=new As,Jv=new we,Ec=new we,Sc=new we,Ic=new we,cA=new we,ef=new we,tf=new yi,nf=new yi,rf=new yi,e1=new we,t1=new we,i1=new we,sf=new we,af=new we;class oi extends Zi{constructor(e=new ys,t=new js){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,u=s.length;c<u;c++){const a=s[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=c}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,c=i.morphAttributes.position,u=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(c&&a){ef.set(0,0,0);for(let m=0,A=c.length;m<A;m++){const x=a[m],b=c[m];x!==0&&(cA.fromBufferAttribute(b,e),u?ef.addScaledVector(cA,x):ef.addScaledVector(cA.sub(t),x))}t.add(ef)}return t}raycast(e,t){const i=this.geometry,s=this.material,c=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Jp.copy(i.boundingSphere),Jp.applyMatrix4(c),la.copy(e.ray).recast(e.near),!(Jp.containsPoint(la.origin)===!1&&(la.intersectSphere(Jp,Jv)===null||la.origin.distanceToSquared(Jv)>(e.far-e.near)**2))&&(Zv.copy(c).invert(),la.copy(e.ray).applyMatrix4(Zv),!(i.boundingBox!==null&&la.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t)))}_computeIntersections(e,t){let i;const s=this.geometry,c=this.material,u=s.index,a=s.attributes.position,m=s.attributes.uv,A=s.attributes.uv1,x=s.attributes.normal,b=s.groups,I=s.drawRange;if(u!==null)if(Array.isArray(c))for(let E=0,T=b.length;E<T;E++){const U=b[E],P=c[U.materialIndex],R=Math.max(U.start,I.start),X=Math.min(u.count,Math.min(U.start+U.count,I.start+I.count));for(let G=R,J=X;G<J;G+=3){const q=u.getX(G),te=u.getX(G+1),ue=u.getX(G+2);i=of(this,P,e,la,m,A,x,q,te,ue),i&&(i.faceIndex=Math.floor(G/3),i.face.materialIndex=U.materialIndex,t.push(i))}}else{const E=Math.max(0,I.start),T=Math.min(u.count,I.start+I.count);for(let U=E,P=T;U<P;U+=3){const R=u.getX(U),X=u.getX(U+1),G=u.getX(U+2);i=of(this,c,e,la,m,A,x,R,X,G),i&&(i.faceIndex=Math.floor(U/3),t.push(i))}}else if(a!==void 0)if(Array.isArray(c))for(let E=0,T=b.length;E<T;E++){const U=b[E],P=c[U.materialIndex],R=Math.max(U.start,I.start),X=Math.min(a.count,Math.min(U.start+U.count,I.start+I.count));for(let G=R,J=X;G<J;G+=3){const q=G,te=G+1,ue=G+2;i=of(this,P,e,la,m,A,x,q,te,ue),i&&(i.faceIndex=Math.floor(G/3),i.face.materialIndex=U.materialIndex,t.push(i))}}else{const E=Math.max(0,I.start),T=Math.min(a.count,I.start+I.count);for(let U=E,P=T;U<P;U+=3){const R=U,X=U+1,G=U+2;i=of(this,c,e,la,m,A,x,R,X,G),i&&(i.faceIndex=Math.floor(U/3),t.push(i))}}}}function fB(o,e,t,i,s,c,u,a){let m;if(e.side===Gn?m=i.intersectTriangle(u,c,s,!0,a):m=i.intersectTriangle(s,c,u,e.side===ks,a),m===null)return null;af.copy(a),af.applyMatrix4(o.matrixWorld);const A=t.ray.origin.distanceTo(af);return A<t.near||A>t.far?null:{distance:A,point:af.clone(),object:o}}function of(o,e,t,i,s,c,u,a,m,A){o.getVertexPosition(a,Ec),o.getVertexPosition(m,Sc),o.getVertexPosition(A,Ic);const x=fB(o,e,t,i,Ec,Sc,Ic,sf);if(x){s&&(tf.fromBufferAttribute(s,a),nf.fromBufferAttribute(s,m),rf.fromBufferAttribute(s,A),x.uv=es.getInterpolation(sf,Ec,Sc,Ic,tf,nf,rf,new yi)),c&&(tf.fromBufferAttribute(c,a),nf.fromBufferAttribute(c,m),rf.fromBufferAttribute(c,A),x.uv1=es.getInterpolation(sf,Ec,Sc,Ic,tf,nf,rf,new yi),x.uv2=x.uv1),u&&(e1.fromBufferAttribute(u,a),t1.fromBufferAttribute(u,m),i1.fromBufferAttribute(u,A),x.normal=es.getInterpolation(sf,Ec,Sc,Ic,e1,t1,i1,new we),x.normal.dot(i.direction)>0&&x.normal.multiplyScalar(-1));const b={a,b:m,c:A,normal:new we,materialIndex:0};es.getNormal(Ec,Sc,Ic,b.normal),x.face=b}return x}class Ao extends ys{constructor(e=1,t=1,i=1,s=1,c=1,u=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:c,depthSegments:u};const a=this;s=Math.floor(s),c=Math.floor(c),u=Math.floor(u);const m=[],A=[],x=[],b=[];let I=0,E=0;T("z","y","x",-1,-1,i,t,e,u,c,0),T("z","y","x",1,-1,i,t,-e,u,c,1),T("x","z","y",1,1,e,i,t,s,u,2),T("x","z","y",1,-1,e,i,-t,s,u,3),T("x","y","z",1,-1,e,t,i,s,c,4),T("x","y","z",-1,-1,e,t,-i,s,c,5),this.setIndex(m),this.setAttribute("position",new oa(A,3)),this.setAttribute("normal",new oa(x,3)),this.setAttribute("uv",new oa(b,2));function T(U,P,R,X,G,J,q,te,ue,_e,K){const ce=J/ue,Ve=q/_e,Ne=J/2,Me=q/2,ve=te/2,ke=ue+1,Re=_e+1;let Fe=0,Oe=0;const je=new we;for(let Je=0;Je<Re;Je++){const _t=Je*Ve-Me;for(let yt=0;yt<ke;yt++){const qe=yt*ce-Ne;je[U]=qe*X,je[P]=_t*G,je[R]=ve,A.push(je.x,je.y,je.z),je[U]=0,je[P]=0,je[R]=te>0?1:-1,x.push(je.x,je.y,je.z),b.push(yt/ue),b.push(1-Je/_e),Fe+=1}}for(let Je=0;Je<_e;Je++)for(let _t=0;_t<ue;_t++){const yt=I+_t+ke*Je,qe=I+_t+ke*(Je+1),Ye=I+(_t+1)+ke*(Je+1),at=I+(_t+1)+ke*Je;m.push(yt,qe,at),m.push(qe,Ye,at),Oe+=6}a.addGroup(E,Oe,K),E+=Oe,I+=Fe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ao(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Cc(o){const e={};for(const t in o){e[t]={};for(const i in o[t]){const s=o[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function Sr(o){const e={};for(let t=0;t<o.length;t++){const i=Cc(o[t]);for(const s in i)e[s]=i[s]}return e}function mB(o){const e=[];for(let t=0;t<o.length;t++)e.push(o[t].clone());return e}function n1(o){return o.getRenderTarget()===null?o.outputColorSpace:Qr}const gB={clone:Cc,merge:Sr};var AB=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,_B=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xs extends qs{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=AB,this.fragmentShader=_B,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Cc(e.uniforms),this.uniformsGroups=mB(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const u=this.uniforms[s].value;u&&u.isTexture?t.uniforms[s]={type:"t",value:u.toJSON(e).uuid}:u&&u.isColor?t.uniforms[s]={type:"c",value:u.getHex()}:u&&u.isVector2?t.uniforms[s]={type:"v2",value:u.toArray()}:u&&u.isVector3?t.uniforms[s]={type:"v3",value:u.toArray()}:u&&u.isVector4?t.uniforms[s]={type:"v4",value:u.toArray()}:u&&u.isMatrix3?t.uniforms[s]={type:"m3",value:u.toArray()}:u&&u.isMatrix4?t.uniforms[s]={type:"m4",value:u.toArray()}:t.uniforms[s]={value:u}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class r1 extends Zi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pi,this.projectionMatrix=new pi,this.projectionMatrixInverse=new pi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ir extends r1{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=uc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(uu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return uc*2*Math.atan(Math.tan(uu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,c,u){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=c,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(uu*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,c=-.5*s;const u=this.view;if(this.view!==null&&this.view.enabled){const m=u.fullWidth,A=u.fullHeight;c+=u.offsetX*s/m,t-=u.offsetY*i/A,s*=u.width/m,i*=u.height/A}const a=this.filmOffset;a!==0&&(c+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+s,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Mc=-90,Tc=1;class hA extends Zi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const s=new ir(Mc,Tc,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(1,0,0),this.add(s);const c=new ir(Mc,Tc,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(-1,0,0),this.add(c);const u=new ir(Mc,Tc,e,t);u.layers=this.layers,u.up.set(0,0,-1),u.lookAt(0,1,0),this.add(u);const a=new ir(Mc,Tc,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const m=new ir(Mc,Tc,e,t);m.layers=this.layers,m.up.set(0,1,0),m.lookAt(0,0,1),this.add(m);const A=new ir(Mc,Tc,e,t);A.layers=this.layers,A.up.set(0,1,0),A.lookAt(0,0,-1),this.add(A)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[s,c,u,a,m,A]=this.children,x=e.getRenderTarget(),b=e.toneMapping,I=e.xr.enabled;e.toneMapping=Ns,e.xr.enabled=!1;const E=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,c),e.setRenderTarget(i,2),e.render(t,u),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,m),i.texture.generateMipmaps=E,e.setRenderTarget(i,5),e.render(t,A),e.setRenderTarget(x),e.toneMapping=b,e.xr.enabled=I,i.texture.needsPMREMUpdate=!0}}class s1 extends vn{constructor(e,t,i,s,c,u,a,m,A,x){e=e!==void 0?e:[],t=t!==void 0?t:nc,super(e,t,i,s,c,u,a,m,A,x),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class uA extends Vs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];t.encoding!==void 0&&(fu("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===zs?ni:fs),this.texture=new s1(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:dn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Ao(5,5,5),c=new Xs({name:"CubemapFromEquirect",uniforms:Cc(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Gn,blending:Ma});c.uniforms.tEquirect.value=t;const u=new oi(s,c),a=t.minFilter;return t.minFilter===Os&&(t.minFilter=dn),new hA(1,10,this).update(e,u),t.minFilter=a,u.geometry.dispose(),u.material.dispose(),this}clear(e,t,i,s){const c=e.getRenderTarget();for(let u=0;u<6;u++)e.setRenderTarget(this,u),e.clear(t,i,s);e.setRenderTarget(c)}}const dA=new we,yB=new we,xB=new Ei;class dl{constructor(e=new we(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=dA.subVectors(i,t).cross(yB.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(dA),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const c=-(e.start.dot(this.normal)+this.constant)/s;return c<0||c>1?null:t.copy(e.start).addScaledVector(i,c)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||xB.getNormalMatrix(e),s=this.coplanarPoint(dA).applyMatrix4(e),c=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(c),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const pl=new As,lf=new we;class pA{constructor(e=new dl,t=new dl,i=new dl,s=new dl,c=new dl,u=new dl){this.planes=[e,t,i,s,c,u]}set(e,t,i,s,c,u){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(c),a[5].copy(u),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,s=i[0],c=i[1],u=i[2],a=i[3],m=i[4],A=i[5],x=i[6],b=i[7],I=i[8],E=i[9],T=i[10],U=i[11],P=i[12],R=i[13],X=i[14],G=i[15];return t[0].setComponents(a-s,b-m,U-I,G-P).normalize(),t[1].setComponents(a+s,b+m,U+I,G+P).normalize(),t[2].setComponents(a+c,b+A,U+E,G+R).normalize(),t[3].setComponents(a-c,b-A,U-E,G-R).normalize(),t[4].setComponents(a-u,b-x,U-T,G-X).normalize(),t[5].setComponents(a+u,b+x,U+T,G+X).normalize(),this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),pl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),pl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(pl)}intersectsSprite(e){return pl.center.set(0,0,0),pl.radius=.7071067811865476,pl.applyMatrix4(e.matrixWorld),this.intersectsSphere(pl)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let c=0;c<6;c++)if(t[c].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(lf.x=s.normal.x>0?e.max.x:e.min.x,lf.y=s.normal.y>0?e.max.y:e.min.y,lf.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(lf)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function a1(){let o=null,e=!1,t=null,i=null;function s(c,u){t(c,u),i=o.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=o.requestAnimationFrame(s),e=!0)},stop:function(){o.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(c){t=c},setContext:function(c){o=c}}}function vB(o,e){const t=e.isWebGL2,i=new WeakMap;function s(A,x){const b=A.array,I=A.usage,E=o.createBuffer();o.bindBuffer(x,E),o.bufferData(x,b,I),A.onUploadCallback();let T;if(b instanceof Float32Array)T=o.FLOAT;else if(b instanceof Uint16Array)if(A.isFloat16BufferAttribute)if(t)T=o.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else T=o.UNSIGNED_SHORT;else if(b instanceof Int16Array)T=o.SHORT;else if(b instanceof Uint32Array)T=o.UNSIGNED_INT;else if(b instanceof Int32Array)T=o.INT;else if(b instanceof Int8Array)T=o.BYTE;else if(b instanceof Uint8Array)T=o.UNSIGNED_BYTE;else if(b instanceof Uint8ClampedArray)T=o.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+b);return{buffer:E,type:T,bytesPerElement:b.BYTES_PER_ELEMENT,version:A.version}}function c(A,x,b){const I=x.array,E=x.updateRange;o.bindBuffer(b,A),E.count===-1?o.bufferSubData(b,0,I):(t?o.bufferSubData(b,E.offset*I.BYTES_PER_ELEMENT,I,E.offset,E.count):o.bufferSubData(b,E.offset*I.BYTES_PER_ELEMENT,I.subarray(E.offset,E.offset+E.count)),E.count=-1),x.onUploadCallback()}function u(A){return A.isInterleavedBufferAttribute&&(A=A.data),i.get(A)}function a(A){A.isInterleavedBufferAttribute&&(A=A.data);const x=i.get(A);x&&(o.deleteBuffer(x.buffer),i.delete(A))}function m(A,x){if(A.isGLBufferAttribute){const I=i.get(A);(!I||I.version<A.version)&&i.set(A,{buffer:A.buffer,type:A.type,bytesPerElement:A.elementSize,version:A.version});return}A.isInterleavedBufferAttribute&&(A=A.data);const b=i.get(A);b===void 0?i.set(A,s(A,x)):b.version<A.version&&(c(b.buffer,A,x),b.version=A.version)}return{get:u,remove:a,update:m}}class ka extends ys{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const c=e/2,u=t/2,a=Math.floor(i),m=Math.floor(s),A=a+1,x=m+1,b=e/a,I=t/m,E=[],T=[],U=[],P=[];for(let R=0;R<x;R++){const X=R*I-u;for(let G=0;G<A;G++){const J=G*b-c;T.push(J,-X,0),U.push(0,0,1),P.push(G/a),P.push(1-R/m)}}for(let R=0;R<m;R++)for(let X=0;X<a;X++){const G=X+A*R,J=X+A*(R+1),q=X+1+A*(R+1),te=X+1+A*R;E.push(G,J,te),E.push(J,q,te)}this.setIndex(E),this.setAttribute("position",new oa(T,3)),this.setAttribute("normal",new oa(U,3)),this.setAttribute("uv",new oa(P,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ka(e.width,e.height,e.widthSegments,e.heightSegments)}}var bB=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,wB=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,EB=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,SB=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,IB=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,CB=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,MB="vec3 transformed = vec3( position );",TB=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,BB=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,RB=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,LB=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,DB=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,PB=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,UB=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,FB=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,kB=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,NB=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,OB=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,zB=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,GB=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,QB=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,VB=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,HB=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,WB=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,qB=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$B=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,jB="gl_FragColor = linearToOutputTexel( gl_FragColor );",XB=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,YB=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,KB=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,ZB=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,JB=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,eR=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,tR=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,iR=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,nR=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,rR=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,sR=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,aR=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,oR=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lR=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,cR=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,hR=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,uR=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,dR=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,pR=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,fR=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,mR=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,gR=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,AR=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_R=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,yR=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,xR=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,vR=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,bR=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wR=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,ER=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,SR=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,IR=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,CR=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,MR=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,TR=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,BR=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,RR=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,LR=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,DR=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,PR=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,UR=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,FR=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,kR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,NR=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,OR=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,zR=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,GR=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,QR=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,VR=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,HR=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,WR=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,qR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$R=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,jR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,XR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,YR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,KR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ZR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,JR=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,eL=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,tL=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,iL=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,nL=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,rL=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,sL=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,aL=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,oL=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,lL=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,cL=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,hL=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,uL=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,dL=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,pL=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fL=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,mL=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,gL=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const wi={alphamap_fragment:bB,alphamap_pars_fragment:wB,alphatest_fragment:EB,alphatest_pars_fragment:SB,aomap_fragment:IB,aomap_pars_fragment:CB,begin_vertex:MB,beginnormal_vertex:TB,bsdfs:BB,iridescence_fragment:RB,bumpmap_pars_fragment:LB,clipping_planes_fragment:DB,clipping_planes_pars_fragment:PB,clipping_planes_pars_vertex:UB,clipping_planes_vertex:FB,color_fragment:kB,color_pars_fragment:NB,color_pars_vertex:OB,color_vertex:zB,common:GB,cube_uv_reflection_fragment:QB,defaultnormal_vertex:VB,displacementmap_pars_vertex:HB,displacementmap_vertex:WB,emissivemap_fragment:qB,emissivemap_pars_fragment:$B,encodings_fragment:jB,encodings_pars_fragment:XB,envmap_fragment:YB,envmap_common_pars_fragment:KB,envmap_pars_fragment:ZB,envmap_pars_vertex:JB,envmap_physical_pars_fragment:uR,envmap_vertex:eR,fog_vertex:tR,fog_pars_vertex:iR,fog_fragment:nR,fog_pars_fragment:rR,gradientmap_pars_fragment:sR,lightmap_fragment:aR,lightmap_pars_fragment:oR,lights_lambert_fragment:lR,lights_lambert_pars_fragment:cR,lights_pars_begin:hR,lights_toon_fragment:dR,lights_toon_pars_fragment:pR,lights_phong_fragment:fR,lights_phong_pars_fragment:mR,lights_physical_fragment:gR,lights_physical_pars_fragment:AR,lights_fragment_begin:_R,lights_fragment_maps:yR,lights_fragment_end:xR,logdepthbuf_fragment:vR,logdepthbuf_pars_fragment:bR,logdepthbuf_pars_vertex:wR,logdepthbuf_vertex:ER,map_fragment:SR,map_pars_fragment:IR,map_particle_fragment:CR,map_particle_pars_fragment:MR,metalnessmap_fragment:TR,metalnessmap_pars_fragment:BR,morphcolor_vertex:RR,morphnormal_vertex:LR,morphtarget_pars_vertex:DR,morphtarget_vertex:PR,normal_fragment_begin:UR,normal_fragment_maps:FR,normal_pars_fragment:kR,normal_pars_vertex:NR,normal_vertex:OR,normalmap_pars_fragment:zR,clearcoat_normal_fragment_begin:GR,clearcoat_normal_fragment_maps:QR,clearcoat_pars_fragment:VR,iridescence_pars_fragment:HR,output_fragment:WR,packing:qR,premultiplied_alpha_fragment:$R,project_vertex:jR,dithering_fragment:XR,dithering_pars_fragment:YR,roughnessmap_fragment:KR,roughnessmap_pars_fragment:ZR,shadowmap_pars_fragment:JR,shadowmap_pars_vertex:eL,shadowmap_vertex:tL,shadowmask_pars_fragment:iL,skinbase_vertex:nL,skinning_pars_vertex:rL,skinning_vertex:sL,skinnormal_vertex:aL,specularmap_fragment:oL,specularmap_pars_fragment:lL,tonemapping_fragment:cL,tonemapping_pars_fragment:hL,transmission_fragment:uL,transmission_pars_fragment:dL,uv_pars_fragment:pL,uv_pars_vertex:fL,uv_vertex:mL,worldpos_vertex:gL,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Bt={common:{diffuse:{value:new hi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ei},alphaMap:{value:null},alphaMapTransform:{value:new Ei},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ei}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ei}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ei}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ei},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ei},normalScale:{value:new yi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ei},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ei}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ei}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ei}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new hi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new hi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ei}},sprite:{diffuse:{value:new hi(16777215)},opacity:{value:1},center:{value:new yi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ei},alphaMap:{value:null},alphaTest:{value:0}}},ca={basic:{uniforms:Sr([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:wi.meshbasic_vert,fragmentShader:wi.meshbasic_frag},lambert:{uniforms:Sr([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new hi(0)}}]),vertexShader:wi.meshlambert_vert,fragmentShader:wi.meshlambert_frag},phong:{uniforms:Sr([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new hi(0)},specular:{value:new hi(1118481)},shininess:{value:30}}]),vertexShader:wi.meshphong_vert,fragmentShader:wi.meshphong_frag},standard:{uniforms:Sr([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new hi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:wi.meshphysical_vert,fragmentShader:wi.meshphysical_frag},toon:{uniforms:Sr([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new hi(0)}}]),vertexShader:wi.meshtoon_vert,fragmentShader:wi.meshtoon_frag},matcap:{uniforms:Sr([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:wi.meshmatcap_vert,fragmentShader:wi.meshmatcap_frag},points:{uniforms:Sr([Bt.points,Bt.fog]),vertexShader:wi.points_vert,fragmentShader:wi.points_frag},dashed:{uniforms:Sr([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:wi.linedashed_vert,fragmentShader:wi.linedashed_frag},depth:{uniforms:Sr([Bt.common,Bt.displacementmap]),vertexShader:wi.depth_vert,fragmentShader:wi.depth_frag},normal:{uniforms:Sr([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:wi.meshnormal_vert,fragmentShader:wi.meshnormal_frag},sprite:{uniforms:Sr([Bt.sprite,Bt.fog]),vertexShader:wi.sprite_vert,fragmentShader:wi.sprite_frag},background:{uniforms:{uvTransform:{value:new Ei},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:wi.background_vert,fragmentShader:wi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:wi.backgroundCube_vert,fragmentShader:wi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:wi.cube_vert,fragmentShader:wi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:wi.equirect_vert,fragmentShader:wi.equirect_frag},distanceRGBA:{uniforms:Sr([Bt.common,Bt.displacementmap,{referencePosition:{value:new we},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:wi.distanceRGBA_vert,fragmentShader:wi.distanceRGBA_frag},shadow:{uniforms:Sr([Bt.lights,Bt.fog,{color:{value:new hi(0)},opacity:{value:1}}]),vertexShader:wi.shadow_vert,fragmentShader:wi.shadow_frag}};ca.physical={uniforms:Sr([ca.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ei},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ei},clearcoatNormalScale:{value:new yi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ei},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ei},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ei},sheen:{value:0},sheenColor:{value:new hi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ei},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ei},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ei},transmissionSamplerSize:{value:new yi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ei},attenuationDistance:{value:0},attenuationColor:{value:new hi(0)},specularColor:{value:new hi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ei},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ei}}]),vertexShader:wi.meshphysical_vert,fragmentShader:wi.meshphysical_frag};const cf={r:0,b:0,g:0};function AL(o,e,t,i,s,c,u){const a=new hi(0);let m=c===!0?0:1,A,x,b=null,I=0,E=null;function T(P,R){let X=!1,G=R.isScene===!0?R.background:null;switch(G&&G.isTexture&&(G=(R.backgroundBlurriness>0?t:e).get(G)),G===null?U(a,m):G&&G.isColor&&(U(G,1),X=!0),o.xr.getEnvironmentBlendMode()){case"opaque":X=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,u),X=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,u),X=!0;break}(o.autoClear||X)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),G&&(G.isCubeTexture||G.mapping===Up)?(x===void 0&&(x=new oi(new Ao(1,1,1),new Xs({name:"BackgroundCubeMaterial",uniforms:Cc(ca.backgroundCube.uniforms),vertexShader:ca.backgroundCube.vertexShader,fragmentShader:ca.backgroundCube.fragmentShader,side:Gn,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),x.geometry.deleteAttribute("uv"),x.onBeforeRender=function(te,ue,_e){this.matrixWorld.copyPosition(_e.matrixWorld)},Object.defineProperty(x.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(x)),x.material.uniforms.envMap.value=G,x.material.uniforms.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,x.material.uniforms.backgroundBlurriness.value=R.backgroundBlurriness,x.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,x.material.toneMapped=G.colorSpace!==ni,(b!==G||I!==G.version||E!==o.toneMapping)&&(x.material.needsUpdate=!0,b=G,I=G.version,E=o.toneMapping),x.layers.enableAll(),P.unshift(x,x.geometry,x.material,0,0,null)):G&&G.isTexture&&(A===void 0&&(A=new oi(new ka(2,2),new Xs({name:"BackgroundMaterial",uniforms:Cc(ca.background.uniforms),vertexShader:ca.background.vertexShader,fragmentShader:ca.background.fragmentShader,side:ks,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),Object.defineProperty(A.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(A)),A.material.uniforms.t2D.value=G,A.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,A.material.toneMapped=G.colorSpace!==ni,G.matrixAutoUpdate===!0&&G.updateMatrix(),A.material.uniforms.uvTransform.value.copy(G.matrix),(b!==G||I!==G.version||E!==o.toneMapping)&&(A.material.needsUpdate=!0,b=G,I=G.version,E=o.toneMapping),A.layers.enableAll(),P.unshift(A,A.geometry,A.material,0,0,null))}function U(P,R){P.getRGB(cf,n1(o)),i.buffers.color.setClear(cf.r,cf.g,cf.b,R,u)}return{getClearColor:function(){return a},setClearColor:function(P,R=1){a.set(P),m=R,U(a,m)},getClearAlpha:function(){return m},setClearAlpha:function(P){m=P,U(a,m)},render:T}}function _L(o,e,t,i){const s=o.getParameter(o.MAX_VERTEX_ATTRIBS),c=i.isWebGL2?null:e.get("OES_vertex_array_object"),u=i.isWebGL2||c!==null,a={},m=P(null);let A=m,x=!1;function b(ve,ke,Re,Fe,Oe){let je=!1;if(u){const Je=U(Fe,Re,ke);A!==Je&&(A=Je,E(A.object)),je=R(ve,Fe,Re,Oe),je&&X(ve,Fe,Re,Oe)}else{const Je=ke.wireframe===!0;(A.geometry!==Fe.id||A.program!==Re.id||A.wireframe!==Je)&&(A.geometry=Fe.id,A.program=Re.id,A.wireframe=Je,je=!0)}Oe!==null&&t.update(Oe,o.ELEMENT_ARRAY_BUFFER),(je||x)&&(x=!1,_e(ve,ke,Re,Fe),Oe!==null&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t.get(Oe).buffer))}function I(){return i.isWebGL2?o.createVertexArray():c.createVertexArrayOES()}function E(ve){return i.isWebGL2?o.bindVertexArray(ve):c.bindVertexArrayOES(ve)}function T(ve){return i.isWebGL2?o.deleteVertexArray(ve):c.deleteVertexArrayOES(ve)}function U(ve,ke,Re){const Fe=Re.wireframe===!0;let Oe=a[ve.id];Oe===void 0&&(Oe={},a[ve.id]=Oe);let je=Oe[ke.id];je===void 0&&(je={},Oe[ke.id]=je);let Je=je[Fe];return Je===void 0&&(Je=P(I()),je[Fe]=Je),Je}function P(ve){const ke=[],Re=[],Fe=[];for(let Oe=0;Oe<s;Oe++)ke[Oe]=0,Re[Oe]=0,Fe[Oe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ke,enabledAttributes:Re,attributeDivisors:Fe,object:ve,attributes:{},index:null}}function R(ve,ke,Re,Fe){const Oe=A.attributes,je=ke.attributes;let Je=0;const _t=Re.getAttributes();for(const yt in _t)if(_t[yt].location>=0){const Ye=Oe[yt];let at=je[yt];if(at===void 0&&(yt==="instanceMatrix"&&ve.instanceMatrix&&(at=ve.instanceMatrix),yt==="instanceColor"&&ve.instanceColor&&(at=ve.instanceColor)),Ye===void 0||Ye.attribute!==at||at&&Ye.data!==at.data)return!0;Je++}return A.attributesNum!==Je||A.index!==Fe}function X(ve,ke,Re,Fe){const Oe={},je=ke.attributes;let Je=0;const _t=Re.getAttributes();for(const yt in _t)if(_t[yt].location>=0){let Ye=je[yt];Ye===void 0&&(yt==="instanceMatrix"&&ve.instanceMatrix&&(Ye=ve.instanceMatrix),yt==="instanceColor"&&ve.instanceColor&&(Ye=ve.instanceColor));const at={};at.attribute=Ye,Ye&&Ye.data&&(at.data=Ye.data),Oe[yt]=at,Je++}A.attributes=Oe,A.attributesNum=Je,A.index=Fe}function G(){const ve=A.newAttributes;for(let ke=0,Re=ve.length;ke<Re;ke++)ve[ke]=0}function J(ve){q(ve,0)}function q(ve,ke){const Re=A.newAttributes,Fe=A.enabledAttributes,Oe=A.attributeDivisors;Re[ve]=1,Fe[ve]===0&&(o.enableVertexAttribArray(ve),Fe[ve]=1),Oe[ve]!==ke&&((i.isWebGL2?o:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ve,ke),Oe[ve]=ke)}function te(){const ve=A.newAttributes,ke=A.enabledAttributes;for(let Re=0,Fe=ke.length;Re<Fe;Re++)ke[Re]!==ve[Re]&&(o.disableVertexAttribArray(Re),ke[Re]=0)}function ue(ve,ke,Re,Fe,Oe,je){i.isWebGL2===!0&&(Re===o.INT||Re===o.UNSIGNED_INT)?o.vertexAttribIPointer(ve,ke,Re,Oe,je):o.vertexAttribPointer(ve,ke,Re,Fe,Oe,je)}function _e(ve,ke,Re,Fe){if(i.isWebGL2===!1&&(ve.isInstancedMesh||Fe.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;G();const Oe=Fe.attributes,je=Re.getAttributes(),Je=ke.defaultAttributeValues;for(const _t in je){const yt=je[_t];if(yt.location>=0){let qe=Oe[_t];if(qe===void 0&&(_t==="instanceMatrix"&&ve.instanceMatrix&&(qe=ve.instanceMatrix),_t==="instanceColor"&&ve.instanceColor&&(qe=ve.instanceColor)),qe!==void 0){const Ye=qe.normalized,at=qe.itemSize,St=t.get(qe);if(St===void 0)continue;const Te=St.buffer,Kt=St.type,Zt=St.bytesPerElement;if(qe.isInterleavedBufferAttribute){const be=qe.data,$e=be.stride,fi=qe.offset;if(be.isInstancedInterleavedBuffer){for(let kt=0;kt<yt.locationSize;kt++)q(yt.location+kt,be.meshPerAttribute);ve.isInstancedMesh!==!0&&Fe._maxInstanceCount===void 0&&(Fe._maxInstanceCount=be.meshPerAttribute*be.count)}else for(let kt=0;kt<yt.locationSize;kt++)J(yt.location+kt);o.bindBuffer(o.ARRAY_BUFFER,Te);for(let kt=0;kt<yt.locationSize;kt++)ue(yt.location+kt,at/yt.locationSize,Kt,Ye,$e*Zt,(fi+at/yt.locationSize*kt)*Zt)}else{if(qe.isInstancedBufferAttribute){for(let be=0;be<yt.locationSize;be++)q(yt.location+be,qe.meshPerAttribute);ve.isInstancedMesh!==!0&&Fe._maxInstanceCount===void 0&&(Fe._maxInstanceCount=qe.meshPerAttribute*qe.count)}else for(let be=0;be<yt.locationSize;be++)J(yt.location+be);o.bindBuffer(o.ARRAY_BUFFER,Te);for(let be=0;be<yt.locationSize;be++)ue(yt.location+be,at/yt.locationSize,Kt,Ye,at*Zt,at/yt.locationSize*be*Zt)}}else if(Je!==void 0){const Ye=Je[_t];if(Ye!==void 0)switch(Ye.length){case 2:o.vertexAttrib2fv(yt.location,Ye);break;case 3:o.vertexAttrib3fv(yt.location,Ye);break;case 4:o.vertexAttrib4fv(yt.location,Ye);break;default:o.vertexAttrib1fv(yt.location,Ye)}}}}te()}function K(){Ne();for(const ve in a){const ke=a[ve];for(const Re in ke){const Fe=ke[Re];for(const Oe in Fe)T(Fe[Oe].object),delete Fe[Oe];delete ke[Re]}delete a[ve]}}function ce(ve){if(a[ve.id]===void 0)return;const ke=a[ve.id];for(const Re in ke){const Fe=ke[Re];for(const Oe in Fe)T(Fe[Oe].object),delete Fe[Oe];delete ke[Re]}delete a[ve.id]}function Ve(ve){for(const ke in a){const Re=a[ke];if(Re[ve.id]===void 0)continue;const Fe=Re[ve.id];for(const Oe in Fe)T(Fe[Oe].object),delete Fe[Oe];delete Re[ve.id]}}function Ne(){Me(),x=!0,A!==m&&(A=m,E(A.object))}function Me(){m.geometry=null,m.program=null,m.wireframe=!1}return{setup:b,reset:Ne,resetDefaultState:Me,dispose:K,releaseStatesOfGeometry:ce,releaseStatesOfProgram:Ve,initAttributes:G,enableAttribute:J,disableUnusedAttributes:te}}function yL(o,e,t,i){const s=i.isWebGL2;let c;function u(A){c=A}function a(A,x){o.drawArrays(c,A,x),t.update(x,c,1)}function m(A,x,b){if(b===0)return;let I,E;if(s)I=o,E="drawArraysInstanced";else if(I=e.get("ANGLE_instanced_arrays"),E="drawArraysInstancedANGLE",I===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}I[E](c,A,x,b),t.update(x,c,b)}this.setMode=u,this.render=a,this.renderInstances=m}function xL(o,e,t){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const ue=e.get("EXT_texture_filter_anisotropic");i=o.getParameter(ue.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function c(ue){if(ue==="highp"){if(o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.HIGH_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.HIGH_FLOAT).precision>0)return"highp";ue="mediump"}return ue==="mediump"&&o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.MEDIUM_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const u=typeof WebGL2RenderingContext<"u"&&o.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const m=c(a);m!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",m,"instead."),a=m);const A=u||e.has("WEBGL_draw_buffers"),x=t.logarithmicDepthBuffer===!0,b=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS),I=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS),E=o.getParameter(o.MAX_TEXTURE_SIZE),T=o.getParameter(o.MAX_CUBE_MAP_TEXTURE_SIZE),U=o.getParameter(o.MAX_VERTEX_ATTRIBS),P=o.getParameter(o.MAX_VERTEX_UNIFORM_VECTORS),R=o.getParameter(o.MAX_VARYING_VECTORS),X=o.getParameter(o.MAX_FRAGMENT_UNIFORM_VECTORS),G=I>0,J=u||e.has("OES_texture_float"),q=G&&J,te=u?o.getParameter(o.MAX_SAMPLES):0;return{isWebGL2:u,drawBuffers:A,getMaxAnisotropy:s,getMaxPrecision:c,precision:a,logarithmicDepthBuffer:x,maxTextures:b,maxVertexTextures:I,maxTextureSize:E,maxCubemapSize:T,maxAttributes:U,maxVertexUniforms:P,maxVaryings:R,maxFragmentUniforms:X,vertexTextures:G,floatFragmentTextures:J,floatVertexTextures:q,maxSamples:te}}function vL(o){const e=this;let t=null,i=0,s=!1,c=!1;const u=new dl,a=new Ei,m={value:null,needsUpdate:!1};this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(b,I){const E=b.length!==0||I||i!==0||s;return s=I,i=b.length,E},this.beginShadows=function(){c=!0,x(null)},this.endShadows=function(){c=!1},this.setGlobalState=function(b,I){t=x(b,I,0)},this.setState=function(b,I,E){const T=b.clippingPlanes,U=b.clipIntersection,P=b.clipShadows,R=o.get(b);if(!s||T===null||T.length===0||c&&!P)c?x(null):A();else{const X=c?0:i,G=X*4;let J=R.clippingState||null;m.value=J,J=x(T,I,G,E);for(let q=0;q!==G;++q)J[q]=t[q];R.clippingState=J,this.numIntersection=U?this.numPlanes:0,this.numPlanes+=X}};function A(){m.value!==t&&(m.value=t,m.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function x(b,I,E,T){const U=b!==null?b.length:0;let P=null;if(U!==0){if(P=m.value,T!==!0||P===null){const R=E+U*4,X=I.matrixWorldInverse;a.getNormalMatrix(X),(P===null||P.length<R)&&(P=new Float32Array(R));for(let G=0,J=E;G!==U;++G,J+=4)u.copy(b[G]).applyMatrix4(X,a),u.normal.toArray(P,J),P[J+3]=u.constant}m.value=P,m.needsUpdate=!0}return e.numPlanes=U,e.numIntersection=0,P}}function bL(o){let e=new WeakMap;function t(u,a){return a===Pp?u.mapping=nc:a===Tg&&(u.mapping=rc),u}function i(u){if(u&&u.isTexture&&u.isRenderTargetTexture===!1){const a=u.mapping;if(a===Pp||a===Tg)if(e.has(u)){const m=e.get(u).texture;return t(m,u.mapping)}else{const m=u.image;if(m&&m.height>0){const A=new uA(m.height/2);return A.fromEquirectangularTexture(o,u),e.set(u,A),u.addEventListener("dispose",s),t(A.texture,u.mapping)}else return null}}return u}function s(u){const a=u.target;a.removeEventListener("dispose",s);const m=e.get(a);m!==void 0&&(e.delete(a),m.dispose())}function c(){e=new WeakMap}return{get:i,dispose:c}}class Bc extends r1{constructor(e=-1,t=1,i=1,s=-1,c=.1,u=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=c,this.far=u,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,c,u){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=c,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let c=i-e,u=i+e,a=s+t,m=s-t;if(this.view!==null&&this.view.enabled){const A=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;c+=A*this.view.offsetX,u=c+A*this.view.width,a-=x*this.view.offsetY,m=a-x*this.view.height}this.projectionMatrix.makeOrthographic(c,u,a,m,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Rc=4,o1=[.125,.215,.35,.446,.526,.582],fl=20,fA=new Bc,l1=new hi;let mA=null;const ml=(1+Math.sqrt(5))/2,Lc=1/ml,c1=[new we(1,1,1),new we(-1,1,1),new we(1,1,-1),new we(-1,1,-1),new we(0,ml,Lc),new we(0,ml,-Lc),new we(Lc,0,ml),new we(-Lc,0,ml),new we(ml,Lc,0),new we(-ml,Lc,0)];class h1{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){mA=this._renderer.getRenderTarget(),this._setSize(256);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,i,s,c),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=p1(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=d1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(mA),e.scissorTest=!1,hf(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===nc||e.mapping===rc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),mA=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:dn,minFilter:dn,generateMipmaps:!1,type:wr,format:Rn,colorSpace:Qr,depthBuffer:!1},s=u1(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=u1(e,t,i);const{_lodMax:c}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=wL(c)),this._blurMaterial=EL(c,e,t)}return s}_compileMaterial(e){const t=new oi(this._lodPlanes[0],e);this._renderer.compile(t,fA)}_sceneToCubeUV(e,t,i,s){const a=new ir(90,1,t,i),m=[1,-1,1,1,1,1],A=[1,1,1,-1,-1,-1],x=this._renderer,b=x.autoClear,I=x.toneMapping;x.getClearColor(l1),x.toneMapping=Ns,x.autoClear=!1;const E=new js({name:"PMREM.Background",side:Gn,depthWrite:!1,depthTest:!1}),T=new oi(new Ao,E);let U=!1;const P=e.background;P?P.isColor&&(E.color.copy(P),e.background=null,U=!0):(E.color.copy(l1),U=!0);for(let R=0;R<6;R++){const X=R%3;X===0?(a.up.set(0,m[R],0),a.lookAt(A[R],0,0)):X===1?(a.up.set(0,0,m[R]),a.lookAt(0,A[R],0)):(a.up.set(0,m[R],0),a.lookAt(0,0,A[R]));const G=this._cubeSize;hf(s,X*G,R>2?G:0,G,G),x.setRenderTarget(s),U&&x.render(T,a),x.render(e,a)}T.geometry.dispose(),T.material.dispose(),x.toneMapping=I,x.autoClear=b,e.background=P}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===nc||e.mapping===rc;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=p1()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=d1());const c=s?this._cubemapMaterial:this._equirectMaterial,u=new oi(this._lodPlanes[0],c),a=c.uniforms;a.envMap.value=e;const m=this._cubeSize;hf(t,0,0,3*m,2*m),i.setRenderTarget(t),i.render(u,fA)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const c=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),u=c1[(s-1)%c1.length];this._blur(e,s-1,s,c,u)}t.autoClear=i}_blur(e,t,i,s,c){const u=this._pingPongRenderTarget;this._halfBlur(e,u,t,i,s,"latitudinal",c),this._halfBlur(u,e,i,i,s,"longitudinal",c)}_halfBlur(e,t,i,s,c,u,a){const m=this._renderer,A=this._blurMaterial;u!=="latitudinal"&&u!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const x=3,b=new oi(this._lodPlanes[s],A),I=A.uniforms,E=this._sizeLods[i]-1,T=isFinite(c)?Math.PI/(2*E):2*Math.PI/(2*fl-1),U=c/T,P=isFinite(c)?1+Math.floor(x*U):fl;P>fl&&console.warn(`sigmaRadians, ${c}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${fl}`);const R=[];let X=0;for(let ue=0;ue<fl;++ue){const _e=ue/U,K=Math.exp(-_e*_e/2);R.push(K),ue===0?X+=K:ue<P&&(X+=2*K)}for(let ue=0;ue<R.length;ue++)R[ue]=R[ue]/X;I.envMap.value=e.texture,I.samples.value=P,I.weights.value=R,I.latitudinal.value=u==="latitudinal",a&&(I.poleAxis.value=a);const{_lodMax:G}=this;I.dTheta.value=T,I.mipInt.value=G-i;const J=this._sizeLods[s],q=3*J*(s>G-Rc?s-G+Rc:0),te=4*(this._cubeSize-J);hf(t,q,te,3*J,2*J),m.setRenderTarget(t),m.render(b,fA)}}function wL(o){const e=[],t=[],i=[];let s=o;const c=o-Rc+1+o1.length;for(let u=0;u<c;u++){const a=Math.pow(2,s);t.push(a);let m=1/a;u>o-Rc?m=o1[u-o+Rc-1]:u===0&&(m=0),i.push(m);const A=1/(a-2),x=-A,b=1+A,I=[x,x,b,x,b,b,x,x,b,b,x,b],E=6,T=6,U=3,P=2,R=1,X=new Float32Array(U*T*E),G=new Float32Array(P*T*E),J=new Float32Array(R*T*E);for(let te=0;te<E;te++){const ue=te%3*2/3-1,_e=te>2?0:-1,K=[ue,_e,0,ue+2/3,_e,0,ue+2/3,_e+1,0,ue,_e,0,ue+2/3,_e+1,0,ue,_e+1,0];X.set(K,U*T*te),G.set(I,P*T*te);const ce=[te,te,te,te,te,te];J.set(ce,R*T*te)}const q=new ys;q.setAttribute("position",new pn(X,U)),q.setAttribute("uv",new pn(G,P)),q.setAttribute("faceIndex",new pn(J,R)),e.push(q),s>Rc&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function u1(o,e,t){const i=new Vs(o,e,t);return i.texture.mapping=Up,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function hf(o,e,t,i,s){o.viewport.set(e,t,i,s),o.scissor.set(e,t,i,s)}function EL(o,e,t){const i=new Float32Array(fl),s=new we(0,1,0);return new Xs({name:"SphericalGaussianBlur",defines:{n:fl,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${o}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:gA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ma,depthTest:!1,depthWrite:!1})}function d1(){return new Xs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:gA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ma,depthTest:!1,depthWrite:!1})}function p1(){return new Xs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:gA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ma,depthTest:!1,depthWrite:!1})}function gA(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function SL(o){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const m=a.mapping,A=m===Pp||m===Tg,x=m===nc||m===rc;if(A||x)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let b=e.get(a);return t===null&&(t=new h1(o)),b=A?t.fromEquirectangular(a,b):t.fromCubemap(a,b),e.set(a,b),b.texture}else{if(e.has(a))return e.get(a).texture;{const b=a.image;if(A&&b&&b.height>0||x&&b&&s(b)){t===null&&(t=new h1(o));const I=A?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,I),a.addEventListener("dispose",c),I.texture}else return null}}}return a}function s(a){let m=0;const A=6;for(let x=0;x<A;x++)a[x]!==void 0&&m++;return m===A}function c(a){const m=a.target;m.removeEventListener("dispose",c);const A=e.get(m);A!==void 0&&(e.delete(m),A.dispose())}function u(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:u}}function IL(o){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=o.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function CL(o,e,t,i){const s={},c=new WeakMap;function u(b){const I=b.target;I.index!==null&&e.remove(I.index);for(const T in I.attributes)e.remove(I.attributes[T]);I.removeEventListener("dispose",u),delete s[I.id];const E=c.get(I);E&&(e.remove(E),c.delete(I)),i.releaseStatesOfGeometry(I),I.isInstancedBufferGeometry===!0&&delete I._maxInstanceCount,t.memory.geometries--}function a(b,I){return s[I.id]===!0||(I.addEventListener("dispose",u),s[I.id]=!0,t.memory.geometries++),I}function m(b){const I=b.attributes;for(const T in I)e.update(I[T],o.ARRAY_BUFFER);const E=b.morphAttributes;for(const T in E){const U=E[T];for(let P=0,R=U.length;P<R;P++)e.update(U[P],o.ARRAY_BUFFER)}}function A(b){const I=[],E=b.index,T=b.attributes.position;let U=0;if(E!==null){const X=E.array;U=E.version;for(let G=0,J=X.length;G<J;G+=3){const q=X[G+0],te=X[G+1],ue=X[G+2];I.push(q,te,te,ue,ue,q)}}else{const X=T.array;U=T.version;for(let G=0,J=X.length/3-1;G<J;G+=3){const q=G+0,te=G+1,ue=G+2;I.push(q,te,te,ue,ue,q)}}const P=new(Uv(I)?Kv:Yv)(I,1);P.version=U;const R=c.get(b);R&&e.remove(R),c.set(b,P)}function x(b){const I=c.get(b);if(I){const E=b.index;E!==null&&I.version<E.version&&A(b)}else A(b);return c.get(b)}return{get:a,update:m,getWireframeAttribute:x}}function ML(o,e,t,i){const s=i.isWebGL2;let c;function u(I){c=I}let a,m;function A(I){a=I.type,m=I.bytesPerElement}function x(I,E){o.drawElements(c,E,a,I*m),t.update(E,c,1)}function b(I,E,T){if(T===0)return;let U,P;if(s)U=o,P="drawElementsInstanced";else if(U=e.get("ANGLE_instanced_arrays"),P="drawElementsInstancedANGLE",U===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}U[P](c,E,a,I*m,T),t.update(E,c,T)}this.setMode=u,this.setIndex=A,this.render=x,this.renderInstances=b}function TL(o){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(c,u,a){switch(t.calls++,u){case o.TRIANGLES:t.triangles+=a*(c/3);break;case o.LINES:t.lines+=a*(c/2);break;case o.LINE_STRIP:t.lines+=a*(c-1);break;case o.LINE_LOOP:t.lines+=a*c;break;case o.POINTS:t.points+=a*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",u);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function BL(o,e){return o[0]-e[0]}function RL(o,e){return Math.abs(e[1])-Math.abs(o[1])}function LL(o,e,t){const i={},s=new Float32Array(8),c=new WeakMap,u=new rn,a=[];for(let A=0;A<8;A++)a[A]=[A,0];function m(A,x,b){const I=A.morphTargetInfluences;if(e.isWebGL2===!0){const E=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=E!==void 0?E.length:0;let U=c.get(x);if(U===void 0||U.count!==T){let ve=function(){Ne.dispose(),c.delete(x),x.removeEventListener("dispose",ve)};U!==void 0&&U.texture.dispose();const X=x.morphAttributes.position!==void 0,G=x.morphAttributes.normal!==void 0,J=x.morphAttributes.color!==void 0,q=x.morphAttributes.position||[],te=x.morphAttributes.normal||[],ue=x.morphAttributes.color||[];let _e=0;X===!0&&(_e=1),G===!0&&(_e=2),J===!0&&(_e=3);let K=x.attributes.position.count*_e,ce=1;K>e.maxTextureSize&&(ce=Math.ceil(K/e.maxTextureSize),K=e.maxTextureSize);const Ve=new Float32Array(K*ce*4*T),Ne=new Nv(Ve,K,ce,T);Ne.type=br,Ne.needsUpdate=!0;const Me=_e*4;for(let ke=0;ke<T;ke++){const Re=q[ke],Fe=te[ke],Oe=ue[ke],je=K*ce*4*ke;for(let Je=0;Je<Re.count;Je++){const _t=Je*Me;X===!0&&(u.fromBufferAttribute(Re,Je),Ve[je+_t+0]=u.x,Ve[je+_t+1]=u.y,Ve[je+_t+2]=u.z,Ve[je+_t+3]=0),G===!0&&(u.fromBufferAttribute(Fe,Je),Ve[je+_t+4]=u.x,Ve[je+_t+5]=u.y,Ve[je+_t+6]=u.z,Ve[je+_t+7]=0),J===!0&&(u.fromBufferAttribute(Oe,Je),Ve[je+_t+8]=u.x,Ve[je+_t+9]=u.y,Ve[je+_t+10]=u.z,Ve[je+_t+11]=Oe.itemSize===4?u.w:1)}}U={count:T,texture:Ne,size:new yi(K,ce)},c.set(x,U),x.addEventListener("dispose",ve)}let P=0;for(let X=0;X<I.length;X++)P+=I[X];const R=x.morphTargetsRelative?1:1-P;b.getUniforms().setValue(o,"morphTargetBaseInfluence",R),b.getUniforms().setValue(o,"morphTargetInfluences",I),b.getUniforms().setValue(o,"morphTargetsTexture",U.texture,t),b.getUniforms().setValue(o,"morphTargetsTextureSize",U.size)}else{const E=I===void 0?0:I.length;let T=i[x.id];if(T===void 0||T.length!==E){T=[];for(let G=0;G<E;G++)T[G]=[G,0];i[x.id]=T}for(let G=0;G<E;G++){const J=T[G];J[0]=G,J[1]=I[G]}T.sort(RL);for(let G=0;G<8;G++)G<E&&T[G][1]?(a[G][0]=T[G][0],a[G][1]=T[G][1]):(a[G][0]=Number.MAX_SAFE_INTEGER,a[G][1]=0);a.sort(BL);const U=x.morphAttributes.position,P=x.morphAttributes.normal;let R=0;for(let G=0;G<8;G++){const J=a[G],q=J[0],te=J[1];q!==Number.MAX_SAFE_INTEGER&&te?(U&&x.getAttribute("morphTarget"+G)!==U[q]&&x.setAttribute("morphTarget"+G,U[q]),P&&x.getAttribute("morphNormal"+G)!==P[q]&&x.setAttribute("morphNormal"+G,P[q]),s[G]=te,R+=te):(U&&x.hasAttribute("morphTarget"+G)===!0&&x.deleteAttribute("morphTarget"+G),P&&x.hasAttribute("morphNormal"+G)===!0&&x.deleteAttribute("morphNormal"+G),s[G]=0)}const X=x.morphTargetsRelative?1:1-R;b.getUniforms().setValue(o,"morphTargetBaseInfluence",X),b.getUniforms().setValue(o,"morphTargetInfluences",s)}}return{update:m}}function DL(o,e,t,i){let s=new WeakMap;function c(m){const A=i.render.frame,x=m.geometry,b=e.get(m,x);return s.get(b)!==A&&(e.update(b),s.set(b,A)),m.isInstancedMesh&&(m.hasEventListener("dispose",a)===!1&&m.addEventListener("dispose",a),t.update(m.instanceMatrix,o.ARRAY_BUFFER),m.instanceColor!==null&&t.update(m.instanceColor,o.ARRAY_BUFFER)),b}function u(){s=new WeakMap}function a(m){const A=m.target;A.removeEventListener("dispose",a),t.remove(A.instanceMatrix),A.instanceColor!==null&&t.remove(A.instanceColor)}return{update:c,dispose:u}}const f1=new vn,m1=new Nv,g1=new Ov,A1=new s1,_1=[],y1=[],x1=new Float32Array(16),v1=new Float32Array(9),b1=new Float32Array(4);function Dc(o,e,t){const i=o[0];if(i<=0||i>0)return o;const s=e*t;let c=_1[s];if(c===void 0&&(c=new Float32Array(s),_1[s]=c),e!==0){i.toArray(c,0);for(let u=1,a=0;u!==e;++u)a+=t,o[u].toArray(c,a)}return c}function kn(o,e){if(o.length!==e.length)return!1;for(let t=0,i=o.length;t<i;t++)if(o[t]!==e[t])return!1;return!0}function Nn(o,e){for(let t=0,i=e.length;t<i;t++)o[t]=e[t]}function uf(o,e){let t=y1[e];t===void 0&&(t=new Int32Array(e),y1[e]=t);for(let i=0;i!==e;++i)t[i]=o.allocateTextureUnit();return t}function PL(o,e){const t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function UL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;o.uniform2fv(this.addr,e),Nn(t,e)}}function FL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(kn(t,e))return;o.uniform3fv(this.addr,e),Nn(t,e)}}function kL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;o.uniform4fv(this.addr,e),Nn(t,e)}}function NL(o,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),Nn(t,e)}else{if(kn(t,i))return;b1.set(i),o.uniformMatrix2fv(this.addr,!1,b1),Nn(t,i)}}function OL(o,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),Nn(t,e)}else{if(kn(t,i))return;v1.set(i),o.uniformMatrix3fv(this.addr,!1,v1),Nn(t,i)}}function zL(o,e){const t=this.cache,i=e.elements;if(i===void 0){if(kn(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),Nn(t,e)}else{if(kn(t,i))return;x1.set(i),o.uniformMatrix4fv(this.addr,!1,x1),Nn(t,i)}}function GL(o,e){const t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function QL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;o.uniform2iv(this.addr,e),Nn(t,e)}}function VL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kn(t,e))return;o.uniform3iv(this.addr,e),Nn(t,e)}}function HL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;o.uniform4iv(this.addr,e),Nn(t,e)}}function WL(o,e){const t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function qL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(kn(t,e))return;o.uniform2uiv(this.addr,e),Nn(t,e)}}function $L(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(kn(t,e))return;o.uniform3uiv(this.addr,e),Nn(t,e)}}function jL(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(kn(t,e))return;o.uniform4uiv(this.addr,e),Nn(t,e)}}function XL(o,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(o.uniform1i(this.addr,s),i[0]=s),t.setTexture2D(e||f1,s)}function YL(o,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(o.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||g1,s)}function KL(o,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(o.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||A1,s)}function ZL(o,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(o.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||m1,s)}function JL(o){switch(o){case 5126:return PL;case 35664:return UL;case 35665:return FL;case 35666:return kL;case 35674:return NL;case 35675:return OL;case 35676:return zL;case 5124:case 35670:return GL;case 35667:case 35671:return QL;case 35668:case 35672:return VL;case 35669:case 35673:return HL;case 5125:return WL;case 36294:return qL;case 36295:return $L;case 36296:return jL;case 35678:case 36198:case 36298:case 36306:case 35682:return XL;case 35679:case 36299:case 36307:return YL;case 35680:case 36300:case 36308:case 36293:return KL;case 36289:case 36303:case 36311:case 36292:return ZL}}function e3(o,e){o.uniform1fv(this.addr,e)}function t3(o,e){const t=Dc(e,this.size,2);o.uniform2fv(this.addr,t)}function i3(o,e){const t=Dc(e,this.size,3);o.uniform3fv(this.addr,t)}function n3(o,e){const t=Dc(e,this.size,4);o.uniform4fv(this.addr,t)}function r3(o,e){const t=Dc(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function s3(o,e){const t=Dc(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function a3(o,e){const t=Dc(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function o3(o,e){o.uniform1iv(this.addr,e)}function l3(o,e){o.uniform2iv(this.addr,e)}function c3(o,e){o.uniform3iv(this.addr,e)}function h3(o,e){o.uniform4iv(this.addr,e)}function u3(o,e){o.uniform1uiv(this.addr,e)}function d3(o,e){o.uniform2uiv(this.addr,e)}function p3(o,e){o.uniform3uiv(this.addr,e)}function f3(o,e){o.uniform4uiv(this.addr,e)}function m3(o,e,t){const i=this.cache,s=e.length,c=uf(t,s);kn(i,c)||(o.uniform1iv(this.addr,c),Nn(i,c));for(let u=0;u!==s;++u)t.setTexture2D(e[u]||f1,c[u])}function g3(o,e,t){const i=this.cache,s=e.length,c=uf(t,s);kn(i,c)||(o.uniform1iv(this.addr,c),Nn(i,c));for(let u=0;u!==s;++u)t.setTexture3D(e[u]||g1,c[u])}function A3(o,e,t){const i=this.cache,s=e.length,c=uf(t,s);kn(i,c)||(o.uniform1iv(this.addr,c),Nn(i,c));for(let u=0;u!==s;++u)t.setTextureCube(e[u]||A1,c[u])}function _3(o,e,t){const i=this.cache,s=e.length,c=uf(t,s);kn(i,c)||(o.uniform1iv(this.addr,c),Nn(i,c));for(let u=0;u!==s;++u)t.setTexture2DArray(e[u]||m1,c[u])}function y3(o){switch(o){case 5126:return e3;case 35664:return t3;case 35665:return i3;case 35666:return n3;case 35674:return r3;case 35675:return s3;case 35676:return a3;case 5124:case 35670:return o3;case 35667:case 35671:return l3;case 35668:case 35672:return c3;case 35669:case 35673:return h3;case 5125:return u3;case 36294:return d3;case 36295:return p3;case 36296:return f3;case 35678:case 36198:case 36298:case 36306:case 35682:return m3;case 35679:case 36299:case 36307:return g3;case 35680:case 36300:case 36308:case 36293:return A3;case 36289:case 36303:case 36311:case 36292:return _3}}class x3{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=JL(t.type)}}class v3{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=y3(t.type)}}class b3{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let c=0,u=s.length;c!==u;++c){const a=s[c];a.setValue(e,t[a.id],i)}}}const AA=/(\w+)(\])?(\[|\.)?/g;function w1(o,e){o.seq.push(e),o.map[e.id]=e}function w3(o,e,t){const i=o.name,s=i.length;for(AA.lastIndex=0;;){const c=AA.exec(i),u=AA.lastIndex;let a=c[1];const m=c[2]==="]",A=c[3];if(m&&(a=a|0),A===void 0||A==="["&&u+2===s){w1(t,A===void 0?new x3(a,o,e):new v3(a,o,e));break}else{let b=t.map[a];b===void 0&&(b=new b3(a),w1(t,b)),t=b}}}class df{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const c=e.getActiveUniform(t,s),u=e.getUniformLocation(t,c.name);w3(c,u,this)}}setValue(e,t,i,s){const c=this.map[t];c!==void 0&&c.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let c=0,u=t.length;c!==u;++c){const a=t[c],m=i[a.id];m.needsUpdate!==!1&&a.setValue(e,m.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,c=e.length;s!==c;++s){const u=e[s];u.id in t&&i.push(u)}return i}}function E1(o,e,t){const i=o.createShader(e);return o.shaderSource(i,t),o.compileShader(i),i}let E3=0;function S3(o,e){const t=o.split(`
`),i=[],s=Math.max(e-6,0),c=Math.min(e+6,t.length);for(let u=s;u<c;u++){const a=u+1;i.push(`${a===e?">":" "} ${a}: ${t[u]}`)}return i.join(`
`)}function I3(o){switch(o){case Qr:return["Linear","( value )"];case ni:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",o),["Linear","( value )"]}}function S1(o,e,t){const i=o.getShaderParameter(e,o.COMPILE_STATUS),s=o.getShaderInfoLog(e).trim();if(i&&s==="")return"";const c=/ERROR: 0:(\d+)/.exec(s);if(c){const u=parseInt(c[1]);return t.toUpperCase()+`

`+s+`

`+S3(o.getShaderSource(e),u)}else return s}function C3(o,e){const t=I3(e);return"vec4 "+o+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function M3(o,e){let t;switch(e){case pT:t="Linear";break;case fT:t="Reinhard";break;case mT:t="OptimizedCineon";break;case gT:t="ACESFilmic";break;case AT:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function T3(o){return[o.extensionDerivatives||!!o.envMapCubeUVHeight||o.bumpMap||o.normalMapTangentSpace||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(yu).join(`
`)}function B3(o){const e=[];for(const t in o){const i=o[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function R3(o,e){const t={},i=o.getProgramParameter(e,o.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const c=o.getActiveAttrib(e,s),u=c.name;let a=1;c.type===o.FLOAT_MAT2&&(a=2),c.type===o.FLOAT_MAT3&&(a=3),c.type===o.FLOAT_MAT4&&(a=4),t[u]={type:c.type,location:o.getAttribLocation(e,u),locationSize:a}}return t}function yu(o){return o!==""}function I1(o,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function C1(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const L3=/^[ \t]*#include +<([\w\d./]+)>/gm;function _A(o){return o.replace(L3,D3)}function D3(o,e){const t=wi[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return _A(t)}const P3=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function M1(o){return o.replace(P3,U3)}function U3(o,e,t,i){let s="";for(let c=parseInt(e);c<parseInt(t);c++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+c+" ]").replace(/UNROLLED_LOOP_INDEX/g,c);return s}function T1(o){let e="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function F3(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===Kx?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===WM?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===Ca&&(e="SHADOWMAP_TYPE_VSM"),e}function k3(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case nc:case rc:e="ENVMAP_TYPE_CUBE";break;case Up:e="ENVMAP_TYPE_CUBE_UV";break}return e}function N3(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case rc:e="ENVMAP_MODE_REFRACTION";break}return e}function O3(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case sv:e="ENVMAP_BLENDING_MULTIPLY";break;case uT:e="ENVMAP_BLENDING_MIX";break;case dT:e="ENVMAP_BLENDING_ADD";break}return e}function z3(o){const e=o.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function G3(o,e,t,i){const s=o.getContext(),c=t.defines;let u=t.vertexShader,a=t.fragmentShader;const m=F3(t),A=k3(t),x=N3(t),b=O3(t),I=z3(t),E=t.isWebGL2?"":T3(t),T=B3(c),U=s.createProgram();let P,R,X=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(P=[T].filter(yu).join(`
`),P.length>0&&(P+=`
`),R=[E,T].filter(yu).join(`
`),R.length>0&&(R+=`
`)):(P=[T1(t),"#define SHADER_NAME "+t.shaderName,T,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+x:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+m:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(yu).join(`
`),R=[E,T1(t),"#define SHADER_NAME "+t.shaderName,T,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+A:"",t.envMap?"#define "+x:"",t.envMap?"#define "+b:"",I?"#define CUBEUV_TEXEL_WIDTH "+I.texelWidth:"",I?"#define CUBEUV_TEXEL_HEIGHT "+I.texelHeight:"",I?"#define CUBEUV_MAX_MIP "+I.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+m:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ns?"#define TONE_MAPPING":"",t.toneMapping!==Ns?wi.tonemapping_pars_fragment:"",t.toneMapping!==Ns?M3("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",wi.encodings_pars_fragment,C3("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(yu).join(`
`)),u=_A(u),u=I1(u,t),u=C1(u,t),a=_A(a),a=I1(a,t),a=C1(a,t),u=M1(u),a=M1(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(X=`#version 300 es
`,P=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+P,R=["#define varying in",t.glslVersion===Rv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Rv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+R);const G=X+P+u,J=X+R+a,q=E1(s,s.VERTEX_SHADER,G),te=E1(s,s.FRAGMENT_SHADER,J);if(s.attachShader(U,q),s.attachShader(U,te),t.index0AttributeName!==void 0?s.bindAttribLocation(U,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(U,0,"position"),s.linkProgram(U),o.debug.checkShaderErrors){const K=s.getProgramInfoLog(U).trim(),ce=s.getShaderInfoLog(q).trim(),Ve=s.getShaderInfoLog(te).trim();let Ne=!0,Me=!0;if(s.getProgramParameter(U,s.LINK_STATUS)===!1)if(Ne=!1,typeof o.debug.onShaderError=="function")o.debug.onShaderError(s,U,q,te);else{const ve=S1(s,q,"vertex"),ke=S1(s,te,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(U,s.VALIDATE_STATUS)+`

Program Info Log: `+K+`
`+ve+`
`+ke)}else K!==""?console.warn("THREE.WebGLProgram: Program Info Log:",K):(ce===""||Ve==="")&&(Me=!1);Me&&(this.diagnostics={runnable:Ne,programLog:K,vertexShader:{log:ce,prefix:P},fragmentShader:{log:Ve,prefix:R}})}s.deleteShader(q),s.deleteShader(te);let ue;this.getUniforms=function(){return ue===void 0&&(ue=new df(s,U)),ue};let _e;return this.getAttributes=function(){return _e===void 0&&(_e=R3(s,U)),_e},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(U),this.program=void 0},this.name=t.shaderName,this.id=E3++,this.cacheKey=e,this.usedTimes=1,this.program=U,this.vertexShader=q,this.fragmentShader=te,this}let Q3=0;class V3{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),c=this._getShaderStage(i),u=this._getShaderCacheForMaterial(e);return u.has(s)===!1&&(u.add(s),s.usedTimes++),u.has(c)===!1&&(u.add(c),c.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new H3(e),t.set(e,i)),i}}class H3{constructor(e){this.id=Q3++,this.code=e,this.usedTimes=0}}function W3(o,e,t,i,s,c,u){const a=new iA,m=new V3,A=[],x=s.isWebGL2,b=s.logarithmicDepthBuffer,I=s.vertexTextures;let E=s.precision;const T={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function U(K){return K===1?"uv1":K===2?"uv2":K===3?"uv3":"uv"}function P(K,ce,Ve,Ne,Me){const ve=Ne.fog,ke=Me.geometry,Re=K.isMeshStandardMaterial?Ne.environment:null,Fe=(K.isMeshStandardMaterial?t:e).get(K.envMap||Re),Oe=!!Fe&&Fe.mapping===Up?Fe.image.height:null,je=T[K.type];K.precision!==null&&(E=s.getMaxPrecision(K.precision),E!==K.precision&&console.warn("THREE.WebGLProgram.getParameters:",K.precision,"not supported, using",E,"instead."));const Je=ke.morphAttributes.position||ke.morphAttributes.normal||ke.morphAttributes.color,_t=Je!==void 0?Je.length:0;let yt=0;ke.morphAttributes.position!==void 0&&(yt=1),ke.morphAttributes.normal!==void 0&&(yt=2),ke.morphAttributes.color!==void 0&&(yt=3);let qe,Ye,at,St;if(je){const ci=ca[je];qe=ci.vertexShader,Ye=ci.fragmentShader}else qe=K.vertexShader,Ye=K.fragmentShader,m.update(K),at=m.getVertexShaderID(K),St=m.getFragmentShaderID(K);const Te=o.getRenderTarget(),Kt=Me.isInstancedMesh===!0,Zt=!!K.map,be=!!K.matcap,$e=!!Fe,fi=!!K.aoMap,kt=!!K.lightMap,Dt=!!K.bumpMap,Qi=!!K.normalMap,Bi=!!K.displacementMap,Ji=!!K.emissiveMap,Ni=!!K.metalnessMap,nt=!!K.roughnessMap,Ot=K.clearcoat>0,$t=K.iridescence>0,pe=K.sheen>0,oe=K.transmission>0,Ue=Ot&&!!K.clearcoatMap,pt=Ot&&!!K.clearcoatNormalMap,ct=Ot&&!!K.clearcoatRoughnessMap,It=$t&&!!K.iridescenceMap,Xt=$t&&!!K.iridescenceThicknessMap,Ct=pe&&!!K.sheenColorMap,He=pe&&!!K.sheenRoughnessMap,qt=!!K.specularMap,Yt=!!K.specularColorMap,ei=!!K.specularIntensityMap,ft=oe&&!!K.transmissionMap,Wt=oe&&!!K.thicknessMap,mi=!!K.gradientMap,Ii=!!K.alphaMap,Ki=K.alphaTest>0,Se=!!K.extensions,Xe=!!ke.attributes.uv1,Ke=!!ke.attributes.uv2,Rt=!!ke.attributes.uv3;return{isWebGL2:x,shaderID:je,shaderName:K.type,vertexShader:qe,fragmentShader:Ye,defines:K.defines,customVertexShaderID:at,customFragmentShaderID:St,isRawShaderMaterial:K.isRawShaderMaterial===!0,glslVersion:K.glslVersion,precision:E,instancing:Kt,instancingColor:Kt&&Me.instanceColor!==null,supportsVertexTextures:I,outputColorSpace:Te===null?o.outputColorSpace:Te.isXRRenderTarget===!0?Te.texture.colorSpace:Qr,map:Zt,matcap:be,envMap:$e,envMapMode:$e&&Fe.mapping,envMapCubeUVHeight:Oe,aoMap:fi,lightMap:kt,bumpMap:Dt,normalMap:Qi,displacementMap:I&&Bi,emissiveMap:Ji,normalMapObjectSpace:Qi&&K.normalMapType===PT,normalMapTangentSpace:Qi&&K.normalMapType===Tv,metalnessMap:Ni,roughnessMap:nt,clearcoat:Ot,clearcoatMap:Ue,clearcoatNormalMap:pt,clearcoatRoughnessMap:ct,iridescence:$t,iridescenceMap:It,iridescenceThicknessMap:Xt,sheen:pe,sheenColorMap:Ct,sheenRoughnessMap:He,specularMap:qt,specularColorMap:Yt,specularIntensityMap:ei,transmission:oe,transmissionMap:ft,thicknessMap:Wt,gradientMap:mi,opaque:K.transparent===!1&&K.blending===tc,alphaMap:Ii,alphaTest:Ki,combine:K.combine,mapUv:Zt&&U(K.map.channel),aoMapUv:fi&&U(K.aoMap.channel),lightMapUv:kt&&U(K.lightMap.channel),bumpMapUv:Dt&&U(K.bumpMap.channel),normalMapUv:Qi&&U(K.normalMap.channel),displacementMapUv:Bi&&U(K.displacementMap.channel),emissiveMapUv:Ji&&U(K.emissiveMap.channel),metalnessMapUv:Ni&&U(K.metalnessMap.channel),roughnessMapUv:nt&&U(K.roughnessMap.channel),clearcoatMapUv:Ue&&U(K.clearcoatMap.channel),clearcoatNormalMapUv:pt&&U(K.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ct&&U(K.clearcoatRoughnessMap.channel),iridescenceMapUv:It&&U(K.iridescenceMap.channel),iridescenceThicknessMapUv:Xt&&U(K.iridescenceThicknessMap.channel),sheenColorMapUv:Ct&&U(K.sheenColorMap.channel),sheenRoughnessMapUv:He&&U(K.sheenRoughnessMap.channel),specularMapUv:qt&&U(K.specularMap.channel),specularColorMapUv:Yt&&U(K.specularColorMap.channel),specularIntensityMapUv:ei&&U(K.specularIntensityMap.channel),transmissionMapUv:ft&&U(K.transmissionMap.channel),thicknessMapUv:Wt&&U(K.thicknessMap.channel),alphaMapUv:Ii&&U(K.alphaMap.channel),vertexTangents:Qi&&!!ke.attributes.tangent,vertexColors:K.vertexColors,vertexAlphas:K.vertexColors===!0&&!!ke.attributes.color&&ke.attributes.color.itemSize===4,vertexUv1s:Xe,vertexUv2s:Ke,vertexUv3s:Rt,pointsUvs:Me.isPoints===!0&&!!ke.attributes.uv&&(Zt||Ii),fog:!!ve,useFog:K.fog===!0,fogExp2:ve&&ve.isFogExp2,flatShading:K.flatShading===!0,sizeAttenuation:K.sizeAttenuation===!0,logarithmicDepthBuffer:b,skinning:Me.isSkinnedMesh===!0,morphTargets:ke.morphAttributes.position!==void 0,morphNormals:ke.morphAttributes.normal!==void 0,morphColors:ke.morphAttributes.color!==void 0,morphTargetsCount:_t,morphTextureStride:yt,numDirLights:ce.directional.length,numPointLights:ce.point.length,numSpotLights:ce.spot.length,numSpotLightMaps:ce.spotLightMap.length,numRectAreaLights:ce.rectArea.length,numHemiLights:ce.hemi.length,numDirLightShadows:ce.directionalShadowMap.length,numPointLightShadows:ce.pointShadowMap.length,numSpotLightShadows:ce.spotShadowMap.length,numSpotLightShadowsWithMaps:ce.numSpotLightShadowsWithMaps,numClippingPlanes:u.numPlanes,numClipIntersection:u.numIntersection,dithering:K.dithering,shadowMapEnabled:o.shadowMap.enabled&&Ve.length>0,shadowMapType:o.shadowMap.type,toneMapping:K.toneMapped?o.toneMapping:Ns,useLegacyLights:o.useLegacyLights,premultipliedAlpha:K.premultipliedAlpha,doubleSided:K.side===er,flipSided:K.side===Gn,useDepthPacking:K.depthPacking>=0,depthPacking:K.depthPacking||0,index0AttributeName:K.index0AttributeName,extensionDerivatives:Se&&K.extensions.derivatives===!0,extensionFragDepth:Se&&K.extensions.fragDepth===!0,extensionDrawBuffers:Se&&K.extensions.drawBuffers===!0,extensionShaderTextureLOD:Se&&K.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:x||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:x||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:x||i.has("EXT_shader_texture_lod"),customProgramCacheKey:K.customProgramCacheKey()}}function R(K){const ce=[];if(K.shaderID?ce.push(K.shaderID):(ce.push(K.customVertexShaderID),ce.push(K.customFragmentShaderID)),K.defines!==void 0)for(const Ve in K.defines)ce.push(Ve),ce.push(K.defines[Ve]);return K.isRawShaderMaterial===!1&&(X(ce,K),G(ce,K),ce.push(o.outputColorSpace)),ce.push(K.customProgramCacheKey),ce.join()}function X(K,ce){K.push(ce.precision),K.push(ce.outputColorSpace),K.push(ce.envMapMode),K.push(ce.envMapCubeUVHeight),K.push(ce.mapUv),K.push(ce.alphaMapUv),K.push(ce.lightMapUv),K.push(ce.aoMapUv),K.push(ce.bumpMapUv),K.push(ce.normalMapUv),K.push(ce.displacementMapUv),K.push(ce.emissiveMapUv),K.push(ce.metalnessMapUv),K.push(ce.roughnessMapUv),K.push(ce.clearcoatMapUv),K.push(ce.clearcoatNormalMapUv),K.push(ce.clearcoatRoughnessMapUv),K.push(ce.iridescenceMapUv),K.push(ce.iridescenceThicknessMapUv),K.push(ce.sheenColorMapUv),K.push(ce.sheenRoughnessMapUv),K.push(ce.specularMapUv),K.push(ce.specularColorMapUv),K.push(ce.specularIntensityMapUv),K.push(ce.transmissionMapUv),K.push(ce.thicknessMapUv),K.push(ce.combine),K.push(ce.fogExp2),K.push(ce.sizeAttenuation),K.push(ce.morphTargetsCount),K.push(ce.morphAttributeCount),K.push(ce.numDirLights),K.push(ce.numPointLights),K.push(ce.numSpotLights),K.push(ce.numSpotLightMaps),K.push(ce.numHemiLights),K.push(ce.numRectAreaLights),K.push(ce.numDirLightShadows),K.push(ce.numPointLightShadows),K.push(ce.numSpotLightShadows),K.push(ce.numSpotLightShadowsWithMaps),K.push(ce.shadowMapType),K.push(ce.toneMapping),K.push(ce.numClippingPlanes),K.push(ce.numClipIntersection),K.push(ce.depthPacking)}function G(K,ce){a.disableAll(),ce.isWebGL2&&a.enable(0),ce.supportsVertexTextures&&a.enable(1),ce.instancing&&a.enable(2),ce.instancingColor&&a.enable(3),ce.matcap&&a.enable(4),ce.envMap&&a.enable(5),ce.normalMapObjectSpace&&a.enable(6),ce.normalMapTangentSpace&&a.enable(7),ce.clearcoat&&a.enable(8),ce.iridescence&&a.enable(9),ce.alphaTest&&a.enable(10),ce.vertexColors&&a.enable(11),ce.vertexAlphas&&a.enable(12),ce.vertexUv1s&&a.enable(13),ce.vertexUv2s&&a.enable(14),ce.vertexUv3s&&a.enable(15),ce.vertexTangents&&a.enable(16),K.push(a.mask),a.disableAll(),ce.fog&&a.enable(0),ce.useFog&&a.enable(1),ce.flatShading&&a.enable(2),ce.logarithmicDepthBuffer&&a.enable(3),ce.skinning&&a.enable(4),ce.morphTargets&&a.enable(5),ce.morphNormals&&a.enable(6),ce.morphColors&&a.enable(7),ce.premultipliedAlpha&&a.enable(8),ce.shadowMapEnabled&&a.enable(9),ce.useLegacyLights&&a.enable(10),ce.doubleSided&&a.enable(11),ce.flipSided&&a.enable(12),ce.useDepthPacking&&a.enable(13),ce.dithering&&a.enable(14),ce.transmission&&a.enable(15),ce.sheen&&a.enable(16),ce.opaque&&a.enable(17),ce.pointsUvs&&a.enable(18),K.push(a.mask)}function J(K){const ce=T[K.type];let Ve;if(ce){const Ne=ca[ce];Ve=gB.clone(Ne.uniforms)}else Ve=K.uniforms;return Ve}function q(K,ce){let Ve;for(let Ne=0,Me=A.length;Ne<Me;Ne++){const ve=A[Ne];if(ve.cacheKey===ce){Ve=ve,++Ve.usedTimes;break}}return Ve===void 0&&(Ve=new G3(o,ce,K,c),A.push(Ve)),Ve}function te(K){if(--K.usedTimes===0){const ce=A.indexOf(K);A[ce]=A[A.length-1],A.pop(),K.destroy()}}function ue(K){m.remove(K)}function _e(){m.dispose()}return{getParameters:P,getProgramCacheKey:R,getUniforms:J,acquireProgram:q,releaseProgram:te,releaseShaderCache:ue,programs:A,dispose:_e}}function q3(){let o=new WeakMap;function e(c){let u=o.get(c);return u===void 0&&(u={},o.set(c,u)),u}function t(c){o.delete(c)}function i(c,u,a){o.get(c)[u]=a}function s(){o=new WeakMap}return{get:e,remove:t,update:i,dispose:s}}function $3(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function B1(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function R1(){const o=[];let e=0;const t=[],i=[],s=[];function c(){e=0,t.length=0,i.length=0,s.length=0}function u(b,I,E,T,U,P){let R=o[e];return R===void 0?(R={id:b.id,object:b,geometry:I,material:E,groupOrder:T,renderOrder:b.renderOrder,z:U,group:P},o[e]=R):(R.id=b.id,R.object=b,R.geometry=I,R.material=E,R.groupOrder=T,R.renderOrder=b.renderOrder,R.z=U,R.group=P),e++,R}function a(b,I,E,T,U,P){const R=u(b,I,E,T,U,P);E.transmission>0?i.push(R):E.transparent===!0?s.push(R):t.push(R)}function m(b,I,E,T,U,P){const R=u(b,I,E,T,U,P);E.transmission>0?i.unshift(R):E.transparent===!0?s.unshift(R):t.unshift(R)}function A(b,I){t.length>1&&t.sort(b||$3),i.length>1&&i.sort(I||B1),s.length>1&&s.sort(I||B1)}function x(){for(let b=e,I=o.length;b<I;b++){const E=o[b];if(E.id===null)break;E.id=null,E.object=null,E.geometry=null,E.material=null,E.group=null}}return{opaque:t,transmissive:i,transparent:s,init:c,push:a,unshift:m,finish:x,sort:A}}function j3(){let o=new WeakMap;function e(i,s){const c=o.get(i);let u;return c===void 0?(u=new R1,o.set(i,[u])):s>=c.length?(u=new R1,c.push(u)):u=c[s],u}function t(){o=new WeakMap}return{get:e,dispose:t}}function X3(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new we,color:new hi};break;case"SpotLight":t={position:new we,direction:new we,color:new hi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new we,color:new hi,distance:0,decay:0};break;case"HemisphereLight":t={direction:new we,skyColor:new hi,groundColor:new hi};break;case"RectAreaLight":t={color:new hi,position:new we,halfWidth:new we,halfHeight:new we};break}return o[e.id]=t,t}}}function Y3(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yi};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yi};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yi,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}let K3=0;function Z3(o,e){return(e.castShadow?2:0)-(o.castShadow?2:0)+(e.map?1:0)-(o.map?1:0)}function J3(o,e){const t=new X3,i=Y3(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let x=0;x<9;x++)s.probe.push(new we);const c=new we,u=new pi,a=new pi;function m(x,b){let I=0,E=0,T=0;for(let Ve=0;Ve<9;Ve++)s.probe[Ve].set(0,0,0);let U=0,P=0,R=0,X=0,G=0,J=0,q=0,te=0,ue=0,_e=0;x.sort(Z3);const K=b===!0?Math.PI:1;for(let Ve=0,Ne=x.length;Ve<Ne;Ve++){const Me=x[Ve],ve=Me.color,ke=Me.intensity,Re=Me.distance,Fe=Me.shadow&&Me.shadow.map?Me.shadow.map.texture:null;if(Me.isAmbientLight)I+=ve.r*ke*K,E+=ve.g*ke*K,T+=ve.b*ke*K;else if(Me.isLightProbe)for(let Oe=0;Oe<9;Oe++)s.probe[Oe].addScaledVector(Me.sh.coefficients[Oe],ke);else if(Me.isDirectionalLight){const Oe=t.get(Me);if(Oe.color.copy(Me.color).multiplyScalar(Me.intensity*K),Me.castShadow){const je=Me.shadow,Je=i.get(Me);Je.shadowBias=je.bias,Je.shadowNormalBias=je.normalBias,Je.shadowRadius=je.radius,Je.shadowMapSize=je.mapSize,s.directionalShadow[U]=Je,s.directionalShadowMap[U]=Fe,s.directionalShadowMatrix[U]=Me.shadow.matrix,J++}s.directional[U]=Oe,U++}else if(Me.isSpotLight){const Oe=t.get(Me);Oe.position.setFromMatrixPosition(Me.matrixWorld),Oe.color.copy(ve).multiplyScalar(ke*K),Oe.distance=Re,Oe.coneCos=Math.cos(Me.angle),Oe.penumbraCos=Math.cos(Me.angle*(1-Me.penumbra)),Oe.decay=Me.decay,s.spot[R]=Oe;const je=Me.shadow;if(Me.map&&(s.spotLightMap[ue]=Me.map,ue++,je.updateMatrices(Me),Me.castShadow&&_e++),s.spotLightMatrix[R]=je.matrix,Me.castShadow){const Je=i.get(Me);Je.shadowBias=je.bias,Je.shadowNormalBias=je.normalBias,Je.shadowRadius=je.radius,Je.shadowMapSize=je.mapSize,s.spotShadow[R]=Je,s.spotShadowMap[R]=Fe,te++}R++}else if(Me.isRectAreaLight){const Oe=t.get(Me);Oe.color.copy(ve).multiplyScalar(ke),Oe.halfWidth.set(Me.width*.5,0,0),Oe.halfHeight.set(0,Me.height*.5,0),s.rectArea[X]=Oe,X++}else if(Me.isPointLight){const Oe=t.get(Me);if(Oe.color.copy(Me.color).multiplyScalar(Me.intensity*K),Oe.distance=Me.distance,Oe.decay=Me.decay,Me.castShadow){const je=Me.shadow,Je=i.get(Me);Je.shadowBias=je.bias,Je.shadowNormalBias=je.normalBias,Je.shadowRadius=je.radius,Je.shadowMapSize=je.mapSize,Je.shadowCameraNear=je.camera.near,Je.shadowCameraFar=je.camera.far,s.pointShadow[P]=Je,s.pointShadowMap[P]=Fe,s.pointShadowMatrix[P]=Me.shadow.matrix,q++}s.point[P]=Oe,P++}else if(Me.isHemisphereLight){const Oe=t.get(Me);Oe.skyColor.copy(Me.color).multiplyScalar(ke*K),Oe.groundColor.copy(Me.groundColor).multiplyScalar(ke*K),s.hemi[G]=Oe,G++}}X>0&&(e.isWebGL2||o.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Bt.LTC_FLOAT_1,s.rectAreaLTC2=Bt.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Bt.LTC_HALF_1,s.rectAreaLTC2=Bt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=I,s.ambient[1]=E,s.ambient[2]=T;const ce=s.hash;(ce.directionalLength!==U||ce.pointLength!==P||ce.spotLength!==R||ce.rectAreaLength!==X||ce.hemiLength!==G||ce.numDirectionalShadows!==J||ce.numPointShadows!==q||ce.numSpotShadows!==te||ce.numSpotMaps!==ue)&&(s.directional.length=U,s.spot.length=R,s.rectArea.length=X,s.point.length=P,s.hemi.length=G,s.directionalShadow.length=J,s.directionalShadowMap.length=J,s.pointShadow.length=q,s.pointShadowMap.length=q,s.spotShadow.length=te,s.spotShadowMap.length=te,s.directionalShadowMatrix.length=J,s.pointShadowMatrix.length=q,s.spotLightMatrix.length=te+ue-_e,s.spotLightMap.length=ue,s.numSpotLightShadowsWithMaps=_e,ce.directionalLength=U,ce.pointLength=P,ce.spotLength=R,ce.rectAreaLength=X,ce.hemiLength=G,ce.numDirectionalShadows=J,ce.numPointShadows=q,ce.numSpotShadows=te,ce.numSpotMaps=ue,s.version=K3++)}function A(x,b){let I=0,E=0,T=0,U=0,P=0;const R=b.matrixWorldInverse;for(let X=0,G=x.length;X<G;X++){const J=x[X];if(J.isDirectionalLight){const q=s.directional[I];q.direction.setFromMatrixPosition(J.matrixWorld),c.setFromMatrixPosition(J.target.matrixWorld),q.direction.sub(c),q.direction.transformDirection(R),I++}else if(J.isSpotLight){const q=s.spot[T];q.position.setFromMatrixPosition(J.matrixWorld),q.position.applyMatrix4(R),q.direction.setFromMatrixPosition(J.matrixWorld),c.setFromMatrixPosition(J.target.matrixWorld),q.direction.sub(c),q.direction.transformDirection(R),T++}else if(J.isRectAreaLight){const q=s.rectArea[U];q.position.setFromMatrixPosition(J.matrixWorld),q.position.applyMatrix4(R),a.identity(),u.copy(J.matrixWorld),u.premultiply(R),a.extractRotation(u),q.halfWidth.set(J.width*.5,0,0),q.halfHeight.set(0,J.height*.5,0),q.halfWidth.applyMatrix4(a),q.halfHeight.applyMatrix4(a),U++}else if(J.isPointLight){const q=s.point[E];q.position.setFromMatrixPosition(J.matrixWorld),q.position.applyMatrix4(R),E++}else if(J.isHemisphereLight){const q=s.hemi[P];q.direction.setFromMatrixPosition(J.matrixWorld),q.direction.transformDirection(R),P++}}}return{setup:m,setupView:A,state:s}}function L1(o,e){const t=new J3(o,e),i=[],s=[];function c(){i.length=0,s.length=0}function u(b){i.push(b)}function a(b){s.push(b)}function m(b){t.setup(i,b)}function A(b){t.setupView(i,b)}return{init:c,state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:m,setupLightsView:A,pushLight:u,pushShadow:a}}function eD(o,e){let t=new WeakMap;function i(c,u=0){const a=t.get(c);let m;return a===void 0?(m=new L1(o,e),t.set(c,[m])):u>=a.length?(m=new L1(o,e),a.push(m)):m=a[u],m}function s(){t=new WeakMap}return{get:i,dispose:s}}class D1 extends qs{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=LT,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class tD extends qs{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const iD=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,nD=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function rD(o,e,t){let i=new pA;const s=new yi,c=new yi,u=new rn,a=new D1({depthPacking:DT}),m=new tD,A={},x=t.maxTextureSize,b={[ks]:Gn,[Gn]:ks,[er]:er},I=new Xs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yi},radius:{value:4}},vertexShader:iD,fragmentShader:nD}),E=I.clone();E.defines.HORIZONTAL_PASS=1;const T=new ys;T.setAttribute("position",new pn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const U=new oi(T,I),P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Kx;let R=this.type;this.render=function(q,te,ue){if(P.enabled===!1||P.autoUpdate===!1&&P.needsUpdate===!1||q.length===0)return;const _e=o.getRenderTarget(),K=o.getActiveCubeFace(),ce=o.getActiveMipmapLevel(),Ve=o.state;Ve.setBlending(Ma),Ve.buffers.color.setClear(1,1,1,1),Ve.buffers.depth.setTest(!0),Ve.setScissorTest(!1);const Ne=R!==Ca&&this.type===Ca,Me=R===Ca&&this.type!==Ca;for(let ve=0,ke=q.length;ve<ke;ve++){const Re=q[ve],Fe=Re.shadow;if(Fe===void 0){console.warn("THREE.WebGLShadowMap:",Re,"has no shadow.");continue}if(Fe.autoUpdate===!1&&Fe.needsUpdate===!1)continue;s.copy(Fe.mapSize);const Oe=Fe.getFrameExtents();if(s.multiply(Oe),c.copy(Fe.mapSize),(s.x>x||s.y>x)&&(s.x>x&&(c.x=Math.floor(x/Oe.x),s.x=c.x*Oe.x,Fe.mapSize.x=c.x),s.y>x&&(c.y=Math.floor(x/Oe.y),s.y=c.y*Oe.y,Fe.mapSize.y=c.y)),Fe.map===null||Ne===!0||Me===!0){const Je=this.type!==Ca?{minFilter:Pn,magFilter:Pn}:{};Fe.map!==null&&Fe.map.dispose(),Fe.map=new Vs(s.x,s.y,Je),Fe.map.texture.name=Re.name+".shadowMap",Fe.camera.updateProjectionMatrix()}o.setRenderTarget(Fe.map),o.clear();const je=Fe.getViewportCount();for(let Je=0;Je<je;Je++){const _t=Fe.getViewport(Je);u.set(c.x*_t.x,c.y*_t.y,c.x*_t.z,c.y*_t.w),Ve.viewport(u),Fe.updateMatrices(Re,Je),i=Fe.getFrustum(),J(te,ue,Fe.camera,Re,this.type)}Fe.isPointLightShadow!==!0&&this.type===Ca&&X(Fe,ue),Fe.needsUpdate=!1}R=this.type,P.needsUpdate=!1,o.setRenderTarget(_e,K,ce)};function X(q,te){const ue=e.update(U);I.defines.VSM_SAMPLES!==q.blurSamples&&(I.defines.VSM_SAMPLES=q.blurSamples,E.defines.VSM_SAMPLES=q.blurSamples,I.needsUpdate=!0,E.needsUpdate=!0),q.mapPass===null&&(q.mapPass=new Vs(s.x,s.y)),I.uniforms.shadow_pass.value=q.map.texture,I.uniforms.resolution.value=q.mapSize,I.uniforms.radius.value=q.radius,o.setRenderTarget(q.mapPass),o.clear(),o.renderBufferDirect(te,null,ue,I,U,null),E.uniforms.shadow_pass.value=q.mapPass.texture,E.uniforms.resolution.value=q.mapSize,E.uniforms.radius.value=q.radius,o.setRenderTarget(q.map),o.clear(),o.renderBufferDirect(te,null,ue,E,U,null)}function G(q,te,ue,_e){let K=null;const ce=ue.isPointLight===!0?q.customDistanceMaterial:q.customDepthMaterial;if(ce!==void 0)K=ce;else if(K=ue.isPointLight===!0?m:a,o.localClippingEnabled&&te.clipShadows===!0&&Array.isArray(te.clippingPlanes)&&te.clippingPlanes.length!==0||te.displacementMap&&te.displacementScale!==0||te.alphaMap&&te.alphaTest>0||te.map&&te.alphaTest>0){const Ve=K.uuid,Ne=te.uuid;let Me=A[Ve];Me===void 0&&(Me={},A[Ve]=Me);let ve=Me[Ne];ve===void 0&&(ve=K.clone(),Me[Ne]=ve),K=ve}if(K.visible=te.visible,K.wireframe=te.wireframe,_e===Ca?K.side=te.shadowSide!==null?te.shadowSide:te.side:K.side=te.shadowSide!==null?te.shadowSide:b[te.side],K.alphaMap=te.alphaMap,K.alphaTest=te.alphaTest,K.map=te.map,K.clipShadows=te.clipShadows,K.clippingPlanes=te.clippingPlanes,K.clipIntersection=te.clipIntersection,K.displacementMap=te.displacementMap,K.displacementScale=te.displacementScale,K.displacementBias=te.displacementBias,K.wireframeLinewidth=te.wireframeLinewidth,K.linewidth=te.linewidth,ue.isPointLight===!0&&K.isMeshDistanceMaterial===!0){const Ve=o.properties.get(K);Ve.light=ue}return K}function J(q,te,ue,_e,K){if(q.visible===!1)return;if(q.layers.test(te.layers)&&(q.isMesh||q.isLine||q.isPoints)&&(q.castShadow||q.receiveShadow&&K===Ca)&&(!q.frustumCulled||i.intersectsObject(q))){q.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,q.matrixWorld);const Ne=e.update(q),Me=q.material;if(Array.isArray(Me)){const ve=Ne.groups;for(let ke=0,Re=ve.length;ke<Re;ke++){const Fe=ve[ke],Oe=Me[Fe.materialIndex];if(Oe&&Oe.visible){const je=G(q,Oe,_e,K);o.renderBufferDirect(ue,null,Ne,je,q,Fe)}}}else if(Me.visible){const ve=G(q,Me,_e,K);o.renderBufferDirect(ue,null,Ne,ve,q,null)}}const Ve=q.children;for(let Ne=0,Me=Ve.length;Ne<Me;Ne++)J(Ve[Ne],te,ue,_e,K)}}function sD(o,e,t){const i=t.isWebGL2;function s(){let Se=!1;const Xe=new rn;let Ke=null;const Rt=new rn(0,0,0,0);return{setMask:function(Nt){Ke!==Nt&&!Se&&(o.colorMask(Nt,Nt,Nt,Nt),Ke=Nt)},setLocked:function(Nt){Se=Nt},setClear:function(Nt,ci,li,ki,hn){hn===!0&&(Nt*=ki,ci*=ki,li*=ki),Xe.set(Nt,ci,li,ki),Rt.equals(Xe)===!1&&(o.clearColor(Nt,ci,li,ki),Rt.copy(Xe))},reset:function(){Se=!1,Ke=null,Rt.set(-1,0,0,0)}}}function c(){let Se=!1,Xe=null,Ke=null,Rt=null;return{setTest:function(Nt){Nt?Te(o.DEPTH_TEST):Kt(o.DEPTH_TEST)},setMask:function(Nt){Xe!==Nt&&!Se&&(o.depthMask(Nt),Xe=Nt)},setFunc:function(Nt){if(Ke!==Nt){switch(Nt){case rT:o.depthFunc(o.NEVER);break;case sT:o.depthFunc(o.ALWAYS);break;case aT:o.depthFunc(o.LESS);break;case Mg:o.depthFunc(o.LEQUAL);break;case oT:o.depthFunc(o.EQUAL);break;case lT:o.depthFunc(o.GEQUAL);break;case cT:o.depthFunc(o.GREATER);break;case hT:o.depthFunc(o.NOTEQUAL);break;default:o.depthFunc(o.LEQUAL)}Ke=Nt}},setLocked:function(Nt){Se=Nt},setClear:function(Nt){Rt!==Nt&&(o.clearDepth(Nt),Rt=Nt)},reset:function(){Se=!1,Xe=null,Ke=null,Rt=null}}}function u(){let Se=!1,Xe=null,Ke=null,Rt=null,Nt=null,ci=null,li=null,ki=null,hn=null;return{setTest:function(Oi){Se||(Oi?Te(o.STENCIL_TEST):Kt(o.STENCIL_TEST))},setMask:function(Oi){Xe!==Oi&&!Se&&(o.stencilMask(Oi),Xe=Oi)},setFunc:function(Oi,ie,V){(Ke!==Oi||Rt!==ie||Nt!==V)&&(o.stencilFunc(Oi,ie,V),Ke=Oi,Rt=ie,Nt=V)},setOp:function(Oi,ie,V){(ci!==Oi||li!==ie||ki!==V)&&(o.stencilOp(Oi,ie,V),ci=Oi,li=ie,ki=V)},setLocked:function(Oi){Se=Oi},setClear:function(Oi){hn!==Oi&&(o.clearStencil(Oi),hn=Oi)},reset:function(){Se=!1,Xe=null,Ke=null,Rt=null,Nt=null,ci=null,li=null,ki=null,hn=null}}}const a=new s,m=new c,A=new u,x=new WeakMap,b=new WeakMap;let I={},E={},T=new WeakMap,U=[],P=null,R=!1,X=null,G=null,J=null,q=null,te=null,ue=null,_e=null,K=!1,ce=null,Ve=null,Ne=null,Me=null,ve=null;const ke=o.getParameter(o.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Re=!1,Fe=0;const Oe=o.getParameter(o.VERSION);Oe.indexOf("WebGL")!==-1?(Fe=parseFloat(/^WebGL (\d)/.exec(Oe)[1]),Re=Fe>=1):Oe.indexOf("OpenGL ES")!==-1&&(Fe=parseFloat(/^OpenGL ES (\d)/.exec(Oe)[1]),Re=Fe>=2);let je=null,Je={};const _t=o.getParameter(o.SCISSOR_BOX),yt=o.getParameter(o.VIEWPORT),qe=new rn().fromArray(_t),Ye=new rn().fromArray(yt);function at(Se,Xe,Ke,Rt){const Nt=new Uint8Array(4),ci=o.createTexture();o.bindTexture(Se,ci),o.texParameteri(Se,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(Se,o.TEXTURE_MAG_FILTER,o.NEAREST);for(let li=0;li<Ke;li++)i&&(Se===o.TEXTURE_3D||Se===o.TEXTURE_2D_ARRAY)?o.texImage3D(Xe,0,o.RGBA,1,1,Rt,0,o.RGBA,o.UNSIGNED_BYTE,Nt):o.texImage2D(Xe+li,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,Nt);return ci}const St={};St[o.TEXTURE_2D]=at(o.TEXTURE_2D,o.TEXTURE_2D,1),St[o.TEXTURE_CUBE_MAP]=at(o.TEXTURE_CUBE_MAP,o.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(St[o.TEXTURE_2D_ARRAY]=at(o.TEXTURE_2D_ARRAY,o.TEXTURE_2D_ARRAY,1,1),St[o.TEXTURE_3D]=at(o.TEXTURE_3D,o.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),m.setClear(1),A.setClear(0),Te(o.DEPTH_TEST),m.setFunc(Mg),Bi(!1),Ji(Yx),Te(o.CULL_FACE),Dt(Ma);function Te(Se){I[Se]!==!0&&(o.enable(Se),I[Se]=!0)}function Kt(Se){I[Se]!==!1&&(o.disable(Se),I[Se]=!1)}function Zt(Se,Xe){return E[Se]!==Xe?(o.bindFramebuffer(Se,Xe),E[Se]=Xe,i&&(Se===o.DRAW_FRAMEBUFFER&&(E[o.FRAMEBUFFER]=Xe),Se===o.FRAMEBUFFER&&(E[o.DRAW_FRAMEBUFFER]=Xe)),!0):!1}function be(Se,Xe){let Ke=U,Rt=!1;if(Se)if(Ke=T.get(Xe),Ke===void 0&&(Ke=[],T.set(Xe,Ke)),Se.isWebGLMultipleRenderTargets){const Nt=Se.texture;if(Ke.length!==Nt.length||Ke[0]!==o.COLOR_ATTACHMENT0){for(let ci=0,li=Nt.length;ci<li;ci++)Ke[ci]=o.COLOR_ATTACHMENT0+ci;Ke.length=Nt.length,Rt=!0}}else Ke[0]!==o.COLOR_ATTACHMENT0&&(Ke[0]=o.COLOR_ATTACHMENT0,Rt=!0);else Ke[0]!==o.BACK&&(Ke[0]=o.BACK,Rt=!0);Rt&&(t.isWebGL2?o.drawBuffers(Ke):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ke))}function $e(Se){return P!==Se?(o.useProgram(Se),P=Se,!0):!1}const fi={[ic]:o.FUNC_ADD,[$M]:o.FUNC_SUBTRACT,[jM]:o.FUNC_REVERSE_SUBTRACT};if(i)fi[tv]=o.MIN,fi[iv]=o.MAX;else{const Se=e.get("EXT_blend_minmax");Se!==null&&(fi[tv]=Se.MIN_EXT,fi[iv]=Se.MAX_EXT)}const kt={[XM]:o.ZERO,[YM]:o.ONE,[KM]:o.SRC_COLOR,[nv]:o.SRC_ALPHA,[nT]:o.SRC_ALPHA_SATURATE,[tT]:o.DST_COLOR,[JM]:o.DST_ALPHA,[ZM]:o.ONE_MINUS_SRC_COLOR,[rv]:o.ONE_MINUS_SRC_ALPHA,[iT]:o.ONE_MINUS_DST_COLOR,[eT]:o.ONE_MINUS_DST_ALPHA};function Dt(Se,Xe,Ke,Rt,Nt,ci,li,ki){if(Se===Ma){R===!0&&(Kt(o.BLEND),R=!1);return}if(R===!1&&(Te(o.BLEND),R=!0),Se!==qM){if(Se!==X||ki!==K){if((G!==ic||te!==ic)&&(o.blendEquation(o.FUNC_ADD),G=ic,te=ic),ki)switch(Se){case tc:o.blendFuncSeparate(o.ONE,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case Zx:o.blendFunc(o.ONE,o.ONE);break;case Jx:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case ev:o.blendFuncSeparate(o.ZERO,o.SRC_COLOR,o.ZERO,o.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Se);break}else switch(Se){case tc:o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case Zx:o.blendFunc(o.SRC_ALPHA,o.ONE);break;case Jx:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case ev:o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Se);break}J=null,q=null,ue=null,_e=null,X=Se,K=ki}return}Nt=Nt||Xe,ci=ci||Ke,li=li||Rt,(Xe!==G||Nt!==te)&&(o.blendEquationSeparate(fi[Xe],fi[Nt]),G=Xe,te=Nt),(Ke!==J||Rt!==q||ci!==ue||li!==_e)&&(o.blendFuncSeparate(kt[Ke],kt[Rt],kt[ci],kt[li]),J=Ke,q=Rt,ue=ci,_e=li),X=Se,K=!1}function Qi(Se,Xe){Se.side===er?Kt(o.CULL_FACE):Te(o.CULL_FACE);let Ke=Se.side===Gn;Xe&&(Ke=!Ke),Bi(Ke),Se.blending===tc&&Se.transparent===!1?Dt(Ma):Dt(Se.blending,Se.blendEquation,Se.blendSrc,Se.blendDst,Se.blendEquationAlpha,Se.blendSrcAlpha,Se.blendDstAlpha,Se.premultipliedAlpha),m.setFunc(Se.depthFunc),m.setTest(Se.depthTest),m.setMask(Se.depthWrite),a.setMask(Se.colorWrite);const Rt=Se.stencilWrite;A.setTest(Rt),Rt&&(A.setMask(Se.stencilWriteMask),A.setFunc(Se.stencilFunc,Se.stencilRef,Se.stencilFuncMask),A.setOp(Se.stencilFail,Se.stencilZFail,Se.stencilZPass)),nt(Se.polygonOffset,Se.polygonOffsetFactor,Se.polygonOffsetUnits),Se.alphaToCoverage===!0?Te(o.SAMPLE_ALPHA_TO_COVERAGE):Kt(o.SAMPLE_ALPHA_TO_COVERAGE)}function Bi(Se){ce!==Se&&(Se?o.frontFace(o.CW):o.frontFace(o.CCW),ce=Se)}function Ji(Se){Se!==VM?(Te(o.CULL_FACE),Se!==Ve&&(Se===Yx?o.cullFace(o.BACK):Se===HM?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK))):Kt(o.CULL_FACE),Ve=Se}function Ni(Se){Se!==Ne&&(Re&&o.lineWidth(Se),Ne=Se)}function nt(Se,Xe,Ke){Se?(Te(o.POLYGON_OFFSET_FILL),(Me!==Xe||ve!==Ke)&&(o.polygonOffset(Xe,Ke),Me=Xe,ve=Ke)):Kt(o.POLYGON_OFFSET_FILL)}function Ot(Se){Se?Te(o.SCISSOR_TEST):Kt(o.SCISSOR_TEST)}function $t(Se){Se===void 0&&(Se=o.TEXTURE0+ke-1),je!==Se&&(o.activeTexture(Se),je=Se)}function pe(Se,Xe,Ke){Ke===void 0&&(je===null?Ke=o.TEXTURE0+ke-1:Ke=je);let Rt=Je[Ke];Rt===void 0&&(Rt={type:void 0,texture:void 0},Je[Ke]=Rt),(Rt.type!==Se||Rt.texture!==Xe)&&(je!==Ke&&(o.activeTexture(Ke),je=Ke),o.bindTexture(Se,Xe||St[Se]),Rt.type=Se,Rt.texture=Xe)}function oe(){const Se=Je[je];Se!==void 0&&Se.type!==void 0&&(o.bindTexture(Se.type,null),Se.type=void 0,Se.texture=void 0)}function Ue(){try{o.compressedTexImage2D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function pt(){try{o.compressedTexImage3D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function ct(){try{o.texSubImage2D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function It(){try{o.texSubImage3D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function Xt(){try{o.compressedTexSubImage2D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function Ct(){try{o.compressedTexSubImage3D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function He(){try{o.texStorage2D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function qt(){try{o.texStorage3D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function Yt(){try{o.texImage2D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function ei(){try{o.texImage3D.apply(o,arguments)}catch(Se){console.error("THREE.WebGLState:",Se)}}function ft(Se){qe.equals(Se)===!1&&(o.scissor(Se.x,Se.y,Se.z,Se.w),qe.copy(Se))}function Wt(Se){Ye.equals(Se)===!1&&(o.viewport(Se.x,Se.y,Se.z,Se.w),Ye.copy(Se))}function mi(Se,Xe){let Ke=b.get(Xe);Ke===void 0&&(Ke=new WeakMap,b.set(Xe,Ke));let Rt=Ke.get(Se);Rt===void 0&&(Rt=o.getUniformBlockIndex(Xe,Se.name),Ke.set(Se,Rt))}function Ii(Se,Xe){const Rt=b.get(Xe).get(Se);x.get(Xe)!==Rt&&(o.uniformBlockBinding(Xe,Rt,Se.__bindingPointIndex),x.set(Xe,Rt))}function Ki(){o.disable(o.BLEND),o.disable(o.CULL_FACE),o.disable(o.DEPTH_TEST),o.disable(o.POLYGON_OFFSET_FILL),o.disable(o.SCISSOR_TEST),o.disable(o.STENCIL_TEST),o.disable(o.SAMPLE_ALPHA_TO_COVERAGE),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ZERO),o.blendFuncSeparate(o.ONE,o.ZERO,o.ONE,o.ZERO),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(o.LESS),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(o.ALWAYS,0,4294967295),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),o.clearStencil(0),o.cullFace(o.BACK),o.frontFace(o.CCW),o.polygonOffset(0,0),o.activeTexture(o.TEXTURE0),o.bindFramebuffer(o.FRAMEBUFFER,null),i===!0&&(o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),o.bindFramebuffer(o.READ_FRAMEBUFFER,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),I={},je=null,Je={},E={},T=new WeakMap,U=[],P=null,R=!1,X=null,G=null,J=null,q=null,te=null,ue=null,_e=null,K=!1,ce=null,Ve=null,Ne=null,Me=null,ve=null,qe.set(0,0,o.canvas.width,o.canvas.height),Ye.set(0,0,o.canvas.width,o.canvas.height),a.reset(),m.reset(),A.reset()}return{buffers:{color:a,depth:m,stencil:A},enable:Te,disable:Kt,bindFramebuffer:Zt,drawBuffers:be,useProgram:$e,setBlending:Dt,setMaterial:Qi,setFlipSided:Bi,setCullFace:Ji,setLineWidth:Ni,setPolygonOffset:nt,setScissorTest:Ot,activeTexture:$t,bindTexture:pe,unbindTexture:oe,compressedTexImage2D:Ue,compressedTexImage3D:pt,texImage2D:Yt,texImage3D:ei,updateUBOMapping:mi,uniformBlockBinding:Ii,texStorage2D:He,texStorage3D:qt,texSubImage2D:ct,texSubImage3D:It,compressedTexSubImage2D:Xt,compressedTexSubImage3D:Ct,scissor:ft,viewport:Wt,reset:Ki}}function aD(o,e,t,i,s,c,u){const a=s.isWebGL2,m=s.maxTextures,A=s.maxCubemapSize,x=s.maxTextureSize,b=s.maxSamples,I=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,E=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),T=new WeakMap;let U;const P=new WeakMap;let R=!1;try{R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function X(pe,oe){return R?new OffscreenCanvas(pe,oe):pu("canvas")}function G(pe,oe,Ue,pt){let ct=1;if((pe.width>pt||pe.height>pt)&&(ct=pt/Math.max(pe.width,pe.height)),ct<1||oe===!0)if(typeof HTMLImageElement<"u"&&pe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&pe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&pe instanceof ImageBitmap){const It=oe?Pv:Math.floor,Xt=It(ct*pe.width),Ct=It(ct*pe.height);U===void 0&&(U=X(Xt,Ct));const He=Ue?X(Xt,Ct):U;return He.width=Xt,He.height=Ct,He.getContext("2d").drawImage(pe,0,0,Xt,Ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+pe.width+"x"+pe.height+") to ("+Xt+"x"+Ct+")."),He}else return"data"in pe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+pe.width+"x"+pe.height+")."),pe;return pe}function J(pe){return qg(pe.width)&&qg(pe.height)}function q(pe){return a?!1:pe.wrapS!==tr||pe.wrapT!==tr||pe.minFilter!==Pn&&pe.minFilter!==dn}function te(pe,oe){return pe.generateMipmaps&&oe&&pe.minFilter!==Pn&&pe.minFilter!==dn}function ue(pe){o.generateMipmap(pe)}function _e(pe,oe,Ue,pt,ct=!1){if(a===!1)return oe;if(pe!==null){if(o[pe]!==void 0)return o[pe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+pe+"'")}let It=oe;return oe===o.RED&&(Ue===o.FLOAT&&(It=o.R32F),Ue===o.HALF_FLOAT&&(It=o.R16F),Ue===o.UNSIGNED_BYTE&&(It=o.R8)),oe===o.RG&&(Ue===o.FLOAT&&(It=o.RG32F),Ue===o.HALF_FLOAT&&(It=o.RG16F),Ue===o.UNSIGNED_BYTE&&(It=o.RG8)),oe===o.RGBA&&(Ue===o.FLOAT&&(It=o.RGBA32F),Ue===o.HALF_FLOAT&&(It=o.RGBA16F),Ue===o.UNSIGNED_BYTE&&(It=pt===ni&&ct===!1?o.SRGB8_ALPHA8:o.RGBA8),Ue===o.UNSIGNED_SHORT_4_4_4_4&&(It=o.RGBA4),Ue===o.UNSIGNED_SHORT_5_5_5_1&&(It=o.RGB5_A1)),(It===o.R16F||It===o.R32F||It===o.RG16F||It===o.RG32F||It===o.RGBA16F||It===o.RGBA32F)&&e.get("EXT_color_buffer_float"),It}function K(pe,oe,Ue){return te(pe,Ue)===!0||pe.isFramebufferTexture&&pe.minFilter!==Pn&&pe.minFilter!==dn?Math.log2(Math.max(oe.width,oe.height))+1:pe.mipmaps!==void 0&&pe.mipmaps.length>0?pe.mipmaps.length:pe.isCompressedTexture&&Array.isArray(pe.image)?oe.mipmaps.length:1}function ce(pe){return pe===Pn||pe===ou||pe===ac?o.NEAREST:o.LINEAR}function Ve(pe){const oe=pe.target;oe.removeEventListener("dispose",Ve),Me(oe),oe.isVideoTexture&&T.delete(oe)}function Ne(pe){const oe=pe.target;oe.removeEventListener("dispose",Ne),ke(oe)}function Me(pe){const oe=i.get(pe);if(oe.__webglInit===void 0)return;const Ue=pe.source,pt=P.get(Ue);if(pt){const ct=pt[oe.__cacheKey];ct.usedTimes--,ct.usedTimes===0&&ve(pe),Object.keys(pt).length===0&&P.delete(Ue)}i.remove(pe)}function ve(pe){const oe=i.get(pe);o.deleteTexture(oe.__webglTexture);const Ue=pe.source,pt=P.get(Ue);delete pt[oe.__cacheKey],u.memory.textures--}function ke(pe){const oe=pe.texture,Ue=i.get(pe),pt=i.get(oe);if(pt.__webglTexture!==void 0&&(o.deleteTexture(pt.__webglTexture),u.memory.textures--),pe.depthTexture&&pe.depthTexture.dispose(),pe.isWebGLCubeRenderTarget)for(let ct=0;ct<6;ct++)o.deleteFramebuffer(Ue.__webglFramebuffer[ct]),Ue.__webglDepthbuffer&&o.deleteRenderbuffer(Ue.__webglDepthbuffer[ct]);else{if(o.deleteFramebuffer(Ue.__webglFramebuffer),Ue.__webglDepthbuffer&&o.deleteRenderbuffer(Ue.__webglDepthbuffer),Ue.__webglMultisampledFramebuffer&&o.deleteFramebuffer(Ue.__webglMultisampledFramebuffer),Ue.__webglColorRenderbuffer)for(let ct=0;ct<Ue.__webglColorRenderbuffer.length;ct++)Ue.__webglColorRenderbuffer[ct]&&o.deleteRenderbuffer(Ue.__webglColorRenderbuffer[ct]);Ue.__webglDepthRenderbuffer&&o.deleteRenderbuffer(Ue.__webglDepthRenderbuffer)}if(pe.isWebGLMultipleRenderTargets)for(let ct=0,It=oe.length;ct<It;ct++){const Xt=i.get(oe[ct]);Xt.__webglTexture&&(o.deleteTexture(Xt.__webglTexture),u.memory.textures--),i.remove(oe[ct])}i.remove(oe),i.remove(pe)}let Re=0;function Fe(){Re=0}function Oe(){const pe=Re;return pe>=m&&console.warn("THREE.WebGLTextures: Trying to use "+pe+" texture units while this GPU supports only "+m),Re+=1,pe}function je(pe){const oe=[];return oe.push(pe.wrapS),oe.push(pe.wrapT),oe.push(pe.wrapR||0),oe.push(pe.magFilter),oe.push(pe.minFilter),oe.push(pe.anisotropy),oe.push(pe.internalFormat),oe.push(pe.format),oe.push(pe.type),oe.push(pe.generateMipmaps),oe.push(pe.premultiplyAlpha),oe.push(pe.flipY),oe.push(pe.unpackAlignment),oe.push(pe.colorSpace),oe.join()}function Je(pe,oe){const Ue=i.get(pe);if(pe.isVideoTexture&&Ot(pe),pe.isRenderTargetTexture===!1&&pe.version>0&&Ue.__version!==pe.version){const pt=pe.image;if(pt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(pt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Kt(Ue,pe,oe);return}}t.bindTexture(o.TEXTURE_2D,Ue.__webglTexture,o.TEXTURE0+oe)}function _t(pe,oe){const Ue=i.get(pe);if(pe.version>0&&Ue.__version!==pe.version){Kt(Ue,pe,oe);return}t.bindTexture(o.TEXTURE_2D_ARRAY,Ue.__webglTexture,o.TEXTURE0+oe)}function yt(pe,oe){const Ue=i.get(pe);if(pe.version>0&&Ue.__version!==pe.version){Kt(Ue,pe,oe);return}t.bindTexture(o.TEXTURE_3D,Ue.__webglTexture,o.TEXTURE0+oe)}function qe(pe,oe){const Ue=i.get(pe);if(pe.version>0&&Ue.__version!==pe.version){Zt(Ue,pe,oe);return}t.bindTexture(o.TEXTURE_CUBE_MAP,Ue.__webglTexture,o.TEXTURE0+oe)}const Ye={[aa]:o.REPEAT,[tr]:o.CLAMP_TO_EDGE,[sc]:o.MIRRORED_REPEAT},at={[Pn]:o.NEAREST,[ou]:o.NEAREST_MIPMAP_NEAREST,[ac]:o.NEAREST_MIPMAP_LINEAR,[dn]:o.LINEAR,[Fp]:o.LINEAR_MIPMAP_NEAREST,[Os]:o.LINEAR_MIPMAP_LINEAR};function St(pe,oe,Ue){if(Ue?(o.texParameteri(pe,o.TEXTURE_WRAP_S,Ye[oe.wrapS]),o.texParameteri(pe,o.TEXTURE_WRAP_T,Ye[oe.wrapT]),(pe===o.TEXTURE_3D||pe===o.TEXTURE_2D_ARRAY)&&o.texParameteri(pe,o.TEXTURE_WRAP_R,Ye[oe.wrapR]),o.texParameteri(pe,o.TEXTURE_MAG_FILTER,at[oe.magFilter]),o.texParameteri(pe,o.TEXTURE_MIN_FILTER,at[oe.minFilter])):(o.texParameteri(pe,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(pe,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),(pe===o.TEXTURE_3D||pe===o.TEXTURE_2D_ARRAY)&&o.texParameteri(pe,o.TEXTURE_WRAP_R,o.CLAMP_TO_EDGE),(oe.wrapS!==tr||oe.wrapT!==tr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),o.texParameteri(pe,o.TEXTURE_MAG_FILTER,ce(oe.magFilter)),o.texParameteri(pe,o.TEXTURE_MIN_FILTER,ce(oe.minFilter)),oe.minFilter!==Pn&&oe.minFilter!==dn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const pt=e.get("EXT_texture_filter_anisotropic");if(oe.magFilter===Pn||oe.minFilter!==ac&&oe.minFilter!==Os||oe.type===br&&e.has("OES_texture_float_linear")===!1||a===!1&&oe.type===wr&&e.has("OES_texture_half_float_linear")===!1)return;(oe.anisotropy>1||i.get(oe).__currentAnisotropy)&&(o.texParameterf(pe,pt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(oe.anisotropy,s.getMaxAnisotropy())),i.get(oe).__currentAnisotropy=oe.anisotropy)}}function Te(pe,oe){let Ue=!1;pe.__webglInit===void 0&&(pe.__webglInit=!0,oe.addEventListener("dispose",Ve));const pt=oe.source;let ct=P.get(pt);ct===void 0&&(ct={},P.set(pt,ct));const It=je(oe);if(It!==pe.__cacheKey){ct[It]===void 0&&(ct[It]={texture:o.createTexture(),usedTimes:0},u.memory.textures++,Ue=!0),ct[It].usedTimes++;const Xt=ct[pe.__cacheKey];Xt!==void 0&&(ct[pe.__cacheKey].usedTimes--,Xt.usedTimes===0&&ve(oe)),pe.__cacheKey=It,pe.__webglTexture=ct[It].texture}return Ue}function Kt(pe,oe,Ue){let pt=o.TEXTURE_2D;(oe.isDataArrayTexture||oe.isCompressedArrayTexture)&&(pt=o.TEXTURE_2D_ARRAY),oe.isData3DTexture&&(pt=o.TEXTURE_3D);const ct=Te(pe,oe),It=oe.source;t.bindTexture(pt,pe.__webglTexture,o.TEXTURE0+Ue);const Xt=i.get(It);if(It.version!==Xt.__version||ct===!0){t.activeTexture(o.TEXTURE0+Ue),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,oe.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,oe.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.NONE);const Ct=q(oe)&&J(oe.image)===!1;let He=G(oe.image,Ct,!1,x);He=$t(oe,He);const qt=J(He)||a,Yt=c.convert(oe.format,oe.colorSpace);let ei=c.convert(oe.type),ft=_e(oe.internalFormat,Yt,ei,oe.colorSpace);St(pt,oe,qt);let Wt;const mi=oe.mipmaps,Ii=a&&oe.isVideoTexture!==!0,Ki=Xt.__version===void 0||ct===!0,Se=K(oe,He,qt);if(oe.isDepthTexture)ft=o.DEPTH_COMPONENT,a?oe.type===br?ft=o.DEPTH_COMPONENT32F:oe.type===al?ft=o.DEPTH_COMPONENT24:oe.type===oc?ft=o.DEPTH24_STENCIL8:ft=o.DEPTH_COMPONENT16:oe.type===br&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),oe.format===ol&&ft===o.DEPTH_COMPONENT&&oe.type!==ov&&oe.type!==al&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),oe.type=al,ei=c.convert(oe.type)),oe.format===lc&&ft===o.DEPTH_COMPONENT&&(ft=o.DEPTH_STENCIL,oe.type!==oc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),oe.type=oc,ei=c.convert(oe.type))),Ki&&(Ii?t.texStorage2D(o.TEXTURE_2D,1,ft,He.width,He.height):t.texImage2D(o.TEXTURE_2D,0,ft,He.width,He.height,0,Yt,ei,null));else if(oe.isDataTexture)if(mi.length>0&&qt){Ii&&Ki&&t.texStorage2D(o.TEXTURE_2D,Se,ft,mi[0].width,mi[0].height);for(let Xe=0,Ke=mi.length;Xe<Ke;Xe++)Wt=mi[Xe],Ii?t.texSubImage2D(o.TEXTURE_2D,Xe,0,0,Wt.width,Wt.height,Yt,ei,Wt.data):t.texImage2D(o.TEXTURE_2D,Xe,ft,Wt.width,Wt.height,0,Yt,ei,Wt.data);oe.generateMipmaps=!1}else Ii?(Ki&&t.texStorage2D(o.TEXTURE_2D,Se,ft,He.width,He.height),t.texSubImage2D(o.TEXTURE_2D,0,0,0,He.width,He.height,Yt,ei,He.data)):t.texImage2D(o.TEXTURE_2D,0,ft,He.width,He.height,0,Yt,ei,He.data);else if(oe.isCompressedTexture)if(oe.isCompressedArrayTexture){Ii&&Ki&&t.texStorage3D(o.TEXTURE_2D_ARRAY,Se,ft,mi[0].width,mi[0].height,He.depth);for(let Xe=0,Ke=mi.length;Xe<Ke;Xe++)Wt=mi[Xe],oe.format!==Rn?Yt!==null?Ii?t.compressedTexSubImage3D(o.TEXTURE_2D_ARRAY,Xe,0,0,0,Wt.width,Wt.height,He.depth,Yt,Wt.data,0,0):t.compressedTexImage3D(o.TEXTURE_2D_ARRAY,Xe,ft,Wt.width,Wt.height,He.depth,0,Wt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ii?t.texSubImage3D(o.TEXTURE_2D_ARRAY,Xe,0,0,0,Wt.width,Wt.height,He.depth,Yt,ei,Wt.data):t.texImage3D(o.TEXTURE_2D_ARRAY,Xe,ft,Wt.width,Wt.height,He.depth,0,Yt,ei,Wt.data)}else{Ii&&Ki&&t.texStorage2D(o.TEXTURE_2D,Se,ft,mi[0].width,mi[0].height);for(let Xe=0,Ke=mi.length;Xe<Ke;Xe++)Wt=mi[Xe],oe.format!==Rn?Yt!==null?Ii?t.compressedTexSubImage2D(o.TEXTURE_2D,Xe,0,0,Wt.width,Wt.height,Yt,Wt.data):t.compressedTexImage2D(o.TEXTURE_2D,Xe,ft,Wt.width,Wt.height,0,Wt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ii?t.texSubImage2D(o.TEXTURE_2D,Xe,0,0,Wt.width,Wt.height,Yt,ei,Wt.data):t.texImage2D(o.TEXTURE_2D,Xe,ft,Wt.width,Wt.height,0,Yt,ei,Wt.data)}else if(oe.isDataArrayTexture)Ii?(Ki&&t.texStorage3D(o.TEXTURE_2D_ARRAY,Se,ft,He.width,He.height,He.depth),t.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,0,He.width,He.height,He.depth,Yt,ei,He.data)):t.texImage3D(o.TEXTURE_2D_ARRAY,0,ft,He.width,He.height,He.depth,0,Yt,ei,He.data);else if(oe.isData3DTexture)Ii?(Ki&&t.texStorage3D(o.TEXTURE_3D,Se,ft,He.width,He.height,He.depth),t.texSubImage3D(o.TEXTURE_3D,0,0,0,0,He.width,He.height,He.depth,Yt,ei,He.data)):t.texImage3D(o.TEXTURE_3D,0,ft,He.width,He.height,He.depth,0,Yt,ei,He.data);else if(oe.isFramebufferTexture){if(Ki)if(Ii)t.texStorage2D(o.TEXTURE_2D,Se,ft,He.width,He.height);else{let Xe=He.width,Ke=He.height;for(let Rt=0;Rt<Se;Rt++)t.texImage2D(o.TEXTURE_2D,Rt,ft,Xe,Ke,0,Yt,ei,null),Xe>>=1,Ke>>=1}}else if(mi.length>0&&qt){Ii&&Ki&&t.texStorage2D(o.TEXTURE_2D,Se,ft,mi[0].width,mi[0].height);for(let Xe=0,Ke=mi.length;Xe<Ke;Xe++)Wt=mi[Xe],Ii?t.texSubImage2D(o.TEXTURE_2D,Xe,0,0,Yt,ei,Wt):t.texImage2D(o.TEXTURE_2D,Xe,ft,Yt,ei,Wt);oe.generateMipmaps=!1}else Ii?(Ki&&t.texStorage2D(o.TEXTURE_2D,Se,ft,He.width,He.height),t.texSubImage2D(o.TEXTURE_2D,0,0,0,Yt,ei,He)):t.texImage2D(o.TEXTURE_2D,0,ft,Yt,ei,He);te(oe,qt)&&ue(pt),Xt.__version=It.version,oe.onUpdate&&oe.onUpdate(oe)}pe.__version=oe.version}function Zt(pe,oe,Ue){if(oe.image.length!==6)return;const pt=Te(pe,oe),ct=oe.source;t.bindTexture(o.TEXTURE_CUBE_MAP,pe.__webglTexture,o.TEXTURE0+Ue);const It=i.get(ct);if(ct.version!==It.__version||pt===!0){t.activeTexture(o.TEXTURE0+Ue),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,oe.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,oe.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,o.NONE);const Xt=oe.isCompressedTexture||oe.image[0].isCompressedTexture,Ct=oe.image[0]&&oe.image[0].isDataTexture,He=[];for(let Xe=0;Xe<6;Xe++)!Xt&&!Ct?He[Xe]=G(oe.image[Xe],!1,!0,A):He[Xe]=Ct?oe.image[Xe].image:oe.image[Xe],He[Xe]=$t(oe,He[Xe]);const qt=He[0],Yt=J(qt)||a,ei=c.convert(oe.format,oe.colorSpace),ft=c.convert(oe.type),Wt=_e(oe.internalFormat,ei,ft,oe.colorSpace),mi=a&&oe.isVideoTexture!==!0,Ii=It.__version===void 0||pt===!0;let Ki=K(oe,qt,Yt);St(o.TEXTURE_CUBE_MAP,oe,Yt);let Se;if(Xt){mi&&Ii&&t.texStorage2D(o.TEXTURE_CUBE_MAP,Ki,Wt,qt.width,qt.height);for(let Xe=0;Xe<6;Xe++){Se=He[Xe].mipmaps;for(let Ke=0;Ke<Se.length;Ke++){const Rt=Se[Ke];oe.format!==Rn?ei!==null?mi?t.compressedTexSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke,0,0,Rt.width,Rt.height,ei,Rt.data):t.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke,Wt,Rt.width,Rt.height,0,Rt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):mi?t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke,0,0,Rt.width,Rt.height,ei,ft,Rt.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke,Wt,Rt.width,Rt.height,0,ei,ft,Rt.data)}}}else{Se=oe.mipmaps,mi&&Ii&&(Se.length>0&&Ki++,t.texStorage2D(o.TEXTURE_CUBE_MAP,Ki,Wt,He[0].width,He[0].height));for(let Xe=0;Xe<6;Xe++)if(Ct){mi?t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,0,0,He[Xe].width,He[Xe].height,ei,ft,He[Xe].data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,Wt,He[Xe].width,He[Xe].height,0,ei,ft,He[Xe].data);for(let Ke=0;Ke<Se.length;Ke++){const Nt=Se[Ke].image[Xe].image;mi?t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke+1,0,0,Nt.width,Nt.height,ei,ft,Nt.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke+1,Wt,Nt.width,Nt.height,0,ei,ft,Nt.data)}}else{mi?t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,0,0,ei,ft,He[Xe]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,0,Wt,ei,ft,He[Xe]);for(let Ke=0;Ke<Se.length;Ke++){const Rt=Se[Ke];mi?t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke+1,0,0,ei,ft,Rt.image[Xe]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+Xe,Ke+1,Wt,ei,ft,Rt.image[Xe])}}}te(oe,Yt)&&ue(o.TEXTURE_CUBE_MAP),It.__version=ct.version,oe.onUpdate&&oe.onUpdate(oe)}pe.__version=oe.version}function be(pe,oe,Ue,pt,ct){const It=c.convert(Ue.format,Ue.colorSpace),Xt=c.convert(Ue.type),Ct=_e(Ue.internalFormat,It,Xt,Ue.colorSpace);i.get(oe).__hasExternalTextures||(ct===o.TEXTURE_3D||ct===o.TEXTURE_2D_ARRAY?t.texImage3D(ct,0,Ct,oe.width,oe.height,oe.depth,0,It,Xt,null):t.texImage2D(ct,0,Ct,oe.width,oe.height,0,It,Xt,null)),t.bindFramebuffer(o.FRAMEBUFFER,pe),nt(oe)?I.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,pt,ct,i.get(Ue).__webglTexture,0,Ni(oe)):(ct===o.TEXTURE_2D||ct>=o.TEXTURE_CUBE_MAP_POSITIVE_X&&ct<=o.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&o.framebufferTexture2D(o.FRAMEBUFFER,pt,ct,i.get(Ue).__webglTexture,0),t.bindFramebuffer(o.FRAMEBUFFER,null)}function $e(pe,oe,Ue){if(o.bindRenderbuffer(o.RENDERBUFFER,pe),oe.depthBuffer&&!oe.stencilBuffer){let pt=o.DEPTH_COMPONENT16;if(Ue||nt(oe)){const ct=oe.depthTexture;ct&&ct.isDepthTexture&&(ct.type===br?pt=o.DEPTH_COMPONENT32F:ct.type===al&&(pt=o.DEPTH_COMPONENT24));const It=Ni(oe);nt(oe)?I.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,It,pt,oe.width,oe.height):o.renderbufferStorageMultisample(o.RENDERBUFFER,It,pt,oe.width,oe.height)}else o.renderbufferStorage(o.RENDERBUFFER,pt,oe.width,oe.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,pe)}else if(oe.depthBuffer&&oe.stencilBuffer){const pt=Ni(oe);Ue&&nt(oe)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,pt,o.DEPTH24_STENCIL8,oe.width,oe.height):nt(oe)?I.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,pt,o.DEPTH24_STENCIL8,oe.width,oe.height):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,oe.width,oe.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,pe)}else{const pt=oe.isWebGLMultipleRenderTargets===!0?oe.texture:[oe.texture];for(let ct=0;ct<pt.length;ct++){const It=pt[ct],Xt=c.convert(It.format,It.colorSpace),Ct=c.convert(It.type),He=_e(It.internalFormat,Xt,Ct,It.colorSpace),qt=Ni(oe);Ue&&nt(oe)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,qt,He,oe.width,oe.height):nt(oe)?I.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,qt,He,oe.width,oe.height):o.renderbufferStorage(o.RENDERBUFFER,He,oe.width,oe.height)}}o.bindRenderbuffer(o.RENDERBUFFER,null)}function fi(pe,oe){if(oe&&oe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(o.FRAMEBUFFER,pe),!(oe.depthTexture&&oe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(oe.depthTexture).__webglTexture||oe.depthTexture.image.width!==oe.width||oe.depthTexture.image.height!==oe.height)&&(oe.depthTexture.image.width=oe.width,oe.depthTexture.image.height=oe.height,oe.depthTexture.needsUpdate=!0),Je(oe.depthTexture,0);const pt=i.get(oe.depthTexture).__webglTexture,ct=Ni(oe);if(oe.depthTexture.format===ol)nt(oe)?I.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,pt,0,ct):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,pt,0);else if(oe.depthTexture.format===lc)nt(oe)?I.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,pt,0,ct):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,pt,0);else throw new Error("Unknown depthTexture format")}function kt(pe){const oe=i.get(pe),Ue=pe.isWebGLCubeRenderTarget===!0;if(pe.depthTexture&&!oe.__autoAllocateDepthBuffer){if(Ue)throw new Error("target.depthTexture not supported in Cube render targets");fi(oe.__webglFramebuffer,pe)}else if(Ue){oe.__webglDepthbuffer=[];for(let pt=0;pt<6;pt++)t.bindFramebuffer(o.FRAMEBUFFER,oe.__webglFramebuffer[pt]),oe.__webglDepthbuffer[pt]=o.createRenderbuffer(),$e(oe.__webglDepthbuffer[pt],pe,!1)}else t.bindFramebuffer(o.FRAMEBUFFER,oe.__webglFramebuffer),oe.__webglDepthbuffer=o.createRenderbuffer(),$e(oe.__webglDepthbuffer,pe,!1);t.bindFramebuffer(o.FRAMEBUFFER,null)}function Dt(pe,oe,Ue){const pt=i.get(pe);oe!==void 0&&be(pt.__webglFramebuffer,pe,pe.texture,o.COLOR_ATTACHMENT0,o.TEXTURE_2D),Ue!==void 0&&kt(pe)}function Qi(pe){const oe=pe.texture,Ue=i.get(pe),pt=i.get(oe);pe.addEventListener("dispose",Ne),pe.isWebGLMultipleRenderTargets!==!0&&(pt.__webglTexture===void 0&&(pt.__webglTexture=o.createTexture()),pt.__version=oe.version,u.memory.textures++);const ct=pe.isWebGLCubeRenderTarget===!0,It=pe.isWebGLMultipleRenderTargets===!0,Xt=J(pe)||a;if(ct){Ue.__webglFramebuffer=[];for(let Ct=0;Ct<6;Ct++)Ue.__webglFramebuffer[Ct]=o.createFramebuffer()}else{if(Ue.__webglFramebuffer=o.createFramebuffer(),It)if(s.drawBuffers){const Ct=pe.texture;for(let He=0,qt=Ct.length;He<qt;He++){const Yt=i.get(Ct[He]);Yt.__webglTexture===void 0&&(Yt.__webglTexture=o.createTexture(),u.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&pe.samples>0&&nt(pe)===!1){const Ct=It?oe:[oe];Ue.__webglMultisampledFramebuffer=o.createFramebuffer(),Ue.__webglColorRenderbuffer=[],t.bindFramebuffer(o.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer);for(let He=0;He<Ct.length;He++){const qt=Ct[He];Ue.__webglColorRenderbuffer[He]=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,Ue.__webglColorRenderbuffer[He]);const Yt=c.convert(qt.format,qt.colorSpace),ei=c.convert(qt.type),ft=_e(qt.internalFormat,Yt,ei,qt.colorSpace,pe.isXRRenderTarget===!0),Wt=Ni(pe);o.renderbufferStorageMultisample(o.RENDERBUFFER,Wt,ft,pe.width,pe.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+He,o.RENDERBUFFER,Ue.__webglColorRenderbuffer[He])}o.bindRenderbuffer(o.RENDERBUFFER,null),pe.depthBuffer&&(Ue.__webglDepthRenderbuffer=o.createRenderbuffer(),$e(Ue.__webglDepthRenderbuffer,pe,!0)),t.bindFramebuffer(o.FRAMEBUFFER,null)}}if(ct){t.bindTexture(o.TEXTURE_CUBE_MAP,pt.__webglTexture),St(o.TEXTURE_CUBE_MAP,oe,Xt);for(let Ct=0;Ct<6;Ct++)be(Ue.__webglFramebuffer[Ct],pe,oe,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+Ct);te(oe,Xt)&&ue(o.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(It){const Ct=pe.texture;for(let He=0,qt=Ct.length;He<qt;He++){const Yt=Ct[He],ei=i.get(Yt);t.bindTexture(o.TEXTURE_2D,ei.__webglTexture),St(o.TEXTURE_2D,Yt,Xt),be(Ue.__webglFramebuffer,pe,Yt,o.COLOR_ATTACHMENT0+He,o.TEXTURE_2D),te(Yt,Xt)&&ue(o.TEXTURE_2D)}t.unbindTexture()}else{let Ct=o.TEXTURE_2D;(pe.isWebGL3DRenderTarget||pe.isWebGLArrayRenderTarget)&&(a?Ct=pe.isWebGL3DRenderTarget?o.TEXTURE_3D:o.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ct,pt.__webglTexture),St(Ct,oe,Xt),be(Ue.__webglFramebuffer,pe,oe,o.COLOR_ATTACHMENT0,Ct),te(oe,Xt)&&ue(Ct),t.unbindTexture()}pe.depthBuffer&&kt(pe)}function Bi(pe){const oe=J(pe)||a,Ue=pe.isWebGLMultipleRenderTargets===!0?pe.texture:[pe.texture];for(let pt=0,ct=Ue.length;pt<ct;pt++){const It=Ue[pt];if(te(It,oe)){const Xt=pe.isWebGLCubeRenderTarget?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D,Ct=i.get(It).__webglTexture;t.bindTexture(Xt,Ct),ue(Xt),t.unbindTexture()}}}function Ji(pe){if(a&&pe.samples>0&&nt(pe)===!1){const oe=pe.isWebGLMultipleRenderTargets?pe.texture:[pe.texture],Ue=pe.width,pt=pe.height;let ct=o.COLOR_BUFFER_BIT;const It=[],Xt=pe.stencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT,Ct=i.get(pe),He=pe.isWebGLMultipleRenderTargets===!0;if(He)for(let qt=0;qt<oe.length;qt++)t.bindFramebuffer(o.FRAMEBUFFER,Ct.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+qt,o.RENDERBUFFER,null),t.bindFramebuffer(o.FRAMEBUFFER,Ct.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+qt,o.TEXTURE_2D,null,0);t.bindFramebuffer(o.READ_FRAMEBUFFER,Ct.__webglMultisampledFramebuffer),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Ct.__webglFramebuffer);for(let qt=0;qt<oe.length;qt++){It.push(o.COLOR_ATTACHMENT0+qt),pe.depthBuffer&&It.push(Xt);const Yt=Ct.__ignoreDepthValues!==void 0?Ct.__ignoreDepthValues:!1;if(Yt===!1&&(pe.depthBuffer&&(ct|=o.DEPTH_BUFFER_BIT),pe.stencilBuffer&&(ct|=o.STENCIL_BUFFER_BIT)),He&&o.framebufferRenderbuffer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,Ct.__webglColorRenderbuffer[qt]),Yt===!0&&(o.invalidateFramebuffer(o.READ_FRAMEBUFFER,[Xt]),o.invalidateFramebuffer(o.DRAW_FRAMEBUFFER,[Xt])),He){const ei=i.get(oe[qt]).__webglTexture;o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,ei,0)}o.blitFramebuffer(0,0,Ue,pt,0,0,Ue,pt,ct,o.NEAREST),E&&o.invalidateFramebuffer(o.READ_FRAMEBUFFER,It)}if(t.bindFramebuffer(o.READ_FRAMEBUFFER,null),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),He)for(let qt=0;qt<oe.length;qt++){t.bindFramebuffer(o.FRAMEBUFFER,Ct.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+qt,o.RENDERBUFFER,Ct.__webglColorRenderbuffer[qt]);const Yt=i.get(oe[qt]).__webglTexture;t.bindFramebuffer(o.FRAMEBUFFER,Ct.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+qt,o.TEXTURE_2D,Yt,0)}t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Ct.__webglMultisampledFramebuffer)}}function Ni(pe){return Math.min(b,pe.samples)}function nt(pe){const oe=i.get(pe);return a&&pe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&oe.__useRenderToTexture!==!1}function Ot(pe){const oe=u.render.frame;T.get(pe)!==oe&&(T.set(pe,oe),pe.update())}function $t(pe,oe){const Ue=pe.colorSpace,pt=pe.format,ct=pe.type;return pe.isCompressedTexture===!0||pe.format===Hg||Ue!==Qr&&Ue!==fs&&(Ue===ni?a===!1?e.has("EXT_sRGB")===!0&&pt===Rn?(pe.format=Hg,pe.minFilter=dn,pe.generateMipmaps=!1):oe=kv.sRGBToLinear(oe):(pt!==Rn||ct!==vr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ue)),oe}this.allocateTextureUnit=Oe,this.resetTextureUnits=Fe,this.setTexture2D=Je,this.setTexture2DArray=_t,this.setTexture3D=yt,this.setTextureCube=qe,this.rebindTextures=Dt,this.setupRenderTarget=Qi,this.updateRenderTargetMipmap=Bi,this.updateMultisampleRenderTarget=Ji,this.setupDepthRenderbuffer=kt,this.setupFrameBufferTexture=be,this.useMultisampledRTT=nt}function oD(o,e,t){const i=t.isWebGL2;function s(c,u=fs){let a;if(c===vr)return o.UNSIGNED_BYTE;if(c===vT)return o.UNSIGNED_SHORT_4_4_4_4;if(c===bT)return o.UNSIGNED_SHORT_5_5_5_1;if(c===_T)return o.BYTE;if(c===yT)return o.SHORT;if(c===ov)return o.UNSIGNED_SHORT;if(c===xT)return o.INT;if(c===al)return o.UNSIGNED_INT;if(c===br)return o.FLOAT;if(c===wr)return i?o.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(c===wT)return o.ALPHA;if(c===Rn)return o.RGBA;if(c===ET)return o.LUMINANCE;if(c===ST)return o.LUMINANCE_ALPHA;if(c===ol)return o.DEPTH_COMPONENT;if(c===lc)return o.DEPTH_STENCIL;if(c===Hg)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(c===lu)return o.RED;if(c===IT)return o.RED_INTEGER;if(c===cu)return o.RG;if(c===CT)return o.RG_INTEGER;if(c===MT)return o.RGBA_INTEGER;if(c===kp||c===Bg||c===Rg||c===Np)if(u===ni)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(c===kp)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(c===Bg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(c===Rg)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(c===Np)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(c===kp)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(c===Bg)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(c===Rg)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(c===Np)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(c===Lg||c===lv||c===Dg||c===cv)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(c===Lg)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(c===lv)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(c===Dg)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(c===cv)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(c===hv)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(c===Pg||c===Ug)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(c===Pg)return u===ni?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(c===Ug)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(c===Fg||c===uv||c===dv||c===pv||c===fv||c===mv||c===gv||c===Av||c===_v||c===yv||c===xv||c===vv||c===bv||c===wv)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(c===Fg)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(c===uv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(c===dv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(c===pv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(c===fv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(c===mv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(c===gv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(c===Av)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(c===_v)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(c===yv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(c===xv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(c===vv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(c===bv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(c===wv)return u===ni?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(c===Op)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(c===Op)return u===ni?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(c===TT||c===Ev||c===Sv||c===Iv)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(c===Op)return a.COMPRESSED_RED_RGTC1_EXT;if(c===Ev)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(c===Sv)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(c===Iv)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return c===oc?i?o.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):o[c]!==void 0?o[c]:null}return{convert:s}}class lD extends ir{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class _o extends Zi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const cD={type:"move"};class yA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new _o,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new _o,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new we,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new we),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new _o,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new we,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new we),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,c=null,u=null;const a=this._targetRay,m=this._grip,A=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(A&&e.hand){u=!0;for(const U of e.hand.values()){const P=t.getJointPose(U,i),R=this._getHandJoint(A,U);P!==null&&(R.matrix.fromArray(P.transform.matrix),R.matrix.decompose(R.position,R.rotation,R.scale),R.matrixWorldNeedsUpdate=!0,R.jointRadius=P.radius),R.visible=P!==null}const x=A.joints["index-finger-tip"],b=A.joints["thumb-tip"],I=x.position.distanceTo(b.position),E=.02,T=.005;A.inputState.pinching&&I>E+T?(A.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!A.inputState.pinching&&I<=E-T&&(A.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else m!==null&&e.gripSpace&&(c=t.getPose(e.gripSpace,i),c!==null&&(m.matrix.fromArray(c.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,c.linearVelocity?(m.hasLinearVelocity=!0,m.linearVelocity.copy(c.linearVelocity)):m.hasLinearVelocity=!1,c.angularVelocity?(m.hasAngularVelocity=!0,m.angularVelocity.copy(c.angularVelocity)):m.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&c!==null&&(s=c),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(cD)))}return a!==null&&(a.visible=s!==null),m!==null&&(m.visible=c!==null),A!==null&&(A.visible=u!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new _o;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class hD extends vn{constructor(e,t,i,s,c,u,a,m,A,x){if(x=x!==void 0?x:ol,x!==ol&&x!==lc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&x===ol&&(i=al),i===void 0&&x===lc&&(i=oc),super(null,s,c,u,a,m,x,i,A),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Pn,this.minFilter=m!==void 0?m:Pn,this.flipY=!1,this.generateMipmaps=!1}}class uD extends ms{constructor(e,t){super();const i=this;let s=null,c=1,u=null,a="local-floor",m=1,A=null,x=null,b=null,I=null,E=null,T=null;const U=t.getContextAttributes();let P=null,R=null;const X=[],G=[],J=new Set,q=new Map,te=new ir;te.layers.enable(1),te.viewport=new rn;const ue=new ir;ue.layers.enable(2),ue.viewport=new rn;const _e=[te,ue],K=new lD;K.layers.enable(1),K.layers.enable(2);let ce=null,Ve=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(qe){let Ye=X[qe];return Ye===void 0&&(Ye=new yA,X[qe]=Ye),Ye.getTargetRaySpace()},this.getControllerGrip=function(qe){let Ye=X[qe];return Ye===void 0&&(Ye=new yA,X[qe]=Ye),Ye.getGripSpace()},this.getHand=function(qe){let Ye=X[qe];return Ye===void 0&&(Ye=new yA,X[qe]=Ye),Ye.getHandSpace()};function Ne(qe){const Ye=G.indexOf(qe.inputSource);if(Ye===-1)return;const at=X[Ye];at!==void 0&&(at.update(qe.inputSource,qe.frame,A||u),at.dispatchEvent({type:qe.type,data:qe.inputSource}))}function Me(){s.removeEventListener("select",Ne),s.removeEventListener("selectstart",Ne),s.removeEventListener("selectend",Ne),s.removeEventListener("squeeze",Ne),s.removeEventListener("squeezestart",Ne),s.removeEventListener("squeezeend",Ne),s.removeEventListener("end",Me),s.removeEventListener("inputsourceschange",ve);for(let qe=0;qe<X.length;qe++){const Ye=G[qe];Ye!==null&&(G[qe]=null,X[qe].disconnect(Ye))}ce=null,Ve=null,e.setRenderTarget(P),E=null,I=null,b=null,s=null,R=null,yt.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(qe){c=qe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(qe){a=qe,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return A||u},this.setReferenceSpace=function(qe){A=qe},this.getBaseLayer=function(){return I!==null?I:E},this.getBinding=function(){return b},this.getFrame=function(){return T},this.getSession=function(){return s},this.setSession=async function(qe){if(s=qe,s!==null){if(P=e.getRenderTarget(),s.addEventListener("select",Ne),s.addEventListener("selectstart",Ne),s.addEventListener("selectend",Ne),s.addEventListener("squeeze",Ne),s.addEventListener("squeezestart",Ne),s.addEventListener("squeezeend",Ne),s.addEventListener("end",Me),s.addEventListener("inputsourceschange",ve),U.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Ye={antialias:s.renderState.layers===void 0?U.antialias:!0,alpha:!0,depth:U.depth,stencil:U.stencil,framebufferScaleFactor:c};E=new XRWebGLLayer(s,t,Ye),s.updateRenderState({baseLayer:E}),R=new Vs(E.framebufferWidth,E.framebufferHeight,{format:Rn,type:vr,colorSpace:e.outputColorSpace,stencilBuffer:U.stencil})}else{let Ye=null,at=null,St=null;U.depth&&(St=U.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ye=U.stencil?lc:ol,at=U.stencil?oc:al);const Te={colorFormat:t.RGBA8,depthFormat:St,scaleFactor:c};b=new XRWebGLBinding(s,t),I=b.createProjectionLayer(Te),s.updateRenderState({layers:[I]}),R=new Vs(I.textureWidth,I.textureHeight,{format:Rn,type:vr,depthTexture:new hD(I.textureWidth,I.textureHeight,at,void 0,void 0,void 0,void 0,void 0,void 0,Ye),stencilBuffer:U.stencil,colorSpace:e.outputColorSpace,samples:U.antialias?4:0});const Kt=e.properties.get(R);Kt.__ignoreDepthValues=I.ignoreDepthValues}R.isXRRenderTarget=!0,this.setFoveation(m),A=null,u=await s.requestReferenceSpace(a),yt.setContext(s),yt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function ve(qe){for(let Ye=0;Ye<qe.removed.length;Ye++){const at=qe.removed[Ye],St=G.indexOf(at);St>=0&&(G[St]=null,X[St].disconnect(at))}for(let Ye=0;Ye<qe.added.length;Ye++){const at=qe.added[Ye];let St=G.indexOf(at);if(St===-1){for(let Kt=0;Kt<X.length;Kt++)if(Kt>=G.length){G.push(at),St=Kt;break}else if(G[Kt]===null){G[Kt]=at,St=Kt;break}if(St===-1)break}const Te=X[St];Te&&Te.connect(at)}}const ke=new we,Re=new we;function Fe(qe,Ye,at){ke.setFromMatrixPosition(Ye.matrixWorld),Re.setFromMatrixPosition(at.matrixWorld);const St=ke.distanceTo(Re),Te=Ye.projectionMatrix.elements,Kt=at.projectionMatrix.elements,Zt=Te[14]/(Te[10]-1),be=Te[14]/(Te[10]+1),$e=(Te[9]+1)/Te[5],fi=(Te[9]-1)/Te[5],kt=(Te[8]-1)/Te[0],Dt=(Kt[8]+1)/Kt[0],Qi=Zt*kt,Bi=Zt*Dt,Ji=St/(-kt+Dt),Ni=Ji*-kt;Ye.matrixWorld.decompose(qe.position,qe.quaternion,qe.scale),qe.translateX(Ni),qe.translateZ(Ji),qe.matrixWorld.compose(qe.position,qe.quaternion,qe.scale),qe.matrixWorldInverse.copy(qe.matrixWorld).invert();const nt=Zt+Ji,Ot=be+Ji,$t=Qi-Ni,pe=Bi+(St-Ni),oe=$e*be/Ot*nt,Ue=fi*be/Ot*nt;qe.projectionMatrix.makePerspective($t,pe,oe,Ue,nt,Ot),qe.projectionMatrixInverse.copy(qe.projectionMatrix).invert()}function Oe(qe,Ye){Ye===null?qe.matrixWorld.copy(qe.matrix):qe.matrixWorld.multiplyMatrices(Ye.matrixWorld,qe.matrix),qe.matrixWorldInverse.copy(qe.matrixWorld).invert()}this.updateCamera=function(qe){if(s===null)return;K.near=ue.near=te.near=qe.near,K.far=ue.far=te.far=qe.far,(ce!==K.near||Ve!==K.far)&&(s.updateRenderState({depthNear:K.near,depthFar:K.far}),ce=K.near,Ve=K.far);const Ye=qe.parent,at=K.cameras;Oe(K,Ye);for(let St=0;St<at.length;St++)Oe(at[St],Ye);at.length===2?Fe(K,te,ue):K.projectionMatrix.copy(te.projectionMatrix),je(qe,K,Ye)};function je(qe,Ye,at){at===null?qe.matrix.copy(Ye.matrixWorld):(qe.matrix.copy(at.matrixWorld),qe.matrix.invert(),qe.matrix.multiply(Ye.matrixWorld)),qe.matrix.decompose(qe.position,qe.quaternion,qe.scale),qe.updateMatrixWorld(!0);const St=qe.children;for(let Te=0,Kt=St.length;Te<Kt;Te++)St[Te].updateMatrixWorld(!0);qe.projectionMatrix.copy(Ye.projectionMatrix),qe.projectionMatrixInverse.copy(Ye.projectionMatrixInverse),qe.isPerspectiveCamera&&(qe.fov=uc*2*Math.atan(1/qe.projectionMatrix.elements[5]),qe.zoom=1)}this.getCamera=function(){return K},this.getFoveation=function(){if(!(I===null&&E===null))return m},this.setFoveation=function(qe){m=qe,I!==null&&(I.fixedFoveation=qe),E!==null&&E.fixedFoveation!==void 0&&(E.fixedFoveation=qe)},this.getPlanes=function(){return J};let Je=null;function _t(qe,Ye){if(x=Ye.getViewerPose(A||u),T=Ye,x!==null){const at=x.views;E!==null&&(e.setRenderTargetFramebuffer(R,E.framebuffer),e.setRenderTarget(R));let St=!1;at.length!==K.cameras.length&&(K.cameras.length=0,St=!0);for(let Te=0;Te<at.length;Te++){const Kt=at[Te];let Zt=null;if(E!==null)Zt=E.getViewport(Kt);else{const $e=b.getViewSubImage(I,Kt);Zt=$e.viewport,Te===0&&(e.setRenderTargetTextures(R,$e.colorTexture,I.ignoreDepthValues?void 0:$e.depthStencilTexture),e.setRenderTarget(R))}let be=_e[Te];be===void 0&&(be=new ir,be.layers.enable(Te),be.viewport=new rn,_e[Te]=be),be.matrix.fromArray(Kt.transform.matrix),be.matrix.decompose(be.position,be.quaternion,be.scale),be.projectionMatrix.fromArray(Kt.projectionMatrix),be.projectionMatrixInverse.copy(be.projectionMatrix).invert(),be.viewport.set(Zt.x,Zt.y,Zt.width,Zt.height),Te===0&&(K.matrix.copy(be.matrix),K.matrix.decompose(K.position,K.quaternion,K.scale)),St===!0&&K.cameras.push(be)}}for(let at=0;at<X.length;at++){const St=G[at],Te=X[at];St!==null&&Te!==void 0&&Te.update(St,Ye,A||u)}if(Je&&Je(qe,Ye),Ye.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Ye.detectedPlanes});let at=null;for(const St of J)Ye.detectedPlanes.has(St)||(at===null&&(at=[]),at.push(St));if(at!==null)for(const St of at)J.delete(St),q.delete(St),i.dispatchEvent({type:"planeremoved",data:St});for(const St of Ye.detectedPlanes)if(!J.has(St))J.add(St),q.set(St,Ye.lastChangedTime),i.dispatchEvent({type:"planeadded",data:St});else{const Te=q.get(St);St.lastChangedTime>Te&&(q.set(St,St.lastChangedTime),i.dispatchEvent({type:"planechanged",data:St}))}}T=null}const yt=new a1;yt.setAnimationLoop(_t),this.setAnimationLoop=function(qe){Je=qe},this.dispose=function(){}}}function dD(o,e){function t(P,R){P.matrixAutoUpdate===!0&&P.updateMatrix(),R.value.copy(P.matrix)}function i(P,R){R.color.getRGB(P.fogColor.value,n1(o)),R.isFog?(P.fogNear.value=R.near,P.fogFar.value=R.far):R.isFogExp2&&(P.fogDensity.value=R.density)}function s(P,R,X,G,J){R.isMeshBasicMaterial||R.isMeshLambertMaterial?c(P,R):R.isMeshToonMaterial?(c(P,R),b(P,R)):R.isMeshPhongMaterial?(c(P,R),x(P,R)):R.isMeshStandardMaterial?(c(P,R),I(P,R),R.isMeshPhysicalMaterial&&E(P,R,J)):R.isMeshMatcapMaterial?(c(P,R),T(P,R)):R.isMeshDepthMaterial?c(P,R):R.isMeshDistanceMaterial?(c(P,R),U(P,R)):R.isMeshNormalMaterial?c(P,R):R.isLineBasicMaterial?(u(P,R),R.isLineDashedMaterial&&a(P,R)):R.isPointsMaterial?m(P,R,X,G):R.isSpriteMaterial?A(P,R):R.isShadowMaterial?(P.color.value.copy(R.color),P.opacity.value=R.opacity):R.isShaderMaterial&&(R.uniformsNeedUpdate=!1)}function c(P,R){P.opacity.value=R.opacity,R.color&&P.diffuse.value.copy(R.color),R.emissive&&P.emissive.value.copy(R.emissive).multiplyScalar(R.emissiveIntensity),R.map&&(P.map.value=R.map,t(R.map,P.mapTransform)),R.alphaMap&&(P.alphaMap.value=R.alphaMap,t(R.alphaMap,P.alphaMapTransform)),R.bumpMap&&(P.bumpMap.value=R.bumpMap,t(R.bumpMap,P.bumpMapTransform),P.bumpScale.value=R.bumpScale,R.side===Gn&&(P.bumpScale.value*=-1)),R.normalMap&&(P.normalMap.value=R.normalMap,t(R.normalMap,P.normalMapTransform),P.normalScale.value.copy(R.normalScale),R.side===Gn&&P.normalScale.value.negate()),R.displacementMap&&(P.displacementMap.value=R.displacementMap,t(R.displacementMap,P.displacementMapTransform),P.displacementScale.value=R.displacementScale,P.displacementBias.value=R.displacementBias),R.emissiveMap&&(P.emissiveMap.value=R.emissiveMap,t(R.emissiveMap,P.emissiveMapTransform)),R.specularMap&&(P.specularMap.value=R.specularMap,t(R.specularMap,P.specularMapTransform)),R.alphaTest>0&&(P.alphaTest.value=R.alphaTest);const X=e.get(R).envMap;if(X&&(P.envMap.value=X,P.flipEnvMap.value=X.isCubeTexture&&X.isRenderTargetTexture===!1?-1:1,P.reflectivity.value=R.reflectivity,P.ior.value=R.ior,P.refractionRatio.value=R.refractionRatio),R.lightMap){P.lightMap.value=R.lightMap;const G=o.useLegacyLights===!0?Math.PI:1;P.lightMapIntensity.value=R.lightMapIntensity*G,t(R.lightMap,P.lightMapTransform)}R.aoMap&&(P.aoMap.value=R.aoMap,P.aoMapIntensity.value=R.aoMapIntensity,t(R.aoMap,P.aoMapTransform))}function u(P,R){P.diffuse.value.copy(R.color),P.opacity.value=R.opacity,R.map&&(P.map.value=R.map,t(R.map,P.mapTransform))}function a(P,R){P.dashSize.value=R.dashSize,P.totalSize.value=R.dashSize+R.gapSize,P.scale.value=R.scale}function m(P,R,X,G){P.diffuse.value.copy(R.color),P.opacity.value=R.opacity,P.size.value=R.size*X,P.scale.value=G*.5,R.map&&(P.map.value=R.map,t(R.map,P.uvTransform)),R.alphaMap&&(P.alphaMap.value=R.alphaMap),R.alphaTest>0&&(P.alphaTest.value=R.alphaTest)}function A(P,R){P.diffuse.value.copy(R.color),P.opacity.value=R.opacity,P.rotation.value=R.rotation,R.map&&(P.map.value=R.map,t(R.map,P.mapTransform)),R.alphaMap&&(P.alphaMap.value=R.alphaMap),R.alphaTest>0&&(P.alphaTest.value=R.alphaTest)}function x(P,R){P.specular.value.copy(R.specular),P.shininess.value=Math.max(R.shininess,1e-4)}function b(P,R){R.gradientMap&&(P.gradientMap.value=R.gradientMap)}function I(P,R){P.metalness.value=R.metalness,R.metalnessMap&&(P.metalnessMap.value=R.metalnessMap,t(R.metalnessMap,P.metalnessMapTransform)),P.roughness.value=R.roughness,R.roughnessMap&&(P.roughnessMap.value=R.roughnessMap,t(R.roughnessMap,P.roughnessMapTransform)),e.get(R).envMap&&(P.envMapIntensity.value=R.envMapIntensity)}function E(P,R,X){P.ior.value=R.ior,R.sheen>0&&(P.sheenColor.value.copy(R.sheenColor).multiplyScalar(R.sheen),P.sheenRoughness.value=R.sheenRoughness,R.sheenColorMap&&(P.sheenColorMap.value=R.sheenColorMap,t(R.sheenColorMap,P.sheenColorMapTransform)),R.sheenRoughnessMap&&(P.sheenRoughnessMap.value=R.sheenRoughnessMap,t(R.sheenRoughnessMap,P.sheenRoughnessMapTransform))),R.clearcoat>0&&(P.clearcoat.value=R.clearcoat,P.clearcoatRoughness.value=R.clearcoatRoughness,R.clearcoatMap&&(P.clearcoatMap.value=R.clearcoatMap,t(R.clearcoatMap,P.clearcoatMapTransform)),R.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=R.clearcoatRoughnessMap,t(R.clearcoatRoughnessMap,P.clearcoatRoughnessMapTransform)),R.clearcoatNormalMap&&(P.clearcoatNormalMap.value=R.clearcoatNormalMap,t(R.clearcoatNormalMap,P.clearcoatNormalMapTransform),P.clearcoatNormalScale.value.copy(R.clearcoatNormalScale),R.side===Gn&&P.clearcoatNormalScale.value.negate())),R.iridescence>0&&(P.iridescence.value=R.iridescence,P.iridescenceIOR.value=R.iridescenceIOR,P.iridescenceThicknessMinimum.value=R.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=R.iridescenceThicknessRange[1],R.iridescenceMap&&(P.iridescenceMap.value=R.iridescenceMap,t(R.iridescenceMap,P.iridescenceMapTransform)),R.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=R.iridescenceThicknessMap,t(R.iridescenceThicknessMap,P.iridescenceThicknessMapTransform))),R.transmission>0&&(P.transmission.value=R.transmission,P.transmissionSamplerMap.value=X.texture,P.transmissionSamplerSize.value.set(X.width,X.height),R.transmissionMap&&(P.transmissionMap.value=R.transmissionMap,t(R.transmissionMap,P.transmissionMapTransform)),P.thickness.value=R.thickness,R.thicknessMap&&(P.thicknessMap.value=R.thicknessMap,t(R.thicknessMap,P.thicknessMapTransform)),P.attenuationDistance.value=R.attenuationDistance,P.attenuationColor.value.copy(R.attenuationColor)),P.specularIntensity.value=R.specularIntensity,P.specularColor.value.copy(R.specularColor),R.specularColorMap&&(P.specularColorMap.value=R.specularColorMap,t(R.specularColorMap,P.specularColorMapTransform)),R.specularIntensityMap&&(P.specularIntensityMap.value=R.specularIntensityMap,t(R.specularIntensityMap,P.specularIntensityMapTransform))}function T(P,R){R.matcap&&(P.matcap.value=R.matcap)}function U(P,R){const X=e.get(R).light;P.referencePosition.value.setFromMatrixPosition(X.matrixWorld),P.nearDistance.value=X.shadow.camera.near,P.farDistance.value=X.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function pD(o,e,t,i){let s={},c={},u=[];const a=t.isWebGL2?o.getParameter(o.MAX_UNIFORM_BUFFER_BINDINGS):0;function m(X,G){const J=G.program;i.uniformBlockBinding(X,J)}function A(X,G){let J=s[X.id];J===void 0&&(T(X),J=x(X),s[X.id]=J,X.addEventListener("dispose",P));const q=G.program;i.updateUBOMapping(X,q);const te=e.render.frame;c[X.id]!==te&&(I(X),c[X.id]=te)}function x(X){const G=b();X.__bindingPointIndex=G;const J=o.createBuffer(),q=X.__size,te=X.usage;return o.bindBuffer(o.UNIFORM_BUFFER,J),o.bufferData(o.UNIFORM_BUFFER,q,te),o.bindBuffer(o.UNIFORM_BUFFER,null),o.bindBufferBase(o.UNIFORM_BUFFER,G,J),J}function b(){for(let X=0;X<a;X++)if(u.indexOf(X)===-1)return u.push(X),X;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function I(X){const G=s[X.id],J=X.uniforms,q=X.__cache;o.bindBuffer(o.UNIFORM_BUFFER,G);for(let te=0,ue=J.length;te<ue;te++){const _e=J[te];if(E(_e,te,q)===!0){const K=_e.__offset,ce=Array.isArray(_e.value)?_e.value:[_e.value];let Ve=0;for(let Ne=0;Ne<ce.length;Ne++){const Me=ce[Ne],ve=U(Me);typeof Me=="number"?(_e.__data[0]=Me,o.bufferSubData(o.UNIFORM_BUFFER,K+Ve,_e.__data)):Me.isMatrix3?(_e.__data[0]=Me.elements[0],_e.__data[1]=Me.elements[1],_e.__data[2]=Me.elements[2],_e.__data[3]=Me.elements[0],_e.__data[4]=Me.elements[3],_e.__data[5]=Me.elements[4],_e.__data[6]=Me.elements[5],_e.__data[7]=Me.elements[0],_e.__data[8]=Me.elements[6],_e.__data[9]=Me.elements[7],_e.__data[10]=Me.elements[8],_e.__data[11]=Me.elements[0]):(Me.toArray(_e.__data,Ve),Ve+=ve.storage/Float32Array.BYTES_PER_ELEMENT)}o.bufferSubData(o.UNIFORM_BUFFER,K,_e.__data)}}o.bindBuffer(o.UNIFORM_BUFFER,null)}function E(X,G,J){const q=X.value;if(J[G]===void 0){if(typeof q=="number")J[G]=q;else{const te=Array.isArray(q)?q:[q],ue=[];for(let _e=0;_e<te.length;_e++)ue.push(te[_e].clone());J[G]=ue}return!0}else if(typeof q=="number"){if(J[G]!==q)return J[G]=q,!0}else{const te=Array.isArray(J[G])?J[G]:[J[G]],ue=Array.isArray(q)?q:[q];for(let _e=0;_e<te.length;_e++){const K=te[_e];if(K.equals(ue[_e])===!1)return K.copy(ue[_e]),!0}}return!1}function T(X){const G=X.uniforms;let J=0;const q=16;let te=0;for(let ue=0,_e=G.length;ue<_e;ue++){const K=G[ue],ce={boundary:0,storage:0},Ve=Array.isArray(K.value)?K.value:[K.value];for(let Ne=0,Me=Ve.length;Ne<Me;Ne++){const ve=Ve[Ne],ke=U(ve);ce.boundary+=ke.boundary,ce.storage+=ke.storage}if(K.__data=new Float32Array(ce.storage/Float32Array.BYTES_PER_ELEMENT),K.__offset=J,ue>0){te=J%q;const Ne=q-te;te!==0&&Ne-ce.boundary<0&&(J+=q-te,K.__offset=J)}J+=ce.storage}return te=J%q,te>0&&(J+=q-te),X.__size=J,X.__cache={},this}function U(X){const G={boundary:0,storage:0};return typeof X=="number"?(G.boundary=4,G.storage=4):X.isVector2?(G.boundary=8,G.storage=8):X.isVector3||X.isColor?(G.boundary=16,G.storage=12):X.isVector4?(G.boundary=16,G.storage=16):X.isMatrix3?(G.boundary=48,G.storage=48):X.isMatrix4?(G.boundary=64,G.storage=64):X.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",X),G}function P(X){const G=X.target;G.removeEventListener("dispose",P);const J=u.indexOf(G.__bindingPointIndex);u.splice(J,1),o.deleteBuffer(s[G.id]),delete s[G.id],delete c[G.id]}function R(){for(const X in s)o.deleteBuffer(s[X]);u=[],s={},c={}}return{bind:m,update:A,dispose:R}}function fD(){const o=pu("canvas");return o.style.display="block",o}class P1{constructor(e={}){const{canvas:t=fD(),context:i=null,depth:s=!0,stencil:c=!0,alpha:u=!1,antialias:a=!1,premultipliedAlpha:m=!0,preserveDrawingBuffer:A=!1,powerPreference:x="default",failIfMajorPerformanceCaveat:b=!1}=e;this.isWebGLRenderer=!0;let I;i!==null?I=i.getContextAttributes().alpha:I=u;let E=null,T=null;const U=[],P=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=ni,this.useLegacyLights=!0,this.toneMapping=Ns,this.toneMappingExposure=1;const R=this;let X=!1,G=0,J=0,q=null,te=-1,ue=null;const _e=new rn,K=new rn;let ce=null,Ve=t.width,Ne=t.height,Me=1,ve=null,ke=null;const Re=new rn(0,0,Ve,Ne),Fe=new rn(0,0,Ve,Ne);let Oe=!1;const je=new pA;let Je=!1,_t=!1,yt=null;const qe=new pi,Ye=new we,at={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function St(){return q===null?Me:1}let Te=i;function Kt(N,Z){for(let se=0;se<N.length;se++){const ae=N[se],xe=t.getContext(ae,Z);if(xe!==null)return xe}return null}try{const N={alpha:!0,depth:s,stencil:c,antialias:a,premultipliedAlpha:m,preserveDrawingBuffer:A,powerPreference:x,failIfMajorPerformanceCaveat:b};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Cg}`),t.addEventListener("webglcontextlost",Wt,!1),t.addEventListener("webglcontextrestored",mi,!1),t.addEventListener("webglcontextcreationerror",Ii,!1),Te===null){const Z=["webgl2","webgl","experimental-webgl"];if(R.isWebGL1Renderer===!0&&Z.shift(),Te=Kt(Z,N),Te===null)throw Kt(Z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Te.getShaderPrecisionFormat===void 0&&(Te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let Zt,be,$e,fi,kt,Dt,Qi,Bi,Ji,Ni,nt,Ot,$t,pe,oe,Ue,pt,ct,It,Xt,Ct,He,qt,Yt;function ei(){Zt=new IL(Te),be=new xL(Te,Zt,e),Zt.init(be),He=new oD(Te,Zt,be),$e=new sD(Te,Zt,be),fi=new TL(Te),kt=new q3,Dt=new aD(Te,Zt,$e,kt,be,He,fi),Qi=new bL(R),Bi=new SL(R),Ji=new vB(Te,be),qt=new _L(Te,Zt,Ji,be),Ni=new CL(Te,Ji,fi,qt),nt=new DL(Te,Ni,Ji,fi),It=new LL(Te,be,Dt),Ue=new vL(kt),Ot=new W3(R,Qi,Bi,Zt,be,qt,Ue),$t=new dD(R,kt),pe=new j3,oe=new eD(Zt,be),ct=new AL(R,Qi,Bi,$e,nt,I,m),pt=new rD(R,nt,be),Yt=new pD(Te,fi,be,$e),Xt=new yL(Te,Zt,fi,be),Ct=new ML(Te,Zt,fi,be),fi.programs=Ot.programs,R.capabilities=be,R.extensions=Zt,R.properties=kt,R.renderLists=pe,R.shadowMap=pt,R.state=$e,R.info=fi}ei();const ft=new uD(R,Te);this.xr=ft,this.getContext=function(){return Te},this.getContextAttributes=function(){return Te.getContextAttributes()},this.forceContextLoss=function(){const N=Zt.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){const N=Zt.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return Me},this.setPixelRatio=function(N){N!==void 0&&(Me=N,this.setSize(Ve,Ne,!1))},this.getSize=function(N){return N.set(Ve,Ne)},this.setSize=function(N,Z,se=!0){if(ft.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ve=N,Ne=Z,t.width=Math.floor(N*Me),t.height=Math.floor(Z*Me),se===!0&&(t.style.width=N+"px",t.style.height=Z+"px"),this.setViewport(0,0,N,Z)},this.getDrawingBufferSize=function(N){return N.set(Ve*Me,Ne*Me).floor()},this.setDrawingBufferSize=function(N,Z,se){Ve=N,Ne=Z,Me=se,t.width=Math.floor(N*se),t.height=Math.floor(Z*se),this.setViewport(0,0,N,Z)},this.getCurrentViewport=function(N){return N.copy(_e)},this.getViewport=function(N){return N.copy(Re)},this.setViewport=function(N,Z,se,ae){N.isVector4?Re.set(N.x,N.y,N.z,N.w):Re.set(N,Z,se,ae),$e.viewport(_e.copy(Re).multiplyScalar(Me).floor())},this.getScissor=function(N){return N.copy(Fe)},this.setScissor=function(N,Z,se,ae){N.isVector4?Fe.set(N.x,N.y,N.z,N.w):Fe.set(N,Z,se,ae),$e.scissor(K.copy(Fe).multiplyScalar(Me).floor())},this.getScissorTest=function(){return Oe},this.setScissorTest=function(N){$e.setScissorTest(Oe=N)},this.setOpaqueSort=function(N){ve=N},this.setTransparentSort=function(N){ke=N},this.getClearColor=function(N){return N.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(N=!0,Z=!0,se=!0){let ae=0;N&&(ae|=Te.COLOR_BUFFER_BIT),Z&&(ae|=Te.DEPTH_BUFFER_BIT),se&&(ae|=Te.STENCIL_BUFFER_BIT),Te.clear(ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Wt,!1),t.removeEventListener("webglcontextrestored",mi,!1),t.removeEventListener("webglcontextcreationerror",Ii,!1),pe.dispose(),oe.dispose(),kt.dispose(),Qi.dispose(),Bi.dispose(),nt.dispose(),qt.dispose(),Yt.dispose(),Ot.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",Nt),ft.removeEventListener("sessionend",ci),yt&&(yt.dispose(),yt=null),li.stop()};function Wt(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),X=!0}function mi(){console.log("THREE.WebGLRenderer: Context Restored."),X=!1;const N=fi.autoReset,Z=pt.enabled,se=pt.autoUpdate,ae=pt.needsUpdate,xe=pt.type;ei(),fi.autoReset=N,pt.enabled=Z,pt.autoUpdate=se,pt.needsUpdate=ae,pt.type=xe}function Ii(N){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",N.statusMessage)}function Ki(N){const Z=N.target;Z.removeEventListener("dispose",Ki),Se(Z)}function Se(N){Xe(N),kt.remove(N)}function Xe(N){const Z=kt.get(N).programs;Z!==void 0&&(Z.forEach(function(se){Ot.releaseProgram(se)}),N.isShaderMaterial&&Ot.releaseShaderCache(N))}this.renderBufferDirect=function(N,Z,se,ae,xe,De){Z===null&&(Z=at);const st=xe.isMesh&&xe.matrixWorld.determinant()<0,ht=de(N,Z,se,ae,xe);$e.setMaterial(ae,st);let ot=se.index,gt=1;ae.wireframe===!0&&(ot=Ni.getWireframeAttribute(se),gt=2);const Tt=se.drawRange,Ht=se.attributes.position;let zt=Tt.start*gt,si=(Tt.start+Tt.count)*gt;De!==null&&(zt=Math.max(zt,De.start*gt),si=Math.min(si,(De.start+De.count)*gt)),ot!==null?(zt=Math.max(zt,0),si=Math.min(si,ot.count)):Ht!=null&&(zt=Math.max(zt,0),si=Math.min(si,Ht.count));const xi=si-zt;if(xi<0||xi===1/0)return;qt.setup(xe,ae,ht,se,ot);let Vi,bi=Xt;if(ot!==null&&(Vi=Ji.get(ot),bi=Ct,bi.setIndex(Vi)),xe.isMesh)ae.wireframe===!0?($e.setLineWidth(ae.wireframeLinewidth*St()),bi.setMode(Te.LINES)):bi.setMode(Te.TRIANGLES);else if(xe.isLine){let ii=ae.linewidth;ii===void 0&&(ii=1),$e.setLineWidth(ii*St()),xe.isLineSegments?bi.setMode(Te.LINES):xe.isLineLoop?bi.setMode(Te.LINE_LOOP):bi.setMode(Te.LINE_STRIP)}else xe.isPoints?bi.setMode(Te.POINTS):xe.isSprite&&bi.setMode(Te.TRIANGLES);if(xe.isInstancedMesh)bi.renderInstances(zt,xi,xe.count);else if(se.isInstancedBufferGeometry){const ii=se._maxInstanceCount!==void 0?se._maxInstanceCount:1/0,Is=Math.min(se.instanceCount,ii);bi.renderInstances(zt,xi,Is)}else bi.render(zt,xi)},this.compile=function(N,Z){function se(ae,xe,De){ae.transparent===!0&&ae.side===er&&ae.forceSinglePass===!1?(ae.side=Gn,ae.needsUpdate=!0,W(ae,xe,De),ae.side=ks,ae.needsUpdate=!0,W(ae,xe,De),ae.side=er):W(ae,xe,De)}T=oe.get(N),T.init(),P.push(T),N.traverseVisible(function(ae){ae.isLight&&ae.layers.test(Z.layers)&&(T.pushLight(ae),ae.castShadow&&T.pushShadow(ae))}),T.setupLights(R.useLegacyLights),N.traverse(function(ae){const xe=ae.material;if(xe)if(Array.isArray(xe))for(let De=0;De<xe.length;De++){const st=xe[De];se(st,N,ae)}else se(xe,N,ae)}),P.pop(),T=null};let Ke=null;function Rt(N){Ke&&Ke(N)}function Nt(){li.stop()}function ci(){li.start()}const li=new a1;li.setAnimationLoop(Rt),typeof self<"u"&&li.setContext(self),this.setAnimationLoop=function(N){Ke=N,ft.setAnimationLoop(N),N===null?li.stop():li.start()},ft.addEventListener("sessionstart",Nt),ft.addEventListener("sessionend",ci),this.render=function(N,Z){if(Z!==void 0&&Z.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(X===!0)return;N.matrixWorldAutoUpdate===!0&&N.updateMatrixWorld(),Z.parent===null&&Z.matrixWorldAutoUpdate===!0&&Z.updateMatrixWorld(),ft.enabled===!0&&ft.isPresenting===!0&&(ft.cameraAutoUpdate===!0&&ft.updateCamera(Z),Z=ft.getCamera()),N.isScene===!0&&N.onBeforeRender(R,N,Z,q),T=oe.get(N,P.length),T.init(),P.push(T),qe.multiplyMatrices(Z.projectionMatrix,Z.matrixWorldInverse),je.setFromProjectionMatrix(qe),_t=this.localClippingEnabled,Je=Ue.init(this.clippingPlanes,_t),E=pe.get(N,U.length),E.init(),U.push(E),ki(N,Z,0,R.sortObjects),E.finish(),R.sortObjects===!0&&E.sort(ve,ke),Je===!0&&Ue.beginShadows();const se=T.state.shadowsArray;if(pt.render(se,N,Z),Je===!0&&Ue.endShadows(),this.info.autoReset===!0&&this.info.reset(),ct.render(E,N),T.setupLights(R.useLegacyLights),Z.isArrayCamera){const ae=Z.cameras;for(let xe=0,De=ae.length;xe<De;xe++){const st=ae[xe];hn(E,N,st,st.viewport)}}else hn(E,N,Z);q!==null&&(Dt.updateMultisampleRenderTarget(q),Dt.updateRenderTargetMipmap(q)),N.isScene===!0&&N.onAfterRender(R,N,Z),qt.resetDefaultState(),te=-1,ue=null,P.pop(),P.length>0?T=P[P.length-1]:T=null,U.pop(),U.length>0?E=U[U.length-1]:E=null};function ki(N,Z,se,ae){if(N.visible===!1)return;if(N.layers.test(Z.layers)){if(N.isGroup)se=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(Z);else if(N.isLight)T.pushLight(N),N.castShadow&&T.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||je.intersectsSprite(N)){ae&&Ye.setFromMatrixPosition(N.matrixWorld).applyMatrix4(qe);const st=nt.update(N),ht=N.material;ht.visible&&E.push(N,st,ht,se,Ye.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(!N.frustumCulled||je.intersectsObject(N))){N.isSkinnedMesh&&N.skeleton.frame!==fi.render.frame&&(N.skeleton.update(),N.skeleton.frame=fi.render.frame);const st=nt.update(N),ht=N.material;if(ae&&(st.boundingSphere===null&&st.computeBoundingSphere(),Ye.copy(st.boundingSphere.center).applyMatrix4(N.matrixWorld).applyMatrix4(qe)),Array.isArray(ht)){const ot=st.groups;for(let gt=0,Tt=ot.length;gt<Tt;gt++){const Ht=ot[gt],zt=ht[Ht.materialIndex];zt&&zt.visible&&E.push(N,st,zt,se,Ye.z,Ht)}}else ht.visible&&E.push(N,st,ht,se,Ye.z,null)}}const De=N.children;for(let st=0,ht=De.length;st<ht;st++)ki(De[st],Z,se,ae)}function hn(N,Z,se,ae){const xe=N.opaque,De=N.transmissive,st=N.transparent;T.setupLightsView(se),Je===!0&&Ue.setGlobalState(R.clippingPlanes,se),De.length>0&&Oi(xe,De,Z,se),ae&&$e.viewport(_e.copy(ae)),xe.length>0&&ie(xe,Z,se),De.length>0&&ie(De,Z,se),st.length>0&&ie(st,Z,se),$e.buffers.depth.setTest(!0),$e.buffers.depth.setMask(!0),$e.buffers.color.setMask(!0),$e.setPolygonOffset(!1)}function Oi(N,Z,se,ae){if(yt===null){const ht=be.isWebGL2;yt=new Vs(1024,1024,{generateMipmaps:!0,type:Zt.has("EXT_color_buffer_half_float")?wr:vr,minFilter:Os,samples:ht&&a===!0?4:0})}const xe=R.getRenderTarget();R.setRenderTarget(yt),R.clear();const De=R.toneMapping;R.toneMapping=Ns,ie(N,se,ae),Dt.updateMultisampleRenderTarget(yt),Dt.updateRenderTargetMipmap(yt);let st=!1;for(let ht=0,ot=Z.length;ht<ot;ht++){const gt=Z[ht],Tt=gt.object,Ht=gt.geometry,zt=gt.material,si=gt.group;if(zt.side===er&&Tt.layers.test(ae.layers)){const xi=zt.side;zt.side=Gn,zt.needsUpdate=!0,V(Tt,se,ae,Ht,zt,si),zt.side=xi,zt.needsUpdate=!0,st=!0}}st===!0&&(Dt.updateMultisampleRenderTarget(yt),Dt.updateRenderTargetMipmap(yt)),R.setRenderTarget(xe),R.toneMapping=De}function ie(N,Z,se){const ae=Z.isScene===!0?Z.overrideMaterial:null;for(let xe=0,De=N.length;xe<De;xe++){const st=N[xe],ht=st.object,ot=st.geometry,gt=ae===null?st.material:ae,Tt=st.group;ht.layers.test(se.layers)&&V(ht,Z,se,ot,gt,Tt)}}function V(N,Z,se,ae,xe,De){N.onBeforeRender(R,Z,se,ae,xe,De),N.modelViewMatrix.multiplyMatrices(se.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),xe.onBeforeRender(R,Z,se,ae,N,De),xe.transparent===!0&&xe.side===er&&xe.forceSinglePass===!1?(xe.side=Gn,xe.needsUpdate=!0,R.renderBufferDirect(se,Z,ae,xe,N,De),xe.side=ks,xe.needsUpdate=!0,R.renderBufferDirect(se,Z,ae,xe,N,De),xe.side=er):R.renderBufferDirect(se,Z,ae,xe,N,De),N.onAfterRender(R,Z,se,ae,xe,De)}function W(N,Z,se){Z.isScene!==!0&&(Z=at);const ae=kt.get(N),xe=T.state.lights,De=T.state.shadowsArray,st=xe.state.version,ht=Ot.getParameters(N,xe.state,De,Z,se),ot=Ot.getProgramCacheKey(ht);let gt=ae.programs;ae.environment=N.isMeshStandardMaterial?Z.environment:null,ae.fog=Z.fog,ae.envMap=(N.isMeshStandardMaterial?Bi:Qi).get(N.envMap||ae.environment),gt===void 0&&(N.addEventListener("dispose",Ki),gt=new Map,ae.programs=gt);let Tt=gt.get(ot);if(Tt!==void 0){if(ae.currentProgram===Tt&&ae.lightsStateVersion===st)return ne(N,ht),Tt}else ht.uniforms=Ot.getUniforms(N),N.onBuild(se,ht,R),N.onBeforeCompile(ht,R),Tt=Ot.acquireProgram(ht,ot),gt.set(ot,Tt),ae.uniforms=ht.uniforms;const Ht=ae.uniforms;(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(Ht.clippingPlanes=Ue.uniform),ne(N,ht),ae.needsLights=Ee(N),ae.lightsStateVersion=st,ae.needsLights&&(Ht.ambientLightColor.value=xe.state.ambient,Ht.lightProbe.value=xe.state.probe,Ht.directionalLights.value=xe.state.directional,Ht.directionalLightShadows.value=xe.state.directionalShadow,Ht.spotLights.value=xe.state.spot,Ht.spotLightShadows.value=xe.state.spotShadow,Ht.rectAreaLights.value=xe.state.rectArea,Ht.ltc_1.value=xe.state.rectAreaLTC1,Ht.ltc_2.value=xe.state.rectAreaLTC2,Ht.pointLights.value=xe.state.point,Ht.pointLightShadows.value=xe.state.pointShadow,Ht.hemisphereLights.value=xe.state.hemi,Ht.directionalShadowMap.value=xe.state.directionalShadowMap,Ht.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,Ht.spotShadowMap.value=xe.state.spotShadowMap,Ht.spotLightMatrix.value=xe.state.spotLightMatrix,Ht.spotLightMap.value=xe.state.spotLightMap,Ht.pointShadowMap.value=xe.state.pointShadowMap,Ht.pointShadowMatrix.value=xe.state.pointShadowMatrix);const zt=Tt.getUniforms(),si=df.seqWithValue(zt.seq,Ht);return ae.currentProgram=Tt,ae.uniformsList=si,Tt}function ne(N,Z){const se=kt.get(N);se.outputColorSpace=Z.outputColorSpace,se.instancing=Z.instancing,se.skinning=Z.skinning,se.morphTargets=Z.morphTargets,se.morphNormals=Z.morphNormals,se.morphColors=Z.morphColors,se.morphTargetsCount=Z.morphTargetsCount,se.numClippingPlanes=Z.numClippingPlanes,se.numIntersection=Z.numClipIntersection,se.vertexAlphas=Z.vertexAlphas,se.vertexTangents=Z.vertexTangents,se.toneMapping=Z.toneMapping}function de(N,Z,se,ae,xe){Z.isScene!==!0&&(Z=at),Dt.resetTextureUnits();const De=Z.fog,st=ae.isMeshStandardMaterial?Z.environment:null,ht=q===null?R.outputColorSpace:q.isXRRenderTarget===!0?q.texture.colorSpace:Qr,ot=(ae.isMeshStandardMaterial?Bi:Qi).get(ae.envMap||st),gt=ae.vertexColors===!0&&!!se.attributes.color&&se.attributes.color.itemSize===4,Tt=!!ae.normalMap&&!!se.attributes.tangent,Ht=!!se.morphAttributes.position,zt=!!se.morphAttributes.normal,si=!!se.morphAttributes.color,xi=ae.toneMapped?R.toneMapping:Ns,Vi=se.morphAttributes.position||se.morphAttributes.normal||se.morphAttributes.color,bi=Vi!==void 0?Vi.length:0,ii=kt.get(ae),Is=T.state.lights;if(Je===!0&&(_t===!0||N!==ue)){const In=N===ue&&ae.id===te;Ue.setState(ae,N,In)}let En=!1;ae.version===ii.__version?(ii.needsLights&&ii.lightsStateVersion!==Is.state.version||ii.outputColorSpace!==ht||xe.isInstancedMesh&&ii.instancing===!1||!xe.isInstancedMesh&&ii.instancing===!0||xe.isSkinnedMesh&&ii.skinning===!1||!xe.isSkinnedMesh&&ii.skinning===!0||ii.envMap!==ot||ae.fog===!0&&ii.fog!==De||ii.numClippingPlanes!==void 0&&(ii.numClippingPlanes!==Ue.numPlanes||ii.numIntersection!==Ue.numIntersection)||ii.vertexAlphas!==gt||ii.vertexTangents!==Tt||ii.morphTargets!==Ht||ii.morphNormals!==zt||ii.morphColors!==si||ii.toneMapping!==xi||be.isWebGL2===!0&&ii.morphTargetsCount!==bi)&&(En=!0):(En=!0,ii.__version=ae.version);let Cs=ii.currentProgram;En===!0&&(Cs=W(ae,Z,xe));let Ms=!1,Ts=!1,Bs=!1;const un=Cs.getUniforms(),qr=ii.uniforms;if($e.useProgram(Cs.program)&&(Ms=!0,Ts=!0,Bs=!0),ae.id!==te&&(te=ae.id,Ts=!0),Ms||ue!==N){if(un.setValue(Te,"projectionMatrix",N.projectionMatrix),be.logarithmicDepthBuffer&&un.setValue(Te,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),ue!==N&&(ue=N,Ts=!0,Bs=!0),ae.isShaderMaterial||ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshStandardMaterial||ae.envMap){const In=un.map.cameraPosition;In!==void 0&&In.setValue(Te,Ye.setFromMatrixPosition(N.matrixWorld))}(ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshLambertMaterial||ae.isMeshBasicMaterial||ae.isMeshStandardMaterial||ae.isShaderMaterial)&&un.setValue(Te,"isOrthographic",N.isOrthographicCamera===!0),(ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshLambertMaterial||ae.isMeshBasicMaterial||ae.isMeshStandardMaterial||ae.isShaderMaterial||ae.isShadowMaterial||xe.isSkinnedMesh)&&un.setValue(Te,"viewMatrix",N.matrixWorldInverse)}if(xe.isSkinnedMesh){un.setOptional(Te,xe,"bindMatrix"),un.setOptional(Te,xe,"bindMatrixInverse");const In=xe.skeleton;In&&(be.floatVertexTextures?(In.boneTexture===null&&In.computeBoneTexture(),un.setValue(Te,"boneTexture",In.boneTexture,Dt),un.setValue(Te,"boneTextureSize",In.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ja=se.morphAttributes;if((ja.position!==void 0||ja.normal!==void 0||ja.color!==void 0&&be.isWebGL2===!0)&&It.update(xe,se,Cs),(Ts||ii.receiveShadow!==xe.receiveShadow)&&(ii.receiveShadow=xe.receiveShadow,un.setValue(Te,"receiveShadow",xe.receiveShadow)),ae.isMeshGouraudMaterial&&ae.envMap!==null&&(qr.envMap.value=ot,qr.flipEnvMap.value=ot.isCubeTexture&&ot.isRenderTargetTexture===!1?-1:1),Ts&&(un.setValue(Te,"toneMappingExposure",R.toneMappingExposure),ii.needsLights&&ye(qr,Bs),De&&ae.fog===!0&&$t.refreshFogUniforms(qr,De),$t.refreshMaterialUniforms(qr,ae,Me,Ne,yt),df.upload(Te,ii.uniformsList,qr,Dt)),ae.isShaderMaterial&&ae.uniformsNeedUpdate===!0&&(df.upload(Te,ii.uniformsList,qr,Dt),ae.uniformsNeedUpdate=!1),ae.isSpriteMaterial&&un.setValue(Te,"center",xe.center),un.setValue(Te,"modelViewMatrix",xe.modelViewMatrix),un.setValue(Te,"normalMatrix",xe.normalMatrix),un.setValue(Te,"modelMatrix",xe.matrixWorld),ae.isShaderMaterial||ae.isRawShaderMaterial){const In=ae.uniformsGroups;for(let Xa=0,No=In.length;Xa<No;Xa++)if(be.isWebGL2){const _a=In[Xa];Yt.update(_a,Cs),Yt.bind(_a,Cs)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Cs}function ye(N,Z){N.ambientLightColor.needsUpdate=Z,N.lightProbe.needsUpdate=Z,N.directionalLights.needsUpdate=Z,N.directionalLightShadows.needsUpdate=Z,N.pointLights.needsUpdate=Z,N.pointLightShadows.needsUpdate=Z,N.spotLights.needsUpdate=Z,N.spotLightShadows.needsUpdate=Z,N.rectAreaLights.needsUpdate=Z,N.hemisphereLights.needsUpdate=Z}function Ee(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return J},this.getRenderTarget=function(){return q},this.setRenderTargetTextures=function(N,Z,se){kt.get(N.texture).__webglTexture=Z,kt.get(N.depthTexture).__webglTexture=se;const ae=kt.get(N);ae.__hasExternalTextures=!0,ae.__hasExternalTextures&&(ae.__autoAllocateDepthBuffer=se===void 0,ae.__autoAllocateDepthBuffer||Zt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ae.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(N,Z){const se=kt.get(N);se.__webglFramebuffer=Z,se.__useDefaultFramebuffer=Z===void 0},this.setRenderTarget=function(N,Z=0,se=0){q=N,G=Z,J=se;let ae=!0,xe=null,De=!1,st=!1;if(N){const ot=kt.get(N);ot.__useDefaultFramebuffer!==void 0?($e.bindFramebuffer(Te.FRAMEBUFFER,null),ae=!1):ot.__webglFramebuffer===void 0?Dt.setupRenderTarget(N):ot.__hasExternalTextures&&Dt.rebindTextures(N,kt.get(N.texture).__webglTexture,kt.get(N.depthTexture).__webglTexture);const gt=N.texture;(gt.isData3DTexture||gt.isDataArrayTexture||gt.isCompressedArrayTexture)&&(st=!0);const Tt=kt.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(xe=Tt[Z],De=!0):be.isWebGL2&&N.samples>0&&Dt.useMultisampledRTT(N)===!1?xe=kt.get(N).__webglMultisampledFramebuffer:xe=Tt,_e.copy(N.viewport),K.copy(N.scissor),ce=N.scissorTest}else _e.copy(Re).multiplyScalar(Me).floor(),K.copy(Fe).multiplyScalar(Me).floor(),ce=Oe;if($e.bindFramebuffer(Te.FRAMEBUFFER,xe)&&be.drawBuffers&&ae&&$e.drawBuffers(N,xe),$e.viewport(_e),$e.scissor(K),$e.setScissorTest(ce),De){const ot=kt.get(N.texture);Te.framebufferTexture2D(Te.FRAMEBUFFER,Te.COLOR_ATTACHMENT0,Te.TEXTURE_CUBE_MAP_POSITIVE_X+Z,ot.__webglTexture,se)}else if(st){const ot=kt.get(N.texture),gt=Z||0;Te.framebufferTextureLayer(Te.FRAMEBUFFER,Te.COLOR_ATTACHMENT0,ot.__webglTexture,se||0,gt)}te=-1},this.readRenderTargetPixels=function(N,Z,se,ae,xe,De,st){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ht=kt.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&st!==void 0&&(ht=ht[st]),ht){$e.bindFramebuffer(Te.FRAMEBUFFER,ht);try{const ot=N.texture,gt=ot.format,Tt=ot.type;if(gt!==Rn&&He.convert(gt)!==Te.getParameter(Te.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Ht=Tt===wr&&(Zt.has("EXT_color_buffer_half_float")||be.isWebGL2&&Zt.has("EXT_color_buffer_float"));if(Tt!==vr&&He.convert(Tt)!==Te.getParameter(Te.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Tt===br&&(be.isWebGL2||Zt.has("OES_texture_float")||Zt.has("WEBGL_color_buffer_float")))&&!Ht){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Z>=0&&Z<=N.width-ae&&se>=0&&se<=N.height-xe&&Te.readPixels(Z,se,ae,xe,He.convert(gt),He.convert(Tt),De)}finally{const ot=q!==null?kt.get(q).__webglFramebuffer:null;$e.bindFramebuffer(Te.FRAMEBUFFER,ot)}}},this.copyFramebufferToTexture=function(N,Z,se=0){const ae=Math.pow(2,-se),xe=Math.floor(Z.image.width*ae),De=Math.floor(Z.image.height*ae);Dt.setTexture2D(Z,0),Te.copyTexSubImage2D(Te.TEXTURE_2D,se,0,0,N.x,N.y,xe,De),$e.unbindTexture()},this.copyTextureToTexture=function(N,Z,se,ae=0){const xe=Z.image.width,De=Z.image.height,st=He.convert(se.format),ht=He.convert(se.type);Dt.setTexture2D(se,0),Te.pixelStorei(Te.UNPACK_FLIP_Y_WEBGL,se.flipY),Te.pixelStorei(Te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),Te.pixelStorei(Te.UNPACK_ALIGNMENT,se.unpackAlignment),Z.isDataTexture?Te.texSubImage2D(Te.TEXTURE_2D,ae,N.x,N.y,xe,De,st,ht,Z.image.data):Z.isCompressedTexture?Te.compressedTexSubImage2D(Te.TEXTURE_2D,ae,N.x,N.y,Z.mipmaps[0].width,Z.mipmaps[0].height,st,Z.mipmaps[0].data):Te.texSubImage2D(Te.TEXTURE_2D,ae,N.x,N.y,st,ht,Z.image),ae===0&&se.generateMipmaps&&Te.generateMipmap(Te.TEXTURE_2D),$e.unbindTexture()},this.copyTextureToTexture3D=function(N,Z,se,ae,xe=0){if(R.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const De=N.max.x-N.min.x+1,st=N.max.y-N.min.y+1,ht=N.max.z-N.min.z+1,ot=He.convert(ae.format),gt=He.convert(ae.type);let Tt;if(ae.isData3DTexture)Dt.setTexture3D(ae,0),Tt=Te.TEXTURE_3D;else if(ae.isDataArrayTexture)Dt.setTexture2DArray(ae,0),Tt=Te.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Te.pixelStorei(Te.UNPACK_FLIP_Y_WEBGL,ae.flipY),Te.pixelStorei(Te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ae.premultiplyAlpha),Te.pixelStorei(Te.UNPACK_ALIGNMENT,ae.unpackAlignment);const Ht=Te.getParameter(Te.UNPACK_ROW_LENGTH),zt=Te.getParameter(Te.UNPACK_IMAGE_HEIGHT),si=Te.getParameter(Te.UNPACK_SKIP_PIXELS),xi=Te.getParameter(Te.UNPACK_SKIP_ROWS),Vi=Te.getParameter(Te.UNPACK_SKIP_IMAGES),bi=se.isCompressedTexture?se.mipmaps[0]:se.image;Te.pixelStorei(Te.UNPACK_ROW_LENGTH,bi.width),Te.pixelStorei(Te.UNPACK_IMAGE_HEIGHT,bi.height),Te.pixelStorei(Te.UNPACK_SKIP_PIXELS,N.min.x),Te.pixelStorei(Te.UNPACK_SKIP_ROWS,N.min.y),Te.pixelStorei(Te.UNPACK_SKIP_IMAGES,N.min.z),se.isDataTexture||se.isData3DTexture?Te.texSubImage3D(Tt,xe,Z.x,Z.y,Z.z,De,st,ht,ot,gt,bi.data):se.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Te.compressedTexSubImage3D(Tt,xe,Z.x,Z.y,Z.z,De,st,ht,ot,bi.data)):Te.texSubImage3D(Tt,xe,Z.x,Z.y,Z.z,De,st,ht,ot,gt,bi),Te.pixelStorei(Te.UNPACK_ROW_LENGTH,Ht),Te.pixelStorei(Te.UNPACK_IMAGE_HEIGHT,zt),Te.pixelStorei(Te.UNPACK_SKIP_PIXELS,si),Te.pixelStorei(Te.UNPACK_SKIP_ROWS,xi),Te.pixelStorei(Te.UNPACK_SKIP_IMAGES,Vi),xe===0&&ae.generateMipmaps&&Te.generateMipmap(Tt),$e.unbindTexture()},this.initTexture=function(N){N.isCubeTexture?Dt.setTextureCube(N,0):N.isData3DTexture?Dt.setTexture3D(N,0):N.isDataArrayTexture||N.isCompressedArrayTexture?Dt.setTexture2DArray(N,0):Dt.setTexture2D(N,0),$e.unbindTexture()},this.resetState=function(){G=0,J=0,q=null,$e.reset(),qt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===ni?zs:hu}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===zs?ni:Qr}}class mD extends P1{}mD.prototype.isWebGL1Renderer=!0;class xs extends Zi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class gD{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Vg,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Gs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,c=this.stride;s<c;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ir=new we;class xA{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ir.fromBufferAttribute(this,t),Ir.applyMatrix4(e),this.setXYZ(t,Ir.x,Ir.y,Ir.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ir.fromBufferAttribute(this,t),Ir.applyNormalMatrix(e),this.setXYZ(t,Ir.x,Ir.y,Ir.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ir.fromBufferAttribute(this,t),Ir.transformDirection(e),this.setXYZ(t,Ir.x,Ir.y,Ir.z);return this}setX(e,t){return this.normalized&&(t=nn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=nn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=nn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=nn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Ta(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Ta(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Ta(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Ta(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=nn(t,this.array),i=nn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=nn(t,this.array),i=nn(i,this.array),s=nn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,c){return e=e*this.data.stride+this.offset,this.normalized&&(t=nn(t,this.array),i=nn(i,this.array),s=nn(s,this.array),c=nn(c,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=c,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)t.push(this.data.array[s+c])}return new pn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new xA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let c=0;c<this.itemSize;c++)t.push(this.data.array[s+c])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const U1=new we,F1=new rn,k1=new rn,AD=new we,N1=new pi,Pc=new we,vA=new As;class _D extends oi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new pi,this.bindMatrixInverse=new pi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Er),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Pc.fromBufferAttribute(t,i),this.applyBoneTransform(i,Pc),this.boundingBox.expandByPoint(Pc)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new As),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Pc.fromBufferAttribute(t,i),this.applyBoneTransform(i,Pc),this.boundingSphere.expandByPoint(Pc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}raycast(e,t){this.boundingSphere===null&&this.computeBoundingSphere(),vA.copy(this.boundingSphere),vA.applyMatrix4(this.matrixWorld),e.ray.intersectsSphere(vA)!==!1&&this._computeIntersections(e,t)}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new rn,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const c=1/e.manhattanLength();c!==1/0?e.multiplyScalar(c):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;F1.fromBufferAttribute(s.attributes.skinIndex,e),k1.fromBufferAttribute(s.attributes.skinWeight,e),U1.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let c=0;c<4;c++){const u=k1.getComponent(c);if(u!==0){const a=F1.getComponent(c);N1.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(AD.copy(U1).applyMatrix4(N1),u)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class O1 extends Zi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class bA extends vn{constructor(e=null,t=1,i=1,s,c,u,a,m,A=Pn,x=Pn,b,I){super(null,u,a,m,A,x,s,c,b,I),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const z1=new pi,yD=new pi;class wA{constructor(e=[],t=[]){this.uuid=Gs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new pi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new pi;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let c=0,u=e.length;c<u;c++){const a=e[c]?e[c].matrixWorld:yD;z1.multiplyMatrices(a,t[c]),z1.toArray(i,c*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new wA(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Dv(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new bA(t,e,e,Rn,br);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const c=e.bones[i];let u=t[c];u===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",c),u=new O1),this.bones.push(u),this.boneInverses.push(new pi().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,c=t.length;s<c;s++){const u=t[s];e.bones.push(u.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class G1 extends pn{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Uc=new pi,Q1=new pi,pf=[],V1=new Er,xD=new pi,xu=new oi,vu=new As;class vD extends oi{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new G1(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,xD)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Er),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Uc),V1.copy(e.boundingBox).applyMatrix4(Uc),this.boundingBox.union(V1)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new As),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Uc),vu.copy(e.boundingSphere).applyMatrix4(Uc),this.boundingSphere.union(vu)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,s=this.count;if(xu.geometry=this.geometry,xu.material=this.material,xu.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vu.copy(this.boundingSphere),vu.applyMatrix4(i),e.ray.intersectsSphere(vu)!==!1))for(let c=0;c<s;c++){this.getMatrixAt(c,Uc),Q1.multiplyMatrices(i,Uc),xu.matrixWorld=Q1,xu.raycast(e,pf);for(let u=0,a=pf.length;u<a;u++){const m=pf[u];m.instanceId=c,m.object=this,t.push(m)}pf.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new G1(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class H1 extends qs{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new hi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const W1=new we,q1=new we,$1=new pi,EA=new qp,ff=new As;class SA extends Zi{constructor(e=new ys,t=new H1){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,c=t.count;s<c;s++)W1.fromBufferAttribute(t,s-1),q1.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=W1.distanceTo(q1);e.setAttribute("lineDistance",new oa(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,c=e.params.Line.threshold,u=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),ff.copy(i.boundingSphere),ff.applyMatrix4(s),ff.radius+=c,e.ray.intersectsSphere(ff)===!1)return;$1.copy(s).invert(),EA.copy(e.ray).applyMatrix4($1);const a=c/((this.scale.x+this.scale.y+this.scale.z)/3),m=a*a,A=new we,x=new we,b=new we,I=new we,E=this.isLineSegments?2:1,T=i.index,P=i.attributes.position;if(T!==null){const R=Math.max(0,u.start),X=Math.min(T.count,u.start+u.count);for(let G=R,J=X-1;G<J;G+=E){const q=T.getX(G),te=T.getX(G+1);if(A.fromBufferAttribute(P,q),x.fromBufferAttribute(P,te),EA.distanceSqToSegment(A,x,I,b)>m)continue;I.applyMatrix4(this.matrixWorld);const _e=e.ray.origin.distanceTo(I);_e<e.near||_e>e.far||t.push({distance:_e,point:b.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else{const R=Math.max(0,u.start),X=Math.min(P.count,u.start+u.count);for(let G=R,J=X-1;G<J;G+=E){if(A.fromBufferAttribute(P,G),x.fromBufferAttribute(P,G+1),EA.distanceSqToSegment(A,x,I,b)>m)continue;I.applyMatrix4(this.matrixWorld);const te=e.ray.origin.distanceTo(I);te<e.near||te>e.far||t.push({distance:te,point:b.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,u=s.length;c<u;c++){const a=s[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=c}}}}}const j1=new we,X1=new we;class bD extends SA{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,c=t.count;s<c;s+=2)j1.fromBufferAttribute(t,s),X1.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+j1.distanceTo(X1);e.setAttribute("lineDistance",new oa(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class wD extends SA{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Y1 extends qs{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new hi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const K1=new pi,IA=new qp,mf=new As,gf=new we;class ED extends Zi{constructor(e=new ys,t=new Y1){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,c=e.params.Points.threshold,u=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),mf.copy(i.boundingSphere),mf.applyMatrix4(s),mf.radius+=c,e.ray.intersectsSphere(mf)===!1)return;K1.copy(s).invert(),IA.copy(e.ray).applyMatrix4(K1);const a=c/((this.scale.x+this.scale.y+this.scale.z)/3),m=a*a,A=i.index,b=i.attributes.position;if(A!==null){const I=Math.max(0,u.start),E=Math.min(A.count,u.start+u.count);for(let T=I,U=E;T<U;T++){const P=A.getX(T);gf.fromBufferAttribute(b,P),Z1(gf,P,m,s,e,t,this)}}else{const I=Math.max(0,u.start),E=Math.min(b.count,u.start+u.count);for(let T=I,U=E;T<U;T++)gf.fromBufferAttribute(b,T),Z1(gf,T,m,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,u=s.length;c<u;c++){const a=s[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=c}}}}}function Z1(o,e,t,i,s,c,u){const a=IA.distanceSqToPoint(o);if(a<t){const m=new we;IA.closestPointToPoint(o,m),m.applyMatrix4(i);const A=s.ray.origin.distanceTo(m);if(A<s.near||A>s.far)return;c.push({distance:A,distanceToRay:Math.sqrt(a),point:m,index:e,face:null,object:u})}}class SD extends vn{constructor(e,t,i,s,c,u,a,m,A){super(e,t,i,s,c,u,a,m,A),this.isVideoTexture=!0,this.minFilter=u!==void 0?u:dn,this.magFilter=c!==void 0?c:dn,this.generateMipmaps=!1;const x=this;function b(){x.needsUpdate=!0,e.requestVideoFrameCallback(b)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(b)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class J1 extends vn{constructor(e,t,i,s,c,u,a,m,A,x,b,I){super(null,u,a,m,A,x,s,c,b,I),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class ID extends J1{constructor(e,t,i,s,c,u){super(e,t,i,c,u),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=tr}}class eb extends vn{constructor(e,t,i,s,c,u,a,m,A){super(e,t,i,s,c,u,a,m,A),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ha extends qs{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new hi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new hi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Tv,this.normalScale=new yi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class gl extends ha{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Qn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new hi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new hi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new hi(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function yo(o,e,t){return tb(o)?new o.constructor(o.subarray(e,t!==void 0?t:o.length)):o.slice(e,t)}function Af(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)}function tb(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)}function CD(o){function e(s,c){return o[s]-o[c]}const t=o.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function ib(o,e,t){const i=o.length,s=new o.constructor(i);for(let c=0,u=0;u!==i;++c){const a=t[c]*e;for(let m=0;m!==e;++m)s[u++]=o[a+m]}return s}function nb(o,e,t,i){let s=1,c=o[0];for(;c!==void 0&&c[i]===void 0;)c=o[s++];if(c===void 0)return;let u=c[i];if(u!==void 0)if(Array.isArray(u))do u=c[i],u!==void 0&&(e.push(c.time),t.push.apply(t,u)),c=o[s++];while(c!==void 0);else if(u.toArray!==void 0)do u=c[i],u!==void 0&&(e.push(c.time),u.toArray(t,t.length)),c=o[s++];while(c!==void 0);else do u=c[i],u!==void 0&&(e.push(c.time),t.push(u)),c=o[s++];while(c!==void 0)}class bu{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],c=t[i-1];e:{t:{let u;i:{n:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<c)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(c=s,s=t[++i],e<s)break t}u=t.length;break i}if(!(e>=c)){const a=t[1];e<a&&(i=2,c=a);for(let m=i-2;;){if(c===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===m)break;if(s=c,c=t[--i-1],e>=c)break t}u=i,i=0;break i}break e}for(;i<u;){const a=i+u>>>1;e<t[a]?u=a:i=a+1}if(s=t[i],c=t[i-1],c===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,c,s)}return this.interpolate_(i,c,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,c=e*s;for(let u=0;u!==s;++u)t[u]=i[c+u];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class MD extends bu{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:cc,endingEnd:cc}}intervalChanged_(e,t,i){const s=this.parameterPositions;let c=e-2,u=e+1,a=s[c],m=s[u];if(a===void 0)switch(this.getSettings_().endingStart){case hc:c=e,a=2*t-i;break;case zp:c=s.length-2,a=t+s[c]-s[c+1];break;default:c=e,a=i}if(m===void 0)switch(this.getSettings_().endingEnd){case hc:u=e,m=2*i-t;break;case zp:u=1,m=i+s[1]-s[0];break;default:u=e-1,m=t}const A=(i-t)*.5,x=this.valueSize;this._weightPrev=A/(t-a),this._weightNext=A/(m-i),this._offsetPrev=c*x,this._offsetNext=u*x}interpolate_(e,t,i,s){const c=this.resultBuffer,u=this.sampleValues,a=this.valueSize,m=e*a,A=m-a,x=this._offsetPrev,b=this._offsetNext,I=this._weightPrev,E=this._weightNext,T=(i-t)/(s-t),U=T*T,P=U*T,R=-I*P+2*I*U-I*T,X=(1+I)*P+(-1.5-2*I)*U+(-.5+I)*T+1,G=(-1-E)*P+(1.5+E)*U+.5*T,J=E*P-E*U;for(let q=0;q!==a;++q)c[q]=R*u[x+q]+X*u[A+q]+G*u[m+q]+J*u[b+q];return c}}class rb extends bu{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const c=this.resultBuffer,u=this.sampleValues,a=this.valueSize,m=e*a,A=m-a,x=(i-t)/(s-t),b=1-x;for(let I=0;I!==a;++I)c[I]=u[A+I]*b+u[m+I]*x;return c}}class TD extends bu{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class ua{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Af(t,this.TimeBufferType),this.values=Af(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Af(e.times,Array),values:Af(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new TD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new rb(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new MD(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ll:t=this.InterpolantFactoryMethodDiscrete;break;case uo:t=this.InterpolantFactoryMethodLinear;break;case Og:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ll;case this.InterpolantFactoryMethodLinear:return uo;case this.InterpolantFactoryMethodSmooth:return Og}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let c=0,u=s-1;for(;c!==s&&i[c]<e;)++c;for(;u!==-1&&i[u]>t;)--u;if(++u,c!==0||u!==s){c>=u&&(u=Math.max(u,1),c=u-1);const a=this.getValueSize();this.times=yo(i,c,u),this.values=yo(this.values,c*a,u*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,c=i.length;c===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let u=null;for(let a=0;a!==c;a++){const m=i[a];if(typeof m=="number"&&isNaN(m)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,m),e=!1;break}if(u!==null&&u>m){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,m,u),e=!1;break}u=m}if(s!==void 0&&tb(s))for(let a=0,m=s.length;a!==m;++a){const A=s[a];if(isNaN(A)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,A),e=!1;break}}return e}optimize(){const e=yo(this.times),t=yo(this.values),i=this.getValueSize(),s=this.getInterpolation()===Og,c=e.length-1;let u=1;for(let a=1;a<c;++a){let m=!1;const A=e[a],x=e[a+1];if(A!==x&&(a!==1||A!==e[0]))if(s)m=!0;else{const b=a*i,I=b-i,E=b+i;for(let T=0;T!==i;++T){const U=t[b+T];if(U!==t[I+T]||U!==t[E+T]){m=!0;break}}}if(m){if(a!==u){e[u]=e[a];const b=a*i,I=u*i;for(let E=0;E!==i;++E)t[I+E]=t[b+E]}++u}}if(c>0){e[u]=e[c];for(let a=c*i,m=u*i,A=0;A!==i;++A)t[m+A]=t[a+A];++u}return u!==e.length?(this.times=yo(e,0,u),this.values=yo(t,0,u*i)):(this.times=e,this.values=t),this}clone(){const e=yo(this.times,0),t=yo(this.values,0),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}ua.prototype.TimeBufferType=Float32Array,ua.prototype.ValueBufferType=Float32Array,ua.prototype.DefaultInterpolation=uo;class Fc extends ua{}Fc.prototype.ValueTypeName="bool",Fc.prototype.ValueBufferType=Array,Fc.prototype.DefaultInterpolation=ll,Fc.prototype.InterpolantFactoryMethodLinear=void 0,Fc.prototype.InterpolantFactoryMethodSmooth=void 0;class sb extends ua{}sb.prototype.ValueTypeName="color";class wu extends ua{}wu.prototype.ValueTypeName="number";class BD extends bu{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const c=this.resultBuffer,u=this.sampleValues,a=this.valueSize,m=(i-t)/(s-t);let A=e*a;for(let x=A+a;A!==x;A+=4)gs.slerpFlat(c,0,u,A-a,u,A,m);return c}}class Al extends ua{InterpolantFactoryMethodLinear(e){return new BD(this.times,this.values,this.getValueSize(),e)}}Al.prototype.ValueTypeName="quaternion",Al.prototype.DefaultInterpolation=uo,Al.prototype.InterpolantFactoryMethodSmooth=void 0;class kc extends ua{}kc.prototype.ValueTypeName="string",kc.prototype.ValueBufferType=Array,kc.prototype.DefaultInterpolation=ll,kc.prototype.InterpolantFactoryMethodLinear=void 0,kc.prototype.InterpolantFactoryMethodSmooth=void 0;class Eu extends ua{}Eu.prototype.ValueTypeName="vector";class CA{constructor(e,t=-1,i,s=zg){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Gs(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let u=0,a=i.length;u!==a;++u)t.push(LD(i[u]).scale(s));const c=new this(e.name,e.duration,t,e.blendMode);return c.uuid=e.uuid,c}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let c=0,u=i.length;c!==u;++c)t.push(ua.toJSON(i[c]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const c=t.length,u=[];for(let a=0;a<c;a++){let m=[],A=[];m.push((a+c-1)%c,a,(a+1)%c),A.push(0,1,0);const x=CD(m);m=ib(m,1,x),A=ib(A,1,x),!s&&m[0]===0&&(m.push(c),A.push(A[0])),u.push(new wu(".morphTargetInfluences["+t[a].name+"]",m,A).scale(1/i))}return new this(e,-1,u)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},c=/^([\w-]*?)([\d]+)$/;for(let a=0,m=e.length;a<m;a++){const A=e[a],x=A.name.match(c);if(x&&x.length>1){const b=x[1];let I=s[b];I||(s[b]=I=[]),I.push(A)}}const u=[];for(const a in s)u.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return u}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(b,I,E,T,U){if(E.length!==0){const P=[],R=[];nb(E,P,R,T),P.length!==0&&U.push(new b(I,P,R))}},s=[],c=e.name||"default",u=e.fps||30,a=e.blendMode;let m=e.length||-1;const A=e.hierarchy||[];for(let b=0;b<A.length;b++){const I=A[b].keys;if(!(!I||I.length===0))if(I[0].morphTargets){const E={};let T;for(T=0;T<I.length;T++)if(I[T].morphTargets)for(let U=0;U<I[T].morphTargets.length;U++)E[I[T].morphTargets[U]]=-1;for(const U in E){const P=[],R=[];for(let X=0;X!==I[T].morphTargets.length;++X){const G=I[T];P.push(G.time),R.push(G.morphTarget===U?1:0)}s.push(new wu(".morphTargetInfluence["+U+"]",P,R))}m=E.length*u}else{const E=".bones["+t[b].name+"]";i(Eu,E+".position",I,"pos",s),i(Al,E+".quaternion",I,"rot",s),i(Eu,E+".scale",I,"scl",s)}}return s.length===0?null:new this(c,m,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const c=this.tracks[i];t=Math.max(t,c.times[c.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function RD(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wu;case"vector":case"vector2":case"vector3":case"vector4":return Eu;case"color":return sb;case"quaternion":return Al;case"bool":case"boolean":return Fc;case"string":return kc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function LD(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=RD(o.type);if(o.times===void 0){const t=[],i=[];nb(o.keys,t,i,"value"),o.times=t,o.values=i}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}const Nc={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class DD{constructor(e,t,i){const s=this;let c=!1,u=0,a=0,m;const A=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(x){a++,c===!1&&s.onStart!==void 0&&s.onStart(x,u,a),c=!0},this.itemEnd=function(x){u++,s.onProgress!==void 0&&s.onProgress(x,u,a),u===a&&(c=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(x){s.onError!==void 0&&s.onError(x)},this.resolveURL=function(x){return m?m(x):x},this.setURLModifier=function(x){return m=x,this},this.addHandler=function(x,b){return A.push(x,b),this},this.removeHandler=function(x){const b=A.indexOf(x);return b!==-1&&A.splice(b,2),this},this.getHandler=function(x){for(let b=0,I=A.length;b<I;b+=2){const E=A[b],T=A[b+1];if(E.global&&(E.lastIndex=0),E.test(x))return T}return null}}}const PD=new DD;class xo{constructor(e){this.manager=e!==void 0?e:PD,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,c){i.load(e,s,t,c)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Na={};class UD extends Error{constructor(e,t){super(e),this.response=t}}class vo extends xo{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=Nc.get(e);if(c!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(c),this.manager.itemEnd(e)},0),c;if(Na[e]!==void 0){Na[e].push({onLoad:t,onProgress:i,onError:s});return}Na[e]=[],Na[e].push({onLoad:t,onProgress:i,onError:s});const u=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,m=this.responseType;fetch(u).then(A=>{if(A.status===200||A.status===0){if(A.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||A.body===void 0||A.body.getReader===void 0)return A;const x=Na[e],b=A.body.getReader(),I=A.headers.get("Content-Length")||A.headers.get("X-File-Size"),E=I?parseInt(I):0,T=E!==0;let U=0;const P=new ReadableStream({start(R){X();function X(){b.read().then(({done:G,value:J})=>{if(G)R.close();else{U+=J.byteLength;const q=new ProgressEvent("progress",{lengthComputable:T,loaded:U,total:E});for(let te=0,ue=x.length;te<ue;te++){const _e=x[te];_e.onProgress&&_e.onProgress(q)}R.enqueue(J),X()}})}}});return new Response(P)}else throw new UD(`fetch for "${A.url}" responded with ${A.status}: ${A.statusText}`,A)}).then(A=>{switch(m){case"arraybuffer":return A.arrayBuffer();case"blob":return A.blob();case"document":return A.text().then(x=>new DOMParser().parseFromString(x,a));case"json":return A.json();default:if(a===void 0)return A.text();{const b=/charset="?([^;"\s]*)"?/i.exec(a),I=b&&b[1]?b[1].toLowerCase():void 0,E=new TextDecoder(I);return A.arrayBuffer().then(T=>E.decode(T))}}}).then(A=>{Nc.add(e,A);const x=Na[e];delete Na[e];for(let b=0,I=x.length;b<I;b++){const E=x[b];E.onLoad&&E.onLoad(A)}}).catch(A=>{const x=Na[e];if(x===void 0)throw this.manager.itemError(e),A;delete Na[e];for(let b=0,I=x.length;b<I;b++){const E=x[b];E.onError&&E.onError(A)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class FD extends xo{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=this,u=Nc.get(e);if(u!==void 0)return c.manager.itemStart(e),setTimeout(function(){t&&t(u),c.manager.itemEnd(e)},0),u;const a=pu("img");function m(){x(),Nc.add(e,this),t&&t(this),c.manager.itemEnd(e)}function A(b){x(),s&&s(b),c.manager.itemError(e),c.manager.itemEnd(e)}function x(){a.removeEventListener("load",m,!1),a.removeEventListener("error",A,!1)}return a.addEventListener("load",m,!1),a.addEventListener("error",A,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),c.manager.itemStart(e),a.src=e,a}}class kD extends xo{constructor(e){super(e)}load(e,t,i,s){const c=this,u=new bA,a=new vo(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(c.withCredentials),a.load(e,function(m){const A=c.parse(m);!A||(A.image!==void 0?u.image=A.image:A.data!==void 0&&(u.image.width=A.width,u.image.height=A.height,u.image.data=A.data),u.wrapS=A.wrapS!==void 0?A.wrapS:tr,u.wrapT=A.wrapT!==void 0?A.wrapT:tr,u.magFilter=A.magFilter!==void 0?A.magFilter:dn,u.minFilter=A.minFilter!==void 0?A.minFilter:dn,u.anisotropy=A.anisotropy!==void 0?A.anisotropy:1,A.colorSpace!==void 0?u.colorSpace=A.colorSpace:A.encoding!==void 0&&(u.encoding=A.encoding),A.flipY!==void 0&&(u.flipY=A.flipY),A.format!==void 0&&(u.format=A.format),A.type!==void 0&&(u.type=A.type),A.mipmaps!==void 0&&(u.mipmaps=A.mipmaps,u.minFilter=Os),A.mipmapCount===1&&(u.minFilter=dn),A.generateMipmaps!==void 0&&(u.generateMipmaps=A.generateMipmaps),u.needsUpdate=!0,t&&t(u,A))},i,s),u}}class ab extends xo{constructor(e){super(e)}load(e,t,i,s){const c=new vn,u=new FD(this.manager);return u.setCrossOrigin(this.crossOrigin),u.setPath(this.path),u.load(e,function(a){c.image=a,c.needsUpdate=!0,t!==void 0&&t(c)},i,s),c}}class _f extends Zi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new hi(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const MA=new pi,ob=new we,lb=new we;class TA{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yi(512,512),this.map=null,this.mapPass=null,this.matrix=new pi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pA,this._frameExtents=new yi(1,1),this._viewportCount=1,this._viewports=[new rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;ob.setFromMatrixPosition(e.matrixWorld),t.position.copy(ob),lb.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(lb),t.updateMatrixWorld(),MA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(MA),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(MA)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ND extends TA{constructor(){super(new ir(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=uc*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,c=e.distance||t.far;(i!==t.fov||s!==t.aspect||c!==t.far)&&(t.fov=i,t.aspect=s,t.far=c,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class OD extends _f{constructor(e,t,i=0,s=Math.PI/3,c=0,u=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Zi.DEFAULT_UP),this.updateMatrix(),this.target=new Zi,this.distance=i,this.angle=s,this.penumbra=c,this.decay=u,this.map=null,this.shadow=new ND}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const cb=new pi,Su=new we,BA=new we;class zD extends TA{constructor(){super(new ir(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new yi(4,2),this._viewportCount=6,this._viewports=[new rn(2,1,1,1),new rn(0,1,1,1),new rn(3,1,1,1),new rn(1,1,1,1),new rn(3,0,1,1),new rn(1,0,1,1)],this._cubeDirections=[new we(1,0,0),new we(-1,0,0),new we(0,0,1),new we(0,0,-1),new we(0,1,0),new we(0,-1,0)],this._cubeUps=[new we(0,1,0),new we(0,1,0),new we(0,1,0),new we(0,1,0),new we(0,0,1),new we(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,c=e.distance||i.far;c!==i.far&&(i.far=c,i.updateProjectionMatrix()),Su.setFromMatrixPosition(e.matrixWorld),i.position.copy(Su),BA.copy(i.position),BA.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(BA),i.updateMatrixWorld(),s.makeTranslation(-Su.x,-Su.y,-Su.z),cb.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cb)}}class RA extends _f{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new zD}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class GD extends TA{constructor(){super(new Bc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class hb extends _f{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Zi.DEFAULT_UP),this.updateMatrix(),this.target=new Zi,this.shadow=new GD}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class QD{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new we)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,c=e.z,u=this.coefficients;return t.copy(u[0]).multiplyScalar(.282095),t.addScaledVector(u[1],.488603*s),t.addScaledVector(u[2],.488603*c),t.addScaledVector(u[3],.488603*i),t.addScaledVector(u[4],1.092548*(i*s)),t.addScaledVector(u[5],1.092548*(s*c)),t.addScaledVector(u[6],.315392*(3*c*c-1)),t.addScaledVector(u[7],1.092548*(i*c)),t.addScaledVector(u[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,c=e.z,u=this.coefficients;return t.copy(u[0]).multiplyScalar(.886227),t.addScaledVector(u[1],2*.511664*s),t.addScaledVector(u[2],2*.511664*c),t.addScaledVector(u[3],2*.511664*i),t.addScaledVector(u[4],2*.429043*i*s),t.addScaledVector(u[5],2*.429043*s*c),t.addScaledVector(u[6],.743125*c*c-.247708),t.addScaledVector(u[7],2*.429043*i*c),t.addScaledVector(u[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,c=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*c,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*c,t[6]=.315392*(3*c*c-1),t[7]=1.092548*i*c,t[8]=.546274*(i*i-s*s)}}class VD extends _f{constructor(e=new QD,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class LA{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class HD extends xo{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=this,u=Nc.get(e);if(u!==void 0)return c.manager.itemStart(e),setTimeout(function(){t&&t(u),c.manager.itemEnd(e)},0),u;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(m){return m.blob()}).then(function(m){return createImageBitmap(m,Object.assign(c.options,{colorSpaceConversion:"none"}))}).then(function(m){Nc.add(e,m),t&&t(m),c.manager.itemEnd(e)}).catch(function(m){s&&s(m),c.manager.itemError(e),c.manager.itemEnd(e)}),c.manager.itemStart(e)}}class WD{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,c,u;switch(t){case"quaternion":s=this._slerp,c=this._slerpAdditive,u=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,c=this._select,u=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,c=this._lerpAdditive,u=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=c,this._setIdentity=u,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,c=e*s+s;let u=this.cumulativeWeight;if(u===0){for(let a=0;a!==s;++a)i[c+a]=i[a];u=t}else{u+=t;const a=t/u;this._mixBufferRegion(i,c,0,a,s)}this.cumulativeWeight=u}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,c=this.cumulativeWeight,u=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,c<1){const m=t*this._origIndex;this._mixBufferRegion(i,s,m,1-c,t)}u>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let m=t,A=t+t;m!==A;++m)if(i[m]!==i[m+t]){a.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let c=i,u=s;c!==u;++c)t[c]=t[s+c%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,c){if(s>=.5)for(let u=0;u!==c;++u)e[t+u]=e[i+u]}_slerp(e,t,i,s){gs.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,c){const u=this._workIndex*c;gs.multiplyQuaternionsFlat(e,u,e,t,e,i),gs.slerpFlat(e,t,e,t,e,u,s)}_lerp(e,t,i,s,c){const u=1-s;for(let a=0;a!==c;++a){const m=t+a;e[m]=e[m]*u+e[i+a]*s}}_lerpAdditive(e,t,i,s,c){for(let u=0;u!==c;++u){const a=t+u;e[a]=e[a]+e[i+u]*s}}}const DA="\\[\\]\\.:\\/",qD=new RegExp("["+DA+"]","g"),PA="[^"+DA+"]",$D="[^"+DA.replace("\\.","")+"]",jD=/((?:WC+[\/:])*)/.source.replace("WC",PA),XD=/(WCOD+)?/.source.replace("WCOD",$D),YD=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",PA),KD=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",PA),ZD=new RegExp("^"+jD+XD+YD+KD+"$"),JD=["material","materials","bones","map"];class eP{constructor(e,t,i){const s=i||Si.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,c=i.length;s!==c;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Si{constructor(e,t,i){this.path=t,this.parsedPath=i||Si.parseTrackName(t),this.node=Si.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Si.Composite(e,t,i):new Si(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(qD,"")}static parseTrackName(e){const t=ZD.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const c=i.nodeName.substring(s+1);JD.indexOf(c)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=c)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(c){for(let u=0;u<c.length;u++){const a=c[u];if(a.name===t||a.uuid===t)return a;const m=i(a.children);if(m)return m}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,c=i.length;s!==c;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,c=i.length;s!==c;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,c=i.length;s!==c;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,c=i.length;s!==c;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let c=t.propertyIndex;if(e||(e=Si.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let A=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let x=0;x<e.length;x++)if(e[x].name===A){A=x;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(A!==void 0){if(e[A]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[A]}}const u=e[s];if(u===void 0){const A=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+A+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let m=this.BindingType.Direct;if(c!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[c]!==void 0&&(c=e.morphTargetDictionary[c])}m=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=c}else u.fromArray!==void 0&&u.toArray!==void 0?(m=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(m=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=s;this.getValue=this.GetterByBindingType[m],this.setValue=this.SetterByBindingTypeAndVersioning[m][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Si.Composite=eP,Si.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Si.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Si.prototype.GetterByBindingType=[Si.prototype._getValue_direct,Si.prototype._getValue_array,Si.prototype._getValue_arrayElement,Si.prototype._getValue_toArray],Si.prototype.SetterByBindingTypeAndVersioning=[[Si.prototype._setValue_direct,Si.prototype._setValue_direct_setNeedsUpdate,Si.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Si.prototype._setValue_array,Si.prototype._setValue_array_setNeedsUpdate,Si.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Si.prototype._setValue_arrayElement,Si.prototype._setValue_arrayElement_setNeedsUpdate,Si.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Si.prototype._setValue_fromArray,Si.prototype._setValue_fromArray_setNeedsUpdate,Si.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class tP{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const c=t.tracks,u=c.length,a=new Array(u),m={endingStart:cc,endingEnd:cc};for(let A=0;A!==u;++A){const x=c[A].createInterpolant(null);a[A]=x,x.settings=m}this._interpolantSettings=m,this._interpolants=a,this._propertyBindings=new Array(u),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=kg,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,c=e._clip.duration,u=c/s,a=s/c;e.warp(1,u,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,c=s.time,u=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const m=a.parameterPositions,A=a.sampleValues;return m[0]=c,m[1]=c+i,A[0]=e/u,A[1]=t/u,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const c=this._startTime;if(c!==null){const m=(e-c)*i;m<0||i===0?t=0:(this._startTime=null,t=i*m)}t*=this._updateTimeScale(e);const u=this._updateTime(t),a=this._updateWeight(e);if(a>0){const m=this._interpolants,A=this._propertyBindings;switch(this.blendMode){case BT:for(let x=0,b=m.length;x!==b;++x)m[x].evaluate(u),A[x].accumulateAdditive(a);break;case zg:default:for(let x=0,b=m.length;x!==b;++x)m[x].evaluate(u),A[x].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,c=this._loopCount;const u=i===Ng;if(e===0)return c===-1?s:u&&(c&1)===1?t-s:s;if(i===Cv){c===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(c===-1&&(e>=0?(c=0,this._setEndings(!0,this.repetitions===0,u)):this._setEndings(this.repetitions===0,!0,u)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,c+=Math.abs(a);const m=this.repetitions-c;if(m<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(m===1){const A=e<0;this._setEndings(A,!A,u)}else this._setEndings(!1,!1,u);this._loopCount=c,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(u&&(c&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=hc,s.endingEnd=hc):(e?s.endingStart=this.zeroSlopeAtStart?hc:cc:s.endingStart=zp,t?s.endingEnd=this.zeroSlopeAtEnd?hc:cc:s.endingEnd=zp)}_scheduleFading(e,t,i){const s=this._mixer,c=s.time;let u=this._weightInterpolant;u===null&&(u=s._lendControlInterpolant(),this._weightInterpolant=u);const a=u.parameterPositions,m=u.sampleValues;return a[0]=c,m[0]=t,a[1]=c+e,m[1]=i,this}}const iP=new Float32Array(1);class nP extends ms{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,c=s.length,u=e._propertyBindings,a=e._interpolants,m=i.uuid,A=this._bindingsByRootAndName;let x=A[m];x===void 0&&(x={},A[m]=x);for(let b=0;b!==c;++b){const I=s[b],E=I.name;let T=x[E];if(T!==void 0)++T.referenceCount,u[b]=T;else{if(T=u[b],T!==void 0){T._cacheIndex===null&&(++T.referenceCount,this._addInactiveBinding(T,m,E));continue}const U=t&&t._propertyBindings[b].binding.parsedPath;T=new WD(Si.create(i,E,U),I.ValueTypeName,I.getValueSize()),++T.referenceCount,this._addInactiveBinding(T,m,E),u[b]=T}a[b].resultBuffer=T.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,c=this._actionsByClip[s];this._bindAction(e,c&&c.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const c=t[i];c.useCount++===0&&(this._lendBinding(c),c.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const c=t[i];--c.useCount===0&&(c.restoreOriginalState(),this._takeBackBinding(c))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,c=this._actionsByClip;let u=c[t];if(u===void 0)u={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,c[t]=u;else{const a=u.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),u.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const c=e._clip.uuid,u=this._actionsByClip,a=u[c],m=a.knownActions,A=m[m.length-1],x=e._byClipCacheIndex;A._byClipCacheIndex=x,m[x]=A,m.pop(),e._byClipCacheIndex=null;const b=a.actionByRoot,I=(e._localRoot||this._root).uuid;delete b[I],m.length===0&&delete u[c],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const c=t[i];--c.referenceCount===0&&this._removeInactiveBinding(c)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,c=t[s];e._cacheIndex=s,t[s]=e,c._cacheIndex=i,t[i]=c}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,c=t[s];e._cacheIndex=s,t[s]=e,c._cacheIndex=i,t[i]=c}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,c=this._bindings;let u=s[t];u===void 0&&(u={},s[t]=u),u[i]=e,e._cacheIndex=c.length,c.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,c=i.path,u=this._bindingsByRootAndName,a=u[s],m=t[t.length-1],A=e._cacheIndex;m._cacheIndex=A,t[A]=m,t.pop(),delete a[c],Object.keys(a).length===0&&delete u[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,c=t[s];e._cacheIndex=s,t[s]=e,c._cacheIndex=i,t[i]=c}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,c=t[s];e._cacheIndex=s,t[s]=e,c._cacheIndex=i,t[i]=c}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new rb(new Float32Array(2),new Float32Array(2),1,iP),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,c=t[s];e.__cacheIndex=s,t[s]=e,c.__cacheIndex=i,t[i]=c}clipAction(e,t,i){const s=t||this._root,c=s.uuid;let u=typeof e=="string"?CA.findByName(s,e):e;const a=u!==null?u.uuid:e,m=this._actionsByClip[a];let A=null;if(i===void 0&&(u!==null?i=u.blendMode:i=zg),m!==void 0){const b=m.actionByRoot[c];if(b!==void 0&&b.blendMode===i)return b;A=m.knownActions[0],u===null&&(u=A._clip)}if(u===null)return null;const x=new tP(this,u,t,i);return this._bindAction(x,A),this._addInactiveAction(x,a,c),x}existingAction(e,t){const i=t||this._root,s=i.uuid,c=typeof e=="string"?CA.findByName(i,e):e,u=c?c.uuid:e,a=this._actionsByClip[u];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,c=Math.sign(e),u=this._accuIndex^=1;for(let A=0;A!==i;++A)t[A]._update(s,e,c,u);const a=this._bindings,m=this._nActiveBindings;for(let A=0;A!==m;++A)a[A].apply(u);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,c=s[i];if(c!==void 0){const u=c.knownActions;for(let a=0,m=u.length;a!==m;++a){const A=u[a];this._deactivateAction(A);const x=A._cacheIndex,b=t[t.length-1];A._cacheIndex=null,A._byClipCacheIndex=null,b._cacheIndex=x,t[x]=b,t.pop(),this._removeInactiveBindingsForAction(A)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const u in i){const a=i[u].actionByRoot,m=a[t];m!==void 0&&(this._deactivateAction(m),this._removeInactiveAction(m))}const s=this._bindingsByRootAndName,c=s[t];if(c!==void 0)for(const u in c){const a=c[u];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class rP{constructor(e,t,i=0,s=1/0){this.ray=new qp(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new iA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return UA(e,this,i,t),i.sort(ub),i}intersectObjects(e,t=!0,i=[]){for(let s=0,c=e.length;s<c;s++)UA(e[s],this,i,t);return i.sort(ub),i}}function ub(o,e){return o.distance-e.distance}function UA(o,e,t,i){if(o.layers.test(e.layers)&&o.raycast(e,t),i===!0){const s=o.children;for(let c=0,u=s.length;c<u;c++)UA(s[c],e,t,!0)}}class yf{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Qn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Cg}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Cg);var sP=Object.defineProperty,aP=Object.defineProperties,oP=Object.getOwnPropertyDescriptors,db=Object.getOwnPropertySymbols,lP=Object.getPrototypeOf,cP=Object.prototype.hasOwnProperty,hP=Object.prototype.propertyIsEnumerable,uP=Reflect.get,pb=(o,e,t)=>e in o?sP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,dP=(o,e)=>{for(var t in e||(e={}))cP.call(e,t)&&pb(o,t,e[t]);if(db)for(var t of db(e))hP.call(e,t)&&pb(o,t,e[t]);return o},pP=(o,e)=>aP(o,oP(e)),FA=(o,e,t)=>uP(lP(o),t,e),Jt=(o,e,t)=>new Promise((i,s)=>{var c=m=>{try{a(t.next(m))}catch(A){s(A)}},u=m=>{try{a(t.throw(m))}catch(A){s(A)}},a=m=>m.done?i(m.value):Promise.resolve(m.value).then(c,u);a((t=t.apply(o,e)).next())});/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/const fP=(o,e)=>e.kind==="method"&&e.descriptor&&!("value"in e.descriptor)?pP(dP({},e),{finisher(t){t.createProperty(e.key,o)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){typeof e.initializer=="function"&&(this[e.key]=e.initializer.call(this))},finisher(t){t.createProperty(e.key,o)}};function ui(o){return(e,t)=>t!==void 0?((i,s,c)=>{s.constructor.createProperty(c,i)})(o,e,t):fP(o,e)}/**
* @license
* Copyright 2021 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var kA;((kA=window.HTMLSlotElement)===null||kA===void 0?void 0:kA.prototype.assignedElements)!=null;/**
* @license
* Copyright 2019 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/const xf=window,NA=xf.ShadowRoot&&(xf.ShadyCSS===void 0||xf.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,fb=Symbol(),mb=new WeakMap;class mP{constructor(e,t,i){if(this._$cssResult$=!0,i!==fb)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(NA&&e===void 0){const i=t!==void 0&&t.length===1;i&&(e=mb.get(t)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&mb.set(t,e))}return e}toString(){return this.cssText}}const gP=o=>new mP(typeof o=="string"?o:o+"",void 0,fb),AP=(o,e)=>{NA?o.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):e.forEach(t=>{const i=document.createElement("style"),s=xf.litNonce;s!==void 0&&i.setAttribute("nonce",s),i.textContent=t.cssText,o.appendChild(i)})},gb=NA?o=>o:o=>o instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return gP(t)})(o):o;/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var OA;const vf=window,Ab=vf.trustedTypes,_P=Ab?Ab.emptyScript:"",_b=vf.reactiveElementPolyfillSupport,zA={toAttribute(o,e){switch(e){case Boolean:o=o?_P:null;break;case Object:case Array:o=o==null?o:JSON.stringify(o)}return o},fromAttribute(o,e){let t=o;switch(e){case Boolean:t=o!==null;break;case Number:t=o===null?null:Number(o);break;case Object:case Array:try{t=JSON.parse(o)}catch{t=null}}return t}},yb=(o,e)=>e!==o&&(e==e||o==o),GA={attribute:!0,type:String,converter:zA,reflect:!1,hasChanged:yb};class _l extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),((t=this.h)!==null&&t!==void 0?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach((t,i)=>{const s=this._$Ep(i,t);s!==void 0&&(this._$Ev.set(s,i),e.push(s))}),e}static createProperty(e,t=GA){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const i=typeof e=="symbol"?Symbol():"__"+e,s=this.getPropertyDescriptor(e,i,t);s!==void 0&&Object.defineProperty(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){return{get(){return this[t]},set(s){const c=this[e];this[t]=s,this.requestUpdate(e,c,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||GA}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),e.h!==void 0&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,i=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const s of i)this.createProperty(s,t[s])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const s of i)t.unshift(gb(s))}else e!==void 0&&t.push(gb(e));return t}static _$Ep(e,t){const i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$Eg(),this.requestUpdate(),(e=this.constructor.h)===null||e===void 0||e.forEach(t=>t(this))}addController(e){var t,i;((t=this._$ES)!==null&&t!==void 0?t:this._$ES=[]).push(e),this.renderRoot!==void 0&&this.isConnected&&((i=e.hostConnected)===null||i===void 0||i.call(e))}removeController(e){var t;(t=this._$ES)===null||t===void 0||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])})}createRenderRoot(){var e;const t=(e=this.shadowRoot)!==null&&e!==void 0?e:this.attachShadow(this.constructor.shadowRootOptions);return AP(t,this.constructor.elementStyles),t}connectedCallback(){var e;this.renderRoot===void 0&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$ES)===null||e===void 0||e.forEach(t=>{var i;return(i=t.hostConnected)===null||i===void 0?void 0:i.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$ES)===null||e===void 0||e.forEach(t=>{var i;return(i=t.hostDisconnected)===null||i===void 0?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EO(e,t,i=GA){var s;const c=this.constructor._$Ep(e,i);if(c!==void 0&&i.reflect===!0){const u=(((s=i.converter)===null||s===void 0?void 0:s.toAttribute)!==void 0?i.converter:zA).toAttribute(t,i.type);this._$El=e,u==null?this.removeAttribute(c):this.setAttribute(c,u),this._$El=null}}_$AK(e,t){var i;const s=this.constructor,c=s._$Ev.get(e);if(c!==void 0&&this._$El!==c){const u=s.getPropertyOptions(c),a=typeof u.converter=="function"?{fromAttribute:u.converter}:((i=u.converter)===null||i===void 0?void 0:i.fromAttribute)!==void 0?u.converter:zA;this._$El=c,this[c]=a.fromAttribute(t,u.type),this._$El=null}}requestUpdate(e,t,i){let s=!0;e!==void 0&&(((i=i||this.constructor.getPropertyOptions(e)).hasChanged||yb)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$El!==e&&(this._$EC===void 0&&(this._$EC=new Map),this._$EC.set(e,i))):s=!1),!this.isUpdatePending&&s&&(this._$E_=this._$Ej())}_$Ej(){return Jt(this,null,function*(){this.isUpdatePending=!0;try{yield this._$E_}catch(t){Promise.reject(t)}const e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((s,c)=>this[c]=s),this._$Ei=void 0);let t=!1;const i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),(e=this._$ES)===null||e===void 0||e.forEach(s=>{var c;return(c=s.hostUpdate)===null||c===void 0?void 0:c.call(s)}),this.update(i)):this._$Ek()}catch(s){throw t=!1,this._$Ek(),s}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;(t=this._$ES)===null||t===void 0||t.forEach(i=>{var s;return(s=i.hostUpdated)===null||s===void 0?void 0:s.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){this._$EC!==void 0&&(this._$EC.forEach((t,i)=>this._$EO(i,this[i],t)),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}}_l.finalized=!0,_l.elementProperties=new Map,_l.elementStyles=[],_l.shadowRootOptions={mode:"open"},_b?.({ReactiveElement:_l}),((OA=vf.reactiveElementVersions)!==null&&OA!==void 0?OA:vf.reactiveElementVersions=[]).push("1.6.1");/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var QA;const bf=window,Oc=bf.trustedTypes,xb=Oc?Oc.createPolicy("lit-html",{createHTML:o=>o}):void 0,VA="$lit$",bo=`lit$${(Math.random()+"").slice(9)}$`,vb="?"+bo,yP=`<${vb}>`,zc=document,Iu=()=>zc.createComment(""),Cu=o=>o===null||typeof o!="object"&&typeof o!="function",bb=Array.isArray,xP=o=>bb(o)||typeof o?.[Symbol.iterator]=="function",HA=`[ 	
\f\r]`,Mu=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,wb=/-->/g,Eb=/>/g,yl=RegExp(`>|${HA}(?:([^\\s"'>=/]+)(${HA}*=${HA}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Sb=/'/g,Ib=/"/g,Cb=/^(?:script|style|textarea|title)$/i,vP=o=>(e,...t)=>({_$litType$:o,strings:e,values:t}),wf=vP(1),Gc=Symbol.for("lit-noChange"),Hn=Symbol.for("lit-nothing"),Mb=new WeakMap,Qc=zc.createTreeWalker(zc,129,null,!1),bP=(o,e)=>{const t=o.length-1,i=[];let s,c=e===2?"<svg>":"",u=Mu;for(let m=0;m<t;m++){const A=o[m];let x,b,I=-1,E=0;for(;E<A.length&&(u.lastIndex=E,b=u.exec(A),b!==null);)E=u.lastIndex,u===Mu?b[1]==="!--"?u=wb:b[1]!==void 0?u=Eb:b[2]!==void 0?(Cb.test(b[2])&&(s=RegExp("</"+b[2],"g")),u=yl):b[3]!==void 0&&(u=yl):u===yl?b[0]===">"?(u=s??Mu,I=-1):b[1]===void 0?I=-2:(I=u.lastIndex-b[2].length,x=b[1],u=b[3]===void 0?yl:b[3]==='"'?Ib:Sb):u===Ib||u===Sb?u=yl:u===wb||u===Eb?u=Mu:(u=yl,s=void 0);const T=u===yl&&o[m+1].startsWith("/>")?" ":"";c+=u===Mu?A+yP:I>=0?(i.push(x),A.slice(0,I)+VA+A.slice(I)+bo+T):A+bo+(I===-2?(i.push(void 0),m):T)}const a=c+(o[t]||"<?>")+(e===2?"</svg>":"");if(!Array.isArray(o)||!o.hasOwnProperty("raw"))throw Error("invalid template strings array");return[xb!==void 0?xb.createHTML(a):a,i]};class Tu{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let c=0,u=0;const a=e.length-1,m=this.parts,[A,x]=bP(e,t);if(this.el=Tu.createElement(A,i),Qc.currentNode=this.el.content,t===2){const b=this.el.content,I=b.firstChild;I.remove(),b.append(...I.childNodes)}for(;(s=Qc.nextNode())!==null&&m.length<a;){if(s.nodeType===1){if(s.hasAttributes()){const b=[];for(const I of s.getAttributeNames())if(I.endsWith(VA)||I.startsWith(bo)){const E=x[u++];if(b.push(I),E!==void 0){const T=s.getAttribute(E.toLowerCase()+VA).split(bo),U=/([.?@])?(.*)/.exec(E);m.push({type:1,index:c,name:U[2],strings:T,ctor:U[1]==="."?EP:U[1]==="?"?IP:U[1]==="@"?CP:Ef})}else m.push({type:6,index:c})}for(const I of b)s.removeAttribute(I)}if(Cb.test(s.tagName)){const b=s.textContent.split(bo),I=b.length-1;if(I>0){s.textContent=Oc?Oc.emptyScript:"";for(let E=0;E<I;E++)s.append(b[E],Iu()),Qc.nextNode(),m.push({type:2,index:++c});s.append(b[I],Iu())}}}else if(s.nodeType===8)if(s.data===vb)m.push({type:2,index:c});else{let b=-1;for(;(b=s.data.indexOf(bo,b+1))!==-1;)m.push({type:7,index:c}),b+=bo.length-1}c++}}static createElement(e,t){const i=zc.createElement("template");return i.innerHTML=e,i}}function Vc(o,e,t=o,i){var s,c,u,a;if(e===Gc)return e;let m=i!==void 0?(s=t._$Co)===null||s===void 0?void 0:s[i]:t._$Cl;const A=Cu(e)?void 0:e._$litDirective$;return m?.constructor!==A&&((c=m?._$AO)===null||c===void 0||c.call(m,!1),A===void 0?m=void 0:(m=new A(o),m._$AT(o,t,i)),i!==void 0?((u=(a=t)._$Co)!==null&&u!==void 0?u:a._$Co=[])[i]=m:t._$Cl=m),m!==void 0&&(e=Vc(o,m._$AS(o,e.values),m,i)),e}class wP{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:i},parts:s}=this._$AD,c=((t=e?.creationScope)!==null&&t!==void 0?t:zc).importNode(i,!0);Qc.currentNode=c;let u=Qc.nextNode(),a=0,m=0,A=s[0];for(;A!==void 0;){if(a===A.index){let x;A.type===2?x=new Bu(u,u.nextSibling,this,e):A.type===1?x=new A.ctor(u,A.name,A.strings,this,e):A.type===6&&(x=new MP(u,this,e)),this._$AV.push(x),A=s[++m]}a!==A?.index&&(u=Qc.nextNode(),a++)}return c}v(e){let t=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}}class Bu{constructor(e,t,i,s){var c;this.type=2,this._$AH=Hn,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cp=(c=s?.isConnected)===null||c===void 0||c}get _$AU(){var e,t;return(t=(e=this._$AM)===null||e===void 0?void 0:e._$AU)!==null&&t!==void 0?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Vc(this,e,t),Cu(e)?e===Hn||e==null||e===""?(this._$AH!==Hn&&this._$AR(),this._$AH=Hn):e!==this._$AH&&e!==Gc&&this._(e):e._$litType$!==void 0?this.g(e):e.nodeType!==void 0?this.$(e):xP(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Hn&&Cu(this._$AH)?this._$AA.nextSibling.data=e:this.$(zc.createTextNode(e)),this._$AH=e}g(e){var t;const{values:i,_$litType$:s}=e,c=typeof s=="number"?this._$AC(e):(s.el===void 0&&(s.el=Tu.createElement(s.h,this.options)),s);if(((t=this._$AH)===null||t===void 0?void 0:t._$AD)===c)this._$AH.v(i);else{const u=new wP(c,this),a=u.u(this.options);u.v(i),this.$(a),this._$AH=u}}_$AC(e){let t=Mb.get(e.strings);return t===void 0&&Mb.set(e.strings,t=new Tu(e)),t}T(e){bb(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,s=0;for(const c of e)s===t.length?t.push(i=new Bu(this.k(Iu()),this.k(Iu()),this,this.options)):i=t[s],i._$AI(c),s++;s<t.length&&(this._$AR(i&&i._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,t);e&&e!==this._$AB;){const s=e.nextSibling;e.remove(),e=s}}setConnected(e){var t;this._$AM===void 0&&(this._$Cp=e,(t=this._$AP)===null||t===void 0||t.call(this,e))}}class Ef{constructor(e,t,i,s,c){this.type=1,this._$AH=Hn,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=c,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Hn}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,i,s){const c=this.strings;let u=!1;if(c===void 0)e=Vc(this,e,t,0),u=!Cu(e)||e!==this._$AH&&e!==Gc,u&&(this._$AH=e);else{const a=e;let m,A;for(e=c[0],m=0;m<c.length-1;m++)A=Vc(this,a[i+m],t,m),A===Gc&&(A=this._$AH[m]),u||(u=!Cu(A)||A!==this._$AH[m]),A===Hn?e=Hn:e!==Hn&&(e+=(A??"")+c[m+1]),this._$AH[m]=A}u&&!s&&this.j(e)}j(e){e===Hn?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class EP extends Ef{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Hn?void 0:e}}const SP=Oc?Oc.emptyScript:"";class IP extends Ef{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Hn?this.element.setAttribute(this.name,SP):this.element.removeAttribute(this.name)}}class CP extends Ef{constructor(e,t,i,s,c){super(e,t,i,s,c),this.type=5}_$AI(e,t=this){var i;if((e=(i=Vc(this,e,t,0))!==null&&i!==void 0?i:Hn)===Gc)return;const s=this._$AH,c=e===Hn&&s!==Hn||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,u=e!==Hn&&(s===Hn||c);c&&this.element.removeEventListener(this.name,this,s),u&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,i;typeof this._$AH=="function"?this._$AH.call((i=(t=this.options)===null||t===void 0?void 0:t.host)!==null&&i!==void 0?i:this.element,e):this._$AH.handleEvent(e)}}class MP{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Vc(this,e)}}const Tb=bf.litHtmlPolyfillSupport;Tb?.(Tu,Bu),((QA=bf.litHtmlVersions)!==null&&QA!==void 0?QA:bf.litHtmlVersions=[]).push("2.7.3");const Bb=(o,e,t)=>{var i,s;const c=(i=t?.renderBefore)!==null&&i!==void 0?i:e;let u=c._$litPart$;if(u===void 0){const a=(s=t?.renderBefore)!==null&&s!==void 0?s:null;c._$litPart$=u=new Bu(e.insertBefore(Iu(),a),a,void 0,t??{})}return u._$AI(o),u};/**
* @license
* Copyright 2017 Google LLC
* SPDX-License-Identifier: BSD-3-Clause
*/var WA,qA;class Sf extends _l{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const i=super.createRenderRoot();return(e=(t=this.renderOptions).renderBefore)!==null&&e!==void 0||(t.renderBefore=i.firstChild),i}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Bb(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)===null||e===void 0||e.setConnected(!1)}render(){return Gc}}Sf.finalized=!0,Sf._$litElement$=!0,(WA=globalThis.litElementHydrateSupport)===null||WA===void 0||WA.call(globalThis,{LitElement:Sf});const Rb=globalThis.litElementPolyfillSupport;Rb?.({LitElement:Sf}),((qA=globalThis.litElementVersions)!==null&&qA!==void 0?qA:globalThis.litElementVersions=[]).push("3.3.2");/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Lb=navigator.xr!=null&&self.XRSession!=null&&navigator.xr.isSessionSupported!=null,Db=Lb&&self.XRSession.prototype.requestHitTestSource!=null,$A=self.ResizeObserver!=null,jA=self.IntersectionObserver!=null,Pb=Db;(()=>{const o=navigator.userAgent||navigator.vendor||self.opera;let e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(o)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(o.substr(0,4)))&&(e=!0),e})(),/\bCrOS\b/.test(navigator.userAgent);const TP=/android/i.test(navigator.userAgent),Ub=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;/Safari\//.test(navigator.userAgent);const BP=/firefox/i.test(navigator.userAgent),RP=/OculusBrowser/.test(navigator.userAgent);Ub&&/CriOS\//.test(navigator.userAgent);const LP=TP&&!BP&&!RP,DP=Boolean(window.webkit&&window.webkit.messageHandlers),Fb=(()=>{if(Ub){if(DP)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const o=document.createElement("a");return Boolean(o.relList&&o.relList.supports&&o.relList.supports("ar"))}}else return!1})();/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const kb=o=>!!o&&o!=="null"?PP(o):null,Nb=()=>{if(Pb)return;const o=[];throw Lb||o.push("WebXR Device API"),Db||o.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${o.join(", ")}`)},PP=o=>new URL(o,window.location.toString()).toString(),UP=(o,e)=>{let t=null;const i=(...s)=>{t==null&&(o(...s),t=self.setTimeout(()=>t=null,e))};return i.flush=()=>{t!=null&&(self.clearTimeout(t),t=null)},i},Ob=(o,e)=>{let t=null;return(...i)=>{t!=null&&self.clearTimeout(t),t=self.setTimeout(()=>{t=null,o(...i)},e)}},da=(o,e,t)=>Math.max(e,Math.min(t,o)),FP=1,XA=(()=>{const o=(()=>{var e;if(!((e=document.documentElement.getAttribute("itemtype"))===null||e===void 0)&&e.includes("schema.org/SearchResultsPage"))return!0;const t=document.head!=null?Array.from(document.head.querySelectorAll("meta")):[];for(const i of t)if(i.name==="viewport")return!0;return!1})();return o||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),()=>o?window.devicePixelRatio:FP})(),zb=(()=>{const o="model-viewer-debug-mode",e=new RegExp(`[?&]${o}(&|$)`);return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)})(),kP=(o=0)=>new Promise(e=>setTimeout(e,o)),NP=(o,e,t=null)=>new Promise(i=>{function s(c){(!t||t(c))&&(i(c),o.removeEventListener(e,s))}o.addEventListener(e,s)});/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Ru=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};const OP=.5,zP=0,GP=1,QP=1,Lu=Symbol("currentEnvironmentMap"),Du=Symbol("currentBackground"),If=Symbol("updateEnvironment"),Cf=Symbol("cancelEnvironmentUpdate"),VP=o=>{var e,t,i;class s extends o{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=zP,this.shadowSoftness=GP,this.exposure=QP,this[e]=null,this[t]=null,this[i]=null}updated(u){super.updated(u),u.has("shadowIntensity")&&(this[Mt].setShadowIntensity(this.shadowIntensity*OP),this[Hr]()),u.has("shadowSoftness")&&(this[Mt].setShadowSoftness(this.shadowSoftness),this[Hr]()),u.has("exposure")&&(this[Mt].exposure=this.exposure,this[Hr]()),(u.has("environmentImage")||u.has("skyboxImage"))&&this[oh]()&&this[If]()}hasBakedShadow(){return this[Mt].bakedShadows.size>0}[(e=Lu,t=Du,i=Cf,If)](){return Jt(this,null,function*(){const{skyboxImage:u,environmentImage:a}=this;this[Cf]!=null&&(this[Cf](),this[Cf]=null);const{textureUtils:m}=this[$i];if(m==null)return;const A=this[Tl].beginActivity();try{const{environmentMap:x,skybox:b}=yield m.generateEnvironmentMapAndSkybox(kb(u),a,I=>A(da(I,0,1)));this[Lu]!==x&&(this[Lu]=x,this.dispatchEvent(new CustomEvent("environment-change"))),b!=null?this[Du]=b.name===x.name?x:b:this[Du]=null,this[Mt].setEnvironmentAndSkybox(this[Lu],this[Du]),this[Mt].dispatchEvent({type:"envmap-update"})}catch(x){if(x instanceof Error)throw this[Mt].setEnvironmentAndSkybox(null,null),x}finally{A(1)}})}}return Ru([ui({type:String,attribute:"environment-image"})],s.prototype,"environmentImage",void 0),Ru([ui({type:String,attribute:"skybox-image"})],s.prototype,"skyboxImage",void 0),Ru([ui({type:Number,attribute:"shadow-intensity"})],s.prototype,"shadowIntensity",void 0),Ru([ui({type:Number,attribute:"shadow-softness"})],s.prototype,"shadowSoftness",void 0),Ru([ui({type:Number})],s.prototype,"exposure",void 0),s};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var HP=wf`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var WP=wf`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var qP=wf`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const $P=wf`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          aria-label="View in your space">
        ${qP}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${WP}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${HP}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`,jP=o=>{Bb($P,o)},YA=new WeakMap;class XP extends xo{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const c=new vo(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,u=>{this.parse(u,t,s)},i,s)}parse(e,t,i){this.decodeDracoFile(e,t,null,null,ni).catch(i)}decodeDracoFile(e,t,i,s,c=Qr){const u={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:c};return this.decodeGeometry(e,u).then(t)}decodeGeometry(e,t){const i=JSON.stringify(t);if(YA.has(e)){const m=YA.get(e);if(m.key===i)return m.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const c=this.workerNextTaskID++,u=e.byteLength,a=this._getWorker(c,u).then(m=>(s=m,new Promise((A,x)=>{s._callbacks[c]={resolve:A,reject:x},s.postMessage({type:"decode",id:c,taskConfig:t,buffer:e},[e])}))).then(m=>this._createGeometry(m.geometry));return a.catch(()=>!0).then(()=>{s&&c&&this._releaseTask(s,c)}),YA.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new ys;e.index&&t.setIndex(new pn(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],c=s.name,u=s.array,a=s.itemSize,m=new pn(u,a);c==="color"&&this._assignVertexColorSpace(m,s.vertexColorSpace),t.setAttribute(c,m)}return t}_assignVertexColorSpace(e,t){if(t!==ni)return;const i=new hi;for(let s=0,c=e.count;s<c;s++)i.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new vo(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,c)=>{i.load(e,s,void 0,c)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const c=YP.toString(),u=["/* draco decoder */",s,"","/* worker */",c.substring(c.indexOf("{")+1,c.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(c){const u=c.data;switch(u.type){case"decode":s._callbacks[u.id].resolve(u);break;case"error":s._callbacks[u.id].reject(u);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+u.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,c){return s._taskLoad>c._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function YP(){let o,e;onmessage=function(u){const a=u.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(x){o.onModuleLoaded=function(b){x({draco:b})},DracoDecoderModule(o)});break;case"decode":const m=a.buffer,A=a.taskConfig;e.then(x=>{const b=x.draco,I=new b.Decoder;try{const E=t(b,I,new Int8Array(m),A),T=E.attributes.map(U=>U.array.buffer);E.index&&T.push(E.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:E},T)}catch(E){console.error(E),self.postMessage({type:"error",id:a.id,error:E.message})}finally{b.destroy(I)}});break}};function t(u,a,m,A){const x=A.attributeIDs,b=A.attributeTypes;let I,E;const T=a.GetEncodedGeometryType(m);if(T===u.TRIANGULAR_MESH)I=new u.Mesh,E=a.DecodeArrayToMesh(m,m.byteLength,I);else if(T===u.POINT_CLOUD)I=new u.PointCloud,E=a.DecodeArrayToPointCloud(m,m.byteLength,I);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!E.ok()||I.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+E.error_msg());const U={index:null,attributes:[]};for(const P in x){const R=self[b[P]];let X,G;if(A.useUniqueIDs)G=x[P],X=a.GetAttributeByUniqueId(I,G);else{if(G=a.GetAttributeId(I,u[x[P]]),G===-1)continue;X=a.GetAttribute(I,G)}const J=s(u,a,I,P,R,X);P==="color"&&(J.vertexColorSpace=A.vertexColorSpace),U.attributes.push(J)}return T===u.TRIANGULAR_MESH&&(U.index=i(u,a,I)),u.destroy(I),U}function i(u,a,m){const A=m.num_faces()*3,x=A*4,b=u._malloc(x);a.GetTrianglesUInt32Array(m,x,b);const I=new Uint32Array(u.HEAPF32.buffer,b,A).slice();return u._free(b),{array:I,itemSize:1}}function s(u,a,m,A,x,b){const I=b.num_components(),E=m.num_points()*I,T=E*x.BYTES_PER_ELEMENT,U=c(u,x),P=u._malloc(T);a.GetAttributeDataArrayForAllPoints(m,b,U,T,P);const R=new x(u.HEAPF32.buffer,P,E).slice();return u._free(P),{name:A,array:R,itemSize:I}}function c(u,a){switch(a){case Float32Array:return u.DT_FLOAT32;case Int8Array:return u.DT_INT8;case Int16Array:return u.DT_INT16;case Int32Array:return u.DT_INT32;case Uint8Array:return u.DT_UINT8;case Uint16Array:return u.DT_UINT16;case Uint32Array:return u.DT_UINT32}}}function Gb(o,e){if(e===RT)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===Gg||e===Mv){let t=o.getIndex();if(t===null){const u=[],a=o.getAttribute("position");if(a!==void 0){for(let m=0;m<a.count;m++)u.push(m);o.setIndex(u),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const i=t.count-2,s=[];if(e===Gg)for(let u=1;u<=i;u++)s.push(t.getX(0)),s.push(t.getX(u)),s.push(t.getX(u+1));else for(let u=0;u<i;u++)u%2===0?(s.push(t.getX(u)),s.push(t.getX(u+1)),s.push(t.getX(u+2))):(s.push(t.getX(u+2)),s.push(t.getX(u+1)),s.push(t.getX(u)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const c=o.clone();return c.setIndex(s),c.clearGroups(),c}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}class KP extends xo{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new iU(t)}),this.register(function(t){return new cU(t)}),this.register(function(t){return new hU(t)}),this.register(function(t){return new uU(t)}),this.register(function(t){return new rU(t)}),this.register(function(t){return new sU(t)}),this.register(function(t){return new aU(t)}),this.register(function(t){return new oU(t)}),this.register(function(t){return new tU(t)}),this.register(function(t){return new lU(t)}),this.register(function(t){return new nU(t)}),this.register(function(t){return new JP(t)}),this.register(function(t){return new dU(t)}),this.register(function(t){return new pU(t)})}load(e,t,i,s){const c=this;let u;this.resourcePath!==""?u=this.resourcePath:this.path!==""?u=this.path:u=LA.extractUrlBase(e),this.manager.itemStart(e);const a=function(A){s?s(A):console.error(A),c.manager.itemError(e),c.manager.itemEnd(e)},m=new vo(this.manager);m.setPath(this.path),m.setResponseType("arraybuffer"),m.setRequestHeader(this.requestHeader),m.setWithCredentials(this.withCredentials),m.load(e,function(A){try{c.parse(A,u,function(x){t(x),c.manager.itemEnd(e)},a)}catch(x){a(x)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let c;const u={},a={},m=new TextDecoder;if(typeof e=="string")c=JSON.parse(e);else if(e instanceof ArrayBuffer)if(m.decode(new Uint8Array(e,0,4))===Qb){try{u[Fi.KHR_BINARY_GLTF]=new fU(e)}catch(x){s&&s(x);return}c=JSON.parse(u[Fi.KHR_BINARY_GLTF].content)}else c=JSON.parse(m.decode(e));else c=e;if(c.asset===void 0||c.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const A=new CU(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});A.fileLoader.setRequestHeader(this.requestHeader);for(let x=0;x<this.pluginCallbacks.length;x++){const b=this.pluginCallbacks[x](A);a[b.name]=b,u[b.name]=!0}if(c.extensionsUsed)for(let x=0;x<c.extensionsUsed.length;++x){const b=c.extensionsUsed[x],I=c.extensionsRequired||[];switch(b){case Fi.KHR_MATERIALS_UNLIT:u[b]=new eU;break;case Fi.KHR_DRACO_MESH_COMPRESSION:u[b]=new mU(c,this.dracoLoader);break;case Fi.KHR_TEXTURE_TRANSFORM:u[b]=new gU;break;case Fi.KHR_MESH_QUANTIZATION:u[b]=new AU;break;default:I.indexOf(b)>=0&&a[b]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}A.setExtensions(u),A.setPlugins(a),A.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,c){i.parse(e,t,s,c)})}}function ZP(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const Fi={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class JP{constructor(e){this.parser=e,this.name=Fi.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const c=t[i];c.extensions&&c.extensions[this.name]&&c.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,c.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const c=t.json,u=((c.extensions&&c.extensions[this.name]||{}).lights||[])[e];let a;const m=new hi(16777215);u.color!==void 0&&m.fromArray(u.color);const A=u.range!==void 0?u.range:0;switch(u.type){case"directional":a=new hb(m),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new RA(m),a.distance=A;break;case"spot":a=new OD(m),a.distance=A,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,a.angle=u.spot.outerConeAngle,a.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return a.position.set(0,0,0),a.decay=2,Eo(a,u),u.intensity!==void 0&&(a.intensity=u.intensity),a.name=t.createUniqueName(u.name||"light_"+e),s=Promise.resolve(a),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],c=(s.extensions&&s.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(u){return i._getNodeRef(t.cache,c,u)})}}class eU{constructor(){this.name=Fi.KHR_MATERIALS_UNLIT}getMaterialType(){return js}extendParams(e,t,i){const s=[];e.color=new hi(1,1,1),e.opacity=1;const c=t.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){const u=c.baseColorFactor;e.color.fromArray(u),e.opacity=u[3]}c.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",c.baseColorTexture,ni))}return Promise.all(s)}}class tU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class iU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const c=[],u=s.extensions[this.name];if(u.clearcoatFactor!==void 0&&(t.clearcoat=u.clearcoatFactor),u.clearcoatTexture!==void 0&&c.push(i.assignTexture(t,"clearcoatMap",u.clearcoatTexture)),u.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=u.clearcoatRoughnessFactor),u.clearcoatRoughnessTexture!==void 0&&c.push(i.assignTexture(t,"clearcoatRoughnessMap",u.clearcoatRoughnessTexture)),u.clearcoatNormalTexture!==void 0&&(c.push(i.assignTexture(t,"clearcoatNormalMap",u.clearcoatNormalTexture)),u.clearcoatNormalTexture.scale!==void 0)){const a=u.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new yi(a,a)}return Promise.all(c)}}class nU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const c=[],u=s.extensions[this.name];return u.iridescenceFactor!==void 0&&(t.iridescence=u.iridescenceFactor),u.iridescenceTexture!==void 0&&c.push(i.assignTexture(t,"iridescenceMap",u.iridescenceTexture)),u.iridescenceIor!==void 0&&(t.iridescenceIOR=u.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),u.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=u.iridescenceThicknessMaximum),u.iridescenceThicknessTexture!==void 0&&c.push(i.assignTexture(t,"iridescenceThicknessMap",u.iridescenceThicknessTexture)),Promise.all(c)}}class rU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const c=[];t.sheenColor=new hi(0,0,0),t.sheenRoughness=0,t.sheen=1;const u=s.extensions[this.name];return u.sheenColorFactor!==void 0&&t.sheenColor.fromArray(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=u.sheenRoughnessFactor),u.sheenColorTexture!==void 0&&c.push(i.assignTexture(t,"sheenColorMap",u.sheenColorTexture,ni)),u.sheenRoughnessTexture!==void 0&&c.push(i.assignTexture(t,"sheenRoughnessMap",u.sheenRoughnessTexture)),Promise.all(c)}}class sU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const c=[],u=s.extensions[this.name];return u.transmissionFactor!==void 0&&(t.transmission=u.transmissionFactor),u.transmissionTexture!==void 0&&c.push(i.assignTexture(t,"transmissionMap",u.transmissionTexture)),Promise.all(c)}}class aU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const c=[],u=s.extensions[this.name];t.thickness=u.thicknessFactor!==void 0?u.thicknessFactor:0,u.thicknessTexture!==void 0&&c.push(i.assignTexture(t,"thicknessMap",u.thicknessTexture)),t.attenuationDistance=u.attenuationDistance||1/0;const a=u.attenuationColor||[1,1,1];return t.attenuationColor=new hi(a[0],a[1],a[2]),Promise.all(c)}}class oU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class lU{constructor(e){this.parser=e,this.name=Fi.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:gl}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const c=[],u=s.extensions[this.name];t.specularIntensity=u.specularFactor!==void 0?u.specularFactor:1,u.specularTexture!==void 0&&c.push(i.assignTexture(t,"specularIntensityMap",u.specularTexture));const a=u.specularColorFactor||[1,1,1];return t.specularColor=new hi(a[0],a[1],a[2]),u.specularColorTexture!==void 0&&c.push(i.assignTexture(t,"specularColorMap",u.specularColorTexture,ni)),Promise.all(c)}}class cU{constructor(e){this.parser=e,this.name=Fi.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const c=s.extensions[this.name],u=t.options.ktx2Loader;if(!u){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,c.source,u)}}class hU{constructor(e){this.parser=e,this.name=Fi.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,c=s.textures[e];if(!c.extensions||!c.extensions[t])return null;const u=c.extensions[t],a=s.images[u.source];let m=i.textureLoader;if(a.uri){const A=i.options.manager.getHandler(a.uri);A!==null&&(m=A)}return this.detectSupport().then(function(A){if(A)return i.loadTextureImage(e,u.source,m);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class uU{constructor(e){this.parser=e,this.name=Fi.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,c=s.textures[e];if(!c.extensions||!c.extensions[t])return null;const u=c.extensions[t],a=s.images[u.source];let m=i.textureLoader;if(a.uri){const A=i.options.manager.getHandler(a.uri);A!==null&&(m=A)}return this.detectSupport().then(function(A){if(A)return i.loadTextureImage(e,u.source,m);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class dU{constructor(e){this.name=Fi.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],c=this.parser.getDependency("buffer",s.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return c.then(function(a){const m=s.byteOffset||0,A=s.byteLength||0,x=s.count,b=s.byteStride,I=new Uint8Array(a,m,A);return u.decodeGltfBufferAsync?u.decodeGltfBufferAsync(x,b,I,s.mode,s.filter).then(function(E){return E.buffer}):u.ready.then(function(){const E=new ArrayBuffer(x*b);return u.decodeGltfBuffer(new Uint8Array(E),x,b,I,s.mode,s.filter),E})})}else return null}}class pU{constructor(e){this.name=Fi.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const m of s.primitives)if(m.mode!==vs.TRIANGLES&&m.mode!==vs.TRIANGLE_STRIP&&m.mode!==vs.TRIANGLE_FAN&&m.mode!==void 0)return null;const c=i.extensions[this.name].attributes,u=[],a={};for(const m in c)u.push(this.parser.getDependency("accessor",c[m]).then(A=>(a[m]=A,a[m])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(m=>{const A=m.pop(),x=A.isGroup?A.children:[A],b=m[0].count,I=[];for(const E of x){const T=new pi,U=new we,P=new gs,R=new we(1,1,1),X=new vD(E.geometry,E.material,b);for(let G=0;G<b;G++)a.TRANSLATION&&U.fromBufferAttribute(a.TRANSLATION,G),a.ROTATION&&P.fromBufferAttribute(a.ROTATION,G),a.SCALE&&R.fromBufferAttribute(a.SCALE,G),X.setMatrixAt(G,T.compose(U,P,R));for(const G in a)G!=="TRANSLATION"&&G!=="ROTATION"&&G!=="SCALE"&&E.geometry.setAttribute(G,a[G]);Zi.prototype.copy.call(X,E),this.parser.assignFinalMaterial(X),I.push(X)}return A.isGroup?(A.clear(),A.add(...I),A):I[0]}))}}const Qb="glTF",Pu=12,Vb={JSON:1313821514,BIN:5130562};class fU{constructor(e){this.name=Fi.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Pu),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Qb)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Pu,c=new DataView(e,Pu);let u=0;for(;u<s;){const a=c.getUint32(u,!0);u+=4;const m=c.getUint32(u,!0);if(u+=4,m===Vb.JSON){const A=new Uint8Array(e,Pu+u,a);this.content=i.decode(A)}else if(m===Vb.BIN){const A=Pu+u;this.body=e.slice(A,A+a)}u+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class mU{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Fi.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,c=e.extensions[this.name].bufferView,u=e.extensions[this.name].attributes,a={},m={},A={};for(const x in u){const b=ZA[x]||x.toLowerCase();a[b]=u[x]}for(const x in e.attributes){const b=ZA[x]||x.toLowerCase();if(u[x]!==void 0){const I=i.accessors[e.attributes[x]],E=Hc[I.componentType];A[b]=E.name,m[b]=I.normalized===!0}}return t.getDependency("bufferView",c).then(function(x){return new Promise(function(b){s.decodeDracoFile(x,function(I){for(const E in I.attributes){const T=I.attributes[E],U=m[E];U!==void 0&&(T.normalized=U)}b(I)},a,A)})})}}class gU{constructor(){this.name=Fi.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class AU{constructor(){this.name=Fi.KHR_MESH_QUANTIZATION}}class Hb extends bu{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,c=e*s*3+s;for(let u=0;u!==s;u++)t[u]=i[c+u];return t}interpolate_(e,t,i,s){const c=this.resultBuffer,u=this.sampleValues,a=this.valueSize,m=a*2,A=a*3,x=s-t,b=(i-t)/x,I=b*b,E=I*b,T=e*A,U=T-A,P=-2*E+3*I,R=E-I,X=1-P,G=R-I+b;for(let J=0;J!==a;J++){const q=u[U+J+a],te=u[U+J+m]*x,ue=u[T+J+a],_e=u[T+J]*x;c[J]=X*q+G*te+P*ue+R*_e}return c}}const _U=new gs;class yU extends Hb{interpolate_(e,t,i,s){const c=super.interpolate_(e,t,i,s);return _U.fromArray(c).normalize().toArray(c),c}}const vs={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Hc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Wb={9728:Pn,9729:dn,9984:ou,9985:Fp,9986:ac,9987:Os},qb={33071:tr,33648:sc,10497:aa},KA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ZA={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},wo={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xU={CUBICSPLINE:void 0,LINEAR:uo,STEP:ll},JA={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function vU(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new ha({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ks})),o.DefaultMaterial}function Uu(o,e,t){for(const i in t.extensions)o[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Eo(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function bU(o,e,t){let i=!1,s=!1,c=!1;for(let A=0,x=e.length;A<x;A++){const b=e[A];if(b.POSITION!==void 0&&(i=!0),b.NORMAL!==void 0&&(s=!0),b.COLOR_0!==void 0&&(c=!0),i&&s&&c)break}if(!i&&!s&&!c)return Promise.resolve(o);const u=[],a=[],m=[];for(let A=0,x=e.length;A<x;A++){const b=e[A];if(i){const I=b.POSITION!==void 0?t.getDependency("accessor",b.POSITION):o.attributes.position;u.push(I)}if(s){const I=b.NORMAL!==void 0?t.getDependency("accessor",b.NORMAL):o.attributes.normal;a.push(I)}if(c){const I=b.COLOR_0!==void 0?t.getDependency("accessor",b.COLOR_0):o.attributes.color;m.push(I)}}return Promise.all([Promise.all(u),Promise.all(a),Promise.all(m)]).then(function(A){const x=A[0],b=A[1],I=A[2];return i&&(o.morphAttributes.position=x),s&&(o.morphAttributes.normal=b),c&&(o.morphAttributes.color=I),o.morphTargetsRelative=!0,o})}function wU(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)o.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function EU(o){const e=o.extensions&&o.extensions[Fi.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+$b(e.attributes):t=o.indices+":"+$b(o.attributes)+":"+o.mode,t}function $b(o){let e="";const t=Object.keys(o).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+o[t[i]]+";";return e}function e_(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function SU(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const IU=new pi;class CU{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new ZP,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,c=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,c=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&c<98?this.textureLoader=new ab(this.options.manager):this.textureLoader=new HD(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new vo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,c=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(u){return u._markDefs&&u._markDefs()}),Promise.all(this._invokeAll(function(u){return u.beforeRoot&&u.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(u){const a={scene:u[0][s.scene||0],scenes:u[0],animations:u[1],cameras:u[2],asset:s.asset,parser:i,userData:{}};Uu(c,a,s),Eo(a,s),Promise.all(i._invokeAll(function(m){return m.afterRoot&&m.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,c=t.length;s<c;s++){const u=t[s].joints;for(let a=0,m=u.length;a<m;a++)e[u[a]].isBone=!0}for(let s=0,c=e.length;s<c;s++){const u=e[s];u.mesh!==void 0&&(this._addNodeRef(this.meshCache,u.mesh),u.skin!==void 0&&(i[u.mesh].isSkinnedMesh=!0)),u.camera!==void 0&&this._addNodeRef(this.cameraCache,u.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),c=(u,a)=>{const m=this.associations.get(u);m!=null&&this.associations.set(a,m);for(const[A,x]of u.children.entries())c(x,a.children[A])};return c(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const c=e(t[s]);c&&i.push(c)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(c){return c.loadNode&&c.loadNode(t)});break;case"mesh":s=this._invokeOne(function(c){return c.loadMesh&&c.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(c){return c.loadBufferView&&c.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(c){return c.loadMaterial&&c.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(c){return c.loadTexture&&c.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(c){return c.loadAnimation&&c.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(c){return c!=this&&c.getDependency&&c.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(c,u){return i.getDependency(e,u)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Fi.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(c,u){i.load(LA.resolveURL(t.uri,s.path),c,void 0,function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,c=t.byteOffset||0;return i.slice(c,c+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const u=KA[s.type],a=Hc[s.componentType],m=s.normalized===!0,A=new a(s.count*u);return Promise.resolve(new pn(A,u,m))}const c=[];return s.bufferView!==void 0?c.push(this.getDependency("bufferView",s.bufferView)):c.push(null),s.sparse!==void 0&&(c.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(c).then(function(u){const a=u[0],m=KA[s.type],A=Hc[s.componentType],x=A.BYTES_PER_ELEMENT,b=x*m,I=s.byteOffset||0,E=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,T=s.normalized===!0;let U,P;if(E&&E!==b){const R=Math.floor(I/E),X="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+R+":"+s.count;let G=t.cache.get(X);G||(U=new A(a,R*E,s.count*E/x),G=new gD(U,E/x),t.cache.add(X,G)),P=new xA(G,m,I%E/x,T)}else a===null?U=new A(s.count*m):U=new A(a,I,s.count*m),P=new pn(U,m,T);if(s.sparse!==void 0){const R=KA.SCALAR,X=Hc[s.sparse.indices.componentType],G=s.sparse.indices.byteOffset||0,J=s.sparse.values.byteOffset||0,q=new X(u[1],G,s.sparse.count*R),te=new A(u[2],J,s.sparse.count*m);a!==null&&(P=new pn(P.array.slice(),P.itemSize,P.normalized));for(let ue=0,_e=q.length;ue<_e;ue++){const K=q[ue];if(P.setX(K,te[ue*m]),m>=2&&P.setY(K,te[ue*m+1]),m>=3&&P.setZ(K,te[ue*m+2]),m>=4&&P.setW(K,te[ue*m+3]),m>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return P})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,c=t.images[s];let u=this.textureLoader;if(c.uri){const a=i.manager.getHandler(c.uri);a!==null&&(u=a)}return this.loadTextureImage(e,s,u)}loadTextureImage(e,t,i){const s=this,c=this.json,u=c.textures[e],a=c.images[t],m=(a.uri||a.bufferView)+":"+u.sampler;if(this.textureCache[m])return this.textureCache[m];const A=this.loadImageSource(t,i).then(function(x){x.flipY=!1,x.name=u.name||a.name||"",x.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(x.name=a.uri);const b=(c.samplers||{})[u.sampler]||{};return x.magFilter=Wb[b.magFilter]||dn,x.minFilter=Wb[b.minFilter]||Os,x.wrapS=qb[b.wrapS]||aa,x.wrapT=qb[b.wrapT]||aa,s.associations.set(x,{textures:e}),x}).catch(function(){return null});return this.textureCache[m]=A,A}loadImageSource(e,t){const i=this,s=this.json,c=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(b=>b.clone());const u=s.images[e],a=self.URL||self.webkitURL;let m=u.uri||"",A=!1;if(u.bufferView!==void 0)m=i.getDependency("bufferView",u.bufferView).then(function(b){A=!0;const I=new Blob([b],{type:u.mimeType});return m=a.createObjectURL(I),m});else if(u.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const x=Promise.resolve(m).then(function(b){return new Promise(function(I,E){let T=I;t.isImageBitmapLoader===!0&&(T=function(U){const P=new vn(U);P.needsUpdate=!0,I(P)}),t.load(LA.resolveURL(b,c.path),T,void 0,E)})}).then(function(b){return A===!0&&a.revokeObjectURL(m),b.userData.mimeType=u.mimeType||SU(u.uri),b}).catch(function(b){throw console.error("THREE.GLTFLoader: Couldn't load texture",m),b});return this.sourceCache[e]=x,x}assignTexture(e,t,i,s){const c=this;return this.getDependency("texture",i.index).then(function(u){if(!u)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(u=u.clone(),u.channel=i.texCoord),c.extensions[Fi.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[Fi.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const m=c.associations.get(u);u=c.extensions[Fi.KHR_TEXTURE_TRANSFORM].extendTexture(u,a),c.associations.set(u,m)}}return s!==void 0&&(u.colorSpace=s),e[t]=u,u})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,c=t.attributes.color!==void 0,u=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let m=this.cache.get(a);m||(m=new Y1,qs.prototype.copy.call(m,i),m.color.copy(i.color),m.map=i.map,m.sizeAttenuation=!1,this.cache.add(a,m)),i=m}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let m=this.cache.get(a);m||(m=new H1,qs.prototype.copy.call(m,i),m.color.copy(i.color),m.map=i.map,this.cache.add(a,m)),i=m}if(s||c||u){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),c&&(a+="vertex-colors:"),u&&(a+="flat-shading:");let m=this.cache.get(a);m||(m=i.clone(),c&&(m.vertexColors=!0),u&&(m.flatShading=!0),s&&(m.normalScale&&(m.normalScale.y*=-1),m.clearcoatNormalScale&&(m.clearcoatNormalScale.y*=-1)),this.cache.add(a,m),this.associations.set(m,this.associations.get(i))),i=m}e.material=i}getMaterialType(){return ha}loadMaterial(e){const t=this,i=this.json,s=this.extensions,c=i.materials[e];let u;const a={},m=c.extensions||{},A=[];if(m[Fi.KHR_MATERIALS_UNLIT]){const b=s[Fi.KHR_MATERIALS_UNLIT];u=b.getMaterialType(),A.push(b.extendParams(a,c,t))}else{const b=c.pbrMetallicRoughness||{};if(a.color=new hi(1,1,1),a.opacity=1,Array.isArray(b.baseColorFactor)){const I=b.baseColorFactor;a.color.fromArray(I),a.opacity=I[3]}b.baseColorTexture!==void 0&&A.push(t.assignTexture(a,"map",b.baseColorTexture,ni)),a.metalness=b.metallicFactor!==void 0?b.metallicFactor:1,a.roughness=b.roughnessFactor!==void 0?b.roughnessFactor:1,b.metallicRoughnessTexture!==void 0&&(A.push(t.assignTexture(a,"metalnessMap",b.metallicRoughnessTexture)),A.push(t.assignTexture(a,"roughnessMap",b.metallicRoughnessTexture))),u=this._invokeOne(function(I){return I.getMaterialType&&I.getMaterialType(e)}),A.push(Promise.all(this._invokeAll(function(I){return I.extendMaterialParams&&I.extendMaterialParams(e,a)})))}c.doubleSided===!0&&(a.side=er);const x=c.alphaMode||JA.OPAQUE;if(x===JA.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,x===JA.MASK&&(a.alphaTest=c.alphaCutoff!==void 0?c.alphaCutoff:.5)),c.normalTexture!==void 0&&u!==js&&(A.push(t.assignTexture(a,"normalMap",c.normalTexture)),a.normalScale=new yi(1,1),c.normalTexture.scale!==void 0)){const b=c.normalTexture.scale;a.normalScale.set(b,b)}return c.occlusionTexture!==void 0&&u!==js&&(A.push(t.assignTexture(a,"aoMap",c.occlusionTexture)),c.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=c.occlusionTexture.strength)),c.emissiveFactor!==void 0&&u!==js&&(a.emissive=new hi().fromArray(c.emissiveFactor)),c.emissiveTexture!==void 0&&u!==js&&A.push(t.assignTexture(a,"emissiveMap",c.emissiveTexture,ni)),Promise.all(A).then(function(){const b=new u(a);return c.name&&(b.name=c.name),Eo(b,c),t.associations.set(b,{materials:e}),c.extensions&&Uu(s,b,c),b})}createUniqueName(e){const t=Si.sanitizeNodeName(e||"");let i=t;for(let s=1;this.nodeNamesUsed[i];++s)i=t+"_"+s;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function c(a){return i[Fi.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(m){return jb(m,a,t)})}const u=[];for(let a=0,m=e.length;a<m;a++){const A=e[a],x=EU(A),b=s[x];if(b)u.push(b.promise);else{let I;A.extensions&&A.extensions[Fi.KHR_DRACO_MESH_COMPRESSION]?I=c(A):I=jb(new ys,A,t),s[x]={primitive:A,promise:I},u.push(I)}}return Promise.all(u)}loadMesh(e){const t=this,i=this.json,s=this.extensions,c=i.meshes[e],u=c.primitives,a=[];for(let m=0,A=u.length;m<A;m++){const x=u[m].material===void 0?vU(this.cache):this.getDependency("material",u[m].material);a.push(x)}return a.push(t.loadGeometries(u)),Promise.all(a).then(function(m){const A=m.slice(0,m.length-1),x=m[m.length-1],b=[];for(let E=0,T=x.length;E<T;E++){const U=x[E],P=u[E];let R;const X=A[E];if(P.mode===vs.TRIANGLES||P.mode===vs.TRIANGLE_STRIP||P.mode===vs.TRIANGLE_FAN||P.mode===void 0)R=c.isSkinnedMesh===!0?new _D(U,X):new oi(U,X),R.isSkinnedMesh===!0&&R.normalizeSkinWeights(),P.mode===vs.TRIANGLE_STRIP?R.geometry=Gb(R.geometry,Mv):P.mode===vs.TRIANGLE_FAN&&(R.geometry=Gb(R.geometry,Gg));else if(P.mode===vs.LINES)R=new bD(U,X);else if(P.mode===vs.LINE_STRIP)R=new SA(U,X);else if(P.mode===vs.LINE_LOOP)R=new wD(U,X);else if(P.mode===vs.POINTS)R=new ED(U,X);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);Object.keys(R.geometry.morphAttributes).length>0&&wU(R,c),R.name=t.createUniqueName(c.name||"mesh_"+e),Eo(R,c),P.extensions&&Uu(s,R,P),t.assignFinalMaterial(R),b.push(R)}for(let E=0,T=b.length;E<T;E++)t.associations.set(b[E],{meshes:e,primitives:E});if(b.length===1)return b[0];const I=new _o;t.associations.set(I,{meshes:e});for(let E=0,T=b.length;E<T;E++)I.add(b[E]);return I})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new ir(cl.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new Bc(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Eo(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,c=t.joints.length;s<c;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const c=s.pop(),u=s,a=[],m=[];for(let A=0,x=u.length;A<x;A++){const b=u[A];if(b){a.push(b);const I=new pi;c!==null&&I.fromArray(c.array,A*16),m.push(I)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[A])}return new wA(a,m)})}loadAnimation(e){const t=this.json.animations[e],i=t.name?t.name:"animation_"+e,s=[],c=[],u=[],a=[],m=[];for(let A=0,x=t.channels.length;A<x;A++){const b=t.channels[A],I=t.samplers[b.sampler],E=b.target,T=E.node,U=t.parameters!==void 0?t.parameters[I.input]:I.input,P=t.parameters!==void 0?t.parameters[I.output]:I.output;E.node!==void 0&&(s.push(this.getDependency("node",T)),c.push(this.getDependency("accessor",U)),u.push(this.getDependency("accessor",P)),a.push(I),m.push(E))}return Promise.all([Promise.all(s),Promise.all(c),Promise.all(u),Promise.all(a),Promise.all(m)]).then(function(A){const x=A[0],b=A[1],I=A[2],E=A[3],T=A[4],U=[];for(let P=0,R=x.length;P<R;P++){const X=x[P],G=b[P],J=I[P],q=E[P],te=T[P];if(X===void 0)continue;X.updateMatrix();let ue;switch(wo[te.path]){case wo.weights:ue=wu;break;case wo.rotation:ue=Al;break;case wo.position:case wo.scale:default:ue=Eu;break}const _e=X.name?X.name:X.uuid,K=q.interpolation!==void 0?xU[q.interpolation]:uo,ce=[];wo[te.path]===wo.weights?X.traverse(function(Ne){Ne.morphTargetInfluences&&ce.push(Ne.name?Ne.name:Ne.uuid)}):ce.push(_e);let Ve=J.array;if(J.normalized){const Ne=e_(Ve.constructor),Me=new Float32Array(Ve.length);for(let ve=0,ke=Ve.length;ve<ke;ve++)Me[ve]=Ve[ve]*Ne;Ve=Me}for(let Ne=0,Me=ce.length;Ne<Me;Ne++){const ve=new ue(ce[Ne]+"."+wo[te.path],G.array,Ve,K);q.interpolation==="CUBICSPLINE"&&(ve.createInterpolant=function(ke){const Re=this instanceof Al?yU:Hb;return new Re(this.times,this.values,this.getValueSize()/3,ke)},ve.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),U.push(ve)}}return new CA(i,void 0,U)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(c){const u=i._getNodeRef(i.meshCache,s.mesh,c);return s.weights!==void 0&&u.traverse(function(a){if(a.isMesh)for(let m=0,A=s.weights.length;m<A;m++)a.morphTargetInfluences[m]=s.weights[m]}),u})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],c=i._loadNodeShallow(e),u=[],a=s.children||[];for(let A=0,x=a.length;A<x;A++)u.push(i.getDependency("node",a[A]));const m=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([c,Promise.all(u),m]).then(function(A){const x=A[0],b=A[1],I=A[2];I!==null&&x.traverse(function(E){!E.isSkinnedMesh||E.bind(I,IU)});for(let E=0,T=b.length;E<T;E++)x.add(b[E]);return x})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const c=t.nodes[e],u=c.name?s.createUniqueName(c.name):"",a=[],m=s._invokeOne(function(A){return A.createNodeMesh&&A.createNodeMesh(e)});return m&&a.push(m),c.camera!==void 0&&a.push(s.getDependency("camera",c.camera).then(function(A){return s._getNodeRef(s.cameraCache,c.camera,A)})),s._invokeAll(function(A){return A.createNodeAttachment&&A.createNodeAttachment(e)}).forEach(function(A){a.push(A)}),this.nodeCache[e]=Promise.all(a).then(function(A){let x;if(c.isBone===!0?x=new O1:A.length>1?x=new _o:A.length===1?x=A[0]:x=new Zi,x!==A[0])for(let b=0,I=A.length;b<I;b++)x.add(A[b]);if(c.name&&(x.userData.name=c.name,x.name=u),Eo(x,c),c.extensions&&Uu(i,x,c),c.matrix!==void 0){const b=new pi;b.fromArray(c.matrix),x.applyMatrix4(b)}else c.translation!==void 0&&x.position.fromArray(c.translation),c.rotation!==void 0&&x.quaternion.fromArray(c.rotation),c.scale!==void 0&&x.scale.fromArray(c.scale);return s.associations.has(x)||s.associations.set(x,{}),s.associations.get(x).nodes=e,x}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,c=new _o;i.name&&(c.name=s.createUniqueName(i.name)),Eo(c,i),i.extensions&&Uu(t,c,i);const u=i.nodes||[],a=[];for(let m=0,A=u.length;m<A;m++)a.push(s.getDependency("node",u[m]));return Promise.all(a).then(function(m){for(let x=0,b=m.length;x<b;x++)c.add(m[x]);const A=x=>{const b=new Map;for(const[I,E]of s.associations)(I instanceof qs||I instanceof vn)&&b.set(I,E);return x.traverse(I=>{const E=s.associations.get(I);E!=null&&b.set(I,E)}),b};return s.associations=A(c),c})}}function MU(o,e,t){const i=e.attributes,s=new Er;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],m=a.min,A=a.max;if(m!==void 0&&A!==void 0){if(s.set(new we(m[0],m[1],m[2]),new we(A[0],A[1],A[2])),a.normalized){const x=e_(Hc[a.componentType]);s.min.multiplyScalar(x),s.max.multiplyScalar(x)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const c=e.targets;if(c!==void 0){const a=new we,m=new we;for(let A=0,x=c.length;A<x;A++){const b=c[A];if(b.POSITION!==void 0){const I=t.json.accessors[b.POSITION],E=I.min,T=I.max;if(E!==void 0&&T!==void 0){if(m.setX(Math.max(Math.abs(E[0]),Math.abs(T[0]))),m.setY(Math.max(Math.abs(E[1]),Math.abs(T[1]))),m.setZ(Math.max(Math.abs(E[2]),Math.abs(T[2]))),I.normalized){const U=e_(Hc[I.componentType]);m.multiplyScalar(U)}a.max(m)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}o.boundingBox=s;const u=new As;s.getCenter(u.center),u.radius=s.min.distanceTo(s.max)/2,o.boundingSphere=u}function jb(o,e,t){const i=e.attributes,s=[];function c(u,a){return t.getDependency("accessor",u).then(function(m){o.setAttribute(a,m)})}for(const u in i){const a=ZA[u]||u.toLowerCase();a in o.attributes||s.push(c(i[u],a))}if(e.indices!==void 0&&!o.index){const u=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});s.push(u)}return Eo(o,e),MU(o,e,t),Promise.all(s).then(function(){return e.targets!==void 0?bU(o,e.targets,t):o})}class TU{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:s,msg:c,transfer:u}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(c,u)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const BU=0,RU=2,LU=1,DU=2,PU=0,Xb=9,t_=15,Yb=16,i_=22,Kb=37,n_=43,Zb=76,Jb=83,ew=97,tw=100,iw=103,nw=109;class UU{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Fu{constructor(e,t,i,s){this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const Cr=[171,75,84,88,32,50,48,187,13,10,26,10];function rw(o){return typeof TextDecoder<"u"?new TextDecoder().decode(o):dt.from(o).toString("utf8")}function FU(o){const e=new Uint8Array(o.buffer,o.byteOffset,Cr.length);if(e[0]!==Cr[0]||e[1]!==Cr[1]||e[2]!==Cr[2]||e[3]!==Cr[3]||e[4]!==Cr[4]||e[5]!==Cr[5]||e[6]!==Cr[6]||e[7]!==Cr[7]||e[8]!==Cr[8]||e[9]!==Cr[9]||e[10]!==Cr[10]||e[11]!==Cr[11])throw new Error("Missing KTX 2.0 identifier.");const t=new UU,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new Fu(o,Cr.length,i,!0);t.vkFormat=s._nextUint32(),t.typeSize=s._nextUint32(),t.pixelWidth=s._nextUint32(),t.pixelHeight=s._nextUint32(),t.pixelDepth=s._nextUint32(),t.layerCount=s._nextUint32(),t.faceCount=s._nextUint32();const c=s._nextUint32();t.supercompressionScheme=s._nextUint32();const u=s._nextUint32(),a=s._nextUint32(),m=s._nextUint32(),A=s._nextUint32(),x=s._nextUint64(),b=s._nextUint64(),I=new Fu(o,Cr.length+i,3*c*8,!0);for(let Fe=0;Fe<c;Fe++)t.levels.push({levelData:new Uint8Array(o.buffer,o.byteOffset+I._nextUint64(),I._nextUint64()),uncompressedByteLength:I._nextUint64()});const E=new Fu(o,u,a,!0),T={vendorId:E._skip(4)._nextUint16(),descriptorType:E._nextUint16(),versionNumber:E._nextUint16(),descriptorBlockSize:E._nextUint16(),colorModel:E._nextUint8(),colorPrimaries:E._nextUint8(),transferFunction:E._nextUint8(),flags:E._nextUint8(),texelBlockDimension:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],bytesPlane:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],samples:[]},U=(T.descriptorBlockSize/4-6)/4;for(let Fe=0;Fe<U;Fe++){const Oe={bitOffset:E._nextUint16(),bitLength:E._nextUint8(),channelType:E._nextUint8(),samplePosition:[E._nextUint8(),E._nextUint8(),E._nextUint8(),E._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Oe.channelType?(Oe.sampleLower=E._nextInt32(),Oe.sampleUpper=E._nextInt32()):(Oe.sampleLower=E._nextUint32(),Oe.sampleUpper=E._nextUint32()),T.samples[Fe]=Oe}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(T);const P=new Fu(o,m,A,!0);for(;P._offset<A;){const Fe=P._nextUint32(),Oe=P._scan(Fe),je=rw(Oe),Je=P._scan(Fe-Oe.byteLength);t.keyValue[je]=je.match(/^ktx/i)?rw(Je):Je,P._offset%4&&P._skip(4-P._offset%4)}if(b<=0)return t;const R=new Fu(o,x,b,!0),X=R._nextUint16(),G=R._nextUint16(),J=R._nextUint32(),q=R._nextUint32(),te=R._nextUint32(),ue=R._nextUint32(),_e=[];for(let Fe=0;Fe<c;Fe++)_e.push({imageFlags:R._nextUint32(),rgbSliceByteOffset:R._nextUint32(),rgbSliceByteLength:R._nextUint32(),alphaSliceByteOffset:R._nextUint32(),alphaSliceByteLength:R._nextUint32()});const K=x+R._offset,ce=K+J,Ve=ce+q,Ne=Ve+te,Me=new Uint8Array(o.buffer,o.byteOffset+K,J),ve=new Uint8Array(o.buffer,o.byteOffset+ce,q),ke=new Uint8Array(o.buffer,o.byteOffset+Ve,te),Re=new Uint8Array(o.buffer,o.byteOffset+Ne,ue);return t.globalData={endpointCount:X,selectorCount:G,imageDescs:_e,endpointsData:Me,selectorsData:ve,tablesData:ke,extendedData:Re},t}let r_,Oa,s_;const a_={env:{emscripten_notify_memory_growth:function(o){s_=new Uint8Array(Oa.exports.memory.buffer)}}};class kU{init(){return r_||(r_=typeof fetch<"u"?fetch("data:application/wasm;base64,"+sw).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,a_)).then(this._init):WebAssembly.instantiate(dt.from(sw,"base64"),a_).then(this._init),r_)}_init(e){Oa=e.instance,a_.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Oa)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=Oa.exports.malloc(i);s_.set(e,s),t=t||Number(Oa.exports.ZSTD_findDecompressedSize(s,i));const c=Oa.exports.malloc(t),u=Oa.exports.ZSTD_decompress(c,t,s,i),a=s_.slice(c,c+u);return Oa.exports.free(s),Oa.exports.free(c),a}}const sw="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",o_=new WeakMap;let l_=0,c_;class pa extends xo{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new TU,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const e=new vo(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new vo(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([c,u])=>{const a=pa.BasisWorker.toString(),m=["/* constants */","let _EngineFormat = "+JSON.stringify(pa.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(pa.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(pa.BasisFormat),"/* basis_transcoder.js */",c,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([m])),this.transcoderBinary=u,this.workerPool.setWorkerCreator(()=>{const A=new Worker(this.workerSourceURL),x=this.transcoderBinary.slice(0);return A.postMessage({type:"init",config:this.workerConfig,transcoderBinary:x},[x]),A})}),l_>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),l_++}return this.transcoderPending}load(e,t,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const c=new vo(this.manager);c.setResponseType("arraybuffer"),c.setWithCredentials(this.withCredentials),c.load(e,u=>{if(o_.has(u))return o_.get(u).promise.then(t).catch(s);this._createTexture(u).then(a=>t?t(a):null).catch(s)},i,s)}_createTextureFrom(e,t){const{mipmaps:i,width:s,height:c,format:u,type:a,error:m,dfdTransferFn:A,dfdFlags:x}=e;if(a==="error")return Promise.reject(m);const b=t.layerCount>1?new ID(i,s,c,t.layerCount,u,vr):new J1(i,s,c,u,vr);return b.minFilter=i.length===1?dn:Os,b.magFilter=dn,b.generateMipmaps=!1,b.needsUpdate=!0,b.colorSpace=A===DU?ni:fs,b.premultiplyAlpha=!!(x&LU),b}_createTexture(e){return Jt(this,arguments,function*(t,i={}){const s=FU(new Uint8Array(t));if(s.vkFormat!==PU)return OU(s);const c=i,u=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:c},[t])).then(a=>this._createTextureFrom(a.data,s));return o_.set(t,{promise:u}),u})}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),l_--,this}}pa.BasisFormat={ETC1S:0,UASTC_4x4:1},pa.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},pa.EngineFormat={RGBAFormat:Rn,RGBA_ASTC_4x4_Format:Fg,RGBA_BPTC_Format:Op,RGBA_ETC2_EAC_Format:Ug,RGBA_PVRTC_4BPPV1_Format:Dg,RGBA_S3TC_DXT5_Format:Np,RGB_ETC1_Format:hv,RGB_ETC2_Format:Pg,RGB_PVRTC_4BPPV1_Format:Lg,RGB_S3TC_DXT1_Format:kp},pa.BasisWorker=function(){let o,e,t;const i=_EngineFormat,s=_TranscoderFormat,c=_BasisFormat;self.addEventListener("message",function(T){const U=T.data;switch(U.type){case"init":o=U.config,u(U.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:P,height:R,hasAlpha:X,mipmaps:G,format:J,dfdTransferFn:q,dfdFlags:te}=a(U.buffer),ue=[];for(let _e=0;_e<G.length;++_e)ue.push(G[_e].data.buffer);self.postMessage({type:"transcode",id:U.id,width:P,height:R,hasAlpha:X,mipmaps:G,format:J,dfdTransferFn:q,dfdFlags:te},ue)}catch(P){console.error(P),self.postMessage({type:"error",id:U.id,error:P.message})}});break}});function u(T){e=new Promise(U=>{t={wasmBinary:T,onRuntimeInitialized:U},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function a(T){const U=new t.KTX2File(new Uint8Array(T));function P(){U.close(),U.delete()}if(!U.isValid())throw P(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const R=U.isUASTC()?c.UASTC_4x4:c.ETC1S,X=U.getWidth(),G=U.getHeight(),J=U.getLayers()||1,q=U.getLevels(),te=U.getHasAlpha(),ue=U.getDFDTransferFunc(),_e=U.getDFDFlags(),{transcoderFormat:K,engineFormat:ce}=b(R,X,G,te);if(!X||!G||!q)throw P(),new Error("THREE.KTX2Loader:	Invalid texture");if(!U.startTranscoding())throw P(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Ve=[];for(let Ne=0;Ne<q;Ne++){const Me=[];let ve,ke;for(let Re=0;Re<J;Re++){const Fe=U.getImageLevelInfo(Ne,Re,0);ve=Fe.origWidth<4?Fe.origWidth:Fe.width,ke=Fe.origHeight<4?Fe.origHeight:Fe.height;const Oe=new Uint8Array(U.getImageTranscodedSizeInBytes(Ne,Re,0,K));if(!U.transcodeImage(Oe,Ne,Re,0,K,0,-1,-1))throw P(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Me.push(Oe)}Ve.push({data:E(Me),width:ve,height:ke})}return P(),{width:X,height:G,hasAlpha:te,mipmaps:Ve,format:ce,dfdTransferFn:ue,dfdFlags:_e}}const m=[{if:"astcSupported",basisFormat:[c.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[c.ETC1S,c.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[c.ETC1S,c.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[c.ETC1S,c.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[c.ETC1S,c.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[c.ETC1S,c.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],A=m.sort(function(T,U){return T.priorityETC1S-U.priorityETC1S}),x=m.sort(function(T,U){return T.priorityUASTC-U.priorityUASTC});function b(T,U,P,R){let X,G;const J=T===c.ETC1S?A:x;for(let q=0;q<J.length;q++){const te=J[q];if(!!o[te.if]&&!!te.basisFormat.includes(T)&&!(R&&te.transcoderFormat.length<2)&&!(te.needsPowerOfTwo&&!(I(U)&&I(P))))return X=te.transcoderFormat[R?1:0],G=te.engineFormat[R?1:0],{transcoderFormat:X,engineFormat:G}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),X=s.RGBA32,G=i.RGBAFormat,{transcoderFormat:X,engineFormat:G}}function I(T){return T<=2?!0:(T&T-1)===0&&T!==0}function E(T){let U=0;for(let X=0;X<T.length;X++)U+=T[X].byteLength;const P=new Uint8Array(U);let R=0;for(let X=0;X<T.length;X++){const G=T[X];P.set(G,R),R+=G.byteLength}return P}};const aw={[nw]:Rn,[ew]:Rn,[Kb]:Rn,[n_]:Rn,[iw]:cu,[Jb]:cu,[Yb]:cu,[i_]:cu,[tw]:lu,[Zb]:lu,[t_]:lu,[Xb]:lu},h_={[nw]:br,[ew]:wr,[Kb]:vr,[n_]:vr,[iw]:br,[Jb]:wr,[Yb]:vr,[i_]:vr,[tw]:br,[Zb]:wr,[t_]:vr,[Xb]:vr},NU={[n_]:ni,[i_]:ni,[t_]:ni};function OU(o){return Jt(this,null,function*(){const{vkFormat:e,pixelWidth:t,pixelHeight:i,pixelDepth:s}=o;if(aw[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const c=o.levels[0];let u,a;if(o.supercompressionScheme===BU)u=c.levelData;else if(o.supercompressionScheme===RU)c_||(c_=new Promise(A=>Jt(this,null,function*(){const x=new kU;yield x.init(),A(x)}))),u=(yield c_).decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");h_[e]===br?a=new Float32Array(u.buffer,u.byteOffset,u.byteLength/Float32Array.BYTES_PER_ELEMENT):h_[e]===wr?a=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/Uint16Array.BYTES_PER_ELEMENT):a=u;const m=s===0?new bA(a,t,i):new Ov(a,t,i,s);return m.type=h_[e],m.format=aw[e],m.colorSpace=NU[e]||fs,m.needsUpdate=!0,Promise.resolve(m)})}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var ow,lw;const Ys=Symbol("retainerCount"),za=Symbol("recentlyUsed"),Mf=Symbol("evict"),ku=Symbol("evictionThreshold"),u_=Symbol("cache");class zU{constructor(e,t=5){this[ow]=new Map,this[lw]=[],this[u_]=e,this[ku]=t}set evictionThreshold(e){this[ku]=e,this[Mf]()}get evictionThreshold(){return this[ku]}get cache(){return this[u_]}retainerCount(e){return this[Ys].get(e)||0}reset(){this[Ys].clear(),this[za]=[]}retain(e){this[Ys].has(e)||this[Ys].set(e,0),this[Ys].set(e,this[Ys].get(e)+1);const t=this[za].indexOf(e);t!==-1&&this[za].splice(t,1),this[za].unshift(e),this[Mf]()}release(e){this[Ys].has(e)&&this[Ys].set(e,Math.max(this[Ys].get(e)-1,0)),this[Mf]()}[(ow=Ys,lw=za,Mf)](){if(!(this[za].length<this[ku]))for(let e=this[za].length-1;e>=this[ku];--e){const t=this[za][e];this[Ys].get(t)===0&&(this[u_].delete(t),this[za].splice(e,1))}}}/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const GU=o=>{const e=[],t=new Set;for(const i of o){let s=i,c=0;for(;t.has(s);)s=i+"."+ ++c;t.add(s),e.push(s)}return e},QU=o=>{const e=new Map;for(const t of o.mappings)for(const i of t.variants)e.set(i,{material:null,gltfMaterialIndex:t.material});return e};class VU{constructor(e){this.parser=e,this.name="KHR_materials_variants"}afterRoot(e){const t=this.parser,i=t.json;if(i.extensions===void 0||i.extensions[this.name]===void 0)return null;const s=i.extensions[this.name].variants||[],c=GU(s.map(u=>u.name));for(const u of e.scenes)u.traverse(a=>{const m=a;if(!m.material)return;const A=t.associations.get(m);if(A==null||A.meshes==null||A.primitives==null)return;const x=i.meshes[A.meshes].primitives[A.primitives].extensions;!x||!x[this.name]||(m.userData.variantMaterials=QU(x[this.name]))});return e.userData.variants=c,Promise.resolve()}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var cw,hw;vn.DEFAULT_ANISOTROPY=4;const HU=(o,e,t=()=>{})=>{const i=s=>{const c=s.loaded/s.total;t(Math.max(0,Math.min(1,isFinite(c)?c:1)))};return new Promise((s,c)=>{e.load(o,s,i,c)})},WU=o=>new Promise((e,t)=>{const i=document.createElement("script");document.body.appendChild(i),i.onload=e,i.onerror=t,i.async=!0,i.src=o}),Ga=new Map,d_=new Map;let uw;const dw=new XP;let pw;const p_=new pa;let f_,m_;const xl=Symbol("loader"),So=Symbol("evictionPolicy"),fw=Symbol("GLTFInstance");class Wn extends ms{constructor(e){super(),this[hw]=new KP().register(t=>new VU(t)),this[fw]=e,this[xl].setDRACOLoader(dw),this[xl].setKTX2Loader(p_)}static setDRACODecoderLocation(e){uw=e,dw.setDecoderPath(e)}static getDRACODecoderLocation(){return uw}static setKTX2TranscoderLocation(e){pw=e,p_.setTranscoderPath(e)}static getKTX2TranscoderLocation(){return pw}static setMeshoptDecoderLocation(e){f_!==e&&(f_=e,m_=WU(e).then(()=>MeshoptDecoder.ready).then(()=>MeshoptDecoder))}static getMeshoptDecoderLocation(){return f_}static initializeKTX2Loader(e){p_.detectSupport(e)}static get cache(){return Ga}static clearCache(){Ga.forEach((e,t)=>{this.delete(t)}),this[So].reset()}static has(e){return Ga.has(e)}static delete(e){return Jt(this,null,function*(){if(!this.has(e))return;const t=Ga.get(e);d_.delete(e),Ga.delete(e),(yield t).dispose()})}static hasFinishedLoading(e){return!!d_.get(e)}get[(cw=So,hw=xl,So)](){return this.constructor[So]}preload(e,t,i=()=>{}){return Jt(this,null,function*(){if(this[xl].setWithCredentials(Wn.withCredentials),this.dispatchEvent({type:"preload",element:t,src:e}),!Ga.has(e)){m_!=null&&this[xl].setMeshoptDecoder(yield m_);const s=HU(e,this[xl],a=>{i(a*.8)}),c=this[fw],u=s.then(a=>c.prepare(a)).then(a=>(i(.9),new c(a))).catch(a=>(console.error(a),new c));Ga.set(e,u)}yield Ga.get(e),d_.set(e,!0),i&&i(1)})}load(e,t,i=()=>{}){return Jt(this,null,function*(){yield this.preload(e,t,i);const s=yield(yield Ga.get(e)).clone();return this[So].retain(e),s.dispose=()=>{this[So].release(e)},s})}}Wn[cw]=new zU(Wn);class qU extends Zi{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new yi(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Wc=new we,mw=new pi,gw=new pi,Aw=new we,_w=new we;class $U{constructor(e={}){const t=this;let i,s,c,u;const a={objects:new WeakMap},m=e.element!==void 0?e.element:document.createElement("div");m.style.overflow="hidden",this.domElement=m,this.getSize=function(){return{width:i,height:s}},this.render=function(E,T){E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),T.parent===null&&T.matrixWorldAutoUpdate===!0&&T.updateMatrixWorld(),mw.copy(T.matrixWorldInverse),gw.multiplyMatrices(T.projectionMatrix,mw),A(E,E,T),I(E)},this.setSize=function(E,T){i=E,s=T,c=i/2,u=s/2,m.style.width=E+"px",m.style.height=T+"px"};function A(E,T,U){if(E.isCSS2DObject){Wc.setFromMatrixPosition(E.matrixWorld),Wc.applyMatrix4(gw);const P=E.visible===!0&&Wc.z>=-1&&Wc.z<=1&&E.layers.test(U.layers)===!0;if(E.element.style.display=P===!0?"":"none",P===!0){E.onBeforeRender(t,T,U);const X=E.element;X.style.transform="translate("+-100*E.center.x+"%,"+-100*E.center.y+"%)translate("+(Wc.x*c+c)+"px,"+(-Wc.y*u+u)+"px)",X.parentNode!==m&&m.appendChild(X),E.onAfterRender(t,T,U)}const R={distanceToCameraSquared:x(U,E)};a.objects.set(E,R)}for(let P=0,R=E.children.length;P<R;P++)A(E.children[P],T,U)}function x(E,T){return Aw.setFromMatrixPosition(E.matrixWorld),_w.setFromMatrixPosition(T.matrixWorld),Aw.distanceToSquared(_w)}function b(E){const T=[];return E.traverse(function(U){U.isCSS2DObject&&T.push(U)}),T}function I(E){const T=b(E).sort(function(P,R){if(P.renderOrder!==R.renderOrder)return R.renderOrder-P.renderOrder;const X=a.objects.get(P).distanceToCameraSquared,G=a.objects.get(R).distanceToCameraSquared;return X-G}),U=T.length;for(let P=0,R=T.length;P<R;P++)T[P].element.style.zIndex=U-P}}}function Tf(o,e,t){let i=t;const s=new we;return o.updateWorldMatrix(!0,!0),o.traverseVisible(c=>{const{geometry:u}=c;if(u!==void 0){const{position:a}=u.attributes;if(a!==void 0)for(let m=0,A=a.count;m<A;m++)c.isMesh?c.getVertexPosition(m,s):s.fromBufferAttribute(a,m),c.isSkinnedMesh||s.applyMatrix4(c.matrixWorld),i=e(i,s)}}),i}const yw={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class g_{constructor(){this.pluginCallbacks=[],this.register(function(e){return new nF(e)}),this.register(function(e){return new rF(e)}),this.register(function(e){return new oF(e)}),this.register(function(e){return new lF(e)}),this.register(function(e){return new cF(e)}),this.register(function(e){return new hF(e)}),this.register(function(e){return new sF(e)}),this.register(function(e){return new aF(e)}),this.register(function(e){return new uF(e)}),this.register(function(e){return new dF(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const c=new iF,u=[];for(let a=0,m=this.pluginCallbacks.length;a<m;a++)u.push(this.pluginCallbacks[a](c));c.setPlugins(u),c.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(s,c){i.parse(e,s,c,t)})}}const Mi={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},A_="KHR_mesh_quantization",is={};is[Pn]=Mi.NEAREST,is[ou]=Mi.NEAREST_MIPMAP_NEAREST,is[ac]=Mi.NEAREST_MIPMAP_LINEAR,is[dn]=Mi.LINEAR,is[Fp]=Mi.LINEAR_MIPMAP_NEAREST,is[Os]=Mi.LINEAR_MIPMAP_LINEAR,is[tr]=Mi.CLAMP_TO_EDGE,is[aa]=Mi.REPEAT,is[sc]=Mi.MIRRORED_REPEAT;const xw={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},jU=new hi,vw=12,XU=1179937895,YU=2,bw=8,KU=1313821514,ZU=5130562;function Nu(o,e){return o.length===e.length&&o.every(function(t,i){return t===e[i]})}function JU(o){return new TextEncoder().encode(o).buffer}function eF(o){return Nu(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function tF(o,e,t){const i={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let c=0;c<o.itemSize;c++){let u;o.itemSize>4?u=o.array[s*o.itemSize+c]:(c===0?u=o.getX(s):c===1?u=o.getY(s):c===2?u=o.getZ(s):c===3&&(u=o.getW(s)),o.normalized===!0&&(u=cl.normalize(u,o.array))),i.min[c]=Math.min(i.min[c],u),i.max[c]=Math.max(i.max[c],u)}return i}function ww(o){return Math.ceil(o/4)*4}function __(o,e=0){const t=ww(o.byteLength);if(t!==o.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(o)),e!==0)for(let s=o.byteLength;s<t;s++)i[s]=e;return i.buffer}return o}function Ew(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function Sw(o,e){if(o.toBlob!==void 0)return new Promise(i=>o.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),o.convertToBlob({type:e,quality:t})}class iF{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}write(e,t){return Jt(this,arguments,function*(i,s,c={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},c),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(i),yield Promise.all(this.pending);const u=this,a=u.buffers,m=u.json;c=u.options;const A=u.extensionsUsed,x=u.extensionsRequired,b=new Blob(a,{type:"application/octet-stream"}),I=Object.keys(A),E=Object.keys(x);if(I.length>0&&(m.extensionsUsed=I),E.length>0&&(m.extensionsRequired=E),m.buffers&&m.buffers.length>0&&(m.buffers[0].byteLength=b.size),c.binary===!0){const T=new FileReader;T.readAsArrayBuffer(b),T.onloadend=function(){const U=__(T.result),P=new DataView(new ArrayBuffer(bw));P.setUint32(0,U.byteLength,!0),P.setUint32(4,ZU,!0);const R=__(JU(JSON.stringify(m)),32),X=new DataView(new ArrayBuffer(bw));X.setUint32(0,R.byteLength,!0),X.setUint32(4,KU,!0);const G=new ArrayBuffer(vw),J=new DataView(G);J.setUint32(0,XU,!0),J.setUint32(4,YU,!0);const q=vw+X.byteLength+R.byteLength+P.byteLength+U.byteLength;J.setUint32(8,q,!0);const te=new Blob([G,X,R,P,U],{type:"application/octet-stream"}),ue=new FileReader;ue.readAsArrayBuffer(te),ue.onloadend=function(){s(ue.result)}}}else if(m.buffers&&m.buffers.length>0){const T=new FileReader;T.readAsDataURL(b),T.onloadend=function(){const U=T.result;m.buffers[0].uri=U,s(m)}}else s(m)})}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const c=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&c.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const u in c.gltfExtensions)t.extensions[u]=c.gltfExtensions[u],s[u]=!0;delete c.gltfExtensions}Object.keys(c).length>0&&(t.extras=c)}catch(c){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+c.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new we;for(let i=0,s=e.count;i<s;i++)if(Math.abs(t.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new we;for(let c=0,u=i.count;c<u;c++)s.fromBufferAttribute(i,c),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(c,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(s.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(I){return I.colorSpace===ni?function(E){return E<.04045?E*.0773993808:Math.pow(E*.9478672986+.0521327014,2.4)}:function(E){return E}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=e?e.image:null,c=t?t.image:null,u=Math.max(s?s.width:0,c?c.width:0),a=Math.max(s?s.height:0,c?c.height:0),m=Ew();m.width=u,m.height=a;const A=m.getContext("2d");A.fillStyle="#00ffff",A.fillRect(0,0,u,a);const x=A.getImageData(0,0,u,a);if(s){A.drawImage(s,0,0,u,a);const I=i(e),E=A.getImageData(0,0,u,a).data;for(let T=2;T<E.length;T+=4)x.data[T]=I(E[T]/256)*256}if(c){A.drawImage(c,0,0,u,a);const I=i(t),E=A.getImageData(0,0,u,a).data;for(let T=1;T<E.length;T+=4)x.data[T]=I(E[T]/256)*256}A.putImageData(x,0,0);const b=(e||t).clone();return b.source=new Gp(m),b.colorSpace=fs,b.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),b}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,c){const u=this.json;u.bufferViews||(u.bufferViews=[]);let a;switch(t){case Mi.BYTE:case Mi.UNSIGNED_BYTE:a=1;break;case Mi.SHORT:case Mi.UNSIGNED_SHORT:a=2;break;default:a=4}const m=ww(s*e.itemSize*a),A=new DataView(new ArrayBuffer(m));let x=0;for(let I=i;I<i+s;I++)for(let E=0;E<e.itemSize;E++){let T;e.itemSize>4?T=e.array[I*e.itemSize+E]:(E===0?T=e.getX(I):E===1?T=e.getY(I):E===2?T=e.getZ(I):E===3&&(T=e.getW(I)),e.normalized===!0&&(T=cl.normalize(T,e.array))),t===Mi.FLOAT?A.setFloat32(x,T,!0):t===Mi.INT?A.setInt32(x,T,!0):t===Mi.UNSIGNED_INT?A.setUint32(x,T,!0):t===Mi.SHORT?A.setInt16(x,T,!0):t===Mi.UNSIGNED_SHORT?A.setUint16(x,T,!0):t===Mi.BYTE?A.setInt8(x,T):t===Mi.UNSIGNED_BYTE&&A.setUint8(x,T),x+=a}const b={buffer:this.processBuffer(A.buffer),byteOffset:this.byteOffset,byteLength:m};return c!==void 0&&(b.target=c),c===Mi.ARRAY_BUFFER&&(b.byteStride=e.itemSize*a),this.byteOffset+=m,u.bufferViews.push(b),{id:u.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const c=new FileReader;c.readAsArrayBuffer(e),c.onloadend=function(){const u=__(c.result),a={buffer:t.processBuffer(u),byteOffset:t.byteOffset,byteLength:u.byteLength};t.byteOffset+=u.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,s){const c=this.json,u={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Mi.FLOAT;else if(e.array.constructor===Int32Array)a=Mi.INT;else if(e.array.constructor===Uint32Array)a=Mi.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=Mi.SHORT;else if(e.array.constructor===Uint16Array)a=Mi.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=Mi.BYTE;else if(e.array.constructor===Uint8Array)a=Mi.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(i===void 0&&(i=0),s===void 0&&(s=e.count),s===0)return null;const m=tF(e,i,s);let A;t!==void 0&&(A=e===t.index?Mi.ELEMENT_ARRAY_BUFFER:Mi.ARRAY_BUFFER);const x=this.processBufferView(e,a,i,s,A),b={bufferView:x.id,byteOffset:x.byteOffset,componentType:a,count:s,max:m.max,min:m.min,type:u[e.itemSize]};return e.normalized===!0&&(b.normalized=!0),c.accessors||(c.accessors=[]),c.accessors.push(b)-1}processImage(e,t,i,s="image/png"){if(e!==null){const c=this,u=c.cache,a=c.json,m=c.options,A=c.pending;u.images.has(e)||u.images.set(e,{});const x=u.images.get(e),b=s+":flipY/"+i.toString();if(x[b]!==void 0)return x[b];a.images||(a.images=[]);const I={mimeType:s},E=Ew();E.width=Math.min(e.width,m.maxTextureSize),E.height=Math.min(e.height,m.maxTextureSize);const T=E.getContext("2d");if(i===!0&&(T.translate(0,E.height),T.scale(1,-1)),e.data!==void 0){t!==Rn&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>m.maxTextureSize||e.height>m.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const P=new Uint8ClampedArray(e.height*e.width*4);for(let R=0;R<P.length;R+=4)P[R+0]=e.data[R+0],P[R+1]=e.data[R+1],P[R+2]=e.data[R+2],P[R+3]=e.data[R+3];T.putImageData(new ImageData(P,e.width,e.height),0,0)}else T.drawImage(e,0,0,E.width,E.height);m.binary===!0?A.push(Sw(E,s).then(P=>c.processBufferViewImage(P)).then(P=>{I.bufferView=P})):E.toDataURL!==void 0?I.uri=E.toDataURL(s):A.push(Sw(E,s).then(P=>new FileReader().readAsDataURL(P)).then(P=>{I.uri=P}));const U=a.images.push(I)-1;return x[b]=U,U}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:is[e.magFilter],minFilter:is[e.minFilter],wrapS:is[e.wrapS],wrapT:is[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const c={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(c.name=e.name),this._invokeAll(function(a){a.writeTexture&&a.writeTexture(e,c)});const u=i.textures.push(c)-1;return t.textures.set(e,u),u}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const c=e.color.toArray().concat([e.opacity]);if(Nu(c,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=c),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),m={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(m,a),s.pbrMetallicRoughness.metallicRoughnessTexture=m}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),s.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(s.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const m={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(m,e.emissiveMap),s.emissiveTexture=m}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),s.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),s.occlusionTexture=a}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===er&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,s)});const u=i.materials.push(s)-1;return t.materials.set(e,u),u}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let G=0,J=e.material.length;G<J;G++)s.push(e.material[G].uuid);else s.push(e.material.uuid);const c=s.join(":");if(t.meshes.has(c))return t.meshes.get(c);const u=e.geometry;let a;e.isLineSegments?a=Mi.LINES:e.isLineLoop?a=Mi.LINE_LOOP:e.isLine?a=Mi.LINE_STRIP:e.isPoints?a=Mi.POINTS:a=e.material.wireframe?Mi.LINES:Mi.TRIANGLES;const m={},A={},x=[],b=[],I={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},E=u.getAttribute("normal");E!==void 0&&!this.isNormalizedNormalAttribute(E)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),u.setAttribute("normal",this.createNormalizedNormalAttribute(E)));let T=null;for(let G in u.attributes){if(G.slice(0,5)==="morph")continue;const J=u.attributes[G];if(G=I[G]||G.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(G)||(G="_"+G),t.attributes.has(this.getUID(J))){A[G]=t.attributes.get(this.getUID(J));continue}T=null;const q=J.array;G==="JOINTS_0"&&!(q instanceof Uint16Array)&&!(q instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),T=new pn(new Uint16Array(q),J.itemSize,J.normalized));const te=this.processAccessor(T||J,u);te!==null&&(G.startsWith("_")||this.detectMeshQuantization(G,J),A[G]=te,t.attributes.set(this.getUID(J),te))}if(E!==void 0&&u.setAttribute("normal",E),Object.keys(A).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const G=[],J=[],q={};if(e.morphTargetDictionary!==void 0)for(const te in e.morphTargetDictionary)q[e.morphTargetDictionary[te]]=te;for(let te=0;te<e.morphTargetInfluences.length;++te){const ue={};let _e=!1;for(const K in u.morphAttributes){if(K!=="position"&&K!=="normal"){_e||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),_e=!0);continue}const ce=u.morphAttributes[K][te],Ve=K.toUpperCase(),Ne=u.attributes[K];if(t.attributes.has(this.getUID(ce,!0))){ue[Ve]=t.attributes.get(this.getUID(ce,!0));continue}const Me=ce.clone();if(!u.morphTargetsRelative)for(let ve=0,ke=ce.count;ve<ke;ve++)for(let Re=0;Re<ce.itemSize;Re++)Re===0&&Me.setX(ve,ce.getX(ve)-Ne.getX(ve)),Re===1&&Me.setY(ve,ce.getY(ve)-Ne.getY(ve)),Re===2&&Me.setZ(ve,ce.getZ(ve)-Ne.getZ(ve)),Re===3&&Me.setW(ve,ce.getW(ve)-Ne.getW(ve));ue[Ve]=this.processAccessor(Me,u),t.attributes.set(this.getUID(Ne,!0),ue[Ve])}b.push(ue),G.push(e.morphTargetInfluences[te]),e.morphTargetDictionary!==void 0&&J.push(q[te])}m.weights=G,J.length>0&&(m.extras={},m.extras.targetNames=J)}const U=Array.isArray(e.material);if(U&&u.groups.length===0)return null;const P=U?e.material:[e.material],R=U?u.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let G=0,J=R.length;G<J;G++){const q={mode:a,attributes:A};if(this.serializeUserData(u,q),b.length>0&&(q.targets=b),u.index!==null){let ue=this.getUID(u.index);(R[G].start!==void 0||R[G].count!==void 0)&&(ue+=":"+R[G].start+":"+R[G].count),t.attributes.has(ue)?q.indices=t.attributes.get(ue):(q.indices=this.processAccessor(u.index,u,R[G].start,R[G].count),t.attributes.set(ue,q.indices)),q.indices===null&&delete q.indices}const te=this.processMaterial(P[R[G].materialIndex]);te!==null&&(q.material=te),x.push(q)}m.primitives=x,i.meshes||(i.meshes=[]),this._invokeAll(function(G){G.writeMesh&&G.writeMesh(e,m)});const X=i.meshes.push(m)-1;return t.meshes.set(c,X),X}detectMeshQuantization(e,t){if(this.extensionsUsed[A_])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];yw[s]&&yw[s].includes(i)&&(this.extensionsUsed[A_]=!0,this.extensionsRequired[A_]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:cl.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),e=g_.Utils.mergeMorphTargetTracks(e.clone(),t);const c=e.tracks,u=[],a=[];for(let m=0;m<c.length;++m){const A=c[m],x=Si.parseTrackName(A.name);let b=Si.findNode(t,x.nodeName);const I=xw[x.propertyName];if(x.objectName==="bones"&&(b.isSkinnedMesh===!0?b=b.skeleton.getBoneByName(x.objectIndex):b=void 0),!b||!I)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',A.name),null;const E=1;let T=A.values.length/A.times.length;I===xw.morphTargetInfluences&&(T/=b.morphTargetInfluences.length);let U;A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(U="CUBICSPLINE",T/=3):A.getInterpolation()===ll?U="STEP":U="LINEAR",a.push({input:this.processAccessor(new pn(A.times,E)),output:this.processAccessor(new pn(A.values,T)),interpolation:U}),u.push({sampler:a.length-1,target:{node:s.get(b),path:I}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:u}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],c=e.skeleton;if(c===void 0)return null;const u=e.skeleton.bones[0];if(u===void 0)return null;const a=[],m=new Float32Array(c.bones.length*16),A=new pi;for(let x=0;x<c.bones.length;++x)a.push(i.get(c.bones[x])),A.copy(c.boneInverses[x]),A.multiply(e.bindMatrix).toArray(m,x*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new pn(m,16)),joints:a,skeleton:i.get(u)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const c={};if(i.trs){const a=e.quaternion.toArray(),m=e.position.toArray(),A=e.scale.toArray();Nu(a,[0,0,0,1])||(c.rotation=a),Nu(m,[0,0,0])||(c.translation=m),Nu(A,[1,1,1])||(c.scale=A)}else e.matrixAutoUpdate&&e.updateMatrix(),eF(e.matrix)===!1&&(c.matrix=e.matrix.elements);if(e.name!==""&&(c.name=String(e.name)),this.serializeUserData(e,c),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(c.mesh=a)}else e.isCamera&&(c.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let m=0,A=e.children.length;m<A;m++){const x=e.children[m];if(x.visible||i.onlyVisible===!1){const b=this.processNode(x);b!==null&&a.push(b)}}a.length>0&&(c.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,c)});const u=t.nodes.push(c)-1;return s.set(e,u),u}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const c=[];for(let u=0,a=e.children.length;u<a;u++){const m=e.children[u];if(m.visible||i.onlyVisible===!1){const A=this.processNode(m);A!==null&&c.push(A)}}c.length>0&&(s.nodes=c),this.serializeUserData(e,s)}processObjects(e){const t=new xs;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const i=[];for(let s=0;s<e.length;s++)e[s]instanceof xs?this.processScene(e[s]):i.push(e[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class nF{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,s=i.json,c=i.extensionsUsed,u={};e.name&&(u.name=e.name),u.color=e.color.toArray(),u.intensity=e.intensity,e.isDirectionalLight?u.type="directional":e.isPointLight?(u.type="point",e.distance>0&&(u.range=e.distance)):e.isSpotLight&&(u.type="spot",e.distance>0&&(u.range=e.distance),u.spot={},u.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,u.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),c[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},c[this.name]=!0);const a=s.extensions[this.name].lights;a.push(u),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class rF{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class sF{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.clearcoatFactor=e.clearcoat,e.clearcoatMap){const u={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(u,e.clearcoatMap),c.clearcoatTexture=u}if(c.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const u={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(u,e.clearcoatRoughnessMap),c.clearcoatRoughnessTexture=u}if(e.clearcoatNormalMap){const u={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(u,e.clearcoatNormalMap),c.clearcoatNormalTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class aF{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.iridescenceFactor=e.iridescence,e.iridescenceMap){const u={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(u,e.iridescenceMap),c.iridescenceTexture=u}if(c.iridescenceIor=e.iridescenceIOR,c.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],c.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const u={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(u,e.iridescenceThicknessMap),c.iridescenceThicknessTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class oF{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.transmissionFactor=e.transmission,e.transmissionMap){const u={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(u,e.transmissionMap),c.transmissionTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class lF{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.thicknessFactor=e.thickness,e.thicknessMap){const u={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(u,e.thicknessMap),c.thicknessTexture=u}c.attenuationDistance=e.attenuationDistance,c.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class cF{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const i=this.writer.extensionsUsed,s={};s.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}class hF{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(jU)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const i=this.writer,s=i.extensionsUsed,c={};if(e.specularIntensityMap){const u={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(u,e.specularIntensityMap),c.specularTexture=u}if(e.specularColorMap){const u={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(u,e.specularColorMap),c.specularColorTexture=u}c.specularFactor=e.specularIntensity,c.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class uF{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,s=i.extensionsUsed,c={};if(e.sheenRoughnessMap){const u={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(u,e.sheenRoughnessMap),c.sheenRoughnessTexture=u}if(e.sheenColorMap){const u={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(u,e.sheenColorMap),c.sheenColorTexture=u}c.sheenRoughnessFactor=e.sheenRoughness,c.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class dF{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=s,i[this.name]=!0}}g_.Utils={insertKeyframe:function(o,e){const t=o.getValueSize(),i=new o.TimeBufferType(o.times.length+1),s=new o.ValueBufferType(o.values.length+t),c=o.createInterpolant(new o.ValueBufferType(t));let u;if(o.times.length===0){i[0]=e;for(let a=0;a<t;a++)s[a]=0;u=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;i[0]=e,i.set(o.times,1),s.set(c.evaluate(e),0),s.set(o.values,t),u=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;i[i.length-1]=e,i.set(o.times,0),s.set(o.values,0),s.set(c.evaluate(e),o.values.length),u=i.length-1}else for(let a=0;a<o.times.length;a++){if(Math.abs(o.times[a]-e)<.001)return a;if(o.times[a]<e&&o.times[a+1]>e){i.set(o.times.slice(0,a+1),0),i[a+1]=e,i.set(o.times.slice(a+1),a+2),s.set(o.values.slice(0,(a+1)*t),0),s.set(c.evaluate(e),(a+1)*t),s.set(o.values.slice((a+1)*t),(a+2)*t),u=a+1;break}}return o.times=i,o.values=s,u},mergeMorphTargetTracks:function(o,e){const t=[],i={},s=o.tracks;for(let c=0;c<s.length;++c){let u=s[c];const a=Si.parseTrackName(u.name),m=Si.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(u);continue}if(u.createInterpolant!==u.InterpolantFactoryMethodDiscrete&&u.createInterpolant!==u.InterpolantFactoryMethodLinear){if(u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),u=u.clone(),u.setInterpolation(uo)}const A=m.morphTargetInfluences.length,x=m.morphTargetDictionary[a.propertyIndex];if(x===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let b;if(i[m.uuid]===void 0){b=u.clone();const E=new b.ValueBufferType(A*b.times.length);for(let T=0;T<b.times.length;T++)E[T*A+x]=b.values[T];b.name=(a.nodeName||"")+".morphTargetInfluences",b.values=E,i[m.uuid]=b,t.push(b);continue}const I=u.createInterpolant(new u.ValueBufferType(1));b=i[m.uuid];for(let E=0;E<b.times.length;E++)b.values[E*A+x]=I.evaluate(b.times[E]);for(let E=0;E<u.times.length;E++){const T=this.insertKeyframe(b,u.times[E]);b.values[T*A+x]=u.values[E]}}return o.tracks=t,o}};/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Iw=o=>o.material!==void 0&&o.userData&&o.userData.variantMaterials&&!!Array.from(o.userData.variantMaterials.values()).filter(e=>Bf(e.material)),Bf=o=>o&&o.isMaterial&&!Array.isArray(o);class pF{constructor(e){this.writer=e,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(e){const t=new Set;for(const i of e)i.traverse(s=>{if(!Iw(s))return;const c=s.userData.variantMaterials,u=s.userData.variantData;for(const[a,m]of u){const A=c.get(m.index);A&&Bf(A.material)&&t.add(a)}});t.forEach(i=>this.variantNames.push(i))}writeMesh(e,t){if(!Iw(e))return;const i=e.userData,s=i.variantMaterials,c=i.variantData,u=new Map,a=new Map,m=Array.from(c.values()).sort((b,I)=>b.index-I.index);for(const[b,I]of m.entries())a.set(I.index,b);for(const b of c.values()){const I=s.get(b.index);if(!I||!Bf(I.material))continue;const E=this.writer.processMaterial(I.material);u.has(E)||u.set(E,{material:E,variants:[]}),u.get(E).variants.push(a.get(b.index))}const A=Array.from(u.values()).map(b=>b.variants.sort((I,E)=>I-E)&&b).sort((b,I)=>b.material-I.material);if(A.length===0)return;const x=Bf(i.originalMaterial)?this.writer.processMaterial(i.originalMaterial):-1;for(const b of t.primitives)x>=0&&(b.material=x),b.extensions=b.extensions||{},b.extensions[this.name]={mappings:A}}afterParse(){if(this.variantNames.length===0)return;const e=this.writer.json;e.extensions=e.extensions||{};const t=this.variantNames.map(i=>({name:i}));e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}class fF{constructor(e,t,i,s,c){this.xrLight=e,this.renderer=t,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=c,this.frameCallback=this.onXRFrame.bind(this);const u=t.xr.getSession();if(s&&"XRWebGLBinding"in window){const a=new uA(16);e.environment=a.texture;const m=t.getContext();switch(u.preferredReflectionFormat){case"srgba8":m.getExtension("EXT_sRGB");break;case"rgba16f":m.getExtension("OES_texture_half_float");break}this.xrWebGLBinding=new XRWebGLBinding(u,m),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}u.requestAnimationFrame(this.frameCallback)}updateReflection(){const e=this.renderer.properties.get(this.xrLight.environment);if(e){const t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(e,t){if(!this.xrLight)return;t.session.requestAnimationFrame(this.frameCallback);const i=t.getLightEstimate(this.lightProbe);if(i){this.xrLight.lightProbe.sh.fromArray(i.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const s=Math.max(1,Math.max(i.primaryLightIntensity.x,Math.max(i.primaryLightIntensity.y,i.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(i.primaryLightIntensity.x/s,i.primaryLightIntensity.y/s,i.primaryLightIntensity.z/s),this.xrLight.directionalLight.intensity=s,this.xrLight.directionalLight.position.copy(i.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class mF extends _o{constructor(e,t=!0){super(),this.lightProbe=new VD,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new hb,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let i=null,s=!1;e.xr.addEventListener("sessionstart",()=>{const c=e.xr.getSession();"requestLightProbe"in c&&c.requestLightProbe({reflectionFormat:c.preferredReflectionFormat}).then(u=>{i=new fF(this,e,u,t,()=>{s=!0,this.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",()=>{i&&(i.dispose(),i=null),s&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{i&&(i.dispose(),i=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Cw=1e4,gF=.001,Mw=50;class ns{constructor(e=Mw){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(gF,e)}update(e,t,i,s){const c=2e-4*this.naturalFrequency;if(e==null||s===0||e===t&&this.velocity===0)return t;if(i<0)return e;const u=e-t,a=this.velocity+this.naturalFrequency*u,m=u+i*a,A=Math.exp(-this.naturalFrequency*i),x=(a-this.naturalFrequency*m)*A,b=-this.naturalFrequency*(x+a*A);return Math.abs(x)<c*Math.abs(s)&&b*u>=0?(this.velocity=0,t):(this.velocity=x,t+m*A)}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const qc=.2,Tw=.03,AF=.75,Bw=12,_F=Math.PI/(2*Bw),Rw=new yi,Rf=(o,e,t)=>{let i=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let s=0;s<=Bw;++s)o.push(e+(qc-Tw)*Math.cos(i),t+(qc-Tw)*Math.sin(i),0,e+qc*Math.cos(i),t+qc*Math.sin(i),0),i+=_F};class Lw extends oi{constructor(e,t){const i=new ys,s=[],c=[],{size:u,boundingBox:a}=e,m=u.x/2,A=(t==="back"?u.y:u.z)/2;Rf(c,m,A),Rf(c,-m,A),Rf(c,-m,-A),Rf(c,m,-A);const x=c.length/3;for(let E=0;E<x-2;E+=2)s.push(E,E+1,E+3,E,E+3,E+2);const b=x-2;s.push(b,b+1,1,b,1,0),i.setAttribute("position",new oa(c,3)),i.setIndex(s),super(i),this.side=t;const I=this.material;switch(I.side=er,I.transparent=!0,I.opacity=0,this.goalOpacity=0,this.opacityDamper=new ns,this.hitPlane=new oi(new ka(2*(m+qc),2*(A+qc))),this.hitPlane.visible=!1,this.hitPlane.material.side=er,this.add(this.hitPlane),a.getCenter(this.position),t){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=a.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=a.min.z,this.position.z=this.shadowHeight}e.target.add(this),this.offsetHeight=0}getHit(e,t,i){Rw.set(t,-i),this.hitPlane.visible=!0;const s=e.positionAndNormalFromPoint(Rw,this.hitPlane);return this.hitPlane.visible=!1,s==null?null:s.position}getExpandedHit(e,t,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const s=this.getHit(e,t,i);return this.hitPlane.scale.set(1,1,1),s}set offsetHeight(e){e-=.001,this.side==="back"?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this.side==="back"?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.goalOpacity=e?AF:0}updateOpacity(e){const t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:i}=this.hitPlane;t.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const fr=(o,e)=>({type:"number",number:o,unit:e}),Io=(()=>{const o={};return e=>{const t=e;if(t in o)return o[t];const i=[];let s=0;for(;e;){if(++s>1e3){e="";break}const c=Dw(e),u=c.nodes[0];if(u==null||u.terms.length===0)break;i.push(u),e=c.remainingInput}return o[t]=i}})(),Dw=(()=>{const o=/^(\-\-|[a-z\u0240-\uffff])/i,e=/^([\*\+\/]|[\-]\s)/i,t=/^[\),]/,i="(",s="#";return c=>{const u=[];for(;c.length&&(c=c.trim(),!t.test(c));)if(c[0]===i){const{nodes:a,remainingInput:m}=Pw(c);c=m,u.push({type:"function",name:{type:"ident",value:"calc"},arguments:a})}else if(o.test(c)){const a=yF(c),m=a.nodes[0];if(c=a.remainingInput,c[0]===i){const{nodes:A,remainingInput:x}=Pw(c);u.push({type:"function",name:m,arguments:A}),c=x}else u.push(m)}else if(e.test(c))u.push({type:"operator",value:c[0]}),c=c.slice(1);else{const{nodes:a,remainingInput:m}=c[0]===s?vF(c):xF(c);if(a.length===0)break;u.push(a[0]),c=m}return{nodes:[{type:"expression",terms:u}],remainingInput:c}}})(),yF=(()=>{const o=/[^a-z0-9_\-\u0240-\uffff]/i;return e=>{const t=e.match(o),i=t==null?e:e.substr(0,t.index),s=t==null?"":e.substr(t.index);return{nodes:[{type:"ident",value:i}],remainingInput:s}}})(),xF=(()=>{const o=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,e=/^[a-z%]+/i,t=/^(m|mm|cm|rad|deg|[%])$/;return i=>{const s=i.match(o),c=s==null?"0":s[0];i=c==null?i:i.slice(c.length);const u=i.match(e);let a=u!=null&&u[0]!==""?u[0]:null;const m=u==null?i:i.slice(a.length);return a!=null&&!t.test(a)&&(a=null),{nodes:[{type:"number",number:parseFloat(c)||0,unit:a}],remainingInput:m}}})(),vF=(()=>{const o=/^[a-f0-9]*/i;return e=>{e=e.slice(1).trim();const t=e.match(o);return{nodes:t==null?[]:[{type:"hex",value:t[0]}],remainingInput:t==null?e:e.slice(t[0].length)}}})(),Pw=o=>{const e=[];for(o=o.slice(1).trim();o.length;){const t=Dw(o);if(e.push(t.nodes[0]),o=t.remainingInput.trim(),o[0]===",")o=o.slice(1).trim();else if(o[0]===")"){o=o.slice(1);break}}return{nodes:e,remainingInput:o}},Uw=Symbol("visitedTypes");class bF{constructor(e){this[Uw]=e}walk(e,t){const i=e.slice();for(;i.length;){const s=i.shift();switch(this[Uw].indexOf(s.type)>-1&&t(s),s.type){case"expression":i.unshift(...s.terms);break;case"function":i.unshift(s.name,...s.arguments);break}}}}const Co=Object.freeze({type:"number",number:0,unit:null});/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Lf=(o,e=0)=>{let{number:t,unit:i}=o;if(!isFinite(t))t=e,i="rad";else if(o.unit==="rad"||o.unit==null)return o;const s=(i==="deg"&&t!=null?t:0)*Math.PI/180;return{type:"number",number:s,unit:"rad"}},Fw=(o,e=0)=>{let{number:t,unit:i}=o;if(!isFinite(t))t=e,i="m";else if(o.unit==="m")return o;let s;switch(i){default:s=1;break;case"cm":s=1/100;break;case"mm":s=1/1e3;break}const c=s*t;return{type:"number",number:c,unit:"m"}},Qa=(()=>{const o=t=>t,e={rad:o,deg:Lf,m:o,mm:Fw,cm:Fw};return(t,i=Co)=>{isFinite(t.number)||(t.number=i.number,t.unit=i.unit);const{unit:s}=t;if(s==null)return t;const c=e[s];return c==null?i:c(t)}})();/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var kw,Nw,Ow;const $c=Symbol("evaluate"),Df=Symbol("lastValue");class gn{constructor(){this[kw]=null}static evaluatableFor(e,t=Co){if(e instanceof gn)return e;if(e.type==="number")return e.unit==="%"?new wF(e,t):e;switch(e.name.value){case"calc":return new IF(e,t);case"env":return new EF(e)}return Co}static evaluate(e){return e instanceof gn?e.evaluate():e}static isConstant(e){return e instanceof gn?e.isConstant:!0}static applyIntrinsics(e,t){const{basis:i,keywords:s}=t,{auto:c}=s;return i.map((u,a)=>{const m=c[a]==null?u:c[a];let A=e[a]?e[a]:m;if(A.type==="ident"){const x=A.value;x in s&&(A=s[x][a])}return(A==null||A.type==="ident")&&(A=m),A.unit==="%"?fr(A.number/100*u.number,u.unit):(A=Qa(A,u),A.unit!==u.unit?u:A)})}get isConstant(){return!1}evaluate(){return(!this.isConstant||this[Df]==null)&&(this[Df]=this[$c]()),this[Df]}}kw=Df;const zw=Symbol("percentage"),y_=Symbol("basis");class wF extends gn{constructor(e,t){super(),this[zw]=e,this[y_]=t}get isConstant(){return!0}[$c](){return fr(this[zw].number/100*this[y_].number,this[y_].unit)}}const Pf=Symbol("identNode");class EF extends gn{constructor(e){super(),this[Nw]=null;const t=e.arguments.length?e.arguments[0].terms[0]:null;t!=null&&t.type==="ident"&&(this[Pf]=t)}get isConstant(){return!1}[(Nw=Pf,$c)](){if(this[Pf]!=null)switch(this[Pf].value){case"window-scroll-y":const e=window.pageYOffset,t=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),i=e/(t-window.innerHeight)||0;return{type:"number",number:i,unit:null}}return Co}}const SF=/[\*\/]/,jc=Symbol("evaluator");class IF extends gn{constructor(e,t=Co){if(super(),this[Ow]=null,e.arguments.length!==1)return;const i=e.arguments[0].terms.slice(),s=[];for(;i.length;){const c=i.shift();if(s.length>0){const u=s[s.length-1];if(u.type==="operator"&&SF.test(u.value)){const a=s.pop(),m=s.pop();if(m==null)return;s.push(new Qw(a,gn.evaluatableFor(m,t),gn.evaluatableFor(c,t)));continue}}s.push(c.type==="operator"?c:gn.evaluatableFor(c,t))}for(;s.length>2;){const[c,u,a]=s.splice(0,3);if(u.type!=="operator")return;s.unshift(new Qw(u,gn.evaluatableFor(c,t),gn.evaluatableFor(a,t)))}s.length===1&&(this[jc]=s[0])}get isConstant(){return this[jc]==null||gn.isConstant(this[jc])}[(Ow=jc,$c)](){return this[jc]!=null?gn.evaluate(this[jc]):Co}}const Gw=Symbol("operator"),x_=Symbol("left"),v_=Symbol("right");class Qw extends gn{constructor(e,t,i){super(),this[Gw]=e,this[x_]=t,this[v_]=i}get isConstant(){return gn.isConstant(this[x_])&&gn.isConstant(this[v_])}[$c](){const e=Qa(gn.evaluate(this[x_])),t=Qa(gn.evaluate(this[v_])),{number:i,unit:s}=e,{number:c,unit:u}=t;if(u!=null&&s!=null&&u!=s)return Co;const a=s||u;let m;switch(this[Gw].value){case"+":m=i+c;break;case"-":m=i-c;break;case"/":m=i/c;break;case"*":m=i*c;break;default:return Co}return{type:"number",number:m,unit:a}}}const b_=Symbol("evaluatables"),Vw=Symbol("intrinsics");class Hw extends gn{constructor(e,t){super(),this[Vw]=t;const i=e[0],s=i!=null?i.terms:[];this[b_]=t.basis.map((c,u)=>{const a=s[u];return a==null?{type:"ident",value:"auto"}:a.type==="ident"?a:gn.evaluatableFor(a,c)})}get isConstant(){for(const e of this[b_])if(!gn.isConstant(e))return!1;return!0}[$c](){const e=this[b_].map(t=>gn.evaluate(t));return gn.applyIntrinsics(e,this[Vw]).map(t=>t.number)}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var Ww,qw,$w,jw;const Xc=Symbol("instances"),Xw=Symbol("activateListener"),Yw=Symbol("deactivateListener"),w_=Symbol("notifyInstances"),Kw=Symbol("notify"),Zw=Symbol("callback");class fa{constructor(e){this[Zw]=e}static[w_](){for(const e of fa[Xc])e[Kw]()}static[(Ww=Xc,Xw)](){window.addEventListener("scroll",this[w_],{passive:!0})}static[Yw](){window.removeEventListener("scroll",this[w_])}observe(){fa[Xc].size===0&&fa[Xw](),fa[Xc].add(this)}disconnect(){fa[Xc].delete(this),fa[Xc].size===0&&fa[Yw]()}[Kw](){this[Zw]()}}fa[Ww]=new Set;const Jw=Symbol("computeStyleCallback"),eE=Symbol("astWalker"),Ou=Symbol("dependencies"),tE=Symbol("onScroll");class CF{constructor(e){this[qw]={},this[$w]=new bF(["function"]),this[jw]=()=>{this[Jw]({relatedState:"window-scroll"})},this[Jw]=e}observeEffectsFor(e){const t={},i=this[Ou];this[eE].walk(e,s=>{const{name:c}=s,u=s.arguments[0].terms[0];if(!(c.value!=="env"||u==null||u.type!=="ident"))switch(u.value){case"window-scroll-y":if(t["window-scroll"]==null){const a="window-scroll"in i?i["window-scroll"]:new fa(this[tE]);a.observe(),delete i["window-scroll"],t["window-scroll"]=a}break}});for(const s in i)i[s].disconnect();this[Ou]=t}dispose(){for(const e in this[Ou])this[Ou][e].disconnect()}}qw=Ou,$w=eE,jw=tE;/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Mo=o=>{const e=o.observeEffects||!1,t=o.intrinsics instanceof Function?o.intrinsics:()=>o.intrinsics;return(i,s)=>{const c=i.updated,u=i.connectedCallback,a=i.disconnectedCallback,m=Symbol(`${s}StyleEffector`),A=Symbol(`${s}StyleEvaluator`),x=Symbol(`${s}UpdateEvaluator`),b=Symbol(`${s}EvaluateAndSync`);Object.defineProperties(i,{[m]:{value:null,writable:!0},[A]:{value:null,writable:!0},[x]:{value:function(){const I=Io(this[s]);this[A]=new Hw(I,t(this)),this[m]==null&&e&&(this[m]=new CF(()=>this[b]())),this[m]!=null&&this[m].observeEffectsFor(I)}},[b]:{value:function(){if(this[A]==null)return;const I=this[A].evaluate();this[o.updateHandler](I)}},updated:{value:function(I){I.has(s)&&(this[x](),this[b]()),c.call(this,I)}},connectedCallback:{value:function(){u.call(this),this.requestUpdate(s,this[s])}},disconnectedCallback:{value:function(){a.call(this),this[m]!=null&&(this[m].dispose(),this[m]=null)}}})}};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const iE=o=>o<.5?2*o*o:-1+(4-2*o)*o,MF=(o,e,t=iE)=>i=>o+(e-o)*t(i),TF=(o,e)=>{const t=s=>c=>s+=c,i=e.map(t(0));return s=>{s=da(s,0,1),s*=i[i.length-1];const c=i.findIndex(m=>m>=s),u=c<1?0:i[c-1],a=i[c];return o[c]((s-u)/(a-u))}},Yc=o=>{const e=[],t=[];let i=o.initialValue;for(let s=0;s<o.keyframes.length;++s){const c=o.keyframes[s],{value:u,frames:a}=c,m=c.ease||iE,A=MF(i,u,m);e.push(A),t.push(a),i=u}return TF(e,t)};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var nr=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};const BF=5e3,RF=Yc({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),LF=Yc({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),DF=30,PF=12,nE="0deg 75deg 105%",UF="auto auto auto",FF="auto",kF=2.2,NF=["front","right","back","left"],OF=["upper-","","lower-"],zF=3e3,GF=". Use mouse, touch or arrow keys to move.",Uf={AUTO:"auto",NONE:"none"},E_={BASIC:"basic",WIGGLE:"wiggle"},QF={PAN_Y:"pan-y",PAN_X:"pan-x",NONE:"none"},rE=()=>({basis:[Lf(fr(DF,"deg"))],keywords:{auto:[null]}}),VF=()=>({basis:[Lf(fr(PF,"deg"))],keywords:{auto:[null]}}),sE=(()=>{const o=Io(nE)[0].terms,e=Qa(o[0]),t=Qa(o[1]);return i=>{const s=i[Mt].idealCameraDistance();return{basis:[e,t,fr(s,"m")],keywords:{auto:[null,null,fr(105,"%")]}}}})(),HF=o=>{const e=kF*o[Mt].boundingSphere.radius;return{basis:[fr(-1/0,"rad"),fr(Math.PI/8,"rad"),fr(e,"m")],keywords:{auto:[null,null,null]}}},WF=o=>{const e=sE(o),t=new Hw([],e).evaluate()[2];return{basis:[fr(1/0,"rad"),fr(Math.PI-Math.PI/8,"rad"),fr(t,"m")],keywords:{auto:[null,null,null]}}},qF=o=>{const e=o[Mt].boundingBox.getCenter(new we);return{basis:[fr(e.x,"m"),fr(e.y,"m"),fr(e.z,"m")],keywords:{auto:[null,null,null]}}},aE=Math.PI/2,$F=Math.PI/3,jF=aE/2,XF=2*Math.PI,Yi=Symbol("controls"),Ff=Symbol("panElement"),S_=Symbol("promptElement"),kf=Symbol("promptAnimatedContainer"),I_=Symbol("fingerAnimatedContainers"),Nf=Symbol("deferInteractionPrompt"),oE=Symbol("updateAria"),lE=Symbol("updateCameraForRadius"),Kc=Symbol("cancelPrompts"),C_=Symbol("onChange"),zu=Symbol("onPointerChange"),vl=Symbol("waitingToPromptUser"),Of=Symbol("userHasInteracted"),Zc=Symbol("promptElementVisibleTime"),Gu=Symbol("lastPromptOffset"),zf=Symbol("cancellationSource"),M_=Symbol("lastSpherical"),Qu=Symbol("jumpCamera"),T_=Symbol("initialized"),Vu=Symbol("maintainThetaPhi"),cE=Symbol("syncCameraOrbit"),hE=Symbol("syncFieldOfView"),uE=Symbol("syncCameraTarget"),dE=Symbol("syncMinCameraOrbit"),pE=Symbol("syncMaxCameraOrbit"),fE=Symbol("syncMinFieldOfView"),mE=Symbol("syncMaxFieldOfView"),YF=o=>{var e,t,i,s,c,u,a,m,A,x,b,I,E,T,U,P,R;class X extends o{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=nE,this.cameraTarget=UF,this.fieldOfView=FF,this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=zF,this.interactionPrompt=Uf.AUTO,this.interactionPromptStyle=E_.WIGGLE,this.orbitSensitivity=1,this.touchAction=QF.NONE,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=Mw,this[e]=this.shadowRoot.querySelector(".interaction-prompt"),this[t]=this.shadowRoot.querySelector("#prompt"),this[i]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[s]=this.shadowRoot.querySelector(".pan-target"),this[c]=0,this[u]=1/0,this[a]=!1,this[m]=!1,this[A]=bn.AUTOMATIC,this[x]=new e4(this[Mt].camera,this[ga],this[Mt]),this[b]=new yf,this[I]=!1,this[E]=!1,this[T]=!1,this[U]=()=>{const J=this[Yi].changeSource;this[zf]=J,J===bn.USER_INTERACTION&&(this[Of]=!0,this[Nf]())},this[P]=()=>{this[oE](),this[Hr]();const J=this[Yi].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:J}}))},this[R]=J=>{J.type==="pointer-change-start"?this[td].classList.add("pointer-tumbling"):this[td].classList.remove("pointer-tumbling")}}get inputSensitivity(){return this[Yi].inputSensitivity}set inputSensitivity(J){this[Yi].inputSensitivity=J}getCameraOrbit(){const{theta:J,phi:q,radius:te}=this[M_];return{theta:J,phi:q,radius:te,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return Po(this[$i].isPresenting?this[$i].arRenderer.target:this[Mt].getTarget())}getFieldOfView(){return this[Yi].getFieldOfView()}getMinimumFieldOfView(){return this[Yi].options.minimumFieldOfView}getMaximumFieldOfView(){return this[Yi].options.maximumFieldOfView}getIdealAspect(){return this[Mt].idealAspect}jumpCameraToGoal(){this[Qu]=!0,this.requestUpdate(Qu,!1)}resetInteractionPrompt(){this[Gu]=0,this[Zc]=1/0,this[Of]=!1,this[vl]=this.interactionPrompt===Uf.AUTO&&this.cameraControls}zoom(J){const q=new WheelEvent("wheel",{deltaY:-30*J});this[ga].dispatchEvent(q)}connectedCallback(){super.connectedCallback(),this[Yi].addEventListener("user-interaction",this[Kc]),this[Yi].addEventListener("pointer-change-start",this[zu]),this[Yi].addEventListener("pointer-change-end",this[zu])}disconnectedCallback(){super.disconnectedCallback(),this[Yi].removeEventListener("user-interaction",this[Kc]),this[Yi].removeEventListener("pointer-change-start",this[zu]),this[Yi].removeEventListener("pointer-change-end",this[zu])}updated(J){super.updated(J);const q=this[Yi],te=this[Mt];if(J.has("cameraControls")&&(this.cameraControls?(q.enableInteraction(),this.interactionPrompt===Uf.AUTO&&(this[vl]=!0)):(q.disableInteraction(),this[Nf]()),this[ga].setAttribute("aria-label",this[Zu])),J.has("disableZoom")&&(q.disableZoom=this.disableZoom),J.has("disablePan")&&(q.enablePan=!this.disablePan),J.has("disableTap")&&(q.enableTap=!this.disableTap),(J.has("interactionPrompt")||J.has("cameraControls")||J.has("src"))&&(this.interactionPrompt===Uf.AUTO&&this.cameraControls&&!this[Of]?this[vl]=!0:this[Nf]()),J.has("interactionPromptStyle")&&(this[kf].style.opacity=this.interactionPromptStyle==E_.BASIC?"1":"0"),J.has("touchAction")){const ue=this.touchAction;q.applyOptions({touchAction:ue}),q.updateTouchActionStyle()}J.has("orbitSensitivity")&&(q.orbitSensitivity=this.orbitSensitivity),J.has("interpolationDecay")&&(q.setDamperDecayTime(this.interpolationDecay),te.setTargetDamperDecayTime(this.interpolationDecay)),this[Qu]===!0&&Promise.resolve().then(()=>{q.jumpToGoal(),te.jumpToGoal(),this[C_](),this[Qu]=!1})}updateFraming(){return Jt(this,null,function*(){const J=this[Mt],q=J.adjustedFoV(J.framedFoVDeg);yield J.updateFraming();const te=J.adjustedFoV(J.framedFoVDeg),ue=this[Yi].getFieldOfView()/q;this[Yi].setFieldOfView(te*ue),this[Vu]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),yield this.updateComplete})}interact(J,q,te){const ue=this[ga],_e=this[I_];if(_e[0].style.opacity==="1"){console.warn("interact() failed because an existing interaction is running.");return}const K=[];K.push({x:Yc(q.x),y:Yc(q.y)});const ce=[{x:K[0].x(0),y:K[0].y(0)}];te!=null&&(K.push({x:Yc(te.x),y:Yc(te.y)}),ce.push({x:K[1].x(0),y:K[1].y(0)}));let Ve=performance.now();const{width:Ne,height:Me}=this[Mt],ve=this.getBoundingClientRect(),ke=Oe=>{for(const[je,Je]of ce.entries()){const{style:_t}=_e[je];_t.transform=`translateX(${Ne*Je.x}px) translateY(${Me*Je.y}px)`,Oe==="pointerdown"?_t.opacity="1":Oe==="pointerup"&&(_t.opacity="0");const yt={pointerId:je-5678,pointerType:"touch",target:ue,clientX:Ne*Je.x+ve.x,clientY:Me*Je.y+ve.y,altKey:!0};ue.dispatchEvent(new PointerEvent(Oe,yt))}},Re=()=>{const Oe=this[zf];if(Oe!==bn.AUTOMATIC||!ue.isConnected){for(const Je of this[I_])Je.style.opacity="0";ke("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:Oe}})),document.removeEventListener("visibilitychange",Fe);return}const je=Math.min(1,(performance.now()-Ve)/J);for(const[Je,_t]of ce.entries())_t.x=K[Je].x(je),_t.y=K[Je].y(je);ke("pointermove"),je<1?requestAnimationFrame(Re):(ke("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:bn.AUTOMATIC}})),document.removeEventListener("visibilitychange",Fe))},Fe=()=>{let Oe=0;document.visibilityState==="hidden"?Oe=performance.now()-Ve:Ve=performance.now()-Oe};document.addEventListener("visibilitychange",Fe),ke("pointerdown"),this[zf]=bn.AUTOMATIC,requestAnimationFrame(Re)}[(e=S_,t=kf,i=I_,s=Ff,c=Gu,u=Zc,a=Of,m=vl,A=zf,x=Yi,b=M_,I=Qu,E=T_,T=Vu,hE)](J){const q=this[Yi],te=this[Mt];te.framedFoVDeg=J[0]*180/Math.PI,q.changeSource=bn.NONE,q.setFieldOfView(te.adjustedFoV(te.framedFoVDeg)),this[Kc]()}[cE](J){const q=this[Yi];if(this[Vu]){const{theta:te,phi:ue}=this.getCameraOrbit();J[0]=te,J[1]=ue,this[Vu]=!1}q.changeSource=bn.NONE,q.setOrbit(J[0],J[1],J[2]),this[Kc]()}[dE](J){this[Yi].applyOptions({minimumAzimuthalAngle:J[0],minimumPolarAngle:J[1],minimumRadius:J[2]}),this.jumpCameraToGoal()}[pE](J){this[Yi].applyOptions({maximumAzimuthalAngle:J[0],maximumPolarAngle:J[1],maximumRadius:J[2]}),this[lE](J[2]),this.jumpCameraToGoal()}[fE](J){this[Yi].applyOptions({minimumFieldOfView:J[0]*180/Math.PI}),this.jumpCameraToGoal()}[mE](J){const q=this[Mt].adjustedFoV(J[0]*180/Math.PI);this[Yi].applyOptions({maximumFieldOfView:q}),this.jumpCameraToGoal()}[uE](J){const[q,te,ue]=J;this[$i].arRenderer.isPresenting||this[Mt].setTarget(q,te,ue),this[Yi].changeSource=bn.NONE,this[$i].arRenderer.updateTarget(),this[Kc]()}[Aa](J,q){if(super[Aa](J,q),this[$i].isPresenting||!this[Bl]())return;const te=this[Yi],ue=this[Mt],_e=performance.now();if(this[vl]&&this.loaded&&_e>this[ed]+this.interactionPromptThreshold&&(this[vl]=!1,this[Zc]=_e,this[S_].classList.add("visible")),isFinite(this[Zc])&&this.interactionPromptStyle===E_.WIGGLE){const Ve=(_e-this[Zc])/BF%1,Ne=RF(Ve),Me=LF(Ve);if(this[kf].style.opacity=`${Me}`,Ne!==this[Gu]){const ve=Ne*ue.width*.05,ke=(Ne-this[Gu])*Math.PI/16;this[kf].style.transform=`translateX(${ve}px)`,te.changeSource=bn.AUTOMATIC,te.adjustOrbit(ke,0,0),this[Gu]=Ne}}const K=te.update(J,q),ce=ue.updateTarget(q);(K||ce)&&this[C_]()}[Nf](){this[vl]=!1,this[S_].classList.remove("visible"),this[Zc]=1/0}[lE](J){const q=Math.max(this[Mt].boundingSphere.radius,J),te=0,ue=Math.abs(2*q);this[Yi].updateNearFar(te,ue)}[oE](){const{theta:J,phi:q}=this[Yi].getCameraSpherical(this[M_]),te=(4+Math.floor((J%XF+jF)/aE))%4,ue=Math.floor(q/$F),_e=NF[te],K=OF[ue];this[r0](`View from stage ${K}${_e}`)}get[Zu](){return super[Zu].replace(/\.$/,"")+(this.cameraControls?GF:"")}[id](J){return Jt(this,null,function*(){const q=this[Yi],te=this[Mt],ue=te.adjustedFoV(te.framedFoVDeg);FA(X.prototype,this,id).call(this,J);const _e=te.adjustedFoV(te.framedFoVDeg)/ue,K=q.getFieldOfView()*(isFinite(_e)?_e:1);q.updateAspect(this[Mt].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),yield this.updateComplete,this[Yi].setFieldOfView(K),this.jumpCameraToGoal()})}[Do](){super[Do](),this[T_]?this[Vu]=!0:this[T_]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}return U=Kc,P=C_,R=zu,nr([ui({type:Boolean,attribute:"camera-controls"})],X.prototype,"cameraControls",void 0),nr([Mo({intrinsics:sE,observeEffects:!0,updateHandler:cE}),ui({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],X.prototype,"cameraOrbit",void 0),nr([Mo({intrinsics:qF,observeEffects:!0,updateHandler:uE}),ui({type:String,attribute:"camera-target",hasChanged:()=>!0})],X.prototype,"cameraTarget",void 0),nr([Mo({intrinsics:rE,observeEffects:!0,updateHandler:hE}),ui({type:String,attribute:"field-of-view",hasChanged:()=>!0})],X.prototype,"fieldOfView",void 0),nr([Mo({intrinsics:HF,updateHandler:dE}),ui({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],X.prototype,"minCameraOrbit",void 0),nr([Mo({intrinsics:WF,updateHandler:pE}),ui({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],X.prototype,"maxCameraOrbit",void 0),nr([Mo({intrinsics:VF,updateHandler:fE}),ui({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],X.prototype,"minFieldOfView",void 0),nr([Mo({intrinsics:rE,updateHandler:mE}),ui({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],X.prototype,"maxFieldOfView",void 0),nr([ui({type:Number,attribute:"interaction-prompt-threshold"})],X.prototype,"interactionPromptThreshold",void 0),nr([ui({type:String,attribute:"interaction-prompt"})],X.prototype,"interactionPrompt",void 0),nr([ui({type:String,attribute:"interaction-prompt-style"})],X.prototype,"interactionPromptStyle",void 0),nr([ui({type:Number,attribute:"orbit-sensitivity"})],X.prototype,"orbitSensitivity",void 0),nr([ui({type:String,attribute:"touch-action"})],X.prototype,"touchAction",void 0),nr([ui({type:Boolean,attribute:"disable-zoom"})],X.prototype,"disableZoom",void 0),nr([ui({type:Boolean,attribute:"disable-pan"})],X.prototype,"disablePan",void 0),nr([ui({type:Boolean,attribute:"disable-tap"})],X.prototype,"disableTap",void 0),nr([ui({type:Number,attribute:"interpolation-decay"})],X.prototype,"interpolationDecay",void 0),X};/* @license
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const KF=.018,gE=2,ZF=300,JF=new yi,AE=new we,_E=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),Gf=Math.PI/8,Qf=.04,Vf=10,bn={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class e4 extends ms{constructor(e,t,i){super(),this.camera=e,this.element=t,this.scene=i,this.orbitSensitivity=1,this.inputSensitivity=1,this.changeSource=bn.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new Ei,this.panPerPixel=0,this.spherical=new yf,this.goalSpherical=new yf,this.thetaDamper=new ns,this.phiDamper=new ns,this.radiusDamper=new ns,this.logFov=Math.log(_E.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new ns,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=s=>{if(this.enablePan)s.preventDefault();else for(const c of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:c.id})))},this.touchModeZoom=(s,c)=>{if(!this._disableZoom){const u=this.twoTouchDistance(this.pointers[0],this.pointers[1]),a=Qf*(this.lastSeparation-u)*50/this.scene.height;this.lastSeparation=u,this.userAdjustOrbit(0,0,a)}this.panPerPixel>0&&this.movePan(s,c)},this.disableScroll=s=>{s.preventDefault()},this.touchModeRotate=(s,c)=>{const{touchAction:u}=this._options;if(!this.touchDecided&&u!=="none"){this.touchDecided=!0;const a=Math.abs(s),m=Math.abs(c);if(this.changeSource===bn.USER_INTERACTION&&(u==="pan-y"&&m>a||u==="pan-x"&&a>m)){this.touchMode=null;return}else this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(s,c)},this.onPointerDown=s=>{if(this.pointers.length>2)return;const{element:c}=this;this.pointers.length===0&&(c.addEventListener("pointermove",this.onPointerMove),c.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=s.clientX,this.startPointerPosition.clientY=s.clientY,this.startTime=performance.now());try{c.setPointerCapture(s.pointerId)}catch{}this.pointers.push({clientX:s.clientX,clientY:s.clientY,id:s.pointerId}),this.isUserPointing=!1,s.pointerType==="touch"?(this.changeSource=s.altKey?bn.AUTOMATIC:bn.USER_INTERACTION,this.onTouchChange(s)):(this.changeSource=bn.USER_INTERACTION,this.onMouseDown(s)),this.changeSource===bn.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=s=>{const c=this.pointers.find(A=>A.id===s.pointerId);if(c==null)return;if(s.pointerType==="mouse"&&s.buttons===0){this.onPointerUp(s);return}const u=this.pointers.length,a=(s.clientX-c.clientX)/u,m=(s.clientY-c.clientY)/u;a===0&&m===0||(c.clientX=s.clientX,c.clientY=s.clientY,s.pointerType==="touch"?(this.changeSource=s.altKey?bn.AUTOMATIC:bn.USER_INTERACTION,this.touchMode!==null&&this.touchMode(a,m)):(this.changeSource=bn.USER_INTERACTION,this.panPerPixel>0?this.movePan(a,m):this.handleSinglePointerMove(a,m)))},this.onPointerUp=s=>{const{element:c}=this,u=this.pointers.findIndex(a=>a.id===s.pointerId);u!==-1&&this.pointers.splice(u,1),this.panPerPixel>0&&!s.altKey&&this.resetRadius(),this.pointers.length===0?(c.removeEventListener("pointermove",this.onPointerMove),c.removeEventListener("pointerup",this.onPointerUp),c.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(s)):this.touchMode!==null&&this.onTouchChange(s),this.scene.element[Ff].style.opacity=0,c.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=s=>{this.changeSource=bn.USER_INTERACTION;const c=s.deltaY*(s.deltaMode==1?18:1)*Qf/30;this.userAdjustOrbit(0,0,c),s.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=s=>{const{changeSource:c}=this;this.changeSource=bn.USER_INTERACTION,(s.shiftKey&&this.enablePan?this.panKeyCodeHandler(s):this.orbitZoomKeyCodeHandler(s))?(s.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=c},this._options=Object.assign({},_E),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(this._interactionEnabled===!1){const{element:e}=this;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchmove",()=>{},{passive:!1}),e.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(this._interactionEnabled===!0){const{element:e}=this;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointercancel",this.onPointerUp),e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("contextmenu",this.onContext),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(e){this._disableZoom!=e&&(this._disableZoom=e,e===!0?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(e=new yf){return e.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(e,t){this.camera.far=t===0?2:t,this.camera.near=Math.max(e,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}setOrbit(e=this.goalSpherical.theta,t=this.goalSpherical.phi,i=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:c,minimumPolarAngle:u,maximumPolarAngle:a,minimumRadius:m,maximumRadius:A}=this._options,{theta:x,phi:b,radius:I}=this.goalSpherical,E=da(e,s,c);!isFinite(s)&&!isFinite(c)&&(this.spherical.theta=this.wrapAngle(this.spherical.theta-E)+E);const T=da(t,u,a),U=da(i,m,A);return E===x&&T===b&&U===I||!isFinite(E)||!isFinite(T)||!isFinite(U)?!1:(this.goalSpherical.theta=E,this.goalSpherical.phi=T,this.goalSpherical.radius=U,this.goalSpherical.makeSafe(),!0)}setRadius(e){this.goalSpherical.radius=e,this.setOrbit()}setFieldOfView(e){const{minimumFieldOfView:t,maximumFieldOfView:i}=this._options;e=da(e,t,i),this.goalLogFov=Math.log(e)}setDamperDecayTime(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}adjustOrbit(e,t,i){const{theta:s,phi:c,radius:u}=this.goalSpherical,{minimumRadius:a,maximumRadius:m,minimumFieldOfView:A,maximumFieldOfView:x}=this._options,b=this.spherical.theta-s,I=Math.PI-.001,E=s-da(e,-I-b,I-b),T=c-t,U=i===0?0:((i>0?m:a)-u)/(Math.log(i>0?x:A)-this.goalLogFov),P=u+i*(isFinite(U)?U:(m-a)*2);if(this.setOrbit(E,T,P),i!==0){const R=this.goalLogFov+i;this.setFieldOfView(Math.exp(R))}}jumpToGoal(){this.update(0,Cw)}update(e,t){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:s}=this._options,c=this.spherical.theta-this.goalSpherical.theta;return Math.abs(c)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=Math.sign(c)*2*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:e}=this.element;if(this._interactionEnabled){const{touchAction:t}=this._options;this._disableZoom&&t!=="none"?e.touchAction="manipulation":e.touchAction=t}else e.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new yc(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(e,t,i){this.adjustOrbit(e*this.orbitSensitivity*this.inputSensitivity,t*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(e){const t=(e+Math.PI)/(2*Math.PI);return(t-Math.floor(t))*2*Math.PI-Math.PI}pixelLengthToSphericalAngle(e){return 2*Math.PI*e/this.scene.height}twoTouchDistance(e,t){const{clientX:i,clientY:s}=e,{clientX:c,clientY:u}=t,a=c-i,m=u-s;return Math.sqrt(a*a+m*m)}handleSinglePointerMove(e,t){const i=this.pixelLengthToSphericalAngle(e),s=this.pixelLengthToSphericalAngle(t);this.isUserPointing===!1&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,s,0)}initializePan(){const{theta:e,phi:t}=this.spherical,i=e-this.scene.yaw;this.panPerPixel=KF/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(t)*Math.sin(i),0,0,Math.sin(t),0,Math.sin(i),-Math.cos(t)*Math.cos(i),0)}movePan(e,t){const{scene:i}=this,s=AE.set(e,t,0).multiplyScalar(this.inputSensitivity),c=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;s.multiplyScalar(c);const u=i.getTarget();u.add(s.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(u,u),i.setTarget(u.x,u.y,u.z)}recenter(e){if(performance.now()>this.startTime+ZF||Math.abs(e.clientX-this.startPointerPosition.clientX)>gE||Math.abs(e.clientY-this.startPointerPosition.clientY)>gE)return;const{scene:t}=this,i=t.positionAndNormalFromPoint(t.getNDC(e.clientX,e.clientY));if(i==null){const{cameraTarget:s}=t.element;t.element.cameraTarget="",t.element.cameraTarget=s,this.userAdjustOrbit(0,0,1)}else t.target.worldToLocal(i.position),t.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:e}=this,t=e.positionAndNormalFromPoint(JF.set(0,0));if(t==null)return;e.target.worldToLocal(t.position);const i=e.getTarget(),{theta:s,phi:c}=this.spherical,u=s-e.yaw,a=AE.set(Math.sin(c)*Math.sin(u),Math.cos(c),Math.sin(c)*Math.cos(u)),m=a.dot(t.position.sub(i));i.add(a.multiplyScalar(m)),e.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-m)}onTouchChange(e){if(this.pointers.length===1)this.touchMode=this.touchModeRotate;else{if(this._disableZoom){this.touchMode=null,this.element.removeEventListener("touchmove",this.disableScroll);return}this.touchMode=this.touchDecided&&this.touchMode===null?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&this.touchMode!=null&&(this.initializePan(),e.altKey||(this.scene.element[Ff].style.opacity=1))}}onMouseDown(e){this.panPerPixel=0,this.enablePan&&(e.button===2||e.ctrlKey||e.metaKey||e.shiftKey)&&(this.initializePan(),this.scene.element[Ff].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(e){let t=!0;switch(e.key){case"PageUp":this.userAdjustOrbit(0,0,Qf);break;case"PageDown":this.userAdjustOrbit(0,0,-1*Qf);break;case"ArrowUp":this.userAdjustOrbit(0,-Gf,0);break;case"ArrowDown":this.userAdjustOrbit(0,Gf,0);break;case"ArrowLeft":this.userAdjustOrbit(-Gf,0,0);break;case"ArrowRight":this.userAdjustOrbit(Gf,0,0);break;default:t=!1;break}return t}panKeyCodeHandler(e){this.initializePan();let t=!0;switch(e.key){case"ArrowUp":this.movePan(0,-1*Vf);break;case"ArrowDown":this.movePan(0,Vf);break;case"ArrowLeft":this.movePan(-1*Vf,0);break;case"ArrowRight":this.movePan(Vf,0);break;default:t=!1;break}return t}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const t4=30,i4=.8,yE=1.5,n4=20,xE=1.3,r4=1/xE,s4=.25,a4=10,To={NOT_PRESENTING:"not-presenting",SESSION_STARTED:"session-started",OBJECT_PLACED:"object-placed",FAILED:"failed"},B_={TRACKING:"tracking",NOT_TRACKING:"not-tracking"},Hf=new we,o4=new pi,l4=new we,c4=new ir(45,1,.1,100);class h4 extends ms{constructor(e){super(),this.renderer=e,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new we,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new we,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new we,this.goalYaw=0,this.goalScale=1,this.xDamper=new ns,this.yDamper=new ns,this.zDamper=new ns,this.yawDamper=new ns,this.scaleDamper=new ns,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onUpdateScene=()=>{this.placementBox!=null&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new Lw(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=t=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),c=this.presentedScene,u=this.placementBox;if(s.length===1){this.inputSource=t.inputSource;const{axes:a}=this.inputSource.gamepad,m=u.getHit(this.presentedScene,a[0],a[1]);u.show=!0,m!=null?(this.isTranslating=!0,this.lastDragPosition.copy(m)):this.placeOnWall===!1&&(this.isRotating=!0,this.lastAngle=a[0]*yE)}else if(s.length===2){u.show=!0,this.isTwoFingering=!0;const{separation:a}=this.fingerPolar(s);this.firstRatio=a/c.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=e.threeRenderer,this.threeRenderer.xr.enabled=!0}resolveARSession(){return Jt(this,null,function*(){Nb();const e=yield navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),yield this.threeRenderer.xr.setSession(e),this.threeRenderer.xr.cameraAutoUpdate=!1,e})}get presentedScene(){return this._presentedScene}supportsPresentation(){return Jt(this,null,function*(){try{return Nb(),yield navigator.xr.isSessionSupported("immersive-ar")}catch(e){return console.warn("Request to present in WebXR denied:"),console.warn(e),console.warn("Falling back to next ar-mode"),!1}})}present(e,t=!1){return Jt(this,null,function*(){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise((A,x)=>{requestAnimationFrame(()=>A())});e.setHotspotsVisibility(!1),e.queueRender(),yield i,this._presentedScene=e,this.overlay=e.element.shadowRoot.querySelector("div.default"),t===!0&&(this.xrLight=new mF(this.threeRenderer),this.xrLight.addEventListener("estimationstart",()=>{if(!this.isPresenting||this.xrLight==null)return;const A=this.presentedScene;A.add(this.xrLight),A.environment=this.xrLight.environment}));const s=yield this.resolveARSession();s.addEventListener("end",()=>{this.postSessionCleanup()},{once:!0});const c=e.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");c.classList.add("enabled"),c.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=c;const u=yield s.requestReferenceSpace("viewer");this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=e.yaw,this.goalYaw=e.yaw,this.goalScale=1,e.background=null,this.oldShadowIntensity=e.shadowIntensity,e.setShadowIntensity(.01),this.oldTarget.copy(e.getTarget()),e.element.addEventListener("load",this.onUpdateScene);const a=n4*Math.PI/180,m=this.placeOnWall===!0?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(a),z:-Math.cos(a)});s.requestHitTestSource({space:u,offsetRay:m}).then(A=>{this.initialHitSource=A}),this.currentSession=s,this.placementBox=new Lw(e,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:To.SESSION_STARTED})})}stopPresenting(){return Jt(this,null,function*(){if(!this.isPresenting)return;const e=new Promise(t=>{this.resolveCleanup=t});try{yield this.currentSession.end(),yield e}catch(t){console.warn("Error while trying to end WebXR AR session"),console.warn(t),this.postSessionCleanup()}})}get isPresenting(){return this.presentedScene!=null}get target(){return this.oldTarget}updateTarget(){const e=this.presentedScene;if(e!=null){const t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}postSessionCleanup(){const e=this.currentSession;e!=null&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const t=this.presentedScene;if(this._presentedScene=null,t!=null){const{element:u}=t;this.xrLight!=null&&(t.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),t.position.set(0,0,0),t.scale.set(1,1,1),t.setShadowOffset(0);const a=this.turntableRotation;a!=null&&(t.yaw=a);const m=this.oldShadowIntensity;m!=null&&t.setShadowIntensity(m),t.setEnvironmentAndSkybox(u[Lu],u[Du]);const A=this.oldTarget;t.setTarget(A.x,A.y,A.z),t.xrCamera=null,t.element.removeEventListener("load",this.onUpdateScene),t.orientHotspots(0),u.requestUpdate("cameraTarget"),u.requestUpdate("maxCameraOrbit"),u[id](u.getBoundingClientRect()),requestAnimationFrame(()=>{t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:bn.NONE}}))})}this.renderer.height=0;const i=this.exitWebXRButtonContainer;i!=null&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;s!=null&&(s.cancel(),this.transientHitTestSource=null);const c=this.initialHitSource;c!=null&&(c.cancel(),this.initialHitSource=null),this.placementBox!=null&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,this.resolveCleanup!=null&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:To.NOT_PRESENTING})}updateView(e){const t=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(c4),t.xrCamera=i.getCamera();const{elements:s}=t.getCamera().matrixWorld;if(t.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale){const u=e.recommendedViewportScale;e.requestViewportScale(Math.max(u,s4))}const c=i.getBaseLayer();if(c!=null){const u=c instanceof XRWebGLLayer?c.getViewport(e):i.getBinding().getViewSubImage(c,e).viewport;this.threeRenderer.setViewport(u.x,u.y,u.width,u.height)}}placeInitially(){const e=this.presentedScene,{position:t,element:i}=e,s=e.getCamera(),{width:c,height:u}=this.overlay.getBoundingClientRect();e.setSize(c,u),s.projectionMatrixInverse.copy(s.projectionMatrix).invert();const{theta:a,radius:m}=i.getCameraOrbit(),A=s.getWorldDirection(Hf);e.yaw=Math.atan2(-A.x,-A.z)-a,this.goalYaw=e.yaw,t.copy(s.position).add(A.multiplyScalar(m)),this.updateTarget();const x=e.getTarget();t.add(x).sub(this.oldTarget),this.goalPosition.copy(t),e.setHotspotsVisibility(!0);const{session:b}=this.frame;b.addEventListener("selectstart",this.onSelectStart),b.addEventListener("selectend",this.onSelectEnd),b.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(I=>{this.transientHitTestSource=I})}getTouchLocation(){const{axes:e}=this.inputSource.gamepad;let t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return t!=null&&(Hf.copy(t).sub(this.presentedScene.getCamera().position),Hf.length()>a4)?null:t}getHitPoint(e){const t=this.threeRenderer.xr.getReferenceSpace(),i=e.getPose(t);if(i==null)return null;const s=o4.fromArray(i.transform.matrix);return this.placeOnWall===!0&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?l4.setFromMatrixPosition(s):null}moveToFloor(e){const t=this.initialHitSource;if(t==null)return;const i=e.getHitTestResults(t);if(i.length==0)return;const s=i[0],c=this.getHitPoint(s);c!=null&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(c):this.goalPosition.y=c.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:To.OBJECT_PLACED}))}fingerPolar(e){const t=e[0].inputSource.gamepad.axes,i=e[1].inputSource.gamepad.axes,s=i[0]-t[0],c=i[1]-t[1],u=Math.atan2(c,s);let a=this.lastAngle-u;return a>Math.PI?a-=2*Math.PI:a<-Math.PI&&(a+=2*Math.PI),this.lastAngle=u,{separation:Math.sqrt(s*s+c*c),deltaYaw:a}}processInput(e){const t=this.transientHitTestSource;if(t==null||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=e.getHitTestResultsForTransientInput(t),s=this.presentedScene,c=s.scale.x;if(this.isTwoFingering){if(i.length<2)this.isTwoFingering=!1;else{const{separation:u,deltaYaw:a}=this.fingerPolar(i);if(this.placeOnWall===!1&&(this.goalYaw+=a),s.canScale){const m=u/this.firstRatio;this.goalScale=m<xE&&m>r4?1:m}}return}else if(i.length===2){this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:u}=this.fingerPolar(i);this.firstRatio=u/c;return}if(this.isRotating){const u=this.inputSource.gamepad.axes[0]*yE;this.goalYaw+=u-this.lastAngle,this.lastAngle=u}else this.isTranslating&&i.forEach(u=>{if(u.inputSource!==this.inputSource)return;let a=null;if(u.results.length>0&&(a=this.getHitPoint(u.results[0])),a==null&&(a=this.getTouchLocation()),a!=null){if(this.goalPosition.sub(this.lastDragPosition),this.placeOnWall===!1){const m=a.y-this.lastDragPosition.y;if(m<0){this.placementBox.offsetHeight=m/c,this.presentedScene.setShadowOffset(m);const A=Hf.copy(s.getCamera().position),x=-m/(A.y-a.y);A.multiplyScalar(x),a.multiplyScalar(1-x).add(A)}}this.goalPosition.add(a),this.lastDragPosition.copy(a)}})}moveScene(e){const t=this.presentedScene,{position:i,yaw:s}=t,c=t.boundingSphere.radius,u=this.goalPosition,a=t.scale.x,m=this.placementBox;let A=bn.NONE;if(!u.equals(i)||this.goalScale!==a){A=bn.USER_INTERACTION;let{x,y:b,z:I}=i;x=this.xDamper.update(x,u.x,e,c),b=this.yDamper.update(b,u.y,e,c),I=this.zDamper.update(I,u.z,e,c),i.set(x,b,I);const E=this.scaleDamper.update(a,this.goalScale,e,1);if(t.scale.set(E,E,E),!this.isTranslating){const T=u.y-b;this.placementComplete&&this.placeOnWall===!1?(m.offsetHeight=T/E,t.setShadowOffset(T)):T===0&&(this.placementComplete=!0,m.show=!1,t.setShadowIntensity(i4))}}m.updateOpacity(e),t.updateTarget(e),t.yaw=this.yawDamper.update(s,this.goalYaw,e,Math.PI),t.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:A}}))}onWebXRFrame(e,t){this.frame=t,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),s=t.getViewerPose(i);s==null&&this.tracking===!0&&this.frames>t4&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:B_.NOT_TRACKING}));const c=this.presentedScene;if(s==null||c==null||!c.element.loaded){this.threeRenderer.clear();return}this.tracking===!1&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:B_.TRACKING}));let u=!0;for(const a of s.views){if(this.updateView(a),u){this.moveToFloor(t),this.processInput(t);const m=e-this.lastTick;this.moveScene(m),this.renderer.preRender(c,e,m),this.lastTick=e,c.renderShadow(this.threeRenderer)}this.threeRenderer.render(c,c.getCamera()),u=!1}}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class u4{constructor(e){e.threeRenderer.debug={checkShaderErrors:!0},Promise.resolve().then(()=>{self.dispatchEvent(new CustomEvent("model-viewer-renderer-debug",{detail:{renderer:e,THREE:{ShaderMaterial:Xs,Texture:vn,Mesh:oi,Scene:xs,PlaneGeometry:ka,OrthographicCamera:Bc,WebGLRenderTarget:Vs}}}))})}addScene(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-added-debug",{detail:{scene:e}}))}removeScene(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-removed-debug",{detail:{scene:e}}))}}function d4(o){const e=new Map,t=new Map,i=o.clone();return vE(o,i,function(s,c){e.set(c,s),t.set(s,c)}),i.traverse(function(s){if(!s.isSkinnedMesh)return;const c=s,u=e.get(s),a=u.skeleton.bones;c.skeleton=u.skeleton.clone(),c.bindMatrix.copy(u.bindMatrix),c.skeleton.bones=a.map(function(m){return t.get(m)}),c.bind(c.skeleton,c.bindMatrix)}),i}function vE(o,e,t){t(o,e);for(let i=0;i<o.children.length;i++)vE(o.children[i],e.children[i],t)}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const bE=Symbol("prepared"),Wf=Symbol("prepare"),ma=Symbol("preparedGLTF"),qf=Symbol("clone");class p4{constructor(e){this[ma]=e}static prepare(e){if(e.scene==null)throw new Error("Model does not have a scene");if(e[bE])return e;const t=this[Wf](e);return t[bE]=!0,t}static[Wf](e){const{scene:t}=e,i=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:i})}get parser(){return this[ma].parser}get animations(){return this[ma].animations}get scene(){return this[ma].scene}get scenes(){return this[ma].scenes}get cameras(){return this[ma].cameras}get asset(){return this[ma].asset}get userData(){return this[ma].userData}clone(){const e=this.constructor,t=this[qf]();return new e(t)}dispose(){this.scenes.forEach(e=>{e.traverse(t=>{const i=t;!i.material||((Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{for(const c in s){const u=s[c];if(u instanceof vn){const a=u.source.data;a.close!=null&&a.close(),u.dispose()}}s.dispose()}),i.geometry.dispose())})})}[qf](){const e=this[ma],t=d4(this.scene);f4(t,this.scene);const i=[t],s=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:i,userData:s})}}const f4=(o,e)=>{wE(o,e,(t,i)=>{i.userData.variantMaterials!==void 0&&(t.userData.variantMaterials=new Map(i.userData.variantMaterials)),i.userData.variantData!==void 0&&(t.userData.variantData=i.userData.variantData),i.userData.originalMaterial!==void 0&&(t.userData.originalMaterial=i.userData.originalMaterial)})},wE=(o,e,t)=>{t(o,e);for(let i=0;i<o.children.length;i++)wE(o.children[i],e.children[i],t)},EE=Symbol("threeGLTF"),SE=Symbol("gltf"),IE=Symbol("gltfElementMap"),CE=Symbol("threeObjectMap"),ME=Symbol("parallelTraverseThreeScene"),TE=Symbol("correlateOriginalThreeGLTF"),BE=Symbol("correlateCloneThreeGLTF");class Hu{constructor(e,t,i,s){this[EE]=e,this[SE]=t,this[IE]=s,this[CE]=i}static from(e,t){return t!=null?this[BE](e,t):this[TE](e)}static[TE](e){const t=e.parser.json,i=e.parser.associations,s=new Map,c={name:"Default"},u={type:"materials",index:-1};for(const a of i.keys())a instanceof qs&&i.get(a)==null&&(u.index<0&&(t.materials==null&&(t.materials=[]),u.index=t.materials.length,t.materials.push(c)),a.name=c.name,i.set(a,{materials:u.index}));for(const[a,m]of i){if(m){const A=a;A.userData=A.userData||{},A.userData.associations=m}for(const A in m)if(A!=null&&A!=="primitives"){const x=A,b=(t[x]||[])[m[x]];if(b==null)continue;let I=s.get(b);I==null&&(I=new Set,s.set(b,I)),I.add(a)}}return new Hu(e,t,i,s)}static[BE](e,t){const i=t.threeGLTF,s=t.gltf,c=JSON.parse(JSON.stringify(s)),u=new Map,a=new Map;for(let m=0;m<i.scenes.length;m++)this[ME](i.scenes[m],e.scenes[m],(A,x)=>{const b=t.threeObjectMap.get(A);if(b!=null){for(const I in b)if(I!=null&&I!=="primitives"){const E=I,T=b[E],U=c[E][T],P=u.get(x)||{};P[E]=T,u.set(x,P);const R=a.get(U)||new Set;R.add(x),a.set(U,R)}}});return new Hu(e,c,u,a)}static[ME](e,t,i){const s=(c,u)=>{if(i(c,u),c.isObject3D){const a=c,m=u;if(a.material)if(Array.isArray(a.material))for(let A=0;A<a.material.length;++A)i(a.material[A],m.material[A]);else i(a.material,m.material);for(let A=0;A<c.children.length;++A)s(c.children[A],u.children[A])}};s(e,t)}get threeGLTF(){return this[EE]}get gltf(){return this[SE]}get gltfElementMap(){return this[IE]}get threeObjectMap(){return this[CE]}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Wu=Symbol("correlatedSceneGraph");class m4 extends p4{static[Wf](e){const t=super[Wf](e);t[Wu]==null&&(t[Wu]=Hu.from(t));const{scene:i}=t,s=new As(void 0,1/0);return i.traverse(c=>{c.renderOrder=1e3,c.frustumCulled=!1,c.name||(c.name=c.uuid);const u=c;if(u.material){const{geometry:a}=u;u.castShadow=!0,u.isSkinnedMesh&&(a.boundingSphere=s,a.boundingBox=null);const m=u.material;if(m.isMeshBasicMaterial===!0&&(m.toneMapped=!1),m.shadowSide=ks,m.aoMap){const{gltf:A,threeObjectMap:x}=t[Wu],b=x.get(m);if(A.materials!=null&&b!=null&&b.materials!=null){const I=A.materials[b.materials];I.occlusionTexture&&I.occlusionTexture.texCoord===0&&a.attributes.uv!=null&&a.setAttribute("uv2",a.attributes.uv)}}}}),t}get correlatedSceneGraph(){return this[ma][Wu]}[qf](){const e=super[qf](),t=new Map;return e.scene.traverse(i=>{const s=i;if(s.material){const c=s.material;if(c!=null){if(t.has(c.uuid)){s.material=t.get(c.uuid);return}s.material=c.clone(),t.set(c.uuid,s.material)}}}),e[Wu]=Hu.from(e,this.correlatedSceneGraph),e}}class g4 extends kD{constructor(e){super(e),this.type=wr}parse(e){const t=function(b,I){switch(b){case 1:console.error("THREE.RGBELoader Read Error: "+(I||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(I||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(I||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(I||""))}return-1},i=`
`,s=function(b,I,E){I=I||1024;let T=b.pos,U=-1,P=0,R="",X=String.fromCharCode.apply(null,new Uint16Array(b.subarray(T,T+128)));for(;0>(U=X.indexOf(i))&&P<I&&T<b.byteLength;)R+=X,P+=X.length,T+=128,X+=String.fromCharCode.apply(null,new Uint16Array(b.subarray(T,T+128)));return-1<U?(E!==!1&&(b.pos+=P+U+1),R+X.slice(0,U)):!1},c=function(b){const I=/^#\?(\S+)/,E=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,T=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,U=/^\s*FORMAT=(\S+)\s*$/,P=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,R={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,G;if(b.pos>=b.byteLength||!(X=s(b)))return t(1,"no header found");if(!(G=X.match(I)))return t(3,"bad initial token");for(R.valid|=1,R.programtype=G[1],R.string+=X+`
`;X=s(b),X!==!1;){if(R.string+=X+`
`,X.charAt(0)==="#"){R.comments+=X+`
`;continue}if((G=X.match(E))&&(R.gamma=parseFloat(G[1])),(G=X.match(T))&&(R.exposure=parseFloat(G[1])),(G=X.match(U))&&(R.valid|=2,R.format=G[1]),(G=X.match(P))&&(R.valid|=4,R.height=parseInt(G[1],10),R.width=parseInt(G[2],10)),R.valid&2&&R.valid&4)break}return R.valid&2?R.valid&4?R:t(3,"missing image size specifier"):t(3,"missing format specifier")},u=function(b,I,E){const T=I;if(T<8||T>32767||b[0]!==2||b[1]!==2||b[2]&128)return new Uint8Array(b);if(T!==(b[2]<<8|b[3]))return t(3,"wrong scanline width");const U=new Uint8Array(4*I*E);if(!U.length)return t(4,"unable to allocate buffer space");let P=0,R=0;const X=4*T,G=new Uint8Array(4),J=new Uint8Array(X);let q=E;for(;q>0&&R<b.byteLength;){if(R+4>b.byteLength)return t(1);if(G[0]=b[R++],G[1]=b[R++],G[2]=b[R++],G[3]=b[R++],G[0]!=2||G[1]!=2||(G[2]<<8|G[3])!=T)return t(3,"bad rgbe scanline format");let te=0,ue;for(;te<X&&R<b.byteLength;){ue=b[R++];const K=ue>128;if(K&&(ue-=128),ue===0||te+ue>X)return t(3,"bad scanline data");if(K){const ce=b[R++];for(let Ve=0;Ve<ue;Ve++)J[te++]=ce}else J.set(b.subarray(R,R+ue),te),te+=ue,R+=ue}const _e=T;for(let K=0;K<_e;K++){let ce=0;U[P]=J[K+ce],ce+=T,U[P+1]=J[K+ce],ce+=T,U[P+2]=J[K+ce],ce+=T,U[P+3]=J[K+ce],P+=4}q--}return U},a=function(b,I,E,T){const U=b[I+3],P=Math.pow(2,U-128)/255;E[T+0]=b[I+0]*P,E[T+1]=b[I+1]*P,E[T+2]=b[I+2]*P,E[T+3]=1},m=function(b,I,E,T){const U=b[I+3],P=Math.pow(2,U-128)/255;E[T+0]=Kp.toHalfFloat(Math.min(b[I+0]*P,65504)),E[T+1]=Kp.toHalfFloat(Math.min(b[I+1]*P,65504)),E[T+2]=Kp.toHalfFloat(Math.min(b[I+2]*P,65504)),E[T+3]=Kp.toHalfFloat(1)},A=new Uint8Array(e);A.pos=0;const x=c(A);if(x!==-1){const b=x.width,I=x.height,E=u(A.subarray(A.pos),b,I);if(E!==-1){let T,U,P;switch(this.type){case br:P=E.length/4;const R=new Float32Array(P*4);for(let G=0;G<P;G++)a(E,G*4,R,G*4);T=R,U=br;break;case wr:P=E.length/4;const X=new Uint16Array(P*4);for(let G=0;G<P;G++)m(E,G*4,X,G*4);T=X,U=wr;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:b,height:I,data:T,header:x.string,gamma:x.gamma,exposure:x.exposure,type:U}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,s){function c(u,a){switch(u.type){case br:case wr:u.colorSpace=Qr,u.minFilter=dn,u.magFilter=dn,u.generateMipmaps=!1,u.flipY=!0;break}t&&t(u,a)}return super.load(e,c,i,s)}}/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class A4 extends xs{constructor(){super(),this.position.y=-3.5;const e=new Ao;e.deleteAttribute("uv");const t=new ha({metalness:0,side:Gn}),i=new ha({metalness:0}),s=new RA(16777215,500,28,2);s.position.set(.418,16.199,.3),this.add(s);const c=new oi(e,t);c.position.set(-.757,13.219,.717),c.scale.set(31.713,28.305,28.591),this.add(c);const u=new oi(e,i);u.position.set(-10.906,2.009,1.846),u.rotation.set(0,-.195,0),u.scale.set(2.328,7.905,4.651),this.add(u);const a=new oi(e,i);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);const m=new oi(e,i);m.position.set(6.167,.857,7.803),m.rotation.set(0,.561,0),m.scale.set(3.927,6.285,3.687),this.add(m);const A=new oi(e,i);A.position.set(-2.017,.018,6.124),A.rotation.set(0,.333,0),A.scale.set(2.002,4.566,2.064),this.add(A);const x=new oi(e,i);x.position.set(2.291,-.756,-2.621),x.rotation.set(0,-.286,0),x.scale.set(1.546,1.552,1.496),this.add(x);const b=new oi(e,i);b.position.set(-2.193,-.369,-5.547),b.rotation.set(0,.516,0),b.scale.set(3.875,3.487,2.986),this.add(b);const I=new oi(e,this.createAreaLightMaterial(50));I.position.set(-16.116,14.37,8.208),I.scale.set(.1,2.428,2.739),this.add(I);const E=new oi(e,this.createAreaLightMaterial(50));E.position.set(-16.109,18.021,-8.207),E.scale.set(.1,2.425,2.751),this.add(E);const T=new oi(e,this.createAreaLightMaterial(17));T.position.set(14.904,12.198,-1.832),T.scale.set(.15,4.265,6.331),this.add(T);const U=new oi(e,this.createAreaLightMaterial(43));U.position.set(-.462,8.89,14.52),U.scale.set(4.38,5.441,.088),this.add(U);const P=new oi(e,this.createAreaLightMaterial(20));P.position.set(3.235,11.486,-12.541),P.scale.set(2.5,2,.1),this.add(P);const R=new oi(e,this.createAreaLightMaterial(100));R.position.set(0,20,0),R.scale.set(1,.1,1),this.add(R)}createAreaLightMaterial(e){const t=new js;return t.color.setScalar(e),t}}/* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class _4 extends xs{constructor(){super(),this.position.y=-3.5;const e=new Ao;e.deleteAttribute("uv");const t=new ha({metalness:0,side:Gn}),i=new ha({metalness:0}),s=new RA(16777215,400,28,2);s.position.set(.5,14,.5),this.add(s);const c=new oi(e,t);c.position.set(0,13.2,0),c.scale.set(31.5,28.5,31.5),this.add(c);const u=new oi(e,i);u.position.set(-10.906,-1,1.846),u.rotation.set(0,-.195,0),u.scale.set(2.328,7.905,4.651),this.add(u);const a=new oi(e,i);a.position.set(-5.607,-.754,-.758),a.rotation.set(0,.994,0),a.scale.set(1.97,1.534,3.955),this.add(a);const m=new oi(e,i);m.position.set(6.167,-.16,7.803),m.rotation.set(0,.561,0),m.scale.set(3.927,6.285,3.687),this.add(m);const A=new oi(e,i);A.position.set(-2.017,.018,6.124),A.rotation.set(0,.333,0),A.scale.set(2.002,4.566,2.064),this.add(A);const x=new oi(e,i);x.position.set(2.291,-.756,-2.621),x.rotation.set(0,-.286,0),x.scale.set(1.546,1.552,1.496),this.add(x);const b=new oi(e,i);b.position.set(-2.193,-.369,-5.547),b.rotation.set(0,.516,0),b.scale.set(3.875,3.487,2.986),this.add(b);const I=new oi(e,this.createAreaLightMaterial(80));I.position.set(-14,10,8),I.scale.set(.1,2.5,2.5),this.add(I);const E=new oi(e,this.createAreaLightMaterial(80));E.position.set(-14,14,-4),E.scale.set(.1,2.5,2.5),this.add(E);const T=new oi(e,this.createAreaLightMaterial(23));T.position.set(14,12,0),T.scale.set(.1,5,5),this.add(T);const U=new oi(e,this.createAreaLightMaterial(16));U.position.set(0,9,14),U.scale.set(5,5,.1),this.add(U);const P=new oi(e,this.createAreaLightMaterial(80));P.position.set(7,8,-14),P.scale.set(2.5,2.5,.1),this.add(P);const R=new oi(e,this.createAreaLightMaterial(80));R.position.set(-7,16,-14),R.scale.set(2.5,2.5,.1),this.add(R);const X=new oi(e,this.createAreaLightMaterial(1));X.position.set(0,20,0),X.scale.set(.1,.1,.1),this.add(X)}createAreaLightMaterial(e){const t=new js;return t.color.setScalar(e),t}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const y4=.04,Jc=20,x4=/\.hdr(\.js)?$/;class RE extends ms{constructor(e){super(),this.threeRenderer=e,this.lottieLoaderUrl="",this.withCredentials=!1,this._ldrLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}get ldrLoader(){return this._ldrLoader==null&&(this._ldrLoader=new ab),this._ldrLoader.setWithCredentials(this.withCredentials),this._ldrLoader}get hdrLoader(){return this._hdrLoader==null&&(this._hdrLoader=new g4,this._hdrLoader.setDataType(wr)),this._hdrLoader.setWithCredentials(this.withCredentials),this._hdrLoader}getLottieLoader(){return Jt(this,null,function*(){})}loadImage(e){return Jt(this,null,function*(){const t=yield new Promise((i,s)=>this.ldrLoader.load(e,i,()=>{},s));return t.name=e,t.flipY=!1,t})}loadLottie(e,t){return Jt(this,null,function*(){const i=yield this.getLottieLoader();i.setQuality(t);const s=yield new Promise((c,u)=>i.load(e,c,()=>{},u));return s.name=e,s})}loadEquirect(e,t=()=>{}){return Jt(this,null,function*(){try{const i=x4.test(e),s=i?this.hdrLoader:this.ldrLoader,c=yield new Promise((u,a)=>s.load(e,u,m=>{t(m.loaded/m.total*.9)},a));return t(1),c.name=e,c.mapping=Pp,i||(c.encoding=zs),c}finally{t&&t(1)}})}generateEnvironmentMapAndSkybox(e=null,t=null,i=()=>{}){return Jt(this,null,function*(){const s=t!=="legacy";(t==="legacy"||t==="neutral")&&(t=null),t=kb(t);let c=Promise.resolve(null),u;e&&(c=this.loadEquirectFromUrl(e,i)),t?u=this.loadEquirectFromUrl(t,i):e?u=this.loadEquirectFromUrl(e,i):u=s?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[a,m]=yield Promise.all([u,c]);if(a==null)throw new Error("Failed to load environment map.");return{environmentMap:a,skybox:m}})}loadEquirectFromUrl(e,t){return Jt(this,null,function*(){if(!this.skyboxCache.has(e)){const i=this.loadEquirect(e,t);this.skyboxCache.set(e,i)}return this.skyboxCache.get(e)})}GenerateEnvironmentMap(e,t){return Jt(this,null,function*(){yield kP();const i=this.threeRenderer,s=new uA(256,{generateMipmaps:!1,type:wr,format:Rn,colorSpace:Qr,depthBuffer:!0}),c=new hA(.1,100,s),u=c.renderTarget.texture;u.name=t;const a=i.outputColorSpace,m=i.toneMapping;return i.toneMapping=Ns,i.outputColorSpace=Qr,c.update(i,e),this.blurCubemap(s,y4),i.toneMapping=m,i.outputColorSpace=a,u})}loadGeneratedEnvironmentMap(){return Jt(this,null,function*(){return this.generatedEnvironmentMap==null&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new A4,"legacy")),this.generatedEnvironmentMap})}loadGeneratedEnvironmentMapAlt(){return Jt(this,null,function*(){return this.generatedEnvironmentMapAlt==null&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new _4,"neutral")),this.generatedEnvironmentMapAlt})}blurCubemap(e,t){if(this.blurMaterial==null){this.blurMaterial=this.getBlurShader(Jc);const s=new Ao,c=new oi(s,this.blurMaterial);this.blurScene=new xs,this.blurScene.add(c)}const i=e.clone();this.halfblur(e,i,t,"latitudinal"),this.halfblur(i,e,t,"longitudinal")}halfblur(e,t,i,s){const c=e.width,u=isFinite(i)?Math.PI/(2*c):2*Math.PI/(2*Jc-1),a=i/u,m=isFinite(i)?1+Math.floor(3*a):Jc;m>Jc&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Jc}`);const A=[];let x=0;for(let I=0;I<Jc;++I){const E=I/a,T=Math.exp(-E*E/2);A.push(T),I==0?x+=T:I<m&&(x+=2*T)}for(let I=0;I<A.length;I++)A[I]=A[I]/x;const b=this.blurMaterial.uniforms;b.envMap.value=e.texture,b.samples.value=m,b.weights.value=A,b.latitudinal.value=s==="latitudinal",b.dTheta.value=u,new hA(.1,100,t).update(this.threeRenderer,this.blurScene)}getBlurShader(e){const t=new Float32Array(e),i=new we(0,1,0);return new Xs({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:i}},vertexShader:`
      
      varying vec3 vOutputDirection;
  
      void main() {
  
        vOutputDirection = vec3( position );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  
      }
    `,fragmentShader:`
        varying vec3 vOutputDirection;
  
        uniform samplerCube envMap;
        uniform int samples;
        uniform float weights[ n ];
        uniform bool latitudinal;
        uniform float dTheta;
        uniform vec3 poleAxis;
  
        vec3 getSample( float theta, vec3 axis ) {
  
          float cosTheta = cos( theta );
          // Rodrigues' axis-angle rotation
          vec3 sampleDirection = vOutputDirection * cosTheta
            + cross( axis, vOutputDirection ) * sin( theta )
            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );
  
          return vec3( textureCube( envMap, sampleDirection ) );
  
        }
  
        void main() {
  
          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );
  
          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {
  
            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );
  
          }
  
          axis = normalize( axis );
  
          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );
  
          for ( int i = 1; i < n; i++ ) {
  
            if ( i >= samples ) {
  
              break;
  
            }
  
            float theta = dTheta * float( i );
            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );
  
          }
        }
      `,blending:Ma,depthTest:!1,depthWrite:!1,side:Gn})}dispose(){return Jt(this,null,function*(){for(const[,e]of this.skyboxCache)(yield e).dispose();this.generatedEnvironmentMap!=null&&((yield this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),this.generatedEnvironmentMapAlt!=null&&((yield this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),this.blurMaterial!=null&&this.blurMaterial.dispose()})}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const v4=.2,R_=40,L_=60,LE=5,eh=[1,.79,.62,.5,.4,.31,.25],b4=3,DE="high-performance";class bs extends ms{constructor(e){super(),this.loader=new Wn(m4),this.width=0,this.height=0,this.dpr=1,this.debugger=null,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=b4,this.avgFrameDuration=(L_+R_)/2,this.onWebGLContextLost=t=>{this.dispatchEvent({type:"contextlost",sourceEvent:t})},this.onWebGLContextRestored=()=>{var t;(t=this.textureUtils)===null||t===void 0||t.dispose(),this.textureUtils=new RE(this.threeRenderer);for(const i of this.scenes)i.element[If]()},this.dpr=XA(),this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new P1({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.outputColorSpace=ni,this.threeRenderer.useLegacyLights=!1,this.threeRenderer.setPixelRatio(1),this.debugger=e.debug?new u4(this):null,this.threeRenderer.debug={checkShaderErrors:!!this.debugger},this.threeRenderer.toneMapping=Ns}catch(t){console.warn(t)}this.arRenderer=new h4(this),this.textureUtils=this.canRender?new RE(this.threeRenderer):null,Wn.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}static get singleton(){return this._singleton}static resetSingleton(){const e=this._singleton.dispose();for(const t of e)t.disconnectedCallback();this._singleton=new bs({powerPreference:(self.ModelViewerElement||{}).powerPreference||DE,debug:zb()});for(const t of e)t.connectedCallback()}get canRender(){return this.threeRenderer!=null}get scaleFactor(){return eh[this.scaleStep]}set minScale(e){let t=1;for(;t<eh.length&&!(eh[t]<e);)++t;this.lastStep=t-1}registerScene(e){this.scenes.add(e),e.forceRescale();const t=new yi;this.threeRenderer.getSize(t),e.canvas.width=t.x,e.canvas.height=t.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop((i,s)=>this.render(i,s)),this.debugger!=null&&this.debugger.addScene(e)}unregisterScene(e){this.scenes.delete(e),this.canvas3D.parentElement===e.canvas.parentElement&&e.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&this.scenes.size===0&&this.threeRenderer.setAnimationLoop(null),this.debugger!=null&&this.debugger.removeScene(e)}displayCanvas(e){return this.multipleScenesVisible?e.element[s0]:this.canvas3D}countVisibleScenes(){const{canvas3D:e}=this;let t=0,i=null;for(const c of this.scenes){const{element:u}=c;u.modelIsVisible&&c.externalRenderer==null&&++t,e.parentElement===c.canvas.parentElement&&(i=c)}const s=t>1;if(i!=null){const c=s&&!this.multipleScenesVisible,u=!i.element.modelIsVisible;if(c||u){const{width:a,height:m}=this.sceneSize(i);this.copyPixels(i,a,m),e.parentElement.removeChild(e)}}this.multipleScenesVisible=s}updateRendererSize(){var e;const t=XA();if(t!==this.dpr)for(const c of this.scenes){const{element:u}=c;u[sh](u.getBoundingClientRect())}let i=0,s=0;for(const c of this.scenes)i=Math.max(i,c.width),s=Math.max(s,c.height);if(!(i===this.width&&s===this.height&&t===this.dpr)){this.width=i,this.height=s,this.dpr=t,i=Math.ceil(i*t),s=Math.ceil(s*t),this.canRender&&this.threeRenderer.setSize(i,s,!1);for(const c of this.scenes){const{canvas:u}=c;u.width=i,u.height=s,c.forceRescale(),(e=c.effectRenderer)===null||e===void 0||e.setSize(i,s)}}}updateRendererScale(e){const t=this.scaleStep;this.avgFrameDuration+=da(v4*(e-this.avgFrameDuration),-LE,LE),this.avgFrameDuration>L_?++this.scaleStep:this.avgFrameDuration<R_&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),t!==this.scaleStep&&(this.avgFrameDuration=(L_+R_)/2)}shouldRender(e){if(e.shouldRender())e.scaleStep!=this.scaleStep&&(e.scaleStep=this.scaleStep,this.rescaleCanvas(e));else if(e.scaleStep!=0)e.scaleStep=0,this.rescaleCanvas(e);else return!1;return!0}rescaleCanvas(e){const t=eh[e.scaleStep],i=Math.ceil(this.width/t),s=Math.ceil(this.height/t),{style:c}=e.canvas;c.width=`${i}px`,c.height=`${s}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${s}px`;const u=this.dpr*t,a=t<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";e.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:u,minimumDpr:this.dpr*eh[this.lastStep],pixelWidth:Math.ceil(e.width*u),pixelHeight:Math.ceil(e.height*u),reason:a}}))}sceneSize(e){const{dpr:t}=this,i=eh[e.scaleStep],s=Math.min(Math.ceil(e.width*i*t),this.canvas3D.width),c=Math.min(Math.ceil(e.height*i*t),this.canvas3D.height);return{width:s,height:c}}copyPixels(e,t,i){const s=e.context;if(s==null){console.log("could not acquire 2d context");return}s.clearRect(0,0,t,i),s.drawImage(this.canvas3D,0,0,t,i,0,0,t,i),e.canvas.classList.add("show")}orderedScenes(){const e=[];for(const t of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===t&&e.push(i);return e}get isPresenting(){return this.arRenderer.isPresenting}preRender(e,t,i){const{element:s,exposure:c}=e;s[Aa](t,i);const u=typeof c=="number"&&!Number.isNaN(c);this.threeRenderer.toneMappingExposure=u?c:1}render(e,t){if(t!=null){this.arRenderer.onWebXRFrame(e,t);return}const i=e-this.lastTick;if(this.lastTick=e,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:s}=this;for(const c of this.orderedScenes()){const{element:u}=c;if(!u.loaded||!u.modelIsVisible&&c.renderCount>0||(this.preRender(c,e,i),!this.shouldRender(c)))continue;if(c.externalRenderer!=null){const A=c.getCamera();A.updateMatrix();const{matrix:x,projectionMatrix:b}=A,I=x.elements.slice(),E=c.getTarget();I[12]+=E.x,I[13]+=E.y,I[14]+=E.z,c.externalRenderer.render({viewMatrix:I,projectionMatrix:b.elements});continue}if(!u.modelIsVisible&&!this.multipleScenesVisible)for(const A of this.scenes)A.element.modelIsVisible&&A.queueRender();const{width:a,height:m}=this.sceneSize(c);c.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-m,a,m),c.effectRenderer!=null?c.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.render(c,c.camera)),this.multipleScenesVisible||!c.element.modelIsVisible&&c.renderCount===0?this.copyPixels(c,a,m):s.parentElement!==c.canvas.parentElement&&(c.canvas.parentElement.appendChild(s),c.canvas.classList.remove("show")),c.hasRendered(),++c.renderCount,this.renderedLastFrame=!0}}dispose(){this.textureUtils!=null&&this.textureUtils.dispose(),this.threeRenderer!=null&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const e=[];for(const t of this.scenes)e.push(t.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),e}}bs._singleton=new bs({powerPreference:(self.ModelViewerElement||{}).powerPreference||DE,debug:zb()});/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const wn=Symbol("correlatedObjects"),qi=Symbol("sourceObject"),Ks=Symbol("onUpdate");class qu{constructor(e,t,i=null){this[Ks]=e,this[qi]=t,this[wn]=i}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const PE=new js,w4=new ka(2,2);let E4=0;const Bo=Symbol("threeTexture");class S4 extends qu{get[Bo](){var e;return console.assert(this[wn]!=null&&this[wn].size>0,"Image correlated object is undefined"),(e=this[wn])===null||e===void 0?void 0:e.values().next().value}constructor(e,t,i){i=i??{name:t&&t.image&&t.image.src?t.image.src.split("/").pop():"adhoc_image",uri:t&&t.image&&t.image.src?t.image.src:"adhoc_image"+E4++},super(e,i,new Set(t?[t]:[]))}get name(){return this[qi].name||""}get uri(){return this[qi].uri}get bufferView(){return this[qi].bufferView}get element(){const e=this[Bo];if(e&&(e.isCanvasTexture||e.isVideoTexture))return e.image}get animation(){const e=this[Bo];if(e&&e.isCanvasTexture&&e.animation)return e.animation}get type(){return this.uri!=null?"external":"embedded"}set name(e){this[qi].name=e}update(){const e=this[Bo];e&&e.isCanvasTexture&&!e.animation&&(this[Bo].needsUpdate=!0,this[Ks]())}createThumbnail(e,t){return Jt(this,null,function*(){const i=new xs;PE.map=this[Bo];const s=new oi(w4,PE);i.add(s);const c=new Bc(-1,1,1,-1,0,1),{threeRenderer:u}=bs.singleton,a=new Vs(e,t);u.setRenderTarget(a),u.render(i,c),u.setRenderTarget(null);const m=new Uint8Array(e*t*4);u.readRenderTargetPixels(a,0,0,e,t,m),Lo.width=e,Lo.height=t;const A=Lo.getContext("2d"),x=A.createImageData(e,t);return x.data.set(m),A.putImageData(x,0,0),new Promise((b,I)=>Jt(this,null,function*(){Lo.toBlob(E=>{if(!E)return I("Failed to capture thumbnail.");b(URL.createObjectURL(E))},"image/png")}))})}}var ws;(function(o){o[o.Nearest=9728]="Nearest",o[o.Linear=9729]="Linear",o[o.NearestMipmapNearest=9984]="NearestMipmapNearest",o[o.LinearMipmapNearest=9985]="LinearMipmapNearest",o[o.NearestMipmapLinear=9986]="NearestMipmapLinear",o[o.LinearMipmapLinear=9987]="LinearMipmapLinear"})(ws||(ws={}));var bl;(function(o){o[o.ClampToEdge=33071]="ClampToEdge",o[o.MirroredRepeat=33648]="MirroredRepeat",o[o.Repeat=10497]="Repeat"})(bl||(bl={}));/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const I4=(()=>{const o=[ws.Nearest,ws.Linear,ws.NearestMipmapNearest,ws.LinearMipmapLinear,ws.NearestMipmapLinear,ws.LinearMipmapLinear];return e=>o.indexOf(e)>-1})(),C4=(()=>{const o=[ws.Nearest,ws.Linear];return e=>o.indexOf(e)>-1})(),M4=(()=>{const o=[bl.ClampToEdge,bl.MirroredRepeat,bl.Repeat];return e=>o.indexOf(e)>-1})(),T4=(o,e)=>{switch(o){case"minFilter":return I4(e);case"magFilter":return C4(e);case"wrapS":case"wrapT":return M4(e);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${o}" on Sampler`)}},$f=Symbol("threeTexture"),UE=Symbol("threeTextures"),Ro=Symbol("setProperty"),th=Symbol("sourceSampler");class B4 extends qu{get[$f](){var e;return console.assert(this[wn]!=null&&this[wn].size>0,"Sampler correlated object is undefined"),(e=this[wn])===null||e===void 0?void 0:e.values().next().value}get[UE](){return console.assert(this[wn]!=null&&this[wn].size>0,"Sampler correlated object is undefined"),this[wn]}get[th](){return console.assert(this[qi]!=null,"Sampler source is undefined"),this[qi]}constructor(e,t,i){i=i??{},i.minFilter==null&&(i.minFilter=t?t.minFilter:ws.LinearMipmapLinear),i.magFilter==null&&(i.magFilter=t?t.magFilter:ws.Linear),i.wrapS==null&&(i.wrapS=t?t.wrapS:bl.Repeat),i.wrapT==null&&(i.wrapT=t?t.wrapT:bl.Repeat),super(e,i,new Set(t?[t]:[]))}get name(){return this[qi].name||""}get minFilter(){return this[th].minFilter}get magFilter(){return this[th].magFilter}get wrapS(){return this[th].wrapS}get wrapT(){return this[th].wrapT}get rotation(){return this[$f].rotation}get scale(){return this[$f].repeat}get offset(){return this[$f].offset}setMinFilter(e){this[Ro]("minFilter",e)}setMagFilter(e){this[Ro]("magFilter",e)}setWrapS(e){this[Ro]("wrapS",e)}setWrapT(e){this[Ro]("wrapT",e)}setRotation(e){e==null&&(e=0),this[Ro]("rotation",e)}setScale(e){e==null&&(e=new yi(1,1)),this[Ro]("repeat",e)}setOffset(e){e==null&&(e=new yi(0,0)),this[Ro]("offset",e)}[Ro](e,t){const i=this[th];if(i!=null){if(T4(e,t)){e!=="rotation"&&e!=="repeat"&&e!=="offset"&&(i[e]=t);for(const s of this[UE])s[e]=t,s.needsUpdate=!0}this[Ks]()}}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const FE=Symbol("image"),kE=Symbol("sampler");class NE extends qu{constructor(e,t,i=null,s=null,c=null){super(e,i||{},new Set(t?[t]:[])),this[kE]=new B4(e,t,s),this[FE]=new S4(e,t,c)}get name(){return this[qi].name||""}set name(e){this[qi].name=e}get sampler(){return this[kE]}get source(){return this[FE]}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var OE,zE,GE;const wl=Symbol("texture"),El=Symbol("transform"),D_=Symbol("materials"),QE=Symbol("usage"),ih=Symbol("onUpdate"),$u=Symbol("activeVideo");var Es;(function(o){o[o.Base=0]="Base",o[o.MetallicRoughness=1]="MetallicRoughness",o[o.Normal=2]="Normal",o[o.Occlusion=3]="Occlusion",o[o.Emissive=4]="Emissive"})(Es||(Es={}));class ju{constructor(e,t,i,s,c,u){if(this[OE]=null,this[zE]={rotation:0,scale:new yi(1,1),offset:new yi(0,0)},this[GE]=!1,u&&i){const a=c.textures?c.textures[u.index]:null,m=a&&c.samplers?c.samplers[a.sampler]:null,A=a&&c.images?c.images[a.source]:null;this[El].rotation=i.rotation,this[El].scale.copy(i.repeat),this[El].offset.copy(i.offset),this[wl]=new NE(e,i,a,m,A)}this[ih]=e,this[D_]=s,this[QE]=t}get texture(){return this[wl]}setTexture(e){var t,i;const s=e!=null?e.source[Bo]:null,c=(t=this[wl])===null||t===void 0?void 0:t.source[Bo];if(c!=null&&c.isVideoTexture?this[$u]=!1:!((i=this[wl])===null||i===void 0)&&i.source.animation&&this[wl].source.animation.removeEventListener("enterFrame",this[ih]),this[wl]=e,s!=null&&s.isVideoTexture){const a=s.image;if(this[$u]=!0,a.requestVideoFrameCallback!=null){const m=()=>{!this[$u]||(this[ih](),a.requestVideoFrameCallback(m))};a.requestVideoFrameCallback(m)}else{const m=()=>{!this[$u]||(this[ih](),requestAnimationFrame(m))};requestAnimationFrame(m)}}else e?.source.animation!=null&&e.source.animation.addEventListener("enterFrame",this[ih]);let u=zs;if(this[D_])for(const a of this[D_]){switch(this[QE]){case Es.Base:a.map=s;break;case Es.MetallicRoughness:u=hu,a.metalnessMap=s,a.roughnessMap=s;break;case Es.Normal:u=hu,a.normalMap=s;break;case Es.Occlusion:u=hu,a.aoMap=s;break;case Es.Emissive:a.emissiveMap=s;break}a.needsUpdate=!0}s&&(s.encoding=u,s.rotation=this[El].rotation,s.repeat=this[El].scale,s.offset=this[El].offset),this[ih]()}}OE=wl,zE=El,GE=$u;/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const jf=Symbol("threeMaterials"),VE=Symbol("baseColorTexture"),HE=Symbol("metallicRoughnessTexture");class R4 extends qu{constructor(e,t,i,s){super(e,i,s),i.baseColorFactor==null&&(i.baseColorFactor=[1,1,1,1]),i.roughnessFactor==null&&(i.roughnessFactor=1),i.metallicFactor==null&&(i.metallicFactor=1);const{baseColorTexture:c,metallicRoughnessTexture:u}=i,{map:a,metalnessMap:m}=s.values().next().value;this[VE]=new ju(e,Es.Base,a,s,t,c||null),this[HE]=new ju(e,Es.MetallicRoughness,m,s,t,u||null)}get[jf](){return this[wn]}get baseColorFactor(){return this[qi].baseColorFactor}get metallicFactor(){return this[qi].metallicFactor}get roughnessFactor(){return this[qi].roughnessFactor}get baseColorTexture(){return this[VE]}get metallicRoughnessTexture(){return this[HE]}setBaseColorFactor(e){const t=new hi;e instanceof Array?t.fromArray(e):t.set(e);for(const s of this[jf])s.color.set(t),e instanceof Array?s.opacity=e[3]:(e=[0,0,0,s.opacity],t.toArray(e));const i=this[qi];i.baseColorFactor=e,this[Ks]()}setMetallicFactor(e){for(const i of this[jf])i.metalness=e;const t=this[qi];t.metallicFactor=e,this[Ks]()}setRoughnessFactor(e){for(const i of this[jf])i.roughness=e;const t=this[qi];t.roughnessFactor=e,this[Ks]()}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var WE;const qE=Symbol("pbrMetallicRoughness"),$E=Symbol("normalTexture"),jE=Symbol("occlusionTexture"),XE=Symbol("emissiveTexture"),L4=Symbol("backingThreeMaterial"),P_=Symbol("applyAlphaCutoff"),Sl=Symbol("lazyLoadGLTFInfo"),U_=Symbol("initialize"),F_=Symbol("getLoadedMaterial"),Vr=Symbol("ensureMaterialIsLoaded"),YE=Symbol("gltfIndex"),Xu=Symbol("setActive"),Xf=Symbol("variantIndices"),k_=Symbol("isActive"),Yf=Symbol("variantSet"),KE=Symbol("modelVariants");class N_ extends qu{constructor(e,t,i,s,c,u,a,m=void 0){super(e,i,a),this[WE]=new Set,this[YE]=s,this[k_]=c,this[KE]=u,m==null?this[U_](t):this[Sl]=m}get[(WE=Yf,L4)](){return this[wn].values().next().value}[U_](e){const t=this[Ks],i=this[qi],s=this[wn];i.extensions&&i.extensions.KHR_materials_pbrSpecularGlossiness&&console.warn(`Material ${i.name} uses a deprecated extension
          "KHR_materials_pbrSpecularGlossiness", please use
          "pbrMetallicRoughness" instead. Specular Glossiness materials are
          no longer supported; to convert to metal-rough, see 
          https://www.donmccurdy.com/2022/11/28/converting-gltf-pbr-materials-from-specgloss-to-metalrough/.`),i.pbrMetallicRoughness==null&&(i.pbrMetallicRoughness={}),this[qE]=new R4(t,e,i.pbrMetallicRoughness,s),i.emissiveFactor==null&&(i.emissiveFactor=[0,0,0]),i.doubleSided==null&&(i.doubleSided=!1),i.alphaMode==null&&(i.alphaMode="OPAQUE"),i.alphaCutoff==null&&(i.alphaCutoff=.5);const{normalTexture:c,occlusionTexture:u,emissiveTexture:a}=i,{normalMap:m,aoMap:A,emissiveMap:x}=s.values().next().value;this[$E]=new ju(t,Es.Normal,m,s,e,c||null),this[jE]=new ju(t,Es.Occlusion,A,s,e,u||null),this[XE]=new ju(t,Es.Emissive,x,s,e,a||null)}[F_](){return Jt(this,null,function*(){if(this[Sl]!=null){const{set:e,material:t}=yield this[Sl].doLazyLoad();return this[wn]=e,this[U_](this[Sl].gltf),this[Sl]=void 0,this.ensureLoaded=()=>Jt(this,null,function*(){}),t}return this[wn].values().next().value})}[Vr](){if(this[Sl]!=null)throw new Error(`Material "${this.name}" has not been loaded, call 'await
    myMaterial.ensureLoaded()' before using an unloaded material.`)}ensureLoaded(){return Jt(this,null,function*(){yield this[F_]()})}get isLoaded(){return this[Sl]==null}get isActive(){return this[k_]}[Xu](e){this[k_]=e}get name(){return this[qi].name}set name(e){const t=this[qi];if(t!=null&&(t.name=e),this[wn]!=null)for(const i of this[wn])i.name=e}get pbrMetallicRoughness(){return this[Vr](),this[qE]}get normalTexture(){return this[Vr](),this[$E]}get occlusionTexture(){return this[Vr](),this[jE]}get emissiveTexture(){return this[Vr](),this[XE]}get emissiveFactor(){return this[Vr](),this[qi].emissiveFactor}get index(){return this[YE]}[Xf](){return this[Yf]}hasVariant(e){const t=this[KE].get(e);return t!=null&&this[Yf].has(t.index)}setEmissiveFactor(e){this[Vr]();const t=new hi;e instanceof Array?t.fromArray(e):t.set(e);for(const i of this[wn])i.emissive.set(t);this[qi].emissiveFactor=t.toArray(),this[Ks]()}[P_](){this[Vr]();const e=this[qi];for(const t of this[wn])this[qi].alphaMode==="MASK"?t.alphaTest=e.alphaCutoff:t.alphaTest=void 0,t.needsUpdate=!0}setAlphaCutoff(e){this[Vr](),this[qi].alphaCutoff=e,this[P_](),this[Ks]()}getAlphaCutoff(){return this[Vr](),this[qi].alphaCutoff}setDoubleSided(e){this[Vr]();for(const t of this[wn])t.side=e?er:ks,t.needsUpdate=!0;this[qi].doubleSided=e,this[Ks]()}getDoubleSided(){return this[Vr](),this[qi].doubleSided}setAlphaMode(e){this[Vr]();const t=(i,s)=>{i.transparent=s,i.depthWrite=!s};this[qi].alphaMode=e;for(const i of this[wn])t(i,e==="BLEND"),this[P_](),i.needsUpdate=!0;this[Ks]()}getAlphaMode(){return this[Vr](),this[qi].alphaMode}}class ZE{constructor(e){this.name="",this.children=[],this.name=e}}class O_ extends ZE{constructor(e,t,i,s){super(e.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=e;const{gltf:c,threeGLTF:u,threeObjectMap:a}=s;this.modelVariants=i,this.mesh.userData.variantData=i;const m=a.get(e.material);m.materials!=null?this.initialMaterialIdx=this.activeMaterialIdx=m.materials:console.error(`Primitive (${e.name}) missing initial material reference.`);const A=e.userData.associations||{};if(A.meshes==null){console.error("Mesh is missing primitive index association");return}const x=((c.meshes||[])[A.meshes].primitives||[])[A.primitives];if(x==null){console.error("Mesh primitive definition is missing.");return}if(x.material!=null)this.materials.set(x.material,t[x.material]);else{const b=t.findIndex(I=>I.name==="Default");b>=0?this.materials.set(b,t[b]):console.warn("gltfPrimitive has no material!")}if(x.extensions&&x.extensions.KHR_materials_variants){const b=x.extensions.KHR_materials_variants,I=u.parser.json.extensions.KHR_materials_variants.variants;for(const E of b.mappings){const T=t[E.material];this.materials.set(E.material,T);for(const U of E.variants){const{name:P}=I[U];this.variantToMaterialMap.set(U,T),T[Xf]().add(U),i.has(P)||i.set(P,{name:P,index:U})}}}}setActiveMaterial(e){return Jt(this,null,function*(){const t=this.materials.get(e);return t!=null&&(this.mesh.material=yield t[F_](),this.activeMaterialIdx=e),this.mesh.material})}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(e){return this.materials.get(e)}enableVariant(e){return Jt(this,null,function*(){if(e==null)return this.setActiveMaterial(this.initialMaterialIdx);if(this.variantToMaterialMap!=null&&this.modelVariants.has(e)){const t=this.modelVariants.get(e);return this.enableVariantHelper(t.index)}return null})}enableVariantHelper(e){return Jt(this,null,function*(){if(this.variantToMaterialMap!=null&&e!=null){const t=this.variantToMaterialMap.get(e);if(t!=null)return this.setActiveMaterial(t.index)}return null})}instantiateVariants(){return Jt(this,null,function*(){if(this.variantToMaterialMap!=null)for(const e of this.variantToMaterialMap.keys()){const t=this.mesh.userData.variantMaterials.get(e);if(t.material!=null)continue;const i=yield this.enableVariantHelper(e);i!=null&&(t.material=i)}})}get variantInfo(){return this.variantToMaterialMap}addVariant(e,t){if(!this.ensureVariantIsUnused(t))return!1;this.modelVariants.has(t)||this.modelVariants.set(t,{name:t,index:this.modelVariants.size});const i=this.modelVariants.get(t).index;return e[Xf]().add(i),this.variantToMaterialMap.set(i,e),this.materials.set(e.index,e),this.updateVariantUserData(i,e),!0}deleteVariant(e){if(this.variantInfo.has(e)){this.variantInfo.delete(e);const t=this.mesh.userData.variantMaterials;t?.delete(e)}}updateVariantUserData(e,t){t[Xf]().add(e),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map,this.mesh.userData.variantMaterials.set(e,{material:t[wn].values().next().value,gltfMaterialIndex:t.index})}ensureVariantIsUnused(e){const t=this.modelVariants.get(e);return t!=null&&this.variantInfo.has(t.index)?(console.warn(`Primitive cannot add variant '${e}' for this material, it already exists.`),!1):!0}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var JE,eS,tS,iS,nS,rS;const Il=Symbol("materials"),Kf=Symbol("hierarchy"),sS=Symbol("roots"),Va=Symbol("primitives"),z_=Symbol("correlatedSceneGraph"),aS=Symbol("prepareVariantsForExport"),oS=Symbol("switchVariant"),lS=Symbol("materialFromPoint"),G_=Symbol("nodeFromPoint"),cS=Symbol("nodeFromIndex"),mr=Symbol("variantData"),Q_=Symbol("availableVariants"),V_=Symbol("modelOnUpdate"),hS=Symbol("cloneMaterial");class D4{constructor(e,t,i,s){this.gltf=e,this.gltfElementMap=t,this.mapKey=i,this.doLazyLoad=s}}class P4{constructor(e,t=()=>{}){this[JE]=[],this[eS]=[],this[tS]=[],this[iS]=[],this[nS]=()=>{},this[rS]=new Map,this[V_]=t,this[z_]=e;const{gltf:i,threeGLTF:s,gltfElementMap:c}=e;for(const[m,A]of i.materials.entries()){const x=c.get(A);if(x!=null)this[Il].push(new N_(t,i,A,m,!0,this[mr],x));else{const b=(i.materials||[])[m],I=m,E=()=>Jt(this,null,function*(){const T=yield s.parser.getDependency("material",I),U=new Set;return c.set(b,U),U.add(T),{set:U,material:T}});this[Il].push(new N_(t,i,b,m,!1,this[mr],x,new D4(i,c,b,E)))}}const u=new Map,a=[];for(const m of s.scene.children)a.push(m);for(;a.length>0;){const m=a.pop();let A=null;m instanceof oi?(A=new O_(m,this.materials,this[mr],e),this[Va].push(A)):A=new ZE(m.name);const x=u.get(m);x!=null?x.children.push(A):this[sS].push(A),this[Kf].push(A);for(const b of m.children)a.push(b),u.set(m,A)}}get materials(){return this[Il]}[(JE=Il,eS=Kf,tS=sS,iS=Va,nS=V_,rS=mr,Q_)](){const e=Array.from(this[mr].values());return e.sort((t,i)=>t.index-i.index),e.map(t=>t.name)}getMaterialByName(e){const t=this[Il].filter(i=>i.name===e);return t.length>0?t[0]:null}[cS](e,t){const i=this[Kf].find(s=>{if(s instanceof O_){const{meshes:c,primitives:u}=s.mesh.userData.associations;if(c==e&&u==t)return!0}return!1});return i??null}[G_](e){return this[Kf].find(t=>t instanceof O_&&t.mesh===e.object)}[lS](e){return this[G_](e).getActiveMaterial()}[oS](e){return Jt(this,null,function*(){for(const t of this[Va])yield t.enableVariant(e);for(const t of this.materials)t[Xu](!1);for(const t of this[Va])this.materials[t.getActiveMaterial().index][Xu](!0)})}[aS](){return Jt(this,null,function*(){const e=[];for(const t of this[Va])e.push(t.instantiateVariants());yield Promise.all(e)})}[hS](e,t){const i=this.materials[e];i.isLoaded||console.error(`Cloning an unloaded material,
           call 'material.ensureLoaded() before cloning the material.`);const s=i[wn],c=JSON.parse(JSON.stringify(i[qi]));c.name=t,this[z_].gltf.materials.push(c);const u=new Set;for(const[m,A]of s.entries()){const x=A.clone();x.name=t+(s.size>1?"_inst"+m:""),u.add(x)}const a=new N_(this[V_],this[z_].gltf,c,this[Il].length,!1,this[mr],u);return this[Il].push(a),a}createMaterialInstanceForVariant(e,t,i,s=!0){let c=null;for(const u of this[Va]){const a=this[mr].get(i);a!=null&&u.variantInfo.has(a.index)||u.getMaterial(e)!=null&&(this.hasVariant(i)||this.createVariant(i),c==null&&(c=this[hS](e,t)),u.addVariant(c,i))}if(s&&c!=null){c[Xu](!0),this.materials[e][Xu](!1);for(const u of this[Va])u.enableVariant(i)}return c}createVariant(e){this[mr].has(e)?console.warn(`Variant '${e}'' already exists`):this[mr].set(e,{name:e,index:this[mr].size})}hasVariant(e){return this[mr].has(e)}setMaterialToVariant(e,t){if(this[Q_]().find(i=>i===t)==null){console.warn(`Can't add material to '${t}', the variant does not exist.'`);return}if(e<0||e>=this.materials.length){console.error("setMaterialToVariant(): materialIndex is out of bounds.");return}for(const i of this[Va]){const s=i.getMaterial(e);s!=null&&i.addVariant(s,t)}}updateVariantName(e,t){const i=this[mr].get(e);i!=null&&(i.name=t,this[mr].set(t,i),this[mr].delete(e))}deleteVariant(e){const t=this[mr].get(e);if(t!=null){for(const i of this.materials)i.hasVariant(e)&&i[Yf].delete(t.index);for(const i of this[Va])i.deleteVariant(t.index);this[mr].delete(e)}}}/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var H_=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};const Zf=Symbol("currentGLTF"),Jf=Symbol("originalGltfJson"),Cl=Symbol("model"),W_=Symbol("getOnUpdateMethod"),Yu=Symbol("buildTexture"),U4=o=>{var e,t,i;class s extends o{constructor(){super(...arguments),this[e]=void 0,this[t]=null,this[i]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[Cl]}get availableVariants(){return this.model?this.model[Q_]():[]}get originalGltfJson(){return this[Jf]}[(e=Cl,t=Zf,i=Jf,W_)](){return()=>{this[Hr]()}}[Yu](u){return u.encoding=zs,u.wrapS=aa,u.wrapT=aa,new NE(this[W_](),u)}createTexture(u,a="image/png"){return Jt(this,null,function*(){const{textureUtils:m}=this[$i],A=yield m.loadImage(u);return A.userData.mimeType=a,this[Yu](A)})}createLottieTexture(u,a=1){return Jt(this,null,function*(){const{textureUtils:m}=this[$i],A=yield m.loadLottie(u,a);return this[Yu](A)})}createVideoTexture(u){const a=document.createElement("video");a.src=u,a.muted=!0,a.playsInline=!0,a.loop=!0,a.play();const m=new SD(a);return this[Yu](m)}createCanvasTexture(){const u=document.createElement("canvas"),a=new eb(u);return this[Yu](a)}updated(u){return Jt(this,null,function*(){if(FA(s.prototype,this,"updated").call(this,u),u.has("variantName")){const a=this[Tl].beginActivity();a(.1);const m=this[Cl],{variantName:A}=this;m!=null&&(yield m[oS](A),this[Hr](),this.dispatchEvent(new CustomEvent("variant-applied"))),a(1)}if(u.has("orientation")||u.has("scale")){if(!this.loaded)return;const a=this[Mt];a.applyTransform(),a.updateBoundingBox(),a.updateShadow(),this[$i].arRenderer.onUpdateScene(),this[Hr]()}})}[Do](){super[Do]();const{currentGLTF:u}=this[Mt];if(u!=null){const{correlatedSceneGraph:a}=u;a!=null&&u!==this[Zf]&&(this[Cl]=new P4(a,this[W_]()),this[Jf]=JSON.parse(JSON.stringify(a.gltf))),"variants"in u.userData&&this.requestUpdate("variantName")}this[Zf]=u}exportScene(u){return Jt(this,null,function*(){const a=this[Mt];return new Promise((m,A)=>Jt(this,null,function*(){const x={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(x,u),x.animations=a.animations,x.truncateDrawRange=!0;const b=a.shadow;let I=!1;b!=null&&(I=b.visible,b.visible=!1),yield this[Cl][aS](),new g_().register(E=>new pF(E)).parse(a.model,E=>m(new Blob([x.binary?E:JSON.stringify(E)],{type:x.binary?"application/octet-stream":"application/json"})),()=>A("glTF export failed"),x),b!=null&&(b.visible=I)}))})}materialFromPoint(u,a){const m=this[Cl];if(m==null)return null;const A=this[Mt],x=A.getNDC(u,a),b=A.hitFromPoint(x);return b==null||b.face==null?null:m[lS](b)}}return H_([ui({type:String,attribute:"variant-name"})],s.prototype,"variantName",void 0),H_([ui({type:String,attribute:"orientation"})],s.prototype,"orientation",void 0),H_([ui({type:String,attribute:"scale"})],s.prototype,"scale",void 0),s};/* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const em=new we,q_=new we,$_=new we,tm=new Ei,uS=new es,dS=new gs;class pS extends qU{constructor(e){super(document.createElement("div")),this.normal=new we(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=e.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(e.position),this.updateNormal(e.normal),this.surface=e.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){(!this.facingCamera||!this.initialized)&&this.updateVisibility(!0)}hide(){(this.facingCamera||!this.initialized)&&this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,this.referenceCount===0}updatePosition(e){if(e==null)return;const t=Io(e)[0].terms;for(let i=0;i<3;++i)this.position.setComponent(i,Qa(t[i]).number);this.updateMatrixWorld()}updateNormal(e){if(e==null)return;const t=Io(e)[0].terms;for(let i=0;i<3;++i)this.normal.setComponent(i,t[i].number)}updateSurface(e){if(!e&&this.initialized)return;const{mesh:t,tri:i,bary:s}=this;if(t==null||i==null||s==null)return;t.getVertexPosition(i.x,em),t.getVertexPosition(i.y,q_),t.getVertexPosition(i.z,$_),em.toArray(tm.elements,0),q_.toArray(tm.elements,3),$_.toArray(tm.elements,6),this.position.copy(s).applyMatrix3(tm);const c=this.parent;c.worldToLocal(t.localToWorld(this.position)),uS.set(em,q_,$_),uS.getNormal(this.normal).transformDirection(t.matrixWorld);const u=c.parent;dS.setFromAxisAngle(em.set(0,1,0),-u.yaw),this.normal.applyQuaternion(dS)}orient(e){this.pivot.style.transform=`rotate(${e}rad)`}updateVisibility(e){e?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach(t=>{if(t.nodeType!==Node.ELEMENT_NODE)return;const i=t,s=i.dataset.visibilityAttribute;if(s!=null){const c=`data-${s}`;e?i.setAttribute(c,""):i.removeAttribute(c)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))}),this.initialized=!0}}const F4={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},k4={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};function fS(o,e,t){return(1-t)*o+t*e}/* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const mS=9,N4=6,j_=2,O4=.3;class z4 extends Zi{constructor(e,t,i){super(),this.camera=new Bc,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new D1,this.horizontalBlurMaterial=new Xs(F4),this.verticalBlurMaterial=new Xs(k4),this.intensity=0,this.softness=1,this.boundingBox=new Er,this.size=new we,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:s}=this;s.rotation.x=Math.PI/2,s.left=-.5,s.right=.5,s.bottom=-.5,s.top=.5,this.add(s);const c=new ka,u=new js({opacity:1,transparent:!0,side:Gn});this.floor=new oi(c,u),this.floor.userData.shadow=!0,s.add(this.floor),this.blurPlane=new oi(c),this.blurPlane.visible=!1,s.add(this.blurPlane),e.target.add(this),this.depthMaterial.onBeforeCompile=function(a){a.fragmentShader=a.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(e,t,i)}setScene(e,t,i){const{boundingBox:s,size:c,rotation:u,position:a}=this;if(this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),this.maxDimension=Math.max(c.x,c.y,c.z)*(this.isAnimated?j_:1),this.boundingBox.getCenter(a),i==="back"){const{min:m,max:A}=s;[m.y,m.z]=[m.z,m.y],[A.y,A.z]=[A.z,A.y],[c.y,c.z]=[c.z,c.y],u.x=Math.PI/2,u.y=Math.PI}else u.x=0,u.y=0;if(this.isAnimated){const m=s.min.y,A=s.max.y;c.y=this.maxDimension,s.expandByVector(c.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=m,s.max.y=A,c.set(this.maxDimension,A-m,this.maxDimension)}i==="bottom"?a.y=s.min.y:a.z=s.min.y,this.setSoftness(t)}setSoftness(e){this.softness=e;const{size:t,camera:i}=this,s=this.isAnimated?j_:1,c=s*Math.pow(2,mS-e*(mS-N4));this.setMapSize(c);const u=t.y/2,a=t.y*s;i.near=0,i.far=fS(a,u,e),this.depthMaterial.opacity=1/e,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(e){const{size:t}=this;this.isAnimated&&(e*=j_);const i=Math.floor(t.x>t.z?e:e*t.x/t.z),s=Math.floor(t.x>t.z?e*t.z/t.x:e),c=10,u=c+i,a=c+s;if(this.renderTarget!=null&&(this.renderTarget.width!==u||this.renderTarget.height!==a)&&(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),this.renderTarget==null){const m={format:Rn};this.renderTarget=new Vs(u,a,m),this.renderTargetBlur=new Vs(u,a,m),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(t.x*(1+c/i),t.z*(1+c/s),1),this.needsUpdate=!0}setIntensity(e){this.intensity=e,e>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=e*fS(O4,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(e){this.floor.position.z=-e+.001*this.maxDimension}render(e,t){t.overrideMaterial=this.depthMaterial;const i=e.getClearAlpha();e.setClearAlpha(0),this.floor.visible=!1;const s=e.xr.enabled;e.xr.enabled=!1;const c=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.render(t,this.camera),t.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(e),e.xr.enabled=s,e.setRenderTarget(c),e.setClearAlpha(i)}blurShadow(e){const{camera:t,horizontalBlurMaterial:i,verticalBlurMaterial:s,renderTarget:c,renderTargetBlur:u,blurPlane:a}=this;a.visible=!0,a.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,e.setRenderTarget(u),e.render(a,t),a.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,e.setRenderTarget(c),e.render(a,t),a.visible=!1}dispose(){this.renderTarget!=null&&this.renderTarget.dispose(),this.renderTargetBlur!=null&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const X_=100,Y_=new we,gS=new we,AS=new we,K_=new rP,G4=new we,Ku=new yi;class Q4 extends xs{constructor({canvas:e,element:t,width:i,height:s}){super(),this.annotationRenderer=new $U,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.camera=new ir(45,1,.1,100),this.xrCamera=null,this.url=null,this.target=new Zi,this.animationNames=[],this.boundingBox=new Er,this.boundingSphere=new As,this.size=new we,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.canScale=!0,this.isDirty=!1,this.goalTarget=new we,this.targetDamperX=new ns,this.targetDamperY=new ns,this.targetDamperZ=new ns,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.name="ModelScene",this.element=t,this.canvas=e,this.camera=new ir(45,1,.1,100),this.camera.name="MainCamera",this.add(this.target),this.setSize(i,s),this.target.name="Target",this.mixer=new nP(this.target);const{domElement:c}=this.annotationRenderer,{style:u}=c;u.display="none",u.pointerEvents="none",u.position="absolute",u.top="0",this.element.shadowRoot.querySelector(".default").appendChild(c),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return this.xrCamera!=null?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}setObject(e){return Jt(this,null,function*(){this.reset(),this._model=e,this.target.add(e),yield this.setupScene()})}setSource(e,t=()=>{}){return Jt(this,null,function*(){if(!e||e===this.url){t(1);return}if(this.reset(),this.url=e,this.externalRenderer!=null){const a=yield this.externalRenderer.load(t);this.boundingSphere.radius=a.framedRadius,this.idealAspect=a.fieldOfViewAspect;return}this.cancelPendingSourceChange!=null&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);let i;try{i=yield new Promise((a,m)=>Jt(this,null,function*(){this.cancelPendingSourceChange=()=>m();try{const A=yield this.element[$i].loader.load(e,this.element,t);a(A)}catch(A){m(A)}}))}catch(a){if(a==null)return;throw a}this.cancelPendingSourceChange=null,this.reset(),this.url=e,this._currentGLTF=i,i!=null&&(this._model=i.scene,this.target.add(i.scene));const{animations:s}=i,c=new Map,u=[];for(const a of s)c.set(a.name,a),u.push(a.name);this.animations=s,this.animationsByName=c,this.animationNames=u,yield this.setupScene()})}setupScene(){return Jt(this,null,function*(){this.applyTransform(),this.updateBoundingBox(),yield this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity)})}reset(){this.url=null,this.renderCount=0,this.queueRender(),this.shadow!=null&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:e}=this;e!=null&&(e.removeFromParent(),this._model=null);const t=this._currentGLTF;t!=null&&(t.dispose(),this._currentGLTF=null),this.currentAnimationAction!=null&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),this.shadow!=null&&(this.shadow.dispose(),this.shadow=null),this.element[Zf]=null,this.element[Jf]=null,this.element[Cl]=null}get currentGLTF(){return this._currentGLTF}setSize(e,t){if(!(this.width===e&&this.height===t)){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,this.externalRenderer!=null){const i=XA();this.externalRenderer.resize(e*i,t*i)}this.queueRender()}}markBakedShadow(e){e.userData.shadow=!0,this.bakedShadows.add(e)}unmarkBakedShadow(e){e.userData.shadow=!1,e.visible=!0,this.bakedShadows.delete(e),this.boundingBox.expandByObject(e)}findBakedShadows(e){const t=new Er;e.traverse(i=>{const s=i;if(!s.material||!s.material.transparent)return;t.setFromObject(s);const c=t.getSize(G4),u=Math.min(c.x,c.y,c.z);Math.max(c.x,c.y,c.z)<X_*u||this.markBakedShadow(s)})}checkBakedShadows(){const{min:e,max:t}=this.boundingBox,i=new Er;this.boundingBox.getSize(this.size);for(const s of this.bakedShadows)i.setFromObject(s),!(i.min.y<e.y+this.size.y/X_&&i.min.x<=e.x&&i.max.x>=t.x&&i.min.z<=e.z&&i.max.z>=t.z)&&(i.min.z<e.z+this.size.z/X_&&i.min.x<=e.x&&i.max.x>=t.x&&i.min.y<=e.y&&i.max.y>=t.y||this.unmarkBakedShadow(s))}applyTransform(){const{model:e}=this;if(e==null)return;const t=Io(this.element.orientation)[0].terms,i=Qa(t[0]).number,s=Qa(t[1]).number,c=Qa(t[2]).number;e.quaternion.setFromEuler(new yc(s,c,i,"YXZ"));const u=Io(this.element.scale)[0].terms;e.scale.set(u[0].number,u[1].number,u[2].number)}updateBoundingBox(){const{model:e}=this;if(e==null)return;this.target.remove(e),this.findBakedShadows(e);const t=(i,s)=>i.expandByPoint(s);this.setBakedShadowVisibility(!1),this.boundingBox=Tf(e,t,new Er),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach(i=>this.unmarkBakedShadow(i)),this.boundingBox=Tf(e,t,new Er)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(e)}updateFraming(){return Jt(this,null,function*(){const{model:e}=this;if(e==null)return;this.target.remove(e),this.setBakedShadowVisibility(!1);const{center:t}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),yield this.element.updateComplete,t.copy(this.getTarget());const i=(c,u)=>Math.max(c,t.distanceToSquared(u));this.boundingSphere.radius=Math.sqrt(Tf(e,i,0));const s=(c,u)=>{u.sub(t);const a=Math.sqrt(u.x*u.x+u.z*u.z);return Math.max(c,a/(this.idealCameraDistance()-Math.abs(u.y)))};this.idealAspect=Tf(e,s,0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(e)})}setBakedShadowVisibility(e=this.shadowIntensity<=0){for(const t of this.bakedShadows)t.visible=e}idealCameraDistance(){const e=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(e)}adjustedFoV(e){const t=Math.tan(e/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(t)*180/Math.PI}getNDC(e,t){if(this.xrCamera!=null)Ku.set(e/window.screen.width,t/window.screen.height);else{const i=this.element.getBoundingClientRect();Ku.set((e-i.x)/this.width,(t-i.y)/this.height)}return Ku.multiplyScalar(2).subScalar(1),Ku.y*=-1,Ku}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(e,t){this.element[$i].arRenderer.presentedScene!==this&&(this.environment=e,this.background=t,this.queueRender())}setTarget(e,t,i){this.goalTarget.set(-e,-t,-i)}setTargetDamperDecayTime(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(Cw)}updateTarget(e){const t=this.goalTarget,i=this.target.position;if(t.equals(i))return!1;{const s=this.boundingSphere.radius/10;let{x:c,y:u,z:a}=i;return c=this.targetDamperX.update(c,t.x,e,s),u=this.targetDamperY.update(u,t.y,e,s),a=this.targetDamperZ.update(a,t.z,e,s),this.target.position.set(c,u,a),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(e,t){const{x:i,z:s}=this.position;this.yaw=Math.atan2(e-i,t-s)}get model(){return this._model}set yaw(e){this.rotation.y=e,this.queueRender()}get yaw(){return this.rotation.y}set animationTime(e){this.mixer.setTime(e),this.queueShadowRender()}get animationTime(){if(this.currentAnimationAction!=null){const e=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop===Ng&&(e&1)===1?this.duration-this.currentAnimationAction.time:this.currentAnimationAction.time}return 0}set animationTimeScale(e){this.mixer.timeScale=e}get animationTimeScale(){return this.mixer.timeScale}get duration(){return this.currentAnimationAction!=null&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return this.currentAnimationAction!=null}playAnimation(e=null,t=0,i=kg,s=1/0){if(this._currentGLTF==null)return;const{animations:c}=this;if(c==null||c.length===0)return;let u=null;if(e!=null&&(u=this.animationsByName.get(e),u==null)){const a=parseInt(e);!isNaN(a)&&a>=0&&a<c.length&&(u=c[a])}u==null&&(u=c[0]);try{const{currentAnimationAction:a}=this,m=this.mixer.clipAction(u,this);this.currentAnimationAction=m,this.element.paused?this.mixer.stopAllAction():(m.paused=!1,a!=null&&m!==a?m.crossFadeFrom(a,t,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),m.setLoop(i,s),m.enabled=!0,m.clampWhenFinished=!0,m.play()}catch(a){console.error(a)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(e){this.mixer.update(e),this.queueShadowRender()}subscribeMixerEvent(e,t){this.mixer.addEventListener(e,t)}updateShadow(){const e=this.shadow;if(e!=null){const t=this.element.arPlacement==="wall"?"back":"bottom";e.setScene(this,this.shadowSoftness,t),e.needsUpdate=!0}}renderShadow(e){const t=this.shadow;t!=null&&t.needsUpdate==!0&&(t.render(e,this),t.needsUpdate=!1)}queueShadowRender(){this.shadow!=null&&(this.shadow.needsUpdate=!0)}setShadowIntensity(e){if(this.shadowIntensity=e,this._currentGLTF!=null&&(this.setBakedShadowVisibility(),!(e<=0&&this.shadow==null))){if(this.shadow==null){const t=this.element.arPlacement==="wall"?"back":"bottom";this.shadow=new z4(this,this.shadowSoftness,t)}this.shadow.setIntensity(e)}}setShadowSoftness(e){this.shadowSoftness=e;const t=this.shadow;t?.setSoftness(e)}setShadowOffset(e){const t=this.shadow;t?.setOffset(e)}hitFromPoint(e,t=this){return K_.setFromCamera(e,this.getCamera()),K_.intersectObject(t,!0).find(i=>i.object.visible&&!i.object.userData.shadow)}positionAndNormalFromPoint(e,t=this){var i;const s=this.hitFromPoint(e,t);if(s==null)return null;const c=s.point,u=s.face!=null?s.face.normal.clone().applyNormalMatrix(new Ei().getNormalMatrix(s.object.matrixWorld)):K_.ray.direction.clone().multiplyScalar(-1),a=(i=s.uv)!==null&&i!==void 0?i:null;return{position:c,normal:u,uv:a}}surfaceFromPoint(e,t=this){const i=this.element.model;if(i==null)return null;const s=this.hitFromPoint(e,t);if(s==null||s.face==null)return null;const c=i[G_](s),{meshes:u,primitives:a}=c.mesh.userData.associations,m=new we,A=new we,x=new we,{a:b,b:I,c:E}=s.face,T=s.object;T.getVertexPosition(b,m),T.getVertexPosition(I,A),T.getVertexPosition(E,x);const U=new es(m,A,x),P=new we;return U.getBarycoord(T.worldToLocal(s.point),P),`${u} ${a} ${b} ${I} ${E} ${P.x.toFixed(3)} ${P.y.toFixed(3)} ${P.z.toFixed(3)}`}addHotspot(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element)}removeHotspot(e){this.target.remove(e)}forHotspots(e){const{children:t}=this.target;for(let i=0,s=t.length;i<s;i++){const c=t[i];c instanceof pS&&e(c)}}initializeSurface(e){if(e.surface!=null&&e.mesh==null){const t=Io(e.surface)[0].terms;if(t.length!=8){console.warn(e.surface+" does not have exactly 8 numbers.");return}const i=this.element.model[cS](t[0].number,t[1].number),s=new we(t[2].number,t[3].number,t[4].number);if(i==null){console.warn(e.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");return}const c=i.mesh.geometry.attributes.position.count;if(s.x>=c||s.y>=c||s.z>=c){console.warn(e.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");return}const u=new we(t[5].number,t[6].number,t[7].number);e.mesh=i.mesh,e.tri=s,e.bary=u}}updateSurfaceHotspots(){const e=!this.element.paused;this.forHotspots(t=>{this.initializeSurface(t),t.updateSurface(e)})}updateHotspotsVisibility(e){this.forHotspots(t=>{Y_.copy(e),gS.setFromMatrixPosition(t.matrixWorld),Y_.sub(gS),AS.copy(t.normal).transformDirection(this.target.matrixWorld),Y_.dot(AS)<0?t.hide():t.show()})}orientHotspots(e){this.forHotspots(t=>{t.orient(e)})}setHotspotsVisibility(e){this.forHotspots(t=>{t.visible=e})}updateSchema(e){var t;const{schemaElement:i,element:s}=this,{alt:c,poster:u,iosSrc:a}=s;if(e!=null){const m=[{"@type":"MediaObject",contentUrl:e,encodingFormat:((t=e.split(".").pop())===null||t===void 0?void 0:t.toLowerCase())==="gltf"?"model/gltf+json":"model/gltf-binary"}];a&&m.push({"@type":"MediaObject",contentUrl:a,encodingFormat:"model/vnd.usdz+zip"});const A={"@context":"http://schema.org/","@type":"3DModel",image:u??void 0,name:c??void 0,encoding:m};i.textContent=JSON.stringify(A),document.head.appendChild(i)}else i.parentElement!=null&&i.parentElement.removeChild(i)}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/class V4 extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(){const e={progress:0,completed:!1};return this.ongoingActivities.add(e),this.ongoingActivityCount===1&&this.announceTotalProgress(e,0),t=>{let i;return i=Math.max(da(t,0,1),e.progress),i!==e.progress&&this.announceTotalProgress(e,i),e.progress}}announceTotalProgress(e,t){let i=0,s=0;t==1&&(e.completed=!0);for(const a of this.ongoingActivities){const{progress:m}=a;i+=1-m,a.completed===!0&&s++}const c=e.progress;e.progress=t,this.totalProgress+=(t-c)*(1-this.totalProgress)/i;const u=s===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:u}})),s===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var im=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c},_S,yS,xS,vS,bS,wS,ES,SS,IS,CS,MS,TS,BS;const H4=10,W4=50,q4=0,$4=300,j4=150,Lo=document.createElement("canvas"),Z_=Symbol("fallbackResizeHandler"),RS=Symbol("defaultAriaLabel"),nm=Symbol("resizeObserver"),nh=Symbol("clearModelTimeout"),J_=Symbol("onContextLost"),rh=Symbol("loaded"),e0=Symbol("status"),t0=Symbol("onFocus"),i0=Symbol("onBlur"),sh=Symbol("updateSize"),rm=Symbol("intersectionObserver"),Ml=Symbol("isElementInViewport"),sm=Symbol("announceModelVisibility"),Zu=Symbol("ariaLabel"),n0=Symbol("altDefaulted"),Ju=Symbol("statusElement"),r0=Symbol("updateStatus"),ed=Symbol("loadedTime"),ah=Symbol("updateSource"),LS=Symbol("markLoaded"),td=Symbol("container"),ga=Symbol("input"),s0=Symbol("canvas"),Mt=Symbol("scene"),Hr=Symbol("needsRender"),Aa=Symbol("tick"),Do=Symbol("onModelLoad"),id=Symbol("onResize"),$i=Symbol("renderer"),Tl=Symbol("progressTracker"),DS=Symbol("getLoaded"),Bl=Symbol("getModelIsVisible"),oh=Symbol("shouldAttemptPreload"),Po=o=>({x:o.x,y:o.y,z:o.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),X4=o=>({u:o.x,v:o.y,toString(){return`${this.u} ${this.v}`}});class nd extends _l{constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[_S]=!1,this[yS]=!1,this[xS]=0,this[vS]="",this[bS]=null,this[wS]=Ob(()=>{const s=this.getBoundingClientRect();this[sh](s)},W4),this[ES]=Ob(s=>{const c=this.modelIsVisible;c!==s&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:c}}))},q4),this[SS]=null,this[IS]=null,this[CS]=new V4,this[MS]=()=>{this[Ju].textContent=this[e0]},this[TS]=()=>{this[Ju].textContent=""},this[BS]=s=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:s.sourceEvent}}))},this.attachShadow({mode:"open"});const e=this.shadowRoot;jP(e),this[td]=e.querySelector(".container"),this[ga]=e.querySelector(".userInput"),this[s0]=e.querySelector("canvas"),this[Ju]=e.querySelector("#status"),this[RS]=this[ga].getAttribute("aria-label");let t,i;if(this.isConnected){const s=this.getBoundingClientRect();t=s.width,i=s.height}else t=$4,i=j4;this[Mt]=new Q4({canvas:this[s0],element:this,width:t,height:i}),Promise.resolve().then(()=>{this[sh](this.getBoundingClientRect())}),$A&&(this[nm]=new ResizeObserver(s=>{if(!this[$i].isPresenting)for(let c of s)c.target===this&&this[sh](c.contentRect)})),jA?this[rm]=new IntersectionObserver(s=>{for(let c of s)if(c.target===this){const u=this.modelIsVisible;this[Ml]=c.isIntersecting,this[sm](u),this[Ml]&&!this.loaded&&this[ah]()}},{root:null,rootMargin:"0px",threshold:1e-5}):this[Ml]=!0}static get is(){return"model-viewer"}static set modelCacheSize(e){Wn[So].evictionThreshold=e}static get modelCacheSize(){return Wn[So].evictionThreshold}static set minimumRenderScale(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),bs.singleton.minScale=e}static get minimumRenderScale(){return bs.singleton.minScale}get loaded(){return this[DS]()}get[(_S=Ml,yS=rh,xS=ed,vS=e0,bS=nh,wS=Z_,ES=sm,SS=nm,IS=rm,CS=Tl,$i)](){return bs.singleton}get modelIsVisible(){return this[Bl]()}connectedCallback(){super.connectedCallback&&super.connectedCallback(),$A?this[nm].observe(this):self.addEventListener("resize",this[Z_]),jA&&this[rm].observe(this),this.addEventListener("focus",this[t0]),this.addEventListener("blur",this[i0]);const e=this[$i];e.addEventListener("contextlost",this[J_]),e.registerScene(this[Mt]),this[nh]!=null&&(self.clearTimeout(this[nh]),this[nh]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),$A?this[nm].unobserve(this):self.removeEventListener("resize",this[Z_]),jA&&this[rm].unobserve(this),this.removeEventListener("focus",this[t0]),this.removeEventListener("blur",this[i0]);const e=this[$i];e.removeEventListener("contextlost",this[J_]),e.unregisterScene(this[Mt]),this[nh]=self.setTimeout(()=>{this[Mt].dispose(),this[nh]=null},H4)}updated(e){super.updated(e),e.has("src")&&(this.src==null?(this[rh]=!1,this[ed]=0,this[Mt].reset()):this.src!==this[Mt].url&&(this[rh]=!1,this[ed]=0,this[ah]())),e.has("alt")&&this[ga].setAttribute("aria-label",this[Zu]),e.has("withCredentials")&&(Wn.withCredentials=this.withCredentials,this[$i].textureUtils.withCredentials=this.withCredentials),e.has("generateSchema")&&(this.generateSchema?this[Mt].updateSchema(this.src):this[Mt].updateSchema(null))}toDataURL(e,t){return this[$i].displayCanvas(this[Mt]).toDataURL(e,t)}toBlob(e){return Jt(this,null,function*(){const t=e?e.mimeType:void 0,i=e?e.qualityArgument:void 0,s=e?e.idealAspect:void 0,{width:c,height:u,idealAspect:a,aspect:m}=this[Mt],{dpr:A,scaleFactor:x}=this[$i];let b=c*x*A,I=u*x*A,E=0,T=0;if(s===!0)if(a>m){const U=I;I=Math.round(b/a),T=(U-I)/2}else{const U=b;b=Math.round(I*a),E=(U-b)/2}Lo.width=b,Lo.height=I;try{return new Promise((U,P)=>Jt(this,null,function*(){Lo.getContext("2d").drawImage(this[$i].displayCanvas(this[Mt]),E,T,b,I,0,0,b,I),Lo.toBlob(R=>{if(!R)return P(new Error("Unable to retrieve canvas blob"));U(R)},t,i)}))}finally{this[sh]({width:c,height:u})}})}registerEffectComposer(e){e.setRenderer(this[$i].threeRenderer),e.setMainCamera(this[Mt].getCamera()),e.setMainScene(this[Mt]),this[Mt].effectRenderer=e}unregisterEffectComposer(){this[Mt].effectRenderer=null}registerRenderer(e){this[Mt].externalRenderer=e}unregisterRenderer(){this[Mt].externalRenderer=null}get[Zu](){return this[n0]}get[n0](){return this.alt==null||this.alt==="null"?this[RS]:this.alt}[DS](){return this[rh]}[Bl](){return this.loaded&&this[Ml]}[oh](){return!!this.src&&this[Ml]}[sh]({width:e,height:t}){e===0||t===0||(this[td].style.width=`${e}px`,this[td].style.height=`${t}px`,this[id]({width:e,height:t}))}[Aa](e,t){var i;(i=this[Mt].effectRenderer)===null||i===void 0||i.beforeRender(e,t)}[LS](){this[rh]||(this[rh]=!0,this[ed]=performance.now())}[Hr](){this[Mt].queueRender()}[Do](){}[r0](e){this[e0]=e;const t=this.getRootNode();t!=null&&t.activeElement===this&&this[Ju].textContent!=e&&(this[Ju].textContent=e)}[(MS=t0,TS=i0,id)](e){this[Mt].setSize(e.width,e.height)}[(BS=J_,ah)](){return Jt(this,null,function*(){const e=this[Mt];if(this.loaded||!this[oh]()||this.src===e.url)return;this.generateSchema&&e.updateSchema(this.src),this[r0]("Loading"),e.stopAnimation();const t=this[Tl].beginActivity(),i=this.src;try{const s=e.setSource(i,u=>t(da(u,0,1)*.95)),c=this[If]();yield Promise.all([s,c]),this[LS](),this[Do](),this.updateComplete.then(()=>{this.dispatchEvent(new CustomEvent("before-render"))}),yield new Promise(u=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),u()})})})}catch(s){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:s}}))}finally{t(1)}})}}im([ui({type:String})],nd.prototype,"alt",void 0),im([ui({type:String})],nd.prototype,"src",void 0),im([ui({type:Boolean,attribute:"with-credentials"})],nd.prototype,"withCredentials",void 0),im([ui({type:Boolean,attribute:"generate-schema"})],nd.prototype,"generateSchema",void 0);/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var a0=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};const PS=1e3,am=Symbol("changeAnimation"),Ha=Symbol("paused"),Y4={repetitions:1/0,pingpong:!1},K4=o=>{var e;class t extends o{constructor(...s){super(s),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[e]=!0,this[Mt].subscribeMixerEvent("loop",c=>{const u=c.action._loopCount;this.dispatchEvent(new CustomEvent("loop",{detail:{count:u}}))}),this[Mt].subscribeMixerEvent("finished",()=>{this[Ha]=!0,this.dispatchEvent(new CustomEvent("finished"))})}get availableAnimations(){return this.loaded?this[Mt].animationNames:[]}get duration(){return this[Mt].duration}get paused(){return this[Ha]}get currentTime(){return this[Mt].animationTime}set currentTime(s){this[Mt].animationTime=s,this[Hr]()}get timeScale(){return this[Mt].animationTimeScale}set timeScale(s){this[Mt].animationTimeScale=s}pause(){this[Ha]||(this[Ha]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(s){this.availableAnimations.length>0&&(this[Ha]=!1,this[am](s),this.dispatchEvent(new CustomEvent("play")))}[(e=Ha,Do)](){super[Do](),this[Ha]=!0,this.animationName!=null&&this[am](),this.autoplay&&this.play()}[Aa](s,c){super[Aa](s,c),!(this[Ha]||!this[Bl]()&&!this[$i].isPresenting)&&(this[Mt].updateAnimation(c/PS),this[Hr]())}updated(s){super.updated(s),s.has("autoplay")&&this.autoplay&&this.play(),s.has("animationName")&&this[am]()}[am](s=Y4){var c;const u=(c=s.repetitions)!==null&&c!==void 0?c:1/0,a=s.pingpong?Ng:u===1?Cv:kg;this[Mt].playAnimation(this.animationName,this.animationCrossfadeDuration/PS,a,u),this[Ha]&&(this[Mt].updateAnimation(0),this[Hr]())}}return a0([ui({type:Boolean})],t.prototype,"autoplay",void 0),a0([ui({type:String,attribute:"animation-name"})],t.prototype,"animationName",void 0),a0([ui({type:Number,attribute:"animation-crossfade-duration"})],t.prototype,"animationCrossfadeDuration",void 0),t};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Rl=Symbol("hotspotMap"),o0=Symbol("mutationCallback"),rd=Symbol("observer"),l0=Symbol("addHotspot"),US=Symbol("removeHotspot"),c0=new pi,Z4=o=>{var e,t,i;class s extends o{constructor(){super(...arguments),this[e]=new Map,this[t]=u=>{u.forEach(a=>{(!(a instanceof MutationRecord)||a.type==="childList")&&(a.addedNodes.forEach(m=>{this[l0](m)}),a.removedNodes.forEach(m=>{this[US](m)}),this[Hr]())})},this[i]=new MutationObserver(this[o0])}connectedCallback(){super.connectedCallback();for(let a=0;a<this.children.length;++a)this[l0](this.children[a]);const{ShadyDOM:u}=self;u==null?this[rd].observe(this,{childList:!0}):this[rd]=u.observeChildren(this,this[o0])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:u}=self;u==null?this[rd].disconnect():u.unobserveChildren(this[rd])}[(e=Rl,t=o0,i=rd,Aa)](u,a){super[Aa](u,a);const m=this[Mt],{annotationRenderer:A}=m,x=m.getCamera();m.shouldRender()&&(m.updateSurfaceHotspots(),m.updateHotspotsVisibility(x.position),A.domElement.style.display="",A.render(m,x))}updateHotspot(u){const a=this[Rl].get(u.name);a!=null&&(a.updatePosition(u.position),a.updateNormal(u.normal),a.surface=u.surface,this[Hr]())}queryHotspot(u){const a=this[Rl].get(u);if(a==null)return null;const m=Po(a.position),A=Po(a.normal),x=a.facingCamera,b=this[Mt],I=b.getCamera(),E=new we;E.setFromMatrixPosition(a.matrixWorld),E.project(I);const T=b.width/2,U=b.height/2;E.x=E.x*T+T,E.y=-(E.y*U)+U;const P=Po(new we(E.x,E.y,E.z));return!Number.isFinite(P.x)||!Number.isFinite(P.y)?null:{position:m,normal:A,canvasPosition:P,facingCamera:x}}positionAndNormalFromPoint(u,a){const m=this[Mt],A=m.getNDC(u,a),x=m.positionAndNormalFromPoint(A);if(x==null)return null;c0.copy(m.target.matrixWorld).invert();const b=Po(x.position.applyMatrix4(c0)),I=Po(x.normal.transformDirection(c0));let E=null;return x.uv!=null&&(E=X4(x.uv)),{position:b,normal:I,uv:E}}surfaceFromPoint(u,a){const m=this[Mt],A=m.getNDC(u,a);return m.surfaceFromPoint(A)}[l0](u){if(!(u instanceof HTMLElement&&u.slot.indexOf("hotspot")===0))return;let a=this[Rl].get(u.slot);a!=null?a.increment():(a=new pS({name:u.slot,position:u.dataset.position,normal:u.dataset.normal,surface:u.dataset.surface}),this[Rl].set(u.slot,a),this[Mt].addHotspot(a)),this[Mt].queueRender()}[US](u){if(!(u instanceof HTMLElement))return;const a=this[Rl].get(u.slot);!a||(a.decrement()&&(this[Mt].removeHotspot(a),this[Rl].delete(u.slot)),this[Mt].queueRender())}}return s};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var FS=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))};try{URL.revokeObjectURL(FS(""))}catch{FS=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Mr=Uint8Array,Tr=Uint16Array,lh=Uint32Array,h0=new Mr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u0=new Mr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kS=new Mr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),NS=function(o,e){for(var t=new Tr(31),i=0;i<31;++i)t[i]=e+=1<<o[i-1];for(var s=new lh(t[30]),i=1;i<30;++i)for(var c=t[i];c<t[i+1];++c)s[c]=c-t[i]<<5|i;return[t,s]},OS=NS(h0,2),J4=OS[0],d0=OS[1];J4[28]=258,d0[258]=28;for(var ek=NS(u0,0),zS=ek[1],p0=new Tr(32768),fn=0;fn<32768;++fn){var Uo=(fn&43690)>>>1|(fn&21845)<<1;Uo=(Uo&52428)>>>2|(Uo&13107)<<2,Uo=(Uo&61680)>>>4|(Uo&3855)<<4,p0[fn]=((Uo&65280)>>>8|(Uo&255)<<8)>>>1}for(var sd=function(e,t,i){for(var s=e.length,c=0,u=new Tr(t);c<s;++c)++u[e[c]-1];var a=new Tr(t);for(c=0;c<t;++c)a[c]=a[c-1]+u[c-1]<<1;var m;if(i){m=new Tr(1<<t);var A=15-t;for(c=0;c<s;++c)if(e[c])for(var x=c<<4|e[c],b=t-e[c],I=a[e[c]-1]++<<b,E=I|(1<<b)-1;I<=E;++I)m[p0[I]>>>A]=x}else for(m=new Tr(s),c=0;c<s;++c)e[c]&&(m[c]=p0[a[e[c]-1]++]>>>15-e[c]);return m},Ll=new Mr(288),fn=0;fn<144;++fn)Ll[fn]=8;for(var fn=144;fn<256;++fn)Ll[fn]=9;for(var fn=256;fn<280;++fn)Ll[fn]=7;for(var fn=280;fn<288;++fn)Ll[fn]=8;for(var om=new Mr(32),fn=0;fn<32;++fn)om[fn]=5;var tk=sd(Ll,9,0),ik=sd(om,5,0),GS=function(o){return(o/8|0)+(o&7&&1)},QS=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var i=new(o instanceof Tr?Tr:o instanceof lh?lh:Mr)(t-e);return i.set(o.subarray(e,t)),i},Wa=function(o,e,t){t<<=e&7;var i=e/8|0;o[i]|=t,o[i+1]|=t>>>8},ad=function(o,e,t){t<<=e&7;var i=e/8|0;o[i]|=t,o[i+1]|=t>>>8,o[i+2]|=t>>>16},f0=function(o,e){for(var t=[],i=0;i<o.length;++i)o[i]&&t.push({s:i,f:o[i]});var s=t.length,c=t.slice();if(!s)return[g0,0];if(s==1){var u=new Mr(t[0].s+1);return u[t[0].s]=1,[u,1]}t.sort(function(q,te){return q.f-te.f}),t.push({s:-1,f:25001});var a=t[0],m=t[1],A=0,x=1,b=2;for(t[0]={s:-1,f:a.f+m.f,l:a,r:m};x!=s-1;)a=t[t[A].f<t[b].f?A++:b++],m=t[A!=x&&t[A].f<t[b].f?A++:b++],t[x++]={s:-1,f:a.f+m.f,l:a,r:m};for(var I=c[0].s,i=1;i<s;++i)c[i].s>I&&(I=c[i].s);var E=new Tr(I+1),T=m0(t[x-1],E,0);if(T>e){var i=0,U=0,P=T-e,R=1<<P;for(c.sort(function(te,ue){return E[ue.s]-E[te.s]||te.f-ue.f});i<s;++i){var X=c[i].s;if(E[X]>e)U+=R-(1<<T-E[X]),E[X]=e;else break}for(U>>>=P;U>0;){var G=c[i].s;E[G]<e?U-=1<<e-E[G]++-1:++i}for(;i>=0&&U;--i){var J=c[i].s;E[J]==e&&(--E[J],++U)}T=e}return[new Mr(E),T]},m0=function(o,e,t){return o.s==-1?Math.max(m0(o.l,e,t+1),m0(o.r,e,t+1)):e[o.s]=t},VS=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new Tr(++e),i=0,s=o[0],c=1,u=function(m){t[i++]=m},a=1;a<=e;++a)if(o[a]==s&&a!=e)++c;else{if(!s&&c>2){for(;c>138;c-=138)u(32754);c>2&&(u(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(u(s),--c;c>6;c-=6)u(8304);c>2&&(u(c-3<<5|8208),c=0)}for(;c--;)u(s);c=1,s=o[a]}return[t.subarray(0,i),e]},od=function(o,e){for(var t=0,i=0;i<e.length;++i)t+=o[i]*e[i];return t},lm=function(o,e,t){var i=t.length,s=GS(e+2);o[s]=i&255,o[s+1]=i>>>8,o[s+2]=o[s]^255,o[s+3]=o[s+1]^255;for(var c=0;c<i;++c)o[s+c+4]=t[c];return(s+4+i)*8},HS=function(o,e,t,i,s,c,u,a,m,A,x){Wa(e,x++,t),++s[256];for(var b=f0(s,15),I=b[0],E=b[1],T=f0(c,15),U=T[0],P=T[1],R=VS(I),X=R[0],G=R[1],J=VS(U),q=J[0],te=J[1],ue=new Tr(19),_e=0;_e<X.length;++_e)ue[X[_e]&31]++;for(var _e=0;_e<q.length;++_e)ue[q[_e]&31]++;for(var K=f0(ue,7),ce=K[0],Ve=K[1],Ne=19;Ne>4&&!ce[kS[Ne-1]];--Ne);var Me=A+5<<3,ve=od(s,Ll)+od(c,om)+u,ke=od(s,I)+od(c,U)+u+14+3*Ne+od(ue,ce)+(2*ue[16]+3*ue[17]+7*ue[18]);if(Me<=ve&&Me<=ke)return lm(e,x,o.subarray(m,m+A));var Re,Fe,Oe,je;if(Wa(e,x,1+(ke<ve)),x+=2,ke<ve){Re=sd(I,E,0),Fe=I,Oe=sd(U,P,0),je=U;var Je=sd(ce,Ve,0);Wa(e,x,G-257),Wa(e,x+5,te-1),Wa(e,x+10,Ne-4),x+=14;for(var _e=0;_e<Ne;++_e)Wa(e,x+3*_e,ce[kS[_e]]);x+=3*Ne;for(var _t=[X,q],yt=0;yt<2;++yt)for(var qe=_t[yt],_e=0;_e<qe.length;++_e){var Ye=qe[_e]&31;Wa(e,x,Je[Ye]),x+=ce[Ye],Ye>15&&(Wa(e,x,qe[_e]>>>5&127),x+=qe[_e]>>>12)}}else Re=tk,Fe=Ll,Oe=ik,je=om;for(var _e=0;_e<a;++_e)if(i[_e]>255){var Ye=i[_e]>>>18&31;ad(e,x,Re[Ye+257]),x+=Fe[Ye+257],Ye>7&&(Wa(e,x,i[_e]>>>23&31),x+=h0[Ye]);var at=i[_e]&31;ad(e,x,Oe[at]),x+=je[at],at>3&&(ad(e,x,i[_e]>>>5&8191),x+=u0[at])}else ad(e,x,Re[i[_e]]),x+=Fe[i[_e]];return ad(e,x,Re[256]),x+Fe[256]},nk=new lh([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),g0=new Mr(0),rk=function(o,e,t,i,s,c){var u=o.length,a=new Mr(i+u+5*(1+Math.ceil(u/7e3))+s),m=a.subarray(i,a.length-s),A=0;if(!e||u<8)for(var x=0;x<=u;x+=65535){var b=x+65535;b<u?A=lm(m,A,o.subarray(x,b)):(m[x]=c,A=lm(m,A,o.subarray(x,u)))}else{for(var I=nk[e-1],E=I>>>13,T=I&8191,U=(1<<t)-1,P=new Tr(32768),R=new Tr(U+1),X=Math.ceil(t/3),G=2*X,J=function(Dt){return(o[Dt]^o[Dt+1]<<X^o[Dt+2]<<G)&U},q=new lh(25e3),te=new Tr(288),ue=new Tr(32),_e=0,K=0,x=0,ce=0,Ve=0,Ne=0;x<u;++x){var Me=J(x),ve=x&32767,ke=R[Me];if(P[ve]=ke,R[Me]=ve,Ve<=x){var Re=u-x;if((_e>7e3||ce>24576)&&Re>423){A=HS(o,m,0,q,te,ue,K,ce,Ne,x-Ne,A),ce=_e=K=0,Ne=x;for(var Fe=0;Fe<286;++Fe)te[Fe]=0;for(var Fe=0;Fe<30;++Fe)ue[Fe]=0}var Oe=2,je=0,Je=T,_t=ve-ke&32767;if(Re>2&&Me==J(x-_t))for(var yt=Math.min(E,Re)-1,qe=Math.min(32767,x),Ye=Math.min(258,Re);_t<=qe&&--Je&&ve!=ke;){if(o[x+Oe]==o[x+Oe-_t]){for(var at=0;at<Ye&&o[x+at]==o[x+at-_t];++at);if(at>Oe){if(Oe=at,je=_t,at>yt)break;for(var St=Math.min(_t,at-2),Te=0,Fe=0;Fe<St;++Fe){var Kt=x-_t+Fe+32768&32767,Zt=P[Kt],be=Kt-Zt+32768&32767;be>Te&&(Te=be,ke=Kt)}}}ve=ke,ke=P[ve],_t+=ve-ke+32768&32767}if(je){q[ce++]=268435456|d0[Oe]<<18|zS[je];var $e=d0[Oe]&31,fi=zS[je]&31;K+=h0[$e]+u0[fi],++te[257+$e],++ue[fi],Ve=x+Oe,++_e}else q[ce++]=o[x],++te[o[x]]}}A=HS(o,m,c,q,te,ue,K,ce,Ne,x-Ne,A),!c&&A&7&&(A=lm(m,A+1,g0))}return QS(a,0,i+GS(A)+s)},sk=function(){for(var o=new lh(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;o[e]=t}return o}(),ak=function(){var o=-1;return{p:function(e){for(var t=o,i=0;i<e.length;++i)t=sk[t&255^e[i]]^t>>>8;o=t},d:function(){return~o}}},ok=function(o,e,t,i,s){return rk(o,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):12+e.mem,t,i,!s)},WS=function(o,e){var t={};for(var i in o)t[i]=o[i];for(var i in e)t[i]=e[i];return t},rr=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8};function lk(o,e){return ok(o,e||{},0,0)}var qS=function(o,e,t,i){for(var s in o){var c=o[s],u=e+s;c instanceof Mr?t[u]=[c,i]:Array.isArray(c)?t[u]=[c[0],WS(i,c[1])]:qS(c,u+"/",t,i)}},$S=typeof TextEncoder<"u"&&new TextEncoder,ck=typeof TextDecoder<"u"&&new TextDecoder,hk=0;try{ck.decode(g0,{stream:!0}),hk=1}catch{}function cm(o,e){if(e){for(var t=new Mr(o.length),i=0;i<o.length;++i)t[i]=o.charCodeAt(i);return t}if($S)return $S.encode(o);for(var s=o.length,c=new Mr(o.length+(o.length>>1)),u=0,a=function(b){c[u++]=b},i=0;i<s;++i){if(u+5>c.length){var m=new Mr(u+8+(s-i<<1));m.set(c),c=m}var A=o.charCodeAt(i);A<128||e?a(A):A<2048?(a(192|A>>6),a(128|A&63)):A>55295&&A<57344?(A=65536+(A&1023<<10)|o.charCodeAt(++i)&1023,a(240|A>>18),a(128|A>>12&63),a(128|A>>6&63),a(128|A&63)):(a(224|A>>12),a(128|A>>6&63),a(128|A&63))}return QS(c,0,u)}var A0=function(o){var e=0;if(o)for(var t in o){var i=o[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},jS=function(o,e,t,i,s,c,u,a){var m=i.length,A=t.extra,x=a&&a.length,b=A0(A);rr(o,e,u!=null?33639248:67324752),e+=4,u!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(c==null&&8),o[e++]=s&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var I=new Date(t.mtime==null?Date.now():t.mtime),E=I.getFullYear()-1980;if(E<0||E>119)throw"date not in range 1980-2099";if(rr(o,e,E<<25|I.getMonth()+1<<21|I.getDate()<<16|I.getHours()<<11|I.getMinutes()<<5|I.getSeconds()>>>1),e+=4,c!=null&&(rr(o,e,t.crc),rr(o,e+4,c),rr(o,e+8,t.size)),rr(o,e+12,m),rr(o,e+14,b),e+=16,u!=null&&(rr(o,e,x),rr(o,e+6,t.attrs),rr(o,e+10,u),e+=14),o.set(i,e),e+=m,b)for(var T in A){var U=A[T],P=U.length;rr(o,e,+T),rr(o,e+2,P),o.set(U,e+4),e+=4+P}return x&&(o.set(a,e),e+=x),e},uk=function(o,e,t,i,s){rr(o,e,101010256),rr(o,e+8,t),rr(o,e+10,t),rr(o,e+12,i),rr(o,e+16,s)};function dk(o,e){e||(e={});var t={},i=[];qS(o,"",t,e);var s=0,c=0;for(var u in t){var a=t[u],m=a[0],A=a[1],x=A.level==0?0:8,b=cm(u),I=b.length,E=A.comment,T=E&&cm(E),U=T&&T.length,P=A0(A.extra);if(I>65535)throw"filename too long";var R=x?lk(m,A):m,X=R.length,G=ak();G.p(m),i.push(WS(A,{size:m.length,crc:G.d(),c:R,f:b,m:T,u:I!=u.length||T&&E.length!=U,o:s,compression:x})),s+=30+I+P+X,c+=76+2*(I+P)+(U||0)+X}for(var J=new Mr(c+22),q=s,te=c-s,ue=0;ue<i.length;++ue){var b=i[ue];jS(J,b.o,b,b.f,b.u,b.c.length);var _e=30+b.f.length+A0(b.extra);J.set(b.c,b.o+_e),jS(J,s,b,b.f,b.u,b.c.length,b.o,b.m),s+=16+_e+(b.m?b.m.length:0)}return uk(J,s,i.length,te,q),J}class pk{parse(e){return Jt(this,arguments,function*(t,i={}){i=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}}},i);const s={},c="model.usda";s[c]=null;let u=XS();u+=mk(i);const a={},m={};t.traverseVisible(x=>{if(x.isMesh){const b=x.geometry,I=x.material;if(I.isMeshStandardMaterial){const E="geometries/Geometry_"+b.id+".usd";if(!(E in s)){const T=yk(b);s[E]=Ak(T)}I.uuid in a||(a[I.uuid]=I),u+=_k(x,b,I)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",x)}else x.isCamera&&(u+=Ik(x))}),u+=gk(),u+=Ek(a,m),s[c]=cm(u),u=null;for(const x in m){const b=m[x],I=x.split("_")[1],E=b.format===1023,T=fk(b.image,I,b.flipY),U=yield new Promise(P=>T.toBlob(P,E?"image/png":"image/jpeg",1));s[`textures/Texture_${x}.${E?"png":"jpg"}`]=new Uint8Array(yield U.arrayBuffer())}let A=0;for(const x in s){const b=s[x];A+=34+x.length;const I=A&63;if(I!==4){const E=64-I,T=new Uint8Array(E);s[x]=[b,{extra:{12345:T}}]}A=b.length}return dk(s,{level:0})})}}function fk(o,e,t){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const i=document.createElement("canvas");i.width=o.width,i.height=o.height;const s=i.getContext("2d");if(t===!0&&(s.translate(0,i.height),s.scale(1,-1)),s.drawImage(o,0,0,i.width,i.height),e!==void 0){const c=parseInt(e,16),u=(c>>16&255)/255,a=(c>>8&255)/255,m=(c&255)/255,A=s.getImageData(0,0,i.width,i.height),x=A.data;for(let b=0;b<x.length;b+=4)x[b+0]=x[b+0]*u,x[b+1]=x[b+1]*a,x[b+2]=x[b+2]*m;s.putImageData(A,0,0)}return i}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const Br=7;function XS(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Three.js USDZExporter"
    }
    metersPerUnit = 1
    upAxis = "Y"
)

`}function mk(o){return`def Xform "Root"
{
    def Scope "Scenes" (
        kind = "sceneLibrary"
    )
    {
        def Xform "Scene" (
            customData = {
                bool preliminary_collidesWithEnvironment = 0
                string sceneName = "Scene"
            }
            sceneName = "Scene"
        )
        {
        token preliminary:anchoring:type = "${o.ar.anchoring.type}"
        token preliminary:planeAnchoring:alignment = "${o.ar.planeAnchoring.alignment}"

`}function gk(){return`
        }
    }
}

`}function Ak(o){let e=XS();return e+=o,cm(e)}function _k(o,e,t){const i="Object_"+o.id,s=YS(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",o),`def Xform "${i}" (
    prepend references = @./geometries/Geometry_${e.id}.usd@</Geometry>
)
{
    matrix4d xformOp:transform = ${s}
    uniform token[] xformOpOrder = ["xformOp:transform"]

    rel material:binding = </Materials/Material_${t.id}>
}

`}function YS(o){const e=o.elements;return`( ${hm(e,0)}, ${hm(e,4)}, ${hm(e,8)}, ${hm(e,12)} )`}function hm(o,e){return`(${o[e+0]}, ${o[e+1]}, ${o[e+2]}, ${o[e+3]})`}function yk(o){return`
def "Geometry"
{
  ${xk(o)}
}
`}function xk(o){const e="Geometry",t=o.attributes,i=t.position.count;return`
    def Mesh "${e}"
    {
        int[] faceVertexCounts = [${vk(o)}]
        int[] faceVertexIndices = [${bk(o)}]
        normal3f[] normals = [${KS(t.normal,i)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${KS(t.position,i)}]
        float2[] primvars:st = [${wk(t.uv,i)}] (
            interpolation = "vertex"
        )
        uniform token subdivisionScheme = "none"
    }
`}function vk(o){const e=o.index!==null?o.index.count:o.attributes.position.count;return Array(e/3).fill(3).join(", ")}function bk(o){const e=o.index,t=[];if(e!==null)for(let i=0;i<e.count;i++)t.push(e.getX(i));else{const i=o.attributes.position.count;for(let s=0;s<i;s++)t.push(s)}return t.join(", ")}function KS(o,e){if(o===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let i=0;i<o.count;i++){const s=o.getX(i),c=o.getY(i),u=o.getZ(i);t.push(`(${s.toPrecision(Br)}, ${c.toPrecision(Br)}, ${u.toPrecision(Br)})`)}return t.join(", ")}function wk(o,e){if(o===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const t=[];for(let i=0;i<o.count;i++){const s=o.getX(i),c=o.getY(i);t.push(`(${s.toPrecision(Br)}, ${1-c.toPrecision(Br)})`)}return t.join(", ")}function Ek(o,e){const t=[];for(const i in o){const s=o[i];t.push(Sk(s,e))}return`def "Materials"
{
${t.join("")}
}

`}function Sk(o,e){const t="            ",i=[],s=[];function c(u,a,m){const A=u.id+(m?"_"+m.getHexString():""),x=u.format===1023;return e[A]=u,`
        def Shader "Transform2d_${a}" (
            sdrMetadata = {
                string role = "math"
            }
        )
        {
            uniform token info:id = "UsdTransform2d"
            float2 inputs:in.connect = </Materials/Material_${o.id}/uvReader_st.outputs:result>
            float2 inputs:scale = ${JS(u.repeat)}
            float2 inputs:translation = ${JS(u.offset)}
            float2 outputs:result
        }

        def Shader "Texture_${u.id}_${a}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/Texture_${A}.${x?"png":"jpg"}@
            float2 inputs:st.connect = </Materials/Material_${o.id}/Transform2d_${a}.outputs:result>
            token inputs:wrapS = "repeat"
            token inputs:wrapT = "repeat"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
            ${o.transparent||o.alphaTest>0?"float outputs:a":""}
        }`}return o.side===er&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",o),o.map!==null?(i.push(`${t}color3f inputs:diffuseColor.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:rgb>`),o.transparent?i.push(`${t}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:a>`):o.alphaTest>0&&(i.push(`${t}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:a>`),i.push(`${t}float inputs:opacityThreshold = ${o.alphaTest}`)),s.push(c(o.map,"diffuse",o.color))):i.push(`${t}color3f inputs:diffuseColor = ${ZS(o.color)}`),o.emissiveMap!==null?(i.push(`${t}color3f inputs:emissiveColor.connect = </Materials/Material_${o.id}/Texture_${o.emissiveMap.id}_emissive.outputs:rgb>`),s.push(c(o.emissiveMap,"emissive"))):o.emissive.getHex()>0&&i.push(`${t}color3f inputs:emissiveColor = ${ZS(o.emissive)}`),o.normalMap!==null&&(i.push(`${t}normal3f inputs:normal.connect = </Materials/Material_${o.id}/Texture_${o.normalMap.id}_normal.outputs:rgb>`),s.push(c(o.normalMap,"normal"))),o.aoMap!==null&&(i.push(`${t}float inputs:occlusion.connect = </Materials/Material_${o.id}/Texture_${o.aoMap.id}_occlusion.outputs:r>`),s.push(c(o.aoMap,"occlusion"))),o.roughnessMap!==null&&o.roughness===1?(i.push(`${t}float inputs:roughness.connect = </Materials/Material_${o.id}/Texture_${o.roughnessMap.id}_roughness.outputs:g>`),s.push(c(o.roughnessMap,"roughness"))):i.push(`${t}float inputs:roughness = ${o.roughness}`),o.metalnessMap!==null&&o.metalness===1?(i.push(`${t}float inputs:metallic.connect = </Materials/Material_${o.id}/Texture_${o.metalnessMap.id}_metallic.outputs:b>`),s.push(c(o.metalnessMap,"metallic"))):i.push(`${t}float inputs:metallic = ${o.metalness}`),o.alphaMap!==null?(i.push(`${t}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.alphaMap.id}_opacity.outputs:r>`),i.push(`${t}float inputs:opacityThreshold = 0.0001`),s.push(c(o.alphaMap,"opacity"))):i.push(`${t}float inputs:opacity = ${o.opacity}`),o.isMeshPhysicalMaterial&&(i.push(`${t}float inputs:clearcoat = ${o.clearcoat}`),i.push(`${t}float inputs:clearcoatRoughness = ${o.clearcoatRoughness}`),i.push(`${t}float inputs:ior = ${o.ior}`)),`
    def Material "Material_${o.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${i.join(`
`)}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }

        token outputs:surface.connect = </Materials/Material_${o.id}/PreviewSurface.outputs:surface>
        token inputs:frame:stPrimvarName = "st"

        def Shader "uvReader_st"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            token inputs:varname.connect = </Materials/Material_${o.id}.inputs:frame:stPrimvarName>
            float2 inputs:fallback = (0.0, 0.0)
            float2 outputs:result
        }

${s.join(`
`)}

    }
`}function ZS(o){return`(${o.r}, ${o.g}, ${o.b})`}function JS(o){return`(${o.x}, ${o.y})`}function Ik(o){const e=o.name?o.name:"Camera_"+o.id,t=YS(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",o),o.isOrthographicCamera?`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${t}
			uniform token[] xformOpOrder = ["xformOp:transform"]
	
			float2 clippingRange = (${o.near.toPrecision(Br)}, ${o.far.toPrecision(Br)})
			float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(Br)}
			float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(Br)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${t}
			uniform token[] xformOpOrder = ["xformOp:transform"]
	
			float2 clippingRange = (${o.near.toPrecision(Br)}, ${o.far.toPrecision(Br)})
			float focalLength = ${o.getFocalLength().toPrecision(Br)}
			float focusDistance = ${o.focus.toPrecision(Br)}
			float horizontalAperture = ${o.getFilmWidth().toPrecision(Br)}
			token projection = "perspective"
			float verticalAperture = ${o.getFilmHeight().toPrecision(Br)}
		}
	
	`}/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const Ck=o=>e=>{try{const t=Io(e),i=(t.length?t[0].terms:[]).filter(c=>c&&c.type==="ident").map(c=>c.value).filter(c=>o.indexOf(c)>-1),s=new Set;for(const c of i)s.add(c);return s}catch{}return new Set};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var ch=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};let eI=!1,tI=!1;const iI="#model-viewer-no-ar-fallback",Mk=Ck(["quick-look","scene-viewer","webxr","none"]),Tk="webxr scene-viewer quick-look",Ss={QUICK_LOOK:"quick-look",SCENE_VIEWER:"scene-viewer",WEBXR:"webxr",NONE:"none"},qa=Symbol("arButtonContainer"),nI=Symbol("enterARWithWebXR"),rI=Symbol("openSceneViewer"),sI=Symbol("openIOSARQuickLook"),Bk=Symbol("canActivateAR"),um=Symbol("arMode"),_0=Symbol("arModes"),hh=Symbol("arAnchor"),dm=Symbol("preload"),pm=Symbol("onARButtonContainerClick"),y0=Symbol("onARStatus"),x0=Symbol("onARTracking"),v0=Symbol("onARTap"),ld=Symbol("selectARMode"),b0=Symbol("triggerLoad"),Rk=o=>{var e,t,i,s,c,u,a,m,A,x;class b extends o{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arPlacement="floor",this.arModes=Tk,this.iosSrc=null,this.xrEnvironment=!1,this[e]=!1,this[t]=this.shadowRoot.querySelector(".ar-button"),this[i]=document.createElement("a"),this[s]=new Set,this[c]=Ss.NONE,this[u]=!1,this[a]=E=>{E.preventDefault(),this.activateAR()},this[m]=({status:E})=>{(E===To.NOT_PRESENTING||this[$i].arRenderer.presentedScene===this[Mt])&&(this.setAttribute("ar-status",E),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:E}})),E===To.NOT_PRESENTING?this.removeAttribute("ar-tracking"):E===To.SESSION_STARTED&&this.setAttribute("ar-tracking",B_.TRACKING))},this[A]=({status:E})=>{this.setAttribute("ar-tracking",E),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:E}}))},this[x]=E=>{E.data=="_apple_ar_quicklook_button_tapped"&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[um]!==Ss.NONE}connectedCallback(){super.connectedCallback(),this[$i].arRenderer.addEventListener("status",this[y0]),this.setAttribute("ar-status",To.NOT_PRESENTING),this[$i].arRenderer.addEventListener("tracking",this[x0]),this[hh].addEventListener("message",this[v0])}disconnectedCallback(){super.disconnectedCallback(),this[$i].arRenderer.removeEventListener("status",this[y0]),this[$i].arRenderer.removeEventListener("tracking",this[x0]),this[hh].removeEventListener("message",this[v0])}update(E){super.update(E),E.has("arScale")&&(this[Mt].canScale=this.arScale!=="fixed"),E.has("arPlacement")&&(this[Mt].updateShadow(),this[Hr]()),E.has("arModes")&&(this[_0]=Mk(this.arModes)),(E.has("ar")||E.has("arModes")||E.has("src")||E.has("iosSrc"))&&this[ld]()}activateAR(){return Jt(this,null,function*(){switch(this[um]){case Ss.QUICK_LOOK:this[sI]();break;case Ss.WEBXR:yield this[nI]();break;case Ss.SCENE_VIEWER:this[rI]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities");break}})}[(e=Bk,t=qa,i=hh,s=_0,c=um,u=dm,a=pm,m=y0,A=x0,x=v0,ld)](){return Jt(this,null,function*(){let E=Ss.NONE;if(this.ar){if(this.src!=null)for(const T of this[_0]){if(T==="webxr"&&Pb&&!eI&&(yield this[$i].arRenderer.supportsPresentation())){E=Ss.WEBXR;break}if(T==="scene-viewer"&&LP&&!tI){E=Ss.SCENE_VIEWER;break}if(T==="quick-look"&&Fb){E=Ss.QUICK_LOOK;break}}E===Ss.NONE&&this.iosSrc!=null&&Fb&&(E=Ss.QUICK_LOOK)}if(E!==Ss.NONE)this[qa].classList.add("enabled"),this[qa].addEventListener("click",this[pm]);else if(this[qa].classList.contains("enabled")){this[qa].removeEventListener("click",this[pm]),this[qa].classList.remove("enabled");const T=To.FAILED;this.setAttribute("ar-status",T),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:T}}))}this[um]=E})}[nI](){return Jt(this,null,function*(){console.log("Attempting to present in AR with WebXR..."),yield this[b0]();try{this[qa].removeEventListener("click",this[pm]);const{arRenderer:E}=this[$i];E.placeOnWall=this.arPlacement==="wall",yield E.present(this[Mt],this.xrEnvironment)}catch(E){console.warn("Error while trying to present in AR with WebXR"),console.error(E),yield this[$i].arRenderer.stopPresenting(),eI=!0,console.warn("Falling back to next ar-mode"),yield this[ld](),this.activateAR()}finally{this[ld]()}})}[b0](){return Jt(this,null,function*(){this.loaded||(this[dm]=!0,this[ah](),yield NP(this,"load"),this[dm]=!1)})}[oh](){return super[oh]()||this[dm]}[rI](){const E=self.location.toString(),T=new URL(E),U=new URL(this.src,E);U.hash&&(U.hash="");const P=new URLSearchParams(U.search);if(T.hash=iI,P.set("mode","ar_preferred"),P.has("disable_occlusion")||P.set("disable_occlusion","true"),this.arScale==="fixed"&&P.set("resizable","false"),this.arPlacement==="wall"&&P.set("enable_vertical_placement","true"),P.has("sound")){const G=new URL(P.get("sound"),E);P.set("sound",G.toString())}if(P.has("link")){const G=new URL(P.get("link"),E);P.set("link",G.toString())}const R=`intent://arvr.google.com/scene-viewer/1.0?${P.toString()+"&file="+encodeURIComponent(U.toString())}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(T.toString())};end;`,X=()=>{self.location.hash===iI&&(tI=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[ld]())};self.addEventListener("hashchange",X,{once:!0}),this[hh].setAttribute("href",R),console.log("Attempting to present in AR with Scene Viewer..."),this[hh].click()}[sI](){return Jt(this,null,function*(){const E=!this.iosSrc;this[qa].classList.remove("enabled");const T=E?yield this.prepareUSDZ():this.iosSrc,U=new URL(T,self.location.toString());if(E){const X=self.location.toString(),G=new URL(X),J=new URL(this.src,G);J.hash&&(U.hash=J.hash)}this.arScale==="fixed"&&(U.hash&&(U.hash+="&"),U.hash+="allowsContentScaling=0");const P=this[hh];P.setAttribute("rel","ar");const R=document.createElement("img");P.appendChild(R),P.setAttribute("href",U.toString()),E&&P.setAttribute("download","model.usdz"),P.style.display="none",P.isConnected||this.shadowRoot.appendChild(P),console.log("Attempting to present in AR with Quick Look..."),P.click(),P.removeChild(R),E&&URL.revokeObjectURL(T),this[qa].classList.add("enabled")})}prepareUSDZ(){return Jt(this,null,function*(){const E=this[Tl].beginActivity();yield this[b0]();const{model:T,shadow:U}=this[Mt];if(T==null)return"";let P=!1;U!=null&&(P=U.visible,U.visible=!1),E(.2);const R=yield new pk().parse(T),X=new Blob([R],{type:"model/vnd.usdz+zip"}),G=URL.createObjectURL(X);return E(1),U!=null&&(U.visible=P),G})}}return ch([ui({type:Boolean,attribute:"ar"})],b.prototype,"ar",void 0),ch([ui({type:String,attribute:"ar-scale"})],b.prototype,"arScale",void 0),ch([ui({type:String,attribute:"ar-placement"})],b.prototype,"arPlacement",void 0),ch([ui({type:String,attribute:"ar-modes"})],b.prototype,"arModes",void 0),ch([ui({type:String,attribute:"ios-src"})],b.prototype,"iosSrc",void 0),ch([ui({type:Boolean,attribute:"xr-environment"})],b.prototype,"xrEnvironment",void 0),b};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var w0=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};const Lk=100,Dk="https://www.gstatic.com/draco/versioned/decoders/1.5.6/",Pk="https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/",Uk="https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js",E0={AUTO:"auto",MANUAL:"manual"},aI={AUTO:"auto",LAZY:"lazy",EAGER:"eager"},Dl=Symbol("defaultProgressBarElement"),S0=Symbol("posterContainerElement"),uh=Symbol("defaultPosterElement"),cd=Symbol("shouldDismissPoster"),I0=Symbol("hidePoster"),fm=Symbol("modelIsRevealed"),C0=Symbol("updateProgressBar"),Fk=Symbol("ariaLabelCallToAction"),M0=Symbol("onProgress"),kk=o=>{var e,t,i,s,c,u,a,m;class A extends o{constructor(...b){super(...b),this.poster=null,this.reveal=E0.AUTO,this.loading=aI.AUTO,this[e]=!1,this[t]=!1,this[i]=this.shadowRoot.querySelector(".slot.poster"),this[s]=this.shadowRoot.querySelector("#default-poster"),this[c]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[u]=this[uh].getAttribute("aria-label"),this[a]=UP(P=>{const R=this[Dl].parentNode;requestAnimationFrame(()=>{this[Dl].style.transform=`scaleX(${P})`,P===0&&(R.removeChild(this[Dl]),R.appendChild(this[Dl])),P===1?this[Dl].classList.add("hide"):this[Dl].classList.remove("hide")})},Lk),this[m]=P=>{const R=P.detail.totalProgress;R===1&&(this[C0].flush(),this.loaded&&(this[cd]||this.reveal===E0.AUTO)&&this[I0]()),this[C0](R),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:R}}))};const I=self.ModelViewerElement||{},E=I.dracoDecoderLocation||Dk;Wn.setDRACODecoderLocation(E);const T=I.ktx2TranscoderLocation||Pk;Wn.setKTX2TranscoderLocation(T),I.meshoptDecoderLocation&&Wn.setMeshoptDecoderLocation(I.meshoptDecoderLocation);const U=I.lottieLoaderLocation||Uk;bs.singleton.textureUtils.lottieLoaderUrl=U}static set dracoDecoderLocation(b){Wn.setDRACODecoderLocation(b)}static get dracoDecoderLocation(){return Wn.getDRACODecoderLocation()}static set ktx2TranscoderLocation(b){Wn.setKTX2TranscoderLocation(b)}static get ktx2TranscoderLocation(){return Wn.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(b){Wn.setMeshoptDecoderLocation(b)}static get meshoptDecoderLocation(){return Wn.getMeshoptDecoderLocation()}static set lottieLoaderLocation(b){bs.singleton.textureUtils.lottieLoaderUrl=b}static get lottieLoaderLocation(){return bs.singleton.textureUtils.lottieLoaderUrl}static mapURLs(b){bs.singleton.loader[xl].manager.setURLModifier(b)}dismissPoster(){this.loaded?this[I0]():(this[cd]=!0,this[ah]())}showPoster(){const b=this[S0];if(b.classList.contains("show"))return;b.classList.add("show"),this[ga].classList.remove("show");const I=this[uh];I.removeAttribute("tabindex"),I.removeAttribute("aria-hidden");const E=this.modelIsVisible;this[fm]=!1,this[sm](E)}getDimensions(){return Po(this[Mt].size)}getBoundingBoxCenter(){return Po(this[Mt].boundingBox.getCenter(new we))}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[Tl].addEventListener("progress",this[M0])}disconnectedCallback(){super.disconnectedCallback(),this[Tl].removeEventListener("progress",this[M0])}updated(b){return Jt(this,null,function*(){FA(A.prototype,this,"updated").call(this,b),b.has("poster")&&this.poster!=null&&(this[uh].style.backgroundImage=`url(${this.poster})`),b.has("alt")&&this[uh].setAttribute("aria-label",this[n0]),(b.has("reveal")||b.has("loading"))&&this[ah]()})}[(e=fm,t=cd,i=S0,s=uh,c=Dl,u=Fk,a=C0,m=M0,oh)](){return!!this.src&&(this[cd]||this.loading===aI.EAGER||this.reveal===E0.AUTO&&this[Ml])}[I0](){this[cd]=!1;const b=this[S0];if(!b.classList.contains("show"))return;b.classList.remove("show"),this[ga].classList.add("show");const I=this.modelIsVisible;this[fm]=!0,this[sm](I);const E=this.getRootNode();E&&E.activeElement===this&&this[ga].focus();const T=this[uh];T.setAttribute("aria-hidden","true"),T.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[Bl](){return super[Bl]()&&this[fm]}}return w0([ui({type:String})],A.prototype,"poster",void 0),w0([ui({type:String})],A.prototype,"reveal",void 0),w0([ui({type:String})],A.prototype,"loading",void 0),A};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var T0=function(o,e,t,i){for(var s=arguments.length,c=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,u,a=o.length-1;a>=0;a--)(u=o[a])&&(c=(s<3?u(c):s>3?u(e,t,c):u(e,t))||c);return s>3&&c&&Object.defineProperty(e,t,c),c};const Nk=Math.PI/32,Ok=3e3,zk={basis:[Lf(fr(Nk,"rad"))],keywords:{auto:[null]}},dh=Symbol("autoRotateStartTime"),B0=Symbol("radiansPerSecond"),oI=Symbol("syncRotationRate"),R0=Symbol("onCameraChange"),Gk=o=>{var e,t,i;class s extends o{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=Ok,this.rotationPerSecond="auto",this[e]=performance.now(),this[t]=0,this[i]=u=>{!this.autoRotate||u.detail.source==="user-interaction"&&(this[dh]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[R0]),this[dh]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[R0]),this[dh]=performance.now()}updated(u){super.updated(u),u.has("autoRotate")&&(this[dh]=performance.now())}[(e=dh,t=B0,oI)](u){this[B0]=u[0]}[Aa](u,a){if(super[Aa](u,a),!this.autoRotate||!this[Bl]()||this[$i].isPresenting)return;const m=Math.min(a,u-this[dh]-this.autoRotateDelay);m>0&&(this[Mt].yaw=this.turntableRotation+this[B0]*m*.001)}get turntableRotation(){return this[Mt].yaw}resetTurntableRotation(u=0){this[Mt].yaw=u}}return i=R0,T0([ui({type:Boolean,attribute:"auto-rotate"})],s.prototype,"autoRotate",void 0),T0([ui({type:Number,attribute:"auto-rotate-delay"})],s.prototype,"autoRotateDelay",void 0),T0([Mo({intrinsics:zk,updateHandler:oI}),ui({type:String,attribute:"rotation-per-second"})],s.prototype,"rotationPerSecond",void 0),s};/* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const lI=Z4(U4(Gk(VP(YF(Rk(kk(K4(nd))))))));customElements.define("model-viewer",lI);const cI={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class L0{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Kk(e)}),this.register(function(e){return new Zk(e)}),this.register(function(e){return new t5(e)}),this.register(function(e){return new i5(e)}),this.register(function(e){return new n5(e)}),this.register(function(e){return new r5(e)}),this.register(function(e){return new Jk(e)}),this.register(function(e){return new e5(e)}),this.register(function(e){return new s5(e)}),this.register(function(e){return new a5(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const c=new Yk,u=[];for(let a=0,m=this.pluginCallbacks.length;a<m;a++)u.push(this.pluginCallbacks[a](c));c.setPlugins(u),c.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(s,c){i.parse(e,s,c,t)})}}const Ti={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},D0="KHR_mesh_quantization",rs={};rs[Pn]=Ti.NEAREST,rs[ou]=Ti.NEAREST_MIPMAP_NEAREST,rs[ac]=Ti.NEAREST_MIPMAP_LINEAR,rs[dn]=Ti.LINEAR,rs[Fp]=Ti.LINEAR_MIPMAP_NEAREST,rs[Os]=Ti.LINEAR_MIPMAP_LINEAR,rs[tr]=Ti.CLAMP_TO_EDGE,rs[aa]=Ti.REPEAT,rs[sc]=Ti.MIRRORED_REPEAT;const hI={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},Qk=new hi,uI=12,Vk=1179937895,Hk=2,dI=8,Wk=1313821514,qk=5130562;function hd(o,e){return o.length===e.length&&o.every(function(t,i){return t===e[i]})}function $k(o){return new TextEncoder().encode(o).buffer}function jk(o){return hd(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Xk(o,e,t){const i={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let c=0;c<o.itemSize;c++){let u;o.itemSize>4?u=o.array[s*o.itemSize+c]:(c===0?u=o.getX(s):c===1?u=o.getY(s):c===2?u=o.getZ(s):c===3&&(u=o.getW(s)),o.normalized===!0&&(u=cl.normalize(u,o.array))),i.min[c]=Math.min(i.min[c],u),i.max[c]=Math.max(i.max[c],u)}return i}function pI(o){return Math.ceil(o/4)*4}function P0(o,e=0){const t=pI(o.byteLength);if(t!==o.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(o)),e!==0)for(let s=o.byteLength;s<t;s++)i[s]=e;return i.buffer}return o}function fI(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function mI(o,e){if(o.toBlob!==void 0)return new Promise(i=>o.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),o.convertToBlob({type:e,quality:t})}class Yk{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,c=s.buffers,u=s.json;i=s.options;const a=s.extensionsUsed,m=s.extensionsRequired,A=new Blob(c,{type:"application/octet-stream"}),x=Object.keys(a),b=Object.keys(m);if(x.length>0&&(u.extensionsUsed=x),b.length>0&&(u.extensionsRequired=b),u.buffers&&u.buffers.length>0&&(u.buffers[0].byteLength=A.size),i.binary===!0){const I=new FileReader;I.readAsArrayBuffer(A),I.onloadend=function(){const E=P0(I.result),T=new DataView(new ArrayBuffer(dI));T.setUint32(0,E.byteLength,!0),T.setUint32(4,qk,!0);const U=P0($k(JSON.stringify(u)),32),P=new DataView(new ArrayBuffer(dI));P.setUint32(0,U.byteLength,!0),P.setUint32(4,Wk,!0);const R=new ArrayBuffer(uI),X=new DataView(R);X.setUint32(0,Vk,!0),X.setUint32(4,Hk,!0);const G=uI+P.byteLength+U.byteLength+T.byteLength+E.byteLength;X.setUint32(8,G,!0);const J=new Blob([R,P,U,T,E],{type:"application/octet-stream"}),q=new FileReader;q.readAsArrayBuffer(J),q.onloadend=function(){t(q.result)}}}else if(u.buffers&&u.buffers.length>0){const I=new FileReader;I.readAsDataURL(A),I.onloadend=function(){const E=I.result;u.buffers[0].uri=E,t(u)}}else t(u)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const c=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&c.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const u in c.gltfExtensions)t.extensions[u]=c.gltfExtensions[u],s[u]=!0;delete c.gltfExtensions}Object.keys(c).length>0&&(t.extras=c)}catch(c){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+c.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new we;for(let s=0,c=e.count;s<c;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new we;for(let c=0,u=i.count;c<u;c++)s.fromBufferAttribute(i,c),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(c,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(s.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(E){return E.colorSpace===ni?function(U){return U<.04045?U*.0773993808:Math.pow(U*.9478672986+.0521327014,2.4)}:function(U){return U}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=e?e.image:null,c=t?t.image:null,u=Math.max(s?s.width:0,c?c.width:0),a=Math.max(s?s.height:0,c?c.height:0),m=fI();m.width=u,m.height=a;const A=m.getContext("2d");A.fillStyle="#00ffff",A.fillRect(0,0,u,a);const x=A.getImageData(0,0,u,a);if(s){A.drawImage(s,0,0,u,a);const E=i(e),T=A.getImageData(0,0,u,a).data;for(let U=2;U<T.length;U+=4)x.data[U]=E(T[U]/256)*256}if(c){A.drawImage(c,0,0,u,a);const E=i(t),T=A.getImageData(0,0,u,a).data;for(let U=1;U<T.length;U+=4)x.data[U]=E(T[U]/256)*256}A.putImageData(x,0,0);const I=(e||t).clone();return I.source=new Gp(m),I.colorSpace=fs,I.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),I}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,c){const u=this.json;u.bufferViews||(u.bufferViews=[]);let a;switch(t){case Ti.BYTE:case Ti.UNSIGNED_BYTE:a=1;break;case Ti.SHORT:case Ti.UNSIGNED_SHORT:a=2;break;default:a=4}const m=pI(s*e.itemSize*a),A=new DataView(new ArrayBuffer(m));let x=0;for(let E=i;E<i+s;E++)for(let T=0;T<e.itemSize;T++){let U;e.itemSize>4?U=e.array[E*e.itemSize+T]:(T===0?U=e.getX(E):T===1?U=e.getY(E):T===2?U=e.getZ(E):T===3&&(U=e.getW(E)),e.normalized===!0&&(U=cl.normalize(U,e.array))),t===Ti.FLOAT?A.setFloat32(x,U,!0):t===Ti.INT?A.setInt32(x,U,!0):t===Ti.UNSIGNED_INT?A.setUint32(x,U,!0):t===Ti.SHORT?A.setInt16(x,U,!0):t===Ti.UNSIGNED_SHORT?A.setUint16(x,U,!0):t===Ti.BYTE?A.setInt8(x,U):t===Ti.UNSIGNED_BYTE&&A.setUint8(x,U),x+=a}const b={buffer:this.processBuffer(A.buffer),byteOffset:this.byteOffset,byteLength:m};return c!==void 0&&(b.target=c),c===Ti.ARRAY_BUFFER&&(b.byteStride=e.itemSize*a),this.byteOffset+=m,u.bufferViews.push(b),{id:u.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const c=new FileReader;c.readAsArrayBuffer(e),c.onloadend=function(){const u=P0(c.result),a={buffer:t.processBuffer(u),byteOffset:t.byteOffset,byteLength:u.byteLength};t.byteOffset+=u.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,s){const c=this.json,u={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Ti.FLOAT;else if(e.array.constructor===Int32Array)a=Ti.INT;else if(e.array.constructor===Uint32Array)a=Ti.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=Ti.SHORT;else if(e.array.constructor===Uint16Array)a=Ti.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=Ti.BYTE;else if(e.array.constructor===Uint8Array)a=Ti.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(i===void 0&&(i=0),s===void 0&&(s=e.count),s===0)return null;const m=Xk(e,i,s);let A;t!==void 0&&(A=e===t.index?Ti.ELEMENT_ARRAY_BUFFER:Ti.ARRAY_BUFFER);const x=this.processBufferView(e,a,i,s,A),b={bufferView:x.id,byteOffset:x.byteOffset,componentType:a,count:s,max:m.max,min:m.min,type:u[e.itemSize]};return e.normalized===!0&&(b.normalized=!0),c.accessors||(c.accessors=[]),c.accessors.push(b)-1}processImage(e,t,i,s="image/png"){if(e!==null){const c=this,u=c.cache,a=c.json,m=c.options,A=c.pending;u.images.has(e)||u.images.set(e,{});const x=u.images.get(e),b=s+":flipY/"+i.toString();if(x[b]!==void 0)return x[b];a.images||(a.images=[]);const I={mimeType:s},E=fI();E.width=Math.min(e.width,m.maxTextureSize),E.height=Math.min(e.height,m.maxTextureSize);const T=E.getContext("2d");if(i===!0&&(T.translate(0,E.height),T.scale(1,-1)),e.data!==void 0){t!==Rn&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>m.maxTextureSize||e.height>m.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const P=new Uint8ClampedArray(e.height*e.width*4);for(let R=0;R<P.length;R+=4)P[R+0]=e.data[R+0],P[R+1]=e.data[R+1],P[R+2]=e.data[R+2],P[R+3]=e.data[R+3];T.putImageData(new ImageData(P,e.width,e.height),0,0)}else T.drawImage(e,0,0,E.width,E.height);m.binary===!0?A.push(mI(E,s).then(P=>c.processBufferViewImage(P)).then(P=>{I.bufferView=P})):E.toDataURL!==void 0?I.uri=E.toDataURL(s):A.push(mI(E,s).then(P=>new FileReader().readAsDataURL(P)).then(P=>{I.uri=P}));const U=a.images.push(I)-1;return x[b]=U,U}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:rs[e.magFilter],minFilter:rs[e.minFilter],wrapS:rs[e.wrapS],wrapT:rs[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const c={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(c.name=e.name),this._invokeAll(function(a){a.writeTexture&&a.writeTexture(e,c)});const u=i.textures.push(c)-1;return t.textures.set(e,u),u}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const c=e.color.toArray().concat([e.opacity]);if(hd(c,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=c),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),m={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(m,a),s.pbrMetallicRoughness.metallicRoughnessTexture=m}if(e.map){const a={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(a,e.map),s.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive;if(Math.max(a.r,a.g,a.b)>0&&(s.emissiveFactor=e.emissive.toArray()),e.emissiveMap){const A={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(A,e.emissiveMap),s.emissiveTexture=A}}if(e.normalMap){const a={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),s.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),s.occlusionTexture=a}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===er&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,s)});const u=i.materials.push(s)-1;return t.materials.set(e,u),u}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let G=0,J=e.material.length;G<J;G++)s.push(e.material[G].uuid);else s.push(e.material.uuid);const c=s.join(":");if(t.meshes.has(c))return t.meshes.get(c);const u=e.geometry;let a;e.isLineSegments?a=Ti.LINES:e.isLineLoop?a=Ti.LINE_LOOP:e.isLine?a=Ti.LINE_STRIP:e.isPoints?a=Ti.POINTS:a=e.material.wireframe?Ti.LINES:Ti.TRIANGLES;const m={},A={},x=[],b=[],I={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},E=u.getAttribute("normal");E!==void 0&&!this.isNormalizedNormalAttribute(E)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),u.setAttribute("normal",this.createNormalizedNormalAttribute(E)));let T=null;for(let G in u.attributes){if(G.slice(0,5)==="morph")continue;const J=u.attributes[G];if(G=I[G]||G.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(G)||(G="_"+G),t.attributes.has(this.getUID(J))){A[G]=t.attributes.get(this.getUID(J));continue}T=null;const te=J.array;G==="JOINTS_0"&&!(te instanceof Uint16Array)&&!(te instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),T=new pn(new Uint16Array(te),J.itemSize,J.normalized));const ue=this.processAccessor(T||J,u);ue!==null&&(G.startsWith("_")||this.detectMeshQuantization(G,J),A[G]=ue,t.attributes.set(this.getUID(J),ue))}if(E!==void 0&&u.setAttribute("normal",E),Object.keys(A).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const G=[],J=[],q={};if(e.morphTargetDictionary!==void 0)for(const te in e.morphTargetDictionary)q[e.morphTargetDictionary[te]]=te;for(let te=0;te<e.morphTargetInfluences.length;++te){const ue={};let _e=!1;for(const K in u.morphAttributes){if(K!=="position"&&K!=="normal"){_e||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),_e=!0);continue}const ce=u.morphAttributes[K][te],Ve=K.toUpperCase(),Ne=u.attributes[K];if(t.attributes.has(this.getUID(ce,!0))){ue[Ve]=t.attributes.get(this.getUID(ce,!0));continue}const Me=ce.clone();if(!u.morphTargetsRelative)for(let ve=0,ke=ce.count;ve<ke;ve++)for(let Re=0;Re<ce.itemSize;Re++)Re===0&&Me.setX(ve,ce.getX(ve)-Ne.getX(ve)),Re===1&&Me.setY(ve,ce.getY(ve)-Ne.getY(ve)),Re===2&&Me.setZ(ve,ce.getZ(ve)-Ne.getZ(ve)),Re===3&&Me.setW(ve,ce.getW(ve)-Ne.getW(ve));ue[Ve]=this.processAccessor(Me,u),t.attributes.set(this.getUID(Ne,!0),ue[Ve])}b.push(ue),G.push(e.morphTargetInfluences[te]),e.morphTargetDictionary!==void 0&&J.push(q[te])}m.weights=G,J.length>0&&(m.extras={},m.extras.targetNames=J)}const U=Array.isArray(e.material);if(U&&u.groups.length===0)return null;const P=U?e.material:[e.material],R=U?u.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let G=0,J=R.length;G<J;G++){const q={mode:a,attributes:A};if(this.serializeUserData(u,q),b.length>0&&(q.targets=b),u.index!==null){let ue=this.getUID(u.index);(R[G].start!==void 0||R[G].count!==void 0)&&(ue+=":"+R[G].start+":"+R[G].count),t.attributes.has(ue)?q.indices=t.attributes.get(ue):(q.indices=this.processAccessor(u.index,u,R[G].start,R[G].count),t.attributes.set(ue,q.indices)),q.indices===null&&delete q.indices}const te=this.processMaterial(P[R[G].materialIndex]);te!==null&&(q.material=te),x.push(q)}m.primitives=x,i.meshes||(i.meshes=[]),this._invokeAll(function(G){G.writeMesh&&G.writeMesh(e,m)});const X=i.meshes.push(m)-1;return t.meshes.set(c,X),X}detectMeshQuantization(e,t){if(this.extensionsUsed[D0])return;let i;switch(t.array.constructor){case Int8Array:i="byte";break;case Uint8Array:i="unsigned byte";break;case Int16Array:i="short";break;case Uint16Array:i="unsigned short";break;default:return}t.normalized&&(i+=" normalized");const s=e.split("_",1)[0];cI[s]&&cI[s].includes(i)&&(this.extensionsUsed[D0]=!0,this.extensionsRequired[D0]=!0)}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:cl.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),e=L0.Utils.mergeMorphTargetTracks(e.clone(),t);const c=e.tracks,u=[],a=[];for(let m=0;m<c.length;++m){const A=c[m],x=Si.parseTrackName(A.name);let b=Si.findNode(t,x.nodeName);const I=hI[x.propertyName];if(x.objectName==="bones"&&(b.isSkinnedMesh===!0?b=b.skeleton.getBoneByName(x.objectIndex):b=void 0),!b||!I)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',A.name),null;const E=1;let T=A.values.length/A.times.length;I===hI.morphTargetInfluences&&(T/=b.morphTargetInfluences.length);let U;A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(U="CUBICSPLINE",T/=3):A.getInterpolation()===ll?U="STEP":U="LINEAR",a.push({input:this.processAccessor(new pn(A.times,E)),output:this.processAccessor(new pn(A.values,T)),interpolation:U}),u.push({sampler:a.length-1,target:{node:s.get(b),path:I}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:u}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],c=e.skeleton;if(c===void 0)return null;const u=e.skeleton.bones[0];if(u===void 0)return null;const a=[],m=new Float32Array(c.bones.length*16),A=new pi;for(let b=0;b<c.bones.length;++b)a.push(i.get(c.bones[b])),A.copy(c.boneInverses[b]),A.multiply(e.bindMatrix).toArray(m,b*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new pn(m,16)),joints:a,skeleton:i.get(u)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const c={};if(i.trs){const a=e.quaternion.toArray(),m=e.position.toArray(),A=e.scale.toArray();hd(a,[0,0,0,1])||(c.rotation=a),hd(m,[0,0,0])||(c.translation=m),hd(A,[1,1,1])||(c.scale=A)}else e.matrixAutoUpdate&&e.updateMatrix(),jk(e.matrix)===!1&&(c.matrix=e.matrix.elements);if(e.name!==""&&(c.name=String(e.name)),this.serializeUserData(e,c),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(c.mesh=a)}else e.isCamera&&(c.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let m=0,A=e.children.length;m<A;m++){const x=e.children[m];if(x.visible||i.onlyVisible===!1){const b=this.processNode(x);b!==null&&a.push(b)}}a.length>0&&(c.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,c)});const u=t.nodes.push(c)-1;return s.set(e,u),u}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const c=[];for(let u=0,a=e.children.length;u<a;u++){const m=e.children[u];if(m.visible||i.onlyVisible===!1){const A=this.processNode(m);A!==null&&c.push(A)}}c.length>0&&(s.nodes=c),this.serializeUserData(e,s)}processObjects(e){const t=new xs;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const i=[];for(let s=0;s<e.length;s++)e[s]instanceof xs?this.processScene(e[s]):i.push(e[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}class Kk{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,s=i.json,c=i.extensionsUsed,u={};e.name&&(u.name=e.name),u.color=e.color.toArray(),u.intensity=e.intensity,e.isDirectionalLight?u.type="directional":e.isPointLight?(u.type="point",e.distance>0&&(u.range=e.distance)):e.isSpotLight&&(u.type="spot",e.distance>0&&(u.range=e.distance),u.spot={},u.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,u.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),c[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},c[this.name]=!0);const a=s.extensions[this.name].lights;a.push(u),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}class Zk{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Jk{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.clearcoat===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.clearcoatFactor=e.clearcoat,e.clearcoatMap){const u={index:i.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};i.applyTextureTransform(u,e.clearcoatMap),c.clearcoatTexture=u}if(c.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const u={index:i.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};i.applyTextureTransform(u,e.clearcoatRoughnessMap),c.clearcoatRoughnessTexture=u}if(e.clearcoatNormalMap){const u={index:i.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};i.applyTextureTransform(u,e.clearcoatNormalMap),c.clearcoatNormalTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class e5{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.iridescence===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.iridescenceFactor=e.iridescence,e.iridescenceMap){const u={index:i.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};i.applyTextureTransform(u,e.iridescenceMap),c.iridescenceTexture=u}if(c.iridescenceIor=e.iridescenceIOR,c.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],c.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const u={index:i.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};i.applyTextureTransform(u,e.iridescenceThicknessMap),c.iridescenceThicknessTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class t5{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.transmissionFactor=e.transmission,e.transmissionMap){const u={index:i.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};i.applyTextureTransform(u,e.transmissionMap),c.transmissionTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class i5{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,c={};if(c.thicknessFactor=e.thickness,e.thicknessMap){const u={index:i.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};i.applyTextureTransform(u,e.thicknessMap),c.thicknessTexture=u}c.attenuationDistance=e.attenuationDistance,c.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class n5{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.ior===1.5)return;const s=this.writer.extensionsUsed,c={};c.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class r5{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.specularIntensity===1&&e.specularColor.equals(Qk)&&!e.specularIntensityMap&&!e.specularColorTexture)return;const i=this.writer,s=i.extensionsUsed,c={};if(e.specularIntensityMap){const u={index:i.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};i.applyTextureTransform(u,e.specularIntensityMap),c.specularTexture=u}if(e.specularColorMap){const u={index:i.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};i.applyTextureTransform(u,e.specularColorMap),c.specularColorTexture=u}c.specularFactor=e.specularIntensity,c.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class s5{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen==0)return;const i=this.writer,s=i.extensionsUsed,c={};if(e.sheenRoughnessMap){const u={index:i.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};i.applyTextureTransform(u,e.sheenRoughnessMap),c.sheenRoughnessTexture=u}if(e.sheenColorMap){const u={index:i.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};i.applyTextureTransform(u,e.sheenColorMap),c.sheenColorTexture=u}c.sheenRoughnessFactor=e.sheenRoughness,c.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}class a5{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.emissiveIntensity===1)return;const s=this.writer.extensionsUsed,c={};c.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=c,s[this.name]=!0}}L0.Utils={insertKeyframe:function(o,e){const i=o.getValueSize(),s=new o.TimeBufferType(o.times.length+1),c=new o.ValueBufferType(o.values.length+i),u=o.createInterpolant(new o.ValueBufferType(i));let a;if(o.times.length===0){s[0]=e;for(let m=0;m<i;m++)c[m]=0;a=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;s[0]=e,s.set(o.times,1),c.set(u.evaluate(e),0),c.set(o.values,i),a=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;s[s.length-1]=e,s.set(o.times,0),c.set(o.values,0),c.set(u.evaluate(e),o.values.length),a=s.length-1}else for(let m=0;m<o.times.length;m++){if(Math.abs(o.times[m]-e)<.001)return m;if(o.times[m]<e&&o.times[m+1]>e){s.set(o.times.slice(0,m+1),0),s[m+1]=e,s.set(o.times.slice(m+1),m+2),c.set(o.values.slice(0,(m+1)*i),0),c.set(u.evaluate(e),(m+1)*i),c.set(o.values.slice((m+1)*i),(m+2)*i),a=m+1;break}}return o.times=s,o.values=c,a},mergeMorphTargetTracks:function(o,e){const t=[],i={},s=o.tracks;for(let c=0;c<s.length;++c){let u=s[c];const a=Si.parseTrackName(u.name),m=Si.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(u);continue}if(u.createInterpolant!==u.InterpolantFactoryMethodDiscrete&&u.createInterpolant!==u.InterpolantFactoryMethodLinear){if(u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),u=u.clone(),u.setInterpolation(uo)}const A=m.morphTargetInfluences.length,x=m.morphTargetDictionary[a.propertyIndex];if(x===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let b;if(i[m.uuid]===void 0){b=u.clone();const E=new b.ValueBufferType(A*b.times.length);for(let T=0;T<b.times.length;T++)E[T*A+x]=b.values[T];b.name=(a.nodeName||"")+".morphTargetInfluences",b.values=E,i[m.uuid]=b,t.push(b);continue}const I=u.createInterpolant(new u.ValueBufferType(1));b=i[m.uuid];for(let E=0;E<b.times.length;E++)b.values[E*A+x]=I.evaluate(b.times[E]);for(let E=0;E<u.times.length;E++){const T=this.insertKeyframe(b,u.times[E]);b.values[T*A+x]=u.values[E]}}return o.tracks=t,o}};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var gI=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))};try{URL.revokeObjectURL(gI(""))}catch{gI=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Rr=Uint8Array,Lr=Uint16Array,ph=Uint32Array,U0=new Rr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),F0=new Rr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),AI=new Rr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_I=function(o,e){for(var t=new Lr(31),i=0;i<31;++i)t[i]=e+=1<<o[i-1];for(var s=new ph(t[30]),i=1;i<30;++i)for(var c=t[i];c<t[i+1];++c)s[c]=c-t[i]<<5|i;return[t,s]},yI=_I(U0,2),o5=yI[0],k0=yI[1];o5[28]=258,k0[258]=28;for(var l5=_I(F0,0),xI=l5[1],N0=new Lr(32768),mn=0;mn<32768;++mn){var Fo=(mn&43690)>>>1|(mn&21845)<<1;Fo=(Fo&52428)>>>2|(Fo&13107)<<2,Fo=(Fo&61680)>>>4|(Fo&3855)<<4,N0[mn]=((Fo&65280)>>>8|(Fo&255)<<8)>>>1}for(var ud=function(o,e,t){for(var i=o.length,s=0,c=new Lr(e);s<i;++s)++c[o[s]-1];var u=new Lr(e);for(s=0;s<e;++s)u[s]=u[s-1]+c[s-1]<<1;var a;if(t){a=new Lr(1<<e);var m=15-e;for(s=0;s<i;++s)if(o[s])for(var A=s<<4|o[s],x=e-o[s],b=u[o[s]-1]++<<x,I=b|(1<<x)-1;b<=I;++b)a[N0[b]>>>m]=A}else for(a=new Lr(i),s=0;s<i;++s)o[s]&&(a[s]=N0[u[o[s]-1]++]>>>15-o[s]);return a},Pl=new Rr(288),mn=0;mn<144;++mn)Pl[mn]=8;for(var mn=144;mn<256;++mn)Pl[mn]=9;for(var mn=256;mn<280;++mn)Pl[mn]=7;for(var mn=280;mn<288;++mn)Pl[mn]=8;for(var mm=new Rr(32),mn=0;mn<32;++mn)mm[mn]=5;var c5=ud(Pl,9,0),h5=ud(mm,5,0),vI=function(o){return(o/8|0)+(o&7&&1)},bI=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var i=new(o instanceof Lr?Lr:o instanceof ph?ph:Rr)(t-e);return i.set(o.subarray(e,t)),i},$a=function(o,e,t){t<<=e&7;var i=e/8|0;o[i]|=t,o[i+1]|=t>>>8},dd=function(o,e,t){t<<=e&7;var i=e/8|0;o[i]|=t,o[i+1]|=t>>>8,o[i+2]|=t>>>16},O0=function(o,e){for(var t=[],i=0;i<o.length;++i)o[i]&&t.push({s:i,f:o[i]});var s=t.length,c=t.slice();if(!s)return[G0,0];if(s==1){var u=new Rr(t[0].s+1);return u[t[0].s]=1,[u,1]}t.sort(function(q,te){return q.f-te.f}),t.push({s:-1,f:25001});var a=t[0],m=t[1],A=0,x=1,b=2;for(t[0]={s:-1,f:a.f+m.f,l:a,r:m};x!=s-1;)a=t[t[A].f<t[b].f?A++:b++],m=t[A!=x&&t[A].f<t[b].f?A++:b++],t[x++]={s:-1,f:a.f+m.f,l:a,r:m};for(var I=c[0].s,i=1;i<s;++i)c[i].s>I&&(I=c[i].s);var E=new Lr(I+1),T=z0(t[x-1],E,0);if(T>e){var i=0,U=0,P=T-e,R=1<<P;for(c.sort(function(te,ue){return E[ue.s]-E[te.s]||te.f-ue.f});i<s;++i){var X=c[i].s;if(E[X]>e)U+=R-(1<<T-E[X]),E[X]=e;else break}for(U>>>=P;U>0;){var G=c[i].s;E[G]<e?U-=1<<e-E[G]++-1:++i}for(;i>=0&&U;--i){var J=c[i].s;E[J]==e&&(--E[J],++U)}T=e}return[new Rr(E),T]},z0=function(o,e,t){return o.s==-1?Math.max(z0(o.l,e,t+1),z0(o.r,e,t+1)):e[o.s]=t},wI=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new Lr(++e),i=0,s=o[0],c=1,u=function(m){t[i++]=m},a=1;a<=e;++a)if(o[a]==s&&a!=e)++c;else{if(!s&&c>2){for(;c>138;c-=138)u(32754);c>2&&(u(c>10?c-11<<5|28690:c-3<<5|12305),c=0)}else if(c>3){for(u(s),--c;c>6;c-=6)u(8304);c>2&&(u(c-3<<5|8208),c=0)}for(;c--;)u(s);c=1,s=o[a]}return[t.subarray(0,i),e]},pd=function(o,e){for(var t=0,i=0;i<e.length;++i)t+=o[i]*e[i];return t},gm=function(o,e,t){var i=t.length,s=vI(e+2);o[s]=i&255,o[s+1]=i>>>8,o[s+2]=o[s]^255,o[s+3]=o[s+1]^255;for(var c=0;c<i;++c)o[s+c+4]=t[c];return(s+4+i)*8},EI=function(o,e,t,i,s,c,u,a,m,A,x){$a(e,x++,t),++s[256];for(var b=O0(s,15),I=b[0],E=b[1],T=O0(c,15),U=T[0],P=T[1],R=wI(I),X=R[0],G=R[1],J=wI(U),q=J[0],te=J[1],ue=new Lr(19),_e=0;_e<X.length;++_e)ue[X[_e]&31]++;for(var _e=0;_e<q.length;++_e)ue[q[_e]&31]++;for(var K=O0(ue,7),ce=K[0],Ve=K[1],Ne=19;Ne>4&&!ce[AI[Ne-1]];--Ne);var Me=A+5<<3,ve=pd(s,Pl)+pd(c,mm)+u,ke=pd(s,I)+pd(c,U)+u+14+3*Ne+pd(ue,ce)+(2*ue[16]+3*ue[17]+7*ue[18]);if(Me<=ve&&Me<=ke)return gm(e,x,o.subarray(m,m+A));var Re,Fe,Oe,je;if($a(e,x,1+(ke<ve)),x+=2,ke<ve){Re=ud(I,E,0),Fe=I,Oe=ud(U,P,0),je=U;var Je=ud(ce,Ve,0);$a(e,x,G-257),$a(e,x+5,te-1),$a(e,x+10,Ne-4),x+=14;for(var _e=0;_e<Ne;++_e)$a(e,x+3*_e,ce[AI[_e]]);x+=3*Ne;for(var _t=[X,q],yt=0;yt<2;++yt)for(var qe=_t[yt],_e=0;_e<qe.length;++_e){var Ye=qe[_e]&31;$a(e,x,Je[Ye]),x+=ce[Ye],Ye>15&&($a(e,x,qe[_e]>>>5&127),x+=qe[_e]>>>12)}}else Re=c5,Fe=Pl,Oe=h5,je=mm;for(var _e=0;_e<a;++_e)if(i[_e]>255){var Ye=i[_e]>>>18&31;dd(e,x,Re[Ye+257]),x+=Fe[Ye+257],Ye>7&&($a(e,x,i[_e]>>>23&31),x+=U0[Ye]);var at=i[_e]&31;dd(e,x,Oe[at]),x+=je[at],at>3&&(dd(e,x,i[_e]>>>5&8191),x+=F0[at])}else dd(e,x,Re[i[_e]]),x+=Fe[i[_e]];return dd(e,x,Re[256]),x+Fe[256]},u5=new ph([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),G0=new Rr(0),d5=function(o,e,t,i,s,c){var u=o.length,a=new Rr(i+u+5*(1+Math.ceil(u/7e3))+s),m=a.subarray(i,a.length-s),A=0;if(!e||u<8)for(var x=0;x<=u;x+=65535){var b=x+65535;b<u?A=gm(m,A,o.subarray(x,b)):(m[x]=c,A=gm(m,A,o.subarray(x,u)))}else{for(var I=u5[e-1],E=I>>>13,T=I&8191,U=(1<<t)-1,P=new Lr(32768),R=new Lr(U+1),X=Math.ceil(t/3),G=2*X,J=function(Dt){return(o[Dt]^o[Dt+1]<<X^o[Dt+2]<<G)&U},q=new ph(25e3),te=new Lr(288),ue=new Lr(32),_e=0,K=0,x=0,ce=0,Ve=0,Ne=0;x<u;++x){var Me=J(x),ve=x&32767,ke=R[Me];if(P[ve]=ke,R[Me]=ve,Ve<=x){var Re=u-x;if((_e>7e3||ce>24576)&&Re>423){A=EI(o,m,0,q,te,ue,K,ce,Ne,x-Ne,A),ce=_e=K=0,Ne=x;for(var Fe=0;Fe<286;++Fe)te[Fe]=0;for(var Fe=0;Fe<30;++Fe)ue[Fe]=0}var Oe=2,je=0,Je=T,_t=ve-ke&32767;if(Re>2&&Me==J(x-_t))for(var yt=Math.min(E,Re)-1,qe=Math.min(32767,x),Ye=Math.min(258,Re);_t<=qe&&--Je&&ve!=ke;){if(o[x+Oe]==o[x+Oe-_t]){for(var at=0;at<Ye&&o[x+at]==o[x+at-_t];++at);if(at>Oe){if(Oe=at,je=_t,at>yt)break;for(var St=Math.min(_t,at-2),Te=0,Fe=0;Fe<St;++Fe){var Kt=x-_t+Fe+32768&32767,Zt=P[Kt],be=Kt-Zt+32768&32767;be>Te&&(Te=be,ke=Kt)}}}ve=ke,ke=P[ve],_t+=ve-ke+32768&32767}if(je){q[ce++]=268435456|k0[Oe]<<18|xI[je];var $e=k0[Oe]&31,fi=xI[je]&31;K+=U0[$e]+F0[fi],++te[257+$e],++ue[fi],Ve=x+Oe,++_e}else q[ce++]=o[x],++te[o[x]]}}A=EI(o,m,c,q,te,ue,K,ce,Ne,x-Ne,A),!c&&A&7&&(A=gm(m,A+1,G0))}return bI(a,0,i+vI(A)+s)},p5=function(){for(var o=new ph(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;o[e]=t}return o}(),f5=function(){var o=-1;return{p:function(e){for(var t=o,i=0;i<e.length;++i)t=p5[t&255^e[i]]^t>>>8;o=t},d:function(){return~o}}},m5=function(o,e,t,i,s){return d5(o,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(o.length)))*1.5):12+e.mem,t,i,!s)},SI=function(o,e){var t={};for(var i in o)t[i]=o[i];for(var i in e)t[i]=e[i];return t},sr=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8};function g5(o,e){return m5(o,e||{},0,0)}var II=function(o,e,t,i){for(var s in o){var c=o[s],u=e+s;c instanceof Rr?t[u]=[c,i]:Array.isArray(c)?t[u]=[c[0],SI(i,c[1])]:II(c,u+"/",t,i)}},CI=typeof TextEncoder<"u"&&new TextEncoder,A5=typeof TextDecoder<"u"&&new TextDecoder,_5=0;try{A5.decode(G0,{stream:!0}),_5=1}catch{}function Am(o,e){if(e){for(var t=new Rr(o.length),i=0;i<o.length;++i)t[i]=o.charCodeAt(i);return t}if(CI)return CI.encode(o);for(var s=o.length,c=new Rr(o.length+(o.length>>1)),u=0,a=function(x){c[u++]=x},i=0;i<s;++i){if(u+5>c.length){var m=new Rr(u+8+(s-i<<1));m.set(c),c=m}var A=o.charCodeAt(i);A<128||e?a(A):A<2048?(a(192|A>>6),a(128|A&63)):A>55295&&A<57344?(A=65536+(A&1023<<10)|o.charCodeAt(++i)&1023,a(240|A>>18),a(128|A>>12&63),a(128|A>>6&63),a(128|A&63)):(a(224|A>>12),a(128|A>>6&63),a(128|A&63))}return bI(c,0,u)}var Q0=function(o){var e=0;if(o)for(var t in o){var i=o[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},MI=function(o,e,t,i,s,c,u,a){var m=i.length,A=t.extra,x=a&&a.length,b=Q0(A);sr(o,e,u!=null?33639248:67324752),e+=4,u!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(c==null&&8),o[e++]=s&&8,o[e++]=t.compression&255,o[e++]=t.compression>>8;var I=new Date(t.mtime==null?Date.now():t.mtime),E=I.getFullYear()-1980;if(E<0||E>119)throw"date not in range 1980-2099";if(sr(o,e,E<<25|I.getMonth()+1<<21|I.getDate()<<16|I.getHours()<<11|I.getMinutes()<<5|I.getSeconds()>>>1),e+=4,c!=null&&(sr(o,e,t.crc),sr(o,e+4,c),sr(o,e+8,t.size)),sr(o,e+12,m),sr(o,e+14,b),e+=16,u!=null&&(sr(o,e,x),sr(o,e+6,t.attrs),sr(o,e+10,u),e+=14),o.set(i,e),e+=m,b)for(var T in A){var U=A[T],P=U.length;sr(o,e,+T),sr(o,e+2,P),o.set(U,e+4),e+=4+P}return x&&(o.set(a,e),e+=x),e},y5=function(o,e,t,i,s){sr(o,e,101010256),sr(o,e+8,t),sr(o,e+10,t),sr(o,e+12,i),sr(o,e+16,s)};function x5(o,e){e||(e={});var t={},i=[];II(o,"",t,e);var s=0,c=0;for(var u in t){var a=t[u],m=a[0],A=a[1],x=A.level==0?0:8,b=Am(u),I=b.length,E=A.comment,T=E&&Am(E),U=T&&T.length,P=Q0(A.extra);if(I>65535)throw"filename too long";var R=x?g5(m,A):m,X=R.length,G=f5();G.p(m),i.push(SI(A,{size:m.length,crc:G.d(),c:R,f:b,m:T,u:I!=u.length||T&&E.length!=U,o:s,compression:x})),s+=30+I+P+X,c+=76+2*(I+P)+(U||0)+X}for(var J=new Rr(c+22),q=s,te=c-s,ue=0;ue<i.length;++ue){var b=i[ue];MI(J,b.o,b,b.f,b.u,b.c.length);var _e=30+b.f.length+Q0(b.extra);J.set(b.c,b.o+_e),MI(J,s,b,b.f,b.u,b.c.length,b.o,b.m),s+=16+_e+(b.m?b.m.length:0)}return y5(J,s,i.length,te,q),J}var v5=(o,e,t)=>new Promise((i,s)=>{var c=m=>{try{a(t.next(m))}catch(A){s(A)}},u=m=>{try{a(t.throw(m))}catch(A){s(A)}},a=m=>m.done?i(m.value):Promise.resolve(m.value).then(c,u);a((t=t.apply(o,e)).next())});class b5{parse(e){return v5(this,arguments,function*(t,i={}){i=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},quickLookCompatible:!1},i);const s={},c="model.usda";s[c]=null;let u=TI();u+=E5(i);const a={},m={};t.traverseVisible(x=>{if(x.isMesh){const b=x.geometry,I=x.material;if(I.isMeshStandardMaterial){const E="geometries/Geometry_"+b.id+".usda";if(!(E in s)){const T=M5(b);s[E]=I5(T)}I.uuid in a||(a[I.uuid]=I),u+=C5(x,b,I)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",x)}else x.isCamera&&(u+=k5(x))}),u+=S5(),u+=P5(a,m,i.quickLookCompatible),s[c]=Am(u),u=null;for(const x in m){const b=m[x],I=w5(b.image,b.flipY),E=yield new Promise(T=>I.toBlob(T,"image/png",1));s[`textures/Texture_${x}.png`]=new Uint8Array(yield E.arrayBuffer())}let A=0;for(const x in s){const b=s[x];A+=34+x.length;const I=A&63;if(I!==4){const E=64-I,T=new Uint8Array(E);s[x]=[b,{extra:{12345:T}}]}A=b.length}return x5(s,{level:0})})}}function w5(o,e){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const t=document.createElement("canvas");t.width=o.width,t.height=o.height;const i=t.getContext("2d");return e===!0&&(i.translate(0,t.height),i.scale(1,-1)),i.drawImage(o,0,0,t.width,t.height),t}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const gr=7;function TI(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function E5(o){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{
		token preliminary:anchoring:type = "${o.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${o.ar.planeAnchoring.alignment}"

`}function S5(){return`
		}
	}
}

`}function I5(o){let e=TI();return e+=o,Am(e)}function C5(o,e,t){const i="Object_"+o.id,s=BI(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",o),`def Xform "${i}" (
	prepend references = @./geometries/Geometry_${e.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${s}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${t.id}>
}

`}function BI(o){const e=o.elements;return`( ${_m(e,0)}, ${_m(e,4)}, ${_m(e,8)}, ${_m(e,12)} )`}function _m(o,e){return`(${o[e+0]}, ${o[e+1]}, ${o[e+2]}, ${o[e+3]})`}function M5(o){return`
def "Geometry"
{
${T5(o)}
}
`}function T5(o){const e="Geometry",t=o.attributes,i=t.position.count;return`
	def Mesh "${e}"
	{
		int[] faceVertexCounts = [${B5(o)}]
		int[] faceVertexIndices = [${R5(o)}]
		normal3f[] normals = [${RI(t.normal,i)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${RI(t.position,i)}]
${D5(t,i)}
		uniform token subdivisionScheme = "none"
	}
`}function B5(o){const e=o.index!==null?o.index.count:o.attributes.position.count;return Array(e/3).fill(3).join(", ")}function R5(o){const e=o.index,t=[];if(e!==null)for(let i=0;i<e.count;i++)t.push(e.getX(i));else{const i=o.attributes.position.count;for(let s=0;s<i;s++)t.push(s)}return t.join(", ")}function RI(o,e){if(o===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let i=0;i<o.count;i++){const s=o.getX(i),c=o.getY(i),u=o.getZ(i);t.push(`(${s.toPrecision(gr)}, ${c.toPrecision(gr)}, ${u.toPrecision(gr)})`)}return t.join(", ")}function L5(o,e){if(o===void 0)return console.warn("USDZExporter: UVs missing."),Array(e).fill("(0, 0)").join(", ");const t=[];for(let i=0;i<o.count;i++){const s=o.getX(i),c=o.getY(i);t.push(`(${s.toPrecision(gr)}, ${1-c.toPrecision(gr)})`)}return t.join(", ")}function D5(o,e){let t="";for(let i=0;i<4;i++){const s=i>0?i:"",c=o["uv"+s];c!==void 0&&(t+=`
		texCoord2f[] primvars:st${s} = [${L5(c,e)}] (
			interpolation = "vertex"
		)`)}return t}function P5(o,e,t=!1){const i=[];for(const s in o){const c=o[s];i.push(U5(c,e,t))}return`def "Materials"
{
${i.join("")}
}

`}function U5(o,e,t=!1){const i="			",s=[],c=[];function u(a,m,A){const x=a.source.id+"_"+a.flipY;e[x]=a;const b=a.channel>0?"st"+a.channel:"st",I={1e3:"repeat",1001:"clamp",1002:"mirror"},E=a.repeat.clone(),T=a.offset.clone(),U=a.rotation,P=Math.sin(U),R=Math.cos(U);return T.y=1-T.y-E.y,t?(T.x=T.x/E.x,T.y=T.y/E.y,T.x+=P/E.x,T.y+=R-1):(T.x+=P*E.x,T.y+=(1-R)*E.y),`
		def Shader "PrimvarReader_${m}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${b}"
			float2 outputs:result
		}

		def Shader "Transform2d_${m}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${o.id}/PrimvarReader_${m}.outputs:result>
			float inputs:rotation = ${(U*(180/Math.PI)).toFixed(gr)}
			float2 inputs:scale = ${DI(E)}
			float2 inputs:translation = ${DI(T)}
			float2 outputs:result
		}

		def Shader "Texture_${a.id}_${m}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${x}.png@
			float2 inputs:st.connect = </Materials/Material_${o.id}/Transform2d_${m}.outputs:result>
			${A!==void 0?"float4 inputs:scale = "+F5(A):""}
			token inputs:sourceColorSpace = "${a.colorSpace===fs?"raw":"sRGB"}"
			token inputs:wrapS = "${I[a.wrapS]}"
			token inputs:wrapT = "${I[a.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${o.transparent||o.alphaTest>0?"float outputs:a":""}
		}`}return o.side===er&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",o),o.map!==null?(s.push(`${i}color3f inputs:diffuseColor.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:rgb>`),o.transparent?s.push(`${i}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:a>`):o.alphaTest>0&&(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.map.id}_diffuse.outputs:a>`),s.push(`${i}float inputs:opacityThreshold = ${o.alphaTest}`)),c.push(u(o.map,"diffuse",o.color))):s.push(`${i}color3f inputs:diffuseColor = ${LI(o.color)}`),o.emissiveMap!==null?(s.push(`${i}color3f inputs:emissiveColor.connect = </Materials/Material_${o.id}/Texture_${o.emissiveMap.id}_emissive.outputs:rgb>`),c.push(u(o.emissiveMap,"emissive"))):o.emissive.getHex()>0&&s.push(`${i}color3f inputs:emissiveColor = ${LI(o.emissive)}`),o.normalMap!==null&&(s.push(`${i}normal3f inputs:normal.connect = </Materials/Material_${o.id}/Texture_${o.normalMap.id}_normal.outputs:rgb>`),c.push(u(o.normalMap,"normal"))),o.aoMap!==null&&(s.push(`${i}float inputs:occlusion.connect = </Materials/Material_${o.id}/Texture_${o.aoMap.id}_occlusion.outputs:r>`),c.push(u(o.aoMap,"occlusion"))),o.roughnessMap!==null&&o.roughness===1?(s.push(`${i}float inputs:roughness.connect = </Materials/Material_${o.id}/Texture_${o.roughnessMap.id}_roughness.outputs:g>`),c.push(u(o.roughnessMap,"roughness"))):s.push(`${i}float inputs:roughness = ${o.roughness}`),o.metalnessMap!==null&&o.metalness===1?(s.push(`${i}float inputs:metallic.connect = </Materials/Material_${o.id}/Texture_${o.metalnessMap.id}_metallic.outputs:b>`),c.push(u(o.metalnessMap,"metallic"))):s.push(`${i}float inputs:metallic = ${o.metalness}`),o.alphaMap!==null?(s.push(`${i}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${o.alphaMap.id}_opacity.outputs:r>`),s.push(`${i}float inputs:opacityThreshold = 0.0001`),c.push(u(o.alphaMap,"opacity"))):s.push(`${i}float inputs:opacity = ${o.opacity}`),o.isMeshPhysicalMaterial&&(s.push(`${i}float inputs:clearcoat = ${o.clearcoat}`),s.push(`${i}float inputs:clearcoatRoughness = ${o.clearcoatRoughness}`),s.push(`${i}float inputs:ior = ${o.ior}`)),`
	def Material "Material_${o.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${s.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${o.id}/PreviewSurface.outputs:surface>

${c.join(`
`)}

	}
`}function LI(o){return`(${o.r}, ${o.g}, ${o.b})`}function F5(o){return`(${o.r}, ${o.g}, ${o.b}, 1.0)`}function DI(o){return`(${o.x}, ${o.y})`}function k5(o){const e=o.name?o.name:"Camera_"+o.id,t=BI(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",o),o.isOrthographicCamera?`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${t}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${o.near.toPrecision(gr)}, ${o.far.toPrecision(gr)})
			float horizontalAperture = ${((Math.abs(o.left)+Math.abs(o.right))*10).toPrecision(gr)}
			float verticalAperture = ${((Math.abs(o.top)+Math.abs(o.bottom))*10).toPrecision(gr)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${e}"
		{
			matrix4d xformOp:transform = ${t}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${o.near.toPrecision(gr)}, ${o.far.toPrecision(gr)})
			float focalLength = ${o.getFocalLength().toPrecision(gr)}
			float focusDistance = ${o.focus.toPrecision(gr)}
			float horizontalAperture = ${o.getFilmWidth().toPrecision(gr)}
			token projection = "perspective"
			float verticalAperture = ${o.getFilmHeight().toPrecision(gr)}
		}
	
	`}const N5=`
<svg width="<WIDTH>px" height="<HEIGHT>px" viewBox="0 0 1024 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(1.42378,0,0,-1.42378,37.8056,272.552)">
        <path d="M535.902,111.141L535.902,135.996L516.129,135.996L516.129,40.18L535.902,40.18L535.902,90.087C540.364,74.698 554.364,63.505 570.884,63.505C589.267,63.505 604.519,77.36 607.001,95.441L607.245,97.219L607.245,64.239L626.512,64.239L626.555,66.149C630.504,64.457 634.803,63.668 638.946,63.657C644.567,63.523 650.034,65.021 655.057,68.061L660.825,71.553L651.44,88.59L645.161,84.719C643.29,83.566 641.189,83.086 639.101,83.077C632.262,83.174 627.017,88.662 627.017,95.331L627.017,135.997L607.245,135.997L607.245,101.756L597.204,104.413L607.131,108.728L604.463,115.117C598.904,128.43 585.948,137.724 570.884,137.724C554.364,137.724 540.364,126.53 535.902,111.141ZM515.693,52.455C515.693,60.117 509.874,63.947 504.055,63.947C498.236,63.947 492.417,60.117 492.417,52.455C492.417,37.14 515.693,37.14 515.693,52.455ZM380.282,71.383L380.282,153.041C379.771,153.655 373.607,159.525 373.258,160.065L373.258,135.997L348.352,135.997L348.243,134.69C344.015,136.642 339.458,137.674 335.553,137.747L335.511,137.748C324.933,137.821 315.829,134.433 309.296,128.08C305.974,124.851 303.277,120.825 301.442,115.998L301.442,135.996L273.142,135.996L273.142,97.898C273.142,94.483 272.775,90.902 269.308,90.902C265.617,90.902 263.827,94.498 263.827,98.131L263.827,135.996L235.53,135.996L235.53,98.131C235.53,94.53 234.463,90.671 230.75,90.671C227.046,90.671 225.511,94.483 225.511,98.131L225.511,135.996L197.213,135.996L197.213,64.239L223.485,64.239L223.627,65.183C226.918,63.895 230.419,63.307 233.669,63.307C240.087,63.307 246.447,65.139 251.31,69.669C256.803,65.062 263.137,63.54 270.002,63.54C280.598,63.54 288.388,67.088 293.646,73.141C296.904,76.89 299.223,81.729 300.443,87.587C302.282,81.374 305.504,76.323 309.651,72.435C316.294,66.207 325.463,62.891 335.799,62.957C340.05,62.961 344.191,63.842 347.897,65.413L347.96,64.36L399.852,64.36L400.044,66C404.335,64.016 408.962,63.073 413.227,63.073C426.457,63.073 437.04,68.986 443.35,78.274L443.35,64.239L455.619,64.239L455.619,48.113L475.273,46.066L475.273,64.239L494.056,64.239L494.056,64.005L513.822,64.005L513.822,135.996L494.056,135.996L494.056,132.579L492.809,133.184C488.173,135.434 483.508,136.813 478.88,136.813C471.929,136.813 466.942,134.899 463.359,131.901C458.177,127.565 455.619,120.504 455.619,111.217L455.619,83.076L446.093,83.076C448.504,88.174 449.807,93.997 449.807,100.235C449.807,121.049 436.525,137.4 413.692,137.4C410.081,137.4 405.736,136.78 401.557,135.338L401.557,160.065L373.258,160.065C374.058,159.226 379.595,153.754 380.282,153.041L394.533,153.041L394.533,122.196C398.624,128.502 407.623,130.376 413.692,130.376C432.149,130.376 442.783,117.06 442.783,100.235C442.783,83.299 430.977,70.096 413.227,70.096C406.687,70.096 398.975,72.899 394.533,79.326L393.603,71.383L380.282,71.383ZM528.878,128.972L528.878,47.203L523.153,47.203L523.153,128.972L528.878,128.972ZM508.669,52.455C508.669,55.493 506.362,57.011 504.055,57.011C501.748,57.011 499.441,55.493 499.441,52.455C499.441,46.383 508.669,46.383 508.669,52.455ZM468.249,71.263L468.249,53.859L462.643,54.443L462.643,71.263L450.374,71.263L450.374,76.053L462.643,76.053L462.643,111.217C462.643,122.546 466.615,129.789 478.88,129.789C482.497,129.789 486.12,128.623 489.744,126.865L487.757,122.196C484.837,123.597 481.684,124.532 478.88,124.532C469.888,124.532 468.249,119.041 468.249,111.217L468.249,76.053L487.874,76.053L487.874,71.263L468.249,71.263ZM368.25,71.383L354.58,71.383L354.11,79.326C350.841,73.601 343.484,69.981 335.776,69.981C318.955,69.864 305.75,80.26 305.75,100.118C305.75,120.329 318.371,130.842 335.421,130.725C341.848,130.604 350.841,127.336 354.11,120.565L354.813,128.973L368.25,128.973L368.25,71.383ZM242.554,98.131L242.554,128.972L256.803,128.972L256.803,98.131C256.803,90.537 261.593,83.878 269.308,83.878C277.013,83.878 280.166,90.308 280.166,97.898L280.166,128.972L294.418,128.972L294.418,97.898C294.418,80.608 286.36,70.563 270.002,70.563C262.53,70.563 255.869,72.899 250.729,81.077C247.456,73.136 240.567,70.33 233.669,70.33C228.184,70.33 221.525,72.43 218.487,78.273L217.436,71.263L204.237,71.263L204.237,128.972L218.487,128.972L218.487,98.131C218.487,90.538 223.038,83.648 230.75,83.648C238.581,83.648 242.554,90.537 242.554,98.131ZM548.355,110.081C552.002,119.128 560.713,125.5 570.884,125.5C580.946,125.5 589.582,119.266 593.296,110.373L597.982,112.41C593.492,123.162 583.05,130.7 570.884,130.7C554.619,130.7 541.435,117.229 541.435,100.614C541.435,83.998 554.619,70.528 570.884,70.528C585.747,70.528 598.036,81.778 600.043,96.397L595.072,97.712L595.066,97.66L548.346,110.06C548.347,110.063 548.348,110.065 548.349,110.067C548.35,110.07 548.351,110.072 548.352,110.075L548.323,110.083L548.355,110.081ZM619.645,71.263L619.877,81.547C623.495,73.714 631.678,70.68 639.037,70.68C643.363,70.564 647.56,71.733 651.42,74.07L648.847,78.74C645.815,76.871 642.42,76.053 639.037,76.053C628.285,76.174 619.993,84.816 619.993,95.331L619.993,128.973L614.269,128.973L614.269,71.263L619.645,71.263ZM501.08,71.029L501.08,128.972L506.798,128.972L506.798,71.029L501.08,71.029ZM570.884,75.728C557.432,75.728 546.525,86.87 546.525,100.615C546.525,101.951 546.631,103.261 546.829,104.54L593.773,92.08C590.364,82.54 581.403,75.728 570.884,75.728ZM337.058,117.641C327.596,117.641 320.003,111.095 320.003,100.118C320.003,89.139 327.596,82.712 337.058,82.712C359.486,82.712 359.486,117.641 337.058,117.641ZM554.337,95.28L582.868,87.708C579.76,84.644 575.542,82.752 570.884,82.752C563.085,82.752 556.533,88.04 554.337,95.28ZM494.056,119.062L491.343,112.685L484.719,115.864C482.789,116.789 480.733,117.508 478.88,117.508C477.629,117.508 476.693,117.588 476.133,117.047C475.69,116.618 475.657,115.939 475.534,115.219C475.328,114.012 475.273,112.666 475.273,111.217L475.273,83.076L494.056,83.076L494.056,119.062ZM428.531,100.235C428.531,91.24 422.455,83.878 412.176,83.878C401.893,83.878 395.818,91.24 395.818,100.235C395.818,109.227 402.479,116.593 412.176,116.593C421.876,116.593 428.531,109.227 428.531,100.235ZM337.058,110.617C343.68,110.617 346.855,105.333 346.855,100.176C346.855,95.02 343.68,89.735 337.058,89.735C331.452,89.735 327.027,93.613 327.027,100.118C327.027,106.637 331.439,110.617 337.058,110.617ZM421.507,100.235C421.507,95.103 418.041,90.902 412.176,90.902C406.308,90.902 402.842,95.103 402.842,100.235C402.842,105.366 406.643,109.569 412.176,109.569C417.711,109.569 421.507,105.366 421.507,100.235ZM587.073,107.048L586.815,107.666C584.171,113.998 578.048,118.476 570.884,118.476C566.637,118.476 562.757,116.902 559.752,114.299L587.073,107.048Z" style="fill-opacity:0.3;"/>
    </g>
    <g transform="matrix(1.42378,0,0,-1.42378,28.8272,275.975)">
        <path d="M33.568,124.028C16.878,107.338 16.878,80.238 33.568,63.548L63.65,33.466C80.34,16.776 107.44,16.776 124.13,33.466L154.227,63.563C170.917,80.253 170.917,107.353 154.227,124.043L93.905,184.365L33.568,124.028ZM93.789,63.649L63.526,93.912L93.789,124.175L124.052,93.912L93.789,63.649Z" style="fill-opacity:0.3;"/>
        <path d="M28.601,128.994C9.171,109.563 9.171,78.013 28.601,58.582L58.684,28.5C78.114,9.069 109.665,9.069 129.096,28.5L159.193,58.597C178.624,78.028 178.624,109.578 159.193,129.009L93.905,194.298L28.601,128.994ZM33.568,124.028C16.878,107.338 16.878,80.238 33.568,63.548L63.65,33.466C80.34,16.776 107.44,16.776 124.13,33.466L154.227,63.563C170.917,80.253 170.917,107.353 154.227,124.043L93.905,184.365L33.568,124.028ZM93.789,63.649L63.526,93.912L93.789,124.175L124.052,93.912L93.789,63.649ZM93.789,73.582L73.459,93.912L93.789,114.242L114.119,93.912L93.789,73.582Z" style="fill-opacity:0.3;"/>
    </g>
    <g transform="matrix(1.42378,0,0,-1.42378,37.8056,272.552)">
        <path d="M528.878,128.972L528.878,47.203L523.153,47.203L523.153,128.972L528.878,128.972ZM508.669,52.455C508.669,58.53 499.441,58.53 499.441,52.455C499.441,46.383 508.669,46.383 508.669,52.455ZM501.08,71.029L501.08,128.972L506.798,128.972L506.798,71.029L501.08,71.029ZM468.249,71.263L468.249,53.859L462.643,54.443L462.643,71.263L450.374,71.263L450.374,76.053L462.643,76.053L462.643,111.217C462.643,122.546 466.615,129.789 478.88,129.789C482.497,129.789 486.12,128.623 489.744,126.865L487.757,122.196C484.837,123.597 481.684,124.532 478.88,124.532C469.888,124.532 468.249,119.041 468.249,111.217L468.249,76.053L487.874,76.053L487.874,71.263L468.249,71.263ZM368.25,71.383L354.58,71.383L354.11,79.326C350.841,73.601 343.484,69.981 335.776,69.981C318.955,69.864 305.75,80.26 305.75,100.118C305.75,120.329 318.371,130.842 335.421,130.725C341.848,130.604 350.841,127.336 354.11,120.565L354.813,128.973L368.25,128.973L368.25,71.383ZM337.058,117.641C327.596,117.641 320.003,111.095 320.003,100.118C320.003,89.139 327.596,82.712 337.058,82.712C359.486,82.712 359.486,117.641 337.058,117.641ZM242.554,98.131L242.554,128.972L256.803,128.972L256.803,98.131C256.803,90.537 261.593,83.878 269.308,83.878C277.013,83.878 280.166,90.308 280.166,97.898L280.166,128.972L294.418,128.972L294.418,97.898C294.418,80.608 286.36,70.563 270.002,70.563C262.53,70.563 255.869,72.899 250.729,81.077C247.456,73.136 240.567,70.33 233.669,70.33C228.184,70.33 221.525,72.43 218.487,78.273L217.436,71.263L204.237,71.263L204.237,128.972L218.487,128.972L218.487,98.131C218.487,90.538 223.038,83.648 230.75,83.648C238.581,83.648 242.554,90.537 242.554,98.131ZM380.282,153.041L380.282,71.383L393.603,71.383L394.533,79.326C398.975,72.899 406.687,70.096 413.227,70.096C430.977,70.096 442.783,83.299 442.783,100.235C442.783,117.06 432.149,130.376 413.692,130.376C407.623,130.376 398.624,128.502 394.533,122.196L394.533,153.041L380.282,153.041ZM428.531,100.235C428.531,91.24 422.455,83.878 412.176,83.878C401.893,83.878 395.818,91.24 395.818,100.235C395.818,109.227 402.479,116.593 412.176,116.593C421.876,116.593 428.531,109.227 428.531,100.235ZM619.645,71.263L619.877,81.547C623.495,73.714 631.678,70.68 639.037,70.68C643.363,70.564 647.56,71.733 651.42,74.07L648.847,78.74C645.815,76.871 642.42,76.053 639.037,76.053C628.285,76.174 619.993,84.816 619.993,95.331L619.993,128.973L614.269,128.973L614.269,71.263L619.645,71.263ZM548.355,110.081C552.002,119.128 560.713,125.5 570.884,125.5C580.946,125.5 589.582,119.266 593.296,110.373L597.982,112.41C593.492,123.162 583.05,130.7 570.884,130.7C554.619,130.7 541.435,117.229 541.435,100.614C541.435,83.998 554.619,70.528 570.884,70.528C585.747,70.528 598.036,81.778 600.043,96.397L595.072,97.712C595.07,97.7 595.069,97.689 595.068,97.677L595.066,97.66L548.346,110.06C548.347,110.063 548.348,110.065 548.349,110.067C548.35,110.07 548.351,110.072 548.352,110.075L548.323,110.083L548.355,110.081ZM570.884,75.728C557.432,75.728 546.525,86.87 546.525,100.615C546.525,101.951 546.631,103.261 546.829,104.54L593.773,92.08C590.364,82.54 581.403,75.728 570.884,75.728Z" style="fill:white;"/>
    </g>
    <g transform="matrix(1.42378,-1.58071e-16,-1.58071e-16,-1.42378,37.8056,272.552)">
        <path d="M57.423,151.586C65.597,159.758 87.354,181.938 87.344,181.96C87.265,182.105 108.959,160.323 117.599,151.688L87.459,121.55L57.423,151.586Z" style="fill:rgb(58,24,136);fill-rule:nonzero;"/>
        <path d="M87.459,121.55L117.598,151.688C117.643,151.638 117.698,151.581 117.747,151.536L147.857,121.424L117.72,91.287L87.459,121.55Z" style="fill:rgb(3,161,196);fill-rule:nonzero;"/>
        <path d="M147.857,121.424L147.935,121.346C164.591,104.692 164.604,77.7 147.985,61.025L117.721,91.287L147.857,121.424Z" style="fill:rgb(5,208,223);fill-rule:nonzero;"/>
        <path d="M57.195,91.287L27.164,121.317C27.173,121.328 27.178,121.338 27.189,121.347L57.373,151.536C57.39,151.552 57.408,151.568 57.423,151.586L87.459,121.55L57.195,91.287Z" style="fill:rgb(118,31,232);fill-rule:nonzero;"/>
        <path d="M87.459,61.023L117.72,91.287L147.984,61.025C147.96,61.008 147.951,60.991 147.934,60.974L117.747,30.787C117.74,30.779 117.729,30.77 117.72,30.762L87.459,61.023Z" style="fill:rgb(255,170,1);fill-rule:nonzero;"/>
        <path d="M27.037,61.129C10.529,77.804 10.571,104.696 27.164,121.318L57.195,91.288L27.037,61.129Z" style="fill:rgb(241,23,93);fill-rule:nonzero;"/>
        <path d="M87.458,61.023L57.298,30.863L27.188,60.973C27.136,61.025 27.089,61.08 27.036,61.128L57.195,91.287L87.458,61.023Z" style="fill:rgb(251,58,27);fill-rule:nonzero;"/>
        <path d="M117.722,30.761C101.046,14.116 74.039,14.125 57.374,30.787L57.3,30.863L87.46,61.023L117.722,30.761Z" style="fill:rgb(251,201,53);fill-rule:nonzero;"/>
    </g>
</svg>
`;function O5(o,e,t=256){return new Promise(i=>{const s=t*.25,c=N5.replace("<WIDTH>",t.toString()).replace("<HEIGHT>",s.toString()),u=new Image,a=new Blob([c],{type:"image/svg+xml"}),m=URL.createObjectURL(a);u.onload=function(){o.drawImage(u,e,e),URL.revokeObjectURL(m),i()},u.src=m})}var z5=Object.defineProperty,PI=Object.getOwnPropertySymbols,G5=Object.prototype.hasOwnProperty,Q5=Object.prototype.propertyIsEnumerable,UI=(o,e,t)=>e in o?z5(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,FI=(o,e)=>{for(var t in e||(e={}))G5.call(e,t)&&UI(o,t,e[t]);if(PI)for(var t of PI(e))Q5.call(e,t)&&UI(o,t,e[t]);return o},Wr=(o,e,t)=>new Promise((i,s)=>{var c=m=>{try{a(t.next(m))}catch(A){s(A)}},u=m=>{try{a(t.throw(m))}catch(A){s(A)}},a=m=>m.done?i(m.value):Promise.resolve(m.value).then(c,u);a((t=t.apply(o,e)).next())});/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1;const V5=12,ko=512;function V0(o){o.parentNode.removeChild(o)}function kI(o,e,t,i=!0){const s=(e+180)/360*Math.pow(2,o),c=(1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,o);return i?{x:Math.floor(s),y:Math.floor(c)}:{x:s,y:c}}function NI(o){const e=document.createElement("canvas");e.width=o.width,e.height=o.height;const t=e.getContext("2d");if(!t)throw new Error("Unable to create a canvas with context.");const i=t.getImageData(0,0,o.width,o.height);return i.data.set(o.pixelData),t.putImageData(i,0,0),e}function H5(o,e,t,i){return Wr(this,null,function*(){const s=e.x-o.x+1,c=e.y-o.y+1,u=document.createElement("canvas");u.width=s*ko,u.height=c*ko;const a=u.getContext("2d");if(!a)throw new Error("The context is invalid");let m=0,A=0;const x=[];for(let b=o.y;b<=e.y;b+=1){for(let I=o.x;I<=e.x;I+=1){const E=i[~~(Math.random()*i.length)].replace("{x}",I.toString()).replace("{y}",b.toString()).replace("{z}",t.toString());x.push(W5(E,a,[m*ko,A*ko])),m++}m=0,A++}return yield Promise.all(x),u})}function W5(o,e,t){return new Promise((i,s)=>{const c=new Image;c.crossOrigin="anonymous",c.src=o,c.onload=function(){e.drawImage(c,t[0],t[1]),i()},c.onerror=function(){i()}})}function q5(o,e,t){var i;const s=o[0],c=o[1],u=e[0],a=e[1],m=document.createElement("canvas");return m.width=u,m.height=a,(i=m.getContext("2d"))==null||i.drawImage(t,s,c,u,a,0,0,u,a),m}function fh(o){return new Promise(function(e,t){o.once("idle",()=>{e(!0)})})}const $5={showButton:!0,background:"#FFFFFF",closeButtonClassName:"",arButtonClassName:"",closeButtonContent:`<svg width="100%" height="100%" viewBox="0 0 33 33" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
      <g transform="matrix(0.707107,0.707107,-0.707107,0.707107,16.6768,6.42373)">
          <path d="M7,13.75C6.737,13.75 6.509,13.653 6.315,13.46C6.122,13.266 6.025,13.038 6.025,12.775L6.025,8.225L1.475,8.225C1.212,8.225 0.984,8.128 0.79,7.935C0.597,7.741 0.5,7.513 0.5,7.25C0.5,6.987 0.597,6.759 0.79,6.565C0.984,6.372 1.212,6.275 1.475,6.275L6.025,6.275L6.025,1.725C6.025,1.462 6.122,1.234 6.315,1.04C6.509,0.847 6.737,0.75 7,0.75C7.263,0.75 7.491,0.847 7.685,1.04C7.878,1.234 7.975,1.462 7.975,1.725L7.975,6.275L12.525,6.275C12.788,6.275 13.016,6.372 13.21,6.565C13.403,6.759 13.5,6.987 13.5,7.25C13.5,7.513 13.403,7.741 13.21,7.935C13.016,8.128 12.788,8.225 12.525,8.225L7.975,8.225L7.975,12.775C7.975,13.038 7.878,13.266 7.685,13.46C7.491,13.653 7.263,13.75 7,13.75Z" style="fill:rgb(68,73,82);fill-rule:nonzero;"/>
      </g>
    </svg>`,arButtonContent:`
  <span>
    <svg width="33px" height="33px" viewBox="0 0 48 48" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2; vertical-align: middle;">
      <g transform="matrix(0.718295,0,0,0.718295,6.75661,6.76523)">
          <path d="M22.197,39.734L11.472,33.439C10.949,33.118 10.543,32.696 10.253,32.171C9.963,31.646 9.819,31.082 9.819,30.48L9.819,17.941C9.819,17.34 9.963,16.776 10.253,16.251C10.543,15.726 10.949,15.303 11.472,14.983L22.247,8.576C22.777,8.27 23.362,8.116 24,8.116C24.638,8.116 25.223,8.27 25.753,8.576L36.528,14.983C37.051,15.303 37.457,15.726 37.747,16.251C38.037,16.776 38.182,17.34 38.182,17.941L38.182,30.48C38.182,31.082 38.032,31.646 37.734,32.171C37.436,32.696 37.017,33.118 36.478,33.439L25.603,39.734C25.062,40.048 24.491,40.205 23.892,40.205C23.292,40.205 22.727,40.048 22.197,39.734ZM22.5,35.925L22.5,25.044L13.275,19.741L13.275,30.373L22.5,35.925ZM25.5,35.925L34.775,30.373L34.775,19.741L25.5,25.044L25.5,35.925ZM3.701,13.426L3.701,7.108C3.701,6.159 4.033,5.353 4.696,4.687C5.359,4.022 6.163,3.689 7.108,3.689L13.426,3.689L13.426,6.976L6.976,6.976L6.976,13.426L3.701,13.426ZM13.426,44.299L7.108,44.299C6.163,44.299 5.359,43.967 4.696,43.304C4.033,42.641 3.701,41.837 3.701,40.892L3.701,34.574L6.976,34.574L6.976,41.024L13.426,41.024L13.426,44.299ZM34.574,44.299L34.574,41.024L41.024,41.024L41.024,34.574L44.311,34.574L44.311,40.892C44.311,41.837 43.978,42.641 43.313,43.304C42.647,43.967 41.841,44.299 40.892,44.299L34.574,44.299ZM41.024,13.426L41.024,6.976L34.574,6.976L34.574,3.689L40.892,3.689C41.841,3.689 42.647,4.022 43.313,4.687C43.978,5.353 44.311,6.159 44.311,7.108L44.311,13.426L41.024,13.426ZM24,22.336L33.237,16.991L24,11.685L14.763,16.991L24,22.336Z" style="fill:rgb(36, 189, 240);fill-rule:nonzero;"/>
      </g>
    </svg>
    <span style="vertical-align: middle;">
    View in your space
    </span>
  </span>`,edgeColor:"#7b8487"},OI={position:"absolute",bottom:"0",left:"0",right:"0",margin:"30px auto",fontSize:"1.4em",width:"fit-content",background:"#FFF",border:"1px solid #0000001a",borderRadius:"3px",padding:"2px 9px 2px 6px",color:"#727781","box-shadow":"0 0 6px 2px rgb(0 0 0 / 8%)"},zI={position:"absolute",top:"0",right:"0",margin:"10px",padding:"0px",background:"#FFF",border:"none",borderRadius:"3px",width:"33px",height:"33px","box-shadow":"0 0 6px 2px rgb(0 0 0 / 8%)"};class j5 extends Xi{constructor(e={}){super(),this.colorData=null,this.landMaskData=null,this.terrainData=null,this.meterPerPixelCenter=0,this.originalPixelRatio=0,this.itemsToDispose=[],this.gltfExporter=new L0,this.lock=!1,this.arButton=null,this.closeButton=null,this.modelViewer=null,this.options=FI(FI({},$5),e)}onAdd(e){if(this.setMap(e),this.controlButtonContainer=window.document.createElement("div"),this.options.showButton){this.controlButtonContainer.className="maplibregl-ctrl maplibregl-ctrl-group",this.controlButton=window.document.createElement("button"),this.controlButton.className="maptiler-ar-ctrl",this.controlButtonContainer.appendChild(this.controlButton);const t=window.document.createElement("span");t.className="maplibregl-ctrl-icon",t.setAttribute("aria-hidden","true"),this.controlButton.appendChild(t),t.innerHTML=`
      <svg width="100%" height="100%" viewBox="0 0 48 48" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
        <path d="M22.701,35.306L14.997,30.784C14.621,30.554 14.33,30.251 14.121,29.873C13.913,29.496 13.81,29.091 13.81,28.659L13.81,19.652C13.81,19.22 13.913,18.815 14.121,18.438C14.33,18.061 14.621,17.757 14.997,17.527L22.737,12.925C23.117,12.706 23.537,12.595 23.996,12.595C24.454,12.595 24.874,12.706 25.255,12.925L32.994,17.527C33.37,17.757 33.662,18.061 33.87,18.438C34.078,18.815 34.183,19.22 34.183,19.652L34.183,28.659C34.183,29.091 34.075,29.496 33.861,29.873C33.647,30.251 33.346,30.554 32.959,30.784L25.147,35.306C24.759,35.532 24.348,35.644 23.918,35.644C23.487,35.644 23.081,35.532 22.701,35.306ZM25.073,32.57L31.735,28.582L31.735,20.945L25.073,24.754L25.073,32.57ZM22.918,32.57L22.918,24.754L16.292,20.945L16.292,28.582L22.918,32.57ZM23.996,15.159L17.361,18.97L23.996,22.809L30.631,18.97L23.996,15.159Z" style="fill:rgb(68,73,82);"/>
      </svg>
      `,this.controlButton.type="button",this.controlButton.addEventListener("click",i=>Wr(this,null,function*(){this.run()}))}return this.init3DScene(),this.controlButtonContainer}run(){return Wr(this,null,function*(){try{this.close()}catch{}if(this.lock)return;this.lock=!0,this.emit("computeStart"),yield this.computeTextures();const e=this.getColorData(),t=this.getTerrainData();!e||!t||(yield this.buildMapModel(),this.displayModal(),this.lock=!1)})}onRemove(){var e;this.dispose(),(e=this.controlButtonContainer.parentNode)==null||e.removeChild(this.controlButtonContainer)}setMap(e){this.map=e}getMeterPerPixelCenter(){return this.meterPerPixelCenter}getColorData(){return this.colorData}getLandMaskData(){return this.landMaskData}getTerrainData(){return this.terrainData}saveMapSettings(){this.cameraSettings={center:this.map.getCenter(),zoom:this.map.getZoom(),pitch:this.map.getPitch(),bearing:this.map.getBearing()},this.terrainExaggeration=this.map.getTerrainExaggeration(),this.hasTerrain=this.map.hasTerrain(),this.originalPixelRatio=this.map.getPixelRatio(),this.hasTerrain&&(this.terrainSourceID=this.map.getTerrain().source)}restoreMapSettings(){this.map.triggerRepaint(),this.hasTerrain&&this.map.setTerrain({source:this.terrainSourceID,exaggeration:this.terrainExaggeration}),this.map.jumpTo(this.cameraSettings)}enableTopView(){this.saveMapSettings(),this.hasTerrain&&this.map.setTerrain(null),this.map.triggerRepaint();const e={center:this.cameraSettings.center,zoom:this.cameraSettings.zoom,pitch:0,bearing:0};this.map.jumpTo(e)}grabGlData(){const e=this.map.getCanvas().getContext("webgl2");if(!e)throw new Error("The WebGL context of the map is undefined");const t=new Uint8Array(e.drawingBufferWidth*e.drawingBufferHeight*4);return e.readPixels(0,0,e.drawingBufferWidth,e.drawingBufferHeight,e.RGBA,e.UNSIGNED_BYTE,t),{width:e.drawingBufferWidth,height:e.drawingBufferHeight,pixelData:t,bounds:this.map.getBounds()}}computeColorData(){return Wr(this,null,function*(){this.emit("startComputeColorData"),yield fh(this.map),this.colorData=this.grabGlData(),this.emit("endComputeColorData",{})})}computeLandMaskData(){return Wr(this,null,function*(){this.emit("startComputeLandMaskData",{}),this.map.addSource("xr_module_global_blackout_source",{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-180,-90],[-180,90],[180,90],[180,-90],[-180,-90]]]}}}),this.map.addLayer({id:"xr_module_global_blackout_layer",type:"fill",source:"xr_module_global_blackout_source",layout:{},paint:{"fill-color":"#000","fill-opacity":1}}),this.map.addSource("xr_module_land_source",{type:"vector",url:"https://api.maptiler.com/tiles/land/tiles.json?key=bod4IIn9bwK8mnZIk49v"}),this.map.addLayer({id:"xr_module_land_layer",type:"fill",source:"xr_module_land_source","source-layer":"land",layout:{},paint:{"fill-color":"#fff","fill-opacity":1}}),yield fh(this.map),this.landMaskData=this.grabGlData(),this.map.removeLayer("xr_module_global_blackout_layer"),this.map.removeLayer("xr_module_land_layer"),this.map.removeSource("xr_module_global_blackout_source"),this.map.removeSource("xr_module_land_source"),yield fh(this.map),this.emit("endComputeLandMaskData",{})})}computeTerrainData_VIEWPORT(){return Wr(this,null,function*(){this.emit("startComputeTerrainData",{}),this.map.addSource("xr_module_terrain_source",{type:"raster",url:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json"}),this.map.addLayer({id:"xr_module_terrain_layer",source:"xr_module_terrain_source",type:"raster",minzoom:0,layout:{visibility:"visible"},paint:{"raster-opacity":1},filter:["all"]}),yield fh(this.map),this.terrainData=this.grabGlData(),this.map.removeLayer("xr_module_terrain_layer"),this.map.removeSource("xr_module_terrain_source"),yield fh(this.map),this.emit("endComputeTerrainData",{})})}computeTerrainData(){return Wr(this,null,function*(){var e;this.emit("startComputeTerrainData",{});const t=Math.min(Math.floor(this.map.getZoom()),V5),i=this.map.getBounds(),s=i.getNorth(),c=i.getSouth(),u=i.getEast(),a=i.getWest(),m=kI(t,a,s,!1),A={x:Math.floor(m.x),y:Math.floor(m.y)},x=kI(t,u,c,!1),b={x:Math.floor(x.x),y:Math.floor(x.y)},I=this.map.getSdkConfig(),E=this.map.getMaptilerSessionId(),T=yield H5(A,b,t,[`https://api.maptiler.com/tiles/terrain-rgb-v2/{z}/{x}/{y}.webp?key=${I.apiKey}&mtsid=${E}&module=xr`]),U=[Math.floor(ko*(m.x-A.x)),Math.floor(ko*(m.y-A.y))],P=[Math.ceil(ko*(x.x-m.x)),Math.ceil(ko*(x.y-m.y))],R=q5(U,P,T),X=(e=R.getContext("2d"))==null?void 0:e.getImageData(0,0,R.width,R.height).data;if(!X)throw new Error("Unable to extract terrain data.");this.terrainData={width:R.width,height:R.height,pixelData:new Uint8Array(X.buffer),bounds:i},this.emit("endComputeTerrainData",{})})}computeTextures(){return Wr(this,null,function*(){var e;if(this.enableTopView(),yield this.computeColorData(),yield this.computeTerrainData(),!this.colorData)throw new Error("The color texture is invalid.");this.mapCaptureBounds=this.map.getBounds();const t=this.mapCaptureBounds.getCenter(),i=new Rx(this.mapCaptureBounds.getWest(),t.lat),s=new Rx(this.mapCaptureBounds.getEast(),t.lat).distanceTo(i);this.meterPerPixelCenter=s/((e=this.colorData)==null?void 0:e.width),this.restoreMapSettings(),yield fh(this.map)})}init3DScene(){this.threeSceneGLTF=new xs,this.threeTileContainerGLTF=new Zi,this.threeSceneGLTF.add(this.threeTileContainerGLTF),this.threeTileContainerGLTF.rotation.set(-Math.PI/2,0,0),this.threeSceneUSDZ=new xs,this.threeTileContainerUSDZ=new Zi,this.threeSceneUSDZ.add(this.threeTileContainerUSDZ),this.threeTileContainerUSDZ.rotation.set(-Math.PI/2,0,0)}buildMapModel(){return Wr(this,null,function*(){if(!this.colorData)throw new Error("Color textures is not ready.");if(!this.terrainData)throw new Error("Terrain textures is not ready.");this.threeTileContainerGLTF.clear(),this.threeTileContainerUSDZ.clear(),this.dispose();const e=NI(this.colorData),t=e.getContext("2d");if(!t)throw new Error("Color texture not available");const i=new hi(this.options.edgeColor),s=i.clone().multiplyScalar(.65),c=i.clone().multiplyScalar(.5);t.fillStyle=`#${i.getHexString()}`;const u=Math.ceil(this.colorData.width/this.terrainData.width)*1.5;yield O5(t,u*2,Math.max(256,e.width/10)),t.fillRect(0,0,e.width-1,u),t.fillRect(0,e.height-1-u,e.width-1,e.height-1),t.fillStyle=`#${s.getHexString()}`,t.fillRect(0,0,u,e.height-1),t.fillRect(e.width-1-u,0,e.width-1,e.height-1);const a=new eb(e);a.flipY=!1,a.colorSpace=ni,a.colorSpace=zs,a.needsUpdate=!0,this.itemsToDispose.push(a),this.gltfMaterial=new ha({map:a,color:16777215}),this.usdzMaterial=new ha({map:a}),this.itemsToDispose.push(this.gltfMaterial),this.itemsToDispose.push(this.usdzMaterial);const m=this.mapCaptureBounds,A=m.getSouthEast().distanceTo(m.getSouthWest()),x=m.getSouthEast().distanceTo(m.getNorthEast()),b=new ka(A,x,this.terrainData.width-1,this.terrainData.height-1);this.mapMeshGLTF=new oi(b,this.gltfMaterial),this.mapMeshUSDZ=new oi(b,this.usdzMaterial);const I=b.attributes.position.array,E=this.terrainData.width,T=this.terrainData.height;let U=1/0;for(let q=0;q<I.length/3;q+=1){const te=this.terrainData.pixelData[q*4],ue=this.terrainData.pixelData[q*4+1],_e=this.terrainData.pixelData[q*4+2],K=-1e4+(te*256*256+ue*256+_e)*.1;K<U&&(U=K)}U=Math.max(0,~~(U/100)*100-100);for(let q=0;q<I.length/3;q+=1){const te=this.terrainData.pixelData[q*4],ue=this.terrainData.pixelData[q*4+1],_e=this.terrainData.pixelData[q*4+2];let K=-1e4+(te*256*256+ue*256+_e)*.1-U;const ce=q%E,Ve=~~(q/E);(ce===0||Ve===0||ce===E-1||Ve===T-1)&&(K=0),I[q*3+2]=K}b.computeVertexNormals(),this.itemsToDispose.push(b);const P=new ka(A,x,1,1),R=new ha({color:c}),X=new oi(P,R);X.rotateX(-Math.PI),this.itemsToDispose.push(P),this.itemsToDispose.push(R);const G=1*1/A;this.threeTileContainerGLTF.scale.x=G,this.threeTileContainerGLTF.scale.y=G,this.threeTileContainerGLTF.scale.z=G,this.threeTileContainerGLTF.add(this.mapMeshGLTF),this.threeTileContainerGLTF.add(X),this.threeTileContainerUSDZ.scale.x=G,this.threeTileContainerUSDZ.scale.y=G,this.threeTileContainerUSDZ.scale.z=G;const J=X.clone();this.threeTileContainerUSDZ.add(this.mapMeshUSDZ),this.threeTileContainerUSDZ.add(J)})}dispose(){for(;this.itemsToDispose.length;){const e=this.itemsToDispose.pop();e?.dispose()}}downloadGLTF(e=!1){this.threeTileContainerGLTF.updateMatrix(),this.threeTileContainerGLTF.updateMatrixWorld(),this.gltfExporter.parse(this.threeSceneGLTF,t=>{let i;if(e)i=new Blob([t],{type:"application/octet-stream"});else{const c=JSON.stringify(t,null,2);i=new Blob([c],{type:"text/plain"})}const s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=URL.createObjectURL(i),s.download=`maptiler_scene.${e?"glb":"gltf"}`,s.click()},t=>{console.log("error:",t)},{binary:e,maxTextureSize:8192})}downloadUSDZ(){return Wr(this,null,function*(){this.threeTileContainerUSDZ.updateMatrix(),this.threeTileContainerUSDZ.updateMatrixWorld();const e=yield this.getModelBlobUSDZ(),t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.href=URL.createObjectURL(e),t.download="maptiler_scene.usdz",t.click()})}getModelBlobGLB(){return Wr(this,null,function*(){return new Promise((e,t)=>{this.gltfExporter.parse(this.threeSceneGLTF,i=>{const s=new Blob([i],{type:"application/octet-stream"});e(s)},i=>{t(i)},{binary:!0,maxTextureSize:8192})})})}getModelBlobUSDZ(){return Wr(this,null,function*(){const e=yield new b5().parse(this.threeSceneUSDZ);return new Blob([e],{type:"model/vnd.usdz+zip"})})}displayModal(){return Wr(this,null,function*(){const e=this.map.getContainer(),t=yield this.getModelBlobGLB(),i=URL.createObjectURL(t);this.emit("computeEnd"),this.modelViewer=new lI,this.modelViewer.src=i,this.modelViewer.setAttribute("ar","true"),this.modelViewer.setAttribute("ar-modes","webxr quick-look"),this.modelViewer.setAttribute("camera-controls","true"),this.modelViewer.setAttribute("shadow-intensity","1"),this.modelViewer.style.width="100%",this.modelViewer.style.height="100%",this.modelViewer.style.zIndex="3",this.modelViewer.style.position="absolute",this.modelViewer.style.background=this.options.background,e.appendChild(this.modelViewer),this.arButton=document.createElement("button"),this.arButton.setAttribute("slot","ar-button"),this.arButton.id="maptiler-ar-enable-button",this.options.arButtonClassName?this.arButton.classList.add(this.options.arButtonClassName):Object.keys(OI).forEach(s=>{this.arButton.style[s]=OI[s]}),typeof this.options.arButtonContent=="string"?this.arButton.innerHTML=this.options.arButtonContent:this.arButton.appendChild(this.options.arButtonContent),this.modelViewer.appendChild(this.arButton),this.closeButton=document.createElement("button"),this.closeButton.id="maptiler-ar-close-button",this.options.closeButtonClassName?this.closeButton.classList.add(this.options.closeButtonClassName):Object.keys(zI).forEach(s=>{this.closeButton.style[s]=zI[s]}),typeof this.options.closeButtonContent=="string"?this.closeButton.innerHTML=this.options.closeButtonContent:this.closeButton.appendChild(this.options.closeButtonContent),this.modelViewer.appendChild(this.closeButton),this.closeButton.addEventListener("click",s=>Wr(this,null,function*(){this.close()}))})}close(){this.dispose(),V0(this.arButton),V0(this.modelViewer),V0(this.closeButton)}}nl.MaptilerARControl=j5,nl.mapTextureDataToCanvas=NI,Object.defineProperty(nl,"__esModule",{value:!0})});
//# sourceMappingURL=maptilerarcontrol.min.js.map
