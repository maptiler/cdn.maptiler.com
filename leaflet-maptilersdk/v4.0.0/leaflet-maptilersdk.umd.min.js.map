{"version":3,"file":"leaflet-maptilersdk.umd.min.js","sources":["../src/leaflet-maptilersdk.ts"],"sourcesContent":["import L from \"leaflet\";\nimport {\n  type HeatmapLayerOptions,\n  type LanguageInfo,\n  type MapStyleVariant,\n  type PointLayerOptions,\n  type PolygonLayerOptions,\n  type PolylineLayerOptions,\n  type ReferenceMapStyle,\n  type StyleSpecification,\n  type GeolocationType,\n  Map as MapSDK,\n  helpers,\n} from \"@maptiler/sdk\";\nimport packagejson from \"../package.json\";\nexport { Language, MapStyle } from \"@maptiler/sdk\";\n\n/**\n * A Maptiler Layer for Leaflet consists in adding a MapTiler SDK Map\n * inside of Leaflet as a custom layer.\n */\ninterface MaptilerLayerInterface extends L.Layer {\n  /**\n   * Get the Maptiler Map instance out of the layer.\n   * This can be convenient to add further events and logic.\n   */\n  getMaptilerSDKMap: () => MapSDK;\n\n  /**\n   * Get the HTML Canvas element where the MapTiler Map is\n   * instantiated.\n   */\n  getCanvas: () => HTMLCanvasElement;\n\n  /**\n   * Set the style of the internal MapTiler Map instance.\n   * The style can be one of the built-in list (as in `MaptilerStyle`)\n   * or a raw URL.\n   */\n  setStyle: (s: null | ReferenceMapStyle | MapStyleVariant | StyleSpecification | string) => void;\n\n  /**\n   * Set the language of the map from the built-in list of\n   * supported languages (see `Language`)\n   */\n  setLanguage: (l: LanguageInfo | string) => void;\n\n  /**\n   * Add a heatmap layer from a geoJSON datasource or a\n   * dataset hosted on MapTiler Cloud account.\n   * Read more about helpers at\n   * https://github.com/maptiler/maptiler-sdk-js#vector-layer-helpers\n   */\n  addHeatmap: (options: HeatmapLayerOptions) => {\n    heatmapLayerId: string;\n    heatmapSourceId: string;\n  };\n\n  /**\n   * Add a polygon layer from a geoJSON datasource or a\n   * dataset hosted on MapTiler Cloud account.\n   * Read more about helpers at\n   * https://github.com/maptiler/maptiler-sdk-js#vector-layer-helpers\n   */\n  addPolygon: (options: PolygonLayerOptions) => {\n    polygonLayerId: string;\n    polygonOutlineLayerId: string;\n    polygonSourceId: string;\n  };\n\n  /**\n   * Add a point layer from a geoJSON datasource or a\n   * dataset hosted on MapTiler Cloud account.\n   * Read more about helpers at\n   * https://github.com/maptiler/maptiler-sdk-js#vector-layer-helpers\n   */\n  addPoint: (options: PointLayerOptions) => {\n    pointLayerId: string;\n    clusterLayerId: string;\n    labelLayerId: string;\n    pointSourceId: string;\n  };\n\n  /**\n   * Add a polyline layer from a geoJSON datasource or a\n   * dataset hosted on MapTiler Cloud account.\n   * Read more about helpers at\n   * https://github.com/maptiler/maptiler-sdk-js#vector-layer-helpers\n   */\n  addPolyline: (options: PolylineLayerOptions) => Promise<{\n    polylineLayerId: string;\n    polylineOutlineLayerId: string;\n    polylineSourceId: string;\n  }>;\n\n  /**\n   * Take a screenshot of the displayed map.\n   * Read more about this feature at\n   * https://github.com/maptiler/maptiler-sdk-js#take-screenshots-programmatically\n   */\n  takeScreenshot: (options?: {\n    download?: boolean;\n    filename?: string;\n  }) => Promise<Blob>;\n}\n\n/**\n * Options to create a MaptilerLayer\n */\nexport type MaptilerLayerOptions = {\n  /**\n   * Maptiler Cloud API key\n   */\n  apiKey: string;\n  /**\n   * Style hosted on MapTiler Cloud or raw URL.\n   * Default: MapTiler Streets style\n   */\n  style?: ReferenceMapStyle | MapStyleVariant | StyleSpecification | string;\n  /**\n   * Language for the map to display\n   * Default: uses the language as defined in the style\n   */\n  language?: LanguageInfo | string;\n\n  /**\n   * If the value is `true` or `\"POINT\"` then the positionning uses the MapTiler Cloud\n   * Geolocation to find the non-GPS location point.\n   *\n   * If the value is `\"COUNTRY\"` then the map is centered around the bounding box of the country.\n   *\n   * If the value is `false`, no geolocation is performed and the map centering and zooming depends on other options or on\n   * the built-in defaults.\n   *\n   * Default: `false`\n   */\n  geolocate?: (typeof GeolocationType)[keyof typeof GeolocationType] | boolean;\n};\n\n/**\n * A Maptiler Layer for Leaflet consists in adding a MapTiler SDK Map\n * inside of Leaflet as a custom layer.\n */\nexport const MaptilerLayer = L.Layer.extend({\n  options: {\n    updateInterval: 32,\n    // How much to extend the overlay view (relative to map size)\n    // e.g. 0.1 would be 10% of map view in each direction\n    padding: 0.1,\n    // whether or not to register the mouse and keyboard\n    // events on the maptiler sdk overlay\n    interactive: false,\n    // set the tilepane as the default pane to draw gl tiles\n    pane: \"tilePane\",\n  },\n\n  map: null,\n\n  initialize: function (options: unknown) {\n    L.setOptions(this, options);\n\n    // setup throttling the update event when panning\n    this._throttledUpdate = L.Util.throttle(this._update, this.options.updateInterval, this);\n  },\n\n  onAdd: function (map: L.Map) {\n    if (!this._container) {\n      this._initContainer();\n    }\n\n    const paneName = this.getPaneName();\n    map.getPane(paneName)?.appendChild(this._container);\n\n    this._initMaptilerSDK();\n\n    this._offset = this._map.containerPointToLayerPoint([0, 0]);\n\n    // work around https://github.com/mapbox/mapbox-gl-leaflet/issues/47\n    if (map.options.zoomAnimation) {\n      L.DomEvent.on(\n        // @ts-ignore\n        map._proxy,\n        L.DomUtil.TRANSITION_END,\n        this._transitionEnd,\n        this,\n      );\n    }\n\n    // Adding MapTiler attribution\n    map.attributionControl.addAttribution(\n      '\\u003ca href=\"https://www.maptiler.com/copyright/\" target=\"_blank\"\\u003e\\u0026copy; MapTiler\\u003c/a\\u003e \\u003ca href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\"\\u003e\\u0026copy; OpenStreetMap contributors\\u003c/a\\u003e',\n    );\n  },\n\n  onRemove: function (map: L.Map) {\n    if (this._map._proxy && this._map.options.zoomAnimation) {\n      L.DomEvent.off(this._map._proxy, L.DomUtil.TRANSITION_END, this._transitionEnd, this);\n    }\n    const paneName = this.getPaneName();\n    map.getPane(paneName)?.removeChild(this._container);\n\n    this._maptilerMap.remove();\n    this._maptilerMap = null;\n  },\n\n  getEvents: function () {\n    return {\n      move: this._throttledUpdate, // sensibly throttle updating while panning\n      zoomanim: this._animateZoom, // applys the zoom animation to the <canvas>\n      zoom: this._pinchZoom, // animate every zoom event for smoother pinch-zooming\n      zoomstart: this._zoomStart, // flag starting a zoom to disable panning\n      zoomend: this._zoomEnd,\n      resize: this._resize,\n    };\n  },\n\n  getMaptilerSDKMap: function (): MapSDK {\n    return this._maptilerMap;\n  },\n\n  getCanvas: function (): HTMLCanvasElement {\n    return this._maptilerMap.getCanvas();\n  },\n\n  getSize: function (): L.Point {\n    return (this._map as L.Map).getSize().multiplyBy(1 + this.options.padding * 2);\n  },\n\n  getBounds: function (): L.LatLngBounds {\n    const halfSize = this.getSize().multiplyBy(0.5);\n    const center = this._map.latLngToContainerPoint(this._map.getCenter());\n    return L.latLngBounds(\n      this._map.containerPointToLatLng(center.subtract(halfSize)),\n      this._map.containerPointToLatLng(center.add(halfSize)),\n    );\n  },\n\n  getContainer: function (): HTMLDivElement {\n    return this._container;\n  },\n\n  // returns the pane name set in options if it is a valid pane, defaults to tilePane\n  getPaneName: function (): string {\n    return this._map.getPane(this.options.pane) ? this.options.pane : \"tilePane\";\n  },\n\n  setStyle: function (s: null | ReferenceMapStyle | MapStyleVariant | StyleSpecification | string) {\n    this._maptilerMap.setStyle(s);\n  },\n\n  setLanguage: function (l: LanguageInfo | string) {\n    this._maptilerMap.setLanguage(l);\n  },\n\n  _roundPoint: (p: L.Point) => ({ x: Math.round(p.x), y: Math.round(p.y) }),\n\n  _initContainer: function () {\n    this._container = L.DomUtil.create(\"div\", \"leaflet-gl-layer\");\n\n    const size = this.getSize();\n    const offset = this._map.getSize().multiplyBy(this.options.padding);\n    this._container.style.width = `${size.x}px`;\n    this._container.style.height = `${size.y}px`;\n\n    const topLeft = (this._map as L.Map).containerPointToLayerPoint([0, 0]).subtract(offset);\n    L.DomUtil.setPosition(this._container, this._roundPoint(topLeft));\n  },\n\n  _initMaptilerSDK: function () {\n    const center = this._map.getCenter();\n    const options = {\n      ...this.options,\n      projection: \"mercator\",\n      container: this._container,\n      center: [center.lng, center.lat],\n      zoom: this._map.getZoom() - 1,\n      attributionControl: false,\n    };\n\n    // if the geolocate MapTiiler SDK option was given, then the center should be removed\n    if (this.options.geolocate) {\n      options.center = undefined;\n      options.zoom = undefined;\n    }\n\n    this._maptilerMap = new MapSDK(options);\n\n    this._maptilerMap.telemetry.registerModule(packagejson.name, packagejson.version);\n\n    this._maptilerMap.once(\"load\", () => {\n      this.fire(\"ready\");\n    });\n\n    this._maptilerMap.once(\"load\", async () => {\n      let tileJsonContent = { logo: null };\n\n      try {\n        const possibleSources = Object.keys(this._maptilerMap.style.sourceCaches)\n          .map((sourceName) => this._maptilerMap.getSource(sourceName))\n          .filter((s) => s && \"url\" in s && typeof s.url === \"string\" && s?.url.includes(\"tiles.json\"));\n\n        const styleUrl = new URL(possibleSources[0].url);\n\n        if (!styleUrl.searchParams.has(\"key\")) {\n          styleUrl.searchParams.append(\"key\", options.apiKey);\n        }\n\n        const tileJsonRes = await fetch(styleUrl.href);\n        tileJsonContent = await tileJsonRes.json();\n      } catch (e) {\n        // No tiles.json found (should not happen on maintained styles)\n      }\n\n      if (tileJsonContent.logo || options.maptilerLogo) {\n        const logoURL = tileJsonContent.logo ?? \"https://api.maptiler.com/resources/logo.svg\";\n\n        // Adding MapTiler logo + link\n        const maptilerLink = document.createElement(\"a\");\n        maptilerLink.href = \"https://www.maptiler.com\";\n        maptilerLink.style.setProperty(\"position\", \"absolute\");\n        maptilerLink.style.setProperty(\"left\", \"10px\");\n        maptilerLink.style.setProperty(\"bottom\", \"2px\");\n        maptilerLink.style.setProperty(\"z-index\", \"999\");\n        const maptilerLogo = document.createElement(\"img\");\n        maptilerLogo.src = logoURL;\n        maptilerLogo.alt = \"MapTiler logo\";\n        maptilerLogo.width = 100;\n        maptilerLogo.height = 30;\n        maptilerLink.appendChild(maptilerLogo);\n        this._map.getContainer().appendChild(maptilerLink);\n      }\n    });\n\n    this._maptilerMap.transform.freezeElevation = true;\n\n    // if the geolocate MapTiiler SDK option was given, then we need to propagate the actual center to Leaflet map\n    if (this.options.geolocate) {\n      this._maptilerMap.on(\"load\", () => {\n        this._map.setView(this._maptilerMap.getCenter(), this._maptilerMap.getZoom() + 1);\n      });\n    }\n\n    // allow GL base map to pan beyond min/max latitudes\n    this._transformGL();\n    this._maptilerMap._actualCanvas = this._maptilerMap._canvas;\n\n    // treat child <canvas> element like L.ImageOverlay\n    const canvas = this._maptilerMap._actualCanvas;\n    L.DomUtil.addClass(canvas, \"leaflet-image-layer\");\n    L.DomUtil.addClass(canvas, \"leaflet-zoom-animated\");\n    if (this.options.interactive) {\n      L.DomUtil.addClass(canvas, \"leaflet-interactive\");\n    }\n    if (this.options.className) {\n      L.DomUtil.addClass(canvas, this.options.className);\n    }\n\n    // Helper: heatmap\n    this.addHeatmap = (\n      options: HeatmapLayerOptions,\n    ): {\n      heatmapLayerId: string;\n      heatmapSourceId: string;\n    } => {\n      return helpers.addHeatmap(this._maptilerMap, options);\n    };\n\n    // Helper: polygon\n    this.addPolygon = (\n      options: PolygonLayerOptions,\n    ): {\n      polygonLayerId: string;\n      polygonOutlineLayerId: string;\n      polygonSourceId: string;\n    } => {\n      return helpers.addPolygon(this._maptilerMap, options);\n    };\n\n    // Helper: point\n    this.addPoint = (\n      options: PointLayerOptions,\n    ): {\n      pointLayerId: string;\n      clusterLayerId: string;\n      labelLayerId: string;\n      pointSourceId: string;\n    } => {\n      return helpers.addPoint(this._maptilerMap, options);\n    };\n\n    // Helper: polyline\n    this.addPolyline = (\n      options: PolylineLayerOptions,\n    ): Promise<{\n      polylineLayerId: string;\n      polylineOutlineLayerId: string;\n      polylineSourceId: string;\n    }> => {\n      return helpers.addPolyline(this._maptilerMap, options);\n    };\n\n    // Helper: sceenshot\n    this.takeScreenshot = (options?: {\n      download?: boolean;\n      filename?: string;\n    }): Promise<Blob> => {\n      return helpers.takeScreenshot(this._maptilerMap, options);\n    };\n  },\n\n  _update: function () {\n    // update the offset so we can correct for it later when we zoom\n    this._offset = this._map.containerPointToLayerPoint([0, 0]);\n\n    if (this._zooming) {\n      return;\n    }\n\n    const size = this.getSize();\n    const offset = this._map.getSize().multiplyBy(this.options.padding);\n    const topLeft = this._map.containerPointToLayerPoint([0, 0]).subtract(offset);\n\n    L.DomUtil.setPosition(this._container, this._roundPoint(topLeft));\n\n    this._transformGL();\n\n    if (this._maptilerMap.transform.width !== size.x || this._maptilerMap.transform.height !== size.y) {\n      this._container.style.width = `${size.x}px`;\n      this._container.style.height = `${size.y}px`;\n      if (this._maptilerMap._resize !== null && this._maptilerMap._resize !== undefined) {\n        this._maptilerMap._resize();\n      } else {\n        this._maptilerMap.resize();\n      }\n    } else {\n      // older versions of mapbox-gl surfaced update publicly\n      if (this._maptilerMap._update !== null && this._maptilerMap._update !== undefined) {\n        this._maptilerMap._update();\n      } else {\n        this._maptilerMap.update();\n      }\n    }\n  },\n\n  _transformGL: function () {\n    this._maptilerMap.setCenter(this._map.getCenter());\n    this._maptilerMap.setZoom(this._map.getZoom() - 1);\n  },\n\n  // update the map constantly during a pinch zoom\n  _pinchZoom: function () {\n    this._maptilerMap.jumpTo({\n      zoom: this._map.getZoom() - 1,\n      center: this._map.getCenter(),\n    });\n  },\n\n  // borrowed from L.ImageOverlay\n  // https://github.com/Leaflet/Leaflet/blob/master/src/layer/ImageOverlay.js#L139-L144\n  _animateZoom: function (e: L.ZoomAnimEvent) {\n    const scale = this._map.getZoomScale(e.zoom);\n    const padding = this._map.getSize().multiplyBy(this.options.padding * scale);\n    const viewHalf = this.getSize()._divideBy(2);\n    // corrections for padding (scaled), adapted from\n    // https://github.com/Leaflet/Leaflet/blob/master/src/map/Map.js#L1490-L1508\n    const topLeft = this._map\n      .project(e.center, e.zoom)\n      ._subtract(viewHalf)\n      ._add(this._map._getMapPanePos().add(padding))\n      ._round();\n    const offset = this._map.project(this._map.getBounds().getNorthWest(), e.zoom)._subtract(topLeft);\n\n    L.DomUtil.setTransform(this._maptilerMap.getCanvas(), offset.subtract(this._offset), scale);\n  },\n\n  _zoomStart: function () {\n    this._zooming = true;\n  },\n\n  _zoomEnd: function () {\n    const scale = this._map.getZoomScale(this._map.getZoom());\n\n    L.DomUtil.setTransform(\n      this._maptilerMap.getCanvas(),\n      // https://github.com/mapbox/mapbox-gl-leaflet/pull/130\n      new L.Point(0, 0),\n      scale,\n    );\n\n    this._zooming = false;\n    this._update();\n  },\n\n  _transitionEnd: function () {\n    L.Util.requestAnimFrame(() => {\n      const zoom = this._map.getZoom();\n      const center = this._map.getCenter();\n      const offset = this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());\n\n      // reset the scale and offset\n      L.DomUtil.setTransform(this._maptilerMap._actualCanvas, offset, 1);\n\n      // enable panning once the gl map is ready again\n      this._maptilerMap.once(\n        \"moveend\",\n        L.Util.bind(() => {\n          this._zoomEnd();\n        }, this),\n      );\n\n      // update the map position\n      this._maptilerMap.jumpTo({\n        center: center,\n        zoom: zoom - 1,\n      });\n    }, this);\n  },\n\n  // @ts-ignore\n  _resize: function (e) {\n    this._transitionEnd(e);\n  },\n}) as {\n  new (options: MaptilerLayerOptions): MaptilerLayerInterface;\n} & typeof L.Layer;\n\n/**\n * Factory function to instantiate a MaptilerLayer.\n * Does exactly the same as calling `new MaptilerLayer(options)`\n */\nexport function maptilerLayer(options: MaptilerLayerOptions) {\n  return new MaptilerLayer(options);\n}\n"],"names":["MaptilerLayer","L","options","map","paneName","_a","halfSize","center","s","l","p","size","offset","topLeft","MapSDK","packagejson","tileJsonContent","possibleSources","sourceName","styleUrl","logoURL","maptilerLink","maptilerLogo","canvas","helpers","e","scale","padding","viewHalf","zoom","maptilerLayer"],"mappings":"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"}