(function(o,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("leaflet"),require("@maptiler/sdk")):typeof define=="function"&&define.amd?define(["exports","leaflet","@maptiler/sdk"],e):(o=typeof globalThis<"u"?globalThis:o||self,e(o.leafletmaptilersdk=o.leafletmaptilersdk||{},o.L,o.maptilersdk))})(this,function(o,e,r){"use strict";const h={name:"@maptiler/leaflet-maptilersdk",version:"4.0.0",description:"Vector tiles basemap plugin for Leaflet - multi-lingual basemaps using MapTiler SDK",module:"dist/leaflet-maptilersdk.js",type:"module",exports:{".":{import:"./dist/leaflet-maptilersdk.js",types:"./dist/leaflet-maptilersdk.d.ts"}},author:"MapTiler",keywords:["maptiler","plugin","leaflet","layer"],scripts:{biome:"biome check --max-diagnostics=1000","biome:fix":"npx @biomejs/biome check --max-diagnostics=1000 --write",build:"npm run build:es && npm run build:umd","build:umd":"vite build -c vite.config-umd.js","build:es":"vite build -c vite.config-es.js","dev:umd":"NODE_ENV=development vite build -w -c vite.config-umd.ts","dev:es":"NODE_ENV=development vite build -w -c vite.config-es.ts",make:"npm run biome:fix && npm run build",dev:'concurrently "vite -c vite.config-dev.ts" "npm run dev-umd"',"dev-umd":"tsc && NODE_ENV=development vite build -w -c vite.config-umd.ts",ncu:"npx npm-check-updates"},repository:{type:"git",url:"https://github.com/maptiler/leaflet-maptilersdk.git"},license:"",devDependencies:{"@biomejs/biome":"^1.9.4","@types/leaflet":"^1.9.15","@types/node":"^22.10.5",concurrently:"^9.1.2",typescript:"^5.7.2",vite:"^4.4.8","vite-plugin-dts":"^4.3.0"},dependencies:{"@maptiler/sdk":"^3.0.0",leaflet:"^1.9.4"}},c=e.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},map:null,initialize:function(t){e.setOptions(this,t),this._throttledUpdate=e.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(t){var n;this._container||this._initContainer();const i=this.getPaneName();(n=t.getPane(i))==null||n.appendChild(this._container),this._initMaptilerSDK(),this._offset=this._map.containerPointToLayerPoint([0,0]),t.options.zoomAnimation&&e.DomEvent.on(t._proxy,e.DomUtil.TRANSITION_END,this._transitionEnd,this),t.attributionControl.addAttribution('<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>')},onRemove:function(t){var n;this._map._proxy&&this._map.options.zoomAnimation&&e.DomEvent.off(this._map._proxy,e.DomUtil.TRANSITION_END,this._transitionEnd,this);const i=this.getPaneName();(n=t.getPane(i))==null||n.removeChild(this._container),this._maptilerMap.remove(),this._maptilerMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaptilerSDKMap:function(){return this._maptilerMap},getCanvas:function(){return this._maptilerMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getBounds:function(){const t=this.getSize().multiplyBy(.5),i=this._map.latLngToContainerPoint(this._map.getCenter());return e.latLngBounds(this._map.containerPointToLatLng(i.subtract(t)),this._map.containerPointToLatLng(i.add(t)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},setStyle:function(t){this._maptilerMap.setStyle(t)},setLanguage:function(t){this._maptilerMap.setLanguage(t)},_roundPoint:t=>({x:Math.round(t.x),y:Math.round(t.y)}),_initContainer:function(){this._container=e.DomUtil.create("div","leaflet-gl-layer");const t=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=`${t.x}px`,this._container.style.height=`${t.y}px`;const n=this._map.containerPointToLayerPoint([0,0]).subtract(i);e.DomUtil.setPosition(this._container,this._roundPoint(n))},_initMaptilerSDK:function(){const t=this._map.getCenter(),i={...this.options,projection:"mercator",container:this._container,center:[t.lng,t.lat],zoom:this._map.getZoom()-1,attributionControl:!1};this.options.geolocate&&(i.center=void 0,i.zoom=void 0),this._maptilerMap=new r.Map(i),this._maptilerMap.telemetry.registerModule(h.name,h.version),this._maptilerMap.once("load",()=>{this.fire("ready")}),this._maptilerMap.once("load",async()=>{let a={logo:null};try{const l=Object.keys(this._maptilerMap.style.sourceCaches).map(p=>this._maptilerMap.getSource(p)).filter(p=>p&&"url"in p&&typeof p.url=="string"&&(p==null?void 0:p.url.includes("tiles.json"))),s=new URL(l[0].url);s.searchParams.has("key")||s.searchParams.append("key",i.apiKey),a=await(await fetch(s.href)).json()}catch{}if(a.logo||i.maptilerLogo){const l=a.logo??"https://api.maptiler.com/resources/logo.svg",s=document.createElement("a");s.href="https://www.maptiler.com",s.style.setProperty("position","absolute"),s.style.setProperty("left","10px"),s.style.setProperty("bottom","2px"),s.style.setProperty("z-index","999");const m=document.createElement("img");m.src=l,m.alt="MapTiler logo",m.width=100,m.height=30,s.appendChild(m),this._map.getContainer().appendChild(s)}}),this._maptilerMap.transform.freezeElevation=!0,this.options.geolocate&&this._maptilerMap.on("load",()=>{this._map.setView(this._maptilerMap.getCenter(),this._maptilerMap.getZoom()+1)}),this._transformGL(),this._maptilerMap._actualCanvas=this._maptilerMap._canvas;const n=this._maptilerMap._actualCanvas;e.DomUtil.addClass(n,"leaflet-image-layer"),e.DomUtil.addClass(n,"leaflet-zoom-animated"),this.options.interactive&&e.DomUtil.addClass(n,"leaflet-interactive"),this.options.className&&e.DomUtil.addClass(n,this.options.className),this.addHeatmap=a=>r.helpers.addHeatmap(this._maptilerMap,a),this.addPolygon=a=>r.helpers.addPolygon(this._maptilerMap,a),this.addPoint=a=>r.helpers.addPoint(this._maptilerMap,a),this.addPolyline=a=>r.helpers.addPolyline(this._maptilerMap,a),this.takeScreenshot=a=>r.helpers.takeScreenshot(this._maptilerMap,a)},_update:function(){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const t=this.getSize(),i=this._map.getSize().multiplyBy(this.options.padding),n=this._map.containerPointToLayerPoint([0,0]).subtract(i);e.DomUtil.setPosition(this._container,this._roundPoint(n)),this._transformGL(),this._maptilerMap.transform.width!==t.x||this._maptilerMap.transform.height!==t.y?(this._container.style.width=`${t.x}px`,this._container.style.height=`${t.y}px`,this._maptilerMap._resize!==null&&this._maptilerMap._resize!==void 0?this._maptilerMap._resize():this._maptilerMap.resize()):this._maptilerMap._update!==null&&this._maptilerMap._update!==void 0?this._maptilerMap._update():this._maptilerMap.update()},_transformGL:function(){this._maptilerMap.setCenter(this._map.getCenter()),this._maptilerMap.setZoom(this._map.getZoom()-1)},_pinchZoom:function(){this._maptilerMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(t){const i=this._map.getZoomScale(t.zoom),n=this._map.getSize().multiplyBy(this.options.padding*i),a=this.getSize()._divideBy(2),l=this._map.project(t.center,t.zoom)._subtract(a)._add(this._map._getMapPanePos().add(n))._round(),s=this._map.project(this._map.getBounds().getNorthWest(),t.zoom)._subtract(l);e.DomUtil.setTransform(this._maptilerMap.getCanvas(),s.subtract(this._offset),i)},_zoomStart:function(){this._zooming=!0},_zoomEnd:function(){const t=this._map.getZoomScale(this._map.getZoom());e.DomUtil.setTransform(this._maptilerMap.getCanvas(),new e.Point(0,0),t),this._zooming=!1,this._update()},_transitionEnd:function(){e.Util.requestAnimFrame(()=>{const t=this._map.getZoom(),i=this._map.getCenter(),n=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());e.DomUtil.setTransform(this._maptilerMap._actualCanvas,n,1),this._maptilerMap.once("moveend",e.Util.bind(()=>{this._zoomEnd()},this)),this._maptilerMap.jumpTo({center:i,zoom:t-1})},this)},_resize:function(t){this._transitionEnd(t)}});function d(t){return new c(t)}Object.defineProperty(o,"Language",{enumerable:!0,get:()=>r.Language}),Object.defineProperty(o,"MapStyle",{enumerable:!0,get:()=>r.MapStyle}),o.MaptilerLayer=c,o.maptilerLayer=d,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});typeof L<"u"&&typeof leafletmaptilersdk<"u"&&(L.maptiler={},Object.keys(leafletmaptilersdk).forEach(o=>{L.maptiler[o]=leafletmaptilersdk[o]}));
//# sourceMappingURL=leaflet-maptilersdk.umd.min.js.map
