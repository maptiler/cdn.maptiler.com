(function(de,Bt){typeof exports=="object"&&typeof module<"u"?Bt(exports,require("ol")):typeof define=="function"&&define.amd?define(["exports","ol"],Bt):(de=typeof globalThis<"u"?globalThis:de||self,Bt(de.openlayersMaptilerGeocodingController={},de.ol))})(this,function(de,Bt){"use strict";var Jw=Object.defineProperty;var Kw=(de,Bt,Ke)=>Bt in de?Jw(de,Bt,{enumerable:!0,configurable:!0,writable:!0,value:Ke}):de[Bt]=Ke;var Uy=(de,Bt,Ke)=>Kw(de,typeof Bt!="symbol"?Bt+"":Bt,Ke);class Ke{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Jl={PROPERTYCHANGE:"propertychange"};class jy{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Vy(i,t,e){let r,s;e=e||li;let u=0,h=i.length,f=!1;for(;u<h;)r=u+(h-u>>1),s=+e(i[r],t),s<0?u=r+1:(h=r,f=!s);return f?u:~u}function li(i,t){return i>t?1:i<t?-1:0}function Kl(i,t,e){if(i[0]<=t)return 0;const r=i.length;if(t<=i[r-1])return r-1;if(typeof e=="function"){for(let s=1;s<r;++s){const u=i[s];if(u===t)return s;if(u<t)return e(t,i[s-1],u)>0?s-1:s}return r-1}if(e>0){for(let s=1;s<r;++s)if(i[s]<t)return s-1;return r-1}if(e<0){for(let s=1;s<r;++s)if(i[s]<=t)return s;return r-1}for(let s=1;s<r;++s){if(i[s]==t)return s;if(i[s]<t)return i[s-1]-t<t-i[s]?s-1:s}return r-1}function Zy(i,t,e){for(;t<e;){const r=i[t];i[t]=i[e],i[e]=r,++t,--e}}function Qe(i,t){const e=Array.isArray(t)?t:[t],r=e.length;for(let s=0;s<r;s++)i[i.length]=e[s]}function Bi(i,t){const e=i.length;if(e!==t.length)return!1;for(let r=0;r<e;r++)if(i[r]!==t[r])return!1;return!0}function Hy(){return!0}function Or(){}function Ql(i){let t=!1,e,r,s;return function(){const u=Array.prototype.slice.call(arguments);return(!t||this!==s||!Bi(u,r))&&(t=!0,s=this,r=u,e=i.apply(this,arguments)),e}}function da(i){for(const t in i)delete i[t]}function Yi(i){let t;for(t in i)return!1;return!t}class th extends jy{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const r=this.listeners_||(this.listeners_={}),s=r[t]||(r[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",r=e?t:t.type,s=this.listeners_&&this.listeners_[r];if(!s)return;const u=e?new Ke(t):t;u.target||(u.target=this.eventTarget_||this);const h=this.dispatching_||(this.dispatching_={}),f=this.pendingRemovals_||(this.pendingRemovals_={});r in h||(h[r]=0,f[r]=0),++h[r];let g;for(let y=0,p=s.length;y<p;++y)if("handleEvent"in s[y]?g=s[y].handleEvent(u):g=s[y].call(this,u),g===!1||u.propagationStopped){g=!1;break}if(--h[r]===0){let y=f[r];for(delete f[r];y--;)this.removeEventListener(r,Or);delete h[r]}return g}disposeInternal(){this.listeners_&&da(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const r=this.listeners_[t];if(!r)return;const s=r.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[s]=Or,++this.pendingRemovals_[t]):(r.splice(s,1),r.length===0&&delete this.listeners_[t]))}}const Ge={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function dn(i,t,e,r,s){if(r&&r!==i&&(e=e.bind(r)),s){const h=e;e=function(){i.removeEventListener(t,e),h.apply(this,arguments)}}const u={target:i,type:t,listener:e};return i.addEventListener(t,e),u}function eh(i,t,e,r){return dn(i,t,e,r,!0)}function On(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),da(i))}class Lr extends th{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Ge.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const r=t.length,s=new Array(r);for(let u=0;u<r;++u)s[u]=dn(this,t[u],e);return s}return dn(this,t,e)}onceInternal(t,e){let r;if(Array.isArray(t)){const s=t.length;r=new Array(s);for(let u=0;u<s;++u)r[u]=eh(this,t[u],e)}else r=eh(this,t,e);return e.ol_key=r,r}unInternal(t,e){const r=e.ol_key;if(r)Jy(r);else if(Array.isArray(t))for(let s=0,u=t.length;s<u;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}Lr.prototype.on,Lr.prototype.once,Lr.prototype.un;function Jy(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)On(i[t]);else On(i)}function bt(){throw new Error("Unimplemented abstract method.")}let Ky=0;function jt(i){return i.ol_uid||(i.ol_uid=String(++Ky))}class nh extends Ke{constructor(t,e,r){super(t),this.key=e,this.oldValue=r}}class zi extends Lr{constructor(t){super(),this.on,this.once,this.un,jt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new nh(r,t,e)),r=Jl.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new nh(r,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,r){const s=this.values_||(this.values_={});if(r)s[t]=e;else{const u=s[t];s[t]=e,u!==e&&this.notify(t,u)}}setProperties(t,e){for(const r in t)this.set(r,t[r],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const r=this.values_[t];delete this.values_[t],Yi(this.values_)&&(this.values_=null),e||this.notify(t,r)}}}function Jt(i,t){if(!i)throw new Error(t)}new Array(6);function yn(){return[1,0,0,1,0,0]}function Qy(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function le(i,t){const e=t[0],r=t[1];return t[0]=i[0]*e+i[2]*r+i[4],t[1]=i[1]*e+i[3]*r+i[5],t}function hi(i,t,e,r,s,u,h,f){const g=Math.sin(u),y=Math.cos(u);return i[0]=r*y,i[1]=s*g,i[2]=-r*g,i[3]=s*y,i[4]=h*r*y-f*r*g+t,i[5]=h*s*g+f*s*y+e,i}function tp(i,t){const e=ep(t);Jt(e!==0,"Transformation matrix cannot be inverted");const r=t[0],s=t[1],u=t[2],h=t[3],f=t[4],g=t[5];return i[0]=h/e,i[1]=-s/e,i[2]=-u/e,i[3]=r/e,i[4]=(u*g-h*f)/e,i[5]=-(r*g-s*f)/e,i}function ep(i){return i[0]*i[3]-i[1]*i[2]}const ih=[1e6,1e6,1e6,1e6,2,2];function np(i){return"matrix("+i.map((e,r)=>Math.round(e*ih[r])/ih[r]).join(", ")+")"}const $t={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function ip(i,t,e){const r=Math.min.apply(null,i),s=Math.min.apply(null,t),u=Math.max.apply(null,i),h=Math.max.apply(null,t);return gi(r,s,u,h,e)}function ya(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function rp(i,t){return i.slice()}function ci(i,t,e){let r,s;return t<i[0]?r=i[0]-t:i[2]<t?r=t-i[2]:r=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,r*r+s*s}function pa(i,t){return ma(i,t[0],t[1])}function $i(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function ma(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function va(i,t){const e=i[0],r=i[1],s=i[2],u=i[3],h=t[0],f=t[1];let g=$t.UNKNOWN;return h<e?g=g|$t.LEFT:h>s&&(g=g|$t.RIGHT),f<r?g=g|$t.BELOW:f>u&&(g=g|$t.ABOVE),g===$t.UNKNOWN&&(g=$t.INTERSECTING),g}function fi(){return[1/0,1/0,-1/0,-1/0]}function gi(i,t,e,r,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=r,s):[i,t,e,r]}function Ps(i){return gi(1/0,1/0,-1/0,-1/0,i)}function rh(i,t){const e=i[0],r=i[1];return gi(e,r,e,r,t)}function _a(i,t,e,r,s){const u=Ps(s);return oh(u,i,t,e,r)}function sh(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function sp(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function op(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function oh(i,t,e,r,s){for(;e<r;e+=s)ap(i,t[e],t[e+1]);return i}function ap(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function up(i,t){let e;return e=t(ah(i)),e||(e=t(uh(i)),e)||(e=t(hh(i)),e)||(e=t(lh(i)),e)?e:!1}function ah(i){return[i[0],i[1]]}function uh(i){return[i[2],i[1]]}function di(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function lp(i,t,e,r,s){const[u,h,f,g,y,p,m,_]=hp(i,t,e,r);return gi(Math.min(u,f,y,m),Math.min(h,g,p,_),Math.max(u,f,y,m),Math.max(h,g,p,_),s)}function hp(i,t,e,r){const s=t*r[0]/2,u=t*r[1]/2,h=Math.cos(e),f=Math.sin(e),g=s*h,y=s*f,p=u*h,m=u*f,_=i[0],x=i[1];return[_-g+m,x-y-p,_-g-m,x-y+p,_+g-m,x+y+p,_+g+m,x+y-p,_-g+m,x-y-p]}function pn(i){return i[3]-i[1]}function lh(i){return[i[0],i[3]]}function hh(i){return[i[2],i[3]]}function he(i){return i[2]-i[0]}function Be(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function xa(i){return i[2]<i[0]||i[3]<i[1]}function cp(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function fp(i,t,e){let r=!1;const s=va(i,t),u=va(i,e);if(s===$t.INTERSECTING||u===$t.INTERSECTING)r=!0;else{const h=i[0],f=i[1],g=i[2],y=i[3],p=t[0],m=t[1],_=e[0],x=e[1],I=(x-m)/(_-p);let k,C;u&$t.ABOVE&&!(s&$t.ABOVE)&&(k=_-(x-y)/I,r=k>=h&&k<=g),!r&&u&$t.RIGHT&&!(s&$t.RIGHT)&&(C=x-(_-g)*I,r=C>=f&&C<=y),!r&&u&$t.BELOW&&!(s&$t.BELOW)&&(k=_-(x-f)/I,r=k>=h&&k<=g),!r&&u&$t.LEFT&&!(s&$t.LEFT)&&(C=x-(_-h)*I,r=C>=f&&C<=y)}return r}function gp(i,t,e,r){if(xa(i))return Ps(e);let s=[];s=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]],t(s,s,2);const u=[],h=[];for(let f=0,g=s.length;f<g;f+=2)u.push(s[f]),h.push(s[f+1]);return ip(u,h,e)}function ch(i,t){const e=t.getExtent(),r=di(i);if(t.canWrapX()&&(r[0]<e[0]||r[0]>=e[2])){const s=he(e),h=Math.floor((r[0]-e[0])/s)*s;i[0]-=h,i[2]-=h}return i}function dp(i,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[e[0],i[1],e[2],i[3]]];ch(i,t);const r=he(e);if(he(i)>r)return[[e[0],i[1],e[2],i[3]]];if(i[0]<e[0])return[[i[0]+r,i[1],e[2],i[3]],[e[0],i[1],i[2],i[3]]];if(i[2]>e[2])return[[i[0],i[1],e[2],i[3]],[e[0],i[1],i[2]-r,i[3]]]}return[i]}const fh={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class gh{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||fh[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Ar=6378137,Xi=Math.PI*Ar,yp=[-Xi,-Xi,Xi,Xi],pp=[-180,-85,180,85],Ds=Ar*Math.log(Math.tan(Math.PI/2));class qi extends gh{constructor(t){super({code:t,units:"m",extent:yp,global:!0,worldExtent:pp,getPointResolution:function(e,r){return e/Math.cosh(r[1]/Ar)}})}}const dh=[new qi("EPSG:3857"),new qi("EPSG:102100"),new qi("EPSG:102113"),new qi("EPSG:900913"),new qi("http://www.opengis.net/def/crs/EPSG/0/3857"),new qi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function mp(i,t,e){const r=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=e){t[s]=Xi*i[s]/180;let u=Ar*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));u>Ds?u=Ds:u<-Ds&&(u=-Ds),t[s+1]=u}return t}function vp(i,t,e){const r=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let s=0;s<r;s+=e)t[s]=180*i[s]/Xi,t[s+1]=360*Math.atan(Math.exp(i[s+1]/Ar))/Math.PI-90;return t}const _p=6378137,yh=[-180,-90,180,90],xp=Math.PI*_p/180;class yi extends gh{constructor(t,e){super({code:t,units:"degrees",extent:yh,axisOrientation:e,global:!0,metersPerUnit:xp,worldExtent:yh})}}const ph=[new yi("CRS:84"),new yi("EPSG:4326","neu"),new yi("urn:ogc:def:crs:OGC:1.3:CRS84"),new yi("urn:ogc:def:crs:OGC:2:84"),new yi("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new yi("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new yi("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ea={};function Ep(i){return Ea[i]||Ea[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Sp(i,t){Ea[i]=t}let Wi={};function Fs(i,t,e){const r=i.getCode(),s=t.getCode();r in Wi||(Wi[r]={}),Wi[r][s]=e}function Ip(i,t){let e;return i in Wi&&t in Wi[i]&&(e=Wi[i][t]),e}function Kt(i,t,e){return Math.min(Math.max(i,t),e)}function wp(i,t,e,r,s,u){const h=s-e,f=u-r;if(h!==0||f!==0){const g=((i-e)*h+(t-r)*f)/(h*h+f*f);g>1?(e=s,r=u):g>0&&(e+=h*g,r+=f*g)}return pi(i,t,e,r)}function pi(i,t,e,r){const s=e-i,u=r-t;return s*s+u*u}function kp(i){return i*Math.PI/180}function Sa(i,t){const e=i%t;return e*t<0?e+t:e}function ye(i,t,e){return i+e*(t-i)}function Cp(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function Rp(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function Gs(i,t){let e=!0;for(let r=i.length-1;r>=0;--r)if(i[r]!=t[r]){e=!1;break}return e}function bp(i,t){const e=Math.cos(t),r=Math.sin(t),s=i[0]*e-i[1]*r,u=i[1]*e+i[0]*r;return i[0]=s,i[1]=u,i}function Tp(i,t){if(t.canWrapX()){const e=he(t.getExtent()),r=Np(i,t,e);r&&(i[0]-=r*e)}return i}function Np(i,t,e){const r=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<r[0]||i[0]>r[2])&&(e=e||he(r),s=Math.floor((i[0]-r[0])/e)),s}function Mp(...i){console.warn(...i)}let Ia=!0;function mh(i){Ia=!1}function vh(i,t){if(t!==void 0){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];t=t}else t=i.slice();return t}function Op(i,t){if(t!==void 0&&i!==t){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];i=t}return i}function Lp(i){Sp(i.getCode(),i),Fs(i,i,vh)}function Ap(i){i.forEach(Lp)}function mi(i){return typeof i=="string"?Ep(i):i||null}function _h(i){Ap(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Fs(t,e,vh)})})}function Pp(i,t,e,r){i.forEach(function(s){t.forEach(function(u){Fs(s,u,e),Fs(u,s,r)})})}function wa(i,t){return i?typeof i=="string"?mi(i):i:mi(t)}function Bs(i,t){return mh(),Eh(i,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function xh(i,t){const e=Eh(i,t!==void 0?t:"EPSG:3857","EPSG:4326"),r=e[0];return(r<-180||r>180)&&(e[0]=Sa(r+180,360)-180),e}function Dp(i,t){const e=i.getCode(),r=t.getCode();let s=Ip(e,r);return s||(s=Op),s}function Ys(i,t){const e=mi(i),r=mi(t);return Dp(e,r)}function Eh(i,t,e){return Ys(t,e)(i,void 0,i.length)}function Fp(i,t,e,r){const s=Ys(t,e);return gp(i,s,void 0)}function Sh(i,t){return i}function Ln(i,t){return Ia&&!Gs(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(Ia=!1,Mp("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function Ih(i,t){return i}function Pr(i,t){return i}function Gp(){_h(dh),_h(ph),Pp(ph,dh,mp,vp)}Gp();function An(i,t,e,r,s,u){u=u||[];let h=0;for(let f=t;f<e;f+=r){const g=i[f],y=i[f+1];u[h++]=s[0]*g+s[2]*y+s[4],u[h++]=s[1]*g+s[3]*y+s[5]}return u&&u.length!=h&&(u.length=h),u}function wh(i,t,e,r,s,u,h){h=h||[];const f=Math.cos(s),g=Math.sin(s),y=u[0],p=u[1];let m=0;for(let _=t;_<e;_+=r){const x=i[_]-y,I=i[_+1]-p;h[m++]=y+x*f-I*g,h[m++]=p+x*g+I*f;for(let k=_+2;k<_+r;++k)h[m++]=i[k]}return h&&h.length!=m&&(h.length=m),h}function Bp(i,t,e,r,s,u,h,f){f=f||[];const g=h[0],y=h[1];let p=0;for(let m=t;m<e;m+=r){const _=i[m]-g,x=i[m+1]-y;f[p++]=g+s*_,f[p++]=y+u*x;for(let I=m+2;I<m+r;++I)f[p++]=i[I]}return f&&f.length!=p&&(f.length=p),f}function Yp(i,t,e,r,s,u,h){h=h||[];let f=0;for(let g=t;g<e;g+=r){h[f++]=i[g]+s,h[f++]=i[g+1]+u;for(let y=g+2;y<g+r;++y)h[f++]=i[y]}return h&&h.length!=f&&(h.length=f),h}const kh=yn();class Ch extends zi{constructor(){super(),this.extent_=fi(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Ql((t,e,r)=>{if(!r)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(r),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return bt()}closestPointXY(t,e,r,s){return bt()}containsXY(t,e){const r=this.getClosestPoint([t,e]);return r[0]===t&&r[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return bt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Ps(e),this.extentRevision_=this.getRevision()}return cp(this.extent_,t)}rotate(t,e){bt()}scale(t,e,r){bt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return bt()}getType(){return bt()}applyTransform(t){bt()}intersectsExtent(t){return bt()}translate(t,e){bt()}transform(t,e){const r=mi(t),s=r.getUnits()=="tile-pixels"?function(u,h,f){const g=r.getExtent(),y=r.getWorldExtent(),p=pn(y)/pn(g);return hi(kh,y[0],y[3],p,-p,0,0,0),An(u,0,u.length,f,kh,h),Ys(r,e)(u,h,f)}:Ys(r,e);return this.applyTransform(s),this}}class vi extends Ch{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return _a(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return bt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Rh(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){bt()}setLayout(t,e,r){let s;if(t)s=Rh(t);else{for(let u=0;u<r;++u){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=zp(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const r=this.getFlatCoordinates();if(r){const s=this.getStride();wh(r,0,r.length,s,t,e,r),this.changed()}}scale(t,e,r){e===void 0&&(e=t),r||(r=di(this.getExtent()));const s=this.getFlatCoordinates();if(s){const u=this.getStride();Bp(s,0,s.length,u,t,e,r,s),this.changed()}}translate(t,e){const r=this.getFlatCoordinates();if(r){const s=this.getStride();Yp(r,0,r.length,s,t,e,r),this.changed()}}}function zp(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Rh(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function $p(i,t,e){const r=i.getFlatCoordinates();if(!r)return null;const s=i.getStride();return An(r,0,r.length,s,t,e)}function Xp(i,t,e,r){for(let s=0,u=e.length;s<u;++s)i[t++]=e[s];return t}function zs(i,t,e,r){for(let s=0,u=e.length;s<u;++s){const h=e[s];for(let f=0;f<r;++f)i[t++]=h[f]}return t}function ka(i,t,e,r,s){s=s||[];let u=0;for(let h=0,f=e.length;h<f;++h){const g=zs(i,t,e[h],r);s[u++]=g,t=g}return s.length=u,s}function qp(i,t,e,r,s){s=s||[];let u=0;for(let h=0,f=e.length;h<f;++h){const g=ka(i,t,e[h],r,s[u]);g.length===0&&(g[0]=t),s[u++]=g,t=g[g.length-1]}return s.length=u,s}class $s extends Ch{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(On),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,r=t.length;e<r;++e)this.changeEventsKeys_.push(dn(t[e],Ge.CHANGE,this.changed,this))}clone(){const t=new $s(Ca(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,r,s){if(s<ci(this.getExtent(),t,e))return s;const u=this.geometries_;for(let h=0,f=u.length;h<f;++h)s=u[h].closestPointXY(t,e,r,s);return s}containsXY(t,e){const r=this.geometries_;for(let s=0,u=r.length;s<u;++s)if(r[s].containsXY(t,e))return!0;return!1}computeExtent(t){Ps(t);const e=this.geometries_;for(let r=0,s=e.length;r<s;++r)sp(t,e[r].getExtent());return t}getGeometries(){return Ca(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let r=0,s=e.length;r<s;++r)e[r].getType()===this.getType()?t=t.concat(e[r].getGeometriesArrayRecursive()):t.push(e[r]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],r=this.geometries_;let s=!1;for(let u=0,h=r.length;u<h;++u){const f=r[u],g=f.getSimplifiedGeometry(t);e.push(g),g!==f&&(s=!0)}return s?new $s(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let r=0,s=e.length;r<s;++r)if(e[r].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const r=this.geometries_;for(let s=0,u=r.length;s<u;++s)r[s].rotate(t,e);this.changed()}scale(t,e,r){r||(r=di(this.getExtent()));const s=this.geometries_;for(let u=0,h=s.length;u<h;++u)s[u].scale(t,e,r);this.changed()}setGeometries(t){this.setGeometriesArray(Ca(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let r=0,s=e.length;r<s;++r)e[r].applyTransform(t);this.changed()}translate(t,e){const r=this.geometries_;for(let s=0,u=r.length;s<u;++s)r[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Ca(i){return i.map(t=>t.clone())}function bh(i,t,e,r,s,u,h){const f=i[t],g=i[t+1],y=i[e]-f,p=i[e+1]-g;let m;if(y===0&&p===0)m=t;else{const _=((s-f)*y+(u-g)*p)/(y*y+p*p);if(_>1)m=e;else if(_>0){for(let x=0;x<r;++x)h[x]=ye(i[t+x],i[e+x],_);h.length=r;return}else m=t}for(let _=0;_<r;++_)h[_]=i[m+_];h.length=r}function Ra(i,t,e,r,s){let u=i[t],h=i[t+1];for(t+=r;t<e;t+=r){const f=i[t],g=i[t+1],y=pi(u,h,f,g);y>s&&(s=y),u=f,h=g}return s}function ba(i,t,e,r,s){for(let u=0,h=e.length;u<h;++u){const f=e[u];s=Ra(i,t,f,r,s),t=f}return s}function Wp(i,t,e,r,s){for(let u=0,h=e.length;u<h;++u){const f=e[u];s=ba(i,t,f,r,s),t=f[f.length-1]}return s}function Ta(i,t,e,r,s,u,h,f,g,y,p){if(t==e)return y;let m,_;if(s===0){if(_=pi(h,f,i[t],i[t+1]),_<y){for(m=0;m<r;++m)g[m]=i[t+m];return g.length=r,_}return y}p=p||[NaN,NaN];let x=t+r;for(;x<e;)if(bh(i,x-r,x,r,h,f,p),_=pi(h,f,p[0],p[1]),_<y){for(y=_,m=0;m<r;++m)g[m]=p[m];g.length=r,x+=r}else x+=r*Math.max((Math.sqrt(_)-Math.sqrt(y))/s|0,1);if(u&&(bh(i,e-r,t,r,h,f,p),_=pi(h,f,p[0],p[1]),_<y)){for(y=_,m=0;m<r;++m)g[m]=p[m];g.length=r}return y}function Na(i,t,e,r,s,u,h,f,g,y,p){p=p||[NaN,NaN];for(let m=0,_=e.length;m<_;++m){const x=e[m];y=Ta(i,t,x,r,s,u,h,f,g,y,p),t=x}return y}function Up(i,t,e,r,s,u,h,f,g,y,p){p=p||[NaN,NaN];for(let m=0,_=e.length;m<_;++m){const x=e[m];y=Na(i,t,x,r,s,u,h,f,g,y,p),t=x[x.length-1]}return y}function Xs(i,t,e,r,s,u,h){const f=(e-t)/r;if(f<3){for(;t<e;t+=r)u[h++]=i[t],u[h++]=i[t+1];return h}const g=new Array(f);g[0]=1,g[f-1]=1;const y=[t,e-r];let p=0;for(;y.length>0;){const m=y.pop(),_=y.pop();let x=0;const I=i[_],k=i[_+1],C=i[m],R=i[m+1];for(let b=_+r;b<m;b+=r){const O=i[b],A=i[b+1],L=wp(O,A,I,k,C,R);L>x&&(p=b,x=L)}x>s&&(g[(p-t)/r]=1,_+r<p&&y.push(_,p),p+r<m&&y.push(p,m))}for(let m=0;m<f;++m)g[m]&&(u[h++]=i[t+m*r],u[h++]=i[t+m*r+1]);return h}function Th(i,t,e,r,s,u,h,f){for(let g=0,y=e.length;g<y;++g){const p=e[g];h=Xs(i,t,p,r,s,u,h),f.push(h),t=p}return h}function _i(i,t){return t*Math.round(i/t)}function jp(i,t,e,r,s,u,h){if(t==e)return h;let f=_i(i[t],s),g=_i(i[t+1],s);t+=r,u[h++]=f,u[h++]=g;let y,p;do if(y=_i(i[t],s),p=_i(i[t+1],s),t+=r,t==e)return u[h++]=y,u[h++]=p,h;while(y==f&&p==g);for(;t<e;){const m=_i(i[t],s),_=_i(i[t+1],s);if(t+=r,m==y&&_==p)continue;const x=y-f,I=p-g,k=m-f,C=_-g;if(x*C==I*k&&(x<0&&k<x||x==k||x>0&&k>x)&&(I<0&&C<I||I==C||I>0&&C>I)){y=m,p=_;continue}u[h++]=y,u[h++]=p,f=y,g=p,y=m,p=_}return u[h++]=y,u[h++]=p,h}function Ma(i,t,e,r,s,u,h,f){for(let g=0,y=e.length;g<y;++g){const p=e[g];h=jp(i,t,p,r,s,u,h),f.push(h),t=p}return h}function Vp(i,t,e,r,s,u,h,f){for(let g=0,y=e.length;g<y;++g){const p=e[g],m=[];h=Ma(i,t,p,r,s,u,h,m),f.push(m),t=p[p.length-1]}return h}function Pn(i,t,e,r,s){s=s!==void 0?s:[];let u=0;for(let h=t;h<e;h+=r)s[u++]=i.slice(h,h+r);return s.length=u,s}function Dr(i,t,e,r,s){s=s!==void 0?s:[];let u=0;for(let h=0,f=e.length;h<f;++h){const g=e[h];s[u++]=Pn(i,t,g,r,s[u]),t=g}return s.length=u,s}function Oa(i,t,e,r,s){s=s!==void 0?s:[];let u=0;for(let h=0,f=e.length;h<f;++h){const g=e[h];s[u++]=g.length===1&&g[0]===t?[]:Dr(i,t,g,r,s[u]),t=g[g.length-1]}return s.length=u,s}function Nh(i,t,e,r){let s=0,u=i[e-r],h=i[e-r+1];for(;t<e;t+=r){const f=i[t],g=i[t+1];s+=h*f-u*g,u=f,h=g}return s/2}function Mh(i,t,e,r){let s=0;for(let u=0,h=e.length;u<h;++u){const f=e[u];s+=Nh(i,t,f,r),t=f}return s}function Zp(i,t,e,r){let s=0;for(let u=0,h=e.length;u<h;++u){const f=e[u];s+=Mh(i,t,f,r),t=f[f.length-1]}return s}class Fr extends vi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Fr(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,r,s){return s<ci(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,s))}getArea(){return Nh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Pn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Fr(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zs(this.flatCoordinates,0,t,this.stride),this.changed()}}function Oh(i,t,e,r,s){let u;for(t+=r;t<e;t+=r)if(u=s(i.slice(t-r,t),i.slice(t,t+r)),u)return u;return!1}function qs(i,t,e,r,s,u,h){let f,g;const y=(e-t)/r;if(y===1)f=t;else if(y===2)f=t,g=s;else if(y!==0){let p=i[t],m=i[t+1],_=0;const x=[0];for(let C=t+r;C<e;C+=r){const R=i[C],b=i[C+1];_+=Math.sqrt((R-p)*(R-p)+(b-m)*(b-m)),x.push(_),p=R,m=b}const I=s*_,k=Vy(x,I);k<0?(g=(I-x[-k-2])/(x[-k-1]-x[-k-2]),f=t+(-k-2)*r):f=t+k*r}h=h>1?h:2,u=u||new Array(h);for(let p=0;p<h;++p)u[p]=f===void 0?NaN:g===void 0?i[f+p]:ye(i[f+p],i[f+r+p],g);return u}function La(i,t,e,r,s,u){if(e==t)return null;let h;if(s<i[t+r-1])return u?(h=i.slice(t,t+r),h[r-1]=s,h):null;if(i[e-1]<s)return u?(h=i.slice(e-r,e),h[r-1]=s,h):null;if(s==i[t+r-1])return i.slice(t,t+r);let f=t/r,g=e/r;for(;f<g;){const _=f+g>>1;s<i[(_+1)*r-1]?g=_:f=_+1}const y=i[f*r-1];if(s==y)return i.slice((f-1)*r,(f-1)*r+r);const p=i[(f+1)*r-1],m=(s-y)/(p-y);h=[];for(let _=0;_<r-1;++_)h.push(ye(i[(f-1)*r+_],i[f*r+_],m));return h.push(s),h}function Hp(i,t,e,r,s,u,h){if(h)return La(i,t,e[e.length-1],r,s,u);let f;if(s<i[r-1])return u?(f=i.slice(0,r),f[r-1]=s,f):null;if(i[i.length-1]<s)return u?(f=i.slice(i.length-r),f[r-1]=s,f):null;for(let g=0,y=e.length;g<y;++g){const p=e[g];if(t!=p){if(s<i[t+r-1])return null;if(s<=i[p-1])return La(i,t,p,r,s,!1);t=p}}return null}function Jp(i,t,e,r,s){return!up(s,function(h){return!xi(i,t,e,r,h[0],h[1])})}function xi(i,t,e,r,s,u){let h=0,f=i[e-r],g=i[e-r+1];for(;t<e;t+=r){const y=i[t],p=i[t+1];g<=u?p>u&&(y-f)*(u-g)-(s-f)*(p-g)>0&&h++:p<=u&&(y-f)*(u-g)-(s-f)*(p-g)<0&&h--,f=y,g=p}return h!==0}function Aa(i,t,e,r,s,u){if(e.length===0||!xi(i,t,e[0],r,s,u))return!1;for(let h=1,f=e.length;h<f;++h)if(xi(i,e[h-1],e[h],r,s,u))return!1;return!0}function Kp(i,t,e,r,s,u){if(e.length===0)return!1;for(let h=0,f=e.length;h<f;++h){const g=e[h];if(Aa(i,t,g,r,s,u))return!0;t=g[g.length-1]}return!1}function Ws(i,t,e,r,s){const u=oh(fi(),i,t,e,r);return Be(s,u)?$i(s,u)||u[0]>=s[0]&&u[2]<=s[2]||u[1]>=s[1]&&u[3]<=s[3]?!0:Oh(i,t,e,r,function(h,f){return fp(s,h,f)}):!1}function Qp(i,t,e,r,s){for(let u=0,h=e.length;u<h;++u){if(Ws(i,t,e[u],r,s))return!0;t=e[u]}return!1}function tm(i,t,e,r,s){return!!(Ws(i,t,e,r,s)||xi(i,t,e,r,s[0],s[1])||xi(i,t,e,r,s[0],s[3])||xi(i,t,e,r,s[2],s[1])||xi(i,t,e,r,s[2],s[3]))}function Lh(i,t,e,r,s){if(!tm(i,t,e[0],r,s))return!1;if(e.length===1)return!0;for(let u=1,h=e.length;u<h;++u)if(Jp(i,e[u-1],e[u],r,s)&&!Ws(i,e[u-1],e[u],r,s))return!1;return!0}function em(i,t,e,r,s){for(let u=0,h=e.length;u<h;++u){const f=e[u];if(Lh(i,t,f,r,s))return!0;t=f[f.length-1]}return!1}function Ah(i,t,e,r){let s=i[t],u=i[t+1],h=0;for(let f=t+r;f<e;f+=r){const g=i[f],y=i[f+1];h+=Math.sqrt((g-s)*(g-s)+(y-u)*(y-u)),s=g,u=y}return h}class Ei extends vi{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){Qe(this.flatCoordinates,t),this.changed()}clone(){const t=new Ei(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,s){return s<ci(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,s))}forEachSegment(t){return Oh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,La(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Pn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return qs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Ah(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ei(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Ws(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zs(this.flatCoordinates,0,t,this.stride),this.changed()}}class Gr extends vi{constructor(t,e,r){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&r)this.setFlatCoordinates(e,t),this.ends_=r;else{const s=t,u=[],h=[];for(let g=0,y=s.length;g<y;++g){const p=s[g];Qe(u,p.getFlatCoordinates()),h.push(u.length)}const f=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(f,u),this.ends_=h}}appendLineString(t){Qe(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Gr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,s){return s<ci(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ba(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Na(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,s))}getCoordinateAtM(t,e,r){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,r=r!==void 0?r:!1,Hp(this.flatCoordinates,0,this.ends_,this.stride,t,e,r))}getCoordinates(){return Dr(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Ei(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,r=this.layout,s=[];let u=0;for(let h=0,f=e.length;h<f;++h){const g=e[h],y=new Ei(t.slice(u,g),r);s.push(y),u=g}return s}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let r=0;const s=this.ends_,u=this.stride;for(let h=0,f=s.length;h<f;++h){const g=s[h],y=qs(e,r,g,u,.5);Qe(t,y),r=g}return t}getSimplifiedGeometryInternal(t){const e=[],r=[];return e.length=Th(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,r),new Gr(e,"XY",r)}getType(){return"MultiLineString"}intersectsExtent(t){return Qp(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=ka(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}}class Dn extends vi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Dn(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,s){const u=this.flatCoordinates,h=pi(t,e,u[0],u[1]);if(h<s){const f=this.stride;for(let g=0;g<f;++g)r[g]=u[g];return r.length=f,h}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return rh(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ma(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Xp(this.flatCoordinates,0,t,this.stride),this.changed()}}class Pa extends vi{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){Qe(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Pa(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,r,s){if(s<ci(this.getExtent(),t,e))return s;const u=this.flatCoordinates,h=this.stride;for(let f=0,g=u.length;f<g;f+=h){const y=pi(t,e,u[f],u[f+1]);if(y<s){s=y;for(let p=0;p<h;++p)r[p]=u[f+p];r.length=h}}return s}getCoordinates(){return Pn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Dn(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,r=this.stride,s=[];for(let u=0,h=t.length;u<h;u+=r){const f=new Dn(t.slice(u,u+r),e);s.push(f)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,r=this.stride;for(let s=0,u=e.length;s<u;s+=r){const h=e[s],f=e[s+1];if(ma(t,h,f))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=zs(this.flatCoordinates,0,t,this.stride),this.changed()}}function Da(i,t,e,r,s,u,h){let f,g,y,p,m,_,x;const I=s[u+1],k=[];for(let b=0,O=e.length;b<O;++b){const A=e[b];for(p=i[A-r],_=i[A-r+1],f=t;f<A;f+=r)m=i[f],x=i[f+1],(I<=_&&x<=I||_<=I&&I<=x)&&(y=(I-_)/(x-_)*(m-p)+p,k.push(y)),p=m,_=x}let C=NaN,R=-1/0;for(k.sort(li),p=k[0],f=1,g=k.length;f<g;++f){m=k[f];const b=Math.abs(m-p);b>R&&(y=(p+m)/2,Aa(i,t,e,r,y,I)&&(C=y,R=b)),p=m}return isNaN(C)&&(C=s[u]),h?(h.push(C,I,R),h):[C,I,R]}function Ph(i,t,e,r,s){let u=[];for(let h=0,f=e.length;h<f;++h){const g=e[h];u=Da(i,t,g,r,s,2*h,u),t=g[g.length-1]}return u}function nm(i,t,e,r){for(;t<e-r;){for(let s=0;s<r;++s){const u=i[t+s];i[t+s]=i[e-r+s],i[e-r+s]=u}t+=r,e-=r}}function Fa(i,t,e,r){let s=0,u=i[e-r],h=i[e-r+1];for(;t<e;t+=r){const f=i[t],g=i[t+1];s+=(f-u)*(g+h),u=f,h=g}return s===0?void 0:s>0}function Dh(i,t,e,r,s){s=s!==void 0?s:!1;for(let u=0,h=e.length;u<h;++u){const f=e[u],g=Fa(i,t,f,r);if(u===0){if(s&&g||!s&&!g)return!1}else if(s&&!g||!s&&g)return!1;t=f}return!0}function im(i,t,e,r,s){for(let u=0,h=e.length;u<h;++u){const f=e[u];if(!Dh(i,t,f,r,s))return!1;f.length&&(t=f[f.length-1])}return!0}function Ga(i,t,e,r,s){s=s!==void 0?s:!1;for(let u=0,h=e.length;u<h;++u){const f=e[u],g=Fa(i,t,f,r);(u===0?s&&g||!s&&!g:s&&!g||!s&&g)&&nm(i,t,f,r),t=f}return t}function Fh(i,t,e,r,s){for(let u=0,h=e.length;u<h;++u)t=Ga(i,t,e[u],r,s);return t}function rm(i,t){const e=[];let r=0,s=0,u;for(let h=0,f=t.length;h<f;++h){const g=t[h],y=Fa(i,r,g,2);if(u===void 0&&(u=y),y===u)e.push(t.slice(s,h+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=h+1,r=g}return e}class Fn extends vi{constructor(t,e,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&r?(this.setFlatCoordinates(e,t),this.ends_=r):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Qe(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Fn(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,r,s){return s<ci(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ba(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Na(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,s))}containsXY(t,e){return Aa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Mh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ga(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Dr(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=di(this.getExtent());this.flatInteriorPoint_=Da(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Dn(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Fr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,r=this.ends_,s=[];let u=0;for(let h=0,f=r.length;h<f;++h){const g=r[h],y=new Fr(e.slice(u,g),t);s.push(y),u=g}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Dh(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ga(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],r=[];return e.length=Ma(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,r),new Fn(e,"XY",r)}getType(){return"Polygon"}intersectsExtent(t){return Lh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=ka(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=r.length===0?0:r[r.length-1],this.changed()}}function Gh(i){if(xa(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],r=i[2],s=i[3],u=[t,e,t,s,r,s,r,e,t,e];return new Fn(u,"XY",[u.length])}function Bh(i,t,e,r){const s=[];let u=fi();for(let h=0,f=e.length;h<f;++h){const g=e[h];u=_a(i,t,g[0],r),s.push((u[0]+u[2])/2,(u[1]+u[3])/2),t=g[g.length-1]}return s}class Br extends vi{constructor(t,e,r){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!r&&!Array.isArray(t[0])){const s=t,u=[],h=[];for(let f=0,g=s.length;f<g;++f){const y=s[f],p=u.length,m=y.getEnds();for(let _=0,x=m.length;_<x;++_)m[_]+=p;Qe(u,y.getFlatCoordinates()),h.push(m)}e=s.length===0?this.getLayout():s[0].getLayout(),t=u,r=h}e!==void 0&&r?(this.setFlatCoordinates(e,t),this.endss_=r):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const r=this.flatCoordinates.length;Qe(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,u=e.length;s<u;++s)e[s]+=r}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const r=new Br(this.flatCoordinates.slice(),this.layout,e);return r.applyProperties(this),r}closestPointXY(t,e,r,s){return s<ci(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Wp(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Up(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,r,s))}containsXY(t,e){return Kp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return Zp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Fh(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Oa(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Bh(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Ph(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Pa(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;im(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Fh(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],r=[];return e.length=Vp(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,r),new Br(e,"XY",r)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const u=this.endss_[t-1];e=u[u.length-1]}const r=this.endss_[t].slice(),s=r[r.length-1];if(e!==0)for(let u=0,h=r.length;u<h;++u)r[u]-=e;return new Fn(this.flatCoordinates.slice(e,s),this.layout,r)}getPolygons(){const t=this.layout,e=this.flatCoordinates,r=this.endss_,s=[];let u=0;for(let h=0,f=r.length;h<f;++h){const g=r[h].slice(),y=g[g.length-1];if(u!==0)for(let m=0,_=g.length;m<_;++m)g[m]-=u;const p=new Fn(e.slice(u,y),t,g);s.push(p),u=y}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return em(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const r=qp(this.flatCoordinates,0,t,this.stride,this.endss_);if(r.length===0)this.flatCoordinates.length=0;else{const s=r[r.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const kt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class sm extends zi{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[kt.OPACITY]=t.opacity!==void 0?t.opacity:1,Jt(typeof e[kt.OPACITY]=="number","Layer opacity must be a number"),e[kt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[kt.Z_INDEX]=t.zIndex,e[kt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[kt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[kt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[kt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},r=this.getZIndex();return e.opacity=Kt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=r===void 0&&!e.managed?1/0:r,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return bt()}getLayerStatesArray(t){return bt()}getExtent(){return this.get(kt.EXTENT)}getMaxResolution(){return this.get(kt.MAX_RESOLUTION)}getMinResolution(){return this.get(kt.MIN_RESOLUTION)}getMinZoom(){return this.get(kt.MIN_ZOOM)}getMaxZoom(){return this.get(kt.MAX_ZOOM)}getOpacity(){return this.get(kt.OPACITY)}getSourceState(){return bt()}getVisible(){return this.get(kt.VISIBLE)}getZIndex(){return this.get(kt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(kt.EXTENT,t)}setMaxResolution(t){this.set(kt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(kt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(kt.MAX_ZOOM,t)}setMinZoom(t){this.set(kt.MIN_ZOOM,t)}setOpacity(t){Jt(typeof t=="number","Layer opacity must be a number"),this.set(kt.OPACITY,t)}setVisible(t){this.set(kt.VISIBLE,t)}setZIndex(t){this.set(kt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Si={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},ke={ANIMATING:0,INTERACTING:1},Ye={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},om=256;function Yh(i,t,e){return function(r,s,u,h,f){if(!r)return;if(!s&&!t)return r;const g=t?0:u[0]*s,y=t?0:u[1]*s,p=f?f[0]:0,m=f?f[1]:0;let _=i[0]+g/2+p,x=i[2]-g/2+p,I=i[1]+y/2+m,k=i[3]-y/2+m;_>x&&(_=(x+_)/2,x=_),I>k&&(I=(k+I)/2,k=I);let C=Kt(r[0],_,x),R=Kt(r[1],I,k);if(h&&e&&s){const b=30*s;C+=-b*Math.log(1+Math.max(0,_-r[0])/b)+b*Math.log(1+Math.max(0,r[0]-x)/b),R+=-b*Math.log(1+Math.max(0,I-r[1])/b)+b*Math.log(1+Math.max(0,r[1]-k)/b)}return[C,R]}}function am(i){return i}function Ba(i,t,e,r){const s=he(t)/e[0],u=pn(t)/e[1];return r?Math.min(i,Math.max(s,u)):Math.min(i,Math.min(s,u))}function Ya(i,t,e){let r=Math.min(i,t);const s=50;return r*=Math.log(1+s*Math.max(0,i/t-1))/s+1,e&&(r=Math.max(r,e),r/=Math.log(1+s*Math.max(0,e/i-1))/s+1),Kt(r,e/2,t*2)}function um(i,t,e,r){return t=t!==void 0?t:!0,function(s,u,h,f){if(s!==void 0){const g=i[0],y=i[i.length-1],p=e?Ba(g,e,h,r):g;if(f)return t?Ya(s,p,y):Kt(s,y,p);const m=Math.min(p,s),_=Math.floor(Kl(i,m,u));return i[_]>p&&_<i.length-1?i[_+1]:i[_]}}}function lm(i,t,e,r,s,u){return r=r!==void 0?r:!0,e=e!==void 0?e:0,function(h,f,g,y){if(h!==void 0){const p=s?Ba(t,s,g,u):t;if(y)return r?Ya(h,p,e):Kt(h,e,p);const m=1e-9,_=Math.ceil(Math.log(t/p)/Math.log(i)-m),x=-f*(.5-m)+.5,I=Math.min(p,h),k=Math.floor(Math.log(t/I)/Math.log(i)+x),C=Math.max(_,k),R=t/Math.pow(i,C);return Kt(R,e,p)}}}function zh(i,t,e,r,s){return e=e!==void 0?e:!0,function(u,h,f,g){if(u!==void 0){const y=r?Ba(i,r,f,s):i;return!e||!g?Kt(u,t,y):Ya(u,y,t)}}}function hm(i){if(i!==void 0)return 0}function $h(i){if(i!==void 0)return i}function cm(i){const t=2*Math.PI/i;return function(e,r){if(r)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function fm(i){const t=kp(5);return function(e,r){return r||e===void 0?e:Math.abs(e)<=t?0:e}}function gm(i){return Math.pow(i,3)}function dm(i){return 1-gm(1-i)}function ym(i){return 3*i*i-2*i*i*i}const za=0;class Xh extends zi{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=wa(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&mh(),t.center&&(t.center=Ln(t.center,this.projection_)),t.extent&&(t.extent=Pr(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const f in Ye)delete e[f];this.setProperties(e,!0);const r=mm(t);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=r.minZoom;const s=pm(t),u=r.constraint,h=vm(t);this.constraints_={center:s,resolution:u,rotation:h},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const r=this.getCenterInternal();if(r){const s=t||[0,0,0,0];e=e||[0,0,0,0];const u=this.getResolution(),h=u/2*(s[3]-e[3]+e[1]-s[1]),f=u/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([r[0]+h,r[1]-f])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let r=0;r<e.length;++r){let s=arguments[r];s.center&&(s=Object.assign({},s),s.center=Ln(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=Ln(s.anchor,this.getProjection())),e[r]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,r;e>1&&typeof arguments[e-1]=="function"&&(r=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const p=arguments[s];p.center&&this.setCenterInternal(p.center),p.zoom!==void 0?this.setZoom(p.zoom):p.resolution&&this.setResolution(p.resolution),p.rotation!==void 0&&this.setRotation(p.rotation)}if(s===e){r&&Us(r,!0);return}let u=Date.now(),h=this.targetCenter_.slice(),f=this.targetResolution_,g=this.targetRotation_;const y=[];for(;s<e;++s){const p=arguments[s],m={start:u,complete:!1,anchor:p.anchor,duration:p.duration!==void 0?p.duration:1e3,easing:p.easing||ym,callback:r};if(p.center&&(m.sourceCenter=h,m.targetCenter=p.center.slice(),h=m.targetCenter),p.zoom!==void 0?(m.sourceResolution=f,m.targetResolution=this.getResolutionForZoom(p.zoom),f=m.targetResolution):p.resolution&&(m.sourceResolution=f,m.targetResolution=p.resolution,f=m.targetResolution),p.rotation!==void 0){m.sourceRotation=g;const _=Sa(p.rotation-g+Math.PI,2*Math.PI)-Math.PI;m.targetRotation=g+_,g=m.targetRotation}_m(m)?m.complete=!0:u+=m.duration,y.push(m)}this.animations_.push(y),this.setHint(ke.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ke.ANIMATING]>0}getInteracting(){return this.hints_[ke.INTERACTING]>0}cancelAnimations(){this.setHint(ke.ANIMATING,-this.hints_[ke.ANIMATING]);let t;for(let e=0,r=this.animations_.length;e<r;++e){const s=this.animations_[e];if(s[0].callback&&Us(s[0].callback,!1),!t)for(let u=0,h=s.length;u<h;++u){const f=s[u];if(!f.complete){t=f.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let r=this.animations_.length-1;r>=0;--r){const s=this.animations_[r];let u=!0;for(let h=0,f=s.length;h<f;++h){const g=s[h];if(g.complete)continue;const y=t-g.start;let p=g.duration>0?y/g.duration:1;p>=1?(g.complete=!0,p=1):u=!1;const m=g.easing(p);if(g.sourceCenter){const _=g.sourceCenter[0],x=g.sourceCenter[1],I=g.targetCenter[0],k=g.targetCenter[1];this.nextCenter_=g.targetCenter;const C=_+m*(I-_),R=x+m*(k-x);this.targetCenter_=[C,R]}if(g.sourceResolution&&g.targetResolution){const _=m===1?g.targetResolution:g.sourceResolution+m*(g.targetResolution-g.sourceResolution);if(g.anchor){const x=this.getViewportSize_(this.getRotation()),I=this.constraints_.resolution(_,0,x,!0);this.targetCenter_=this.calculateCenterZoom(I,g.anchor)}this.nextResolution_=g.targetResolution,this.targetResolution_=_,this.applyTargetState_(!0)}if(g.sourceRotation!==void 0&&g.targetRotation!==void 0){const _=m===1?Sa(g.targetRotation+Math.PI,2*Math.PI)-Math.PI:g.sourceRotation+m*(g.targetRotation-g.sourceRotation);if(g.anchor){const x=this.constraints_.rotation(_,!0);this.targetCenter_=this.calculateCenterRotate(x,g.anchor)}this.nextRotation_=g.targetRotation,this.targetRotation_=_}if(this.applyTargetState_(!0),e=!0,!g.complete)break}if(u){this.animations_[r]=null,this.setHint(ke.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const h=s[0].callback;h&&Us(h,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let r;const s=this.getCenterInternal();return s!==void 0&&(r=[s[0]-e[0],s[1]-e[1]],bp(r,t-this.getRotation()),Rp(r,e)),r}calculateCenterZoom(t,e){let r;const s=this.getCenterInternal(),u=this.getResolution();if(s!==void 0&&u!==void 0){const h=e[0]-t*(e[0]-s[0])/u,f=e[1]-t*(e[1]-s[1])/u;r=[h,f]}return r}getViewportSize_(t){const e=this.viewportSize_;if(t){const r=e[0],s=e[1];return[Math.abs(r*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(r*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Sh(t,this.getProjection())}getCenterInternal(){return this.get(Ye.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Ih(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();Jt(e,"The view center is not defined");const r=this.getResolution();Jt(r!==void 0,"The view resolution is not defined");const s=this.getRotation();return Jt(s!==void 0,"The view rotation is not defined"),lp(e,r,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ye.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Pr(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const r=he(t)/e[0],s=pn(t)/e[1];return Math.max(r,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(e/r)/Math.log(t);return function(u){return e/Math.pow(t,u*s)}}getRotation(){return this.get(Ye.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),r=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,u=Math.log(r/s)/e;return function(h){return Math.log(r/h)/e/u}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const r=this.padding_;return r&&(e=[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),r=this.getRotation();let s=this.getCenterInternal();const u=this.padding_;if(u){const h=this.getViewportSizeMinusPadding_();s=$a(s,this.getViewportSize_(),[h[0]/2+u[3],h[1]/2+u[0]],e,r)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,r,s;if(this.resolutions_){const u=Kl(this.resolutions_,t,1);e=u,r=this.resolutions_[u],u==this.resolutions_.length-1?s=2:s=r/this.resolutions_[u+1]}else r=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(r/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Kt(Math.floor(t),0,this.resolutions_.length-2),r=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(r,Kt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let r;if(Jt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){Jt(!xa(t),"Cannot fit empty extent provided as `geometry`");const s=Pr(t,this.getProjection());r=Gh(s)}else if(t.getType()==="Circle"){const s=Pr(t.getExtent(),this.getProjection());r=Gh(s),r.rotate(this.getRotation(),di(s))}else r=t;this.fitInternal(r,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),r=Math.cos(e),s=Math.sin(-e),u=t.getFlatCoordinates(),h=t.getStride();let f=1/0,g=1/0,y=-1/0,p=-1/0;for(let m=0,_=u.length;m<_;m+=h){const x=u[m]*r-u[m+1]*s,I=u[m]*s+u[m+1]*r;f=Math.min(f,x),g=Math.min(g,I),y=Math.max(y,x),p=Math.max(p,I)}return[f,g,y,p]}fitInternal(t,e){e=e||{};let r=e.size;r||(r=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],u=e.nearest!==void 0?e.nearest:!1;let h;e.minResolution!==void 0?h=e.minResolution:e.maxZoom!==void 0?h=this.getResolutionForZoom(e.maxZoom):h=0;const f=this.rotatedExtentForGeometry(t);let g=this.getResolutionForExtentInternal(f,[r[0]-s[1]-s[3],r[1]-s[0]-s[2]]);g=isNaN(g)?h:Math.max(g,h),g=this.getConstrainedResolution(g,u?0:1);const y=this.getRotation(),p=Math.sin(y),m=Math.cos(y),_=di(f);_[0]+=(s[1]-s[3])/2*g,_[1]+=(s[0]-s[2])/2*g;const x=_[0]*m-_[1]*p,I=_[1]*m+_[0]*p,k=this.getConstrainedCenter([x,I],g),C=e.callback?e.callback:Or;e.duration!==void 0?this.animateInternal({resolution:g,center:k,duration:e.duration,easing:e.easing},C):(this.targetResolution_=g,this.targetCenter_=k,this.applyTargetState_(!1,!0),Us(C,!0))}centerOn(t,e,r){this.centerOnInternal(Ln(t,this.getProjection()),e,r)}centerOnInternal(t,e,r){this.setCenterInternal($a(t,e,r,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,r,s){let u;const h=this.padding_;if(h&&t){const f=this.getViewportSizeMinusPadding_(-r),g=$a(t,s,[f[0]/2+h[3],f[1]/2+h[0]],e,r);u=[t[0]-g[0],t[1]-g[1]]}return u}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Sh(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Ln(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const r=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),u=this.constraints_.resolution(this.targetResolution_*t,0,s,r);e&&(this.targetCenter_=this.calculateCenterZoom(u,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Ln(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const r=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,r);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Ln(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const r=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,r),u=this.getViewportSize_(s),h=this.constraints_.resolution(this.targetResolution_,0,u,r),f=this.constraints_.center(this.targetCenter_,h,u,r,this.calculateCenterShift(this.targetCenter_,h,s,u));this.get(Ye.ROTATION)!==s&&this.set(Ye.ROTATION,s),this.get(Ye.RESOLUTION)!==h&&(this.set(Ye.RESOLUTION,h),this.set("zoom",this.getZoom(),!0)),(!f||!this.get(Ye.CENTER)||!Gs(this.get(Ye.CENTER),f))&&this.set(Ye.CENTER,f),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,r){t=t!==void 0?t:200;const s=e||0,u=this.constraints_.rotation(this.targetRotation_),h=this.getViewportSize_(u),f=this.constraints_.resolution(this.targetResolution_,s,h),g=this.constraints_.center(this.targetCenter_,f,h,!1,this.calculateCenterShift(this.targetCenter_,f,u,h));if(t===0&&!this.cancelAnchor_){this.targetResolution_=f,this.targetRotation_=u,this.targetCenter_=g,this.applyTargetState_();return}r=r||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==f||this.getRotation()!==u||!this.getCenterInternal()||!Gs(this.getCenterInternal(),g))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:u,center:g,resolution:f,duration:t,easing:dm,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ke.INTERACTING,1)}endInteraction(t,e,r){r=r&&Ln(r,this.getProjection()),this.endInteractionInternal(t,e,r)}endInteractionInternal(t,e,r){this.getInteracting()&&(this.setHint(ke.INTERACTING,-1),this.resolveConstraints(t,e,r))}getConstrainedCenter(t,e){const r=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),r)}getConstrainedZoom(t,e){const r=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(r,e))}getConstrainedResolution(t,e){e=e||0;const r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,r)}}function Us(i,t){setTimeout(function(){i(t)},0)}function pm(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Yh(i.extent,i.constrainOnlyCenter,e)}const t=wa(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Yh(e,!1,!1)}return am}function mm(i){let t,e,r,h=i.minZoom!==void 0?i.minZoom:za,f=i.maxZoom!==void 0?i.maxZoom:28;const g=i.zoomFactor!==void 0?i.zoomFactor:2,y=i.multiWorld!==void 0?i.multiWorld:!1,p=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,m=i.showFullExtent!==void 0?i.showFullExtent:!1,_=wa(i.projection,"EPSG:3857"),x=_.getExtent();let I=i.constrainOnlyCenter,k=i.extent;if(!y&&!k&&_.isGlobal()&&(I=!1,k=x),i.resolutions!==void 0){const C=i.resolutions;e=C[h],r=C[f]!==void 0?C[f]:C[C.length-1],i.constrainResolution?t=um(C,p,!I&&k,m):t=zh(e,r,p,!I&&k,m)}else{const R=(x?Math.max(he(x),pn(x)):360*fh.degrees/_.getMetersPerUnit())/om/Math.pow(2,za),b=R/Math.pow(2,28-za);e=i.maxResolution,e!==void 0?h=0:e=R/Math.pow(g,h),r=i.minResolution,r===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?r=e/Math.pow(g,f):r=R/Math.pow(g,f):r=b),f=h+Math.floor(Math.log(e/r)/Math.log(g)),r=e/Math.pow(g,f-h),i.constrainResolution?t=lm(g,e,r,p,!I&&k,m):t=zh(e,r,p,!I&&k,m)}return{constraint:t,maxResolution:e,minResolution:r,minZoom:h,zoomFactor:g}}function vm(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?fm():e===!1?$h:typeof e=="number"?cm(e):$h}return hm}function _m(i){return!(i.sourceCenter&&i.targetCenter&&!Gs(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function $a(i,t,e,r,s){const u=Math.cos(-s);let h=Math.sin(-s),f=i[0]*u-i[1]*h,g=i[1]*u+i[0]*h;f+=(t[0]/2-e[0])*r,g+=(e[1]-t[1]/2)*r,h=-h;const y=f*u-g*h,p=g*u+f*h;return[y,p]}class xm extends sm{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(kt.SOURCE,this.handleSourcePropertyChange_);const r=t.source?t.source:null;this.setSource(r)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(kt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(On(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=dn(t,Ge.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const r=this.getMapInternal();!t&&r&&(t=r.getView()),t instanceof Xh?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&r&&(e.layerStatesArray=r.getLayerGroup().getLayerStatesArray());let s;e.layerStatesArray?s=e.layerStatesArray.find(h=>h.layer===this):s=this.getLayerState();const u=this.getExtent();return Em(s,e.viewState)&&(!u||Be(u,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];let e;const r=this.getSource();if(r&&(e=r.getAttributions()),!e)return[];const s=t instanceof Xh?t.getViewStateAndExtent():t;let u=e(s);return Array.isArray(u)||(u=[u]),u}render(t,e){const r=this.getRenderer();return r.prepareFrame(t)?(this.rendered=!0,r.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(kt.MAP,t)}getMapInternal(){return this.get(kt.MAP)}setMap(t){this.mapPrecomposeKey_&&(On(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(On(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=dn(t,Si.PRECOMPOSE,function(e){const s=e.frameState.layerStatesArray,u=this.getLayerState(!1);Jt(!s.some(function(h){return h.layer===u.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),s.push(u)},this),this.mapRenderKey_=dn(this,Ge.CHANGE,t.render,t),this.changed())}setSource(t){this.set(kt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Em(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const r=t.zoom;return r>i.minZoom&&r<=i.maxZoom}function Sm(i,t,e,r,s){qh(i,t,e||0,r||i.length-1,s||Im)}function qh(i,t,e,r,s){for(;r>e;){if(r-e>600){var u=r-e+1,h=t-e+1,f=Math.log(u),g=.5*Math.exp(2*f/3),y=.5*Math.sqrt(f*g*(u-g)/u)*(h-u/2<0?-1:1),p=Math.max(e,Math.floor(t-h*g/u+y)),m=Math.min(r,Math.floor(t+(u-h)*g/u+y));qh(i,t,p,m,s)}var _=i[t],x=e,I=r;for(Yr(i,e,t),s(i[r],_)>0&&Yr(i,e,r);x<I;){for(Yr(i,x,I),x++,I--;s(i[x],_)<0;)x++;for(;s(i[I],_)>0;)I--}s(i[e],_)===0?Yr(i,e,I):(I++,Yr(i,I,r)),I<=t&&(e=I+1),t<=I&&(r=I-1)}}function Yr(i,t,e){var r=i[t];i[t]=i[e],i[e]=r}function Im(i,t){return i<t?-1:i>t?1:0}let Wh=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const r=[];if(!Vs(t,e))return r;const s=this.toBBox,u=[];for(;e;){for(let h=0;h<e.children.length;h++){const f=e.children[h],g=e.leaf?s(f):f;Vs(t,g)&&(e.leaf?r.push(f):qa(t,g)?this._all(f,r):u.push(f))}e=u.pop()}return r}collides(t){let e=this.data;if(!Vs(t,e))return!1;const r=[];for(;e;){for(let s=0;s<e.children.length;s++){const u=e.children[s],h=e.leaf?this.toBBox(u):u;if(Vs(t,h)){if(e.leaf||qa(t,h))return!0;r.push(u)}}e=r.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let r=0;r<t.length;r++)this.insert(t[r]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const r=this.data;this.data=e,e=r}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=ji([]),this}remove(t,e){if(!t)return this;let r=this.data;const s=this.toBBox(t),u=[],h=[];let f,g,y;for(;r||u.length;){if(r||(r=u.pop(),g=u[u.length-1],f=h.pop(),y=!0),r.leaf){const p=wm(t,r.children,e);if(p!==-1)return r.children.splice(p,1),u.push(r),this._condense(u),this}!y&&!r.leaf&&qa(r,s)?(u.push(r),h.push(f),f=0,g=r,r=r.children[0]):g?(f++,r=g.children[f],y=!1):r=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const r=[];for(;t;)t.leaf?e.push(...t.children):r.push(...t.children),t=r.pop();return e}_build(t,e,r,s){const u=r-e+1;let h=this._maxEntries,f;if(u<=h)return f=ji(t.slice(e,r+1)),Ui(f,this.toBBox),f;s||(s=Math.ceil(Math.log(u)/Math.log(h)),h=Math.ceil(u/Math.pow(h,s-1))),f=ji([]),f.leaf=!1,f.height=s;const g=Math.ceil(u/h),y=g*Math.ceil(Math.sqrt(h));Uh(t,e,r,y,this.compareMinX);for(let p=e;p<=r;p+=y){const m=Math.min(p+y-1,r);Uh(t,p,m,g,this.compareMinY);for(let _=p;_<=m;_+=g){const x=Math.min(_+g-1,m);f.children.push(this._build(t,_,x,s-1))}}return Ui(f,this.toBBox),f}_chooseSubtree(t,e,r,s){for(;s.push(e),!(e.leaf||s.length-1===r);){let u=1/0,h=1/0,f;for(let g=0;g<e.children.length;g++){const y=e.children[g],p=Xa(y),m=Rm(t,y)-p;m<h?(h=m,u=p<u?p:u,f=y):m===h&&p<u&&(u=p,f=y)}e=f||e.children[0]}return e}_insert(t,e,r){const s=r?t:this.toBBox(t),u=[],h=this._chooseSubtree(s,this.data,e,u);for(h.children.push(t),$r(h,s);e>=0&&u[e].children.length>this._maxEntries;)this._split(u,e),e--;this._adjustParentBBoxes(s,u,e)}_split(t,e){const r=t[e],s=r.children.length,u=this._minEntries;this._chooseSplitAxis(r,u,s);const h=this._chooseSplitIndex(r,u,s),f=ji(r.children.splice(h,r.children.length-h));f.height=r.height,f.leaf=r.leaf,Ui(r,this.toBBox),Ui(f,this.toBBox),e?t[e-1].children.push(f):this._splitRoot(r,f)}_splitRoot(t,e){this.data=ji([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Ui(this.data,this.toBBox)}_chooseSplitIndex(t,e,r){let s,u=1/0,h=1/0;for(let f=e;f<=r-e;f++){const g=zr(t,0,f,this.toBBox),y=zr(t,f,r,this.toBBox),p=bm(g,y),m=Xa(g)+Xa(y);p<u?(u=p,s=f,h=m<h?m:h):p===u&&m<h&&(h=m,s=f)}return s||r-e}_chooseSplitAxis(t,e,r){const s=t.leaf?this.compareMinX:km,u=t.leaf?this.compareMinY:Cm,h=this._allDistMargin(t,e,r,s),f=this._allDistMargin(t,e,r,u);h<f&&t.children.sort(s)}_allDistMargin(t,e,r,s){t.children.sort(s);const u=this.toBBox,h=zr(t,0,e,u),f=zr(t,r-e,r,u);let g=js(h)+js(f);for(let y=e;y<r-e;y++){const p=t.children[y];$r(h,t.leaf?u(p):p),g+=js(h)}for(let y=r-e-1;y>=e;y--){const p=t.children[y];$r(f,t.leaf?u(p):p),g+=js(f)}return g}_adjustParentBBoxes(t,e,r){for(let s=r;s>=0;s--)$r(e[s],t)}_condense(t){for(let e=t.length-1,r;e>=0;e--)t[e].children.length===0?e>0?(r=t[e-1].children,r.splice(r.indexOf(t[e]),1)):this.clear():Ui(t[e],this.toBBox)}};function wm(i,t,e){if(!e)return t.indexOf(i);for(let r=0;r<t.length;r++)if(e(i,t[r]))return r;return-1}function Ui(i,t){zr(i,0,i.children.length,t,i)}function zr(i,t,e,r,s){s||(s=ji(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let u=t;u<e;u++){const h=i.children[u];$r(s,i.leaf?r(h):h)}return s}function $r(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function km(i,t){return i.minX-t.minX}function Cm(i,t){return i.minY-t.minY}function Xa(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function js(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Rm(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function bm(i,t){const e=Math.max(i.minX,t.minX),r=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),u=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,u-r)}function qa(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function Vs(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function ji(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Uh(i,t,e,r,s){const u=[t,e];for(;u.length;){if(e=u.pop(),t=u.pop(),e-t<=r)continue;const h=t+Math.ceil((e-t)/r/2)*r;Sm(i,h,t,e,s),u.push(t,h,h,e)}}const yt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Xr(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}class Zs{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Xr(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Zs({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return bt()}getImage(t){return bt()}getHitDetectionImage(){return bt()}getPixelRatio(t){return 1}getImageState(){return bt()}getImageSize(){return bt()}getOrigin(){return bt()}getSize(){return bt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Xr(t)}listenImageChange(t){bt()}load(){bt()}unlistenImageChange(t){bt()}ready(){return Promise.resolve()}}const qr={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var Vt={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};Vt.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}},Vt.max=Vt.whitepoint[2].D65,Vt.rgb=function(i,t){t=t||Vt.whitepoint[2].E;var e=i[0]/t[0],r=i[1]/t[1],s=i[2]/t[2],u,h,f;return u=e*3.240969941904521+r*-1.537383177570093+s*-.498610760293,h=e*-.96924363628087+r*1.87596750150772+s*.041555057407175,f=e*.055630079696993+r*-.20397695888897+s*1.056971514242878,u=u>.0031308?1.055*Math.pow(u,1/2.4)-.055:u=u*12.92,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:h=h*12.92,f=f>.0031308?1.055*Math.pow(f,1/2.4)-.055:f=f*12.92,u=Math.min(Math.max(0,u),1),h=Math.min(Math.max(0,h),1),f=Math.min(Math.max(0,f),1),[u*255,h*255,f*255]},qr.xyz=function(i,t){var e=i[0]/255,r=i[1]/255,s=i[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92;var u=e*.41239079926595+r*.35758433938387+s*.18048078840183,h=e*.21263900587151+r*.71516867876775+s*.072192315360733,f=e*.019330818715591+r*.11919477979462+s*.95053215224966;return t=t||Vt.whitepoint[2].E,[u*t[0],h*t[1],f*t[2]]};const Wa={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,t,e){var r,s,u,h,f,g,y,p,m,_,x,I,k;if(u=i[0],h=i[1],f=i[2],u===0)return[0,0,0];var C=.0011070564598794539;return t=t||"D65",e=e||2,m=Vt.whitepoint[e][t][0],_=Vt.whitepoint[e][t][1],x=Vt.whitepoint[e][t][2],I=4*m/(m+15*_+3*x),k=9*_/(m+15*_+3*x),r=h/(13*u)+I||0,s=f/(13*u)+k||0,y=u>8?_*Math.pow((u+16)/116,3):_*u*C,g=y*9*r/(4*s)||0,p=y*(12-3*r-20*s)/(4*s)||0,[g,y,p]}};Vt.luv=function(i,t,e){var r,s,u,h,f,g,y,p,m,_,x,I,k,C=.008856451679035631,R=903.2962962962961;t=t||"D65",e=e||2,m=Vt.whitepoint[e][t][0],_=Vt.whitepoint[e][t][1],x=Vt.whitepoint[e][t][2],I=4*m/(m+15*_+3*x),k=9*_/(m+15*_+3*x),g=i[0],y=i[1],p=i[2],r=4*g/(g+15*y+3*p)||0,s=9*y/(g+15*y+3*p)||0;var b=y/_;return u=b<=C?R*b:116*Math.pow(b,1/3)-16,h=13*u*(r-I),f=13*u*(s-k),[u,h,f]};var jh={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var t=i[0],e=i[1],r=i[2],s,u,h;return h=r/360*2*Math.PI,s=e*Math.cos(h),u=e*Math.sin(h),[t,s,u]},xyz:function(i){return Wa.xyz(jh.luv(i))}};Wa.lchuv=function(i){var t=i[0],e=i[1],r=i[2],s=Math.sqrt(e*e+r*r),u=Math.atan2(r,e),h=u*360/2/Math.PI;return h<0&&(h+=360),[t,s,h]},Vt.lchuv=function(i){return Wa.lchuv(Vt.luv(i))};const Vh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Zh={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Tm(i){var p,m;var t,e=[],r=1,s;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Vh[i])e=Vh[i].slice(),s="rgb";else if(i==="transparent")r=0,s="rgb",e=[0,0,0];else if(i[0]==="#"){var u=i.slice(1),h=u.length,f=h<=4;r=1,f?(e=[parseInt(u[0]+u[0],16),parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16)],h===4&&(r=parseInt(u[3]+u[3],16)/255)):(e=[parseInt(u[0]+u[1],16),parseInt(u[2]+u[3],16),parseInt(u[4]+u[5],16)],h===8&&(r=parseInt(u[6]+u[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),s="rgb"}else if(t=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var g=t[1];s=g.replace(/a$/,"");var y=s==="cmyk"?4:s==="gray"?1:3;e=t[2].trim().split(/\s*[,\/]\s*|\s+/),s==="color"&&(s=e.shift()),e=e.map(function(_,x){if(_[_.length-1]==="%")return _=parseFloat(_)/100,x===3?_:s==="rgb"?_*255:s[0]==="h"||s[0]==="l"&&!x?_*100:s==="lab"?_*125:s==="lch"?x<2?_*150:_*360:s[0]==="o"&&!x?_:s==="oklab"?_*.4:s==="oklch"?x<2?_*.4:_*360:_;if(s[x]==="h"||x===2&&s[s.length-1]==="h"){if(Zh[_]!==void 0)return Zh[_];if(_.endsWith("deg"))return parseFloat(_);if(_.endsWith("turn"))return parseFloat(_)*360;if(_.endsWith("grad"))return parseFloat(_)*360/400;if(_.endsWith("rad"))return parseFloat(_)*180/Math.PI}return _==="none"?0:parseFloat(_)}),r=e.length>y?e.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(e=i.match(/([0-9]+)/g).map(function(_){return parseFloat(_)}),s=((m=(p=i.match(/([a-z])/ig))==null?void 0:p.join(""))==null?void 0:m.toLowerCase())||"rgb");return{space:s,values:e,alpha:r}}const Ua={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var t=i[0]/360,e=i[1]/100,r=i[2]/100,s,u,h,f,g,y=0;if(e===0)return g=r*255,[g,g,g];for(u=r<.5?r*(1+e):r+e-r*e,s=2*r-u,f=[0,0,0];y<3;)h=t+1/3*-(y-1),h<0?h++:h>1&&h--,g=6*h<1?s+(u-s)*6*h:2*h<1?u:3*h<2?s+(u-s)*(2/3-h)*6:s,f[y++]=g*255;return f}};qr.hsl=function(i){var t=i[0]/255,e=i[1]/255,r=i[2]/255,s=Math.min(t,e,r),u=Math.max(t,e,r),h=u-s,f,g,y;return u===s?f=0:t===u?f=(e-r)/h:e===u?f=2+(r-t)/h:r===u&&(f=4+(t-e)/h),f=Math.min(f*60,360),f<0&&(f+=360),y=(s+u)/2,u===s?g=0:y<=.5?g=h/(u+s):g=h/(2-u-s),[f,g*100,y*100]};function Nm(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var t,e=Tm(i);if(!e.space)return[];const r=e.space[0]==="h"?Ua.min:qr.min,s=e.space[0]==="h"?Ua.max:qr.max;return t=Array(3),t[0]=Math.min(Math.max(e.values[0],r[0]),s[0]),t[1]=Math.min(Math.max(e.values[1],r[1]),s[1]),t[2]=Math.min(Math.max(e.values[2],r[2]),s[2]),e.space[0]==="h"&&(t=Ua.rgb(t)),t.push(Math.min(Math.max(e.alpha,0),1)),t}function Mm(i){return typeof i=="string"?i:Za(i)}const Om=1024,Wr={};let ja=0;function Lm(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function Hh(i){const t=Vt.lchuv(qr.xyz(i));return t[3]=i[3],t}function Am(i){const t=Vt.rgb(jh.xyz(i));return t[3]=i[3],t}function Va(i){if(Wr.hasOwnProperty(i))return Wr[i];if(ja>=Om){let e=0;for(const r in Wr)e++&3||(delete Wr[r],--ja)}const t=Nm(i);if(t.length!==4)throw new Error('Failed to parse "'+i+'" as color');for(const e of t)if(isNaN(e))throw new Error('Failed to parse "'+i+'" as color');return Jh(t),Wr[i]=t,++ja,t}function Ur(i){return Array.isArray(i)?i:Va(i)}function Jh(i){return i[0]=Kt(i[0]+.5|0,0,255),i[1]=Kt(i[1]+.5|0,0,255),i[2]=Kt(i[2]+.5|0,0,255),i[3]=Kt(i[3],0,1),i}function Za(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let r=i[2];r!=(r|0)&&(r=r+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+r+","+s+")"}function Pm(i){try{return Va(i),!0}catch{return!1}}const Gn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";Gn.includes("firefox"),Gn.includes("safari")&&!Gn.includes("chrom")&&(Gn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Gn)),Gn.includes("webkit")&&Gn.includes("edge"),Gn.includes("macintosh");const Kh=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Dm=typeof Image<"u"&&Image.prototype.decode;(function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i})();function pe(i,t,e,r){let s;return e&&e.length?s=e.shift():Kh?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",r)}let Ha;function Ja(){return Ha||(Ha=pe(1,1)),Ha}function Fm(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Gm(i,t){return new Promise((e,r)=>{function s(){h(),e(i)}function u(){h(),r(new Error("Image load error"))}function h(){i.removeEventListener("load",s),i.removeEventListener("error",u)}i.addEventListener("load",s),i.addEventListener("error",u)})}function Bm(i,t){return t&&(i.src=t),i.src&&Dm?new Promise((e,r)=>i.decode().then(()=>e(i)).catch(s=>i.complete&&i.width?e(i):r(s))):Gm(i)}class Ym{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const r=this.cache_[e];!(t++&3)&&!r.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,r){const s=Ka(t,e,r);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,r){const s=Ka(t,e,r);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,r,s,u){const h=Ka(t,e,r),f=h in this.cache_;this.cache_[h]=s,u&&(s.getImageState()===yt.IDLE&&s.load(),s.getImageState()===yt.LOADING?s.ready().then(()=>{this.patternCache_[h]=Ja().createPattern(s.getImage(1),"repeat")}):this.patternCache_[h]=Ja().createPattern(s.getImage(1),"repeat")),f||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ka(i,t,e){const r=e?Ur(e):"null";return t+":"+i+":"+r}const Bn=new Ym;let jr=null;class zm extends th{constructor(t,e,r,s,u){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=r,this.canvas_={},this.color_=u,this.imageState_=s===void 0?yt.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===yt.LOADED){jr||(jr=pe(1,1,void 0,{willReadFrequently:!0})),jr.drawImage(this.image_,0,0);try{jr.getImageData(0,0,1,1),this.tainted_=!1}catch{jr=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Ge.CHANGE)}handleImageError_(){this.imageState_=yt.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=yt.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],r=pe(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===yt.IDLE){this.image_||this.initializeImage_(),this.imageState_=yt.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Bm(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==yt.LOADED)return;const e=this.image_,r=document.createElement("canvas");r.width=Math.ceil(e.width*t),r.height=Math.ceil(e.height*t);const s=r.getContext("2d");s.scale(t,t),s.drawImage(e,0,0),s.globalCompositeOperation="multiply",s.fillStyle=Mm(this.color_),s.fillRect(0,0,r.width/t,r.height/t),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),this.canvas_[t]=r}ready(){return this.ready_||(this.ready_=new Promise(t=>{this.imageState_===yt.LOADED||this.imageState_===yt.ERROR?t():this.addEventListener(Ge.CHANGE,function e(){(this.imageState_===yt.LOADED||this.imageState_===yt.ERROR)&&(this.removeEventListener(Ge.CHANGE,e),t())})})),this.ready_}}function Qa(i,t,e,r,s,u){let h=t===void 0?void 0:Bn.get(t,e,s);return h||(h=new zm(i,i instanceof HTMLImageElement?i.src||void 0:t,e,r,s),Bn.set(t,e,s,h,u)),u&&h&&!Bn.getPattern(t,e,s)&&Bn.set(t,e,s,h,u),h}function tn(i){return i?Array.isArray(i)?Za(i):typeof i=="object"&&"src"in i?$m(i):i:null}function $m(i){if(!i.offset||!i.size)return Bn.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=Bn.getPattern(t,void 0,i.color);if(e)return e;const r=Bn.get(i.src,"anonymous",null);if(r.getImageState()!==yt.LOADED)return null;const s=pe(i.size[0],i.size[1]);return s.drawImage(r.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),Qa(s.canvas,t,void 0,yt.LOADED,i.color,!0),Bn.getPattern(t,void 0,i.color)}const Xm=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Qh=["style","variant","weight","size","lineHeight","family"],tc=function(i){const t=i.match(Xm);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let r=0,s=Qh.length;r<s;++r){const u=t[r+1];u!==void 0&&(e[Qh[r]]=u)}return e.families=e.family.split(/,\s?/),e},ec="10px sans-serif",ce="#000",Vi="round",mn=[],vn=0,Zi="round",Vr=10,Zr="#000",Hr="center",Hs="middle",Ii=[0,0,0,0],Jr=1,Yn=new zi;let Hi=null,tu;const eu={},qm=function(){const t="32px ",e=["monospace","serif"],r=e.length,s="wmytzilWMYTZIL@#/&?$%10";let u,h;function f(y,p,m){let _=!0;for(let x=0;x<r;++x){const I=e[x];if(h=Js(y+" "+p+" "+t+I,s),m!=I){const k=Js(y+" "+p+" "+t+m+","+I,s);_=_&&k!=h}}return!!_}function g(){let y=!0;const p=Yn.getKeys();for(let m=0,_=p.length;m<_;++m){const x=p[m];Yn.get(x)<100&&(f.apply(this,x.split(`
`))?(da(eu),Hi=null,tu=void 0,Yn.set(x,100)):(Yn.set(x,Yn.get(x)+1,!0),y=!1))}y&&(clearInterval(u),u=void 0)}return function(y){const p=tc(y);if(!p)return;const m=p.families;for(let _=0,x=m.length;_<x;++_){const I=m[_],k=p.style+`
`+p.weight+`
`+I;Yn.get(k)===void 0&&(Yn.set(k,100,!0),f(p.style,p.weight,I)||(Yn.set(k,0,!0),u===void 0&&(u=setInterval(g,32))))}}}(),Wm=function(){let i;return function(t){let e=eu[t];if(e==null){if(Kh){const r=tc(t),s=nc(t,"Žg");e=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);eu[t]=e}return e}}();function nc(i,t){return Hi||(Hi=pe(1,1)),i!=tu&&(Hi.font=i,tu=Hi.font),Hi.measureText(t)}function Js(i,t){return nc(i,t).width}function ic(i,t,e){if(t in e)return e[t];const r=t.split(`
`).reduce((s,u)=>Math.max(s,Js(i,u)),0);return e[t]=r,r}function Um(i,t){const e=[],r=[],s=[];let u=0,h=0,f=0,g=0;for(let y=0,p=t.length;y<=p;y+=2){const m=t[y];if(m===`
`||y===p){u=Math.max(u,h),s.push(h),h=0,f+=g;continue}const _=t[y+1]||i.font,x=Js(_,m);e.push(x),h+=x;const I=Wm(_);r.push(I),g=Math.max(g,I)}return{width:u,height:f,widths:e,heights:r,lineWidths:s}}function jm(i,t,e,r,s,u,h,f,g,y,p){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=m=>m.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),r.contextInstructions?(i.translate(g,y),i.scale(p[0],p[1]),Vm(r,i)):p[0]<0||p[1]<0?(i.translate(g,y),i.scale(p[0],p[1]),i.drawImage(r,s,u,h,f,0,0,h,f)):i.drawImage(r,s,u,h,f,g,y,h*p[0],f*p[1]),i.restore()}function Vm(i,t){const e=i.contextInstructions;for(let r=0,s=e.length;r<s;r+=2)Array.isArray(e[r+1])?t[e[r]].apply(t,e[r+1]):t[e[r]]=e[r+1]}class Ks extends Zs{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?yt.LOADING:yt.LOADED,this.imageState_===yt.LOADING&&this.ready().then(()=>this.imageState_=yt.LOADED),this.render()}clone(){const t=this.getScale(),e=new Ks({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),r=this.getScaleArray();return[t[0]/2-e[0]/r[0],t[1]/2+e[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){let e=this.canvases_[t];if(!e){const r=this.renderOptions_,s=pe(r.size*t,r.size*t);this.draw_(r,s,t),e=s.canvas,this.canvases_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,r){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius_,u=this.radius2_===void 0?s:this.radius2_;if(s<u){const D=s;s=u,u=D}const h=this.radius2_===void 0?this.points_:this.points_*2,f=2*Math.PI/h,g=u*Math.sin(f),y=Math.sqrt(u*u-g*g),p=s-y,m=Math.sqrt(g*g+p*p),_=m/g;if(t==="miter"&&_<=r)return _*e;const x=e/2/_,I=e/2*(p/m),C=Math.sqrt((s+x)*(s+x)+I*I)-s;if(this.radius2_===void 0||t==="bevel")return C*2;const R=s*Math.sin(f),b=Math.sqrt(s*s-R*R),O=u-b,L=Math.sqrt(R*R+O*O)/R;if(L<=r){const D=L*e/2-u-s;return 2*Math.max(C,D)}return C*2}createRenderOptions(){let t=Vi,e=Zi,r=0,s=null,u=0,h,f=0;this.stroke_&&(h=tn(this.stroke_.getColor()??Zr),f=this.stroke_.getWidth()??Jr,s=this.stroke_.getLineDash(),u=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Zi,t=this.stroke_.getLineCap()??Vi,r=this.stroke_.getMiterLimit()??Vr);const g=this.calculateLineJoinSize_(e,f,r),y=Math.max(this.radius_,this.radius2_||0),p=Math.ceil(2*y+g);return{strokeStyle:h,strokeWidth:f,size:p,lineCap:t,lineDash:s,lineDashOffset:u,lineJoin:e,miterLimit:r}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=ce),e.fillStyle=tn(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let r=this.fill_.getColor(),s=0;typeof r=="string"&&(r=Ur(r)),r===null?s=1:Array.isArray(r)&&(s=r.length===4?r[3]:1),s===0&&(e=pe(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const r=this.radius_;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{const s=this.radius2_===void 0?r:this.radius2_;this.radius2_!==void 0&&(e*=2);const u=this.angle_-Math.PI/2,h=2*Math.PI/e;for(let f=0;f<e;f++){const g=u+f*h,y=f%2===0?r:s;t.lineTo(y*Math.cos(g),y*Math.sin(g))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=ce,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Qs extends Ks{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Qs({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class wi{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new wi({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Qa(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===yt.IDLE&&e.load(),e.getImageState()===yt.LOADING&&(this.patternImage_=e)}this.color_=t}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Ji{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Ji({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class zn{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=rc,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new zn({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=rc,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Zm(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(Jt(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let nu=null;function Hm(i,t){if(!nu){const e=new wi({color:"rgba(255,255,255,0.4)"}),r=new Ji({color:"#3399CC",width:1.25});nu=[new zn({image:new Qs({fill:e,stroke:r,radius:5}),fill:e,stroke:r})]}return nu}function rc(i){return i.getGeometry()}function sc(i,t,e,r){return e!==void 0&&r!==void 0?[e/i,r/t]:e!==void 0?e/i:r!==void 0?r/t:1}class Kr extends Zs{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,r=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,u=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:r,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:u,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const h=t.img!==void 0?t.img:null;let f=t.src;Jt(!(f!==void 0&&h),"`image` and `src` cannot be provided at the same time"),(f===void 0||f.length===0)&&h&&(f=h.src||jt(h)),Jt(f!==void 0&&f.length>0,"A defined and non-empty `src` or `image` must be provided"),Jt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let g;if(t.src!==void 0?g=yt.IDLE:h!==void 0&&(h instanceof HTMLImageElement?h.complete?g=h.src?yt.LOADED:yt.IDLE:g=yt.LOADING:g=yt.LOADED),this.color_=t.color!==void 0?Ur(t.color):null,this.iconImage_=Qa(h,f,this.crossOrigin_,g,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,t.width!==void 0||t.height!==void 0){let y,p;if(t.size)[y,p]=t.size;else{const m=this.getImage(1);if(m.width&&m.height)y=m.width,p=m.height;else if(m instanceof HTMLImageElement){this.initialOptions_=t;const _=()=>{if(this.unlistenImageChange(_),!this.initialOptions_)return;const x=this.iconImage_.getSize();this.setScale(sc(x[0],x[1],t.width,t.height))};this.listenImageChange(_);return}}y!==void 0&&this.setScale(sc(y,p,t.width,t.height))}}clone(){let t,e,r;return this.initialOptions_?(e=this.initialOptions_.width,r=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Kr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:r,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),r=this.getScaleArray();return[t[0]-e[0]/r[0],t[1]+e[1]/r[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=r[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==yt.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==yt.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Ge.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Ge.CHANGE,t)}ready(){return this.iconImage_.ready()}}const Jm="#333";class to{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=Xr(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new wi({color:Jm}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new to({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Xr(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}let Ki=0;const Qi=0,Gt=1<<Ki++,nt=1<<Ki++,me=1<<Ki++,Xt=1<<Ki++,_n=1<<Ki++,Qt=Math.pow(2,Ki)-1,oc={[Gt]:"boolean",[nt]:"number",[me]:"string",[Xt]:"color",[_n]:"number[]"},Km=Object.keys(oc).map(Number).sort(li);function te(i){const t=[];for(const e of Km)Qm(i,e)&&t.push(oc[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Qm(i,t){return(i&t)===t}function en(i,t){return!!(i&t)}function eo(i,t){return i===t}class $n{constructor(t,e){this.type=t,this.value=e}}class tv{constructor(t,e,...r){this.type=t,this.operator=e,this.args=r}}function ac(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function ev(i){switch(i){case"string":return me;case"color":return Xt;case"number":return nt;case"boolean":return Gt;case"number[]":return _n;default:throw new Error(`Unrecognized type hint: ${i}`)}}function wt(i,t,e){switch(typeof i){case"boolean":return new $n(Gt,i);case"number":return new $n(nt,i);case"string":{let s=me;return Pm(i)&&(s|=Xt),eo(s&e,Qi)||(s&=e),new $n(s,i)}}if(!Array.isArray(i))throw new Error("Expression must be an array or a primitive value");if(i.length===0)throw new Error("Empty expression");if(typeof i[0]=="string")return gv(i,t,e);for(const s of i)if(typeof s!="number")throw new Error("Expected an array of numbers");let r=_n;return(i.length===3||i.length===4)&&(r|=Xt),e&&(r&=e),new $n(r,i)}const $={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},nv={[$.Get]:ct(([i,t])=>t!==void 0?ev(t.value):Qt,dt(1,2),iv),[$.Var]:ct(([i])=>i.type,dt(1,1),rv),[$.Id]:ct(nt|me,Qr,sv),[$.Concat]:ct(me,dt(2,1/0),xt(Qt)),[$.GeometryType]:ct(me,Qr,ov),[$.Resolution]:ct(nt,Qr),[$.Zoom]:ct(nt,Qr),[$.Time]:ct(nt,Qr),[$.Any]:ct(Gt,dt(2,1/0),xt(Gt)),[$.All]:ct(Gt,dt(2,1/0),xt(Gt)),[$.Not]:ct(Gt,dt(1,1),xt(Gt)),[$.Equal]:ct(Gt,dt(2,2),xt(Qt),Xn),[$.NotEqual]:ct(Gt,dt(2,2),xt(Qt),Xn),[$.GreaterThan]:ct(Gt,dt(2,2),xt(Qt),Xn),[$.GreaterThanOrEqualTo]:ct(Gt,dt(2,2),xt(Qt),Xn),[$.LessThan]:ct(Gt,dt(2,2),xt(Qt),Xn),[$.LessThanOrEqualTo]:ct(Gt,dt(2,2),xt(Qt),Xn),[$.Multiply]:ct(i=>{let t=nt|Xt;for(let e=0;e<i.length;e++)t&=i[e].type;return t},dt(2,1/0),xt(nt|Xt),Xn),[$.Coalesce]:ct(i=>{let t=Qt;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},dt(2,1/0),xt(Qt),Xn),[$.Divide]:ct(nt,dt(2,2),xt(nt)),[$.Add]:ct(nt,dt(2,1/0),xt(nt)),[$.Subtract]:ct(nt,dt(2,2),xt(nt)),[$.Clamp]:ct(nt,dt(3,3),xt(nt)),[$.Mod]:ct(nt,dt(2,2),xt(nt)),[$.Pow]:ct(nt,dt(2,2),xt(nt)),[$.Abs]:ct(nt,dt(1,1),xt(nt)),[$.Floor]:ct(nt,dt(1,1),xt(nt)),[$.Ceil]:ct(nt,dt(1,1),xt(nt)),[$.Round]:ct(nt,dt(1,1),xt(nt)),[$.Sin]:ct(nt,dt(1,1),xt(nt)),[$.Cos]:ct(nt,dt(1,1),xt(nt)),[$.Atan]:ct(nt,dt(1,2),xt(nt)),[$.Sqrt]:ct(nt,dt(1,1),xt(nt)),[$.Match]:ct(i=>{let t=Qt;for(let e=2;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},dt(4,1/0),uc,uv),[$.Between]:ct(Gt,dt(3,3),xt(nt)),[$.Interpolate]:ct(i=>{let t=Xt|nt;for(let e=3;e<i.length;e+=2)t&=i[e].type;return t},dt(6,1/0),uc,lv),[$.Case]:ct(i=>{let t=Qt;for(let e=1;e<i.length;e+=2)t&=i[e].type;return t&=i[i.length-1].type,t},dt(3,1/0),av,hv),[$.In]:ct(Gt,dt(2,2),cv),[$.Number]:ct(nt,dt(1,1/0),xt(Qt)),[$.String]:ct(me,dt(1,1/0),xt(Qt)),[$.Array]:ct(i=>i.length===3||i.length===4?_n|Xt:_n,dt(1,1/0),xt(nt)),[$.Color]:ct(Xt,dt(1,4),xt(nt)),[$.Band]:ct(nt,dt(1,3),xt(nt)),[$.Palette]:ct(Xt,dt(2,2),fv),[$.ToString]:ct(me,dt(1,1),xt(Gt|nt|me|Xt))};function iv(i,t){const e=wt(i[1],t);if(!(e instanceof $n))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(t.properties.add(e.value),i.length===3){const r=wt(i[2],t);return[e,r]}return[e]}function rv(i,t,e,r){const s=i[1];if(typeof s!="string")throw new Error("Expected a string argument for var operation");if(t.variables.add(s),!("variables"in t.style)||t.style.variables[s]===void 0)return[new $n(Qt,s)];const u=t.style.variables[s],h=wt(u,t);if(h.value=s,r&&!en(r,h.type))throw new Error(`The variable ${s} has type ${te(h.type)} but the following type was expected: ${te(r)}`);return[h]}function sv(i,t){t.featureId=!0}function ov(i,t){t.geometryType=!0}function Qr(i,t){const e=i[0];if(i.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function dt(i,t){return function(e,r){const s=e[0],u=e.length-1;if(i===t){if(u!==i){const h=i===1?"":"s";throw new Error(`Expected ${i} argument${h} for ${s}, got ${u}`)}}else if(u<i||u>t){const h=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`Expected ${h} arguments for ${s}, got ${u}`)}}}function xt(i){return function(t,e){const r=t[0],s=t.length-1,u=new Array(s);for(let h=0;h<s;++h){const f=wt(t[h+1],e);if(!en(i,f.type)){const g=te(i),y=te(f.type);throw new Error(`Unexpected type for argument ${h} of ${r} operation, got ${g} but expected ${y}`)}f.type&=i,u[h]=f}return u}}function Xn(i,t,e){const r=i[0],s=i.length-1;let u=Qt;for(let f=0;f<e.length;++f)u&=e[f].type;if(u===Qi)throw new Error(`No common type could be found for arguments of ${r} operation`);const h=new Array(s);for(let f=0;f<s;++f)h[f]=wt(i[f+1],t,u);return h}function av(i,t){const e=i[0],r=i.length-1;if(r%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(r)} instead`)}function uc(i,t){const e=i[0],r=i.length-1;if(r%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(r)} instead`)}function uv(i,t,e,r){const s=i.length-1;let h=wt(i[1],t).type;const f=wt(i[i.length-1],t);let g=r!==void 0?r&f.type:f.type;const y=new Array(s-2);for(let m=0;m<s-2;m+=2){const _=wt(i[m+2],t),x=wt(i[m+3],t);h&=_.type,g&=x.type,y[m]=_,y[m+1]=x}const p=me|nt|Gt;if(!en(p,h))throw new Error(`Expected an input of type ${te(p)} for the interpolate operation, got ${te(h)} instead`);if(eo(g,Qi))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(i));for(let m=0;m<s-2;m+=2){const _=wt(i[m+2],t,h),x=wt(i[m+3],t,g);y[m]=_,y[m+1]=x}return[wt(i[1],t,h),...y,wt(i[i.length-1],t,g)]}function lv(i,t,e,r){const s=i[1];let u;switch(s[0]){case"linear":u=1;break;case"exponential":if(u=s[1],typeof u!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(u)} instead`);break;default:u=null}if(!u)throw new Error(`Invalid interpolation type: ${JSON.stringify(s)}`);u=wt(u,t);let h=wt(i[2],t);if(!en(nt,h.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${te(h.type)} instead`);h=wt(i[2],t,nt);const f=new Array(i.length-3);for(let g=0;g<f.length;g+=2){let y=wt(i[g+3],t);if(!en(nt,y.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${te(y.type)} at position ${g+2} instead`);let p=wt(i[g+4],t);if(!en(nt|Xt,p.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${te(p.type)} at position ${g+3} instead`);y=wt(i[g+3],t,nt),p=wt(i[g+4],t,nt|Xt),f[g]=y,f[g+1]=p}return[u,h,...f]}function hv(i,t,e,r){const s=wt(i[i.length-1],t);let u=r!==void 0?r&s.type:s.type;const h=new Array(i.length-1);for(let f=0;f<h.length-1;f+=2){const g=wt(i[f+1],t),y=wt(i[f+2],t);if(!en(Gt,g.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${te(g.type)} at position ${f} instead`);u&=y.type,h[f]=g,h[f+1]=y}if(eo(u,Qi))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(i));for(let f=0;f<h.length-1;f+=2)h[f+1]=wt(i[f+2],t,u);return h[h.length-1]=wt(i[i.length-1],t,u),h}function cv(i,t){let e=i[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let r=me|nt;const s=new Array(e.length);for(let h=0;h<s.length;h++){const f=wt(e[h],t);r&=f.type,s[h]=f}if(eo(r,Qi))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(i));return[wt(i[1],t,r),...s]}function fv(i,t){const e=wt(i[1],t,nt);if(e.type!==nt)throw new Error(`The first argument of palette must be an number, got ${te(e.type)} instead`);const r=i[2];if(!Array.isArray(r))throw new Error("The second argument of palette must be an array");const s=new Array(r.length);for(let u=0;u<s.length;u++){const h=wt(r[u],t,Xt);if(!(h instanceof $n))throw new Error(`The palette color at index ${u} must be a literal value`);if(!en(h.type,Xt))throw new Error(`The palette color at index ${u} should be of type color, got ${te(h.type)} instead`);s[u]=h}return[e,...s]}function ct(i,...t){return function(e,r,s){const u=e[0];let h=[];for(let g=0;g<t.length;g++)h=t[g](e,r,h,s)||h;let f=typeof i=="function"?i(h):i;if(s!==void 0){if(!en(f,s))throw new Error(`The following expression was expected to return ${te(s)}, but returns ${te(f)} instead: ${JSON.stringify(e)}`);f&=s}if(f===Qi)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new tv(f,u,...h)}}function gv(i,t,e){const r=i[0],s=nv[r];if(!s)throw new Error(`Unknown operator: ${r}`);return s(i,t,e)}function lc(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return lc(i.getGeometries()[0]);default:return""}}function hc(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function xn(i,t,e){const r=wt(i,e);if(!en(t,r.type)){const s=te(t),u=te(r.type);throw new Error(`Expected expression to be of type ${s}, got ${u}`)}return ze(r)}function ze(i,t){if(i instanceof $n){if(i.type===Xt&&typeof i.value=="string"){const r=Va(i.value);return function(){return r}}return function(){return i.value}}const e=i.operator;switch(e){case $.Number:case $.String:case $.Coalesce:return dv(i);case $.Get:case $.Var:return yv(i);case $.Id:return r=>r.featureId;case $.GeometryType:return r=>r.geometryType;case $.Concat:{const r=i.args.map(s=>ze(s));return s=>"".concat(...r.map(u=>u(s).toString()))}case $.Resolution:return r=>r.resolution;case $.Any:case $.All:case $.Between:case $.In:case $.Not:return mv(i);case $.Equal:case $.NotEqual:case $.LessThan:case $.LessThanOrEqualTo:case $.GreaterThan:case $.GreaterThanOrEqualTo:return pv(i);case $.Multiply:case $.Divide:case $.Add:case $.Subtract:case $.Clamp:case $.Mod:case $.Pow:case $.Abs:case $.Floor:case $.Ceil:case $.Round:case $.Sin:case $.Cos:case $.Atan:case $.Sqrt:return vv(i);case $.Case:return _v(i);case $.Match:return xv(i);case $.Interpolate:return Ev(i);case $.ToString:return Sv(i);default:throw new Error(`Unsupported operator ${e}`)}}function dv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let u=0;u<r;++u)s[u]=ze(i.args[u]);switch(e){case $.Coalesce:return u=>{for(let h=0;h<r;++h){const f=s[h](u);if(typeof f<"u"&&f!==null)return f}throw new Error("Expected one of the values to be non-null")};case $.Number:case $.String:return u=>{for(let h=0;h<r;++h){const f=s[h](u);if(typeof f===e)return f}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function yv(i,t){const r=i.args[0].value;switch(i.operator){case $.Get:return s=>s.properties[r];case $.Var:return s=>s.variables[r];default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function pv(i,t){const e=i.operator,r=ze(i.args[0]),s=ze(i.args[1]);switch(e){case $.Equal:return u=>r(u)===s(u);case $.NotEqual:return u=>r(u)!==s(u);case $.LessThan:return u=>r(u)<s(u);case $.LessThanOrEqualTo:return u=>r(u)<=s(u);case $.GreaterThan:return u=>r(u)>s(u);case $.GreaterThanOrEqualTo:return u=>r(u)>=s(u);default:throw new Error(`Unsupported comparison operator ${e}`)}}function mv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let u=0;u<r;++u)s[u]=ze(i.args[u]);switch(e){case $.Any:return u=>{for(let h=0;h<r;++h)if(s[h](u))return!0;return!1};case $.All:return u=>{for(let h=0;h<r;++h)if(!s[h](u))return!1;return!0};case $.Between:return u=>{const h=s[0](u),f=s[1](u),g=s[2](u);return h>=f&&h<=g};case $.In:return u=>{const h=s[0](u);for(let f=1;f<r;++f)if(h===s[f](u))return!0;return!1};case $.Not:return u=>!s[0](u);default:throw new Error(`Unsupported logical operator ${e}`)}}function vv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let u=0;u<r;++u)s[u]=ze(i.args[u]);switch(e){case $.Multiply:return u=>{let h=1;for(let f=0;f<r;++f)h*=s[f](u);return h};case $.Divide:return u=>s[0](u)/s[1](u);case $.Add:return u=>{let h=0;for(let f=0;f<r;++f)h+=s[f](u);return h};case $.Subtract:return u=>s[0](u)-s[1](u);case $.Clamp:return u=>{const h=s[0](u),f=s[1](u);if(h<f)return f;const g=s[2](u);return h>g?g:h};case $.Mod:return u=>s[0](u)%s[1](u);case $.Pow:return u=>Math.pow(s[0](u),s[1](u));case $.Abs:return u=>Math.abs(s[0](u));case $.Floor:return u=>Math.floor(s[0](u));case $.Ceil:return u=>Math.ceil(s[0](u));case $.Round:return u=>Math.round(s[0](u));case $.Sin:return u=>Math.sin(s[0](u));case $.Cos:return u=>Math.cos(s[0](u));case $.Atan:return r===2?u=>Math.atan2(s[0](u),s[1](u)):u=>Math.atan(s[0](u));case $.Sqrt:return u=>Math.sqrt(s[0](u));default:throw new Error(`Unsupported numeric operator ${e}`)}}function _v(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=ze(i.args[s]);return s=>{for(let u=0;u<e-1;u+=2)if(r[u](s))return r[u+1](s);return r[e-1](s)}}function xv(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=ze(i.args[s]);return s=>{const u=r[0](s);for(let h=1;h<e;h+=2)if(u===r[h](s))return r[h+1](s);return r[e-1](s)}}function Ev(i,t){const e=i.args.length,r=new Array(e);for(let s=0;s<e;++s)r[s]=ze(i.args[s]);return s=>{const u=r[0](s),h=r[1](s);let f,g;for(let y=2;y<e;y+=2){const p=r[y](s);let m=r[y+1](s);const _=Array.isArray(m);if(_&&(m=Lm(m)),p>=h)return y===2?m:_?Iv(u,h,f,g,p,m):ts(u,h,f,g,p,m);f=p,g=m}return g}}function Sv(i,t){const e=i.operator,r=i.args.length,s=new Array(r);for(let u=0;u<r;++u)s[u]=ze(i.args[u]);switch(e){case $.ToString:return u=>{const h=s[0](u);return i.args[0].type===Xt?Za(h):h.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function ts(i,t,e,r,s,u){const h=s-e;if(h===0)return r;const f=t-e,g=i===1?f/h:(Math.pow(i,f)-1)/(Math.pow(i,h)-1);return r+g*(u-r)}function Iv(i,t,e,r,s,u){if(s-e===0)return r;const f=Hh(r),g=Hh(u);let y=g[2]-f[2];y>180?y-=360:y<-180&&(y+=360);const p=[ts(i,t,e,f[0],s,g[0]),ts(i,t,e,f[1],s,g[1]),f[2]+ts(i,t,e,0,s,y),ts(i,t,e,r[3],s,u[3])];return Jh(Am(p))}function wv(i){return!0}function kv(i){const t=ac(),e=Cv(i,t),r=hc();return function(s,u){if(r.properties=s.getPropertiesInternal(),r.resolution=u,t.featureId){const h=s.getId();h!==void 0?r.featureId=h:r.featureId=null}return t.geometryType&&(r.geometryType=lc(s.getGeometry())),e(r)}}function cc(i){const t=ac(),e=i.length,r=new Array(e);for(let h=0;h<e;++h)r[h]=iu(i[h],t);const s=hc(),u=new Array(e);return function(h,f){if(s.properties=h.getPropertiesInternal(),s.resolution=f,t.featureId){const y=h.getId();y!==void 0?s.featureId=y:s.featureId=null}let g=0;for(let y=0;y<e;++y){const p=r[y](s);p&&(u[g]=p,g+=1)}return u.length=g,u}}function Cv(i,t){const e=i.length,r=new Array(e);for(let s=0;s<e;++s){const u=i[s],h="filter"in u?xn(u.filter,Gt,t):wv;let f;if(Array.isArray(u.style)){const g=u.style.length;f=new Array(g);for(let y=0;y<g;++y)f[y]=iu(u.style[y],t)}else f=[iu(u.style,t)];r[s]={filter:h,styles:f}}return function(s){const u=[];let h=!1;for(let f=0;f<e;++f){const g=r[f].filter;if(g(s)&&!(i[f].else&&h)){h=!0;for(const y of r[f].styles){const p=y(s);p&&u.push(p)}}}return u}}function iu(i,t){const e=es(i,"",t),r=ns(i,"",t),s=Rv(i,t),u=bv(i,t),h=fe(i,"z-index",t);if(!e&&!r&&!s&&!u&&!Yi(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const f=new zn;return function(g){let y=!0;if(e){const p=e(g);p&&(y=!1),f.setFill(p)}if(r){const p=r(g);p&&(y=!1),f.setStroke(p)}if(s){const p=s(g);p&&(y=!1),f.setText(p)}if(u){const p=u(g);p&&(y=!1),f.setImage(p)}return h&&f.setZIndex(h(g)),y?null:f}}function es(i,t,e){let r;if(t+"fill-pattern-src"in i?r=Ov(i,t+"fill-",e):r=ru(i,t+"fill-color",e),!r)return null;const s=new wi;return function(u){const h=r(u);return h==="none"?null:(s.setColor(h),s)}}function ns(i,t,e){const r=fe(i,t+"stroke-width",e),s=ru(i,t+"stroke-color",e);if(!r&&!s)return null;const u=En(i,t+"stroke-line-cap",e),h=En(i,t+"stroke-line-join",e),f=fc(i,t+"stroke-line-dash",e),g=fe(i,t+"stroke-line-dash-offset",e),y=fe(i,t+"stroke-miter-limit",e),p=new Ji;return function(m){if(s){const _=s(m);if(_==="none")return null;p.setColor(_)}if(r&&p.setWidth(r(m)),u){const _=u(m);if(_!=="butt"&&_!=="round"&&_!=="square")throw new Error("Expected butt, round, or square line cap");p.setLineCap(_)}if(h){const _=h(m);if(_!=="bevel"&&_!=="round"&&_!=="miter")throw new Error("Expected bevel, round, or miter line join");p.setLineJoin(_)}return f&&p.setLineDash(f(m)),g&&p.setLineDashOffset(g(m)),y&&p.setMiterLimit(y(m)),p}}function Rv(i,t){const e="text-",r=En(i,e+"value",t);if(!r)return null;const s=es(i,e,t),u=es(i,e+"background-",t),h=ns(i,e,t),f=ns(i,e+"background-",t),g=En(i,e+"font",t),y=fe(i,e+"max-angle",t),p=fe(i,e+"offset-x",t),m=fe(i,e+"offset-y",t),_=is(i,e+"overflow",t),x=En(i,e+"placement",t),I=fe(i,e+"repeat",t),k=io(i,e+"scale",t),C=is(i,e+"rotate-with-view",t),R=fe(i,e+"rotation",t),b=En(i,e+"align",t),O=En(i,e+"justify",t),A=En(i,e+"baseline",t),L=fc(i,e+"padding",t),D=so(i,e+"declutter-mode"),F=new to({declutterMode:D});return function(G){if(F.setText(r(G)),s&&F.setFill(s(G)),u&&F.setBackgroundFill(u(G)),h&&F.setStroke(h(G)),f&&F.setBackgroundStroke(f(G)),g&&F.setFont(g(G)),y&&F.setMaxAngle(y(G)),p&&F.setOffsetX(p(G)),m&&F.setOffsetY(m(G)),_&&F.setOverflow(_(G)),x){const B=x(G);if(B!=="point"&&B!=="line")throw new Error("Expected point or line for text-placement");F.setPlacement(B)}if(I&&F.setRepeat(I(G)),k&&F.setScale(k(G)),C&&F.setRotateWithView(C(G)),R&&F.setRotation(R(G)),b){const B=b(G);if(B!=="left"&&B!=="center"&&B!=="right"&&B!=="end"&&B!=="start")throw new Error("Expected left, right, center, start, or end for text-align");F.setTextAlign(B)}if(O){const B=O(G);if(B!=="left"&&B!=="right"&&B!=="center")throw new Error("Expected left, right, or center for text-justify");F.setJustify(B)}if(A){const B=A(G);if(B!=="bottom"&&B!=="top"&&B!=="middle"&&B!=="alphabetic"&&B!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");F.setTextBaseline(B)}return L&&F.setPadding(L(G)),F}}function bv(i,t){return"icon-src"in i?Tv(i,t):"shape-points"in i?Nv(i,t):"circle-radius"in i?Mv(i,t):null}function Tv(i,t){const e="icon-",r=e+"src",s=pc(i[r],r),u=no(i,e+"anchor",t),h=io(i,e+"scale",t),f=fe(i,e+"opacity",t),g=no(i,e+"displacement",t),y=fe(i,e+"rotation",t),p=is(i,e+"rotate-with-view",t),m=dc(i,e+"anchor-origin"),_=yc(i,e+"anchor-x-units"),x=yc(i,e+"anchor-y-units"),I=Dv(i,e+"color"),k=Av(i,e+"cross-origin"),C=Pv(i,e+"offset"),R=dc(i,e+"offset-origin"),b=ro(i,e+"width"),O=ro(i,e+"height"),A=Lv(i,e+"size"),L=so(i,e+"declutter-mode"),D=new Kr({src:s,anchorOrigin:m,anchorXUnits:_,anchorYUnits:x,color:I,crossOrigin:k,offset:C,offsetOrigin:R,height:O,width:b,size:A,declutterMode:L});return function(F){return f&&D.setOpacity(f(F)),g&&D.setDisplacement(g(F)),y&&D.setRotation(y(F)),p&&D.setRotateWithView(p(F)),h&&D.setScale(h(F)),u&&D.setAnchor(u(F)),D}}function Nv(i,t){const e="shape-",r=e+"points",s=e+"radius",u=su(i[r],r),h=su(i[s],s),f=es(i,e,t),g=ns(i,e,t),y=io(i,e+"scale",t),p=no(i,e+"displacement",t),m=fe(i,e+"rotation",t),_=is(i,e+"rotate-with-view",t),x=ro(i,e+"radius2"),I=ro(i,e+"angle"),k=so(i,e+"declutter-mode"),C=new Ks({points:u,radius:h,radius2:x,angle:I,declutterMode:k});return function(R){return f&&C.setFill(f(R)),g&&C.setStroke(g(R)),p&&C.setDisplacement(p(R)),m&&C.setRotation(m(R)),_&&C.setRotateWithView(_(R)),y&&C.setScale(y(R)),C}}function Mv(i,t){const e="circle-",r=es(i,e,t),s=ns(i,e,t),u=fe(i,e+"radius",t),h=io(i,e+"scale",t),f=no(i,e+"displacement",t),g=fe(i,e+"rotation",t),y=is(i,e+"rotate-with-view",t),p=so(i,e+"declutter-mode"),m=new Qs({radius:5,declutterMode:p});return function(_){return u&&m.setRadius(u(_)),r&&m.setFill(r(_)),s&&m.setStroke(s(_)),f&&m.setDisplacement(f(_)),g&&m.setRotation(g(_)),y&&m.setRotateWithView(y(_)),h&&m.setScale(h(_)),m}}function fe(i,t,e){if(!(t in i))return;const r=xn(i[t],nt,e);return function(s){return su(r(s),t)}}function En(i,t,e){if(!(t in i))return null;const r=xn(i[t],me,e);return function(s){return pc(r(s),t)}}function Ov(i,t,e){const r=En(i,t+"pattern-src",e),s=gc(i,t+"pattern-offset",e),u=gc(i,t+"pattern-size",e),h=ru(i,t+"color",e);return function(f){return{src:r(f),offset:s&&s(f),size:u&&u(f),color:h&&h(f)}}}function is(i,t,e){if(!(t in i))return null;const r=xn(i[t],Gt,e);return function(s){const u=r(s);if(typeof u!="boolean")throw new Error(`Expected a boolean for ${t}`);return u}}function ru(i,t,e){if(!(t in i))return null;const r=xn(i[t],Xt|me,e);return function(s){return mc(r(s),t)}}function fc(i,t,e){if(!(t in i))return null;const r=xn(i[t],_n,e);return function(s){return rs(r(s),t)}}function no(i,t,e){if(!(t in i))return null;const r=xn(i[t],_n,e);return function(s){const u=rs(r(s),t);if(u.length!==2)throw new Error(`Expected two numbers for ${t}`);return u}}function gc(i,t,e){if(!(t in i))return null;const r=xn(i[t],_n,e);return function(s){return vc(r(s),t)}}function io(i,t,e){if(!(t in i))return null;const r=xn(i[t],_n|nt,e);return function(s){return Fv(r(s),t)}}function ro(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function Lv(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return Xr(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function Av(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function dc(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function yc(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function Pv(i,t){const e=i[t];if(e!==void 0)return rs(e,t)}function so(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function Dv(i,t){const e=i[t];if(e!==void 0)return mc(e,t)}function rs(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let r=0;r<e;++r)if(typeof i[r]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function pc(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function su(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function mc(i,t){if(typeof i=="string")return i;const e=rs(i,t),r=e.length;if(r<3||r>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function vc(i,t){const e=rs(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function Fv(i,t){return typeof i=="number"?i:vc(i,t)}const _c={RENDER_ORDER:"renderOrder"};class Gv extends xm{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(_c.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const r=this.getDeclutter();r in t.declutter||(t.declutter[r]=new Wh(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(_c.RENDER_ORDER,t)}setStyle(t){this.style_=Bv(t),this.styleFunction_=t===null?void 0:Zm(this.style_),this.changed()}}function Bv(i){if(i===void 0)return Hm;if(!i)return null;if(typeof i=="function"||i instanceof zn)return i;if(!Array.isArray(i))return cc([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof zn){const s=new Array(t);for(let u=0;u<t;++u){const h=i[u];if(!(h instanceof zn))throw new Error("Expected a list of style instances");s[u]=h}return s}if("style"in e){const s=new Array(t);for(let u=0;u<t;++u){const h=i[u];if(!("style"in h))throw new Error("Expected a list of rules with a style property");s[u]=h}return kv(s)}return cc(i)}const rt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},oo=[rt.FILL],qn=[rt.STROKE],ki=[rt.BEGIN_PATH],xc=[rt.CLOSE_PATH];class Ec{drawCustom(t,e,r,s,u){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,r){}drawFeature(t,e,r){}drawGeometryCollection(t,e,r){}drawLineString(t,e,r){}drawMultiLineString(t,e,r){}drawMultiPoint(t,e,r){}drawMultiPolygon(t,e,r){}drawPoint(t,e,r){}drawPolygon(t,e,r){}drawText(t,e,r){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class ss extends Ec{constructor(t,e,r,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=r,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(r){return r*e})}appendFlatPointCoordinates(t,e){const r=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,u=this.coordinates;let h=u.length;for(let f=0,g=t.length;f<g;f+=e)s[0]=t[f],s[1]=t[f+1],pa(r,s)&&(u[h++]=s[0],u[h++]=s[1]);return h}appendFlatLineCoordinates(t,e,r,s,u,h){const f=this.coordinates;let g=f.length;const y=this.getBufferedMaxExtent();h&&(e+=s);let p=t[e],m=t[e+1];const _=this.tmpCoordinate_;let x=!0,I,k,C;for(I=e+s;I<r;I+=s)_[0]=t[I],_[1]=t[I+1],C=va(y,_),C!==k?(x&&(f[g++]=p,f[g++]=m,x=!1),f[g++]=_[0],f[g++]=_[1]):C===$t.INTERSECTING?(f[g++]=_[0],f[g++]=_[1],x=!1):x=!0,p=_[0],m=_[1],k=C;return(u&&x||I===e+s)&&(f[g++]=p,f[g++]=m),g}drawCustomCoordinates_(t,e,r,s,u){for(let h=0,f=r.length;h<f;++h){const g=r[h],y=this.appendFlatLineCoordinates(t,e,g,s,!1,!1);u.push(y),e=g}return e}drawCustom(t,e,r,s,u){this.beginGeometry(t,e,u);const h=t.getType(),f=t.getStride(),g=this.coordinates.length;let y,p,m,_,x;switch(h){case"MultiPolygon":y=t.getOrientedFlatCoordinates(),_=[];const I=t.getEndss();x=0;for(let k=0,C=I.length;k<C;++k){const R=[];x=this.drawCustomCoordinates_(y,x,I[k],f,R),_.push(R)}this.instructions.push([rt.CUSTOM,g,_,t,r,Oa,u]),this.hitDetectionInstructions.push([rt.CUSTOM,g,_,t,s||r,Oa,u]);break;case"Polygon":case"MultiLineString":m=[],y=h=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),x=this.drawCustomCoordinates_(y,0,t.getEnds(),f,m),this.instructions.push([rt.CUSTOM,g,m,t,r,Dr,u]),this.hitDetectionInstructions.push([rt.CUSTOM,g,m,t,s||r,Dr,u]);break;case"LineString":case"Circle":y=t.getFlatCoordinates(),p=this.appendFlatLineCoordinates(y,0,y.length,f,!1,!1),this.instructions.push([rt.CUSTOM,g,p,t,r,Pn,u]),this.hitDetectionInstructions.push([rt.CUSTOM,g,p,t,s||r,Pn,u]);break;case"MultiPoint":y=t.getFlatCoordinates(),p=this.appendFlatPointCoordinates(y,f),p>g&&(this.instructions.push([rt.CUSTOM,g,p,t,r,Pn,u]),this.hitDetectionInstructions.push([rt.CUSTOM,g,p,t,s||r,Pn,u]));break;case"Point":y=t.getFlatCoordinates(),this.coordinates.push(y[0],y[1]),p=this.coordinates.length,this.instructions.push([rt.CUSTOM,g,p,t,r,void 0,u]),this.hitDetectionInstructions.push([rt.CUSTOM,g,p,t,s||r,void 0,u]);break}this.endGeometry(e)}beginGeometry(t,e,r){this.beginGeometryInstruction1_=[rt.BEGIN_GEOMETRY,e,0,t,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[rt.BEGIN_GEOMETRY,e,0,t,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const r=t.length;let s,u,h=-1;for(e=0;e<r;++e)s=t[e],u=s[0],u==rt.END_GEOMETRY?h=e:u==rt.BEGIN_GEOMETRY&&(s[2]=e,Zy(this.hitDetectionInstructions,h,e),h=-1)}setFillStrokeStyle(t,e){const r=this.state;if(t){const s=t.getColor();r.fillPatternScale=s&&typeof s=="object"&&"src"in s?this.pixelRatio:1,r.fillStyle=tn(s||ce)}else r.fillStyle=void 0;if(e){const s=e.getColor();r.strokeStyle=tn(s||Zr);const u=e.getLineCap();r.lineCap=u!==void 0?u:Vi;const h=e.getLineDash();r.lineDash=h?h.slice():mn;const f=e.getLineDashOffset();r.lineDashOffset=f||vn;const g=e.getLineJoin();r.lineJoin=g!==void 0?g:Zi;const y=e.getWidth();r.lineWidth=y!==void 0?y:Jr;const p=e.getMiterLimit();r.miterLimit=p!==void 0?p:Vr,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0}createFill(t){const e=t.fillStyle,r=[rt.SET_FILL_STYLE,e];return typeof e!="string"&&r.push(t.fillPatternScale),r}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[rt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const r=t.fillStyle;(typeof r!="string"||t.currentFillStyle!=r)&&(r!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=r)}updateStrokeStyle(t,e){const r=t.strokeStyle,s=t.lineCap,u=t.lineDash,h=t.lineDashOffset,f=t.lineJoin,g=t.lineWidth,y=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=s||u!=t.currentLineDash&&!Bi(t.currentLineDash,u)||t.currentLineDashOffset!=h||t.currentLineJoin!=f||t.currentLineWidth!=g||t.currentMiterLimit!=y)&&(r!==void 0&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=s,t.currentLineDash=u,t.currentLineDashOffset=h,t.currentLineJoin=f,t.currentLineWidth=g,t.currentMiterLimit=y)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[rt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=rp(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ya(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Yv extends ss{constructor(t,e,r,s){super(t,e,r,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,r){if(!this.image_||this.maxExtent&&!pa(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,r);const s=t.getFlatCoordinates(),u=t.getStride(),h=this.coordinates.length,f=this.appendFlatPointCoordinates(s,u);this.instructions.push([rt.DRAW_IMAGE,h,f,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,h,f,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,r){if(!this.image_)return;this.beginGeometry(t,e,r);const s=t.getFlatCoordinates(),u=[];for(let g=0,y=s.length;g<y;g+=t.getStride())(!this.maxExtent||pa(this.maxExtent,s.slice(g,g+2)))&&u.push(s[g],s[g+1]);const h=this.coordinates.length,f=this.appendFlatPointCoordinates(u,2);this.instructions.push([rt.DRAW_IMAGE,h,f,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,h,f,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const r=t.getAnchor(),s=t.getSize(),u=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=u[0],this.originY_=u[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class zv extends ss{constructor(t,e,r,s){super(t,e,r,s)}drawFlatCoordinates_(t,e,r,s){const u=this.coordinates.length,h=this.appendFlatLineCoordinates(t,e,r,s,!1,!1),f=[rt.MOVE_TO_LINE_TO,u,h];return this.instructions.push(f),this.hitDetectionInstructions.push(f),r}drawLineString(t,e,r){const s=this.state,u=s.strokeStyle,h=s.lineWidth;if(u===void 0||h===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,r),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,mn,vn],ki);const f=t.getFlatCoordinates(),g=t.getStride();this.drawFlatCoordinates_(f,0,f.length,g),this.hitDetectionInstructions.push(qn),this.endGeometry(e)}drawMultiLineString(t,e,r){const s=this.state,u=s.strokeStyle,h=s.lineWidth;if(u===void 0||h===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,r),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,mn,vn],ki);const f=t.getEnds(),g=t.getFlatCoordinates(),y=t.getStride();let p=0;for(let m=0,_=f.length;m<_;++m)p=this.drawFlatCoordinates_(g,p,f[m],y);this.hitDetectionInstructions.push(qn),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(qn),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(qn),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ki)}}class Sc extends ss{constructor(t,e,r,s){super(t,e,r,s)}drawFlatCoordinatess_(t,e,r,s){const u=this.state,h=u.fillStyle!==void 0,f=u.strokeStyle!==void 0,g=r.length;this.instructions.push(ki),this.hitDetectionInstructions.push(ki);for(let y=0;y<g;++y){const p=r[y],m=this.coordinates.length,_=this.appendFlatLineCoordinates(t,e,p,s,!0,!f),x=[rt.MOVE_TO_LINE_TO,m,_];this.instructions.push(x),this.hitDetectionInstructions.push(x),f&&(this.instructions.push(xc),this.hitDetectionInstructions.push(xc)),e=p}return h&&(this.instructions.push(oo),this.hitDetectionInstructions.push(oo)),f&&(this.instructions.push(qn),this.hitDetectionInstructions.push(qn)),e}drawCircle(t,e,r){const s=this.state,u=s.fillStyle,h=s.strokeStyle;if(u===void 0&&h===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,ce]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,mn,vn]);const f=t.getFlatCoordinates(),g=t.getStride(),y=this.coordinates.length;this.appendFlatLineCoordinates(f,0,f.length,g,!1,!1);const p=[rt.CIRCLE,y];this.instructions.push(ki,p),this.hitDetectionInstructions.push(ki,p),s.fillStyle!==void 0&&(this.instructions.push(oo),this.hitDetectionInstructions.push(oo)),s.strokeStyle!==void 0&&(this.instructions.push(qn),this.hitDetectionInstructions.push(qn)),this.endGeometry(e)}drawPolygon(t,e,r){const s=this.state,u=s.fillStyle,h=s.strokeStyle;if(u===void 0&&h===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,ce]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,mn,vn]);const f=t.getEnds(),g=t.getOrientedFlatCoordinates(),y=t.getStride();this.drawFlatCoordinatess_(g,0,f,y),this.endGeometry(e)}drawMultiPolygon(t,e,r){const s=this.state,u=s.fillStyle,h=s.strokeStyle;if(u===void 0&&h===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,r),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,ce]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,mn,vn]);const f=t.getEndss(),g=t.getOrientedFlatCoordinates(),y=t.getStride();let p=0;for(let m=0,_=f.length;m<_;++m)p=this.drawFlatCoordinatess_(g,p,f[m],y);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let r=0,s=e.length;r<s;++r)e[r]=_i(e[r],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function $v(i,t,e,r,s){const u=[];let h=e,f=0,g=t.slice(e,2);for(;f<i&&h+s<r;){const[y,p]=g.slice(-2),m=t[h+s],_=t[h+s+1],x=Math.sqrt((m-y)*(m-y)+(_-p)*(_-p));if(f+=x,f>=i){const I=(i-f+x)/x,k=ye(y,m,I),C=ye(p,_,I);g.push(k,C),u.push(g),g=[k,C],f==i&&(h+=s),f=0}else if(f<i)g.push(t[h+s],t[h+s+1]),h+=s;else{const I=x-f,k=ye(y,m,I/x),C=ye(p,_,I/x);g.push(k,C),u.push(g),g=[k,C],f=0,h+=s}}return f>0&&u.push(g),u}function Xv(i,t,e,r,s){let u=e,h=e,f=0,g=0,y=e,p,m,_,x,I,k,C,R,b,O;for(m=e;m<r;m+=s){const A=t[m],L=t[m+1];I!==void 0&&(b=A-I,O=L-k,x=Math.sqrt(b*b+O*O),C!==void 0&&(g+=_,p=Math.acos((C*b+R*O)/(_*x)),p>i&&(g>f&&(f=g,u=y,h=m),g=0,y=m-s)),_=x,C=b,R=O),I=A,k=L}return g+=x,g>f?[y,m]:[u,h]}const ao={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class qv extends ss{constructor(t,e,r,s){super(t,e,r,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ce]={fillStyle:ce},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,r){const s=this.textFillState_,u=this.textStrokeState_,h=this.textState_;if(this.text_===""||!h||!s&&!u)return;const f=this.coordinates;let g=f.length;const y=t.getType();let p=null,m=t.getStride();if(h.placement==="line"&&(y=="LineString"||y=="MultiLineString"||y=="Polygon"||y=="MultiPolygon")){if(!Be(this.maxExtent,t.getExtent()))return;let _;if(p=t.getFlatCoordinates(),y=="LineString")_=[p.length];else if(y=="MultiLineString")_=t.getEnds();else if(y=="Polygon")_=t.getEnds().slice(0,1);else if(y=="MultiPolygon"){const C=t.getEndss();_=[];for(let R=0,b=C.length;R<b;++R)_.push(C[R][0])}this.beginGeometry(t,e,r);const x=h.repeat,I=x?void 0:h.textAlign;let k=0;for(let C=0,R=_.length;C<R;++C){let b;x?b=$v(x*this.resolution,p,k,_[C],m):b=[p.slice(k,_[C])];for(let O=0,A=b.length;O<A;++O){const L=b[O];let D=0,F=L.length;if(I==null){const B=Xv(h.maxAngle,L,0,L.length,2);D=B[0],F=B[1]}for(let B=D;B<F;B+=m)f.push(L[B],L[B+1]);const G=f.length;k=_[C],this.drawChars_(g,G),g=G}}this.endGeometry(e)}else{let _=h.overflow?null:[];switch(y){case"Point":case"MultiPoint":p=t.getFlatCoordinates();break;case"LineString":p=t.getFlatMidpoint();break;case"Circle":p=t.getCenter();break;case"MultiLineString":p=t.getFlatMidpoints(),m=2;break;case"Polygon":p=t.getFlatInteriorPoint(),h.overflow||_.push(p[2]/this.resolution),m=3;break;case"MultiPolygon":const b=t.getFlatInteriorPoints();p=[];for(let O=0,A=b.length;O<A;O+=3)h.overflow||_.push(b[O+2]/this.resolution),p.push(b[O],b[O+1]);if(p.length===0)return;m=2;break}const x=this.appendFlatPointCoordinates(p,m);if(x===g)return;if(_&&(x-g)/2!==p.length/m){let b=g/2;_=_.filter((O,A)=>{const L=f[(b+A)*2]===p[A*m]&&f[(b+A)*2+1]===p[A*m+1];return L||--b,L})}this.saveTextStates_(),(h.backgroundFill||h.backgroundStroke)&&(this.setFillStrokeStyle(h.backgroundFill,h.backgroundStroke),h.backgroundFill&&this.updateFillStyle(this.state,this.createFill),h.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e,r);let I=h.padding;if(I!=Ii&&(h.scale[0]<0||h.scale[1]<0)){let b=h.padding[0],O=h.padding[1],A=h.padding[2],L=h.padding[3];h.scale[0]<0&&(O=-O,L=-L),h.scale[1]<0&&(b=-b,A=-A),I=[b,O,A,L]}const k=this.pixelRatio;this.instructions.push([rt.DRAW_IMAGE,g,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,I==Ii?Ii:I.map(function(b){return b*k}),!!h.backgroundFill,!!h.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,_]);const C=1/k,R=this.state.fillStyle;h.backgroundFill&&(this.state.fillStyle=ce,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,g,x,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[C,C],NaN,this.declutterMode_,this.declutterImageWithText_,I,!!h.backgroundFill,!!h.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ce:this.fillKey_,this.textOffsetX_,this.textOffsetY_,_]),h.backgroundFill&&(this.state.fillStyle=R,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,r=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const u=this.textKey_;u in this.textStates||(this.textStates[u]={font:e.font,textAlign:e.textAlign||Hr,justify:e.justify,textBaseline:e.textBaseline||Hs,scale:e.scale});const h=this.fillKey_;r&&(h in this.fillStates||(this.fillStates[h]={fillStyle:r.fillStyle}))}drawChars_(t,e){const r=this.textStrokeState_,s=this.textState_,u=this.strokeKey_,h=this.textKey_,f=this.fillKey_;this.saveTextStates_();const g=this.pixelRatio,y=ao[s.textBaseline],p=this.textOffsetY_*g,m=this.text_,_=r?r.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([rt.DRAW_CHARS,t,e,y,s.overflow,f,s.maxAngle,g,p,u,_*g,m,h,1,this.declutterMode_]),this.hitDetectionInstructions.push([rt.DRAW_CHARS,t,e,y,s.overflow,f&&ce,s.maxAngle,g,p,u,_*g,m,h,1/g,this.declutterMode_])}setTextStyle(t,e){let r,s,u;if(!t)this.text_="";else{const h=t.getFill();h?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=tn(h.getColor()||ce)):(s=null,this.textFillState_=s);const f=t.getStroke();if(!f)u=null,this.textStrokeState_=u;else{u=this.textStrokeState_,u||(u={},this.textStrokeState_=u);const I=f.getLineDash(),k=f.getLineDashOffset(),C=f.getWidth(),R=f.getMiterLimit();u.lineCap=f.getLineCap()||Vi,u.lineDash=I?I.slice():mn,u.lineDashOffset=k===void 0?vn:k,u.lineJoin=f.getLineJoin()||Zi,u.lineWidth=C===void 0?Jr:C,u.miterLimit=R===void 0?Vr:R,u.strokeStyle=tn(f.getColor()||Zr)}r=this.textState_;const g=t.getFont()||ec;qm(g);const y=t.getScaleArray();r.overflow=t.getOverflow(),r.font=g,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.repeat=t.getRepeat(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||Hs,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||Ii,r.scale=y===void 0?[1,1]:y;const p=t.getOffsetX(),m=t.getOffsetY(),_=t.getRotateWithView(),x=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=p===void 0?0:p,this.textOffsetY_=m===void 0?0:m,this.textRotateWithView_=_===void 0?!1:_,this.textRotation_=x===void 0?0:x,this.strokeKey_=u?(typeof u.strokeStyle=="string"?u.strokeStyle:jt(u.strokeStyle))+u.lineCap+u.lineDashOffset+"|"+u.lineWidth+u.lineJoin+u.miterLimit+"["+u.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.repeat||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+jt(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Wv={Circle:Sc,Default:ss,Image:Yv,LineString:zv,Polygon:Sc,Text:qv};class Uv{constructor(t,e,r,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=r,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const r=this.buildersByZIndex_[e];for(const s in r){const u=r[s].finish();t[e][s]=u}}return t}getBuilder(t,e){const r=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[r];s===void 0&&(s={},this.buildersByZIndex_[r]=s);let u=s[e];if(u===void 0){const h=Wv[e];u=new h(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=u}return u}}class jv extends Lr{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return bt()}getData(t){return null}prepareFrame(t){return bt()}renderFrame(t,e){return bt()}loadedTileCallback(t,e,r){t[e]||(t[e]={}),t[e][r.tileCoord.toString()]=r}createLoadedTileFinder(t,e,r){return(s,u)=>{const h=this.loadedTileCallback.bind(this,r,s);return t.forEachLoadedTile(e,s,u,h)}}forEachFeatureAtCoordinate(t,e,r,s,u){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===yt.LOADED||e.getState()===yt.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=yt.LOADED&&e!=yt.ERROR&&t.addEventListener(Ge.CHANGE,this.boundHandleImageChange_),e==yt.IDLE&&(t.load(),e=t.getState()),e==yt.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class Vv extends Ke{constructor(t,e,r,s){super(t),this.inversePixelTransform=e,this.frameState=r,this.context=s}}class Ic{constructor(){Uy(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof Ja()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,r)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,r),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let r=0,s=e.length;r<s;r+=2){const u=e[r],h=e[r+1];if(typeof t[u]=="function")t[u](...h);else{if(typeof h=="function"){t[u]=h(t);continue}t[u]=h}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const wc=[];let tr=null;function Zv(){tr=pe(1,1,void 0,{willReadFrequently:!0})}class Hv extends jv{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=yn(),this.pixelTransform=yn(),this.inversePixelTransform=yn(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,r){tr||Zv(),tr.clearRect(0,0,1,1);let s;try{tr.drawImage(t,e,r,1,1,0,0,1,1),s=tr.getImageData(0,0,1,1).data}catch{return tr=null,null}return s}getBackground(t){let r=this.getLayer().getBackground();return typeof r=="function"&&(r=r(t.viewState.resolution)),r||void 0}useContainer(t,e,r){const s=this.getLayer().getClassName();let u,h;if(t&&t.className===s&&(!r||t&&t.style.backgroundColor&&Bi(Ur(t.style.backgroundColor),Ur(r)))){const f=t.firstElementChild;f instanceof HTMLCanvasElement&&(h=f.getContext("2d"))}if(h&&h.canvas.style.transform===e?(this.container=t,this.context=h,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){u=document.createElement("div"),u.className=s;let f=u.style;f.position="absolute",f.width="100%",f.height="100%",h=pe();const g=h.canvas;u.appendChild(g),f=g.style,f.position="absolute",f.left="0",f.transformOrigin="top left",this.container=u,this.context=h}!this.containerReused&&r&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=r)}clipUnrotated(t,e,r){const s=lh(r),u=hh(r),h=uh(r),f=ah(r);le(e.coordinateToPixelTransform,s),le(e.coordinateToPixelTransform,u),le(e.coordinateToPixelTransform,h),le(e.coordinateToPixelTransform,f);const g=this.inversePixelTransform;le(g,s),le(g,u),le(g,h),le(g,f),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(u[0]),Math.round(u[1])),t.lineTo(Math.round(h[0]),Math.round(h[1])),t.lineTo(Math.round(f[0]),Math.round(f[1])),t.clip()}dispatchRenderEvent_(t,e,r){const s=this.getLayer();if(s.hasListener(t)){const u=new Vv(t,this.inversePixelTransform,r,e);s.dispatchEvent(u)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Si.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Si.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Ic),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Si.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Si.POSTRENDER,this.context,t))}getRenderTransform(t,e,r,s,u,h,f){const g=u/2,y=h/2,p=s/e,m=-p,_=-t[0]+f,x=-t[1];return hi(this.tempTransform,g,y,p,m,-r,_,x)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Jv(i,t,e,r,s,u,h,f,g,y,p,m){let _=i[t],x=i[t+1],I=0,k=0,C=0,R=0;function b(){I=_,k=x,t+=r,_=i[t],x=i[t+1],R+=C,C=Math.sqrt((_-I)*(_-I)+(x-k)*(x-k))}do b();while(t<e-r&&R+C<u);let O=C===0?0:(u-R)/C;const A=ye(I,_,O),L=ye(k,x,O),D=t-r,F=R,G=u+f*g(y,s,p);for(;t<e-r&&R+C<G;)b();O=C===0?0:(G-R)/C;const B=ye(I,_,O),tt=ye(k,x,O);let J;if(m){const V=[A,L,B,tt];wh(V,0,4,2,m,V,V),J=V[0]>V[2]}else J=A>B;const H=Math.PI,Q=[],X=D+r===t;t=D,C=0,R=F,_=i[t],x=i[t+1];let K;if(X){b(),K=Math.atan2(x-k,_-I),J&&(K+=K>0?-H:H);const V=(B+A)/2,lt=(tt+L)/2;return Q[0]=[V,lt,(G-u)/2,K,s],Q}s=s.replace(/\n/g," ");for(let V=0,lt=s.length;V<lt;){b();let ft=Math.atan2(x-k,_-I);if(J&&(ft+=ft>0?-H:H),K!==void 0){let z=ft-K;if(z+=z>H?-2*H:z<-H?2*H:0,Math.abs(z)>h)return null}K=ft;const St=V;let Z=0;for(;V<lt;++V){const z=J?lt-V-1:V,ve=f*g(y,s[z],p);if(t+r<e&&R+C<u+Z+ve/2)break;Z+=ve}if(V===St)continue;const pt=J?s.substring(lt-St,lt-V):s.substring(St,V);O=C===0?0:(u+Z/2-R)/C;const vt=ye(I,_,O),Pt=ye(k,x,O);Q.push([vt,Pt,Z/2,ft,pt]),u+=Z}return Q}const er=fi(),Wn=[],Sn=[],In=[],Un=[];function kc(i){return i[3].declutterBox}const Cc=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function ou(i,t){return t==="start"?t=Cc.test(i)?"right":"left":t==="end"&&(t=Cc.test(i)?"left":"right"),ao[t]}function Kv(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}class Qv{constructor(t,e,r,s,u){this.overlaps=r,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=yn(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=u?new Ic:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,r,s){const u=t+e+r+s;if(this.labels_[u])return this.labels_[u];const h=s?this.strokeStates[s]:null,f=r?this.fillStates[r]:null,g=this.textStates[e],y=this.pixelRatio,p=[g.scale[0]*y,g.scale[1]*y],m=Array.isArray(t),_=g.justify?ao[g.justify]:ou(Array.isArray(t)?t[0]:t,g.textAlign||Hr),x=s&&h.lineWidth?h.lineWidth:0,I=m?t:t.split(`
`).reduce(Kv,[]),{width:k,height:C,widths:R,heights:b,lineWidths:O}=Um(g,I),A=k+x,L=[],D=(A+2)*p[0],F=(C+x)*p[1],G={width:D<0?Math.floor(D):Math.ceil(D),height:F<0?Math.floor(F):Math.ceil(F),contextInstructions:L};(p[0]!=1||p[1]!=1)&&L.push("scale",p),s&&(L.push("strokeStyle",h.strokeStyle),L.push("lineWidth",x),L.push("lineCap",h.lineCap),L.push("lineJoin",h.lineJoin),L.push("miterLimit",h.miterLimit),L.push("setLineDash",[h.lineDash]),L.push("lineDashOffset",h.lineDashOffset)),r&&L.push("fillStyle",f.fillStyle),L.push("textBaseline","middle"),L.push("textAlign","center");const B=.5-_;let tt=_*A+B*x;const J=[],H=[];let Q=0,X=0,K=0,V=0,lt;for(let ft=0,St=I.length;ft<St;ft+=2){const Z=I[ft];if(Z===`
`){X+=Q,Q=0,tt=_*A+B*x,++V;continue}const pt=I[ft+1]||g.font;pt!==lt&&(s&&J.push("font",pt),r&&H.push("font",pt),lt=pt),Q=Math.max(Q,b[K]);const vt=[Z,tt+B*R[K]+_*(R[K]-O[V]),.5*(x+Q)+X];tt+=R[K],s&&J.push("strokeText",vt),r&&H.push("fillText",vt),++K}return Array.prototype.push.apply(L,J),Array.prototype.push.apply(L,H),this.labels_[u]=G,G}replayTextBackground_(t,e,r,s,u,h,f){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,s),t.lineTo.apply(t,u),t.lineTo.apply(t,e),h&&(this.alignAndScaleFill_=h[2],this.fill_(t)),f&&(this.setStrokeStyle_(t,f),t.stroke())}calculateImageOrLabelDimensions_(t,e,r,s,u,h,f,g,y,p,m,_,x,I,k,C){f*=_[0],g*=_[1];let R=r-f,b=s-g;const O=u+y>t?t-y:u,A=h+p>e?e-p:h,L=I[3]+O*_[0]+I[1],D=I[0]+A*_[1]+I[2],F=R-I[3],G=b-I[0];(k||m!==0)&&(Wn[0]=F,Un[0]=F,Wn[1]=G,Sn[1]=G,Sn[0]=F+L,In[0]=Sn[0],In[1]=G+D,Un[1]=In[1]);let B;return m!==0?(B=hi(yn(),r,s,1,1,m,-r,-s),le(B,Wn),le(B,Sn),le(B,In),le(B,Un),gi(Math.min(Wn[0],Sn[0],In[0],Un[0]),Math.min(Wn[1],Sn[1],In[1],Un[1]),Math.max(Wn[0],Sn[0],In[0],Un[0]),Math.max(Wn[1],Sn[1],In[1],Un[1]),er)):gi(Math.min(F,F+L),Math.min(G,G+D),Math.max(F,F+L),Math.max(G,G+D),er),x&&(R=Math.round(R),b=Math.round(b)),{drawImageX:R,drawImageY:b,drawImageW:O,drawImageH:A,originX:y,originY:p,declutterBox:{minX:er[0],minY:er[1],maxX:er[2],maxY:er[3],value:C},canvasTransform:B,scale:_}}replayImageOrLabel_(t,e,r,s,u,h,f){const g=!!(h||f),y=s.declutterBox,p=f?f[2]*s.scale[0]/2:0;return y.minX-p<=e[0]&&y.maxX+p>=0&&y.minY-p<=e[1]&&y.maxY+p>=0&&(g&&this.replayTextBackground_(t,Wn,Sn,In,Un,h,f),jm(t,s.canvasTransform,u,r,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const r=le(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(r[0]%s,r[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,r,s){const u=this.textStates[e],h=this.createLabel(t,e,s,r),f=this.strokeStates[r],g=this.pixelRatio,y=ou(Array.isArray(t)?t[0]:t,u.textAlign||Hr),p=ao[u.textBaseline||Hs],m=f&&f.lineWidth?f.lineWidth:0,_=h.width/g-2*u.scale[0],x=y*_+2*(.5-y)*m,I=p*h.height/g+2*(.5-p)*m;return{label:h,anchorX:x,anchorY:I}}execute_(t,e,r,s,u,h,f,g){const y=this.zIndexContext_;let p;this.pixelCoordinates_&&Bi(r,this.renderedTransform_)?p=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),p=An(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),Qy(this.renderedTransform_,r));let m=0;const _=s.length;let x=0,I,k,C,R,b,O,A,L,D,F,G,B,tt,J=0,H=0,Q=null,X=null;const K=this.coordinateCache_,V=this.viewRotation_,lt=Math.round(Math.atan2(-r[1],r[0])*1e12)/1e12,ft={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:V},St=this.instructions!=s||this.overlaps?0:200;let Z,pt,vt,Pt;for(;m<_;){const z=s[m];switch(z[0]){case rt.BEGIN_GEOMETRY:Z=z[1],Pt=z[3],Z.getGeometry()?f!==void 0&&!Be(f,Pt.getExtent())?m=z[2]+1:++m:m=z[2],y&&(y.zIndex=z[4]);break;case rt.BEGIN_PATH:J>St&&(this.fill_(t),J=0),H>St&&(t.stroke(),H=0),!J&&!H&&(t.beginPath(),b=NaN,O=NaN),++m;break;case rt.CIRCLE:x=z[1];const ws=p[x],Er=p[x+1],P=p[x+2],Ml=p[x+3],Tt=P-ws,et=Ml-Er,T=Math.sqrt(Tt*Tt+et*et);t.moveTo(ws+T,Er),t.arc(ws,Er,T,0,2*Math.PI,!0),++m;break;case rt.CLOSE_PATH:t.closePath(),++m;break;case rt.CUSTOM:x=z[1],I=z[2];const Me=z[3],Sr=z[4],Ue=z[5];ft.geometry=Me,ft.feature=Z,m in K||(K[m]=[]);const ri=K[m];Ue?Ue(p,x,I,2,ri):(ri[0]=p[x],ri[1]=p[x+1],ri.length=2),y&&(y.zIndex=z[6]),Sr(ri,ft),++m;break;case rt.DRAW_IMAGE:x=z[1],I=z[2],D=z[3],k=z[4],C=z[5];let Mi=z[6];const Ol=z[7],U=z[8],ia=z[9],ks=z[10];let je=z[11];const Ll=z[12];let ht=z[13];R=z[14]||"declutter";const Ve=z[15];if(!D&&z.length>=20){F=z[19],G=z[20],B=z[21],tt=z[22];const Yt=this.drawLabelWithPointPlacement_(F,G,B,tt);D=Yt.label,z[3]=D;const j=z[23];k=(Yt.anchorX-j)*this.pixelRatio,z[4]=k;const Ht=z[24];C=(Yt.anchorY-Ht)*this.pixelRatio,z[5]=C,Mi=D.height,z[6]=Mi,ht=D.width,z[13]=ht}let si;z.length>25&&(si=z[25]);let Oi,st,oi;z.length>17?(Oi=z[16],st=z[17],oi=z[18]):(Oi=Ii,st=!1,oi=!1),ks&&lt?je+=V:!ks&&!lt&&(je-=V);let _t=0;for(;x<I;x+=2){if(si&&si[_t++]<ht/this.pixelRatio)continue;const Yt=this.calculateImageOrLabelDimensions_(D.width,D.height,p[x],p[x+1],ht,Mi,k,C,U,ia,je,Ll,u,Oi,st||oi,Z),j=[t,e,D,Yt,Ol,st?Q:null,oi?X:null];if(g){let Ht,ae,Ut;if(Ve){const Mt=I-x;if(!Ve[Mt]){Ve[Mt]={args:j,declutterMode:R};continue}const Dt=Ve[Mt];Ht=Dt.args,ae=Dt.declutterMode,delete Ve[Mt],Ut=kc(Ht)}let Oe,xe;if(Ht&&(ae!=="declutter"||!g.collides(Ut))&&(Oe=!0),(R!=="declutter"||!g.collides(Yt.declutterBox))&&(xe=!0),ae==="declutter"&&R==="declutter"){const Mt=Oe&&xe;Oe=Mt,xe=Mt}Oe&&(ae!=="none"&&g.insert(Ut),this.replayImageOrLabel_.apply(this,Ht)),xe&&(R!=="none"&&g.insert(Yt.declutterBox),this.replayImageOrLabel_.apply(this,j))}else this.replayImageOrLabel_.apply(this,j)}++m;break;case rt.DRAW_CHARS:const ut=z[1],ra=z[2],_e=z[3],Al=z[4];tt=z[5];const ot=z[6],sa=z[7],oa=z[8];B=z[9];const Li=z[10];F=z[11],G=z[12];const oe=[z[13],z[13]];R=z[14]||"declutter";const bn=this.textStates[G],ie=bn.font,ai=[bn.scale[0]*sa,bn.scale[1]*sa];let hn;ie in this.widths_?hn=this.widths_[ie]:(hn={},this.widths_[ie]=hn);const aa=Ah(p,ut,ra,2),Cs=Math.abs(ai[0])*ic(ie,F,hn);if(Al||Cs<=aa){const Yt=this.textStates[G].textAlign,j=(aa-Cs)*ou(F,Yt),Ht=Jv(p,ut,ra,2,F,j,ot,Math.abs(ai[0]),ic,ie,hn,lt?0:this.viewRotation_);t:if(Ht){const ae=[];let Ut,Oe,xe,Mt,Dt;if(B)for(Ut=0,Oe=Ht.length;Ut<Oe;++Ut){Dt=Ht[Ut],xe=Dt[4],Mt=this.createLabel(xe,G,"",B),k=Dt[2]+(ai[0]<0?-Li:Li),C=_e*Mt.height+(.5-_e)*2*Li*ai[1]/ai[0]-oa;const Le=this.calculateImageOrLabelDimensions_(Mt.width,Mt.height,Dt[0],Dt[1],Mt.width,Mt.height,k,C,0,0,Dt[3],oe,!1,Ii,!1,Z);if(g&&R==="declutter"&&g.collides(Le.declutterBox))break t;ae.push([t,e,Mt,Le,1,null,null])}if(tt)for(Ut=0,Oe=Ht.length;Ut<Oe;++Ut){Dt=Ht[Ut],xe=Dt[4],Mt=this.createLabel(xe,G,tt,""),k=Dt[2],C=_e*Mt.height-oa;const Le=this.calculateImageOrLabelDimensions_(Mt.width,Mt.height,Dt[0],Dt[1],Mt.width,Mt.height,k,C,0,0,Dt[3],oe,!1,Ii,!1,Z);if(g&&R==="declutter"&&g.collides(Le.declutterBox))break t;ae.push([t,e,Mt,Le,1,null,null])}g&&R!=="none"&&g.load(ae.map(kc));for(let Le=0,Ir=ae.length;Le<Ir;++Le)this.replayImageOrLabel_.apply(this,ae[Le])}}++m;break;case rt.END_GEOMETRY:if(h!==void 0){Z=z[1];const Yt=h(Z,Pt);if(Yt)return Yt}++m;break;case rt.FILL:St?J++:this.fill_(t),++m;break;case rt.MOVE_TO_LINE_TO:for(x=z[1],I=z[2],pt=p[x],vt=p[x+1],A=pt+.5|0,L=vt+.5|0,(A!==b||L!==O)&&(t.moveTo(pt,vt),b=A,O=L),x+=2;x<I;x+=2)pt=p[x],vt=p[x+1],A=pt+.5|0,L=vt+.5|0,(x==I-2||A!==b||L!==O)&&(t.lineTo(pt,vt),b=A,O=L);++m;break;case rt.SET_FILL_STYLE:Q=z,this.alignAndScaleFill_=z[2],J&&(this.fill_(t),J=0,H&&(t.stroke(),H=0)),t.fillStyle=z[1],++m;break;case rt.SET_STROKE_STYLE:X=z,H&&(t.stroke(),H=0),this.setStrokeStyle_(t,z),++m;break;case rt.STROKE:St?H++:t.stroke(),++m;break;default:++m;break}}J&&this.fill_(t),H&&t.stroke()}execute(t,e,r,s,u,h){this.viewRotation_=s,this.execute_(t,e,r,this.instructions,u,void 0,void 0,h)}executeHitDetection(t,e,r,s,u){return this.viewRotation_=r,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,u)}}const os=["Polygon","Circle","LineString","Image","Text","Default"],Rc=["Image","Text"],t_=os.filter(i=>!Rc.includes(i));class e_{constructor(t,e,r,s,u,h,f){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=r,this.resolution_=e,this.renderBuffer_=h,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=yn(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(u,f)}clip(t,e){const r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()}createExecutors_(t,e){for(const r in t){let s=this.executorsByZIndex_[r];s===void 0&&(s={},this.executorsByZIndex_[r]=s);const u=t[r];for(const h in u){const f=u[h];s[h]=new Qv(this.resolution_,this.pixelRatio_,this.overlaps_,f,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const r=this.executorsByZIndex_[e];for(let s=0,u=t.length;s<u;++s)if(t[s]in r)return!0}return!1}forEachFeatureAtCoordinate(t,e,r,s,u,h){s=Math.round(s);const f=s*2+1,g=hi(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-r,-t[0],-t[1]),y=!this.hitDetectionContext_;y&&(this.hitDetectionContext_=pe(f,f,void 0,{willReadFrequently:!0}));const p=this.hitDetectionContext_;p.canvas.width!==f||p.canvas.height!==f?(p.canvas.width=f,p.canvas.height=f):y||p.clearRect(0,0,f,f);let m;this.renderBuffer_!==void 0&&(m=fi(),op(m,t),ya(m,e*(this.renderBuffer_+s),m));const _=n_(s);let x;function I(L,D){const F=p.getImageData(0,0,f,f).data;for(let G=0,B=_.length;G<B;G++)if(F[_[G]]>0){if(!h||x!=="Image"&&x!=="Text"||h.includes(L)){const tt=(_[G]-3)/4,J=s-tt%f,H=s-(tt/f|0),Q=u(L,D,J*J+H*H);if(Q)return Q}p.clearRect(0,0,f,f);break}}const k=Object.keys(this.executorsByZIndex_).map(Number);k.sort(li);let C,R,b,O,A;for(C=k.length-1;C>=0;--C){const L=k[C].toString();for(b=this.executorsByZIndex_[L],R=os.length-1;R>=0;--R)if(x=os[R],O=b[x],O!==void 0&&(A=O.executeHitDetection(p,g,r,I,m),A))return A}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const r=e[0],s=e[1],u=e[2],h=e[3],f=[r,s,r,h,u,h,u,s];return An(f,0,8,2,t,f),f}isEmpty(){return Yi(this.executorsByZIndex_)}execute(t,e,r,s,u,h,f){const g=Object.keys(this.executorsByZIndex_).map(Number);g.sort(li),h=h||os;let y,p,m,_,x,I;for(f&&g.reverse(),y=0,p=g.length;y<p;++y){const k=g[y].toString();for(x=this.executorsByZIndex_[k],m=0,_=h.length;m<_;++m){const C=h[m];if(I=x[C],I!==void 0){const R=f===null?void 0:I.getZIndexContext(),b=R?R.getContext():t,O=this.maxExtent_&&C!=="Image"&&C!=="Text";if(O&&(b.save(),this.clip(b,r)),I.execute(b,e,r,s,u,f),O&&b.restore(),R){R.offset();const A=g[y];this.deferredZIndexContexts_[A]||(this.deferredZIndexContexts_[A]=[]),this.deferredZIndexContexts_[A].push(R)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(li);for(let r=0,s=e.length;r<s;++r)t[e[r]].forEach(u=>{u.draw(this.renderedContext_),u.clear()})}}const au={};function n_(i){if(au[i]!==void 0)return au[i];const t=i*2+1,e=i*i,r=new Array(e+1);for(let u=0;u<=i;++u)for(let h=0;h<=i;++h){const f=u*u+h*h;if(f>e)break;let g=r[f];g||(g=[],r[f]=g),g.push(((i+u)*t+(i+h))*4+3),u>0&&g.push(((i-u)*t+(i+h))*4+3),h>0&&(g.push(((i+u)*t+(i-h))*4+3),u>0&&g.push(((i-u)*t+(i-h))*4+3))}const s=[];for(let u=0,h=r.length;u<h;++u)r[u]&&s.push(...r[u]);return au[i]=s,s}class i_ extends Ec{constructor(t,e,r,s,u,h,f){super(),this.context_=t,this.pixelRatio_=e,this.extent_=r,this.transform_=s,this.transformRotation_=s?Cp(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=u,this.squaredTolerance_=h,this.userTransform_=f,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=yn()}drawImages_(t,e,r,s){if(!this.image_)return;const u=An(t,e,r,s,this.transform_,this.pixelCoordinates_),h=this.context_,f=this.tmpLocalTransform_,g=h.globalAlpha;this.imageOpacity_!=1&&(h.globalAlpha=g*this.imageOpacity_);let y=this.imageRotation_;this.transformRotation_===0&&(y-=this.viewRotation_),this.imageRotateWithView_&&(y+=this.viewRotation_);for(let p=0,m=u.length;p<m;p+=2){const _=u[p]-this.imageAnchorX_,x=u[p+1]-this.imageAnchorY_;if(y!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const I=_+this.imageAnchorX_,k=x+this.imageAnchorY_;hi(f,I,k,1,1,y,-I,-k),h.save(),h.transform.apply(h,f),h.translate(I,k),h.scale(this.imageScale_[0],this.imageScale_[1]),h.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),h.restore()}else h.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,_,x,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(h.globalAlpha=g)}drawText_(t,e,r,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const u=An(t,e,r,s,this.transform_,this.pixelCoordinates_),h=this.context_;let f=this.textRotation_;for(this.transformRotation_===0&&(f-=this.viewRotation_),this.textRotateWithView_&&(f+=this.viewRotation_);e<r;e+=s){const g=u[e]+this.textOffsetX_,y=u[e+1]+this.textOffsetY_;f!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(h.save(),h.translate(g-this.textOffsetX_,y-this.textOffsetY_),h.rotate(f),h.translate(this.textOffsetX_,this.textOffsetY_),h.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&h.strokeText(this.text_,0,0),this.textFillState_&&h.fillText(this.text_,0,0),h.restore()):(this.textStrokeState_&&h.strokeText(this.text_,g,y),this.textFillState_&&h.fillText(this.text_,g,y))}}moveToLineTo_(t,e,r,s,u){const h=this.context_,f=An(t,e,r,s,this.transform_,this.pixelCoordinates_);h.moveTo(f[0],f[1]);let g=f.length;u&&(g-=2);for(let y=2;y<g;y+=2)h.lineTo(f[y],f[y+1]);return u&&h.closePath(),r}drawRings_(t,e,r,s){for(let u=0,h=r.length;u<h;++u)e=this.moveToLineTo_(t,e,r[u],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Be(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=$p(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],s=e[3]-e[1],u=Math.sqrt(r*r+s*s),h=this.context_;h.beginPath(),h.arc(e[0],e[1],u,0,2*Math.PI),this.fillState_&&h.fill(),this.strokeState_&&h.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const r=e.getGeometryFunction()(t);r&&(this.setStyle(e),this.drawGeometry(r))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let r=0,s=e.length;r<s;++r)this.drawGeometry(e[r])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),this.text_!==""&&this.drawText_(e,0,e.length,r)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),this.text_!==""&&this.drawText_(e,0,e.length,r)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Be(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Be(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const r=this.context_,s=t.getFlatCoordinates();let u=0;const h=t.getEnds(),f=t.getStride();r.beginPath();for(let g=0,y=h.length;g<y;++g)u=this.moveToLineTo_(s,u,h[g],f,!1);r.stroke()}if(this.text_!==""){const r=t.getFlatMidpoints();this.drawText_(r,0,r.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Be(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Be(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,r=t.getOrientedFlatCoordinates();let s=0;const u=t.getEndss(),h=t.getStride();e.beginPath();for(let f=0,g=u.length;f<g;++f){const y=u[f];s=this.drawRings_(r,s,y,h)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=t.lineCap,e.lineCap=t.lineCap),Bi(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),r.lineJoin!=t.lineJoin&&(r.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,r=this.contextTextState_,s=t.textAlign?t.textAlign:Hr;r?(r.font!=t.font&&(r.font=t.font,e.font=t.font),r.textAlign!=s&&(r.textAlign=s,e.textAlign=s),r.textBaseline!=t.textBaseline&&(r.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const r=t.getColor();this.fillState_={fillStyle:tn(r||ce)}}if(!e)this.strokeState_=null;else{const r=e.getColor(),s=e.getLineCap(),u=e.getLineDash(),h=e.getLineDashOffset(),f=e.getLineJoin(),g=e.getWidth(),y=e.getMiterLimit(),p=u||mn;this.strokeState_={lineCap:s!==void 0?s:Vi,lineDash:this.pixelRatio_===1?p:p.map(m=>m*this.pixelRatio_),lineDashOffset:(h||vn)*this.pixelRatio_,lineJoin:f!==void 0?f:Zi,lineWidth:(g!==void 0?g:Jr)*this.pixelRatio_,miterLimit:y!==void 0?y:Vr,strokeStyle:tn(r||Zr)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const r=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),u=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*r,this.imageAnchorY_=s[1]*r,this.imageHeight_=e[1]*r,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=u[0],this.imageOriginY_=u[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const h=t.getScaleArray();this.imageScale_=[h[0]*this.pixelRatio_/r,h[1]*this.pixelRatio_/r],this.imageWidth_=e[0]*r}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const x=e.getColor();this.textFillState_={fillStyle:tn(x||ce)}}const r=t.getStroke();if(!r)this.textStrokeState_=null;else{const x=r.getColor(),I=r.getLineCap(),k=r.getLineDash(),C=r.getLineDashOffset(),R=r.getLineJoin(),b=r.getWidth(),O=r.getMiterLimit();this.textStrokeState_={lineCap:I!==void 0?I:Vi,lineDash:k||mn,lineDashOffset:C||vn,lineJoin:R!==void 0?R:Zi,lineWidth:b!==void 0?b:Jr,miterLimit:O!==void 0?O:Vr,strokeStyle:tn(x||Zr)}}const s=t.getFont(),u=t.getOffsetX(),h=t.getOffsetY(),f=t.getRotateWithView(),g=t.getRotation(),y=t.getScaleArray(),p=t.getText(),m=t.getTextAlign(),_=t.getTextBaseline();this.textState_={font:s!==void 0?s:ec,textAlign:m!==void 0?m:Hr,textBaseline:_!==void 0?_:Hs},this.text_=p!==void 0?Array.isArray(p)?p.reduce((x,I,k)=>x+=k%2?" ":I,""):p:"",this.textOffsetX_=u!==void 0?this.pixelRatio_*u:0,this.textOffsetY_=h!==void 0?this.pixelRatio_*h:0,this.textRotateWithView_=f!==void 0?f:!1,this.textRotation_=g!==void 0?g:0,this.textScale_=[this.pixelRatio_*y[0],this.pixelRatio_*y[1]]}}}const nn=.5;function r_(i,t,e,r,s,u,h,f,g){const y=s,p=i[0]*nn,m=i[1]*nn,_=pe(p,m);_.imageSmoothingEnabled=!1;const x=_.canvas,I=new i_(_,nn,s,null,h,f,null),k=e.length,C=Math.floor((256*256*256-1)/k),R={};for(let O=1;O<=k;++O){const A=e[O-1],L=A.getStyleFunction()||r;if(!L)continue;let D=L(A,u);if(!D)continue;Array.isArray(D)||(D=[D]);const G=(O*C).toString(16).padStart(7,"#00000");for(let B=0,tt=D.length;B<tt;++B){const J=D[B],H=J.getGeometryFunction()(A);if(!H||!Be(y,H.getExtent()))continue;const Q=J.clone(),X=Q.getFill();X&&X.setColor(G);const K=Q.getStroke();K&&(K.setColor(G),K.setLineDash(null)),Q.setText(void 0);const V=J.getImage();if(V){const Z=V.getImageSize();if(!Z)continue;const pt=pe(Z[0],Z[1],void 0,{alpha:!1}),vt=pt.canvas;pt.fillStyle=G,pt.fillRect(0,0,vt.width,vt.height),Q.setImage(new Kr({img:vt,anchor:V.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:V.getOrigin(),opacity:1,size:V.getSize(),scale:V.getScale(),rotation:V.getRotation(),rotateWithView:V.getRotateWithView()}))}const lt=Q.getZIndex()||0;let ft=R[lt];ft||(ft={},R[lt]=ft,ft.Polygon=[],ft.Circle=[],ft.LineString=[],ft.Point=[]);const St=H.getType();if(St==="GeometryCollection"){const Z=H.getGeometriesArrayRecursive();for(let pt=0,vt=Z.length;pt<vt;++pt){const Pt=Z[pt];ft[Pt.getType().replace("Multi","")].push(Pt,Q)}}else ft[St.replace("Multi","")].push(H,Q)}}const b=Object.keys(R).map(Number).sort(li);for(let O=0,A=b.length;O<A;++O){const L=R[b[O]];for(const D in L){const F=L[D];for(let G=0,B=F.length;G<B;G+=2){I.setStyle(F[G+1]);for(let tt=0,J=t.length;tt<J;++tt)I.setTransform(t[tt]),I.drawGeometry(F[G])}}}return _.getImageData(0,0,x.width,x.height)}function s_(i,t,e){const r=[];if(e){const s=Math.floor(Math.round(i[0])*nn),u=Math.floor(Math.round(i[1])*nn),h=(Kt(s,0,e.width-1)+Kt(u,0,e.height-1)*e.width)*4,f=e.data[h],g=e.data[h+1],p=e.data[h+2]+256*(g+256*f),m=Math.floor((256*256*256-1)/t.length);p&&p%m===0&&r.push(t[p/m-1])}return r}const o_=.5,bc={Point:d_,LineString:c_,Polygon:p_,MultiPoint:y_,MultiLineString:f_,MultiPolygon:g_,GeometryCollection:h_,Circle:u_};function a_(i,t){return parseInt(jt(i),10)-parseInt(jt(t),10)}function Tc(i,t){const e=Nc(i,t);return e*e}function Nc(i,t){return o_*i/t}function u_(i,t,e,r,s){const u=e.getFill(),h=e.getStroke();if(u||h){const g=i.getBuilder(e.getZIndex(),"Circle");g.setFillStrokeStyle(u,h),g.drawCircle(t,r,s)}const f=e.getText();if(f&&f.getText()){const g=i.getBuilder(e.getZIndex(),"Text");g.setTextStyle(f),g.drawText(t,r)}}function Mc(i,t,e,r,s,u,h,f){const g=[],y=e.getImage();if(y){let _=!0;const x=y.getImageState();x==yt.LOADED||x==yt.ERROR?_=!1:x==yt.IDLE&&y.load(),_&&g.push(y.ready())}const p=e.getFill();p&&p.loading()&&g.push(p.ready());const m=g.length>0;return m&&Promise.all(g).then(()=>s(null)),l_(i,t,e,r,u,h,f),m}function l_(i,t,e,r,s,u,h){const f=e.getGeometryFunction()(t);if(!f)return;const g=f.simplifyTransformed(r,s);if(e.getRenderer())Oc(i,g,e,t,h);else{const p=bc[g.getType()];p(i,g,e,t,h,u)}}function Oc(i,t,e,r,s){if(t.getType()=="GeometryCollection"){const h=t.getGeometries();for(let f=0,g=h.length;f<g;++f)Oc(i,h[f],e,r,s);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,r,e.getRenderer(),e.getHitDetectionRenderer(),s)}function h_(i,t,e,r,s,u){const h=t.getGeometriesArray();let f,g;for(f=0,g=h.length;f<g;++f){const y=bc[h[f].getType()];y(i,h[f],e,r,s,u)}}function c_(i,t,e,r,s){const u=e.getStroke();if(u){const f=i.getBuilder(e.getZIndex(),"LineString");f.setFillStrokeStyle(null,u),f.drawLineString(t,r,s)}const h=e.getText();if(h&&h.getText()){const f=i.getBuilder(e.getZIndex(),"Text");f.setTextStyle(h),f.drawText(t,r,s)}}function f_(i,t,e,r,s){const u=e.getStroke();if(u){const f=i.getBuilder(e.getZIndex(),"LineString");f.setFillStrokeStyle(null,u),f.drawMultiLineString(t,r,s)}const h=e.getText();if(h&&h.getText()){const f=i.getBuilder(e.getZIndex(),"Text");f.setTextStyle(h),f.drawText(t,r,s)}}function g_(i,t,e,r,s){const u=e.getFill(),h=e.getStroke();if(h||u){const g=i.getBuilder(e.getZIndex(),"Polygon");g.setFillStrokeStyle(u,h),g.drawMultiPolygon(t,r,s)}const f=e.getText();if(f&&f.getText()){const g=i.getBuilder(e.getZIndex(),"Text");g.setTextStyle(f),g.drawText(t,r,s)}}function d_(i,t,e,r,s,u){const h=e.getImage(),f=e.getText(),g=f&&f.getText(),y=u&&h&&g?{}:void 0;if(h){if(h.getImageState()!=yt.LOADED)return;const p=i.getBuilder(e.getZIndex(),"Image");p.setImageStyle(h,y),p.drawPoint(t,r,s)}if(g){const p=i.getBuilder(e.getZIndex(),"Text");p.setTextStyle(f,y),p.drawText(t,r,s)}}function y_(i,t,e,r,s,u){const h=e.getImage(),f=h&&h.getOpacity()!==0,g=e.getText(),y=g&&g.getText(),p=u&&f&&y?{}:void 0;if(f){if(h.getImageState()!=yt.LOADED)return;const m=i.getBuilder(e.getZIndex(),"Image");m.setImageStyle(h,p),m.drawMultiPoint(t,r,s)}if(y){const m=i.getBuilder(e.getZIndex(),"Text");m.setTextStyle(g,p),m.drawText(t,r,s)}}function p_(i,t,e,r,s){const u=e.getFill(),h=e.getStroke();if(u||h){const g=i.getBuilder(e.getZIndex(),"Polygon");g.setFillStrokeStyle(u,h),g.drawPolygon(t,r,s)}const f=e.getText();if(f&&f.getText()){const g=i.getBuilder(e.getZIndex(),"Text");g.setTextStyle(f),g.drawText(t,r,s)}}class m_ extends Hv{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=fi(),this.wrappedRenderedExtent_=fi(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,r){const s=e.extent,u=e.viewState,h=u.center,f=u.resolution,g=u.projection,y=u.rotation,p=g.getExtent(),m=this.getLayer().getSource(),_=this.getLayer().getDeclutter(),x=e.pixelRatio,I=e.viewHints,k=!(I[ke.ANIMATING]||I[ke.INTERACTING]),C=this.context,R=Math.round(he(s)/f*x),b=Math.round(pn(s)/f*x),O=m.getWrapX()&&g.canWrapX(),A=O?he(p):null,L=O?Math.ceil((s[2]-p[2])/A)+1:1;let D=O?Math.floor((s[0]-p[0])/A):0;do{const F=this.getRenderTransform(h,f,y,x,R,b,D*A);t.execute(C,[C.canvas.width,C.canvas.height],F,y,k,r===void 0?os:r?Rc:t_,r?_&&e.declutter[_]:void 0)}while(++D<L)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=pe(this.context.canvas.width,this.context.canvas.height,wc))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Fm(this.context),wc.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(t,e){const r=t.pixelRatio,s=t.layerStatesArray[t.layerIndex];this.opacity_=s.opacity;const u=t.extent,h=t.viewState.resolution,f=Math.round(he(u)/h*r),g=Math.round(pn(u)/h*r);hi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/r,1/r,0,-f/2,-g/2),tp(this.inversePixelTransform,this.pixelTransform);const y=np(this.pixelTransform);this.useContainer(e,y,this.getBackground(t));const p=this.context,m=p.canvas,_=this.replayGroup_;let x=_&&!_.isEmpty();if(!x&&!(this.getLayer().hasListener(Si.PRERENDER)||this.getLayer().hasListener(Si.POSTRENDER)))return null;m.width!=f||m.height!=g?(m.width=f,m.height=g,m.style.transform!==y&&(m.style.transform=y)):this.containerReused||p.clearRect(0,0,f,g),this.setDrawContext_(),this.preRender(p,t);const I=t.viewState;I.projection;let k=!1;if(x&&s.extent&&this.clipping){const C=Pr(s.extent);x=Be(C,t.extent),k=x&&!$i(C,t.extent),k&&this.clipUnrotated(p,t,C)}return x&&this.renderWorlds(_,t,this.getLayer().getDeclutter()?!1:void 0),k&&p.restore(),this.postRender(p,t),this.renderedRotation_!==I.rotation&&(this.renderedRotation_=I.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const r=[this.context.canvas.width,this.context.canvas.height];le(this.pixelTransform,r);const s=this.renderedCenter_,u=this.renderedResolution_,h=this.renderedRotation_,f=this.renderedProjection_,g=this.wrappedRenderedExtent_,y=this.getLayer(),p=[],m=r[0]*nn,_=r[1]*nn;p.push(this.getRenderTransform(s,u,h,nn,m,_,0).slice());const x=y.getSource(),I=f.getExtent();if(x.getWrapX()&&f.canWrapX()&&!$i(I,g)){let k=g[0];const C=he(I);let R=0,b;for(;k<I[0];)--R,b=C*R,p.push(this.getRenderTransform(s,u,h,nn,m,_,b).slice()),k+=C;for(R=0,k=g[2];k>I[2];)++R,b=C*R,p.push(this.getRenderTransform(s,u,h,nn,m,_,b).slice()),k-=C}this.hitDetectionImageData_=r_(r,p,this.renderedFeatures_,y.getStyleFunction(),g,u,h,Tc(u,this.renderedPixelRatio_))}e(s_(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,r,s,u){if(!this.replayGroup_)return;const h=e.viewState.resolution,f=e.viewState.rotation,g=this.getLayer(),y={},p=function(I,k,C){const R=jt(I),b=y[R];if(b){if(b!==!0&&C<b.distanceSq){if(C===0)return y[R]=!0,u.splice(u.lastIndexOf(b),1),s(I,g,k);b.geometry=k,b.distanceSq=C}}else{if(C===0)return y[R]=!0,s(I,g,k);u.push(y[R]={feature:I,layer:g,geometry:k,distanceSq:C,callback:s})}};let m;const _=[this.replayGroup_],x=this.getLayer().getDeclutter();return _.some(I=>m=I.forEachFeatureAtCoordinate(t,h,f,r,p,x&&e.declutter[x]?e.declutter[x].all().map(k=>k.value):null)),m}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),r=e.getSource();if(!r)return!1;const s=t.viewHints[ke.ANIMATING],u=t.viewHints[ke.INTERACTING],h=e.getUpdateWhileAnimating(),f=e.getUpdateWhileInteracting();if(this.ready&&!h&&s||!f&&u)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const g=t.extent,y=t.viewState,p=y.projection,m=y.resolution,_=t.pixelRatio,x=e.getRevision(),I=e.getRenderBuffer();let k=e.getRenderOrder();k===void 0&&(k=a_);const C=y.center.slice(),R=ya(g,I*m),b=R.slice(),O=[R.slice()],A=p.getExtent();if(r.getWrapX()&&p.canWrapX()&&!$i(A,t.extent)){const X=he(A),K=Math.max(he(R)/2,X);R[0]=A[0]-K,R[2]=A[2]+K,Tp(C,p);const V=ch(O[0],p);V[0]<A[0]&&V[2]<A[2]?O.push([V[0]+X,V[1],V[2]+X,V[3]]):V[0]>A[0]&&V[2]>A[2]&&O.push([V[0]-X,V[1],V[2]-X,V[3]])}if(this.ready&&this.renderedResolution_==m&&this.renderedRevision_==x&&this.renderedRenderOrder_==k&&$i(this.wrappedRenderedExtent_,R))return Bi(this.renderedExtent_,b)||(this.hitDetectionImageData_=null,this.renderedExtent_=b),this.renderedCenter_=C,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const L=new Uv(Nc(m,_),R,m,_);let D;for(let X=0,K=O.length;X<K;++X)r.loadFeatures(O[X],m,p);const F=Tc(m,_);let G=!0;const B=(X,K)=>{let V;const lt=X.getStyleFunction()||e.getStyleFunction();if(lt&&(V=lt(X,m)),V){const ft=this.renderFeature(X,F,V,L,D,this.getLayer().getDeclutter(),K);G=G&&!ft}},tt=Ih(R),J=r.getFeaturesInExtent(tt);k&&J.sort(k);for(let X=0,K=J.length;X<K;++X)B(J[X],X);this.renderedFeatures_=J,this.ready=G;const H=L.finish(),Q=new e_(R,m,_,r.getOverlaps(),H,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=m,this.renderedRevision_=x,this.renderedRenderOrder_=k,this.renderedExtent_=b,this.wrappedRenderedExtent_=R,this.renderedCenter_=C,this.renderedProjection_=p,this.renderedPixelRatio_=_,this.replayGroup_=Q,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,r,s,u,h,f){if(!r)return!1;let g=!1;if(Array.isArray(r))for(let y=0,p=r.length;y<p;++y)g=Mc(s,t,r[y],e,this.boundHandleStyleImageChange_,u,h,f)||g;else g=Mc(s,t,r,e,this.boundHandleStyleImageChange_,u,h,f);return g}}class v_ extends Gv{constructor(t){super(t)}createRenderer(){return new m_(this)}}const nr={ADD:"add",REMOVE:"remove"},Lc={LENGTH:"length"};class uo extends Ke{constructor(t,e,r){super(t),this.element=e,this.index=r}}class __ extends zi{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let r=0,s=this.array_.length;r<s;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,r=t.length;e<r;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let r=0,s=e.length;r<s;++r)t(e[r],r,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Lc.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new uo(nr.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let r=0,s=e.length;r<s;++r)if(e[r]===t)return this.removeAt(r)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new uo(nr.REMOVE,e,t)),e}setAt(t,e){const r=this.getLength();if(t>=r){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new uo(nr.REMOVE,s,t)),this.dispatchEvent(new uo(nr.ADD,e,t))}updateLength_(){this.set(Lc.LENGTH,this.array_.length)}assertUnique_(t,e){for(let r=0,s=this.array_.length;r<s;++r)if(this.array_[r]===t&&r!==e)throw new Error("Duplicate item added to a unique collection")}}class Ac{constructor(t){this.rbush_=new Wh(t),this.items_={}}insert(t,e){const r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(r),this.items_[jt(e)]=r}load(t,e){const r=new Array(e.length);for(let s=0,u=e.length;s<u;s++){const h=t[s],f=e[s],g={minX:h[0],minY:h[1],maxX:h[2],maxY:h[3],value:f};r[s]=g,this.items_[jt(f)]=g}this.rbush_.load(r)}remove(t){const e=jt(t),r=this.items_[e];return delete this.items_[e],this.rbush_.remove(r)!==null}update(t,e){const r=this.items_[jt(e)],s=[r.minX,r.minY,r.maxX,r.maxY];sh(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let r;for(let s=0,u=t.length;s<u;s++)if(r=e(t[s]),r)return r;return r}isEmpty(){return Yi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return gi(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Pc=yn();class Ce{constructor(t,e,r,s,u,h){this.styleFunction,this.extent_,this.id_=h,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r||null,this.properties_=u,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?rh(this.flatCoordinates_):_a(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=di(this.getExtent());this.flatInteriorPoints_=Da(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=rm(this.flatCoordinates_,this.ends_),e=Bh(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Ph(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=qs(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const r=this.ends_;for(let s=0,u=r.length;s<u;++s){const h=r[s],f=qs(t,e,h,2,.5);Qe(this.flatMidpoints_,f),e=h}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=mi(t);const e=t.getExtent(),r=t.getWorldExtent();if(e&&r){const s=pn(r)/pn(e);hi(Pc,r[0],r[3],s,-s,0,0,0),An(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Pc,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Ce(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Ql((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const r=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":r.length=Xs(r,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,r,0),s=[r.length];break;case"MultiLineString":s=[],r.length=Th(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,r,0,s);break;case"Polygon":s=[],r.length=Ma(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),r,0,s);break}return s&&(this.simplifiedGeometry_=new Ce(this.type_,r,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Ce.prototype.getFlatCoordinates=Ce.prototype.getOrientedFlatCoordinates;class x_ extends zi{constructor(t){super(),this.projection=mi(t.projection),this.attributions_=Dc(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(r,s){e.viewResolver=r,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Dc(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Dc(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}const Re={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function E_(i,t){return[[-1/0,-1/0,1/0,1/0]]}let S_=!1;function I_(i,t,e,r,s,u,h){const f=new XMLHttpRequest;f.open("GET",typeof i=="function"?i(e,r,s):i,!0),t.getType()=="arraybuffer"&&(f.responseType="arraybuffer"),f.withCredentials=S_,f.onload=function(g){if(!f.status||f.status>=200&&f.status<300){const y=t.getType();let p;y=="json"?p=JSON.parse(f.responseText):y=="text"?p=f.responseText:y=="xml"?(p=f.responseXML,p||(p=new DOMParser().parseFromString(f.responseText,"application/xml"))):y=="arraybuffer"&&(p=f.response),p?u(t.readFeatures(p,{extent:e,featureProjection:s}),t.readProjection(p)):h()}else h()},f.onerror=h,f.send()}function Fc(i,t){return function(e,r,s,u,h){const f=this;I_(i,t,e,r,s,function(g,y){f.addFeatures(g),u!==void 0&&u(g)},h||Or)}}class jn extends Ke{constructor(t,e,r){super(t),this.feature=e,this.features=r}}class w_ extends x_{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Or,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Jt(this.format_,"`format` must be set when `url` is set"),this.loader_=Fc(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:E_;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Ac:null,this.loadedExtentsRtree_=new Ac,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let r,s;Array.isArray(t.features)?s=t.features:t.features&&(r=t.features,s=r.getArray()),!e&&r===void 0&&(r=new __(s)),s!==void 0&&this.addFeaturesInternal(s),r!==void 0&&this.bindFeaturesCollection_(r)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=jt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const r=t.getGeometry();if(r){const s=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new jn(Re.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Ce||(this.featureChangeKeys_[t]=[dn(e,Ge.CHANGE,this.handleFeatureChange_,this),dn(e,Jl.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let r=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof Ce){const u=this.idIndex_[s];u instanceof Ce?Array.isArray(u)?u.push(e):this.idIndex_[s]=[u,e]:r=!1}else r=!1}return r&&(Jt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),r}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],r=[],s=[];for(let u=0,h=t.length;u<h;u++){const f=t[u],g=jt(f);this.addToIndex_(g,f)&&r.push(f)}for(let u=0,h=r.length;u<h;u++){const f=r[u],g=jt(f);this.setupChangeEvents_(g,f);const y=f.getGeometry();if(y){const p=y.getExtent();e.push(p),s.push(f)}else this.nullGeometryFeatures_[g]=f}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(Re.ADDFEATURE))for(let u=0,h=r.length;u<h;u++)this.dispatchEvent(new jn(Re.ADDFEATURE,r[u]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Re.ADDFEATURE,function(r){e||(e=!0,t.push(r.feature),e=!1)}),this.addEventListener(Re.REMOVEFEATURE,function(r){e||(e=!0,t.remove(r.feature),e=!1)}),t.addEventListener(nr.ADD,r=>{e||(e=!0,this.addFeature(r.element),e=!1)}),t.addEventListener(nr.REMOVE,r=>{e||(e=!0,this.removeFeature(r.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const r in this.featureChangeKeys_)this.featureChangeKeys_[r].forEach(On);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const r=s=>{this.removeFeatureInternal(s)};this.featuresRtree_.forEach(r);for(const s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new jn(Re.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const r=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(r,function(s){const u=s.getGeometry();if(u instanceof Ce||u.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(r){const s=r.getGeometry();if(s instanceof Ce||s.intersectsExtent(t)){const u=e(r);if(u)return u}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Yi(this.nullGeometryFeatures_)||Qe(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(r){e.push(r)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=dp(t,e);return[].concat(...s.map(u=>this.featuresRtree_.getInExtent(u)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const r=t[0],s=t[1];let u=null;const h=[NaN,NaN];let f=1/0;const g=[-1/0,-1/0,1/0,1/0];return e=e||Hy,this.featuresRtree_.forEachInExtent(g,function(y){if(e(y)){const p=y.getGeometry(),m=f;if(f=p instanceof Ce?0:p.closestPointXY(r,s,h,f),f<m){u=y;const _=Math.sqrt(f);g[0]=r-_,g[1]=s-_,g[2]=r+_,g[3]=s+_}}}),u}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,r=jt(e),s=e.getGeometry();if(!s)r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[r]=e);else{const h=s.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(h,e)):this.featuresRtree_&&this.featuresRtree_.update(h,e)}const u=e.getId();if(u!==void 0){const h=u.toString();this.idIndex_[h]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[h]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[r]=e;this.changed(),this.dispatchEvent(new jn(Re.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:jt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Yi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,r){const s=this.loadedExtentsRtree_,u=this.strategy_(t,e,r);for(let h=0,f=u.length;h<f;++h){const g=u[h];s.forEachInExtent(g,function(p){return $i(p.extent,g)})||(++this.loadingExtentsCount_,this.dispatchEvent(new jn(Re.FEATURESLOADSTART)),this.loader_.call(this,g,e,r,p=>{--this.loadingExtentsCount_,this.dispatchEvent(new jn(Re.FEATURESLOADEND,void 0,p))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new jn(Re.FEATURESLOADERROR))}),s.insert(g,{extent:g.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let r;e.forEachInExtent(t,function(s){if(sh(s.extent,t))return r=s,!0}),r&&e.remove(r)}removeFeatures(t){const e=[];for(let r=0,s=t.length;r<s;++r){const u=t[r],h=this.removeFeatureInternal(u);h&&e.push(h)}e.length>0&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=jt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const r=this.featureChangeKeys_[e];if(!r)return;r.forEach(On),delete this.featureChangeKeys_[e];const s=t.getId();return s!==void 0&&delete this.idIndex_[s.toString()],delete this.uidIndex_[e],this.hasListener(Re.REMOVEFEATURE)&&this.dispatchEvent(new jn(Re.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const r in this.idIndex_){const s=this.idIndex_[r];if(t instanceof Ce&&Array.isArray(s)&&s.includes(t))s.splice(s.indexOf(t),1);else if(this.idIndex_[r]===t){delete this.idIndex_[r],e=!0;break}}return e}setLoader(t){this.loader_=t}setUrl(t){Jt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Fc(t,this.format_))}}var lo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function k_(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var s=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return i[r]}})}),e}var Bc=Object.prototype.toString,Yc=function(t){var e=Bc.call(t),r=e==="[object Arguments]";return r||(r=e!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Bc.call(t.callee)==="[object Function]"),r},uu,zc;function C_(){if(zc)return uu;zc=1;var i;if(!Object.keys){var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,r=Yc,s=Object.prototype.propertyIsEnumerable,u=!s.call({toString:null},"toString"),h=s.call(function(){},"prototype"),f=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],g=function(_){var x=_.constructor;return x&&x.prototype===_},y={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if(typeof window>"u")return!1;for(var _ in window)try{if(!y["$"+_]&&t.call(window,_)&&window[_]!==null&&typeof window[_]=="object")try{g(window[_])}catch{return!0}}catch{return!0}return!1}(),m=function(_){if(typeof window>"u"||!p)return g(_);try{return g(_)}catch{return!1}};i=function(x){var I=x!==null&&typeof x=="object",k=e.call(x)==="[object Function]",C=r(x),R=I&&e.call(x)==="[object String]",b=[];if(!I&&!k&&!C)throw new TypeError("Object.keys called on a non-object");var O=h&&k;if(R&&x.length>0&&!t.call(x,0))for(var A=0;A<x.length;++A)b.push(String(A));if(C&&x.length>0)for(var L=0;L<x.length;++L)b.push(String(L));else for(var D in x)!(O&&D==="prototype")&&t.call(x,D)&&b.push(String(D));if(u)for(var F=m(x),G=0;G<f.length;++G)!(F&&f[G]==="constructor")&&t.call(x,f[G])&&b.push(f[G]);return b}}return uu=i,uu}var R_=Array.prototype.slice,b_=Yc,$c=Object.keys,ho=$c?function(t){return $c(t)}:C_(),Xc=Object.keys;ho.shim=function(){if(Object.keys){var t=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);t||(Object.keys=function(r){return b_(r)?Xc(R_.call(r)):Xc(r)})}else Object.keys=ho;return Object.keys||ho};var lu=ho,T_=Error,N_=EvalError,M_=RangeError,O_=ReferenceError,qc=SyntaxError,Vn=TypeError,L_=URIError,co=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var s=42;t[e]=s;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var u=Object.getOwnPropertySymbols(t);if(u.length!==1||u[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var h=Object.getOwnPropertyDescriptor(t,e);if(h.value!==s||h.enumerable!==!0)return!1}return!0},Wc=typeof Symbol<"u"&&Symbol,A_=co,hu=function(){return typeof Wc!="function"||typeof Symbol!="function"||typeof Wc("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:A_()},cu={__proto__:null,foo:{}},P_=Object,D_=function(){return{__proto__:cu}.foo===cu.foo&&!(cu instanceof P_)},F_="Function.prototype.bind called on incompatible ",G_=Object.prototype.toString,B_=Math.max,Y_="[object Function]",Uc=function(t,e){for(var r=[],s=0;s<t.length;s+=1)r[s]=t[s];for(var u=0;u<e.length;u+=1)r[u+t.length]=e[u];return r},z_=function(t,e){for(var r=[],s=e,u=0;s<t.length;s+=1,u+=1)r[u]=t[s];return r},$_=function(i,t){for(var e="",r=0;r<i.length;r+=1)e+=i[r],r+1<i.length&&(e+=t);return e},X_=function(t){var e=this;if(typeof e!="function"||G_.apply(e)!==Y_)throw new TypeError(F_+e);for(var r=z_(arguments,1),s,u=function(){if(this instanceof s){var p=e.apply(this,Uc(r,arguments));return Object(p)===p?p:this}return e.apply(t,Uc(r,arguments))},h=B_(0,e.length-r.length),f=[],g=0;g<h;g++)f[g]="$"+g;if(s=Function("binder","return function ("+$_(f,",")+"){ return binder.apply(this,arguments); }")(u),e.prototype){var y=function(){};y.prototype=e.prototype,s.prototype=new y,y.prototype=null}return s},q_=X_,fu=Function.prototype.bind||q_,W_=Function.prototype.call,U_=Object.prototype.hasOwnProperty,j_=fu,jc=j_.call(W_,U_),mt,V_=T_,Z_=N_,H_=M_,J_=O_,ir=qc,rr=Vn,K_=L_,Vc=Function,gu=function(i){try{return Vc('"use strict"; return ('+i+").constructor;")()}catch{}},Ci=Object.getOwnPropertyDescriptor;if(Ci)try{Ci({},"")}catch{Ci=null}var du=function(){throw new rr},Q_=Ci?function(){try{return arguments.callee,du}catch{try{return Ci(arguments,"callee").get}catch{return du}}}():du,sr=hu(),t0=D_(),qt=Object.getPrototypeOf||(t0?function(i){return i.__proto__}:null),or={},e0=typeof Uint8Array>"u"||!qt?mt:qt(Uint8Array),Ri={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?mt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?mt:ArrayBuffer,"%ArrayIteratorPrototype%":sr&&qt?qt([][Symbol.iterator]()):mt,"%AsyncFromSyncIteratorPrototype%":mt,"%AsyncFunction%":or,"%AsyncGenerator%":or,"%AsyncGeneratorFunction%":or,"%AsyncIteratorPrototype%":or,"%Atomics%":typeof Atomics>"u"?mt:Atomics,"%BigInt%":typeof BigInt>"u"?mt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?mt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?mt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?mt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":V_,"%eval%":eval,"%EvalError%":Z_,"%Float32Array%":typeof Float32Array>"u"?mt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?mt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?mt:FinalizationRegistry,"%Function%":Vc,"%GeneratorFunction%":or,"%Int8Array%":typeof Int8Array>"u"?mt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?mt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?mt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":sr&&qt?qt(qt([][Symbol.iterator]())):mt,"%JSON%":typeof JSON=="object"?JSON:mt,"%Map%":typeof Map>"u"?mt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!sr||!qt?mt:qt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?mt:Promise,"%Proxy%":typeof Proxy>"u"?mt:Proxy,"%RangeError%":H_,"%ReferenceError%":J_,"%Reflect%":typeof Reflect>"u"?mt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?mt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!sr||!qt?mt:qt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?mt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":sr&&qt?qt(""[Symbol.iterator]()):mt,"%Symbol%":sr?Symbol:mt,"%SyntaxError%":ir,"%ThrowTypeError%":Q_,"%TypedArray%":e0,"%TypeError%":rr,"%Uint8Array%":typeof Uint8Array>"u"?mt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?mt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?mt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?mt:Uint32Array,"%URIError%":K_,"%WeakMap%":typeof WeakMap>"u"?mt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?mt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?mt:WeakSet};if(qt)try{null.error}catch(i){var n0=qt(qt(i));Ri["%Error.prototype%"]=n0}var i0=function i(t){var e;if(t==="%AsyncFunction%")e=gu("async function () {}");else if(t==="%GeneratorFunction%")e=gu("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=gu("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var s=i("%AsyncGenerator%");s&&qt&&(e=qt(s.prototype))}return Ri[t]=e,e},Zc={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},as=fu,fo=jc,r0=as.call(Function.call,Array.prototype.concat),s0=as.call(Function.apply,Array.prototype.splice),Hc=as.call(Function.call,String.prototype.replace),go=as.call(Function.call,String.prototype.slice),o0=as.call(Function.call,RegExp.prototype.exec),a0=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,u0=/\\(\\)?/g,l0=function(t){var e=go(t,0,1),r=go(t,-1);if(e==="%"&&r!=="%")throw new ir("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new ir("invalid intrinsic syntax, expected opening `%`");var s=[];return Hc(t,a0,function(u,h,f,g){s[s.length]=f?Hc(g,u0,"$1"):h||u}),s},h0=function(t,e){var r=t,s;if(fo(Zc,r)&&(s=Zc[r],r="%"+s[0]+"%"),fo(Ri,r)){var u=Ri[r];if(u===or&&(u=i0(r)),typeof u>"u"&&!e)throw new rr("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:s,name:r,value:u}}throw new ir("intrinsic "+t+" does not exist!")},rn=function(t,e){if(typeof t!="string"||t.length===0)throw new rr("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new rr('"allowMissing" argument must be a boolean');if(o0(/^%?[^%]*%?$/,t)===null)throw new ir("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=l0(t),s=r.length>0?r[0]:"",u=h0("%"+s+"%",e),h=u.name,f=u.value,g=!1,y=u.alias;y&&(s=y[0],s0(r,r0([0,1],y)));for(var p=1,m=!0;p<r.length;p+=1){var _=r[p],x=go(_,0,1),I=go(_,-1);if((x==='"'||x==="'"||x==="`"||I==='"'||I==="'"||I==="`")&&x!==I)throw new ir("property names with quotes must have matching quotes");if((_==="constructor"||!m)&&(g=!0),s+="."+_,h="%"+s+"%",fo(Ri,h))f=Ri[h];else if(f!=null){if(!(_ in f)){if(!e)throw new rr("base intrinsic for "+t+" exists, but the property is not available.");return}if(Ci&&p+1>=r.length){var k=Ci(f,_);m=!!k,m&&"get"in k&&!("originalValue"in k.get)?f=k.get:f=f[_]}else m=fo(f,_),f=f[_];m&&!g&&(Ri[h]=f)}}return f},c0=rn,yo=c0("%Object.defineProperty%",!0)||!1;if(yo)try{yo({},"a",{value:1})}catch{yo=!1}var yu=yo,f0=rn,po=f0("%Object.getOwnPropertyDescriptor%",!0);if(po)try{po([],"length")}catch{po=null}var pu=po,Jc=yu,g0=qc,ar=Vn,Kc=pu,mu=function(t,e,r){if(!t||typeof t!="object"&&typeof t!="function")throw new ar("`obj` must be an object or a function`");if(typeof e!="string"&&typeof e!="symbol")throw new ar("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new ar("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new ar("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new ar("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new ar("`loose`, if provided, must be a boolean");var s=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,h=arguments.length>5?arguments[5]:null,f=arguments.length>6?arguments[6]:!1,g=!!Kc&&Kc(t,e);if(Jc)Jc(t,e,{configurable:h===null&&g?g.configurable:!h,enumerable:s===null&&g?g.enumerable:!s,value:r,writable:u===null&&g?g.writable:!u});else if(f||!s&&!u&&!h)t[e]=r;else throw new g0("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},vu=yu,Qc=function(){return!!vu};Qc.hasArrayLengthDefineBug=function(){if(!vu)return null;try{return vu([],"length",{value:1}).length!==1}catch{return!0}};var _u=Qc,d0=lu,y0=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",p0=Object.prototype.toString,m0=Array.prototype.concat,tf=mu,v0=function(i){return typeof i=="function"&&p0.call(i)==="[object Function]"},ef=_u(),_0=function(i,t,e,r){if(t in i){if(r===!0){if(i[t]===e)return}else if(!v0(r)||!r())return}ef?tf(i,t,e,!0):tf(i,t,e)},nf=function(i,t){var e=arguments.length>2?arguments[2]:{},r=d0(t);y0&&(r=m0.call(r,Object.getOwnPropertySymbols(t)));for(var s=0;s<r.length;s+=1)_0(i,r[s],t[r[s]],e[r[s]])};nf.supportsDescriptors=!!ef;var bi=nf,rf={exports:{}},x0=rn,sf=mu,E0=_u(),of=pu,af=Vn,S0=x0("%Math.floor%"),I0=function(t,e){if(typeof t!="function")throw new af("`fn` is not a function");if(typeof e!="number"||e<0||e>4294967295||S0(e)!==e)throw new af("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],s=!0,u=!0;if("length"in t&&of){var h=of(t,"length");h&&!h.configurable&&(s=!1),h&&!h.writable&&(u=!1)}return(s||u||!r)&&(E0?sf(t,"length",e,!0,!0):sf(t,"length",e)),t};(function(i){var t=fu,e=rn,r=I0,s=Vn,u=e("%Function.prototype.apply%"),h=e("%Function.prototype.call%"),f=e("%Reflect.apply%",!0)||t.call(h,u),g=yu,y=e("%Math.max%");i.exports=function(_){if(typeof _!="function")throw new s("a function is required");var x=f(t,h,arguments);return r(x,1+y(0,_.length-(arguments.length-1)),!0)};var p=function(){return f(t,u,arguments)};g?g(i.exports,"apply",{value:p}):i.exports.apply=p})(rf);var ur=rf.exports,uf=rn,lf=ur,w0=lf(uf("String.prototype.indexOf")),be=function(t,e){var r=uf(t,!!e);return typeof r=="function"&&w0(t,".prototype.")>-1?lf(r):r},k0=lu,hf=co(),cf=be,ff=Object,C0=cf("Array.prototype.push"),gf=cf("Object.prototype.propertyIsEnumerable"),R0=hf?Object.getOwnPropertySymbols:null,df=function(t,e){if(t==null)throw new TypeError("target must be an object");var r=ff(t);if(arguments.length===1)return r;for(var s=1;s<arguments.length;++s){var u=ff(arguments[s]),h=k0(u),f=hf&&(Object.getOwnPropertySymbols||R0);if(f)for(var g=f(u),y=0;y<g.length;++y){var p=g[y];gf(u,p)&&C0(h,p)}for(var m=0;m<h.length;++m){var _=h[m];if(gf(u,_)){var x=u[_];r[_]=x}}}return r},xu=df,b0=function(){if(!Object.assign)return!1;for(var i="abcdefghijklmnopqrst",t=i.split(""),e={},r=0;r<t.length;++r)e[t[r]]=t[r];var s=Object.assign({},e),u="";for(var h in s)u+=h;return i!==u},T0=function(){if(!Object.assign||!Object.preventExtensions)return!1;var i=Object.preventExtensions({1:2});try{Object.assign(i,"xy")}catch{return i[1]==="y"}return!1},yf=function(){return!Object.assign||b0()||T0()?xu:Object.assign},N0=bi,M0=yf,O0=function(){var t=M0();return N0(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t},L0=bi,A0=ur,P0=df,pf=yf,D0=O0,F0=A0.apply(pf()),mf=function(t,e){return F0(Object,arguments)};L0(mf,{getPolyfill:pf,implementation:P0,shim:D0});var G0=mf,us=function(){return typeof(function(){}).name=="string"},ls=Object.getOwnPropertyDescriptor;if(ls)try{ls([],"length")}catch{ls=null}us.functionsHaveConfigurableNames=function(){if(!us()||!ls)return!1;var t=ls(function(){},"name");return!!t&&!!t.configurable};var B0=Function.prototype.bind;us.boundFunctionsHaveNames=function(){return us()&&typeof B0=="function"&&(function(){}).bind().name!==""};var Y0=us,vf=mu,z0=_u(),$0=Y0.functionsHaveConfigurableNames(),X0=Vn,q0=function(t,e){if(typeof t!="function")throw new X0("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||$0)&&(z0?vf(t,"name",e,!0,!0):vf(t,"name",e)),t},W0=q0,U0=Vn,j0=Object,_f=W0(function(){if(this==null||this!==j0(this))throw new U0("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t},"get flags",!0),V0=_f,Z0=bi.supportsDescriptors,H0=Object.getOwnPropertyDescriptor,xf=function(){if(Z0&&/a/mig.flags==="gim"){var t=H0(RegExp.prototype,"flags");if(t&&typeof t.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var e="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){e+="d"}}),Object.defineProperty(r,"sticky",{get:function(){e+="y"}}),e==="dy")return t.get}}return V0},J0=bi.supportsDescriptors,K0=xf,Q0=Object.getOwnPropertyDescriptor,t1=Object.defineProperty,e1=TypeError,Ef=Object.getPrototypeOf,n1=/a/,i1=function(){if(!J0||!Ef)throw new e1("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=K0(),e=Ef(n1),r=Q0(e,"flags");return(!r||r.get!==t)&&t1(e,"flags",{configurable:!0,enumerable:!1,get:t}),t},r1=bi,s1=ur,o1=_f,Sf=xf,a1=i1,If=s1(Sf());r1(If,{getPolyfill:Sf,implementation:o1,shim:a1});var u1=If,mo={exports:{}},l1=co,Ti=function(){return l1()&&!!Symbol.toStringTag},h1=Ti(),c1=be,Eu=c1("Object.prototype.toString"),vo=function(t){return h1&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:Eu(t)==="[object Arguments]"},wf=function(t){return vo(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Eu(t)!=="[object Array]"&&Eu(t.callee)==="[object Function]"},f1=function(){return vo(arguments)}();vo.isLegacyArguments=wf;var kf=f1?vo:wf;const g1=k_(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Su=typeof Map=="function"&&Map.prototype,Iu=Object.getOwnPropertyDescriptor&&Su?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,_o=Su&&Iu&&typeof Iu.get=="function"?Iu.get:null,Cf=Su&&Map.prototype.forEach,wu=typeof Set=="function"&&Set.prototype,ku=Object.getOwnPropertyDescriptor&&wu?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,xo=wu&&ku&&typeof ku.get=="function"?ku.get:null,Rf=wu&&Set.prototype.forEach,d1=typeof WeakMap=="function"&&WeakMap.prototype,hs=d1?WeakMap.prototype.has:null,y1=typeof WeakSet=="function"&&WeakSet.prototype,cs=y1?WeakSet.prototype.has:null,p1=typeof WeakRef=="function"&&WeakRef.prototype,bf=p1?WeakRef.prototype.deref:null,m1=Boolean.prototype.valueOf,v1=Object.prototype.toString,_1=Function.prototype.toString,x1=String.prototype.match,Cu=String.prototype.slice,Zn=String.prototype.replace,E1=String.prototype.toUpperCase,Tf=String.prototype.toLowerCase,Nf=RegExp.prototype.test,Mf=Array.prototype.concat,sn=Array.prototype.join,S1=Array.prototype.slice,Of=Math.floor,Ru=typeof BigInt=="function"?BigInt.prototype.valueOf:null,bu=Object.getOwnPropertySymbols,Tu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,lr=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ee=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===lr||!0)?Symbol.toStringTag:null,Lf=Object.prototype.propertyIsEnumerable,Af=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function Pf(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||Nf.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-Of(-i):Of(i);if(r!==i){var s=String(r),u=Cu.call(t,s.length+1);return Zn.call(s,e,"$&_")+"."+Zn.call(Zn.call(u,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Zn.call(t,e,"$&_")}var Nu=g1,Df=Nu.custom,Ff=Yf(Df)?Df:null,I1=function i(t,e,r,s){var u=e||{};if(Hn(u,"quoteStyle")&&u.quoteStyle!=="single"&&u.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Hn(u,"maxStringLength")&&(typeof u.maxStringLength=="number"?u.maxStringLength<0&&u.maxStringLength!==1/0:u.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var h=Hn(u,"customInspect")?u.customInspect:!0;if(typeof h!="boolean"&&h!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Hn(u,"indent")&&u.indent!==null&&u.indent!=="	"&&!(parseInt(u.indent,10)===u.indent&&u.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Hn(u,"numericSeparator")&&typeof u.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var f=u.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return $f(t,u);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var g=String(t);return f?Pf(t,g):g}if(typeof t=="bigint"){var y=String(t)+"n";return f?Pf(t,y):y}var p=typeof u.depth>"u"?5:u.depth;if(typeof r>"u"&&(r=0),r>=p&&p>0&&typeof t=="object")return Mu(t)?"[Array]":"[Object]";var m=z1(u,r);if(typeof s>"u")s=[];else if(zf(s,t)>=0)return"[Circular]";function _(Q,X,K){if(X&&(s=S1.call(s),s.push(X)),K){var V={depth:u.depth};return Hn(u,"quoteStyle")&&(V.quoteStyle=u.quoteStyle),i(Q,V,r+1,s)}return i(Q,u,r+1,s)}if(typeof t=="function"&&!Bf(t)){var x=O1(t),I=Eo(t,_);return"[Function"+(x?": "+x:" (anonymous)")+"]"+(I.length>0?" { "+sn.call(I,", ")+" }":"")}if(Yf(t)){var k=lr?Zn.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Tu.call(t);return typeof t=="object"&&!lr?fs(k):k}if(G1(t)){for(var C="<"+Tf.call(String(t.nodeName)),R=t.attributes||[],b=0;b<R.length;b++)C+=" "+R[b].name+"="+Gf(w1(R[b].value),"double",u);return C+=">",t.childNodes&&t.childNodes.length&&(C+="..."),C+="</"+Tf.call(String(t.nodeName))+">",C}if(Mu(t)){if(t.length===0)return"[]";var O=Eo(t,_);return m&&!Y1(O)?"["+Lu(O,m)+"]":"[ "+sn.call(O,", ")+" ]"}if(C1(t)){var A=Eo(t,_);return!("cause"in Error.prototype)&&"cause"in t&&!Lf.call(t,"cause")?"{ ["+String(t)+"] "+sn.call(Mf.call("[cause]: "+_(t.cause),A),", ")+" }":A.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+sn.call(A,", ")+" }"}if(typeof t=="object"&&h){if(Ff&&typeof t[Ff]=="function"&&Nu)return Nu(t,{depth:p-r});if(h!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(L1(t)){var L=[];return Cf&&Cf.call(t,function(Q,X){L.push(_(X,t,!0)+" => "+_(Q,t))}),Xf("Map",_o.call(t),L,m)}if(D1(t)){var D=[];return Rf&&Rf.call(t,function(Q){D.push(_(Q,t))}),Xf("Set",xo.call(t),D,m)}if(A1(t))return Ou("WeakMap");if(F1(t))return Ou("WeakSet");if(P1(t))return Ou("WeakRef");if(b1(t))return fs(_(Number(t)));if(N1(t))return fs(_(Ru.call(t)));if(T1(t))return fs(m1.call(t));if(R1(t))return fs(_(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===lo)return"{ [object globalThis] }";if(!k1(t)&&!Bf(t)){var F=Eo(t,_),G=Af?Af(t)===Object.prototype:t instanceof Object||t.constructor===Object,B=t instanceof Object?"":"null prototype",tt=!G&&ee&&Object(t)===t&&ee in t?Cu.call(Jn(t),8,-1):B?"Object":"",J=G||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",H=J+(tt||B?"["+sn.call(Mf.call([],tt||[],B||[]),": ")+"] ":"");return F.length===0?H+"{}":m?H+"{"+Lu(F,m)+"}":H+"{ "+sn.call(F,", ")+" }"}return String(t)};function Gf(i,t,e){var r=(e.quoteStyle||t)==="double"?'"':"'";return r+i+r}function w1(i){return Zn.call(String(i),/"/g,"&quot;")}function Mu(i){return Jn(i)==="[object Array]"&&(!ee||!(typeof i=="object"&&ee in i))}function k1(i){return Jn(i)==="[object Date]"&&(!ee||!(typeof i=="object"&&ee in i))}function Bf(i){return Jn(i)==="[object RegExp]"&&(!ee||!(typeof i=="object"&&ee in i))}function C1(i){return Jn(i)==="[object Error]"&&(!ee||!(typeof i=="object"&&ee in i))}function R1(i){return Jn(i)==="[object String]"&&(!ee||!(typeof i=="object"&&ee in i))}function b1(i){return Jn(i)==="[object Number]"&&(!ee||!(typeof i=="object"&&ee in i))}function T1(i){return Jn(i)==="[object Boolean]"&&(!ee||!(typeof i=="object"&&ee in i))}function Yf(i){if(lr)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!Tu)return!1;try{return Tu.call(i),!0}catch{}return!1}function N1(i){if(!i||typeof i!="object"||!Ru)return!1;try{return Ru.call(i),!0}catch{}return!1}var M1=Object.prototype.hasOwnProperty||function(i){return i in this};function Hn(i,t){return M1.call(i,t)}function Jn(i){return v1.call(i)}function O1(i){if(i.name)return i.name;var t=x1.call(_1.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function zf(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function L1(i){if(!_o||!i||typeof i!="object")return!1;try{_o.call(i);try{xo.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function A1(i){if(!hs||!i||typeof i!="object")return!1;try{hs.call(i,hs);try{cs.call(i,cs)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function P1(i){if(!bf||!i||typeof i!="object")return!1;try{return bf.call(i),!0}catch{}return!1}function D1(i){if(!xo||!i||typeof i!="object")return!1;try{xo.call(i);try{_o.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function F1(i){if(!cs||!i||typeof i!="object")return!1;try{cs.call(i,cs);try{hs.call(i,hs)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function G1(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function $f(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return $f(Cu.call(i,0,t.maxStringLength),t)+r}var s=Zn.call(Zn.call(i,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,B1);return Gf(s,"single",t)}function B1(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+E1.call(t.toString(16))}function fs(i){return"Object("+i+")"}function Ou(i){return i+" { ? }"}function Xf(i,t,e,r){var s=r?Lu(e,r):sn.call(e,", ");return i+" ("+t+") {"+s+"}"}function Y1(i){for(var t=0;t<i.length;t++)if(zf(i[t],`
`)>=0)return!1;return!0}function z1(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=sn.call(Array(i.indent+1)," ");else return null;return{base:e,prev:sn.call(Array(t+1),e)}}function Lu(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+sn.call(i,","+e)+`
`+t.prev}function Eo(i,t){var e=Mu(i),r=[];if(e){r.length=i.length;for(var s=0;s<i.length;s++)r[s]=Hn(i,s)?t(i[s],i):""}var u=typeof bu=="function"?bu(i):[],h;if(lr){h={};for(var f=0;f<u.length;f++)h["$"+u[f]]=u[f]}for(var g in i)Hn(i,g)&&(e&&String(Number(g))===g&&g<i.length||lr&&h["$"+g]instanceof Symbol||(Nf.call(/[^\w$]/,g)?r.push(t(g,i)+": "+t(i[g],i)):r.push(g+": "+t(i[g],i))));if(typeof bu=="function")for(var y=0;y<u.length;y++)Lf.call(i,u[y])&&r.push("["+t(u[y])+"]: "+t(i[u[y]],i));return r}var qf=rn,hr=be,$1=I1,X1=Vn,So=qf("%WeakMap%",!0),Io=qf("%Map%",!0),q1=hr("WeakMap.prototype.get",!0),W1=hr("WeakMap.prototype.set",!0),U1=hr("WeakMap.prototype.has",!0),j1=hr("Map.prototype.get",!0),V1=hr("Map.prototype.set",!0),Z1=hr("Map.prototype.has",!0),Au=function(i,t){for(var e=i,r;(r=e.next)!==null;e=r)if(r.key===t)return e.next=r.next,r.next=i.next,i.next=r,r},H1=function(i,t){var e=Au(i,t);return e&&e.value},J1=function(i,t,e){var r=Au(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},K1=function(i,t){return!!Au(i,t)},Wf=function(){var t,e,r,s={assert:function(u){if(!s.has(u))throw new X1("Side channel does not contain "+$1(u))},get:function(u){if(So&&u&&(typeof u=="object"||typeof u=="function")){if(t)return q1(t,u)}else if(Io){if(e)return j1(e,u)}else if(r)return H1(r,u)},has:function(u){if(So&&u&&(typeof u=="object"||typeof u=="function")){if(t)return U1(t,u)}else if(Io){if(e)return Z1(e,u)}else if(r)return K1(r,u);return!1},set:function(u,h){So&&u&&(typeof u=="object"||typeof u=="function")?(t||(t=new So),W1(t,u,h)):Io?(e||(e=new Io),V1(e,u,h)):(r||(r={key:{},next:null}),J1(r,u,h))}};return s},Q1=jc,gs=Wf(),wn=Vn,Pu={assert:function(i,t){if(!i||typeof i!="object"&&typeof i!="function")throw new wn("`O` is not an object");if(typeof t!="string")throw new wn("`slot` must be a string");if(gs.assert(i),!Pu.has(i,t))throw new wn("`"+t+"` is not present on `O`")},get:function(i,t){if(!i||typeof i!="object"&&typeof i!="function")throw new wn("`O` is not an object");if(typeof t!="string")throw new wn("`slot` must be a string");var e=gs.get(i);return e&&e["$"+t]},has:function(i,t){if(!i||typeof i!="object"&&typeof i!="function")throw new wn("`O` is not an object");if(typeof t!="string")throw new wn("`slot` must be a string");var e=gs.get(i);return!!e&&Q1(e,"$"+t)},set:function(i,t,e){if(!i||typeof i!="object"&&typeof i!="function")throw new wn("`O` is not an object");if(typeof t!="string")throw new wn("`slot` must be a string");var r=gs.get(i);r||(r={},gs.set(i,r)),r["$"+t]=e}};Object.freeze&&Object.freeze(Pu);var tx=Pu,ds=tx,ex=SyntaxError,Uf=typeof StopIteration=="object"?StopIteration:null,nx=function(t){if(!Uf)throw new ex("this environment lacks StopIteration");ds.set(t,"[[Done]]",!1);var e={next:function(){var s=ds.get(this,"[[Iterator]]"),u=ds.get(s,"[[Done]]");try{return{done:u,value:u?void 0:s.next()}}catch(h){if(ds.set(s,"[[Done]]",!0),h!==Uf)throw h;return{done:!0,value:void 0}}}};return ds.set(e,"[[Iterator]]",t),e},ix={}.toString,jf=Array.isArray||function(i){return ix.call(i)=="[object Array]"},rx=String.prototype.valueOf,sx=function(t){try{return rx.call(t),!0}catch{return!1}},ox=Object.prototype.toString,ax="[object String]",ux=Ti(),Vf=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:ux?sx(t):ox.call(t)===ax},Du=typeof Map=="function"&&Map.prototype?Map:null,lx=typeof Set=="function"&&Set.prototype?Set:null,wo;Du||(wo=function(t){return!1});var Zf=Du?Map.prototype.has:null,Hf=lx?Set.prototype.has:null;!wo&&!Zf&&(wo=function(t){return!1});var Jf=wo||function(t){if(!t||typeof t!="object")return!1;try{if(Zf.call(t),Hf)try{Hf.call(t)}catch{return!0}return t instanceof Du}catch{}return!1},hx=typeof Map=="function"&&Map.prototype?Map:null,Fu=typeof Set=="function"&&Set.prototype?Set:null,ko;Fu||(ko=function(t){return!1});var Kf=hx?Map.prototype.has:null,Qf=Fu?Set.prototype.has:null;!ko&&!Qf&&(ko=function(t){return!1});var tg=ko||function(t){if(!t||typeof t!="object")return!1;try{if(Qf.call(t),Kf)try{Kf.call(t)}catch{return!0}return t instanceof Fu}catch{}return!1},eg=kf,ng=nx;if(hu()||co()){var Gu=Symbol.iterator;mo.exports=function(t){if(t!=null&&typeof t[Gu]<"u")return t[Gu]();if(eg(t))return Array.prototype[Gu].call(t)}}else{var cx=jf,fx=Vf,ig=rn,gx=ig("%Map%",!0),dx=ig("%Set%",!0),$e=be,rg=$e("Array.prototype.push"),sg=$e("String.prototype.charCodeAt"),yx=$e("String.prototype.slice"),px=function(t,e){var r=t.length;if(e+1>=r)return e+1;var s=sg(t,e);if(s<55296||s>56319)return e+1;var u=sg(t,e+1);return u<56320||u>57343?e+1:e+2},Bu=function(t){var e=0;return{next:function(){var s=e>=t.length,u;return s||(u=t[e],e+=1),{done:s,value:u}}}},og=function(t,e){if(cx(t)||eg(t))return Bu(t);if(fx(t)){var r=0;return{next:function(){var u=px(t,r),h=yx(t,r,u);return r=u,{done:u>t.length,value:h}}}}if(e&&typeof t["_es6-shim iterator_"]<"u")return t["_es6-shim iterator_"]()};if(!gx&&!dx)mo.exports=function(t){if(t!=null)return og(t,!0)};else{var mx=Jf,vx=tg,ag=$e("Map.prototype.forEach",!0),ug=$e("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var lg=$e("Map.prototype.iterator",!0),hg=$e("Set.prototype.iterator",!0);var cg=$e("Map.prototype.@@iterator",!0)||$e("Map.prototype._es6-shim iterator_",!0),fg=$e("Set.prototype.@@iterator",!0)||$e("Set.prototype._es6-shim iterator_",!0),_x=function(t){if(mx(t)){if(lg)return ng(lg(t));if(cg)return cg(t);if(ag){var e=[];return ag(t,function(s,u){rg(e,[u,s])}),Bu(e)}}if(vx(t)){if(hg)return ng(hg(t));if(fg)return fg(t);if(ug){var r=[];return ug(t,function(s){rg(r,s)}),Bu(r)}}};mo.exports=function(t){return _x(t)||og(t)}}}var xx=mo.exports,gg=function(i){return i!==i},dg=function(t,e){return t===0&&e===0?1/t===1/e:!!(t===e||gg(t)&&gg(e))},Ex=dg,yg=function(){return typeof Object.is=="function"?Object.is:Ex},Sx=yg,Ix=bi,wx=function(){var t=Sx();return Ix(Object,{is:t},{is:function(){return Object.is!==t}}),t},kx=bi,Cx=ur,Rx=dg,pg=yg,bx=wx,mg=Cx(pg(),Object);kx(mg,{getPolyfill:pg,implementation:Rx,shim:bx});var Tx=mg,Nx=ur,vg=be,Mx=rn,Yu=Mx("%ArrayBuffer%",!0),Co=vg("ArrayBuffer.prototype.byteLength",!0),Ox=vg("Object.prototype.toString"),_g=!!Yu&&!Co&&new Yu(0).slice,xg=!!_g&&Nx(_g),Eg=Co||xg?function(t){if(!t||typeof t!="object")return!1;try{return Co?Co(t):xg(t,0),!0}catch{return!1}}:Yu?function(t){return Ox(t)==="[object ArrayBuffer]"}:function(t){return!1},Lx=Date.prototype.getDay,Ax=function(t){try{return Lx.call(t),!0}catch{return!1}},Px=Object.prototype.toString,Dx="[object Date]",Fx=Ti(),Gx=function(t){return typeof t!="object"||t===null?!1:Fx?Ax(t):Px.call(t)===Dx},zu=be,Sg=Ti(),Ig,wg,$u,Xu;if(Sg){Ig=zu("Object.prototype.hasOwnProperty"),wg=zu("RegExp.prototype.exec"),$u={};var qu=function(){throw $u};Xu={toString:qu,valueOf:qu},typeof Symbol.toPrimitive=="symbol"&&(Xu[Symbol.toPrimitive]=qu)}var Bx=zu("Object.prototype.toString"),Yx=Object.getOwnPropertyDescriptor,zx="[object RegExp]",$x=Sg?function(t){if(!t||typeof t!="object")return!1;var e=Yx(t,"lastIndex"),r=e&&Ig(e,"value");if(!r)return!1;try{wg(t,Xu)}catch(s){return s===$u}}:function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:Bx(t)===zx},Xx=be,kg=Xx("SharedArrayBuffer.prototype.byteLength",!0),qx=kg?function(t){if(!t||typeof t!="object")return!1;try{return kg(t),!0}catch{return!1}}:function(t){return!1},Wx=Number.prototype.toString,Ux=function(t){try{return Wx.call(t),!0}catch{return!1}},jx=Object.prototype.toString,Vx="[object Number]",Zx=Ti(),Hx=function(t){return typeof t=="number"?!0:typeof t!="object"?!1:Zx?Ux(t):jx.call(t)===Vx},Cg=be,Jx=Cg("Boolean.prototype.toString"),Kx=Cg("Object.prototype.toString"),Qx=function(t){try{return Jx(t),!0}catch{return!1}},tE="[object Boolean]",eE=Ti(),nE=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:eE&&Symbol.toStringTag in t?Qx(t):Kx(t)===tE},Wu={exports:{}},iE=Object.prototype.toString,rE=hu();if(rE){var sE=Symbol.prototype.toString,oE=/^Symbol\(.*\)$/,aE=function(t){return typeof t.valueOf()!="symbol"?!1:oE.test(sE.call(t))};Wu.exports=function(t){if(typeof t=="symbol")return!0;if(iE.call(t)!=="[object Symbol]")return!1;try{return aE(t)}catch{return!1}}}else Wu.exports=function(t){return!1};var uE=Wu.exports,Uu={exports:{}},Rg=typeof BigInt<"u"&&BigInt,lE=function(){return typeof Rg=="function"&&typeof BigInt=="function"&&typeof Rg(42)=="bigint"&&typeof BigInt(42)=="bigint"},hE=lE();if(hE){var cE=BigInt.prototype.valueOf,fE=function(t){try{return cE.call(t),!0}catch{}return!1};Uu.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:fE(t)}}else Uu.exports=function(t){return!1};var gE=Uu.exports,dE=Vf,yE=Hx,pE=nE,mE=uE,vE=gE,_E=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(dE(t))return"String";if(yE(t))return"Number";if(pE(t))return"Boolean";if(mE(t))return"Symbol";if(vE(t))return"BigInt"},Ro=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,bg=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,bo;Ro||(bo=function(t){return!1});var ju=Ro?Ro.prototype.has:null,Vu=bg?bg.prototype.has:null;!bo&&!ju&&(bo=function(t){return!1});var xE=bo||function(t){if(!t||typeof t!="object")return!1;try{if(ju.call(t,ju),Vu)try{Vu.call(t,Vu)}catch{return!0}return t instanceof Ro}catch{}return!1},Zu={exports:{}},EE=rn,Tg=be,SE=EE("%WeakSet%",!0),Hu=Tg("WeakSet.prototype.has",!0);if(Hu){var Ju=Tg("WeakMap.prototype.has",!0);Zu.exports=function(t){if(!t||typeof t!="object")return!1;try{if(Hu(t,Hu),Ju)try{Ju(t,Ju)}catch{return!0}return t instanceof SE}catch{}return!1}}else Zu.exports=function(t){return!1};var IE=Zu.exports,wE=Jf,kE=tg,CE=xE,RE=IE,bE=function(t){if(t&&typeof t=="object"){if(wE(t))return"Map";if(kE(t))return"Set";if(CE(t))return"WeakMap";if(RE(t))return"WeakSet"}return!1},Ng=Function.prototype.toString,cr=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,Ku,To;if(typeof cr=="function"&&typeof Object.defineProperty=="function")try{Ku=Object.defineProperty({},"length",{get:function(){throw To}}),To={},cr(function(){throw 42},null,Ku)}catch(i){i!==To&&(cr=null)}else cr=null;var TE=/^\s*class\b/,Qu=function(t){try{var e=Ng.call(t);return TE.test(e)}catch{return!1}},tl=function(t){try{return Qu(t)?!1:(Ng.call(t),!0)}catch{return!1}},No=Object.prototype.toString,NE="[object Object]",ME="[object Function]",OE="[object GeneratorFunction]",LE="[object HTMLAllCollection]",AE="[object HTML document.all class]",PE="[object HTMLCollection]",DE=typeof Symbol=="function"&&!!Symbol.toStringTag,FE=!(0 in[,]),el=function(){return!1};if(typeof document=="object"){var GE=document.all;No.call(GE)===No.call(document.all)&&(el=function(t){if((FE||!t)&&(typeof t>"u"||typeof t=="object"))try{var e=No.call(t);return(e===LE||e===AE||e===PE||e===NE)&&t("")==null}catch{}return!1})}var BE=cr?function(t){if(el(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{cr(t,null,Ku)}catch(e){if(e!==To)return!1}return!Qu(t)&&tl(t)}:function(t){if(el(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(DE)return tl(t);if(Qu(t))return!1;var e=No.call(t);return e!==ME&&e!==OE&&!/^\[object HTML/.test(e)?!1:tl(t)},YE=BE,zE=Object.prototype.toString,Mg=Object.prototype.hasOwnProperty,$E=function(t,e,r){for(var s=0,u=t.length;s<u;s++)Mg.call(t,s)&&(r==null?e(t[s],s,t):e.call(r,t[s],s,t))},XE=function(t,e,r){for(var s=0,u=t.length;s<u;s++)r==null?e(t.charAt(s),s,t):e.call(r,t.charAt(s),s,t)},qE=function(t,e,r){for(var s in t)Mg.call(t,s)&&(r==null?e(t[s],s,t):e.call(r,t[s],s,t))},WE=function(t,e,r){if(!YE(e))throw new TypeError("iterator must be a function");var s;arguments.length>=3&&(s=r),zE.call(t)==="[object Array]"?$E(t,e,s):typeof t=="string"?XE(t,e,s):qE(t,e,s)},UE=WE,jE=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],nl=jE,VE=typeof globalThis>"u"?lo:globalThis,ZE=function(){for(var t=[],e=0;e<nl.length;e++)typeof VE[nl[e]]=="function"&&(t[t.length]=nl[e]);return t},Mo=UE,HE=ZE,Og=ur,il=be,Oo=pu,JE=il("Object.prototype.toString"),Lg=Ti(),Ag=typeof globalThis>"u"?lo:globalThis,rl=HE(),sl=il("String.prototype.slice"),ol=Object.getPrototypeOf,KE=il("Array.prototype.indexOf",!0)||function(t,e){for(var r=0;r<t.length;r+=1)if(t[r]===e)return r;return-1},Lo={__proto__:null};Lg&&Oo&&ol?Mo(rl,function(i){var t=new Ag[i];if(Symbol.toStringTag in t){var e=ol(t),r=Oo(e,Symbol.toStringTag);if(!r){var s=ol(e);r=Oo(s,Symbol.toStringTag)}Lo["$"+i]=Og(r.get)}}):Mo(rl,function(i){var t=new Ag[i],e=t.slice||t.set;e&&(Lo["$"+i]=Og(e))});var QE=function(t){var e=!1;return Mo(Lo,function(r,s){if(!e)try{"$"+r(t)===s&&(e=sl(s,1))}catch{}}),e},tS=function(t){var e=!1;return Mo(Lo,function(r,s){if(!e)try{r(t),e=sl(s,1)}catch{}}),e},eS=function(t){if(!t||typeof t!="object")return!1;if(!Lg){var e=sl(JE(t),8,-1);return KE(rl,e)>-1?e:e!=="Object"?!1:tS(t)}return Oo?QE(t):null},nS=be,Pg=nS("ArrayBuffer.prototype.byteLength",!0),iS=Eg,rS=function(t){return iS(t)?Pg?Pg(t):t.byteLength:NaN},Dg=G0,on=be,Fg=u1,sS=rn,fr=xx,oS=Wf,Gg=Tx,Bg=kf,Yg=jf,zg=Eg,$g=Gx,Xg=$x,qg=qx,Wg=lu,Ug=_E,jg=bE,Vg=eS,Zg=rS,Hg=on("SharedArrayBuffer.prototype.byteLength",!0),Jg=on("Date.prototype.getTime"),al=Object.getPrototypeOf,Kg=on("Object.prototype.toString"),Ao=sS("%Set%",!0),ul=on("Map.prototype.has",!0),Po=on("Map.prototype.get",!0),Qg=on("Map.prototype.size",!0),Do=on("Set.prototype.add",!0),td=on("Set.prototype.delete",!0),Fo=on("Set.prototype.has",!0),Go=on("Set.prototype.size",!0);function ed(i,t,e,r){for(var s=fr(i),u;(u=s.next())&&!u.done;)if(Xe(t,u.value,e,r))return td(i,u.value),!0;return!1}function nd(i){if(typeof i>"u")return null;if(typeof i!="object")return typeof i=="symbol"?!1:typeof i=="string"||typeof i=="number"?+i==+i:!0}function aS(i,t,e,r,s,u){var h=nd(e);if(h!=null)return h;var f=Po(t,h),g=Dg({},s,{strict:!1});return typeof f>"u"&&!ul(t,h)||!Xe(r,f,g,u)?!1:!ul(i,h)&&Xe(r,f,g,u)}function uS(i,t,e){var r=nd(e);return r??(Fo(t,r)&&!Fo(i,r))}function id(i,t,e,r,s,u){for(var h=fr(i),f,g;(f=h.next())&&!f.done;)if(g=f.value,Xe(e,g,s,u)&&Xe(r,Po(t,g),s,u))return td(i,g),!0;return!1}function Xe(i,t,e,r){var s=e||{};if(s.strict?Gg(i,t):i===t)return!0;var u=Ug(i),h=Ug(t);if(u!==h)return!1;if(!i||!t||typeof i!="object"&&typeof t!="object")return s.strict?Gg(i,t):i==t;var f=r.has(i),g=r.has(t),y;if(f&&g){if(r.get(i)===r.get(t))return!0}else y={};return f||r.set(i,y),g||r.set(t,y),cS(i,t,s,r)}function rd(i){return!i||typeof i!="object"||typeof i.length!="number"||typeof i.copy!="function"||typeof i.slice!="function"||i.length>0&&typeof i[0]!="number"?!1:!!(i.constructor&&i.constructor.isBuffer&&i.constructor.isBuffer(i))}function lS(i,t,e,r){if(Go(i)!==Go(t))return!1;for(var s=fr(i),u=fr(t),h,f,g;(h=s.next())&&!h.done;)if(h.value&&typeof h.value=="object")g||(g=new Ao),Do(g,h.value);else if(!Fo(t,h.value)){if(e.strict||!uS(i,t,h.value))return!1;g||(g=new Ao),Do(g,h.value)}if(g){for(;(f=u.next())&&!f.done;)if(f.value&&typeof f.value=="object"){if(!ed(g,f.value,e.strict,r))return!1}else if(!e.strict&&!Fo(i,f.value)&&!ed(g,f.value,e.strict,r))return!1;return Go(g)===0}return!0}function hS(i,t,e,r){if(Qg(i)!==Qg(t))return!1;for(var s=fr(i),u=fr(t),h,f,g,y,p,m;(h=s.next())&&!h.done;)if(y=h.value[0],p=h.value[1],y&&typeof y=="object")g||(g=new Ao),Do(g,y);else if(m=Po(t,y),typeof m>"u"&&!ul(t,y)||!Xe(p,m,e,r)){if(e.strict||!aS(i,t,y,p,e,r))return!1;g||(g=new Ao),Do(g,y)}if(g){for(;(f=u.next())&&!f.done;)if(y=f.value[0],m=f.value[1],y&&typeof y=="object"){if(!id(g,i,y,m,e,r))return!1}else if(!e.strict&&(!i.has(y)||!Xe(Po(i,y),m,e,r))&&!id(g,i,y,m,Dg({},e,{strict:!1}),r))return!1;return Go(g)===0}return!0}function cS(i,t,e,r){var s,u;if(typeof i!=typeof t||i==null||t==null||Kg(i)!==Kg(t)||Bg(i)!==Bg(t))return!1;var h=Yg(i),f=Yg(t);if(h!==f)return!1;var g=i instanceof Error,y=t instanceof Error;if(g!==y||(g||y)&&(i.name!==t.name||i.message!==t.message))return!1;var p=Xg(i),m=Xg(t);if(p!==m||(p||m)&&(i.source!==t.source||Fg(i)!==Fg(t)))return!1;var _=$g(i),x=$g(t);if(_!==x||(_||x)&&Jg(i)!==Jg(t)||e.strict&&al&&al(i)!==al(t))return!1;var I=Vg(i),k=Vg(t);if(I!==k)return!1;if(I||k){if(i.length!==t.length)return!1;for(s=0;s<i.length;s++)if(i[s]!==t[s])return!1;return!0}var C=rd(i),R=rd(t);if(C!==R)return!1;if(C||R){if(i.length!==t.length)return!1;for(s=0;s<i.length;s++)if(i[s]!==t[s])return!1;return!0}var b=zg(i),O=zg(t);if(b!==O)return!1;if(b||O)return Zg(i)!==Zg(t)?!1:typeof Uint8Array=="function"&&Xe(new Uint8Array(i),new Uint8Array(t),e,r);var A=qg(i),L=qg(t);if(A!==L)return!1;if(A||L)return Hg(i)!==Hg(t)?!1:typeof Uint8Array=="function"&&Xe(new Uint8Array(i),new Uint8Array(t),e,r);if(typeof i!=typeof t)return!1;var D=Wg(i),F=Wg(t);if(D.length!==F.length)return!1;for(D.sort(),F.sort(),s=D.length-1;s>=0;s--)if(D[s]!=F[s])return!1;for(s=D.length-1;s>=0;s--)if(u=D[s],!Xe(i[u],t[u],e,r))return!1;var G=jg(i),B=jg(t);return G!==B?!1:G==="Set"||B==="Set"?lS(i,t,e,r):G==="Map"?hS(i,t,e,r):!0}var fS=function(t,e,r){return Xe(t,e,r,oS())};const gS=Gc(fS);var dS=Object.defineProperty,Ct=(i,t)=>dS(i,"name",{value:t,configurable:!0}),yS=class{constructor(t){this.direction=!1,this.compareProperties=!0;var e,r,s;this.precision=10**-((e=t==null?void 0:t.precision)!=null?e:17),this.direction=(r=t==null?void 0:t.direction)!=null?r:!1,this.compareProperties=(s=t==null?void 0:t.compareProperties)!=null?s:!0}compare(t,e){if(t.type!==e.type||!ys(t,e))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,e.coordinates);case"LineString":return this.compareLine(t.coordinates,e.coordinates);case"Polygon":return this.comparePolygon(t,e);case"GeometryCollection":return this.compareGeometryCollection(t,e);case"Feature":return this.compareFeature(t,e);case"FeatureCollection":return this.compareFeatureCollection(t,e);default:if(t.type.startsWith("Multi")){const r=ll(t),s=ll(e);return r.every(u=>s.some(h=>this.compare(u,h)))}}return!1}compareCoord(t,e){return t.length===e.length&&t.every((r,s)=>Math.abs(r-e[s])<this.precision)}compareLine(t,e,r=0,s=!1){if(!ys(t,e))return!1;const u=t;let h=e;if(s&&!this.compareCoord(u[0],h[0])){const g=this.fixStartIndex(h,u);if(g)h=g;else return!1}const f=this.compareCoord(u[r],h[r]);return this.direction||f?this.comparePath(u,h):this.compareCoord(u[r],h[h.length-(1+r)])?this.comparePath(u.slice().reverse(),h):!1}fixStartIndex(t,e){let r,s=-1;for(let u=0;u<t.length;u++)if(this.compareCoord(t[u],e[0])){s=u;break}return s>=0&&(r=[].concat(t.slice(s,t.length),t.slice(1,s+1))),r}comparePath(t,e){return t.every((r,s)=>this.compareCoord(r,e[s]))}comparePolygon(t,e){if(this.compareLine(t.coordinates[0],e.coordinates[0],1,!0)){const r=t.coordinates.slice(1,t.coordinates.length),s=e.coordinates.slice(1,e.coordinates.length);return r.every(u=>s.some(h=>this.compareLine(u,h,1,!0)))}return!1}compareGeometryCollection(t,e){return ys(t.geometries,e.geometries)&&this.compareBBox(t,e)&&t.geometries.every((r,s)=>this.compare(r,e.geometries[s]))}compareFeature(t,e){return t.id===e.id&&(this.compareProperties?gS(t.properties,e.properties):!0)&&this.compareBBox(t,e)&&this.compare(t.geometry,e.geometry)}compareFeatureCollection(t,e){return ys(t.features,e.features)&&this.compareBBox(t,e)&&t.features.every((r,s)=>this.compare(r,e.features[s]))}compareBBox(t,e){return!t.bbox&&!e.bbox||(t.bbox&&e.bbox?this.compareCoord(t.bbox,e.bbox):!1)}};Ct(yS,"GeojsonEquality");function ys(i,t){return i.coordinates?i.coordinates.length===t.coordinates.length:i.length===t.length}Ct(ys,"sameLength");function ll(i){return i.coordinates.map(t=>({type:i.type.replace("Multi",""),coordinates:t}))}Ct(ll,"explode");var ge=63710088e-1,sd={centimeters:ge*100,centimetres:ge*100,degrees:360/(2*Math.PI),feet:ge*3.28084,inches:ge*39.37,kilometers:ge/1e3,kilometres:ge/1e3,meters:ge,metres:ge,miles:ge/1609.344,millimeters:ge*1e3,millimetres:ge*1e3,nauticalmiles:ge/1852,radians:1,yards:ge*1.0936},od={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function qe(i,t,e={}){const r={type:"Feature"};return(e.id===0||e.id)&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.properties=t||{},r.geometry=i,r}Ct(qe,"feature");function pS(i,t,e={}){switch(i){case"Point":return an(t).geometry;case"LineString":return kn(t).geometry;case"Polygon":return ps(t).geometry;case"MultiPoint":return ud(t).geometry;case"MultiLineString":return ad(t).geometry;case"MultiPolygon":return hl(t).geometry;default:throw new Error(i+" is invalid")}}Ct(pS,"geometry");function an(i,t,e={}){if(!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Yo(i[0])||!Yo(i[1]))throw new Error("coordinates must contain numbers");return qe({type:"Point",coordinates:i},t,e)}Ct(an,"point");function mS(i,t,e={}){return Cn(i.map(r=>an(r,t)),e)}Ct(mS,"points");function ps(i,t,e={}){for(const s of i){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<s[s.length-1].length;u++)if(s[s.length-1][u]!==s[0][u])throw new Error("First and last Position are not equivalent.")}return qe({type:"Polygon",coordinates:i},t,e)}Ct(ps,"polygon");function vS(i,t,e={}){return Cn(i.map(r=>ps(r,t)),e)}Ct(vS,"polygons");function kn(i,t,e={}){if(i.length<2)throw new Error("coordinates must be an array of two or more positions");return qe({type:"LineString",coordinates:i},t,e)}Ct(kn,"lineString");function _S(i,t,e={}){return Cn(i.map(r=>kn(r,t)),e)}Ct(_S,"lineStrings");function Cn(i,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=i,e}Ct(Cn,"featureCollection");function ad(i,t,e={}){return qe({type:"MultiLineString",coordinates:i},t,e)}Ct(ad,"multiLineString");function ud(i,t,e={}){return qe({type:"MultiPoint",coordinates:i},t,e)}Ct(ud,"multiPoint");function hl(i,t,e={}){return qe({type:"MultiPolygon",coordinates:i},t,e)}Ct(hl,"multiPolygon");function xS(i,t,e={}){return qe({type:"GeometryCollection",geometries:i},t,e)}Ct(xS,"geometryCollection");function ES(i,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const e=Math.pow(10,t||0);return Math.round(i*e)/e}Ct(ES,"round");function cl(i,t="kilometers"){const e=sd[t];if(!e)throw new Error(t+" units is invalid");return i*e}Ct(cl,"radiansToLength");function Bo(i,t="kilometers"){const e=sd[t];if(!e)throw new Error(t+" units is invalid");return i/e}Ct(Bo,"lengthToRadians");function SS(i,t){return ld(Bo(i,t))}Ct(SS,"lengthToDegrees");function IS(i){let t=i%360;return t<0&&(t+=360),t}Ct(IS,"bearingToAzimuth");function ld(i){return i%(2*Math.PI)*180/Math.PI}Ct(ld,"radiansToDegrees");function wS(i){return i%360*Math.PI/180}Ct(wS,"degreesToRadians");function kS(i,t="kilometers",e="kilometers"){if(!(i>=0))throw new Error("length must be a positive number");return cl(Bo(i,t),e)}Ct(kS,"convertLength");function CS(i,t="meters",e="kilometers"){if(!(i>=0))throw new Error("area must be a positive number");const r=od[t];if(!r)throw new Error("invalid original units");const s=od[e];if(!s)throw new Error("invalid final units");return i/r*s}Ct(CS,"convertArea");function Yo(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}Ct(Yo,"isNumber");function fl(i){return i!==null&&typeof i=="object"&&!Array.isArray(i)}Ct(fl,"isObject");function RS(i){if(!i)throw new Error("bbox is required");if(!Array.isArray(i))throw new Error("bbox must be an Array");if(i.length!==4&&i.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");i.forEach(t=>{if(!Yo(t))throw new Error("bbox must only contain numbers")})}Ct(RS,"validateBBox");function bS(i){if(!i)throw new Error("id is required");if(["string","number"].indexOf(typeof i)===-1)throw new Error("id must be a number or a string")}Ct(bS,"validateId");var TS=Object.defineProperty,Zt=(i,t)=>TS(i,"name",{value:t,configurable:!0});function gr(i,t,e){if(i!==null)for(var r,s,u,h,f,g,y,p=0,m=0,_,x=i.type,I=x==="FeatureCollection",k=x==="Feature",C=I?i.features.length:1,R=0;R<C;R++){y=I?i.features[R].geometry:k?i.geometry:i,_=y?y.type==="GeometryCollection":!1,f=_?y.geometries.length:1;for(var b=0;b<f;b++){var O=0,A=0;if(h=_?y.geometries[b]:y,h!==null){g=h.coordinates;var L=h.type;switch(p=e&&(L==="Polygon"||L==="MultiPolygon")?1:0,L){case null:break;case"Point":if(t(g,m,R,O,A)===!1)return!1;m++,O++;break;case"LineString":case"MultiPoint":for(r=0;r<g.length;r++){if(t(g[r],m,R,O,A)===!1)return!1;m++,L==="MultiPoint"&&O++}L==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(r=0;r<g.length;r++){for(s=0;s<g[r].length-p;s++){if(t(g[r][s],m,R,O,A)===!1)return!1;m++}L==="MultiLineString"&&O++,L==="Polygon"&&A++}L==="Polygon"&&O++;break;case"MultiPolygon":for(r=0;r<g.length;r++){for(A=0,s=0;s<g[r].length;s++){for(u=0;u<g[r][s].length-p;u++){if(t(g[r][s][u],m,R,O,A)===!1)return!1;m++}A++}O++}break;case"GeometryCollection":for(r=0;r<h.geometries.length;r++)if(gr(h.geometries[r],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Zt(gr,"coordEach");function NS(i,t,e,r){var s=e;return gr(i,function(u,h,f,g,y){h===0&&e===void 0?s=u:s=t(s,u,h,f,g,y)},r),s}Zt(NS,"coordReduce");function hd(i,t){var e;switch(i.type){case"FeatureCollection":for(e=0;e<i.features.length&&t(i.features[e].properties,e)!==!1;e++);break;case"Feature":t(i.properties,0);break}}Zt(hd,"propEach");function MS(i,t,e){var r=e;return hd(i,function(s,u){u===0&&e===void 0?r=s:r=t(r,s,u)}),r}Zt(MS,"propReduce");function zo(i,t){if(i.type==="Feature")t(i,0);else if(i.type==="FeatureCollection")for(var e=0;e<i.features.length&&t(i.features[e],e)!==!1;e++);}Zt(zo,"featureEach");function OS(i,t,e){var r=e;return zo(i,function(s,u){u===0&&e===void 0?r=s:r=t(r,s,u)}),r}Zt(OS,"featureReduce");function LS(i){var t=[];return gr(i,function(e){t.push(e)}),t}Zt(LS,"coordAll");function dr(i,t){var e,r,s,u,h,f,g,y,p,m,_=0,x=i.type==="FeatureCollection",I=i.type==="Feature",k=x?i.features.length:1;for(e=0;e<k;e++){for(f=x?i.features[e].geometry:I?i.geometry:i,y=x?i.features[e].properties:I?i.properties:{},p=x?i.features[e].bbox:I?i.bbox:void 0,m=x?i.features[e].id:I?i.id:void 0,g=f?f.type==="GeometryCollection":!1,h=g?f.geometries.length:1,s=0;s<h;s++){if(u=g?f.geometries[s]:f,u===null){if(t(null,_,y,p,m)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,_,y,p,m)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],_,y,p,m)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}Zt(dr,"geomEach");function AS(i,t,e){var r=e;return dr(i,function(s,u,h,f,g){u===0&&e===void 0?r=s:r=t(r,s,u,h,f,g)}),r}Zt(AS,"geomReduce");function $o(i,t){dr(i,function(e,r,s,u,h){var f=e===null?null:e.type;switch(f){case null:case"Point":case"LineString":case"Polygon":return t(qe(e,s,{bbox:u,id:h}),r,0)===!1?!1:void 0}var g;switch(f){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var y=0;y<e.coordinates.length;y++){var p=e.coordinates[y],m={type:g,coordinates:p};if(t(qe(m,s),r,y)===!1)return!1}})}Zt($o,"flattenEach");function PS(i,t,e){var r=e;return $o(i,function(s,u,h){u===0&&h===0&&e===void 0?r=s:r=t(r,s,u,h)}),r}Zt(PS,"flattenReduce");function cd(i,t){$o(i,function(e,r,s){var u=0;if(e.geometry){var h=e.geometry.type;if(!(h==="Point"||h==="MultiPoint")){var f,g=0,y=0,p=0;if(gr(e,function(m,_,x,I,k){if(f===void 0||r>g||I>y||k>p){f=m,g=r,y=I,p=k,u=0;return}var C=kn([f,m],e.properties);if(t(C,r,s,k,u)===!1)return!1;u++,f=m})===!1)return!1}}})}Zt(cd,"segmentEach");function DS(i,t,e){var r=e,s=!1;return cd(i,function(u,h,f,g,y){s===!1&&e===void 0?r=u:r=t(r,u,h,f,g,y),s=!0}),r}Zt(DS,"segmentReduce");function fd(i,t){if(!i)throw new Error("geojson is required");$o(i,function(e,r,s){if(e.geometry!==null){var u=e.geometry.type,h=e.geometry.coordinates;switch(u){case"LineString":if(t(e,r,s,0,0)===!1)return!1;break;case"Polygon":for(var f=0;f<h.length;f++)if(t(kn(h[f],e.properties),r,s,f)===!1)return!1;break}}})}Zt(fd,"lineEach");function FS(i,t,e){var r=e;return fd(i,function(s,u,h,f){u===0&&e===void 0?r=s:r=t(r,s,u,h,f)}),r}Zt(FS,"lineReduce");function GS(i,t){if(t=t||{},!fl(t))throw new Error("options is invalid");var e=t.featureIndex||0,r=t.multiFeatureIndex||0,s=t.geometryIndex||0,u=t.segmentIndex||0,h=t.properties,f;switch(i.type){case"FeatureCollection":e<0&&(e=i.features.length+e),h=h||i.features[e].properties,f=i.features[e].geometry;break;case"Feature":h=h||i.properties,f=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=i;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var g=f.coordinates;switch(f.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=g.length+u-1),kn([g[u],g[u+1]],h,t);case"Polygon":return s<0&&(s=g.length+s),u<0&&(u=g[s].length+u-1),kn([g[s][u],g[s][u+1]],h,t);case"MultiLineString":return r<0&&(r=g.length+r),u<0&&(u=g[r].length+u-1),kn([g[r][u],g[r][u+1]],h,t);case"MultiPolygon":return r<0&&(r=g.length+r),s<0&&(s=g[r].length+s),u<0&&(u=g[r][s].length-u-1),kn([g[r][s][u],g[r][s][u+1]],h,t)}throw new Error("geojson is invalid")}Zt(GS,"findSegment");function BS(i,t){if(t=t||{},!fl(t))throw new Error("options is invalid");var e=t.featureIndex||0,r=t.multiFeatureIndex||0,s=t.geometryIndex||0,u=t.coordIndex||0,h=t.properties,f;switch(i.type){case"FeatureCollection":e<0&&(e=i.features.length+e),h=h||i.features[e].properties,f=i.features[e].geometry;break;case"Feature":h=h||i.properties,f=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":f=i;break;default:throw new Error("geojson is invalid")}if(f===null)return null;var g=f.coordinates;switch(f.type){case"Point":return an(g,h,t);case"MultiPoint":return r<0&&(r=g.length+r),an(g[r],h,t);case"LineString":return u<0&&(u=g.length+u),an(g[u],h,t);case"Polygon":return s<0&&(s=g.length+s),u<0&&(u=g[s].length+u),an(g[s][u],h,t);case"MultiLineString":return r<0&&(r=g.length+r),u<0&&(u=g[r].length+u),an(g[r][u],h,t);case"MultiPolygon":return r<0&&(r=g.length+r),s<0&&(s=g[r].length+s),u<0&&(u=g[r][s].length-u),an(g[r][s][u],h,t)}throw new Error("geojson is invalid")}Zt(BS,"findPoint");var YS=Object.defineProperty,zS=(i,t)=>YS(i,"name",{value:t,configurable:!0});function gd(i,t={}){if(i.bbox!=null&&t.recompute!==!0)return i.bbox;const e=[1/0,1/0,-1/0,-1/0];return gr(i,r=>{e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}zS(gd,"bbox");var $S=Object.defineProperty,XS=(i,t)=>$S(i,"name",{value:t,configurable:!0});function dd(i,t={}){const e=gd(i),r=(e[0]+e[2])/2,s=(e[1]+e[3])/2;return an([r,s],t.properties,t)}XS(dd,"center");var yd={exports:{}};(function(i,t){(function(e,r){i.exports=r()})(lo,function(){function e(c,n){if(!(c instanceof n))throw new TypeError("Cannot call a class as a function")}function r(c,n){for(var o=0;o<n.length;o++){var a=n[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(c,a.key,a)}}function s(c,n,o){return n&&r(c.prototype,n),o&&r(c,o),c}function u(c,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");c.prototype=Object.create(n&&n.prototype,{constructor:{value:c,writable:!0,configurable:!0}}),n&&f(c,n)}function h(c){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},h(c)}function f(c,n){return f=Object.setPrototypeOf||function(o,a){return o.__proto__=a,o},f(c,n)}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function y(c,n,o){return y=g()?Reflect.construct:function(a,l,d){var v=[null];v.push.apply(v,l);var E=new(Function.bind.apply(a,v));return d&&f(E,d.prototype),E},y.apply(null,arguments)}function p(c){var n=typeof Map=="function"?new Map:void 0;return p=function(o){if(o===null||(a=o,Function.toString.call(a).indexOf("[native code]")===-1))return o;var a;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(n!==void 0){if(n.has(o))return n.get(o);n.set(o,l)}function l(){return y(o,arguments,h(this).constructor)}return l.prototype=Object.create(o.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),f(l,o)},p(c)}function m(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function _(c,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m(c)}function x(c){var n=g();return function(){var o,a=h(c);if(n){var l=h(this).constructor;o=Reflect.construct(a,arguments,l)}else o=a.apply(this,arguments);return _(this,o)}}function I(c,n,o){return I=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(a,l,d){var v=function(S,w){for(;!Object.prototype.hasOwnProperty.call(S,w)&&(S=h(S))!==null;);return S}(a,l);if(v){var E=Object.getOwnPropertyDescriptor(v,l);return E.get?E.get.call(d):E.value}},I(c,n,o||c)}function k(c){return function(n){if(Array.isArray(n))return R(n)}(c)||function(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}(c)||C(c)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function C(c,n){if(c){if(typeof c=="string")return R(c,n);var o=Object.prototype.toString.call(c).slice(8,-1);return o==="Object"&&c.constructor&&(o=c.constructor.name),o==="Map"||o==="Set"?Array.from(c):o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?R(c,n):void 0}}function R(c,n){(n==null||n>c.length)&&(n=c.length);for(var o=0,a=new Array(n);o<n;o++)a[o]=c[o];return a}function b(c,n){var o=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!o){if(Array.isArray(c)||(o=C(c))||n){o&&(c=o);var a=0,l=function(){};return{s:l,n:function(){return a>=c.length?{done:!0}:{done:!1,value:c[a++]}},e:function(S){throw S},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d,v=!0,E=!1;return{s:function(){o=o.call(c)},n:function(){var S=o.next();return v=S.done,S},e:function(S){E=!0,d=S},f:function(){try{v||o.return==null||o.return()}finally{if(E)throw d}}}}var O=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(n){this._quadrantSegments=n,this._quadrantSegments===0&&(this._joinStyle=c.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=c.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),n<=0&&(this._quadrantSegments=1),this._joinStyle!==c.JOIN_ROUND&&(this._quadrantSegments=c.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(n){this._joinStyle=n}},{key:"setSimplifyFactor",value:function(n){this._simplifyFactor=n<0?0:n}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(n){this._endCapStyle=n}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(n){this._mitreLimit=n}},{key:"setSingleSided",value:function(n){this._isSingleSided=n}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=c.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=c.CAP_ROUND,this._joinStyle=c.JOIN_ROUND,this._mitreLimit=c.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=c.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.setQuadrantSegments(n)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.setQuadrantSegments(o),this.setEndCapStyle(a)}else if(arguments.length===4){var l=arguments[0],d=arguments[1],v=arguments[2],E=arguments[3];this.setQuadrantSegments(l),this.setEndCapStyle(d),this.setJoinStyle(v),this.setMitreLimit(E)}}}},{key:"bufferDistanceError",value:function(n){var o=Math.PI/2/n;return 1-Math.cos(o/2)}}]),c}();O.CAP_ROUND=1,O.CAP_FLAT=2,O.CAP_SQUARE=3,O.JOIN_ROUND=1,O.JOIN_MITRE=2,O.JOIN_BEVEL=3,O.DEFAULT_QUADRANT_SEGMENTS=8,O.DEFAULT_MITRE_LIMIT=5,O.DEFAULT_SIMPLIFY_FACTOR=.01;var A=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({Exception:o})[0],l}return s(o,[{key:"toString",value:function(){return this.message}}]),o}(p(Error)),L=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({IllegalArgumentException:o})[0],l}return o}(A),D=function(){function c(){e(this,c)}return s(c,[{key:"filter",value:function(n){}}]),c}();function F(){}function G(){}function B(){}var tt,J,H,Q,X,K,V,lt,ft=function(){function c(){e(this,c)}return s(c,null,[{key:"equalsWithTolerance",value:function(n,o,a){return Math.abs(n-o)<=a}}]),c}(),St=function(){function c(n,o){e(this,c),this.low=o||0,this.high=n||0}return s(c,null,[{key:"toBinaryString",value:function(n){var o,a="";for(o=2147483648;o>0;o>>>=1)a+=(n.high&o)===o?"1":"0";for(o=2147483648;o>0;o>>>=1)a+=(n.low&o)===o?"1":"0";return a}}]),c}();function Z(){}function pt(){}Z.NaN=NaN,Z.isNaN=function(c){return Number.isNaN(c)},Z.isInfinite=function(c){return!Number.isFinite(c)},Z.MAX_VALUE=Number.MAX_VALUE,Z.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Z.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(K=2146435072,V=new Float64Array(1),lt=new Int32Array(V.buffer),Z.doubleToLongBits=function(c){V[0]=c;var n=0|lt[0],o=0|lt[1];return(o&K)===K&&1048575&o&&n!==0&&(n=0,o=2146959360),new St(o,n)},Z.longBitsToDouble=function(c){return lt[0]=c.low,lt[1]=c.high,V[0]}):(tt=1023,J=Math.log2,H=Math.floor,Q=Math.pow,X=function(){for(var c=53;c>0;c--){var n=Q(2,c)-1;if(H(J(n))+1===c)return n}return 0}(),Z.doubleToLongBits=function(c){var n,o,a,l,d,v,E,S,w;if(c<0||1/c===Number.NEGATIVE_INFINITY?(v=1<<31,c=-c):v=0,c===0)return new St(S=v,w=0);if(c===1/0)return new St(S=2146435072|v,w=0);if(c!=c)return new St(S=2146959360,w=0);if(l=0,w=0,(n=H(c))>1)if(n<=X)(l=H(J(n)))<=20?(w=0,S=n<<20-l&1048575):(w=n%(o=Q(2,a=l-20))<<32-a,S=n/o&1048575);else for(a=n,w=0;(a=H(o=a/2))!==0;)l++,w>>>=1,w|=(1&S)<<31,S>>>=1,o!==a&&(S|=524288);if(E=l+tt,d=n===0,n=c-n,l<52&&n!==0)for(a=0;;){if((o=2*n)>=1?(n=o-1,d?(E--,d=!1):(a<<=1,a|=1,l++)):(n=o,d?--E==0&&(l++,d=!1):(a<<=1,l++)),l===20)S|=a,a=0;else if(l===52){w|=a;break}if(o===1){l<20?S|=a<<20-l:l<52&&(w|=a<<52-l);break}}return S|=E<<20,new St(S|=v,w)},Z.longBitsToDouble=function(c){var n,o,a,l,d=c.high,v=c.low,E=d&1<<31?-1:1;for(a=((2146435072&d)>>20)-tt,l=0,o=1<<19,n=1;n<=20;n++)d&o&&(l+=Q(2,-n)),o>>>=1;for(o=1<<31,n=21;n<=52;n++)v&o&&(l+=Q(2,-n)),o>>>=1;if(a===-1023){if(l===0)return 0*E;a=-1022}else{if(a===1024)return l===0?E/0:NaN;l+=1}return E*l*Q(2,a)});var vt=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({RuntimeException:o})[0],l}return o}(A),Pt=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,null,[{key:"constructor_",value:function(){if(arguments.length===0)vt.constructor_.call(this);else if(arguments.length===1){var a=arguments[0];vt.constructor_.call(this,a)}}}]),o}(vt),z=function(){function c(){e(this,c)}return s(c,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)c.shouldNeverReachHere(null);else if(arguments.length===1){var n=arguments[0];throw new Pt("Should never reach here"+(n!==null?": "+n:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var n=arguments[0];c.isTrue(n,null)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];if(!o)throw a===null?new Pt:new Pt(a)}}},{key:"equals",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];c.equals(n,o,null)}else if(arguments.length===3){var a=arguments[0],l=arguments[1],d=arguments[2];if(!l.equals(a))throw new Pt("Expected "+a+" but encountered "+l+(d!==null?": "+d:""))}}}]),c}(),ve=new ArrayBuffer(8),ws=new Float64Array(ve),Er=new Int32Array(ve),P=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getM",value:function(){return Z.NaN}},{key:"setOrdinate",value:function(n,o){switch(n){case c.X:this.x=o;break;case c.Y:this.y=o;break;case c.Z:this.setZ(o);break;default:throw new L("Invalid ordinate index: "+n)}}},{key:"equals2D",value:function(){if(arguments.length===1){var n=arguments[0];return this.x===n.x&&this.y===n.y}if(arguments.length===2){var o=arguments[0],a=arguments[1];return!!ft.equalsWithTolerance(this.x,o.x,a)&&!!ft.equalsWithTolerance(this.y,o.y,a)}}},{key:"setM",value:function(n){throw new L("Invalid ordinate index: "+c.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(n){switch(n){case c.X:return this.x;case c.Y:return this.y;case c.Z:return this.getZ()}throw new L("Invalid ordinate index: "+n)}},{key:"equals3D",value:function(n){return this.x===n.x&&this.y===n.y&&(this.getZ()===n.getZ()||Z.isNaN(this.getZ())&&Z.isNaN(n.getZ()))}},{key:"equals",value:function(n){return n instanceof c&&this.equals2D(n)}},{key:"equalInZ",value:function(n,o){return ft.equalsWithTolerance(this.getZ(),n.getZ(),o)}},{key:"setX",value:function(n){this.x=n}},{key:"compareTo",value:function(n){var o=n;return this.x<o.x?-1:this.x>o.x?1:this.y<o.y?-1:this.y>o.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(n){this.z=n}},{key:"clone",value:function(){try{return null}catch(n){if(n instanceof CloneNotSupportedException)return z.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw n}}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(n){var o=this.x-n.x,a=this.y-n.y,l=this.getZ()-n.getZ();return Math.sqrt(o*o+a*a+l*l)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(n){this.y=n}},{key:"distance",value:function(n){var o=this.x-n.x,a=this.y-n.y;return Math.sqrt(o*o+a*a)}},{key:"hashCode",value:function(){var n=17;return n=37*(n=37*n+c.hashCode(this.x))+c.hashCode(this.y)}},{key:"setCoordinate",value:function(n){this.x=n.x,this.y=n.y,this.z=n.getZ()}},{key:"interfaces_",get:function(){return[F,G,B]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)c.constructor_.call(this,0,0);else if(arguments.length===1){var n=arguments[0];c.constructor_.call(this,n.x,n.y,n.getZ())}else if(arguments.length===2){var o=arguments[0],a=arguments[1];c.constructor_.call(this,o,a,c.NULL_ORDINATE)}else if(arguments.length===3){var l=arguments[0],d=arguments[1],v=arguments[2];this.x=l,this.y=d,this.z=v}}},{key:"hashCode",value:function(n){return ws[0]=n,Er[0]^Er[1]}}]),c}(),Ml=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"compare",value:function(n,o){var a=c.compare(n.x,o.x);if(a!==0)return a;var l=c.compare(n.y,o.y);return l!==0?l:this._dimensionsToTest<=2?0:c.compare(n.getZ(),o.getZ())}},{key:"interfaces_",get:function(){return[pt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)c.constructor_.call(this,2);else if(arguments.length===1){var n=arguments[0];if(n!==2&&n!==3)throw new L("only 2 or 3 dimensions may be specified");this._dimensionsToTest=n}}},{key:"compare",value:function(n,o){return n<o?-1:n>o?1:Z.isNaN(n)?Z.isNaN(o)?0:-1:Z.isNaN(o)?1:0}}]),c}();P.DimensionalComparator=Ml,P.NULL_ORDINATE=Z.NaN,P.X=0,P.Y=1,P.Z=2,P.M=3;var Tt=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(n){if(!(n instanceof c))return!1;var o=n;return this.isNull()?o.isNull():this._maxx===o.getMaxX()&&this._maxy===o.getMaxY()&&this._minx===o.getMinX()&&this._miny===o.getMinY()}},{key:"intersection",value:function(n){if(this.isNull()||n.isNull()||!this.intersects(n))return new c;var o=this._minx>n._minx?this._minx:n._minx,a=this._miny>n._miny?this._miny:n._miny;return new c(o,this._maxx<n._maxx?this._maxx:n._maxx,a,this._maxy<n._maxy?this._maxy:n._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof P){var n=arguments[0];return this.covers(n.x,n.y)}if(arguments[0]instanceof c){var o=arguments[0];return!this.isNull()&&!o.isNull()&&o.getMinX()>=this._minx&&o.getMaxX()<=this._maxx&&o.getMinY()>=this._miny&&o.getMaxY()<=this._maxy}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];return!this.isNull()&&a>=this._minx&&a<=this._maxx&&l>=this._miny&&l<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof c){var n=arguments[0];return!this.isNull()&&!n.isNull()&&!(n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny)}if(arguments[0]instanceof P){var o=arguments[0];return this.intersects(o.x,o.y)}}else if(arguments.length===2){if(arguments[0]instanceof P&&arguments[1]instanceof P){var a=arguments[0],l=arguments[1];if(this.isNull())return!1;var d=a.x<l.x?a.x:l.x;if(d>this._maxx)return!1;var v=a.x>l.x?a.x:l.x;if(v<this._minx)return!1;var E=a.y<l.y?a.y:l.y;if(E>this._maxy)return!1;var S=a.y>l.y?a.y:l.y;return!(S<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var w=arguments[0],N=arguments[1];return!this.isNull()&&!(w>this._maxx||w<this._minx||N>this._maxy||N<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var n=this.getWidth(),o=this.getHeight();return Math.sqrt(n*n+o*o)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof P){var n=arguments[0];this.expandToInclude(n.x,n.y)}else if(arguments[0]instanceof c){var o=arguments[0];if(o.isNull())return null;this.isNull()?(this._minx=o.getMinX(),this._maxx=o.getMaxX(),this._miny=o.getMinY(),this._maxy=o.getMaxY()):(o._minx<this._minx&&(this._minx=o._minx),o._maxx>this._maxx&&(this._maxx=o._maxx),o._miny<this._miny&&(this._miny=o._miny),o._maxy>this._maxy&&(this._maxy=o._maxy))}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];this.isNull()?(this._minx=a,this._maxx=a,this._miny=l,this._maxy=l):(a<this._minx&&(this._minx=a),a>this._maxx&&(this._maxx=a),l<this._miny&&(this._miny=l),l>this._maxy&&(this._maxy=l))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var n=this.getWidth(),o=this.getHeight();return n<o?n:o}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(n){var o=n;return this.isNull()?o.isNull()?0:-1:o.isNull()?1:this._minx<o._minx?-1:this._minx>o._minx?1:this._miny<o._miny?-1:this._miny>o._miny?1:this._maxx<o._maxx?-1:this._maxx>o._maxx?1:this._maxy<o._maxy?-1:this._maxy>o._maxy?1:0}},{key:"translate",value:function(n,o){if(this.isNull())return null;this.init(this.getMinX()+n,this.getMaxX()+n,this.getMinY()+o,this.getMaxY()+o)}},{key:"copy",value:function(){return new c(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(n){return!(!this.isNull()&&!n.isNull())||n._minx>this._maxx||n._maxx<this._minx||n._miny>this._maxy||n._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var n=this.getWidth(),o=this.getHeight();return n>o?n:o}},{key:"expandBy",value:function(){if(arguments.length===1){var n=arguments[0];this.expandBy(n,n)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];if(this.isNull())return null;this._minx-=o,this._maxx+=o,this._miny-=a,this._maxy+=a,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof c){var n=arguments[0];return this.covers(n)}if(arguments[0]instanceof P){var o=arguments[0];return this.covers(o)}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];return this.covers(a,l)}}},{key:"centre",value:function(){return this.isNull()?null:new P((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof P){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof c){var o=arguments[0];this._minx=o._minx,this._maxx=o._maxx,this._miny=o._miny,this._maxy=o._maxy}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];this.init(a.x,l.x,a.y,l.y)}else if(arguments.length===4){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3];d<v?(this._minx=d,this._maxx=v):(this._minx=v,this._maxx=d),E<S?(this._miny=E,this._maxy=S):(this._miny=S,this._maxy=E)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(n){if(this.intersects(n))return 0;var o=0;this._maxx<n._minx?o=n._minx-this._maxx:this._minx>n._maxx&&(o=this._minx-n._maxx);var a=0;return this._maxy<n._miny?a=n._miny-this._maxy:this._miny>n._maxy&&(a=this._miny-n._maxy),o===0?a:a===0?o:Math.sqrt(o*o+a*a)}},{key:"hashCode",value:function(){var n=17;return n=37*(n=37*(n=37*(n=37*n+P.hashCode(this._minx))+P.hashCode(this._maxx))+P.hashCode(this._miny))+P.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[F,B]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof P){var n=arguments[0];this.init(n.x,n.x,n.y,n.y)}else if(arguments[0]instanceof c){var o=arguments[0];this.init(o)}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];this.init(a.x,l.x,a.y,l.y)}else if(arguments.length===4){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3];this.init(d,v,E,S)}}},{key:"intersects",value:function(){if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2];return a.x>=(n.x<o.x?n.x:o.x)&&a.x<=(n.x>o.x?n.x:o.x)&&a.y>=(n.y<o.y?n.y:o.y)&&a.y<=(n.y>o.y?n.y:o.y)}if(arguments.length===4){var l=arguments[0],d=arguments[1],v=arguments[2],E=arguments[3],S=Math.min(v.x,E.x),w=Math.max(v.x,E.x),N=Math.min(l.x,d.x),M=Math.max(l.x,d.x);return!(N>w)&&!(M<S)&&(S=Math.min(v.y,E.y),w=Math.max(v.y,E.y),N=Math.min(l.y,d.y),M=Math.max(l.y,d.y),!(N>w)&&!(M<S))}}}]),c}(),et=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===c.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(n){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(n){return this===n||this.equalsExact(n,0)}},{key:"geometryChanged",value:function(){this.apply(c.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(n){return n!==null&&this.norm().equalsExact(n.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var n;if(arguments.length===1){var o=arguments[0];return n=o,this.getTypeCode()!==n.getTypeCode()?this.getTypeCode()-n.getTypeCode():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(o)}if(arguments.length===2){var a=arguments[0],l=arguments[1];return n=a,this.getTypeCode()!==n.getTypeCode()?this.getTypeCode()-n.getTypeCode():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(a,l)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(n){if(n.getTypeCode()===c.TYPECODE_GEOMETRYCOLLECTION)throw new L("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(n,o,a){return a===0?n.equals(o):n.distance(o)<=a}},{key:"norm",value:function(){var n=this.copy();return n.normalize(),n}},{key:"reverse",value:function(){var n=this.reverseInternal();return this.envelope!=null&&(n.envelope=this.envelope.copy()),n.setSRID(this.getSRID()),n}},{key:"copy",value:function(){var n=this.copyInternal();return n.envelope=this._envelope==null?null:this._envelope.copy(),n._SRID=this._SRID,n._userData=this._userData,n}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Tt(this._envelope)}},{key:"setSRID",value:function(n){this._SRID=n}},{key:"setUserData",value:function(n){this._userData=n}},{key:"compare",value:function(n,o){for(var a=n.iterator(),l=o.iterator();a.hasNext()&&l.hasNext();){var d=a.next(),v=l.next(),E=d.compareTo(v);if(E!==0)return E}return a.hasNext()?1:l.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(n){return this.getClass()===n.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===c.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===c.TYPECODE_MULTIPOINT||this.getTypeCode()===c.TYPECODE_MULTILINESTRING||this.getTypeCode()===c.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[G,F,B]}},{key:"getClass",value:function(){return c}}],[{key:"hasNonEmptyElements",value:function(n){for(var o=0;o<n.length;o++)if(!n[o].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(n){for(var o=0;o<n.length;o++)if(n[o]===null)return!0;return!1}}]),c}();et.constructor_=function(c){c&&(this._envelope=null,this._userData=null,this._factory=c,this._SRID=c.getSRID())},et.TYPECODE_POINT=0,et.TYPECODE_MULTIPOINT=1,et.TYPECODE_LINESTRING=2,et.TYPECODE_LINEARRING=3,et.TYPECODE_MULTILINESTRING=4,et.TYPECODE_POLYGON=5,et.TYPECODE_MULTIPOLYGON=6,et.TYPECODE_GEOMETRYCOLLECTION=7,et.TYPENAME_POINT="Point",et.TYPENAME_MULTIPOINT="MultiPoint",et.TYPENAME_LINESTRING="LineString",et.TYPENAME_LINEARRING="LinearRing",et.TYPENAME_MULTILINESTRING="MultiLineString",et.TYPENAME_POLYGON="Polygon",et.TYPENAME_MULTIPOLYGON="MultiPolygon",et.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",et.geometryChangedFilter={get interfaces_(){return[D]},filter:function(c){c.geometryChangedAction()}};var T=function(){function c(){e(this,c)}return s(c,null,[{key:"toLocationSymbol",value:function(n){switch(n){case c.EXTERIOR:return"e";case c.BOUNDARY:return"b";case c.INTERIOR:return"i";case c.NONE:return"-"}throw new L("Unknown location value: "+n)}}]),c}();T.INTERIOR=0,T.BOUNDARY=1,T.EXTERIOR=2,T.NONE=-1;var Me=function(){function c(){e(this,c)}return s(c,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),c}(),Sr=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({NoSuchElementException:o})[0],l}return o}(A),Ue=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({UnsupportedOperationException:o})[0],l}return o}(A),ri=function(c){u(o,c);var n=x(o);function o(){return e(this,o),n.apply(this,arguments)}return s(o,[{key:"contains",value:function(){}}]),o}(Me),Mi=function(c,n){u(a,c);var o=x(a);function a(l){var d;return e(this,a),(d=o.call(this)).map=new Map,l instanceof Me&&d.addAll(l),d}return s(a,[{key:"contains",value:function(l){var d=l.hashCode?l.hashCode():l;return!!this.map.has(d)}},{key:"add",value:function(l){var d=l.hashCode?l.hashCode():l;return!this.map.has(d)&&!!this.map.set(d,l)}},{key:"addAll",value:function(l){var d,v=b(l);try{for(v.s();!(d=v.n()).done;){var E=d.value;this.add(E)}}catch(S){v.e(S)}finally{v.f()}return!0}},{key:"remove",value:function(){throw new Ue}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Ol(this.map)}},{key:n,value:function(){return this.map}}]),a}(ri,Symbol.iterator),Ol=function(){function c(n){e(this,c),this.iterator=n.values();var o=this.iterator.next(),a=o.done,l=o.value;this.done=a,this.value=l}return s(c,[{key:"next",value:function(){if(this.done)throw new Sr;var n=this.value,o=this.iterator.next(),a=o.done,l=o.value;return this.done=a,this.value=l,n}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Ue}}]),c}(),U=function(){function c(){e(this,c)}return s(c,null,[{key:"opposite",value:function(n){return n===c.LEFT?c.RIGHT:n===c.RIGHT?c.LEFT:n}}]),c}();U.ON=0,U.LEFT=1,U.RIGHT=2;var ia=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({EmptyStackException:o})[0],l}return o}(A),ks=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this,a)).name=Object.keys({IndexOutOfBoundsException:o})[0],l}return o}(A),je=function(c){u(o,c);var n=x(o);function o(){return e(this,o),n.apply(this,arguments)}return s(o,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),o}(Me),Ll=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),(a=n.call(this)).array=[],a}return s(o,[{key:"add",value:function(a){return this.array.push(a),!0}},{key:"get",value:function(a){if(a<0||a>=this.size())throw new ks;return this.array[a]}},{key:"push",value:function(a){return this.array.push(a),a}},{key:"pop",value:function(){if(this.array.length===0)throw new ia;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new ia;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(a){return this.array.indexOf(a)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),o}(je);function ht(c,n){return c.interfaces_&&c.interfaces_.indexOf(n)>-1}var Ve=function(){function c(n){e(this,c),this.str=n}return s(c,[{key:"append",value:function(n){this.str+=n}},{key:"setCharAt",value:function(n,o){this.str=this.str.substr(0,n)+o+this.str.substr(n+1)}},{key:"toString",value:function(){return this.str}}]),c}(),si=function(){function c(n){e(this,c),this.value=n}return s(c,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(n){return this.value<n?-1:this.value>n?1:0}}],[{key:"compare",value:function(n,o){return n<o?-1:n>o?1:0}},{key:"isNan",value:function(n){return Number.isNaN(n)}},{key:"valueOf",value:function(n){return new c(n)}}]),c}(),Oi=function(){function c(){e(this,c)}return s(c,null,[{key:"isWhitespace",value:function(n){return n<=32&&n>=0||n===127}},{key:"toUpperCase",value:function(n){return n.toUpperCase()}}]),c}(),st=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"le",value:function(n){return this._hi<n._hi||this._hi===n._hi&&this._lo<=n._lo}},{key:"extractSignificantDigits",value:function(n,o){var a=this.abs(),l=c.magnitude(a._hi),d=c.TEN.pow(l);(a=a.divide(d)).gt(c.TEN)?(a=a.divide(c.TEN),l+=1):a.lt(c.ONE)&&(a=a.multiply(c.TEN),l-=1);for(var v=l+1,E=new Ve,S=c.MAX_PRINT_DIGITS-1,w=0;w<=S;w++){n&&w===v&&E.append(".");var N=Math.trunc(a._hi);if(N<0)break;var M=!1,Y=0;N>9?(M=!0,Y="9"):Y="0"+N,E.append(Y),a=a.subtract(c.valueOf(N)).multiply(c.TEN),M&&a.selfAdd(c.TEN);var W=!0,q=c.magnitude(a._hi);if(q<0&&Math.abs(q)>=S-w&&(W=!1),!W)break}return o[0]=l,E.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof c){var n=arguments[0];return this.add(n.negate())}if(typeof arguments[0]=="number"){var o=arguments[0];return this.add(-o)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof c){var n=arguments[0];return this._hi===n._hi&&this._lo===n._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof c){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n._hi,-n._lo)}if(typeof arguments[0]=="number"){var o=arguments[0];return this.isNaN()?this:this.selfAdd(-o,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(n){return this.le(n)?this:n}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof c){var n=arguments[0];return this.selfDivide(n._hi,n._lo)}if(typeof arguments[0]=="number"){var o=arguments[0];return this.selfDivide(o,0)}}else if(arguments.length===2){var a=arguments[0],l=arguments[1],d=null,v=null,E=null,S=null,w=null,N=null,M=null,Y=null;return w=this._hi/a,Y=(d=(N=c.SPLIT*w)-(d=N-w))*(E=(Y=c.SPLIT*a)-(E=Y-a))-(M=w*a)+d*(S=a-E)+(v=w-d)*E+v*S,Y=w+(N=(this._hi-M-Y+this._lo-w*l)/a),this._hi=Y,this._lo=w-Y+N,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof c){var n=arguments[0],o=null,a=null,l=null,d=null,v=null,E=null,S=null,w=null;a=(v=this._hi/n._hi)-(o=(E=c.SPLIT*v)-(o=E-v)),w=o*(l=(w=c.SPLIT*n._hi)-(l=w-n._hi))-(S=v*n._hi)+o*(d=n._hi-l)+a*l+a*d;var N=w=v+(E=(this._hi-S-w+this._lo-v*n._lo)/n._hi),M=v-w+E;return new c(N,M)}if(typeof arguments[0]=="number"){var Y=arguments[0];return Z.isNaN(Y)?c.createNaN():c.copy(this).selfDivide(Y,0)}}},{key:"ge",value:function(n){return this._hi>n._hi||this._hi===n._hi&&this._lo>=n._lo}},{key:"pow",value:function(n){if(n===0)return c.valueOf(1);var o=new c(this),a=c.valueOf(1),l=Math.abs(n);if(l>1)for(;l>0;)l%2==1&&a.selfMultiply(o),(l/=2)>0&&(o=o.sqr());else a=o;return n<0?a.reciprocal():a}},{key:"ceil",value:function(){if(this.isNaN())return c.NaN;var n=Math.ceil(this._hi),o=0;return n===this._hi&&(o=Math.ceil(this._lo)),new c(n,o)}},{key:"compareTo",value:function(n){var o=n;return this._hi<o._hi?-1:this._hi>o._hi?1:this._lo<o._lo?-1:this._lo>o._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof c){var n=arguments[0];return this.init(n),this}if(typeof arguments[0]=="number"){var o=arguments[0];return this.init(o),this}}},{key:"max",value:function(n){return this.ge(n)?this:n}},{key:"sqrt",value:function(){if(this.isZero())return c.valueOf(0);if(this.isNegative())return c.NaN;var n=1/Math.sqrt(this._hi),o=this._hi*n,a=c.valueOf(o),l=this.subtract(a.sqr())._hi*(.5*n);return a.add(l)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof c){var n=arguments[0];return this.selfAdd(n._hi,n._lo)}if(typeof arguments[0]=="number"){var o=arguments[0],a=null,l=null,d=null,v=null,E=null,S=null;return v=(d=this._hi+o)-(E=d-this._hi),l=(S=(v=o-E+(this._hi-v))+this._lo)+(d-(a=d+S)),this._hi=a+l,this._lo=l+(a-this._hi),this}}else if(arguments.length===2){var w=arguments[0],N=arguments[1],M=null,Y=null,W=null,q=null,it=null,at=null,gt=null;q=this._hi+w,Y=this._lo+N,it=q-(at=q-this._hi),W=Y-(gt=Y-this._lo);var Rt=(M=q+(at=(it=w-at+(this._hi-it))+Y))+(at=(W=N-gt+(this._lo-W))+(at+(q-M))),Ft=at+(M-Rt);return this._hi=Rt,this._lo=Ft,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof c){var n=arguments[0];return this.selfMultiply(n._hi,n._lo)}if(typeof arguments[0]=="number"){var o=arguments[0];return this.selfMultiply(o,0)}}else if(arguments.length===2){var a=arguments[0],l=arguments[1],d=null,v=null,E=null,S=null,w=null,N=null;d=(w=c.SPLIT*this._hi)-this._hi,N=c.SPLIT*a,d=w-d,v=this._hi-d,E=N-a;var M=(w=this._hi*a)+(N=d*(E=N-E)-w+d*(S=a-E)+v*E+v*S+(this._hi*l+this._lo*a)),Y=N+(d=w-M);return this._hi=M,this._lo=Y,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return c.NaN;var n=Math.floor(this._hi),o=0;return n===this._hi&&(o=Math.floor(this._lo)),new c(n,o)}},{key:"negate",value:function(){return this.isNaN()?this:new c(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(n){if(n instanceof CloneNotSupportedException)return null;throw n}}},{key:"multiply",value:function(){if(arguments[0]instanceof c){var n=arguments[0];return n.isNaN()?c.createNaN():c.copy(this).selfMultiply(n)}if(typeof arguments[0]=="number"){var o=arguments[0];return Z.isNaN(o)?c.createNaN():c.copy(this).selfMultiply(o,0)}}},{key:"isNaN",value:function(){return Z.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var n=c.magnitude(this._hi);return n>=-3&&n<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var n=this.getSpecialNumberString();if(n!==null)return n;var o=new Array(1).fill(null),a=this.extractSignificantDigits(!0,o),l=o[0]+1,d=a;if(a.charAt(0)===".")d="0"+a;else if(l<0)d="0."+c.stringOfChar("0",-l)+a;else if(a.indexOf(".")===-1){var v=l-a.length;d=a+c.stringOfChar("0",v)+".0"}return this.isNegative()?"-"+d:d}},{key:"reciprocal",value:function(){var n,o,a,l,d=null,v=null,E=null,S=null;n=(a=1/this._hi)-(d=(E=c.SPLIT*a)-(d=E-a)),v=(S=c.SPLIT*this._hi)-this._hi;var w=a+(E=(1-(l=a*this._hi)-(S=d*(v=S-v)-l+d*(o=this._hi-v)+n*v+n*o)-a*this._lo)/this._hi);return new c(w,a-w+E)}},{key:"toSciNotation",value:function(){if(this.isZero())return c.SCI_NOT_ZERO;var n=this.getSpecialNumberString();if(n!==null)return n;var o=new Array(1).fill(null),a=this.extractSignificantDigits(!1,o),l=c.SCI_NOT_EXPONENT_CHAR+o[0];if(a.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+a);var d="";a.length>1&&(d=a.substring(1));var v=a.charAt(0)+"."+d;return this.isNegative()?"-"+v+l:v+l}},{key:"abs",value:function(){return this.isNaN()?c.NaN:this.isNegative()?this.negate():new c(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(n){return this._hi<n._hi||this._hi===n._hi&&this._lo<n._lo}},{key:"add",value:function(){if(arguments[0]instanceof c){var n=arguments[0];return c.copy(this).selfAdd(n)}if(typeof arguments[0]=="number"){var o=arguments[0];return c.copy(this).selfAdd(o)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this._hi=n,this._lo=0}else if(arguments[0]instanceof c){var o=arguments[0];this._hi=o._hi,this._lo=o._lo}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];this._hi=a,this._lo=l}}},{key:"gt",value:function(n){return this._hi>n._hi||this._hi===n._hi&&this._lo>n._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?c.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[B,F,G]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var n=arguments[0];this.init(n)}else if(arguments[0]instanceof c){var o=arguments[0];this.init(o)}else if(typeof arguments[0]=="string"){var a=arguments[0];c.constructor_.call(this,c.parse(a))}}else if(arguments.length===2){var l=arguments[0],d=arguments[1];this.init(l,d)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];return c.determinant(c.valueOf(n),c.valueOf(o),c.valueOf(a),c.valueOf(l))}if(arguments[3]instanceof c&&arguments[2]instanceof c&&arguments[0]instanceof c&&arguments[1]instanceof c){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3],w=d.multiply(S).selfSubtract(v.multiply(E));return w}}},{key:"sqr",value:function(n){return c.valueOf(n).selfMultiply(n)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var n=arguments[0];return c.parse(n)}if(typeof arguments[0]=="number"){var o=arguments[0];return new c(o)}}},{key:"sqrt",value:function(n){return c.valueOf(n).sqrt()}},{key:"parse",value:function(n){for(var o=0,a=n.length;Oi.isWhitespace(n.charAt(o));)o++;var l=!1;if(o<a){var d=n.charAt(o);d!=="-"&&d!=="+"||(o++,d==="-"&&(l=!0))}for(var v=new c,E=0,S=0,w=0,N=!1;!(o>=a);){var M=n.charAt(o);if(o++,Oi.isDigit(M)){var Y=M-"0";v.selfMultiply(c.TEN),v.selfAdd(Y),E++}else{if(M!=="."){if(M==="e"||M==="E"){var W=n.substring(o);try{w=si.parseInt(W)}catch(Rt){throw Rt instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+W+" in string "+n):Rt}break}throw new NumberFormatException("Unexpected character '"+M+"' at position "+o+" in string "+n)}S=E,N=!0}}var q=v;N||(S=E);var it=E-S-w;if(it===0)q=v;else if(it>0){var at=c.TEN.pow(it);q=v.divide(at)}else if(it<0){var gt=c.TEN.pow(-it);q=v.multiply(gt)}return l?q.negate():q}},{key:"createNaN",value:function(){return new c(Z.NaN,Z.NaN)}},{key:"copy",value:function(n){return new c(n)}},{key:"magnitude",value:function(n){var o=Math.abs(n),a=Math.log(o)/Math.log(10),l=Math.trunc(Math.floor(a));return 10*Math.pow(10,l)<=o&&(l+=1),l}},{key:"stringOfChar",value:function(n,o){for(var a=new Ve,l=0;l<o;l++)a.append(n);return a.toString()}}]),c}();st.PI=new st(3.141592653589793,12246467991473532e-32),st.TWO_PI=new st(6.283185307179586,24492935982947064e-32),st.PI_2=new st(1.5707963267948966,6123233995736766e-32),st.E=new st(2.718281828459045,14456468917292502e-32),st.NaN=new st(Z.NaN,Z.NaN),st.EPS=123259516440783e-46,st.SPLIT=134217729,st.MAX_PRINT_DIGITS=32,st.TEN=st.valueOf(10),st.ONE=st.valueOf(1),st.SCI_NOT_EXPONENT_CHAR="E",st.SCI_NOT_ZERO="0.0E0";var oi=function(){function c(){e(this,c)}return s(c,null,[{key:"orientationIndex",value:function(n,o,a){var l=c.orientationIndexFilter(n,o,a);if(l<=1)return l;var d=st.valueOf(o.x).selfAdd(-n.x),v=st.valueOf(o.y).selfAdd(-n.y),E=st.valueOf(a.x).selfAdd(-o.x),S=st.valueOf(a.y).selfAdd(-o.y);return d.selfMultiply(S).selfSubtract(v.selfMultiply(E)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof st&&arguments[2]instanceof st&&arguments[0]instanceof st&&arguments[1]instanceof st){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3],d=n.multiply(l).selfSubtract(o.multiply(a));return d.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var v=arguments[0],E=arguments[1],S=arguments[2],w=arguments[3],N=st.valueOf(v),M=st.valueOf(E),Y=st.valueOf(S),W=st.valueOf(w),q=N.multiply(W).selfSubtract(M.multiply(Y));return q.signum()}}},{key:"intersection",value:function(n,o,a,l){var d=new st(n.y).selfSubtract(o.y),v=new st(o.x).selfSubtract(n.x),E=new st(n.x).selfMultiply(o.y).selfSubtract(new st(o.x).selfMultiply(n.y)),S=new st(a.y).selfSubtract(l.y),w=new st(l.x).selfSubtract(a.x),N=new st(a.x).selfMultiply(l.y).selfSubtract(new st(l.x).selfMultiply(a.y)),M=v.multiply(N).selfSubtract(w.multiply(E)),Y=S.multiply(E).selfSubtract(d.multiply(N)),W=d.multiply(w).selfSubtract(S.multiply(v)),q=M.selfDivide(W).doubleValue(),it=Y.selfDivide(W).doubleValue();return Z.isNaN(q)||Z.isInfinite(q)||Z.isNaN(it)||Z.isInfinite(it)?null:new P(q,it)}},{key:"orientationIndexFilter",value:function(n,o,a){var l=null,d=(n.x-a.x)*(o.y-a.y),v=(n.y-a.y)*(o.x-a.x),E=d-v;if(d>0){if(v<=0)return c.signum(E);l=d+v}else{if(!(d<0)||v>=0)return c.signum(E);l=-d-v}var S=c.DP_SAFE_EPSILON*l;return E>=S||-E>=S?c.signum(E):2}},{key:"signum",value:function(n){return n>0?1:n<0?-1:0}}]),c}();oi.DP_SAFE_EPSILON=1e-15;var _t=function(){function c(){e(this,c)}return s(c,[{key:"getM",value:function(n){if(this.hasM()){var o=this.getDimension()-this.getMeasures();return this.getOrdinate(n,o)}return Z.NaN}},{key:"setOrdinate",value:function(n,o,a){}},{key:"getZ",value:function(n){return this.hasZ()?this.getOrdinate(n,2):Z.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(n,o){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(n){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(n){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(n){}},{key:"copy",value:function(){}},{key:"getY",value:function(n){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[G]}}]),c}();_t.X=0,_t.Y=1,_t.Z=2,_t.M=3;var ut=function(){function c(){e(this,c)}return s(c,null,[{key:"index",value:function(n,o,a){return oi.orientationIndex(n,o,a)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var n=arguments[0],o=n.length-1;if(o<3)throw new L("Ring has fewer than 4 points, so orientation cannot be determined");for(var a=n[0],l=0,d=1;d<=o;d++){var v=n[d];v.y>a.y&&(a=v,l=d)}var E=l;do(E-=1)<0&&(E=o);while(n[E].equals2D(a)&&E!==l);var S=l;do S=(S+1)%o;while(n[S].equals2D(a)&&S!==l);var w=n[E],N=n[S];if(w.equals2D(a)||N.equals2D(a)||w.equals2D(N))return!1;var M=c.index(w,a,N),Y=null;return Y=M===0?w.x>N.x:M>0,Y}if(ht(arguments[0],_t)){var W=arguments[0],q=W.size()-1;if(q<3)throw new L("Ring has fewer than 4 points, so orientation cannot be determined");for(var it=W.getCoordinate(0),at=0,gt=1;gt<=q;gt++){var Rt=W.getCoordinate(gt);Rt.y>it.y&&(it=Rt,at=gt)}var Ft=null,re=at;do(re-=1)<0&&(re=q),Ft=W.getCoordinate(re);while(Ft.equals2D(it)&&re!==at);var we=null,Je=at;do Je=(Je+1)%q,we=W.getCoordinate(Je);while(we.equals2D(it)&&Je!==at);if(Ft.equals2D(it)||we.equals2D(it)||Ft.equals2D(we))return!1;var Mn=c.index(Ft,it,we);return Mn===0?Ft.x>we.x:Mn>0}}}]),c}();ut.CLOCKWISE=-1,ut.RIGHT=ut.CLOCKWISE,ut.COUNTERCLOCKWISE=1,ut.LEFT=ut.COUNTERCLOCKWISE,ut.COLLINEAR=0,ut.STRAIGHT=ut.COLLINEAR;var ra=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(n,o){var a=this.getRightmostSideOfSegment(n,o);return a<0&&(a=this.getRightmostSideOfSegment(n,o-1)),a<0&&(this._minCoord=null,this.checkForRightmostCoordinate(n)),a}},{key:"findRightmostEdgeAtVertex",value:function(){var n=this._minDe.getEdge().getCoordinates();z.isTrue(this._minIndex>0&&this._minIndex<n.length,"rightmost point expected to be interior vertex of edge");var o=n[this._minIndex-1],a=n[this._minIndex+1],l=ut.index(this._minCoord,a,o),d=!1;(o.y<this._minCoord.y&&a.y<this._minCoord.y&&l===ut.COUNTERCLOCKWISE||o.y>this._minCoord.y&&a.y>this._minCoord.y&&l===ut.CLOCKWISE)&&(d=!0),d&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(n,o){var a=n.getEdge().getCoordinates();if(o<0||o+1>=a.length||a[o].y===a[o+1].y)return-1;var l=U.LEFT;return a[o].y<a[o+1].y&&(l=U.RIGHT),l}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(n){for(var o=n.getEdge().getCoordinates(),a=0;a<o.length-1;a++)(this._minCoord===null||o[a].x>this._minCoord.x)&&(this._minDe=n,this._minIndex=a,this._minCoord=o[a])}},{key:"findRightmostEdgeAtNode",value:function(){var n=this._minDe.getNode().getEdges();this._minDe=n.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(n){for(var o=n.iterator();o.hasNext();){var a=o.next();a.isForward()&&this.checkForRightmostCoordinate(a)}z.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===U.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),c}(),_e=function(c){u(o,c);var n=x(o);function o(a,l){var d;return e(this,o),(d=n.call(this,l?a+" [ "+l+" ]":a)).pt=l?new P(l):void 0,d.name=Object.keys({TopologyException:o})[0],d}return s(o,[{key:"getCoordinate",value:function(){return this.pt}}]),o}(vt),Al=function(){function c(){e(this,c),this.array=[]}return s(c,[{key:"addLast",value:function(n){this.array.push(n)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),c}(),ot=function(c,n){u(a,c);var o=x(a);function a(l){var d;return e(this,a),(d=o.call(this)).array=[],l instanceof Me&&d.addAll(l),d}return s(a,[{key:"interfaces_",get:function(){return[je,Me]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(l){return arguments.length===1?this.array.push(l):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(l){var d,v=b(l);try{for(v.s();!(d=v.n()).done;){var E=d.value;this.array.push(E)}}catch(S){v.e(S)}finally{v.f()}}},{key:"set",value:function(l,d){var v=this.array[l];return this.array[l]=d,v}},{key:"iterator",value:function(){return new sa(this)}},{key:"get",value:function(l){if(l<0||l>=this.size())throw new ks;return this.array[l]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(l){l?this.array.sort(function(d,v){return l.compare(d,v)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(l){for(var d=0,v=this.array.length;d<v;d++)if(this.array[d]===l)return!!this.array.splice(d,1);return!1}},{key:n,value:function(){return this.array.values()}}]),a}(je,Symbol.iterator),sa=function(){function c(n){e(this,c),this.arrayList=n,this.position=0}return s(c,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Sr;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(n){return this.arrayList.set(this.position-1,n)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),c}(),oa=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"clearVisitedEdges",value:function(){for(var n=this._dirEdgeList.iterator();n.hasNext();)n.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(n){for(var o=null,a=n.getEdges().iterator();a.hasNext();){var l=a.next();if(l.isVisited()||l.getSym().isVisited()){o=l;break}}if(o===null)throw new _e("unable to find edge to compute depths at "+n.getCoordinate());n.getEdges().computeDepths(o);for(var d=n.getEdges().iterator();d.hasNext();){var v=d.next();v.setVisited(!0),this.copySymDepths(v)}}},{key:"computeDepth",value:function(n){this.clearVisitedEdges();var o=this._finder.getEdge();o.getNode(),o.getLabel(),o.setEdgeDepths(U.RIGHT,n),this.copySymDepths(o),this.computeDepths(o)}},{key:"create",value:function(n){this.addReachable(n),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var n=this._dirEdgeList.iterator();n.hasNext();){var o=n.next();o.getDepth(U.RIGHT)>=1&&o.getDepth(U.LEFT)<=0&&!o.isInteriorAreaEdge()&&o.setInResult(!0)}}},{key:"computeDepths",value:function(n){var o=new Mi,a=new Al,l=n.getNode();for(a.addLast(l),o.add(l),n.setVisited(!0);!a.isEmpty();){var d=a.removeFirst();o.add(d),this.computeNodeDepth(d);for(var v=d.getEdges().iterator();v.hasNext();){var E=v.next().getSym();if(!E.isVisited()){var S=E.getNode();o.contains(S)||(a.addLast(S),o.add(S))}}}}},{key:"compareTo",value:function(n){var o=n;return this._rightMostCoord.x<o._rightMostCoord.x?-1:this._rightMostCoord.x>o._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var n=new Tt,o=this._dirEdgeList.iterator();o.hasNext();)for(var a=o.next().getEdge().getCoordinates(),l=0;l<a.length-1;l++)n.expandToInclude(a[l]);this._env=n}return this._env}},{key:"addReachable",value:function(n){var o=new Ll;for(o.add(n);!o.empty();){var a=o.pop();this.add(a,o)}}},{key:"copySymDepths",value:function(n){var o=n.getSym();o.setDepth(U.LEFT,n.getDepth(U.RIGHT)),o.setDepth(U.RIGHT,n.getDepth(U.LEFT))}},{key:"add",value:function(n,o){n.setVisited(!0),this._nodes.add(n);for(var a=n.getEdges().iterator();a.hasNext();){var l=a.next();this._dirEdgeList.add(l);var d=l.getSym().getNode();d.isVisited()||o.push(d)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new ot,this._nodes=new ot,this._rightMostCoord=null,this._env=null,this._finder=new ra}}]),c}(),Li=function(){function c(){e(this,c)}return s(c,null,[{key:"intersection",value:function(n,o,a,l){var d=n.x<o.x?n.x:o.x,v=n.y<o.y?n.y:o.y,E=n.x>o.x?n.x:o.x,S=n.y>o.y?n.y:o.y,w=a.x<l.x?a.x:l.x,N=a.y<l.y?a.y:l.y,M=a.x>l.x?a.x:l.x,Y=a.y>l.y?a.y:l.y,W=((d>w?d:w)+(E<M?E:M))/2,q=((v>N?v:N)+(S<Y?S:Y))/2,it=n.x-W,at=n.y-q,gt=o.x-W,Rt=o.y-q,Ft=a.x-W,re=a.y-q,we=l.x-W,Je=l.y-q,Mn=at-Rt,Gi=gt-it,Ls=it*Rt-gt*at,As=re-Je,Mr=we-Ft,qy=Ft*Je-we*re,Wy=Mn*Mr-As*Gi,Zl=(Gi*qy-Mr*Ls)/Wy,Hl=(As*Ls-Mn*qy)/Wy;return Z.isNaN(Zl)||Z.isInfinite(Zl)||Z.isNaN(Hl)||Z.isInfinite(Hl)?null:new P(Zl+W,Hl+q)}}]),c}(),oe=function(){function c(){e(this,c)}return s(c,null,[{key:"arraycopy",value:function(n,o,a,l,d){for(var v=0,E=o;E<o+d;E++)a[l+v]=n[E],v++}},{key:"getProperty",value:function(n){return{"line.separator":`
`}[n]}}]),c}(),bn=function(){function c(){e(this,c)}return s(c,null,[{key:"log10",value:function(n){var o=Math.log(n);return Z.isInfinite(o)||Z.isNaN(o)?o:o/c.LOG_10}},{key:"min",value:function(n,o,a,l){var d=n;return o<d&&(d=o),a<d&&(d=a),l<d&&(d=l),d}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],o=arguments[1],a=arguments[2];return n<o?o:n>a?a:n}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var l=arguments[0],d=arguments[1],v=arguments[2];return l<d?d:l>v?v:l}}},{key:"wrap",value:function(n,o){return n<0?o- -n%o:n%o}},{key:"max",value:function(){if(arguments.length===3){var n=arguments[0],o=arguments[1],a=arguments[2],l=n;return o>l&&(l=o),a>l&&(l=a),l}if(arguments.length===4){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3],w=d;return v>w&&(w=v),E>w&&(w=E),S>w&&(w=S),w}}},{key:"average",value:function(n,o){return(n+o)/2}}]),c}();bn.LOG_10=Math.log(10);var ie=function(){function c(){e(this,c)}return s(c,null,[{key:"segmentToSegment",value:function(n,o,a,l){if(n.equals(o))return c.pointToSegment(n,a,l);if(a.equals(l))return c.pointToSegment(l,n,o);var d=!1;if(Tt.intersects(n,o,a,l)){var v=(o.x-n.x)*(l.y-a.y)-(o.y-n.y)*(l.x-a.x);if(v===0)d=!0;else{var E=(n.y-a.y)*(l.x-a.x)-(n.x-a.x)*(l.y-a.y),S=((n.y-a.y)*(o.x-n.x)-(n.x-a.x)*(o.y-n.y))/v,w=E/v;(w<0||w>1||S<0||S>1)&&(d=!0)}}else d=!0;return d?bn.min(c.pointToSegment(n,a,l),c.pointToSegment(o,a,l),c.pointToSegment(a,n,o),c.pointToSegment(l,n,o)):0}},{key:"pointToSegment",value:function(n,o,a){if(o.x===a.x&&o.y===a.y)return n.distance(o);var l=(a.x-o.x)*(a.x-o.x)+(a.y-o.y)*(a.y-o.y),d=((n.x-o.x)*(a.x-o.x)+(n.y-o.y)*(a.y-o.y))/l;if(d<=0)return n.distance(o);if(d>=1)return n.distance(a);var v=((o.y-n.y)*(a.x-o.x)-(o.x-n.x)*(a.y-o.y))/l;return Math.abs(v)*Math.sqrt(l)}},{key:"pointToLinePerpendicular",value:function(n,o,a){var l=(a.x-o.x)*(a.x-o.x)+(a.y-o.y)*(a.y-o.y),d=((o.y-n.y)*(a.x-o.x)-(o.x-n.x)*(a.y-o.y))/l;return Math.abs(d)*Math.sqrt(l)}},{key:"pointToSegmentString",value:function(n,o){if(o.length===0)throw new L("Line array must contain at least one vertex");for(var a=n.distance(o[0]),l=0;l<o.length-1;l++){var d=c.pointToSegment(n,o[l],o[l+1]);d<a&&(a=d)}return a}}]),c}(),ai=function(){function c(){e(this,c)}return s(c,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||ht(arguments[0],_t);else if(arguments.length!==2){if(arguments.length===3){var n=arguments[0],o=arguments[1];return this.create(n,o)}}}}]),c}(),hn=function(){function c(){e(this,c)}return s(c,[{key:"filter",value:function(n){}}]),c}(),aa=function(){function c(){e(this,c)}return s(c,null,[{key:"ofLine",value:function(n){var o=n.size();if(o<=1)return 0;var a=0,l=new P;n.getCoordinate(0,l);for(var d=l.x,v=l.y,E=1;E<o;E++){n.getCoordinate(E,l);var S=l.x,w=l.y,N=S-d,M=w-v;a+=Math.sqrt(N*N+M*M),d=S,v=w}return a}}]),c}(),Cs=function c(){e(this,c)},Yt=function(){function c(){e(this,c)}return s(c,null,[{key:"copyCoord",value:function(n,o,a,l){for(var d=Math.min(n.getDimension(),a.getDimension()),v=0;v<d;v++)a.setOrdinate(l,v,n.getOrdinate(o,v))}},{key:"isRing",value:function(n){var o=n.size();return o===0||!(o<=3)&&n.getOrdinate(0,_t.X)===n.getOrdinate(o-1,_t.X)&&n.getOrdinate(0,_t.Y)===n.getOrdinate(o-1,_t.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(ht(arguments[0],_t)&&Number.isInteger(arguments[1])){var n=arguments[0],o=arguments[1];c.scroll(n,o,c.isRing(n))}else if(ht(arguments[0],_t)&&arguments[1]instanceof P){var a=arguments[0],l=arguments[1],d=c.indexOf(l,a);if(d<=0)return null;c.scroll(a,d)}}else if(arguments.length===3){var v=arguments[0],E=arguments[1],S=arguments[2],w=E;if(w<=0)return null;for(var N=v.copy(),M=S?v.size()-1:v.size(),Y=0;Y<M;Y++)for(var W=0;W<v.getDimension();W++)v.setOrdinate(Y,W,N.getOrdinate((E+Y)%M,W));if(S)for(var q=0;q<v.getDimension();q++)v.setOrdinate(M,q,v.getOrdinate(0,q))}}},{key:"isEqual",value:function(n,o){var a=n.size();if(a!==o.size())return!1;for(var l=Math.min(n.getDimension(),o.getDimension()),d=0;d<a;d++)for(var v=0;v<l;v++){var E=n.getOrdinate(d,v),S=o.getOrdinate(d,v);if(n.getOrdinate(d,v)!==o.getOrdinate(d,v)&&(!Z.isNaN(E)||!Z.isNaN(S)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var n=arguments[0];return c.minCoordinateIndex(n,0,n.size()-1)}if(arguments.length===3){for(var o=arguments[0],a=arguments[1],l=arguments[2],d=-1,v=null,E=a;E<=l;E++){var S=o.getCoordinate(E);(v===null||v.compareTo(S)>0)&&(v=S,d=E)}return d}}},{key:"extend",value:function(n,o,a){var l=n.create(a,o.getDimension()),d=o.size();if(c.copy(o,0,l,0,d),d>0)for(var v=d;v<a;v++)c.copy(o,d-1,l,v,1);return l}},{key:"reverse",value:function(n){for(var o=n.size()-1,a=Math.trunc(o/2),l=0;l<=a;l++)c.swap(n,l,o-l)}},{key:"swap",value:function(n,o,a){if(o===a)return null;for(var l=0;l<n.getDimension();l++){var d=n.getOrdinate(o,l);n.setOrdinate(o,l,n.getOrdinate(a,l)),n.setOrdinate(a,l,d)}}},{key:"copy",value:function(n,o,a,l,d){for(var v=0;v<d;v++)c.copyCoord(n,o+v,a,l+v)}},{key:"ensureValidRing",value:function(n,o){var a=o.size();return a===0?o:a<=3?c.createClosedRing(n,o,4):o.getOrdinate(0,_t.X)===o.getOrdinate(a-1,_t.X)&&o.getOrdinate(0,_t.Y)===o.getOrdinate(a-1,_t.Y)?o:c.createClosedRing(n,o,a+1)}},{key:"indexOf",value:function(n,o){for(var a=0;a<o.size();a++)if(n.x===o.getOrdinate(a,_t.X)&&n.y===o.getOrdinate(a,_t.Y))return a;return-1}},{key:"createClosedRing",value:function(n,o,a){var l=n.create(a,o.getDimension()),d=o.size();c.copy(o,0,l,0,d);for(var v=d;v<a;v++)c.copy(o,0,l,v,1);return l}},{key:"minCoordinate",value:function(n){for(var o=null,a=0;a<n.size();a++){var l=n.getCoordinate(a);(o===null||o.compareTo(l)>0)&&(o=l)}return o}}]),c}(),j=function(){function c(){e(this,c)}return s(c,null,[{key:"toDimensionSymbol",value:function(n){switch(n){case c.FALSE:return c.SYM_FALSE;case c.TRUE:return c.SYM_TRUE;case c.DONTCARE:return c.SYM_DONTCARE;case c.P:return c.SYM_P;case c.L:return c.SYM_L;case c.A:return c.SYM_A}throw new L("Unknown dimension value: "+n)}},{key:"toDimensionValue",value:function(n){switch(Oi.toUpperCase(n)){case c.SYM_FALSE:return c.FALSE;case c.SYM_TRUE:return c.TRUE;case c.SYM_DONTCARE:return c.DONTCARE;case c.SYM_P:return c.P;case c.SYM_L:return c.L;case c.SYM_A:return c.A}throw new L("Unknown dimension symbol: "+n)}}]),c}();j.P=0,j.L=1,j.A=2,j.FALSE=-1,j.TRUE=-2,j.DONTCARE=-3,j.SYM_FALSE="F",j.SYM_TRUE="T",j.SYM_DONTCARE="*",j.SYM_P="0",j.SYM_L="1",j.SYM_A="2";var Ht=function(){function c(){e(this,c)}return s(c,[{key:"filter",value:function(n){}}]),c}(),ae=function(){function c(){e(this,c)}return s(c,[{key:"filter",value:function(n,o){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),c}(),Ut=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Tt:this._points.expandEnvelope(new Tt)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];if(!this.isEquivalentClass(a))return!1;var d=a;if(this._points.size()!==d._points.size())return!1;for(var v=0;v<this._points.size();v++)if(!this.equal(this._points.getCoordinate(v),d._points.getCoordinate(v),l))return!1;return!0}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<Math.trunc(this._points.size()/2);a++){var l=this._points.size()-1-a;if(!this._points.getCoordinate(a).equals(this._points.getCoordinate(l))){if(this._points.getCoordinate(a).compareTo(this._points.getCoordinate(l))>0){var d=this._points.copy();Yt.reverse(d),this._points=d}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?j.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var a=this._points.copy();return Yt.reverse(a),this.getFactory().createLineString(a)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return et.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return aa.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var a=arguments[0],l=a,d=0,v=0;d<this._points.size()&&v<l._points.size();){var E=this._points.getCoordinate(d).compareTo(l._points.getCoordinate(v));if(E!==0)return E;d++,v++}return d<this._points.size()?1:v<l._points.size()?-1:0}if(arguments.length===2){var S=arguments[0],w=arguments[1],N=S;return w.compare(this._points,N._points)}}},{key:"apply",value:function(){if(ht(arguments[0],hn))for(var a=arguments[0],l=0;l<this._points.size();l++)a.filter(this._points.getCoordinate(l));else if(ht(arguments[0],ae)){var d=arguments[0];if(this._points.size()===0)return null;for(var v=0;v<this._points.size()&&(d.filter(this._points,v),!d.isDone());v++);d.isGeometryChanged()&&this.geometryChanged()}else if(ht(arguments[0],Ht)){var E=arguments[0];E.filter(this)}else if(ht(arguments[0],D)){var S=arguments[0];S.filter(this)}}},{key:"getBoundary",value:function(){throw new Ue}},{key:"isEquivalentClass",value:function(a){return a instanceof o}},{key:"getCoordinateN",value:function(a){return this._points.getCoordinate(a)}},{key:"getGeometryType",value:function(){return et.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(a){if(a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),a.size()===1)throw new L("Invalid number of points in LineString (found "+a.size()+" - must be 0 or >= 2)");this._points=a}},{key:"isCoordinate",value:function(a){for(var l=0;l<this._points.size();l++)if(this._points.getCoordinate(l).equals(a))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(a){return this.getFactory().createPoint(this._points.getCoordinate(a))}},{key:"interfaces_",get:function(){return[Cs]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],l=arguments[1];et.constructor_.call(this,l),this.init(a)}}}}]),o}(et),Oe=function c(){e(this,c)},xe=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Tt;var a=new Tt;return a.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),a}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new o(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];return!!this.isEquivalentClass(a)&&(!(!this.isEmpty()||!a.isEmpty())||this.isEmpty()===a.isEmpty()&&this.equal(a.getCoordinate(),this.getCoordinate(),l))}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return j.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return et.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],l=a;return this.getCoordinate().compareTo(l.getCoordinate())}if(arguments.length===2){var d=arguments[0],v=arguments[1],E=d;return v.compare(this._coordinates,E._coordinates)}}},{key:"apply",value:function(){if(ht(arguments[0],hn)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this.getCoordinate())}else if(ht(arguments[0],ae)){var l=arguments[0];if(this.isEmpty())return null;l.filter(this._coordinates,0),l.isGeometryChanged()&&this.geometryChanged()}else if(ht(arguments[0],Ht)){var d=arguments[0];d.filter(this)}else if(ht(arguments[0],D)){var v=arguments[0];v.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return et.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(a){a===null&&(a=this.getFactory().getCoordinateSequenceFactory().create([])),z.isTrue(a.size()<=1),this._coordinates=a}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Oe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var a=arguments[0],l=arguments[1];et.constructor_.call(this,l),this.init(a)}}]),o}(et),Mt=function(){function c(){e(this,c)}return s(c,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var n=arguments[0];return Math.abs(c.ofRingSigned(n))}if(ht(arguments[0],_t)){var o=arguments[0];return Math.abs(c.ofRingSigned(o))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var n=arguments[0];if(n.length<3)return 0;for(var o=0,a=n[0].x,l=1;l<n.length-1;l++){var d=n[l].x-a,v=n[l+1].y,E=n[l-1].y;o+=d*(E-v)}return o/2}if(ht(arguments[0],_t)){var S=arguments[0],w=S.size();if(w<3)return 0;var N=new P,M=new P,Y=new P;S.getCoordinate(0,M),S.getCoordinate(1,Y);var W=M.x;Y.x-=W;for(var q=0,it=1;it<w-1;it++)N.y=M.y,M.x=Y.x,M.y=Y.y,S.getCoordinate(it+1,Y),Y.x-=W,q+=M.x*(N.y-Y.y);return q/2}}}]),c}(),Dt=function(){function c(){e(this,c)}return s(c,null,[{key:"sort",value:function(){var n=arguments,o=arguments[0];if(arguments.length===1)o.sort(function(W,q){return W.compareTo(q)});else if(arguments.length===2)o.sort(function(W,q){return n[1].compare(W,q)});else if(arguments.length===3){var a=o.slice(arguments[1],arguments[2]);a.sort();var l=o.slice(0,arguments[1]).concat(a,o.slice(arguments[2],o.length));o.splice(0,o.length);var d,v=b(l);try{for(v.s();!(d=v.n()).done;){var E=d.value;o.push(E)}}catch(W){v.e(W)}finally{v.f()}}else if(arguments.length===4){var S=o.slice(arguments[1],arguments[2]);S.sort(function(W,q){return n[3].compare(W,q)});var w=o.slice(0,arguments[1]).concat(S,o.slice(arguments[2],o.length));o.splice(0,o.length);var N,M=b(w);try{for(M.s();!(N=M.n()).done;){var Y=N.value;o.push(Y)}}catch(W){M.e(W)}finally{M.f()}}}},{key:"asList",value:function(n){var o,a=new ot,l=b(n);try{for(l.s();!(o=l.n()).done;){var d=o.value;a.add(d)}}catch(v){l.e(v)}finally{l.f()}return a}},{key:"copyOf",value:function(n,o){return n.slice(0,o)}}]),c}(),Le=function c(){e(this,c)},Ir=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),l=-1,d=this._shell.getCoordinates(),v=0;v<d.length;v++)a[++l]=d[v];for(var E=0;E<this._holes.length;E++)for(var S=this._holes[E].getCoordinates(),w=0;w<S.length;w++)a[++l]=S[w];return a}},{key:"getArea",value:function(){var a=0;a+=Mt.ofRing(this._shell.getCoordinateSequence());for(var l=0;l<this._holes.length;l++)a-=Mt.ofRing(this._holes[l].getCoordinateSequence());return a}},{key:"copyInternal",value:function(){for(var a=this._shell.copy(),l=new Array(this._holes.length).fill(null),d=0;d<this._holes.length;d++)l[d]=this._holes[d].copy();return new o(a,l,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var a=this._shell.getCoordinateSequence(),l=this.getEnvelopeInternal(),d=0;d<5;d++){var v=a.getX(d);if(v!==l.getMinX()&&v!==l.getMaxX())return!1;var E=a.getY(d);if(E!==l.getMinY()&&E!==l.getMaxY())return!1}for(var S=a.getX(0),w=a.getY(0),N=1;N<=4;N++){var M=a.getX(N),Y=a.getY(N);if(M!==S==(Y!==w))return!1;S=M,w=Y}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];if(!this.isEquivalentClass(a))return!1;var d=a,v=this._shell,E=d._shell;if(!v.equalsExact(E,l)||this._holes.length!==d._holes.length)return!1;for(var S=0;S<this._holes.length;S++)if(!this._holes[S].equalsExact(d._holes[S],l))return!1;return!0}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var a=0;a<this._holes.length;a++)this._holes[a]=this.normalized(this._holes[a],!1);Dt.sort(this._holes)}else if(arguments.length===2){var l=arguments[0],d=arguments[1];if(l.isEmpty())return null;var v=l.getCoordinateSequence(),E=Yt.minCoordinateIndex(v,0,v.size()-2);Yt.scroll(v,E,!0),ut.isCCW(v)===d&&Yt.reverse(v)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var a=this.getExteriorRing().reverse(),l=new Array(this.getNumInteriorRing()).fill(null),d=0;d<l.length;d++)l[d]=this.getInteriorRingN(d).reverse();return this.getFactory().createPolygon(a,l)}},{key:"getTypeCode",value:function(){return et.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var a=0;a+=this._shell.getLength();for(var l=0;l<this._holes.length;l++)a+=this._holes[l].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=this._shell.getNumPoints(),l=0;l<this._holes.length;l++)a+=this._holes[l].getNumPoints();return a}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(a,l){var d=a.copy();return this.normalize(d,l),d}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],l=this._shell,d=a._shell;return l.compareToSameClass(d)}if(arguments.length===2){var v=arguments[0],E=arguments[1],S=v,w=this._shell,N=S._shell,M=w.compareToSameClass(N,E);if(M!==0)return M;for(var Y=this.getNumInteriorRing(),W=S.getNumInteriorRing(),q=0;q<Y&&q<W;){var it=this.getInteriorRingN(q),at=S.getInteriorRingN(q),gt=it.compareToSameClass(at,E);if(gt!==0)return gt;q++}return q<Y?1:q<W?-1:0}}},{key:"apply",value:function(){if(ht(arguments[0],hn)){var a=arguments[0];this._shell.apply(a);for(var l=0;l<this._holes.length;l++)this._holes[l].apply(a)}else if(ht(arguments[0],ae)){var d=arguments[0];if(this._shell.apply(d),!d.isDone())for(var v=0;v<this._holes.length&&(this._holes[v].apply(d),!d.isDone());v++);d.isGeometryChanged()&&this.geometryChanged()}else if(ht(arguments[0],Ht)){var E=arguments[0];E.filter(this)}else if(ht(arguments[0],D)){var S=arguments[0];S.filter(this),this._shell.apply(S);for(var w=0;w<this._holes.length;w++)this._holes[w].apply(S)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var l=0;l<this._holes.length;l++)a[l+1]=this._holes[l];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)}},{key:"getGeometryType",value:function(){return et.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(a){return this._holes[a]}},{key:"interfaces_",get:function(){return[Le]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var a=arguments[0],l=arguments[1],d=arguments[2];if(et.constructor_.call(this,d),a===null&&(a=this.getFactory().createLinearRing()),l===null&&(l=[]),et.hasNullElements(l))throw new L("holes must not contain null elements");if(a.isEmpty()&&et.hasNonEmptyElements(l))throw new L("shell is empty but holes are not");this._shell=a,this._holes=l}}]),o}(et),KI=function(c){u(o,c);var n=x(o);function o(){return e(this,o),n.apply(this,arguments)}return o}(ri),hy=function(c){u(o,c);var n=x(o);function o(a){var l;return e(this,o),(l=n.call(this)).array=[],a instanceof Me&&l.addAll(a),l}return s(o,[{key:"contains",value:function(a){var l,d=b(this.array);try{for(d.s();!(l=d.n()).done;)if(l.value.compareTo(a)===0)return!0}catch(v){d.e(v)}finally{d.f()}return!1}},{key:"add",value:function(a){if(this.contains(a))return!1;for(var l=0,d=this.array.length;l<d;l++)if(this.array[l].compareTo(a)===1)return!!this.array.splice(l,0,a);return this.array.push(a),!0}},{key:"addAll",value:function(a){var l,d=b(a);try{for(d.s();!(l=d.n()).done;){var v=l.value;this.add(v)}}catch(E){d.e(E)}finally{d.f()}return!0}},{key:"remove",value:function(){throw new Ue}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new QI(this.array)}}]),o}(KI),QI=function(){function c(n){e(this,c),this.array=n,this.position=0}return s(c,[{key:"next",value:function(){if(this.position===this.array.length)throw new Sr;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Ue}}]),c}(),Ee=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"computeEnvelopeInternal",value:function(){for(var a=new Tt,l=0;l<this._geometries.length;l++)a.expandToInclude(this._geometries[l].getEnvelopeInternal());return a}},{key:"getGeometryN",value:function(a){return this._geometries[a]}},{key:"getCoordinates",value:function(){for(var a=new Array(this.getNumPoints()).fill(null),l=-1,d=0;d<this._geometries.length;d++)for(var v=this._geometries[d].getCoordinates(),E=0;E<v.length;E++)a[++l]=v[E];return a}},{key:"getArea",value:function(){for(var a=0,l=0;l<this._geometries.length;l++)a+=this._geometries[l].getArea();return a}},{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),l=0;l<a.length;l++)a[l]=this._geometries[l].copy();return new o(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];if(!this.isEquivalentClass(a))return!1;var d=a;if(this._geometries.length!==d._geometries.length)return!1;for(var v=0;v<this._geometries.length;v++)if(!this._geometries[v].equalsExact(d._geometries[v],l))return!1;return!0}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var a=0;a<this._geometries.length;a++)this._geometries[a].normalize();Dt.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var a=j.FALSE,l=0;l<this._geometries.length;l++)a=Math.max(a,this._geometries[l].getBoundaryDimension());return a}},{key:"reverseInternal",value:function(){for(var a=this._geometries.length,l=new ot(a),d=0;d<a;d++)l.add(this._geometries[d].reverse());return this.getFactory().buildGeometry(l)}},{key:"getTypeCode",value:function(){return et.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var a=j.FALSE,l=0;l<this._geometries.length;l++)a=Math.max(a,this._geometries[l].getDimension());return a}},{key:"getLength",value:function(){for(var a=0,l=0;l<this._geometries.length;l++)a+=this._geometries[l].getLength();return a}},{key:"getNumPoints",value:function(){for(var a=0,l=0;l<this._geometries.length;l++)a+=this._geometries[l].getNumPoints();return a}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var a=arguments[0],l=new hy(Dt.asList(this._geometries)),d=new hy(Dt.asList(a._geometries));return this.compare(l,d)}if(arguments.length===2){for(var v=arguments[0],E=arguments[1],S=v,w=this.getNumGeometries(),N=S.getNumGeometries(),M=0;M<w&&M<N;){var Y=this.getGeometryN(M),W=S.getGeometryN(M),q=Y.compareToSameClass(W,E);if(q!==0)return q;M++}return M<w?1:M<N?-1:0}}},{key:"apply",value:function(){if(ht(arguments[0],hn))for(var a=arguments[0],l=0;l<this._geometries.length;l++)this._geometries[l].apply(a);else if(ht(arguments[0],ae)){var d=arguments[0];if(this._geometries.length===0)return null;for(var v=0;v<this._geometries.length&&(this._geometries[v].apply(d),!d.isDone());v++);d.isGeometryChanged()&&this.geometryChanged()}else if(ht(arguments[0],Ht)){var E=arguments[0];E.filter(this);for(var S=0;S<this._geometries.length;S++)this._geometries[S].apply(E)}else if(ht(arguments[0],D)){var w=arguments[0];w.filter(this);for(var N=0;N<this._geometries.length;N++)this._geometries[N].apply(w)}}},{key:"getBoundary",value:function(){return et.checkNotGeometryCollection(this),z.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return et.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var a=arguments[0],l=arguments[1];if(et.constructor_.call(this,l),a===null&&(a=[]),et.hasNullElements(a))throw new L("geometries must not contain null elements");this._geometries=a}}}}]),o}(et),Pl=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),l=0;l<a.length;l++)a[l]=this._geometries[l].copy();return new o(a,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];return!!this.isEquivalentClass(a)&&I(h(o.prototype),"equalsExact",this).call(this,a,l)}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var a=arguments[0];return this._geometries[a].getCoordinate()}return I(h(o.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return j.FALSE}},{key:"getTypeCode",value:function(){return et.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return et.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Oe]}}],[{key:"constructor_",value:function(){var a=arguments[0],l=arguments[1];Ee.constructor_.call(this,a,l)}}]),o}(Ee),Rs=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return j.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||I(h(o.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var a=this._points.copy();return Yt.reverse(a),this.getFactory().createLinearRing(a)}},{key:"getTypeCode",value:function(){return et.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!I(h(o.prototype),"isClosed",this).call(this))throw new L("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<o.MINIMUM_VALID_SIZE)throw new L("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return et.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var a=arguments[0],l=arguments[1];Ut.constructor_.call(this,a,l),this.validateConstruction()}}]),o}(Ut);Rs.MINIMUM_VALID_SIZE=4;var Ai=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"setOrdinate",value:function(a,l){switch(a){case o.X:this.x=l;break;case o.Y:this.y=l;break;default:throw new L("Invalid ordinate index: "+a)}}},{key:"getZ",value:function(){return P.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case o.X:return this.x;case o.Y:return this.y}throw new L("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new L("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)P.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof o){var a=arguments[0];P.constructor_.call(this,a.x,a.y)}else if(arguments[0]instanceof P){var l=arguments[0];P.constructor_.call(this,l.x,l.y)}}else if(arguments.length===2){var d=arguments[0],v=arguments[1];P.constructor_.call(this,d,v,P.NULL_ORDINATE)}}}]),o}(P);Ai.X=0,Ai.Y=1,Ai.Z=-1,Ai.M=-1;var Pi=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,l){switch(a){case o.X:this.x=l;break;case o.Y:this.y=l;break;case o.M:this._m=l;break;default:throw new L("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getZ",value:function(){return P.NULL_ORDINATE}},{key:"getOrdinate",value:function(a){switch(a){case o.X:return this.x;case o.Y:return this.y;case o.M:return this._m}throw new L("Invalid ordinate index: "+a)}},{key:"setZ",value:function(a){throw new L("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)P.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var a=arguments[0];P.constructor_.call(this,a.x,a.y),this._m=a._m}else if(arguments[0]instanceof P){var l=arguments[0];P.constructor_.call(this,l.x,l.y),this._m=this.getM()}}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];P.constructor_.call(this,d,v,P.NULL_ORDINATE),this._m=E}}}]),o}(P);Pi.X=0,Pi.Y=1,Pi.Z=-1,Pi.M=2;var Dl=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(a,l){switch(a){case P.X:this.x=l;break;case P.Y:this.y=l;break;case P.Z:this.z=l;break;case P.M:this._m=l;break;default:throw new L("Invalid ordinate index: "+a)}}},{key:"setM",value:function(a){this._m=a}},{key:"getOrdinate",value:function(a){switch(a){case P.X:return this.x;case P.Y:return this.y;case P.Z:return this.getZ();case P.M:return this.getM()}throw new L("Invalid ordinate index: "+a)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(a){this.x=a.x,this.y=a.y,this.z=a.getZ(),this._m=a.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)P.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var a=arguments[0];P.constructor_.call(this,a),this._m=a._m}else if(arguments[0]instanceof P){var l=arguments[0];P.constructor_.call(this,l),this._m=this.getM()}}else if(arguments.length===4){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3];P.constructor_.call(this,d,v,E),this._m=S}}}]),o}(P),ua=function(){function c(){e(this,c)}return s(c,null,[{key:"measures",value:function(n){return n instanceof Ai?0:n instanceof Pi||n instanceof Dl?1:0}},{key:"dimension",value:function(n){return n instanceof Ai?2:n instanceof Pi?3:n instanceof Dl?4:3}},{key:"create",value:function(){if(arguments.length===1){var n=arguments[0];return c.create(n,0)}if(arguments.length===2){var o=arguments[0],a=arguments[1];return o===2?new Ai:o===3&&a===0?new P:o===3&&a===1?new Pi:o===4&&a===1?new Dl:new P}}}]),c}(),bs=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"getCoordinate",value:function(a){return this.get(a)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&ht(arguments[0],Me)){for(var a=arguments[0],l=arguments[1],d=!1,v=a.iterator();v.hasNext();)this.add(v.next(),l),d=!0;return d}return I(h(o.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var a=I(h(o.prototype),"clone",this).call(this),l=0;l<this.size();l++)a.add(l,this.get(l).clone());return a}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(o.coordArrayType);if(arguments.length===1){var a=arguments[0];if(a)return this.toArray(o.coordArrayType);for(var l=this.size(),d=new Array(l).fill(null),v=0;v<l;v++)d[v]=this.get(l-v-1);return d}}},{key:"add",value:function(){if(arguments.length===1){var a=arguments[0];return I(h(o.prototype),"add",this).call(this,a)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var l=arguments[0],d=arguments[1];return this.add(l,d,!0),!0}if(arguments[0]instanceof P&&typeof arguments[1]=="boolean"){var v=arguments[0],E=arguments[1];if(!E&&this.size()>=1){var S=this.get(this.size()-1);if(S.equals2D(v))return null}I(h(o.prototype),"add",this).call(this,v)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var w=arguments[0],N=arguments[1];return this.add(w,N),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var M=arguments[0],Y=arguments[1],W=arguments[2];if(W)for(var q=0;q<M.length;q++)this.add(M[q],Y);else for(var it=M.length-1;it>=0;it--)this.add(M[it],Y);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof P){var at=arguments[0],gt=arguments[1],Rt=arguments[2];if(!Rt){var Ft=this.size();if(Ft>0){if(at>0){var re=this.get(at-1);if(re.equals2D(gt))return null}if(at<Ft){var we=this.get(at);if(we.equals2D(gt))return null}}}I(h(o.prototype),"add",this).call(this,at,gt)}}else if(arguments.length===4){var Je=arguments[0],Mn=arguments[1],Gi=arguments[2],Ls=arguments[3],As=1;Gi>Ls&&(As=-1);for(var Mr=Gi;Mr!==Ls;Mr+=As)this.add(Je[Mr],Mn);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var a=this.get(0).copy();this.add(a,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var a=arguments[0];this.ensureCapacity(a.length),this.add(a,!0)}else if(arguments.length===2){var l=arguments[0],d=arguments[1];this.ensureCapacity(l.length),this.add(l,d)}}}}]),o}(ot);bs.coordArrayType=new Array(0).fill(null);var zt=function(){function c(){e(this,c)}return s(c,null,[{key:"isRing",value:function(n){return!(n.length<4)&&!!n[0].equals2D(n[n.length-1])}},{key:"ptNotInList",value:function(n,o){for(var a=0;a<n.length;a++){var l=n[a];if(c.indexOf(l,o)<0)return l}return null}},{key:"scroll",value:function(n,o){var a=c.indexOf(o,n);if(a<0)return null;var l=new Array(n.length).fill(null);oe.arraycopy(n,a,l,0,n.length-a),oe.arraycopy(n,0,l,n.length-a,a),oe.arraycopy(l,0,n,0,n.length)}},{key:"equals",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];if(n===o)return!0;if(n===null||o===null||n.length!==o.length)return!1;for(var a=0;a<n.length;a++)if(!n[a].equals(o[a]))return!1;return!0}if(arguments.length===3){var l=arguments[0],d=arguments[1],v=arguments[2];if(l===d)return!0;if(l===null||d===null||l.length!==d.length)return!1;for(var E=0;E<l.length;E++)if(v.compare(l[E],d[E])!==0)return!1;return!0}}},{key:"intersection",value:function(n,o){for(var a=new bs,l=0;l<n.length;l++)o.intersects(n[l])&&a.add(n[l],!0);return a.toCoordinateArray()}},{key:"measures",value:function(n){if(n===null||n.length===0)return 0;var o,a=0,l=b(n);try{for(l.s();!(o=l.n()).done;){var d=o.value;a=Math.max(a,ua.measures(d))}}catch(v){l.e(v)}finally{l.f()}return a}},{key:"hasRepeatedPoints",value:function(n){for(var o=1;o<n.length;o++)if(n[o-1].equals(n[o]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(n){return c.hasRepeatedPoints(n)?new bs(n,!1).toCoordinateArray():n}},{key:"reverse",value:function(n){for(var o=n.length-1,a=Math.trunc(o/2),l=0;l<=a;l++){var d=n[l];n[l]=n[o-l],n[o-l]=d}}},{key:"removeNull",value:function(n){for(var o=0,a=0;a<n.length;a++)n[a]!==null&&o++;var l=new Array(o).fill(null);if(o===0)return l;for(var d=0,v=0;v<n.length;v++)n[v]!==null&&(l[d++]=n[v]);return l}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var n=arguments[0],o=new Array(n.length).fill(null),a=0;a<n.length;a++)o[a]=n[a].copy();return o}if(arguments.length===5)for(var l=arguments[0],d=arguments[1],v=arguments[2],E=arguments[3],S=arguments[4],w=0;w<S;w++)v[E+w]=l[d+w].copy()}},{key:"isEqualReversed",value:function(n,o){for(var a=0;a<n.length;a++){var l=n[a],d=o[n.length-a-1];if(l.compareTo(d)!==0)return!1}return!0}},{key:"envelope",value:function(n){for(var o=new Tt,a=0;a<n.length;a++)o.expandToInclude(n[a]);return o}},{key:"toCoordinateArray",value:function(n){return n.toArray(c.coordArrayType)}},{key:"dimension",value:function(n){if(n===null||n.length===0)return 3;var o,a=0,l=b(n);try{for(l.s();!(o=l.n()).done;){var d=o.value;a=Math.max(a,ua.dimension(d))}}catch(v){l.e(v)}finally{l.f()}return a}},{key:"atLeastNCoordinatesOrNothing",value:function(n,o){return o.length>=n?o:[]}},{key:"indexOf",value:function(n,o){for(var a=0;a<o.length;a++)if(n.equals(o[a]))return a;return-1}},{key:"increasingDirection",value:function(n){for(var o=0;o<Math.trunc(n.length/2);o++){var a=n.length-1-o,l=n[o].compareTo(n[a]);if(l!==0)return l}return 1}},{key:"compare",value:function(n,o){for(var a=0;a<n.length&&a<o.length;){var l=n[a].compareTo(o[a]);if(l!==0)return l;a++}return a<o.length?-1:a<n.length?1:0}},{key:"minCoordinate",value:function(n){for(var o=null,a=0;a<n.length;a++)(o===null||o.compareTo(n[a])>0)&&(o=n[a]);return o}},{key:"extract",value:function(n,o,a){o=bn.clamp(o,0,n.length);var l=(a=bn.clamp(a,-1,n.length))-o+1;a<0&&(l=0),o>=n.length&&(l=0),a<o&&(l=0);var d=new Array(l).fill(null);if(l===0)return d;for(var v=0,E=o;E<=a;E++)d[v++]=n[E];return d}}]),c}(),tw=function(){function c(){e(this,c)}return s(c,[{key:"compare",value:function(n,o){var a=n,l=o;return zt.compare(a,l)}},{key:"interfaces_",get:function(){return[pt]}}]),c}(),ew=function(){function c(){e(this,c)}return s(c,[{key:"compare",value:function(n,o){var a=n,l=o;if(a.length<l.length)return-1;if(a.length>l.length)return 1;if(a.length===0)return 0;var d=zt.compare(a,l);return zt.isEqualReversed(a,l)?0:d}},{key:"OLDcompare",value:function(n,o){var a=n,l=o;if(a.length<l.length)return-1;if(a.length>l.length)return 1;if(a.length===0)return 0;for(var d=zt.increasingDirection(a),v=zt.increasingDirection(l),E=d>0?0:a.length-1,S=v>0?0:a.length-1,w=0;w<a.length;w++){var N=a[E].compareTo(l[S]);if(N!==0)return N;E+=d,S+=v}return 0}},{key:"interfaces_",get:function(){return[pt]}}]),c}();zt.ForwardComparator=tw,zt.BidirectionalComparator=ew,zt.coordArrayType=new Array(0).fill(null);var la=function(){function c(n){e(this,c),this.str=n}return s(c,[{key:"append",value:function(n){this.str+=n}},{key:"setCharAt",value:function(n,o){this.str=this.str.substr(0,n)+o+this.str.substr(n+1)}},{key:"toString",value:function(){return this.str}}]),c}(),Ts=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getM",value:function(n){return this.hasM()?this._coordinates[n].getM():Z.NaN}},{key:"setOrdinate",value:function(n,o,a){switch(o){case _t.X:this._coordinates[n].x=a;break;case _t.Y:this._coordinates[n].y=a;break;default:this._coordinates[n].setOrdinate(o,a)}}},{key:"getZ",value:function(n){return this.hasZ()?this._coordinates[n].getZ():Z.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(n,o){switch(o){case _t.X:return this._coordinates[n].x;case _t.Y:return this._coordinates[n].y;default:return this._coordinates[n].getOrdinate(o)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var n=arguments[0];return this._coordinates[n]}if(arguments.length===2){var o=arguments[0],a=arguments[1];a.setCoordinate(this._coordinates[o])}}},{key:"getCoordinateCopy",value:function(n){var o=this.createCoordinate();return o.setCoordinate(this._coordinates[n]),o}},{key:"createCoordinate",value:function(){return ua.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(n){return this._coordinates[n].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(n){for(var o=0;o<this._coordinates.length;o++)n.expandToInclude(this._coordinates[o]);return n}},{key:"copy",value:function(){for(var n=new Array(this.size()).fill(null),o=0;o<this._coordinates.length;o++){var a=this.createCoordinate();a.setCoordinate(this._coordinates[o]),n[o]=a}return new c(n,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var n=new la(17*this._coordinates.length);n.append("("),n.append(this._coordinates[0]);for(var o=1;o<this._coordinates.length;o++)n.append(", "),n.append(this._coordinates[o]);return n.append(")"),n.toString()}return"()"}},{key:"getY",value:function(n){return this._coordinates[n].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[_t,B]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];c.constructor_.call(this,n,zt.dimension(n),zt.measures(n))}else if(Number.isInteger(arguments[0])){var o=arguments[0];this._coordinates=new Array(o).fill(null);for(var a=0;a<o;a++)this._coordinates[a]=new P}else if(ht(arguments[0],_t)){var l=arguments[0];if(l===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=l.getDimension(),this._measures=l.getMeasures(),this._coordinates=new Array(l.size()).fill(null);for(var d=0;d<this._coordinates.length;d++)this._coordinates[d]=l.getCoordinateCopy(d)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var v=arguments[0],E=arguments[1];c.constructor_.call(this,v,E,zt.measures(v))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var S=arguments[0],w=arguments[1];this._coordinates=new Array(S).fill(null),this._dimension=w;for(var N=0;N<S;N++)this._coordinates[N]=ua.create(w)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var M=arguments[0],Y=arguments[1],W=arguments[2];this._dimension=Y,this._measures=W,this._coordinates=M===null?new Array(0).fill(null):M}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var q=arguments[0],it=arguments[1],at=arguments[2];this._coordinates=new Array(q).fill(null),this._dimension=it,this._measures=at;for(var gt=0;gt<q;gt++)this._coordinates[gt]=this.createCoordinate()}}}}]),c}(),Fl=function(){function c(){e(this,c)}return s(c,[{key:"readResolve",value:function(){return c.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new Ts(n)}if(ht(arguments[0],_t)){var o=arguments[0];return new Ts(o)}}else{if(arguments.length===2){var a=arguments[0],l=arguments[1];return l>3&&(l=3),l<2&&(l=2),new Ts(a,l)}if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2],S=v-E;return E>1&&(E=1),S>3&&(S=3),S<2&&(S=2),new Ts(d,S+E,E)}}}},{key:"interfaces_",get:function(){return[ai,B]}}],[{key:"instance",value:function(){return c.instanceObject}}]),c}();Fl.instanceObject=new Fl;var Gl=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),l=0;l<a.length;l++)a[l]=this._geometries[l].copy();return new o(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];return!!this.isEquivalentClass(a)&&I(h(o.prototype),"equalsExact",this).call(this,a,l)}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return et.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new ot,l=0;l<this._geometries.length;l++)for(var d=this._geometries[l].getBoundary(),v=0;v<d.getNumGeometries();v++)a.add(d.getGeometryN(v));var E=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(E))}},{key:"getGeometryType",value:function(){return et.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Le]}}],[{key:"constructor_",value:function(){var a=arguments[0],l=arguments[1];Ee.constructor_.call(this,a,l)}}]),o}(Ee),cy=function(){function c(){e(this,c)}return s(c,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),c}(),nw=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),(a=n.call(this)).map=new Map,a}return s(o,[{key:"get",value:function(a){return this.map.get(a)||null}},{key:"put",value:function(a,l){return this.map.set(a,l),l}},{key:"values",value:function(){for(var a=new ot,l=this.map.values(),d=l.next();!d.done;)a.add(d.value),d=l.next();return a}},{key:"entrySet",value:function(){var a=new Mi;return this.map.entries().forEach(function(l){return a.add(l)}),a}},{key:"size",value:function(){return this.map.size()}}]),o}(cy),Ze=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"equals",value:function(n){if(!(n instanceof c))return!1;var o=n;return this._modelType===o._modelType&&this._scale===o._scale}},{key:"compareTo",value:function(n){var o=n,a=this.getMaximumSignificantDigits(),l=o.getMaximumSignificantDigits();return si.compare(a,l)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===c.FLOATING||this._modelType===c.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var n="UNKNOWN";return this._modelType===c.FLOATING?n="Floating":this._modelType===c.FLOATING_SINGLE?n="Floating-Single":this._modelType===c.FIXED&&(n="Fixed (Scale="+this.getScale()+")"),n}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var n=arguments[0];return Z.isNaN(n)||this._modelType===c.FLOATING_SINGLE?n:this._modelType===c.FIXED?Math.round(n*this._scale)/this._scale:n}if(arguments[0]instanceof P){var o=arguments[0];if(this._modelType===c.FLOATING)return null;o.x=this.makePrecise(o.x),o.y=this.makePrecise(o.y)}}},{key:"getMaximumSignificantDigits",value:function(){var n=16;return this._modelType===c.FLOATING?n=16:this._modelType===c.FLOATING_SINGLE?n=6:this._modelType===c.FIXED&&(n=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),n}},{key:"setScale",value:function(n){this._scale=Math.abs(n)}},{key:"interfaces_",get:function(){return[B,F]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=c.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof wr){var n=arguments[0];this._modelType=n,n===c.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var o=arguments[0];this._modelType=c.FIXED,this.setScale(o)}else if(arguments[0]instanceof c){var a=arguments[0];this._modelType=a._modelType,this._scale=a._scale}}}},{key:"mostPrecise",value:function(n,o){return n.compareTo(o)>=0?n:o}}]),c}(),wr=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"readResolve",value:function(){return c.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){this._name=null;var n=arguments[0];this._name=n,c.nameToTypeMap.put(n,this)}}]),c}();wr.nameToTypeMap=new nw,Ze.Type=wr,Ze.FIXED=new wr("FIXED"),Ze.FLOATING=new wr("FLOATING"),Ze.FLOATING_SINGLE=new wr("FLOATING SINGLE"),Ze.maximumPreciseValue=9007199254740992;var Bl=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"copyInternal",value:function(){for(var a=new Array(this._geometries.length).fill(null),l=0;l<a.length;l++)a[l]=this._geometries[l].copy();return new o(a,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof et){var a=arguments[0],l=arguments[1];return!!this.isEquivalentClass(a)&&I(h(o.prototype),"equalsExact",this).call(this,a,l)}return I(h(o.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?j.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!this._geometries[a].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return et.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Ue}},{key:"getGeometryType",value:function(){return et.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Cs]}}],[{key:"constructor_",value:function(){var a=arguments[0],l=arguments[1];Ee.constructor_.call(this,a,l)}}]),o}(Ee),kr=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"createEmpty",value:function(n){switch(n){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new L("Invalid dimension: "+n)}}},{key:"toGeometry",value:function(n){return n.isNull()?this.createPoint():n.getMinX()===n.getMaxX()&&n.getMinY()===n.getMaxY()?this.createPoint(new P(n.getMinX(),n.getMinY())):n.getMinX()===n.getMaxX()||n.getMinY()===n.getMaxY()?this.createLineString([new P(n.getMinX(),n.getMinY()),new P(n.getMaxX(),n.getMaxY())]):this.createPolygon(this.createLinearRing([new P(n.getMinX(),n.getMinY()),new P(n.getMinX(),n.getMaxY()),new P(n.getMaxX(),n.getMaxY()),new P(n.getMaxX(),n.getMinY()),new P(n.getMinX(),n.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return this.createLineString(n!==null?this.getCoordinateSequenceFactory().create(n):null)}if(ht(arguments[0],_t)){var o=arguments[0];return new Ut(o,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new Bl(null,this);if(arguments.length===1){var n=arguments[0];return new Bl(n,this)}}},{key:"buildGeometry",value:function(n){for(var o=null,a=!1,l=!1,d=n.iterator();d.hasNext();){var v=d.next(),E=v.getTypeCode();o===null&&(o=E),E!==o&&(a=!0),v instanceof Ee&&(l=!0)}if(o===null)return this.createGeometryCollection();if(a||l)return this.createGeometryCollection(c.toGeometryArray(n));var S=n.iterator().next();if(n.size()>1){if(S instanceof Ir)return this.createMultiPolygon(c.toPolygonArray(n));if(S instanceof Ut)return this.createMultiLineString(c.toLineStringArray(n));if(S instanceof xe)return this.createMultiPoint(c.toPointArray(n));z.shouldNeverReachHere("Unhandled geometry type: "+S.getGeometryType())}return S}},{key:"createMultiPointFromCoords",value:function(n){return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof P){var n=arguments[0];return this.createPoint(n!==null?this.getCoordinateSequenceFactory().create([n]):null)}if(ht(arguments[0],_t)){var o=arguments[0];return new xe(o,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(ht(arguments[0],_t)){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}if(arguments[0]instanceof Array){var o=arguments[0];return this.createPolygon(this.createLinearRing(o))}if(arguments[0]instanceof Rs){var a=arguments[0];return this.createPolygon(a,null)}}else if(arguments.length===2){var l=arguments[0],d=arguments[1];return new Ir(l,d,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new Ee(null,this);if(arguments.length===1){var n=arguments[0];return new Ee(n,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return this.createLinearRing(n!==null?this.getCoordinateSequenceFactory().create(n):null)}if(ht(arguments[0],_t)){var o=arguments[0];return new Rs(o,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new Gl(null,this);if(arguments.length===1){var n=arguments[0];return new Gl(n,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Pl(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new Pl(n,this)}if(ht(arguments[0],_t)){var o=arguments[0];if(o===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(o.size()).fill(null),l=0;l<o.size();l++){var d=this.getCoordinateSequenceFactory().create(1,o.getDimension(),o.getMeasures());Yt.copy(o,l,d,0,1),a[l]=this.createPoint(d)}return this.createMultiPoint(a)}}}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)c.constructor_.call(this,new Ze,0);else if(arguments.length===1){if(ht(arguments[0],ai)){var n=arguments[0];c.constructor_.call(this,new Ze,0,n)}else if(arguments[0]instanceof Ze){var o=arguments[0];c.constructor_.call(this,o,0,c.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];c.constructor_.call(this,a,l,c.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];this._precisionModel=d,this._coordinateSequenceFactory=E,this._SRID=v}}},{key:"toMultiPolygonArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"toGeometryArray",value:function(n){if(n===null)return null;var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return Fl.instance()}},{key:"toMultiLineStringArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"toLineStringArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"toMultiPointArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"toLinearRingArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"toPointArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"toPolygonArray",value:function(n){var o=new Array(n.size()).fill(null);return n.toArray(o)}},{key:"createPointFromInternalCoord",value:function(n,o){return o.getPrecisionModel().makePrecise(n),o.getFactory().createPoint(n)}}]),c}(),Yl="XY",iw="XYZ",rw="XYM",sw="XYZM",fy={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},gy="EMPTY",ha=1,Tn=2,ui=3,dy=4,Cr=5,ow=6;for(var aw in fy)fy[aw].toUpperCase();var uw=function(){function c(n){e(this,c),this.wkt=n,this.index_=-1}return s(c,[{key:"isAlpha_",value:function(n){return n>="a"&&n<="z"||n>="A"&&n<="Z"}},{key:"isNumeric_",value:function(n,o){return n>="0"&&n<="9"||n=="."&&!(o!==void 0&&o)}},{key:"isWhiteSpace_",value:function(n){return n==" "||n=="	"||n=="\r"||n==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var n,o=this.nextChar_(),a=this.index_,l=o;if(o=="(")n=Tn;else if(o==",")n=Cr;else if(o==")")n=ui;else if(this.isNumeric_(o)||o=="-")n=dy,l=this.readNumber_();else if(this.isAlpha_(o))n=ha,l=this.readText_();else{if(this.isWhiteSpace_(o))return this.nextToken();if(o!=="")throw new Error("Unexpected character: "+o);n=ow}return{position:a,value:l,type:n}}},{key:"readNumber_",value:function(){var n,o=this.index_,a=!1,l=!1;do n=="."?a=!0:n!="e"&&n!="E"||(l=!0),n=this.nextChar_();while(this.isNumeric_(n,a)||!l&&(n=="e"||n=="E")||l&&(n=="-"||n=="+"));return parseFloat(this.wkt.substring(o,this.index_--))}},{key:"readText_",value:function(){var n,o=this.index_;do n=this.nextChar_();while(this.isAlpha_(n));return this.wkt.substring(o,this.index_--).toUpperCase()}}]),c}(),lw=function(){function c(n,o){e(this,c),this.lexer_=n,this.token_,this.layout_=Yl,this.factory=o}return s(c,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(n){return this.token_.type==n}},{key:"match",value:function(n){var o=this.isTokenType(n);return o&&this.consume_(),o}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var n=Yl,o=this.token_;if(this.isTokenType(ha)){var a=o.value;a==="Z"?n=iw:a==="M"?n=rw:a==="ZM"&&(n=sw),n!==Yl&&this.consume_()}return n}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Tn)){var n=[];do n.push(this.parseGeometry_());while(this.match(Cr));if(this.match(ui))return n}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Tn)){var n=this.parsePoint_();if(this.match(ui))return n}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Tn)){var n=this.parsePointList_();if(this.match(ui))return n}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Tn)){var n=this.parseLineStringTextList_();if(this.match(ui))return n}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var n;if(this.match(Tn)){if(n=this.token_.type==Tn?this.parsePointTextList_():this.parsePointList_(),this.match(ui))return n}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Tn)){var n=this.parseLineStringTextList_();if(this.match(ui))return n}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Tn)){var n=this.parsePolygonTextList_();if(this.match(ui))return n}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var n=[],o=this.layout_.length,a=0;a<o;++a){var l=this.token_;if(!this.match(dy))break;n.push(l.value)}if(n.length==o)return n;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var n=[this.parsePoint_()];this.match(Cr);)n.push(this.parsePoint_());return n}},{key:"parsePointTextList_",value:function(){for(var n=[this.parsePointText_()];this.match(Cr);)n.push(this.parsePointText_());return n}},{key:"parseLineStringTextList_",value:function(){for(var n=[this.parseLineStringText_()];this.match(Cr);)n.push(this.parseLineStringText_());return n}},{key:"parsePolygonTextList_",value:function(){for(var n=[this.parsePolygonText_()];this.match(Cr);)n.push(this.parsePolygonText_());return n}},{key:"isEmptyGeometry_",value:function(){var n=this.isTokenType(ha)&&this.token_.value==gy;return n&&this.consume_(),n}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var n=this.factory,o=function(at){return y(P,k(at))},a=function(at){var gt=at.map(function(Rt){return n.createLinearRing(Rt.map(o))});return gt.length>1?n.createPolygon(gt[0],gt.slice(1)):n.createPolygon(gt[0])},l=this.token_;if(this.match(ha)){var d=l.value;if(this.layout_=this.parseGeometryLayout_(),d=="GEOMETRYCOLLECTION"){var v=this.parseGeometryCollectionText_();return n.createGeometryCollection(v)}switch(d){case"POINT":var E=this.parsePointText_();return E?n.createPoint(y(P,k(E))):n.createPoint();case"LINESTRING":var S=this.parseLineStringText_().map(o);return n.createLineString(S);case"LINEARRING":var w=this.parseLineStringText_().map(o);return n.createLinearRing(w);case"POLYGON":var N=this.parsePolygonText_();return N&&N.length!==0?a(N):n.createPolygon();case"MULTIPOINT":var M=this.parseMultiPointText_();if(!M||M.length===0)return n.createMultiPoint();var Y=M.map(o).map(function(at){return n.createPoint(at)});return n.createMultiPoint(Y);case"MULTILINESTRING":var W=this.parseMultiLineStringText_().map(function(at){return n.createLineString(at.map(o))});return n.createMultiLineString(W);case"MULTIPOLYGON":var q=this.parseMultiPolygonText_();if(!q||q.length===0)return n.createMultiPolygon();var it=q.map(a);return n.createMultiPolygon(it);default:throw new Error("Invalid geometry type: "+d)}}throw new Error(this.formatErrorMessage_())}}]),c}();function yy(c){if(c.isEmpty())return"";var n=c.getCoordinate(),o=[n.x,n.y];return n.z===void 0||Number.isNaN(n.z)||o.push(n.z),n.m===void 0||Number.isNaN(n.m)||o.push(n.m),o.join(" ")}function Ns(c){for(var n=c.getCoordinates().map(function(d){var v=[d.x,d.y];return d.z===void 0||Number.isNaN(d.z)||v.push(d.z),d.m===void 0||Number.isNaN(d.m)||v.push(d.m),v}),o=[],a=0,l=n.length;a<l;++a)o.push(n[a].join(" "));return o.join(", ")}function py(c){var n=[];n.push("("+Ns(c.getExteriorRing())+")");for(var o=0,a=c.getNumInteriorRing();o<a;++o)n.push("("+Ns(c.getInteriorRingN(o))+")");return n.join(", ")}var hw={Point:yy,LineString:Ns,LinearRing:Ns,Polygon:py,MultiPoint:function(c){for(var n=[],o=0,a=c.getNumGeometries();o<a;++o)n.push("("+yy(c.getGeometryN(o))+")");return n.join(", ")},MultiLineString:function(c){for(var n=[],o=0,a=c.getNumGeometries();o<a;++o)n.push("("+Ns(c.getGeometryN(o))+")");return n.join(", ")},MultiPolygon:function(c){for(var n=[],o=0,a=c.getNumGeometries();o<a;++o)n.push("("+py(c.getGeometryN(o))+")");return n.join(", ")},GeometryCollection:function(c){for(var n=[],o=0,a=c.getNumGeometries();o<a;++o)n.push(my(c.getGeometryN(o)));return n.join(", ")}};function my(c){var n=c.getGeometryType(),o=hw[n];n=n.toUpperCase();var a=function(l){var d="";if(l.isEmpty())return d;var v=l.getCoordinate();return v.z===void 0||Number.isNaN(v.z)||(d+="Z"),v.m===void 0||Number.isNaN(v.m)||(d+="M"),d}(c);return a.length>0&&(n+=" "+a),c.isEmpty()?n+" "+gy:n+" ("+o(c)+")"}var cw=function(){function c(n){e(this,c),this.geometryFactory=n||new kr,this.precisionModel=this.geometryFactory.getPrecisionModel()}return s(c,[{key:"read",value:function(n){var o=new uw(n);return new lw(o,this.geometryFactory).parse()}},{key:"write",value:function(n){return my(n)}}]),c}(),zl=function(){function c(n){e(this,c),this.parser=new cw(n)}return s(c,[{key:"write",value:function(n){return this.parser.write(n)}}],[{key:"toLineString",value:function(n,o){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+n.x+" "+n.y+", "+o.x+" "+o.y+" )"}}]),c}(),Ot=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getIndexAlongSegment",value:function(n,o){return this.computeIntLineIndex(),this._intLineIndex[n][o]}},{key:"getTopologySummary",value:function(){var n=new la;return this.isEndPoint()&&n.append(" endpoint"),this._isProper&&n.append(" proper"),this.isCollinear()&&n.append(" collinear"),n.toString()}},{key:"computeIntersection",value:function(n,o,a,l){this._inputLines[0][0]=n,this._inputLines[0][1]=o,this._inputLines[1][0]=a,this._inputLines[1][1]=l,this._result=this.computeIntersect(n,o,a,l)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var n=arguments[0],o=this.getEdgeDistance(n,0),a=this.getEdgeDistance(n,1);o>a?(this._intLineIndex[n][0]=0,this._intLineIndex[n][1]=1):(this._intLineIndex[n][0]=1,this._intLineIndex[n][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(n){this._precisionModel=n}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var n=arguments[0],o=0;o<this._result;o++)if(!this._intPt[o].equals2D(this._inputLines[n][0])&&!this._intPt[o].equals2D(this._inputLines[n][1]))return!0;return!1}}},{key:"getIntersection",value:function(n){return this._intPt[n]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==c.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(n,o){return c.computeEdgeDistance(this._intPt[o],this._inputLines[n][0],this._inputLines[n][1])}},{key:"isCollinear",value:function(){return this._result===c.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return zl.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+zl.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(n,o){return this._inputLines[n][o]}},{key:"isIntersection",value:function(n){for(var o=0;o<this._result;o++)if(this._intPt[o].equals2D(n))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(n,o){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[n][o]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new P,this._intPt[1]=new P,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(n,o,a){var l=Math.abs(a.x-o.x),d=Math.abs(a.y-o.y),v=-1;if(n.equals(o))v=0;else if(n.equals(a))v=l>d?l:d;else{var E=Math.abs(n.x-o.x),S=Math.abs(n.y-o.y);(v=l>d?E:S)!==0||n.equals(o)||(v=Math.max(E,S))}return z.isTrue(!(v===0&&!n.equals(o)),"Bad distance calculation"),v}},{key:"nonRobustComputeEdgeDistance",value:function(n,o,a){var l=n.x-o.x,d=n.y-o.y,v=Math.sqrt(l*l+d*d);return z.isTrue(!(v===0&&!n.equals(o)),"Invalid distance calculation"),v}}]),c}();Ot.DONT_INTERSECT=0,Ot.DO_INTERSECT=1,Ot.COLLINEAR=2,Ot.NO_INTERSECTION=0,Ot.POINT_INTERSECTION=1,Ot.COLLINEAR_INTERSECTION=2;var Di=function(c){u(o,c);var n=x(o);function o(){return e(this,o),n.call(this)}return s(o,[{key:"isInSegmentEnvelopes",value:function(a){var l=new Tt(this._inputLines[0][0],this._inputLines[0][1]),d=new Tt(this._inputLines[1][0],this._inputLines[1][1]);return l.contains(a)&&d.contains(a)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return I(h(o.prototype),"computeIntersection",this).apply(this,arguments);var a=arguments[0],l=arguments[1],d=arguments[2];if(this._isProper=!1,Tt.intersects(l,d,a)&&ut.index(l,d,a)===0&&ut.index(d,l,a)===0)return this._isProper=!0,(a.equals(l)||a.equals(d))&&(this._isProper=!1),this._result=Ot.POINT_INTERSECTION,null;this._result=Ot.NO_INTERSECTION}},{key:"intersection",value:function(a,l,d,v){var E=this.intersectionSafe(a,l,d,v);return this.isInSegmentEnvelopes(E)||(E=new P(o.nearestEndpoint(a,l,d,v))),this._precisionModel!==null&&this._precisionModel.makePrecise(E),E}},{key:"checkDD",value:function(a,l,d,v,E){var S=oi.intersection(a,l,d,v),w=this.isInSegmentEnvelopes(S);oe.out.println("DD in env = "+w+"  --------------------- "+S),E.distance(S)>1e-4&&oe.out.println("Distance = "+E.distance(S))}},{key:"intersectionSafe",value:function(a,l,d,v){var E=Li.intersection(a,l,d,v);return E===null&&(E=o.nearestEndpoint(a,l,d,v)),E}},{key:"computeCollinearIntersection",value:function(a,l,d,v){var E=Tt.intersects(a,l,d),S=Tt.intersects(a,l,v),w=Tt.intersects(d,v,a),N=Tt.intersects(d,v,l);return E&&S?(this._intPt[0]=d,this._intPt[1]=v,Ot.COLLINEAR_INTERSECTION):w&&N?(this._intPt[0]=a,this._intPt[1]=l,Ot.COLLINEAR_INTERSECTION):E&&w?(this._intPt[0]=d,this._intPt[1]=a,!d.equals(a)||S||N?Ot.COLLINEAR_INTERSECTION:Ot.POINT_INTERSECTION):E&&N?(this._intPt[0]=d,this._intPt[1]=l,!d.equals(l)||S||w?Ot.COLLINEAR_INTERSECTION:Ot.POINT_INTERSECTION):S&&w?(this._intPt[0]=v,this._intPt[1]=a,!v.equals(a)||E||N?Ot.COLLINEAR_INTERSECTION:Ot.POINT_INTERSECTION):S&&N?(this._intPt[0]=v,this._intPt[1]=l,!v.equals(l)||E||w?Ot.COLLINEAR_INTERSECTION:Ot.POINT_INTERSECTION):Ot.NO_INTERSECTION}},{key:"computeIntersect",value:function(a,l,d,v){if(this._isProper=!1,!Tt.intersects(a,l,d,v))return Ot.NO_INTERSECTION;var E=ut.index(a,l,d),S=ut.index(a,l,v);if(E>0&&S>0||E<0&&S<0)return Ot.NO_INTERSECTION;var w=ut.index(d,v,a),N=ut.index(d,v,l);return w>0&&N>0||w<0&&N<0?Ot.NO_INTERSECTION:E===0&&S===0&&w===0&&N===0?this.computeCollinearIntersection(a,l,d,v):(E===0||S===0||w===0||N===0?(this._isProper=!1,a.equals2D(d)||a.equals2D(v)?this._intPt[0]=a:l.equals2D(d)||l.equals2D(v)?this._intPt[0]=l:E===0?this._intPt[0]=new P(d):S===0?this._intPt[0]=new P(v):w===0?this._intPt[0]=new P(a):N===0&&(this._intPt[0]=new P(l))):(this._isProper=!0,this._intPt[0]=this.intersection(a,l,d,v)),Ot.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(a,l,d,v){var E=a,S=ie.pointToSegment(a,d,v),w=ie.pointToSegment(l,d,v);return w<S&&(S=w,E=l),(w=ie.pointToSegment(d,a,l))<S&&(S=w,E=d),(w=ie.pointToSegment(v,a,l))<S&&(S=w,E=v),E}}]),o}(Ot),fw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"countSegment",value:function(n,o){if(n.x<this._p.x&&o.x<this._p.x)return null;if(this._p.x===o.x&&this._p.y===o.y)return this._isPointOnSegment=!0,null;if(n.y===this._p.y&&o.y===this._p.y){var a=n.x,l=o.x;return a>l&&(a=o.x,l=n.x),this._p.x>=a&&this._p.x<=l&&(this._isPointOnSegment=!0),null}if(n.y>this._p.y&&o.y<=this._p.y||o.y>this._p.y&&n.y<=this._p.y){var d=ut.index(n,o,this._p);if(d===ut.COLLINEAR)return this._isPointOnSegment=!0,null;o.y<n.y&&(d=-d),d===ut.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==T.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?T.BOUNDARY:this._crossingCount%2==1?T.INTERIOR:T.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var n=arguments[0];this._p=n}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof P&&ht(arguments[1],_t)){for(var n=arguments[0],o=arguments[1],a=new c(n),l=new P,d=new P,v=1;v<o.size();v++)if(o.getCoordinate(v,l),o.getCoordinate(v-1,d),a.countSegment(l,d),a.isOnSegment())return a.getLocation();return a.getLocation()}if(arguments[0]instanceof P&&arguments[1]instanceof Array){for(var E=arguments[0],S=arguments[1],w=new c(E),N=1;N<S.length;N++){var M=S[N],Y=S[N-1];if(w.countSegment(M,Y),w.isOnSegment())return w.getLocation()}return w.getLocation()}}}]),c}(),$l=function(){function c(){e(this,c)}return s(c,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof P&&ht(arguments[1],_t)){for(var n=arguments[0],o=arguments[1],a=new Di,l=new P,d=new P,v=o.size(),E=1;E<v;E++)if(o.getCoordinate(E-1,l),o.getCoordinate(E,d),a.computeIntersection(n,l,d),a.hasIntersection())return!0;return!1}if(arguments[0]instanceof P&&arguments[1]instanceof Array){for(var S=arguments[0],w=arguments[1],N=new Di,M=1;M<w.length;M++){var Y=w[M-1],W=w[M];if(N.computeIntersection(S,Y,W),N.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(n,o){return fw.locatePointInRing(n,o)}},{key:"isInRing",value:function(n,o){return c.locateInRing(n,o)!==T.EXTERIOR}}]),c}(),Ae=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"setAllLocations",value:function(n){for(var o=0;o<this.location.length;o++)this.location[o]=n}},{key:"isNull",value:function(){for(var n=0;n<this.location.length;n++)if(this.location[n]!==T.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(n){for(var o=0;o<this.location.length;o++)this.location[o]===T.NONE&&(this.location[o]=n)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(n){if(n.location.length>this.location.length){var o=new Array(3).fill(null);o[U.ON]=this.location[U.ON],o[U.LEFT]=T.NONE,o[U.RIGHT]=T.NONE,this.location=o}for(var a=0;a<this.location.length;a++)this.location[a]===T.NONE&&a<n.location.length&&(this.location[a]=n.location[a])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var n=this.location[U.LEFT];this.location[U.LEFT]=this.location[U.RIGHT],this.location[U.RIGHT]=n}},{key:"toString",value:function(){var n=new Ve;return this.location.length>1&&n.append(T.toLocationSymbol(this.location[U.LEFT])),n.append(T.toLocationSymbol(this.location[U.ON])),this.location.length>1&&n.append(T.toLocationSymbol(this.location[U.RIGHT])),n.toString()}},{key:"setLocations",value:function(n,o,a){this.location[U.ON]=n,this.location[U.LEFT]=o,this.location[U.RIGHT]=a}},{key:"get",value:function(n){return n<this.location.length?this.location[n]:T.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var n=0;n<this.location.length;n++)if(this.location[n]===T.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var n=arguments[0];this.setLocation(U.ON,n)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.location[o]=a}}},{key:"init",value:function(n){this.location=new Array(n).fill(null),this.setAllLocations(T.NONE)}},{key:"isEqualOnSide",value:function(n,o){return this.location[o]===n.location[o]}},{key:"allPositionsEqual",value:function(n){for(var o=0;o<this.location.length;o++)if(this.location[o]!==n)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var o=arguments[0];this.init(1),this.location[U.ON]=o}else if(arguments[0]instanceof c){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var l=0;l<this.location.length;l++)this.location[l]=a.location[l]}}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];this.init(3),this.location[U.ON]=d,this.location[U.LEFT]=v,this.location[U.RIGHT]=E}}}]),c}(),Pe=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getGeometryCount",value:function(){var n=0;return this.elt[0].isNull()||n++,this.elt[1].isNull()||n++,n}},{key:"setAllLocations",value:function(n,o){this.elt[n].setAllLocations(o)}},{key:"isNull",value:function(n){return this.elt[n].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var n=arguments[0];this.setAllLocationsIfNull(0,n),this.setAllLocationsIfNull(1,n)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.elt[o].setAllLocationsIfNull(a)}}},{key:"isLine",value:function(n){return this.elt[n].isLine()}},{key:"merge",value:function(n){for(var o=0;o<2;o++)this.elt[o]===null&&n.elt[o]!==null?this.elt[o]=new Ae(n.elt[o]):this.elt[o].merge(n.elt[o])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var n=arguments[0];return this.elt[n].get(U.ON)}if(arguments.length===2){var o=arguments[0],a=arguments[1];return this.elt[o].get(a)}}},{key:"toString",value:function(){var n=new Ve;return this.elt[0]!==null&&(n.append("A:"),n.append(this.elt[0].toString())),this.elt[1]!==null&&(n.append(" B:"),n.append(this.elt[1].toString())),n.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var n=arguments[0];return this.elt[n].isArea()}}},{key:"isAnyNull",value:function(n){return this.elt[n].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];this.elt[n].setLocation(U.ON,o)}else if(arguments.length===3){var a=arguments[0],l=arguments[1],d=arguments[2];this.elt[a].setLocation(l,d)}}},{key:"isEqualOnSide",value:function(n,o){return this.elt[0].isEqualOnSide(n.elt[0],o)&&this.elt[1].isEqualOnSide(n.elt[1],o)}},{key:"allPositionsEqual",value:function(n,o){return this.elt[n].allPositionsEqual(o)}},{key:"toLine",value:function(n){this.elt[n].isArea()&&(this.elt[n]=new Ae(this.elt[n].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var n=arguments[0];this.elt[0]=new Ae(n),this.elt[1]=new Ae(n)}else if(arguments[0]instanceof c){var o=arguments[0];this.elt[0]=new Ae(o.elt[0]),this.elt[1]=new Ae(o.elt[1])}}else if(arguments.length===2){var a=arguments[0],l=arguments[1];this.elt[0]=new Ae(T.NONE),this.elt[1]=new Ae(T.NONE),this.elt[a].setLocation(l)}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];this.elt[0]=new Ae(d,v,E),this.elt[1]=new Ae(d,v,E)}else if(arguments.length===4){var S=arguments[0],w=arguments[1],N=arguments[2],M=arguments[3];this.elt[0]=new Ae(T.NONE,T.NONE,T.NONE),this.elt[1]=new Ae(T.NONE,T.NONE,T.NONE),this.elt[S].setLocations(w,N,M)}}},{key:"toLineLabel",value:function(n){for(var o=new c(T.NONE),a=0;a<2;a++)o.setLocation(a,n.getLocation(a));return o}}]),c}(),ca=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var n=new Array(this._pts.size()).fill(null),o=0;o<this._pts.size();o++)n[o]=this._pts.get(o);this._ring=this._geometryFactory.createLinearRing(n),this._isHole=ut.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(n){this._startDe=n;var o=n,a=!0;do{if(o===null)throw new _e("Found null DirectedEdge");if(o.getEdgeRing()===this)throw new _e("Directed Edge visited twice during ring-building at "+o.getCoordinate());this._edges.add(o);var l=o.getLabel();z.isTrue(l.isArea()),this.mergeLabel(l),this.addPoints(o.getEdge(),o.isForward(),a),a=!1,this.setEdgeRing(o,this),o=this.getNext(o)}while(o!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(n){return this._pts.get(n)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var n=this._startDe;do{var o=n.getNode().getEdges().getOutgoingDegree(this);o>this._maxNodeDegree&&(this._maxNodeDegree=o),n=this.getNext(n)}while(n!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(n,o,a){var l=n.getCoordinates();if(o){var d=1;a&&(d=0);for(var v=d;v<l.length;v++)this._pts.add(l[v])}else{var E=l.length-2;a&&(E=l.length-1);for(var S=E;S>=0;S--)this._pts.add(l[S])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var n=this._startDe;do n.getEdge().setInResult(!0),n=n.getNext();while(n!==this._startDe)}},{key:"containsPoint",value:function(n){var o=this.getLinearRing();if(!o.getEnvelopeInternal().contains(n)||!$l.isInRing(n,o.getCoordinates()))return!1;for(var a=this._holes.iterator();a.hasNext();)if(a.next().containsPoint(n))return!1;return!0}},{key:"addHole",value:function(n){this._holes.add(n)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var n=arguments[0];this.mergeLabel(n,0),this.mergeLabel(n,1)}else if(arguments.length===2){var o=arguments[0],a=arguments[1],l=o.getLocation(a,U.RIGHT);if(l===T.NONE)return null;if(this._label.getLocation(a)===T.NONE)return this._label.setLocation(a,l),null}}},{key:"setShell",value:function(n){this._shell=n,n!==null&&n.addHole(this)}},{key:"toPolygon",value:function(n){for(var o=new Array(this._holes.size()).fill(null),a=0;a<this._holes.size();a++)o[a]=this._holes.get(a).getLinearRing();return n.createPolygon(this.getLinearRing(),o)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new ot,this._pts=new ot,this._label=new Pe(T.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new ot,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var n=arguments[0],o=arguments[1];this._geometryFactory=o,this.computePoints(n),this.computeRing()}}}}]),c}(),gw=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"setEdgeRing",value:function(a,l){a.setMinEdgeRing(l)}},{key:"getNext",value:function(a){return a.getNextMin()}}],[{key:"constructor_",value:function(){var a=arguments[0],l=arguments[1];ca.constructor_.call(this,a,l)}}]),o}(ca),dw=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"buildMinimalRings",value:function(){var a=new ot,l=this._startDe;do{if(l.getMinEdgeRing()===null){var d=new gw(l,this._geometryFactory);a.add(d)}l=l.getNext()}while(l!==this._startDe);return a}},{key:"setEdgeRing",value:function(a,l){a.setEdgeRing(l)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var a=this._startDe;do a.getNode().getEdges().linkMinimalDirectedEdges(this),a=a.getNext();while(a!==this._startDe)}},{key:"getNext",value:function(a){return a.getNext()}}],[{key:"constructor_",value:function(){var a=arguments[0],l=arguments[1];ca.constructor_.call(this,a,l)}}]),o}(ca),vy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"setVisited",value:function(n){this._isVisited=n}},{key:"setInResult",value:function(n){this._isInResult=n}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(n){this._label=n}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(n){this._isCovered=n,this._isCoveredSet=!0}},{key:"updateIM",value:function(n){z.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(n)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this._label=n}}}}]),c}(),fa=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"isIncidentEdgeInResult",value:function(){for(var a=this.getEdges().getEdges().iterator();a.hasNext();)if(a.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(a){a.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(a){}},{key:"computeMergedLocation",value:function(a,l){var d=T.NONE;if(d=this._label.getLocation(l),!a.isNull(l)){var v=a.getLocation(l);d!==T.BOUNDARY&&(d=v)}return d}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return I(h(o.prototype),"setLabel",this).apply(this,arguments);var a=arguments[0],l=arguments[1];this._label===null?this._label=new Pe(a,l):this._label.setLocation(a,l)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof o){var a=arguments[0];this.mergeLabel(a._label)}else if(arguments[0]instanceof Pe)for(var l=arguments[0],d=0;d<2;d++){var v=this.computeMergedLocation(l,d),E=this._label.getLocation(d);E===T.NONE&&this._label.setLocation(d,v)}}},{key:"add",value:function(a){this._edges.insert(a),a.setNode(this)}},{key:"setLabelBoundary",value:function(a){if(this._label===null)return null;var l=T.NONE;this._label!==null&&(l=this._label.getLocation(a));var d=null;switch(l){case T.BOUNDARY:d=T.INTERIOR;break;case T.INTERIOR:default:d=T.BOUNDARY}this._label.setLocation(a,d)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var a=arguments[0],l=arguments[1];this._coord=a,this._edges=l,this._label=new Pe(0,T.NONE)}}]),o}(vy),yw=function(c){u(o,c);var n=x(o);function o(){return e(this,o),n.apply(this,arguments)}return o}(cy);function _y(c){return c==null?0:c.color}function It(c){return c==null?null:c.parent}function cn(c,n){c!==null&&(c.color=n)}function Xl(c){return c==null?null:c.left}function xy(c){return c==null?null:c.right}var Ms=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),(a=n.call(this)).root_=null,a.size_=0,a}return s(o,[{key:"get",value:function(a){for(var l=this.root_;l!==null;){var d=a.compareTo(l.key);if(d<0)l=l.left;else{if(!(d>0))return l.value;l=l.right}}return null}},{key:"put",value:function(a,l){if(this.root_===null)return this.root_={key:a,value:l,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var d,v,E=this.root_;do if(d=E,(v=a.compareTo(E.key))<0)E=E.left;else{if(!(v>0)){var S=E.value;return E.value=l,S}E=E.right}while(E!==null);var w={key:a,left:null,right:null,value:l,parent:d,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return v<0?d.left=w:d.right=w,this.fixAfterInsertion(w),this.size_++,null}},{key:"fixAfterInsertion",value:function(a){var l;for(a.color=1;a!=null&&a!==this.root_&&a.parent.color===1;)It(a)===Xl(It(It(a)))?_y(l=xy(It(It(a))))===1?(cn(It(a),0),cn(l,0),cn(It(It(a)),1),a=It(It(a))):(a===xy(It(a))&&(a=It(a),this.rotateLeft(a)),cn(It(a),0),cn(It(It(a)),1),this.rotateRight(It(It(a)))):_y(l=Xl(It(It(a))))===1?(cn(It(a),0),cn(l,0),cn(It(It(a)),1),a=It(It(a))):(a===Xl(It(a))&&(a=It(a),this.rotateRight(a)),cn(It(a),0),cn(It(It(a)),1),this.rotateLeft(It(It(a))));this.root_.color=0}},{key:"values",value:function(){var a=new ot,l=this.getFirstEntry();if(l!==null)for(a.add(l.value);(l=o.successor(l))!==null;)a.add(l.value);return a}},{key:"entrySet",value:function(){var a=new Mi,l=this.getFirstEntry();if(l!==null)for(a.add(l);(l=o.successor(l))!==null;)a.add(l);return a}},{key:"rotateLeft",value:function(a){if(a!=null){var l=a.right;a.right=l.left,l.left!=null&&(l.left.parent=a),l.parent=a.parent,a.parent==null?this.root_=l:a.parent.left===a?a.parent.left=l:a.parent.right=l,l.left=a,a.parent=l}}},{key:"rotateRight",value:function(a){if(a!=null){var l=a.left;a.left=l.right,l.right!=null&&(l.right.parent=a),l.parent=a.parent,a.parent==null?this.root_=l:a.parent.right===a?a.parent.right=l:a.parent.left=l,l.right=a,a.parent=l}}},{key:"getFirstEntry",value:function(){var a=this.root_;if(a!=null)for(;a.left!=null;)a=a.left;return a}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(a){for(var l=this.root_;l!==null;){var d=a.compareTo(l.key);if(d<0)l=l.left;else{if(!(d>0))return!0;l=l.right}}return!1}}],[{key:"successor",value:function(a){var l;if(a===null)return null;if(a.right!==null){for(l=a.right;l.left!==null;)l=l.left;return l}l=a.parent;for(var d=a;l!==null&&d===l.right;)d=l,l=l.parent;return l}}]),o}(yw),Ey=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"find",value:function(n){return this.nodeMap.get(n)}},{key:"addNode",value:function(){if(arguments[0]instanceof P){var n=arguments[0],o=this.nodeMap.get(n);return o===null&&(o=this.nodeFact.createNode(n),this.nodeMap.put(n,o)),o}if(arguments[0]instanceof fa){var a=arguments[0],l=this.nodeMap.get(a.getCoordinate());return l===null?(this.nodeMap.put(a.getCoordinate(),a),a):(l.mergeLabel(a),l)}}},{key:"print",value:function(n){for(var o=this.iterator();o.hasNext();)o.next().print(n)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(n){for(var o=new ot,a=this.iterator();a.hasNext();){var l=a.next();l.getLabel().getLocation(n)===T.BOUNDARY&&o.add(l)}return o}},{key:"add",value:function(n){var o=n.getCoordinate();this.addNode(o).add(n)}}],[{key:"constructor_",value:function(){this.nodeMap=new Ms,this.nodeFact=null;var n=arguments[0];this.nodeFact=n}}]),c}(),ue=function(){function c(){e(this,c)}return s(c,null,[{key:"isNorthern",value:function(n){return n===c.NE||n===c.NW}},{key:"isOpposite",value:function(n,o){return n!==o&&(n-o+4)%4===2}},{key:"commonHalfPlane",value:function(n,o){if(n===o)return n;if((n-o+4)%4===2)return-1;var a=n<o?n:o;return a===0&&(n>o?n:o)===3?3:a}},{key:"isInHalfPlane",value:function(n,o){return o===c.SE?n===c.SE||n===c.SW:n===o||n===o+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],o=arguments[1];if(n===0&&o===0)throw new L("Cannot compute the quadrant for point ( "+n+", "+o+" )");return n>=0?o>=0?c.NE:c.SE:o>=0?c.NW:c.SW}if(arguments[0]instanceof P&&arguments[1]instanceof P){var a=arguments[0],l=arguments[1];if(l.x===a.x&&l.y===a.y)throw new L("Cannot compute the quadrant for two identical points "+a);return l.x>=a.x?l.y>=a.y?c.NE:c.SE:l.y>=a.y?c.NW:c.SW}}}]),c}();ue.NE=0,ue.NW=1,ue.SW=2,ue.SE=3;var Sy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"compareDirection",value:function(n){return this._dx===n._dx&&this._dy===n._dy?0:this._quadrant>n._quadrant?1:this._quadrant<n._quadrant?-1:ut.index(n._p0,n._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(n){this._node=n}},{key:"print",value:function(n){var o=Math.atan2(this._dy,this._dx),a=this.getClass().getName(),l=a.lastIndexOf("."),d=a.substring(l+1);n.print("  "+d+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+o+"   "+this._label)}},{key:"compareTo",value:function(n){var o=n;return this.compareDirection(o)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var n=Math.atan2(this._dy,this._dx),o=this.getClass().getName(),a=o.lastIndexOf(".");return"  "+o.substring(a+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label}},{key:"computeLabel",value:function(n){}},{key:"init",value:function(n,o){this._p0=n,this._p1=o,this._dx=o.x-n.x,this._dy=o.y-n.y,this._quadrant=ue.quadrant(this._dx,this._dy),z.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var n=arguments[0];this._edge=n}else if(arguments.length===3){var o=arguments[0],a=arguments[1],l=arguments[2];c.constructor_.call(this,o,a,l,null)}else if(arguments.length===4){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3];c.constructor_.call(this,d),this.init(v,E),this._label=S}}}]),c}(),ql=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(a){return this._depth[a]}},{key:"setVisited",value:function(a){this._isVisited=a}},{key:"computeDirectedLabel",value:function(){this._label=new Pe(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(a,l){if(this._depth[a]!==-999&&this._depth[a]!==l)throw new _e("assigned depths do not match",this.getCoordinate());this._depth[a]=l}},{key:"isInteriorAreaEdge",value:function(){for(var a=!0,l=0;l<2;l++)this._label.isArea(l)&&this._label.getLocation(l,U.LEFT)===T.INTERIOR&&this._label.getLocation(l,U.RIGHT)===T.INTERIOR||(a=!1);return a}},{key:"setNextMin",value:function(a){this._nextMin=a}},{key:"print",value:function(a){I(h(o.prototype),"print",this).call(this,a),a.print(" "+this._depth[U.LEFT]+"/"+this._depth[U.RIGHT]),a.print(" ("+this.getDepthDelta()+")"),this._isInResult&&a.print(" inResult")}},{key:"setMinEdgeRing",value:function(a){this._minEdgeRing=a}},{key:"isLineEdge",value:function(){var a=this._label.isLine(0)||this._label.isLine(1),l=!this._label.isArea(0)||this._label.allPositionsEqual(0,T.EXTERIOR),d=!this._label.isArea(1)||this._label.allPositionsEqual(1,T.EXTERIOR);return a&&l&&d}},{key:"setEdgeRing",value:function(a){this._edgeRing=a}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var a=this._edge.getDepthDelta();return this._isForward||(a=-a),a}},{key:"setInResult",value:function(a){this._isInResult=a}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(a){this.print(a),a.print(" "),this._isForward?this._edge.print(a):this._edge.printReverse(a)}},{key:"setSym",value:function(a){this._sym=a}},{key:"setVisitedEdge",value:function(a){this.setVisited(a),this._sym.setVisited(a)}},{key:"setEdgeDepths",value:function(a,l){var d=this.getEdge().getDepthDelta();this._isForward||(d=-d);var v=1;a===U.LEFT&&(v=-1);var E=U.opposite(a),S=l+d*v;this.setDepth(a,l),this.setDepth(E,S)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(a){this._next=a}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var a=arguments[0],l=arguments[1];if(Sy.constructor_.call(this,a),this._isForward=l,l)this.init(a.getCoordinate(0),a.getCoordinate(1));else{var d=a.getNumPoints()-1;this.init(a.getCoordinate(d),a.getCoordinate(d-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(a,l){return a===T.EXTERIOR&&l===T.INTERIOR?1:a===T.INTERIOR&&l===T.EXTERIOR?-1:0}}]),o}(Sy),Iy=function(){function c(){e(this,c)}return s(c,[{key:"createNode",value:function(n){return new fa(n,null)}}]),c}(),wy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"printEdges",value:function(n){n.println("Edges:");for(var o=0;o<this._edges.size();o++){n.println("edge "+o+":");var a=this._edges.get(o);a.print(n),a.eiList.print(n)}}},{key:"find",value:function(n){return this._nodes.find(n)}},{key:"addNode",value:function(){if(arguments[0]instanceof fa){var n=arguments[0];return this._nodes.addNode(n)}if(arguments[0]instanceof P){var o=arguments[0];return this._nodes.addNode(o)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var n=this._nodes.iterator();n.hasNext();)n.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(n){oe.out.println(n)}},{key:"isBoundaryNode",value:function(n,o){var a=this._nodes.find(o);if(a===null)return!1;var l=a.getLabel();return l!==null&&l.getLocation(n)===T.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var n=this._nodes.iterator();n.hasNext();)n.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(n,o,a,l){return!!n.equals(a)&&ut.index(n,o,l)===ut.COLLINEAR&&ue.quadrant(n,o)===ue.quadrant(a,l)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(n){oe.out.print(n)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(n,o){for(var a=0;a<this._edges.size();a++){var l=this._edges.get(a),d=l.getCoordinates();if(this.matchInSameDirection(n,o,d[0],d[1])||this.matchInSameDirection(n,o,d[d.length-1],d[d.length-2]))return l}return null}},{key:"insertEdge",value:function(n){this._edges.add(n)}},{key:"findEdgeEnd",value:function(n){for(var o=this.getEdgeEnds().iterator();o.hasNext();){var a=o.next();if(a.getEdge()===n)return a}return null}},{key:"addEdges",value:function(n){for(var o=n.iterator();o.hasNext();){var a=o.next();this._edges.add(a);var l=new ql(a,!0),d=new ql(a,!1);l.setSym(d),d.setSym(l),this.add(l),this.add(d)}}},{key:"add",value:function(n){this._nodes.add(n),this._edgeEndList.add(n)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(n,o){for(var a=0;a<this._edges.size();a++){var l=this._edges.get(a),d=l.getCoordinates();if(n.equals(d[0])&&o.equals(d[1]))return l}return null}}],[{key:"constructor_",value:function(){if(this._edges=new ot,this._nodes=null,this._edgeEndList=new ot,arguments.length===0)this._nodes=new Ey(new Iy);else if(arguments.length===1){var n=arguments[0];this._nodes=new Ey(n)}}},{key:"linkResultDirectedEdges",value:function(n){for(var o=n.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()}}]),c}(),pw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"sortShellsAndHoles",value:function(n,o,a){for(var l=n.iterator();l.hasNext();){var d=l.next();d.isHole()?a.add(d):o.add(d)}}},{key:"computePolygons",value:function(n){for(var o=new ot,a=n.iterator();a.hasNext();){var l=a.next().toPolygon(this._geometryFactory);o.add(l)}return o}},{key:"placeFreeHoles",value:function(n,o){for(var a=o.iterator();a.hasNext();){var l=a.next();if(l.getShell()===null){var d=c.findEdgeRingContaining(l,n);if(d===null)throw new _e("unable to assign hole to a shell",l.getCoordinate(0));l.setShell(d)}}}},{key:"buildMinimalEdgeRings",value:function(n,o,a){for(var l=new ot,d=n.iterator();d.hasNext();){var v=d.next();if(v.getMaxNodeDegree()>2){v.linkDirectedEdgesForMinimalEdgeRings();var E=v.buildMinimalRings(),S=this.findShell(E);S!==null?(this.placePolygonHoles(S,E),o.add(S)):a.addAll(E)}else l.add(v)}return l}},{key:"buildMaximalEdgeRings",value:function(n){for(var o=new ot,a=n.iterator();a.hasNext();){var l=a.next();if(l.isInResult()&&l.getLabel().isArea()&&l.getEdgeRing()===null){var d=new dw(l,this._geometryFactory);o.add(d),d.setInResult()}}return o}},{key:"placePolygonHoles",value:function(n,o){for(var a=o.iterator();a.hasNext();){var l=a.next();l.isHole()&&l.setShell(n)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(n){for(var o=0,a=null,l=n.iterator();l.hasNext();){var d=l.next();d.isHole()||(a=d,o++)}return z.isTrue(o<=1,"found two shells in MinimalEdgeRing list"),a}},{key:"add",value:function(){if(arguments.length===1){var n=arguments[0];this.add(n.getEdgeEnds(),n.getNodes())}else if(arguments.length===2){var o=arguments[0],a=arguments[1];wy.linkResultDirectedEdges(a);var l=this.buildMaximalEdgeRings(o),d=new ot,v=this.buildMinimalEdgeRings(l,this._shellList,d);this.sortShellsAndHoles(v,this._shellList,d),this.placeFreeHoles(this._shellList,d)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new ot;var n=arguments[0];this._geometryFactory=n}},{key:"findEdgeRingContaining",value:function(n,o){for(var a=n.getLinearRing(),l=a.getEnvelopeInternal(),d=a.getCoordinateN(0),v=null,E=null,S=o.iterator();S.hasNext();){var w=S.next(),N=w.getLinearRing(),M=N.getEnvelopeInternal();if(!M.equals(l)&&M.contains(l)){d=zt.ptNotInList(a.getCoordinates(),N.getCoordinates());var Y=!1;$l.isInRing(d,N.getCoordinates())&&(Y=!0),Y&&(v===null||E.contains(M))&&(E=(v=w).getLinearRing().getEnvelopeInternal())}}return v}}]),c}(),ky=function(){function c(){e(this,c)}return s(c,[{key:"getBounds",value:function(){}}]),c}(),Nn=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[ky,B]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var n=arguments[0],o=arguments[1];this._bounds=n,this._item=o}}]),c}(),ga=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"poll",value:function(){if(this.isEmpty())return null;var n=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),n}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(n){for(var o=null,a=this._items.get(n);2*n<=this._size&&((o=2*n)!==this._size&&this._items.get(o+1).compareTo(this._items.get(o))<0&&o++,this._items.get(o).compareTo(a)<0);n=o)this._items.set(n,this._items.get(o));this._items.set(n,a)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(n){this._items.add(null),this._size+=1;var o=this._size;for(this._items.set(0,n);n.compareTo(this._items.get(Math.trunc(o/2)))<0;o/=2)this._items.set(o,this._items.get(Math.trunc(o/2)));this._items.set(o,n)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new ot,this._items.add(null)}}]),c}(),mw=function(){function c(){e(this,c)}return s(c,[{key:"insert",value:function(n,o){}},{key:"remove",value:function(n,o){}},{key:"query",value:function(){}}]),c}(),De=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(n){z.isTrue(this._bounds===null),this._childBoundables.add(n)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[ky,B]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new ot,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this._level=n}}}}]),c}(),Rr={reverseOrder:function(){return{compare:function(c,n){return n.compareTo(c)}}},min:function(c){return Rr.sort(c),c.get(0)},sort:function(c,n){var o=c.toArray();n?Dt.sort(o,n):Dt.sort(o);for(var a=c.iterator(),l=0,d=o.length;l<d;l++)a.next(),a.set(o[l])},singletonList:function(c){var n=new ot;return n.add(c),n}},vw=function(){function c(){e(this,c)}return s(c,null,[{key:"maxDistance",value:function(n,o,a,l,d,v,E,S){var w=c.distance(n,o,d,v);return w=Math.max(w,c.distance(n,o,E,S)),w=Math.max(w,c.distance(a,l,d,v)),w=Math.max(w,c.distance(a,l,E,S))}},{key:"distance",value:function(n,o,a,l){var d=a-n,v=l-o;return Math.sqrt(d*d+v*v)}},{key:"maximumDistance",value:function(n,o){var a=Math.min(n.getMinX(),o.getMinX()),l=Math.min(n.getMinY(),o.getMinY()),d=Math.max(n.getMaxX(),o.getMaxX()),v=Math.max(n.getMaxY(),o.getMaxY());return c.distance(a,l,d,v)}},{key:"minMaxDistance",value:function(n,o){var a=n.getMinX(),l=n.getMinY(),d=n.getMaxX(),v=n.getMaxY(),E=o.getMinX(),S=o.getMinY(),w=o.getMaxX(),N=o.getMaxY(),M=c.maxDistance(a,l,a,v,E,S,E,N);return M=Math.min(M,c.maxDistance(a,l,a,v,E,S,w,S)),M=Math.min(M,c.maxDistance(a,l,a,v,w,N,E,N)),M=Math.min(M,c.maxDistance(a,l,a,v,w,N,w,S)),M=Math.min(M,c.maxDistance(a,l,d,l,E,S,E,N)),M=Math.min(M,c.maxDistance(a,l,d,l,E,S,w,S)),M=Math.min(M,c.maxDistance(a,l,d,l,w,N,E,N)),M=Math.min(M,c.maxDistance(a,l,d,l,w,N,w,S)),M=Math.min(M,c.maxDistance(d,v,a,v,E,S,E,N)),M=Math.min(M,c.maxDistance(d,v,a,v,E,S,w,S)),M=Math.min(M,c.maxDistance(d,v,a,v,w,N,E,N)),M=Math.min(M,c.maxDistance(d,v,a,v,w,N,w,S)),M=Math.min(M,c.maxDistance(d,v,d,l,E,S,E,N)),M=Math.min(M,c.maxDistance(d,v,d,l,E,S,w,S)),M=Math.min(M,c.maxDistance(d,v,d,l,w,N,E,N)),M=Math.min(M,c.maxDistance(d,v,d,l,w,N,w,S))}}]),c}(),br=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"maximumDistance",value:function(){return vw.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(n,o){var a=c.isComposite(this._boundable1),l=c.isComposite(this._boundable2);if(a&&l)return c.area(this._boundable1)>c.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,n,o),null):(this.expand(this._boundable2,this._boundable1,!0,n,o),null);if(a)return this.expand(this._boundable1,this._boundable2,!1,n,o),null;if(l)return this.expand(this._boundable2,this._boundable1,!0,n,o),null;throw new L("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(c.isComposite(this._boundable1)||c.isComposite(this._boundable2))}},{key:"compareTo",value:function(n){var o=n;return this._distance<o._distance?-1:this._distance>o._distance?1:0}},{key:"expand",value:function(n,o,a,l,d){for(var v=n.getChildBoundables().iterator();v.hasNext();){var E=v.next(),S=null;(S=a?new c(o,E,this._itemDistance):new c(E,o,this._itemDistance)).getDistance()<d&&l.add(S)}}},{key:"getBoundable",value:function(n){return n===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var n=arguments[0],o=arguments[1],a=arguments[2];this._boundable1=n,this._boundable2=o,this._itemDistance=a,this._distance=this.distance()}},{key:"area",value:function(n){return n.getBounds().getArea()}},{key:"isComposite",value:function(n){return n instanceof De}}]),c}(),Cy=function(){function c(){e(this,c)}return s(c,[{key:"visitItem",value:function(n){}}]),c}(),Tr=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"queryInternal",value:function(){if(ht(arguments[2],Cy)&&arguments[0]instanceof Object&&arguments[1]instanceof De)for(var n=arguments[0],o=arguments[1],a=arguments[2],l=o.getChildBoundables(),d=0;d<l.size();d++){var v=l.get(d);this.getIntersectsOp().intersects(v.getBounds(),n)&&(v instanceof De?this.queryInternal(n,v,a):v instanceof Nn?a.visitItem(v.getItem()):z.shouldNeverReachHere())}else if(ht(arguments[2],je)&&arguments[0]instanceof Object&&arguments[1]instanceof De)for(var E=arguments[0],S=arguments[1],w=arguments[2],N=S.getChildBoundables(),M=0;M<N.size();M++){var Y=N.get(M);this.getIntersectsOp().intersects(Y.getBounds(),E)&&(Y instanceof De?this.queryInternal(E,Y,w):Y instanceof Nn?w.add(Y.getItem()):z.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(n){return n.get(n.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var n=arguments[0],o=0,a=n.getChildBoundables().iterator();a.hasNext();){var l=a.next();l instanceof De?o+=this.size(l):l instanceof Nn&&(o+=1)}return o}}},{key:"removeItem",value:function(n,o){for(var a=null,l=n.getChildBoundables().iterator();l.hasNext();){var d=l.next();d instanceof Nn&&d.getItem()===o&&(a=d)}return a!==null&&(n.getChildBoundables().remove(a),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var n=this.itemsTree(this._root);return n===null?new ot:n}if(arguments.length===1){for(var o=arguments[0],a=new ot,l=o.getChildBoundables().iterator();l.hasNext();){var d=l.next();if(d instanceof De){var v=this.itemsTree(d);v!==null&&a.add(v)}else d instanceof Nn?a.add(d.getItem()):z.shouldNeverReachHere()}return a.size()<=0?null:a}}},{key:"insert",value:function(n,o){z.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Nn(n,o))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var n=arguments[0],o=new ot;return this.boundablesAtLevel(n,this._root,o),o}if(arguments.length===3){var a=arguments[0],l=arguments[1],d=arguments[2];if(z.isTrue(a>-2),l.getLevel()===a)return d.add(l),null;for(var v=l.getChildBoundables().iterator();v.hasNext();){var E=v.next();E instanceof De?this.boundablesAtLevel(a,E,d):(z.isTrue(E instanceof Nn),a===-1&&d.add(E))}return null}}},{key:"query",value:function(){if(arguments.length===1){var n=arguments[0];this.build();var o=new ot;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.queryInternal(n,this._root,o),o}if(arguments.length===2){var a=arguments[0],l=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.queryInternal(a,this._root,l)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.remove(n,this._root,o)}if(arguments.length===3){var a=arguments[0],l=arguments[1],d=arguments[2],v=this.removeItem(l,d);if(v)return!0;for(var E=null,S=l.getChildBoundables().iterator();S.hasNext();){var w=S.next();if(this.getIntersectsOp().intersects(w.getBounds(),a)&&w instanceof De&&(v=this.remove(a,w,d))){E=w;break}}return E!==null&&E.getChildBoundables().isEmpty()&&l.getChildBoundables().remove(E),v}}},{key:"createHigherLevels",value:function(n,o){z.isTrue(!n.isEmpty());var a=this.createParentBoundables(n,o+1);return a.size()===1?a.get(0):this.createHigherLevels(a,o+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var n=arguments[0],o=0,a=n.getChildBoundables().iterator();a.hasNext();){var l=a.next();if(l instanceof De){var d=this.depth(l);d>o&&(o=d)}}return o+1}}},{key:"createParentBoundables",value:function(n,o){z.isTrue(!n.isEmpty());var a=new ot;a.add(this.createNode(o));var l=new ot(n);Rr.sort(l,this.getComparator());for(var d=l.iterator();d.hasNext();){var v=d.next();this.lastNode(a).getChildBoundables().size()===this.getNodeCapacity()&&a.add(this.createNode(o)),this.lastNode(a).addChildBoundable(v)}return a}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[B]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new ot,this._nodeCapacity=null,arguments.length===0)c.constructor_.call(this,c.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var n=arguments[0];z.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}}},{key:"compareDoubles",value:function(n,o){return n>o?1:n<o?-1:0}}]),c}();Tr.IntersectsOp=function(){},Tr.DEFAULT_NODE_CAPACITY=10;var _w=function(){function c(){e(this,c)}return s(c,[{key:"distance",value:function(n,o){}}]),c}(),fn=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"createParentBoundablesFromVerticalSlices",value:function(a,l){z.isTrue(a.length>0);for(var d=new ot,v=0;v<a.length;v++)d.addAll(this.createParentBoundablesFromVerticalSlice(a[v],l));return d}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var a=arguments[0],l=arguments[1];return this.nearestNeighbourK(a,Z.POSITIVE_INFINITY,l)}if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2],S=v,w=new ga;w.add(d);for(var N=new ga;!w.isEmpty()&&S>=0;){var M=w.poll(),Y=M.getDistance();if(Y>=S)break;if(M.isLeaves())if(N.size()<E)N.add(M);else{var W=N.peek();W.getDistance()>Y&&(N.poll(),N.add(M));var q=N.peek();S=q.getDistance()}else M.expandToQueue(w,S)}return o.getItems(N)}}},{key:"createNode",value:function(a){return new Ry(a)}},{key:"size",value:function(){return arguments.length===0?I(h(o.prototype),"size",this).call(this):I(h(o.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Tt))return I(h(o.prototype),"insert",this).apply(this,arguments);var a=arguments[0],l=arguments[1];if(a.isNull())return null;I(h(o.prototype),"insert",this).call(this,a,l)}},{key:"getIntersectsOp",value:function(){return o.intersectsOp}},{key:"verticalSlices",value:function(a,l){for(var d=Math.trunc(Math.ceil(a.size()/l)),v=new Array(l).fill(null),E=a.iterator(),S=0;S<l;S++){v[S]=new ot;for(var w=0;E.hasNext()&&w<d;){var N=E.next();v[S].add(N),w++}}return v}},{key:"query",value:function(){if(arguments.length===1){var a=arguments[0];return I(h(o.prototype),"query",this).call(this,a)}if(arguments.length===2){var l=arguments[0],d=arguments[1];I(h(o.prototype),"query",this).call(this,l,d)}}},{key:"getComparator",value:function(){return o.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(a,l){return I(h(o.prototype),"createParentBoundables",this).call(this,a,l)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Tt){var a=arguments[0],l=arguments[1];return I(h(o.prototype),"remove",this).call(this,a,l)}return I(h(o.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?I(h(o.prototype),"depth",this).call(this):I(h(o.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(a,l){z.isTrue(!a.isEmpty());var d=Math.trunc(Math.ceil(a.size()/this.getNodeCapacity())),v=new ot(a);Rr.sort(v,o.xComparator);var E=this.verticalSlices(v,Math.trunc(Math.ceil(Math.sqrt(d))));return this.createParentBoundablesFromVerticalSlices(E,l)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(ht(arguments[0],_w)){var a=arguments[0];if(this.isEmpty())return null;var l=new br(this.getRoot(),this.getRoot(),a);return this.nearestNeighbour(l)}if(arguments[0]instanceof br){var d=arguments[0],v=Z.POSITIVE_INFINITY,E=null,S=new ga;for(S.add(d);!S.isEmpty()&&v>0;){var w=S.poll(),N=w.getDistance();if(N>=v)break;w.isLeaves()?(v=N,E=w):w.expandToQueue(S,v)}return E===null?null:[E.getBoundable(0).getItem(),E.getBoundable(1).getItem()]}}else{if(arguments.length===2){var M=arguments[0],Y=arguments[1];if(this.isEmpty()||M.isEmpty())return null;var W=new br(this.getRoot(),M.getRoot(),Y);return this.nearestNeighbour(W)}if(arguments.length===3){var q=arguments[0],it=arguments[1],at=arguments[2],gt=new Nn(q,it),Rt=new br(this.getRoot(),gt,at);return this.nearestNeighbour(Rt)[0]}if(arguments.length===4){var Ft=arguments[0],re=arguments[1],we=arguments[2],Je=arguments[3],Mn=new Nn(Ft,re),Gi=new br(this.getRoot(),Mn,we);return this.nearestNeighbourK(Gi,Je)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var a=arguments[0],l=arguments[1],d=Z.POSITIVE_INFINITY,v=new ga;for(v.add(a);!v.isEmpty();){var E=v.poll(),S=E.getDistance();if(S>l)return!1;if(E.maximumDistance()<=l)return!0;if(E.isLeaves()){if((d=S)<=l)return!0}else E.expandToQueue(v,d)}return!1}if(arguments.length===3){var w=arguments[0],N=arguments[1],M=arguments[2],Y=new br(this.getRoot(),w.getRoot(),N);return this.isWithinDistance(Y,M)}}},{key:"interfaces_",get:function(){return[mw,B]}}],[{key:"constructor_",value:function(){if(arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var a=arguments[0];Tr.constructor_.call(this,a)}}},{key:"centreX",value:function(a){return o.avg(a.getMinX(),a.getMaxX())}},{key:"avg",value:function(a,l){return(a+l)/2}},{key:"getItems",value:function(a){for(var l=new Array(a.size()).fill(null),d=0;!a.isEmpty();){var v=a.poll();l[d]=v.getBoundable(0).getItem(),d++}return l}},{key:"centreY",value:function(a){return o.avg(a.getMinY(),a.getMaxY())}}]),o}(Tr),Ry=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"computeBounds",value:function(){for(var a=null,l=this.getChildBoundables().iterator();l.hasNext();){var d=l.next();a===null?a=new Tt(d.getBounds()):a.expandToInclude(d.getBounds())}return a}}],[{key:"constructor_",value:function(){var a=arguments[0];De.constructor_.call(this,a)}}]),o}(De);fn.STRtreeNode=Ry,fn.xComparator=new(function(){function c(){e(this,c)}return s(c,[{key:"interfaces_",get:function(){return[pt]}},{key:"compare",value:function(n,o){return Tr.compareDoubles(fn.centreX(n.getBounds()),fn.centreX(o.getBounds()))}}]),c}()),fn.yComparator=new(function(){function c(){e(this,c)}return s(c,[{key:"interfaces_",get:function(){return[pt]}},{key:"compare",value:function(n,o){return Tr.compareDoubles(fn.centreY(n.getBounds()),fn.centreY(o.getBounds()))}}]),c}()),fn.intersectsOp=new(function(){function c(){e(this,c)}return s(c,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(n,o){return n.intersects(o)}}]),c}()),fn.DEFAULT_NODE_CAPACITY=10;var xw=function(){function c(){e(this,c)}return s(c,null,[{key:"relativeSign",value:function(n,o){return n<o?-1:n>o?1:0}},{key:"compare",value:function(n,o,a){if(o.equals2D(a))return 0;var l=c.relativeSign(o.x,a.x),d=c.relativeSign(o.y,a.y);switch(n){case 0:return c.compareValue(l,d);case 1:return c.compareValue(d,l);case 2:return c.compareValue(d,-l);case 3:return c.compareValue(-l,d);case 4:return c.compareValue(-l,-d);case 5:return c.compareValue(-d,-l);case 6:return c.compareValue(-d,l);case 7:return c.compareValue(l,-d)}return z.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(n,o){return n<0?-1:n>0?1:o<0?-1:o>0?1:0}}]),c}(),Ew=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(n){n.print(this.coord),n.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(n){var o=n;return this.segmentIndex<o.segmentIndex?-1:this.segmentIndex>o.segmentIndex?1:this.coord.equals2D(o.coord)?0:this._isInterior?o._isInterior?xw.compare(this._segmentOctant,this.coord,o.coord):1:-1}},{key:"isEndPoint",value:function(n){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===n}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];this._segString=n,this.coord=new P(o),this.segmentIndex=a,this._segmentOctant=l,this._isInterior=!o.equals2D(n.getCoordinate(a))}}]),c}(),Sw=function(){function c(){e(this,c)}return s(c,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),c}(),Iw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getSplitCoordinates",value:function(){var n=new bs;this.addEndpoints();for(var o=this.iterator(),a=o.next();o.hasNext();){var l=o.next();this.addEdgeCoordinates(a,l,n),a=l}return n.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var n=new ot;this.findCollapsesFromInsertedNodes(n),this.findCollapsesFromExistingVertices(n);for(var o=n.iterator();o.hasNext();){var a=o.next().intValue();this.add(this._edge.getCoordinate(a),a)}}},{key:"createSplitEdgePts",value:function(n,o){var a=o.segmentIndex-n.segmentIndex+2;if(a===2)return[new P(n.coord),new P(o.coord)];var l=this._edge.getCoordinate(o.segmentIndex),d=o.isInterior()||!o.coord.equals2D(l);d||a--;var v=new Array(a).fill(null),E=0;v[E++]=new P(n.coord);for(var S=n.segmentIndex+1;S<=o.segmentIndex;S++)v[E++]=this._edge.getCoordinate(S);return d&&(v[E]=new P(o.coord)),v}},{key:"print",value:function(n){n.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(n)}},{key:"findCollapsesFromExistingVertices",value:function(n){for(var o=0;o<this._edge.size()-2;o++){var a=this._edge.getCoordinate(o);this._edge.getCoordinate(o+1);var l=this._edge.getCoordinate(o+2);a.equals2D(l)&&n.add(si.valueOf(o+1))}}},{key:"addEdgeCoordinates",value:function(n,o,a){var l=this.createSplitEdgePts(n,o);a.add(l,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(n){this.addEndpoints(),this.addCollapsedNodes();for(var o=this.iterator(),a=o.next();o.hasNext();){var l=o.next(),d=this.createSplitEdge(a,l);n.add(d),a=l}}},{key:"findCollapseIndex",value:function(n,o,a){if(!n.coord.equals2D(o.coord))return!1;var l=o.segmentIndex-n.segmentIndex;return o.isInterior()||l--,l===1&&(a[0]=n.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(n){for(var o=new Array(1).fill(null),a=this.iterator(),l=a.next();a.hasNext();){var d=a.next();this.findCollapseIndex(l,d,o)&&n.add(si.valueOf(o[0])),l=d}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var n=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(n),n)}},{key:"createSplitEdge",value:function(n,o){var a=this.createSplitEdgePts(n,o);return new Fi(a,this._edge.getData())}},{key:"add",value:function(n,o){var a=new Ew(this._edge,n,o,this._edge.getSegmentOctant(o)),l=this._nodeMap.get(a);return l!==null?(z.isTrue(l.coord.equals2D(n),"Found equal nodes with different coordinates"),l):(this._nodeMap.put(a,a),a)}},{key:"checkSplitEdgesCorrectness",value:function(n){var o=this._edge.getCoordinates(),a=n.get(0).getCoordinate(0);if(!a.equals2D(o[0]))throw new vt("bad split edge start point at "+a);var l=n.get(n.size()-1).getCoordinates(),d=l[l.length-1];if(!d.equals2D(o[o.length-1]))throw new vt("bad split edge end point at "+d)}}],[{key:"constructor_",value:function(){this._nodeMap=new Ms,this._edge=null;var n=arguments[0];this._edge=n}}]),c}(),ww=function(){function c(){e(this,c)}return s(c,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],o=arguments[1];if(n===0&&o===0)throw new L("Cannot compute the octant for point ( "+n+", "+o+" )");var a=Math.abs(n),l=Math.abs(o);return n>=0?o>=0?a>=l?0:1:a>=l?7:6:o>=0?a>=l?3:2:a>=l?4:5}if(arguments[0]instanceof P&&arguments[1]instanceof P){var d=arguments[0],v=arguments[1],E=v.x-d.x,S=v.y-d.y;if(E===0&&S===0)throw new L("Cannot compute the octant for two identical points "+d);return c.octant(E,S)}}}]),c}(),kw=function(){function c(){e(this,c)}return s(c,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(n){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(n){}},{key:"getData",value:function(){}}]),c}(),Cw=function(){function c(){e(this,c)}return s(c,[{key:"addIntersection",value:function(n,o){}},{key:"interfaces_",get:function(){return[kw]}}]),c}(),Fi=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(n){return this._pts[n]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(n){return n===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(n),this.getCoordinate(n+1))}},{key:"setData",value:function(n){this._data=n}},{key:"safeOctant",value:function(n,o){return n.equals2D(o)?0:ww.octant(n,o)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];this.addIntersectionNode(n,o)}else if(arguments.length===4){var a=arguments[0],l=arguments[1],d=arguments[3],v=new P(a.getIntersection(d));this.addIntersection(v,l)}}},{key:"toString",value:function(){return zl.toLineString(new Ts(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(n,o){var a=o,l=a+1;if(l<this._pts.length){var d=this._pts[l];n.equals2D(d)&&(a=l)}return this._nodeList.add(n,a)}},{key:"addIntersections",value:function(n,o,a){for(var l=0;l<n.getIntersectionNum();l++)this.addIntersection(n,o,a,l)}},{key:"interfaces_",get:function(){return[Cw]}}],[{key:"constructor_",value:function(){this._nodeList=new Iw(this),this._pts=null,this._data=null;var n=arguments[0],o=arguments[1];this._pts=n,this._data=o}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var n=arguments[0],o=new ot;return c.getNodedSubstrings(n,o),o}if(arguments.length===2)for(var a=arguments[0],l=arguments[1],d=a.iterator();d.hasNext();){var v=d.next();v.getNodeList().addSplitEdges(l)}}}]),c}(),Se=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof c){var n=arguments[0],o=ut.index(this.p0,this.p1,n.p0),a=ut.index(this.p0,this.p1,n.p1);return o>=0&&a>=0||o<=0&&a<=0?Math.max(o,a):0}if(arguments[0]instanceof P){var l=arguments[0];return ut.index(this.p0,this.p1,l)}}},{key:"toGeometry",value:function(n){return n.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(n){if(!(n instanceof c))return!1;var o=n;return this.p0.equals(o.p0)&&this.p1.equals(o.p1)}},{key:"intersection",value:function(n){var o=new Di;return o.computeIntersection(this.p0,this.p1,n.p0,n.p1),o.hasIntersection()?o.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof P){var n=arguments[0];if(n.equals(this.p0)||n.equals(this.p1))return new P(n);var o=this.projectionFactor(n),a=new P;return a.x=this.p0.x+o*(this.p1.x-this.p0.x),a.y=this.p0.y+o*(this.p1.y-this.p0.y),a}if(arguments[0]instanceof c){var l=arguments[0],d=this.projectionFactor(l.p0),v=this.projectionFactor(l.p1);if(d>=1&&v>=1||d<=0&&v<=0)return null;var E=this.project(l.p0);d<0&&(E=this.p0),d>1&&(E=this.p1);var S=this.project(l.p1);return v<0&&(S=this.p0),v>1&&(S=this.p1),new c(E,S)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(n){return n===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(n){return ie.pointToLinePerpendicular(n,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return c.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(n){if(n.equals(this.p0))return 0;if(n.equals(this.p1))return 1;var o=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,l=o*o+a*a;return l<=0?Z.NaN:((n.x-this.p0.x)*o+(n.y-this.p0.y)*a)/l}},{key:"closestPoints",value:function(n){var o=this.intersection(n);if(o!==null)return[o,o];var a=new Array(2).fill(null),l=Z.MAX_VALUE,d=null,v=this.closestPoint(n.p0);l=v.distance(n.p0),a[0]=v,a[1]=n.p0;var E=this.closestPoint(n.p1);(d=E.distance(n.p1))<l&&(l=d,a[0]=E,a[1]=n.p1);var S=n.closestPoint(this.p0);(d=S.distance(this.p0))<l&&(l=d,a[0]=this.p0,a[1]=S);var w=n.closestPoint(this.p1);return(d=w.distance(this.p1))<l&&(l=d,a[0]=this.p1,a[1]=w),a}},{key:"closestPoint",value:function(n){var o=this.projectionFactor(n);return o>0&&o<1?this.project(n):this.p0.distance(n)<this.p1.distance(n)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(n){var o=n,a=this.p0.compareTo(o.p0);return a!==0?a:this.p1.compareTo(o.p1)}},{key:"reverse",value:function(){var n=this.p0;this.p0=this.p1,this.p1=n}},{key:"equalsTopo",value:function(n){return this.p0.equals(n.p0)&&this.p1.equals(n.p1)||this.p0.equals(n.p1)&&this.p1.equals(n.p0)}},{key:"lineIntersection",value:function(n){return Li.intersection(this.p0,this.p1,n.p0,n.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(n,o){var a=this.p0.x+n*(this.p1.x-this.p0.x),l=this.p0.y+n*(this.p1.y-this.p0.y),d=this.p1.x-this.p0.x,v=this.p1.y-this.p0.y,E=Math.sqrt(d*d+v*v),S=0,w=0;if(o!==0){if(E<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");S=o*d/E,w=o*v/E}return new P(a-w,l+S)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var n=arguments[0];this.setCoordinates(n.p0,n.p1)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.p0.x=o.x,this.p0.y=o.y,this.p1.x=a.x,this.p1.y=a.y}}},{key:"segmentFraction",value:function(n){var o=this.projectionFactor(n);return o<0?o=0:(o>1||Z.isNaN(o))&&(o=1),o}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(n){var o=this.p1.getY()-this.p0.getY(),a=this.p0.getX()-this.p1.getX(),l=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),d=o*o+a*a,v=o*o-a*a,E=n.getX(),S=n.getY();return new P((-v*E-2*o*a*S-2*o*l)/d,(v*S-2*o*a*E-2*a*l)/d)}},{key:"distance",value:function(){if(arguments[0]instanceof c){var n=arguments[0];return ie.segmentToSegment(this.p0,this.p1,n.p0,n.p1)}if(arguments[0]instanceof P){var o=arguments[0];return ie.pointToSegment(o,this.p0,this.p1)}}},{key:"pointAlong",value:function(n){var o=new P;return o.x=this.p0.x+n*(this.p1.x-this.p0.x),o.y=this.p0.y+n*(this.p1.y-this.p0.y),o}},{key:"hashCode",value:function(){var n=Z.doubleToLongBits(this.p0.x);n^=31*Z.doubleToLongBits(this.p0.y);var o=Math.trunc(n)^Math.trunc(n>>32),a=Z.doubleToLongBits(this.p1.x);return a^=31*Z.doubleToLongBits(this.p1.y),o^(Math.trunc(a)^Math.trunc(a>>32))}},{key:"interfaces_",get:function(){return[F,B]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)c.constructor_.call(this,new P,new P);else if(arguments.length===1){var n=arguments[0];c.constructor_.call(this,n.p0,n.p1)}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this.p0=o,this.p1=a}else if(arguments.length===4){var l=arguments[0],d=arguments[1],v=arguments[2],E=arguments[3];c.constructor_.call(this,new P(l,d),new P(v,E))}}},{key:"midPoint",value:function(n,o){return new P((n.x+o.x)/2,(n.y+o.y)/2)}}]),c}(),Rw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];n.getLineSegment(o,this._overlapSeg1),a.getLineSegment(l,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Se,this._overlapSeg2=new Se}}]),c}(),by=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getLineSegment",value:function(n,o){o.p0=this._pts[n],o.p1=this._pts[n+1]}},{key:"computeSelect",value:function(n,o,a,l){var d=this._pts[o],v=this._pts[a];if(a-o==1)return l.select(this,o),null;if(!n.intersects(d,v))return null;var E=Math.trunc((o+a)/2);o<E&&this.computeSelect(n,o,E,l),E<a&&this.computeSelect(n,E,a,l)}},{key:"getCoordinates",value:function(){for(var n=new Array(this._end-this._start+1).fill(null),o=0,a=this._start;a<=this._end;a++)n[o++]=this._pts[a];return n}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];this.computeOverlaps(this._start,this._end,n,n._start,n._end,o)}else if(arguments.length===6){var a=arguments[0],l=arguments[1],d=arguments[2],v=arguments[3],E=arguments[4],S=arguments[5];if(l-a==1&&E-v==1)return S.overlap(this,a,d,v),null;if(!this.overlaps(a,l,d,v,E))return null;var w=Math.trunc((a+l)/2),N=Math.trunc((v+E)/2);a<w&&(v<N&&this.computeOverlaps(a,w,d,v,N,S),N<E&&this.computeOverlaps(a,w,d,N,E,S)),w<l&&(v<N&&this.computeOverlaps(w,l,d,v,N,S),N<E&&this.computeOverlaps(w,l,d,N,E,S))}}},{key:"setId",value:function(n){this._id=n}},{key:"select",value:function(n,o){this.computeSelect(n,this._start,this._end,o)}},{key:"getEnvelope",value:function(){if(this._env===null){var n=this._pts[this._start],o=this._pts[this._end];this._env=new Tt(n,o)}return this._env}},{key:"overlaps",value:function(n,o,a,l,d){return Tt.intersects(this._pts[n],this._pts[o],a._pts[l],a._pts[d])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];this._pts=n,this._start=o,this._end=a,this._context=l}}]),c}(),bw=function(){function c(){e(this,c)}return s(c,null,[{key:"findChainEnd",value:function(n,o){for(var a=o;a<n.length-1&&n[a].equals2D(n[a+1]);)a++;if(a>=n.length-1)return n.length-1;for(var l=ue.quadrant(n[a],n[a+1]),d=o+1;d<n.length&&!(!n[d-1].equals2D(n[d])&&ue.quadrant(n[d-1],n[d])!==l);)d++;return d-1}},{key:"getChains",value:function(){if(arguments.length===1){var n=arguments[0];return c.getChains(n,null)}if(arguments.length===2){var o=arguments[0],a=arguments[1],l=new ot,d=0;do{var v=c.findChainEnd(o,d),E=new by(o,d,v,a);l.add(E),d=v}while(d<o.length-1);return l}}}]),c}(),Wl=function(){function c(){e(this,c)}return s(c,[{key:"computeNodes",value:function(n){}},{key:"getNodedSubstrings",value:function(){}}]),c}(),Ty=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"setSegmentIntersector",value:function(n){this._segInt=n}},{key:"interfaces_",get:function(){return[Wl]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var n=arguments[0];this.setSegmentIntersector(n)}}}}]),c}(),Ul=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return Fi.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(a){for(var l=bw.getChains(a.getCoordinates(),a).iterator();l.hasNext();){var d=l.next();d.setId(this._idCounter++),this._index.insert(d.getEnvelope(),d),this._monoChains.add(d)}}},{key:"computeNodes",value:function(a){this._nodedSegStrings=a;for(var l=a.iterator();l.hasNext();)this.add(l.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var a=new Ny(this._segInt),l=this._monoChains.iterator();l.hasNext();)for(var d=l.next(),v=this._index.query(d.getEnvelope()).iterator();v.hasNext();){var E=v.next();if(E.getId()>d.getId()&&(d.computeOverlaps(E,a),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new ot,this._index=new fn,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var a=arguments[0];Ty.constructor_.call(this,a)}}}}]),o}(Ty),Ny=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"overlap",value:function(){if(arguments.length!==4)return I(h(o.prototype),"overlap",this).apply(this,arguments);var a=arguments[0],l=arguments[1],d=arguments[2],v=arguments[3],E=a.getContext(),S=d.getContext();this._si.processIntersections(E,l,S,v)}}],[{key:"constructor_",value:function(){this._si=null;var a=arguments[0];this._si=a}}]),o}(Rw);Ul.SegmentOverlapAction=Ny;var He=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"isDeletable",value:function(n,o,a,l){var d=this._inputLine[n],v=this._inputLine[o],E=this._inputLine[a];return!!this.isConcave(d,v,E)&&!!this.isShallow(d,v,E,l)&&this.isShallowSampled(d,v,n,a,l)}},{key:"deleteShallowConcavities",value:function(){for(var n=1,o=this.findNextNonDeletedIndex(n),a=this.findNextNonDeletedIndex(o),l=!1;a<this._inputLine.length;){var d=!1;this.isDeletable(n,o,a,this._distanceTol)&&(this._isDeleted[o]=c.DELETE,d=!0,l=!0),n=d?a:o,o=this.findNextNonDeletedIndex(n),a=this.findNextNonDeletedIndex(o)}return l}},{key:"isShallowConcavity",value:function(n,o,a,l){return ut.index(n,o,a)===this._angleOrientation&&ie.pointToSegment(o,n,a)<l}},{key:"isShallowSampled",value:function(n,o,a,l,d){var v=Math.trunc((l-a)/c.NUM_PTS_TO_CHECK);v<=0&&(v=1);for(var E=a;E<l;E+=v)if(!this.isShallow(n,o,this._inputLine[E],d))return!1;return!0}},{key:"isConcave",value:function(n,o,a){var l=ut.index(n,o,a)===this._angleOrientation;return l}},{key:"simplify",value:function(n){this._distanceTol=Math.abs(n),n<0&&(this._angleOrientation=ut.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var o=!1;do o=this.deleteShallowConcavities();while(o);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(n){for(var o=n+1;o<this._inputLine.length&&this._isDeleted[o]===c.DELETE;)o++;return o}},{key:"isShallow",value:function(n,o,a,l){return ie.pointToSegment(o,n,a)<l}},{key:"collapseLine",value:function(){for(var n=new bs,o=0;o<this._inputLine.length;o++)this._isDeleted[o]!==c.DELETE&&n.add(this._inputLine[o]);return n.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ut.COUNTERCLOCKWISE;var n=arguments[0];this._inputLine=n}},{key:"simplify",value:function(n,o){return new c(n).simplify(o)}}]),c}();He.INIT=0,He.DELETE=1,He.KEEP=1,He.NUM_PTS_TO_CHECK=10;var My=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getCoordinates",value:function(){return this._ptList.toArray(c.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(n){this._precisionModel=n}},{key:"addPt",value:function(n){var o=new P(n);if(this._precisionModel.makePrecise(o),this.isRedundant(o))return null;this._ptList.add(o)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(n,o){if(o)for(var a=0;a<n.length;a++)this.addPt(n[a]);else for(var l=n.length-1;l>=0;l--)this.addPt(n[l])}},{key:"isRedundant",value:function(n){if(this._ptList.size()<1)return!1;var o=this._ptList.get(this._ptList.size()-1);return n.distance(o)<this._minimimVertexDistance}},{key:"toString",value:function(){return new kr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var n=new P(this._ptList.get(0)),o=this._ptList.get(this._ptList.size()-1);if(n.equals(o))return null;this._ptList.add(n)}},{key:"setMinimumVertexDistance",value:function(n){this._minimimVertexDistance=n}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new ot}}]),c}();My.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Ie=function(){function c(){e(this,c)}return s(c,null,[{key:"toDegrees",value:function(n){return 180*n/Math.PI}},{key:"normalize",value:function(n){for(;n>Math.PI;)n-=c.PI_TIMES_2;for(;n<=-Math.PI;)n+=c.PI_TIMES_2;return n}},{key:"angle",value:function(){if(arguments.length===1){var n=arguments[0];return Math.atan2(n.y,n.x)}if(arguments.length===2){var o=arguments[0],a=arguments[1],l=a.x-o.x,d=a.y-o.y;return Math.atan2(d,l)}}},{key:"isAcute",value:function(n,o,a){var l=n.x-o.x,d=n.y-o.y;return l*(a.x-o.x)+d*(a.y-o.y)>0}},{key:"isObtuse",value:function(n,o,a){var l=n.x-o.x,d=n.y-o.y;return l*(a.x-o.x)+d*(a.y-o.y)<0}},{key:"interiorAngle",value:function(n,o,a){var l=c.angle(o,n),d=c.angle(o,a);return Math.abs(d-l)}},{key:"normalizePositive",value:function(n){if(n<0){for(;n<0;)n+=c.PI_TIMES_2;n>=c.PI_TIMES_2&&(n=0)}else{for(;n>=c.PI_TIMES_2;)n-=c.PI_TIMES_2;n<0&&(n=0)}return n}},{key:"angleBetween",value:function(n,o,a){var l=c.angle(o,n),d=c.angle(o,a);return c.diff(l,d)}},{key:"diff",value:function(n,o){var a=null;return(a=n<o?o-n:n-o)>Math.PI&&(a=2*Math.PI-a),a}},{key:"toRadians",value:function(n){return n*Math.PI/180}},{key:"getTurn",value:function(n,o){var a=Math.sin(o-n);return a>0?c.COUNTERCLOCKWISE:a<0?c.CLOCKWISE:c.NONE}},{key:"angleBetweenOriented",value:function(n,o,a){var l=c.angle(o,n),d=c.angle(o,a)-l;return d<=-Math.PI?d+c.PI_TIMES_2:d>Math.PI?d-c.PI_TIMES_2:d}}]),c}();Ie.PI_TIMES_2=2*Math.PI,Ie.PI_OVER_2=Math.PI/2,Ie.PI_OVER_4=Math.PI/4,Ie.COUNTERCLOCKWISE=ut.COUNTERCLOCKWISE,Ie.CLOCKWISE=ut.CLOCKWISE,Ie.NONE=ut.COLLINEAR;var Os=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"addNextSegment",value:function(n,o){if(this._s0=this._s1,this._s1=this._s2,this._s2=n,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var a=ut.index(this._s0,this._s1,this._s2),l=a===ut.CLOCKWISE&&this._side===U.LEFT||a===ut.COUNTERCLOCKWISE&&this._side===U.RIGHT;a===0?this.addCollinear(o):l?this.addOutsideTurn(a,o):this.addInsideTurn(a,o)}},{key:"addLineEndCap",value:function(n,o){var a=new Se(n,o),l=new Se;this.computeOffsetSegment(a,U.LEFT,this._distance,l);var d=new Se;this.computeOffsetSegment(a,U.RIGHT,this._distance,d);var v=o.x-n.x,E=o.y-n.y,S=Math.atan2(E,v);switch(this._bufParams.getEndCapStyle()){case O.CAP_ROUND:this._segList.addPt(l.p1),this.addDirectedFillet(o,S+Math.PI/2,S-Math.PI/2,ut.CLOCKWISE,this._distance),this._segList.addPt(d.p1);break;case O.CAP_FLAT:this._segList.addPt(l.p1),this._segList.addPt(d.p1);break;case O.CAP_SQUARE:var w=new P;w.x=Math.abs(this._distance)*Math.cos(S),w.y=Math.abs(this._distance)*Math.sin(S);var N=new P(l.p1.x+w.x,l.p1.y+w.y),M=new P(d.p1.x+w.x,d.p1.y+w.y);this._segList.addPt(N),this._segList.addPt(M)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(n,o,a,l){var d=Li.intersection(o.p0,o.p1,a.p0,a.p1);if(d!==null&&(l<=0?1:d.distance(n)/Math.abs(l))<=this._bufParams.getMitreLimit())return this._segList.addPt(d),null;this.addLimitedMitreJoin(o,a,l,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(n,o){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*c.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===O.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===O.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(o&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,n,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(n){this._segList.addPt(new P(n.x+this._distance,n.y+this._distance)),this._segList.addPt(new P(n.x+this._distance,n.y-this._distance)),this._segList.addPt(new P(n.x-this._distance,n.y-this._distance)),this._segList.addPt(new P(n.x-this._distance,n.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(n,o){this._segList.addPts(n,o)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(n,o,a,l,d){var v=o.x-n.x,E=o.y-n.y,S=Math.atan2(E,v),w=a.x-n.x,N=a.y-n.y,M=Math.atan2(N,w);l===ut.CLOCKWISE?S<=M&&(S+=2*Math.PI):S>=M&&(S-=2*Math.PI),this._segList.addPt(o),this.addDirectedFillet(n,S,M,l,d),this._segList.addPt(a)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(n,o,a){this._s1=n,this._s2=o,this._side=a,this._seg1.setCoordinates(n,o),this.computeOffsetSegment(this._seg1,a,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(n,o,a,l){var d=this._seg0.p1,v=Ie.angle(d,this._seg0.p0),E=Ie.angleBetweenOriented(this._seg0.p0,d,this._seg1.p1)/2,S=Ie.normalize(v+E),w=Ie.normalize(S+Math.PI),N=l*a,M=a-N*Math.abs(Math.sin(E)),Y=d.x+N*Math.cos(w),W=d.y+N*Math.sin(w),q=new P(Y,W),it=new Se(d,q),at=it.pointAlongOffset(1,M),gt=it.pointAlongOffset(1,-M);this._side===U.LEFT?(this._segList.addPt(at),this._segList.addPt(gt)):(this._segList.addPt(gt),this._segList.addPt(at))}},{key:"addDirectedFillet",value:function(n,o,a,l,d){var v=l===ut.CLOCKWISE?-1:1,E=Math.abs(o-a),S=Math.trunc(E/this._filletAngleQuantum+.5);if(S<1)return null;for(var w=E/S,N=new P,M=0;M<S;M++){var Y=o+v*M*w;N.x=n.x+d*Math.cos(Y),N.y=n.y+d*Math.sin(Y),this._segList.addPt(N)}}},{key:"computeOffsetSegment",value:function(n,o,a,l){var d=o===U.LEFT?1:-1,v=n.p1.x-n.p0.x,E=n.p1.y-n.p0.y,S=Math.sqrt(v*v+E*E),w=d*a*v/S,N=d*a*E/S;l.p0.x=n.p0.x-N,l.p0.y=n.p0.y+w,l.p1.x=n.p1.x-N,l.p1.y=n.p1.y+w}},{key:"addInsideTurn",value:function(n,o){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*c.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var a=new P((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(a);var l=new P((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(l)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(n){var o=new P(n.x+this._distance,n.y);this._segList.addPt(o),this.addDirectedFillet(n,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(n,o){this._segList.addPt(n.p1),this._segList.addPt(o.p0)}},{key:"init",value:function(n){this._distance=n,this._maxCurveSegmentError=n*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new My,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(n*c.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(n){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===O.JOIN_BEVEL||this._bufParams.getJoinStyle()===O.JOIN_MITRE?(n&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,ut.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Se,this._seg1=new Se,this._offset0=new Se,this._offset1=new Se,this._side=0,this._hasNarrowConcaveAngle=!1;var n=arguments[0],o=arguments[1],a=arguments[2];this._precisionModel=n,this._bufParams=o,this._li=new Di,this._filletAngleQuantum=Math.PI/2/o.getQuadrantSegments(),o.getQuadrantSegments()>=8&&o.getJoinStyle()===O.JOIN_ROUND&&(this._closingSegLengthFactor=c.MAX_CLOSING_SEG_LEN_FACTOR),this.init(a)}}]),c}();Os.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Os.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Os.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Os.MAX_CLOSING_SEG_LEN_FACTOR=80;var Tw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getOffsetCurve",value:function(n,o){if(this._distance=o,o===0)return null;var a=o<0,l=Math.abs(o),d=this.getSegGen(l);n.length<=1?this.computePointCurve(n[0],d):this.computeOffsetCurve(n,a,d);var v=d.getCoordinates();return a&&zt.reverse(v),v}},{key:"computeSingleSidedBufferCurve",value:function(n,o,a){var l=this.simplifyTolerance(this._distance);if(o){a.addSegments(n,!0);var d=He.simplify(n,-l),v=d.length-1;a.initSideSegments(d[v],d[v-1],U.LEFT),a.addFirstSegment();for(var E=v-2;E>=0;E--)a.addNextSegment(d[E],!0)}else{a.addSegments(n,!1);var S=He.simplify(n,l),w=S.length-1;a.initSideSegments(S[0],S[1],U.LEFT),a.addFirstSegment();for(var N=2;N<=w;N++)a.addNextSegment(S[N],!0)}a.addLastSegment(),a.closeRing()}},{key:"computeRingBufferCurve",value:function(n,o,a){var l=this.simplifyTolerance(this._distance);o===U.RIGHT&&(l=-l);var d=He.simplify(n,l),v=d.length-1;a.initSideSegments(d[v-1],d[0],o);for(var E=1;E<=v;E++){var S=E!==1;a.addNextSegment(d[E],S)}a.closeRing()}},{key:"computeLineBufferCurve",value:function(n,o){var a=this.simplifyTolerance(this._distance),l=He.simplify(n,a),d=l.length-1;o.initSideSegments(l[0],l[1],U.LEFT);for(var v=2;v<=d;v++)o.addNextSegment(l[v],!0);o.addLastSegment(),o.addLineEndCap(l[d-1],l[d]);var E=He.simplify(n,-a),S=E.length-1;o.initSideSegments(E[S],E[S-1],U.LEFT);for(var w=S-2;w>=0;w--)o.addNextSegment(E[w],!0);o.addLastSegment(),o.addLineEndCap(E[1],E[0]),o.closeRing()}},{key:"computePointCurve",value:function(n,o){switch(this._bufParams.getEndCapStyle()){case O.CAP_ROUND:o.createCircle(n);break;case O.CAP_SQUARE:o.createSquare(n)}}},{key:"getLineCurve",value:function(n,o){if(this._distance=o,this.isLineOffsetEmpty(o))return null;var a=Math.abs(o),l=this.getSegGen(a);if(n.length<=1)this.computePointCurve(n[0],l);else if(this._bufParams.isSingleSided()){var d=o<0;this.computeSingleSidedBufferCurve(n,d,l)}else this.computeLineBufferCurve(n,l);return l.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(n){return n*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(n,o,a){if(this._distance=a,n.length<=2)return this.getLineCurve(n,a);if(a===0)return c.copyCoordinates(n);var l=this.getSegGen(a);return this.computeRingBufferCurve(n,o,l),l.getCoordinates()}},{key:"computeOffsetCurve",value:function(n,o,a){var l=this.simplifyTolerance(this._distance);if(o){var d=He.simplify(n,-l),v=d.length-1;a.initSideSegments(d[v],d[v-1],U.LEFT),a.addFirstSegment();for(var E=v-2;E>=0;E--)a.addNextSegment(d[E],!0)}else{var S=He.simplify(n,l),w=S.length-1;a.initSideSegments(S[0],S[1],U.LEFT),a.addFirstSegment();for(var N=2;N<=w;N++)a.addNextSegment(S[N],!0)}a.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(n){return n===0||n<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(n){return new Os(this._precisionModel,this._bufParams,n)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var n=arguments[0],o=arguments[1];this._precisionModel=n,this._bufParams=o}},{key:"copyCoordinates",value:function(n){for(var o=new Array(n.length).fill(null),a=0;a<o.length;a++)o[a]=new P(n[a]);return o}}]),c}(),Oy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var n=arguments[0],o=new ot,a=this._subgraphs.iterator();a.hasNext();){var l=a.next(),d=l.getEnvelope();n.y<d.getMinY()||n.y>d.getMaxY()||this.findStabbedSegments(n,l.getDirectedEdges(),o)}return o}if(arguments.length===3){if(ht(arguments[2],je)&&arguments[0]instanceof P&&arguments[1]instanceof ql)for(var v=arguments[0],E=arguments[1],S=arguments[2],w=E.getEdge().getCoordinates(),N=0;N<w.length-1;N++){this._seg.p0=w[N],this._seg.p1=w[N+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var M=Math.max(this._seg.p0.x,this._seg.p1.x);if(!(M<v.x)&&!(this._seg.isHorizontal()||v.y<this._seg.p0.y||v.y>this._seg.p1.y||ut.index(this._seg.p0,this._seg.p1,v)===ut.RIGHT)){var Y=E.getDepth(U.LEFT);this._seg.p0.equals(w[N])||(Y=E.getDepth(U.RIGHT));var W=new Ly(this._seg,Y);S.add(W)}}else if(ht(arguments[2],je)&&arguments[0]instanceof P&&ht(arguments[1],je))for(var q=arguments[0],it=arguments[1],at=arguments[2],gt=it.iterator();gt.hasNext();){var Rt=gt.next();Rt.isForward()&&this.findStabbedSegments(q,Rt,at)}}}},{key:"getDepth",value:function(n){var o=this.findStabbedSegments(n);return o.size()===0?0:Rr.min(o)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Se;var n=arguments[0];this._subgraphs=n}}]),c}(),Ly=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"compareTo",value:function(n){var o=n;if(this._upwardSeg.minX()>=o._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=o._upwardSeg.minX())return-1;var a=this._upwardSeg.orientationIndex(o._upwardSeg);return a!==0||(a=-1*o._upwardSeg.orientationIndex(this._upwardSeg))!==0?a:this._upwardSeg.compareTo(o._upwardSeg)}},{key:"compareX",value:function(n,o){var a=n.p0.compareTo(o.p0);return a!==0?a:n.p1.compareTo(o.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var n=arguments[0],o=arguments[1];this._upwardSeg=new Se(n),this._leftDepth=o}}]),c}();Oy.DepthSegment=Ly;var Ay=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,null,[{key:"constructor_",value:function(){A.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),o}(A),jl=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getY",value:function(){var n=this.y/this.w;if(Z.isNaN(n)||Z.isInfinite(n))throw new Ay;return n}},{key:"getX",value:function(){var n=this.x/this.w;if(Z.isNaN(n)||Z.isInfinite(n))throw new Ay;return n}},{key:"getCoordinate",value:function(){var n=new P;return n.x=this.getX(),n.y=this.getY(),n}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var n=arguments[0];this.x=n.x,this.y=n.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],a=arguments[1];this.x=o,this.y=a,this.w=1}else if(arguments[0]instanceof c&&arguments[1]instanceof c){var l=arguments[0],d=arguments[1];this.x=l.y*d.w-d.y*l.w,this.y=d.x*l.w-l.x*d.w,this.w=l.x*d.y-d.x*l.y}else if(arguments[0]instanceof P&&arguments[1]instanceof P){var v=arguments[0],E=arguments[1];this.x=v.y-E.y,this.y=E.x-v.x,this.w=v.x*E.y-E.x*v.y}}else if(arguments.length===3){var S=arguments[0],w=arguments[1],N=arguments[2];this.x=S,this.y=w,this.w=N}else if(arguments.length===4){var M=arguments[0],Y=arguments[1],W=arguments[2],q=arguments[3],it=M.y-Y.y,at=Y.x-M.x,gt=M.x*Y.y-Y.x*M.y,Rt=W.y-q.y,Ft=q.x-W.x,re=W.x*q.y-q.x*W.y;this.x=at*re-Ft*gt,this.y=Rt*gt-it*re,this.w=it*Ft-Rt*at}}}]),c}(),Nw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"area",value:function(){return c.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return c.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(n){if(n===null)throw new L("Supplied point is null.");return c.interpolateZ(n,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return c.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return c.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return c.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return c.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return c.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return c.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var n=arguments[0],o=arguments[1],a=arguments[2];this.p0=n,this.p1=o,this.p2=a}},{key:"area",value:function(n,o,a){return Math.abs(((a.x-n.x)*(o.y-n.y)-(o.x-n.x)*(a.y-n.y))/2)}},{key:"signedArea",value:function(n,o,a){return((a.x-n.x)*(o.y-n.y)-(o.x-n.x)*(a.y-n.y))/2}},{key:"det",value:function(n,o,a,l){return n*l-o*a}},{key:"interpolateZ",value:function(n,o,a,l){var d=o.x,v=o.y,E=a.x-d,S=l.x-d,w=a.y-v,N=l.y-v,M=E*N-S*w,Y=n.x-d,W=n.y-v,q=(N*Y-S*W)/M,it=(-w*Y+E*W)/M;return o.getZ()+q*(a.getZ()-o.getZ())+it*(l.getZ()-o.getZ())}},{key:"longestSideLength",value:function(n,o,a){var l=n.distance(o),d=o.distance(a),v=a.distance(n),E=l;return d>E&&(E=d),v>E&&(E=v),E}},{key:"circumcentreDD",value:function(n,o,a){var l=st.valueOf(n.x).subtract(a.x),d=st.valueOf(n.y).subtract(a.y),v=st.valueOf(o.x).subtract(a.x),E=st.valueOf(o.y).subtract(a.y),S=st.determinant(l,d,v,E).multiply(2),w=l.sqr().add(d.sqr()),N=v.sqr().add(E.sqr()),M=st.determinant(d,w,E,N),Y=st.determinant(l,w,v,N),W=st.valueOf(a.x).subtract(M.divide(S)).doubleValue(),q=st.valueOf(a.y).add(Y.divide(S)).doubleValue();return new P(W,q)}},{key:"isAcute",value:function(n,o,a){return!!Ie.isAcute(n,o,a)&&!!Ie.isAcute(o,a,n)&&!!Ie.isAcute(a,n,o)}},{key:"circumcentre",value:function(n,o,a){var l=a.x,d=a.y,v=n.x-l,E=n.y-d,S=o.x-l,w=o.y-d,N=2*c.det(v,E,S,w),M=c.det(E,v*v+E*E,w,S*S+w*w),Y=c.det(v,v*v+E*E,S,S*S+w*w);return new P(l-M/N,d+Y/N)}},{key:"perpendicularBisector",value:function(n,o){var a=o.x-n.x,l=o.y-n.y,d=new jl(n.x+a/2,n.y+l/2,1),v=new jl(n.x-l+a/2,n.y+a+l/2,1);return new jl(d,v)}},{key:"angleBisector",value:function(n,o,a){var l=o.distance(n),d=l/(l+o.distance(a)),v=a.x-n.x,E=a.y-n.y;return new P(n.x+d*v,n.y+d*E)}},{key:"area3D",value:function(n,o,a){var l=o.x-n.x,d=o.y-n.y,v=o.getZ()-n.getZ(),E=a.x-n.x,S=a.y-n.y,w=a.getZ()-n.getZ(),N=d*w-v*S,M=v*E-l*w,Y=l*S-d*E,W=N*N+M*M+Y*Y,q=Math.sqrt(W)/2;return q}},{key:"centroid",value:function(n,o,a){var l=(n.x+o.x+a.x)/3,d=(n.y+o.y+a.y)/3;return new P(l,d)}},{key:"inCentre",value:function(n,o,a){var l=o.distance(a),d=n.distance(a),v=n.distance(o),E=l+d+v,S=(l*n.x+d*o.x+v*a.x)/E,w=(l*n.y+d*o.y+v*a.y)/E;return new P(S,w)}}]),c}(),Mw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"addRingSide",value:function(n,o,a,l,d){if(o===0&&n.length<Rs.MINIMUM_VALID_SIZE)return null;var v=l,E=d;n.length>=Rs.MINIMUM_VALID_SIZE&&ut.isCCW(n)&&(v=d,E=l,a=U.opposite(a));var S=this._curveBuilder.getRingCurve(n,a,o);this.addCurve(S,v,E)}},{key:"addRingBothSides",value:function(n,o){this.addRingSide(n,o,U.LEFT,T.EXTERIOR,T.INTERIOR),this.addRingSide(n,o,U.RIGHT,T.INTERIOR,T.EXTERIOR)}},{key:"addPoint",value:function(n){if(this._distance<=0)return null;var o=n.getCoordinates(),a=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(a,T.EXTERIOR,T.INTERIOR)}},{key:"addPolygon",value:function(n){var o=this._distance,a=U.LEFT;this._distance<0&&(o=-this._distance,a=U.RIGHT);var l=n.getExteriorRing(),d=zt.removeRepeatedPoints(l.getCoordinates());if(this._distance<0&&this.isErodedCompletely(l,this._distance)||this._distance<=0&&d.length<3)return null;this.addRingSide(d,o,a,T.EXTERIOR,T.INTERIOR);for(var v=0;v<n.getNumInteriorRing();v++){var E=n.getInteriorRingN(v),S=zt.removeRepeatedPoints(E.getCoordinates());this._distance>0&&this.isErodedCompletely(E,-this._distance)||this.addRingSide(S,o,U.opposite(a),T.INTERIOR,T.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(n,o){var a=new Nw(n[0],n[1],n[2]),l=a.inCentre();return ie.pointToSegment(l,a.p0,a.p1)<Math.abs(o)}},{key:"addLineString",value:function(n){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var o=zt.removeRepeatedPoints(n.getCoordinates());if(zt.isRing(o)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(o,this._distance);else{var a=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(a,T.EXTERIOR,T.INTERIOR)}}},{key:"addCurve",value:function(n,o,a){if(n===null||n.length<2)return null;var l=new Fi(n,new Pe(0,T.BOUNDARY,o,a));this._curveList.add(l)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(n){if(n.isEmpty())return null;if(n instanceof Ir)this.addPolygon(n);else if(n instanceof Ut)this.addLineString(n);else if(n instanceof xe)this.addPoint(n);else if(n instanceof Pl)this.addCollection(n);else if(n instanceof Bl)this.addCollection(n);else if(n instanceof Gl)this.addCollection(n);else{if(!(n instanceof Ee))throw new Ue(n.getGeometryType());this.addCollection(n)}}},{key:"isErodedCompletely",value:function(n,o){var a=n.getCoordinates();if(a.length<4)return o<0;if(a.length===4)return this.isTriangleErodedCompletely(a,o);var l=n.getEnvelopeInternal(),d=Math.min(l.getHeight(),l.getWidth());return o<0&&2*Math.abs(o)>d}},{key:"addCollection",value:function(n){for(var o=0;o<n.getNumGeometries();o++){var a=n.getGeometryN(o);this.add(a)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new ot;var n=arguments[0],o=arguments[1],a=arguments[2];this._inputGeom=n,this._distance=o,this._curveBuilder=a}}]),c}(),Ow=function(){function c(){e(this,c)}return s(c,[{key:"locate",value:function(n){}}]),c}(),Lw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,c.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Sr;var n=this._parent.getGeometryN(this._index++);return n instanceof Ee?(this._subcollectionIterator=new c(n),this._subcollectionIterator.next()):n}},{key:"remove",value:function(){throw new Ue(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[Sw]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var n=arguments[0];this._parent=n,this._atStart=!0,this._index=0,this._max=n.getNumGeometries()}},{key:"isAtomic",value:function(n){return!(n instanceof Ee)}}]),c}(),Aw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"locate",value:function(n){return c.locate(n,this._geom)}},{key:"interfaces_",get:function(){return[Ow]}}],[{key:"constructor_",value:function(){this._geom=null;var n=arguments[0];this._geom=n}},{key:"locatePointInPolygon",value:function(n,o){if(o.isEmpty())return T.EXTERIOR;var a=o.getExteriorRing(),l=c.locatePointInRing(n,a);if(l!==T.INTERIOR)return l;for(var d=0;d<o.getNumInteriorRing();d++){var v=o.getInteriorRingN(d),E=c.locatePointInRing(n,v);if(E===T.BOUNDARY)return T.BOUNDARY;if(E===T.INTERIOR)return T.EXTERIOR}return T.INTERIOR}},{key:"locatePointInRing",value:function(n,o){return o.getEnvelopeInternal().intersects(n)?$l.locateInRing(n,o.getCoordinates()):T.EXTERIOR}},{key:"containsPointInPolygon",value:function(n,o){return T.EXTERIOR!==c.locatePointInPolygon(n,o)}},{key:"locateInGeometry",value:function(n,o){if(o instanceof Ir)return c.locatePointInPolygon(n,o);if(o instanceof Ee)for(var a=new Lw(o);a.hasNext();){var l=a.next();if(l!==o){var d=c.locateInGeometry(n,l);if(d!==T.EXTERIOR)return d}}return T.EXTERIOR}},{key:"isContained",value:function(n,o){return T.EXTERIOR!==c.locate(n,o)}},{key:"locate",value:function(n,o){return o.isEmpty()?T.EXTERIOR:o.getEnvelopeInternal().intersects(n)?c.locateInGeometry(n,o):T.EXTERIOR}}]),c}(),Pw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getNextCW",value:function(n){this.getEdges();var o=this._edgeList.indexOf(n),a=o-1;return o===0&&(a=this._edgeList.size()-1),this._edgeList.get(a)}},{key:"propagateSideLabels",value:function(n){for(var o=T.NONE,a=this.iterator();a.hasNext();){var l=a.next().getLabel();l.isArea(n)&&l.getLocation(n,U.LEFT)!==T.NONE&&(o=l.getLocation(n,U.LEFT))}if(o===T.NONE)return null;for(var d=o,v=this.iterator();v.hasNext();){var E=v.next(),S=E.getLabel();if(S.getLocation(n,U.ON)===T.NONE&&S.setLocation(n,U.ON,d),S.isArea(n)){var w=S.getLocation(n,U.LEFT),N=S.getLocation(n,U.RIGHT);if(N!==T.NONE){if(N!==d)throw new _e("side location conflict",E.getCoordinate());w===T.NONE&&z.shouldNeverReachHere("found single null side (at "+E.getCoordinate()+")"),d=w}else z.isTrue(S.getLocation(n,U.LEFT)===T.NONE,"found single null side"),S.setLocation(n,U.RIGHT,d),S.setLocation(n,U.LEFT,d)}}}},{key:"getCoordinate",value:function(){var n=this.iterator();return n.hasNext()?n.next().getCoordinate():null}},{key:"print",value:function(n){oe.out.println("EdgeEndStar:   "+this.getCoordinate());for(var o=this.iterator();o.hasNext();)o.next().print(n)}},{key:"isAreaLabelsConsistent",value:function(n){return this.computeEdgeEndLabels(n.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(n){var o=this.getEdges();if(o.size()<=0)return!0;var a=o.size()-1,l=o.get(a).getLabel().getLocation(n,U.LEFT);z.isTrue(l!==T.NONE,"Found unlabelled area edge");for(var d=l,v=this.iterator();v.hasNext();){var E=v.next().getLabel();z.isTrue(E.isArea(n),"Found non-area edge");var S=E.getLocation(n,U.LEFT),w=E.getLocation(n,U.RIGHT);if(S===w||w!==d)return!1;d=S}return!0}},{key:"findIndex",value:function(n){this.iterator();for(var o=0;o<this._edgeList.size();o++)if(this._edgeList.get(o)===n)return o;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new ot(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(n,o,a){return this._ptInAreaLocation[n]===T.NONE&&(this._ptInAreaLocation[n]=Aw.locate(o,a[n].getGeometry())),this._ptInAreaLocation[n]}},{key:"toString",value:function(){var n=new Ve;n.append("EdgeEndStar:   "+this.getCoordinate()),n.append(`
`);for(var o=this.iterator();o.hasNext();){var a=o.next();n.append(a),n.append(`
`)}return n.toString()}},{key:"computeEdgeEndLabels",value:function(n){for(var o=this.iterator();o.hasNext();)o.next().computeLabel(n)}},{key:"computeLabelling",value:function(n){this.computeEdgeEndLabels(n[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var o=[!1,!1],a=this.iterator();a.hasNext();)for(var l=a.next().getLabel(),d=0;d<2;d++)l.isLine(d)&&l.getLocation(d)===T.BOUNDARY&&(o[d]=!0);for(var v=this.iterator();v.hasNext();)for(var E=v.next(),S=E.getLabel(),w=0;w<2;w++)if(S.isAnyNull(w)){var N=T.NONE;if(o[w])N=T.EXTERIOR;else{var M=E.getCoordinate();N=this.getLocation(w,M,n)}S.setAllLocationsIfNull(w,N)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(n,o){this._edgeMap.put(n,o),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Ms,this._edgeList=null,this._ptInAreaLocation=[T.NONE,T.NONE]}}]),c}(),Dw=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var a=null,l=null,d=this._SCANNING_FOR_INCOMING,v=0;v<this._resultAreaEdgeList.size();v++){var E=this._resultAreaEdgeList.get(v),S=E.getSym();if(E.getLabel().isArea())switch(a===null&&E.isInResult()&&(a=E),d){case this._SCANNING_FOR_INCOMING:if(!S.isInResult())continue;l=S,d=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!E.isInResult())continue;l.setNext(E),d=this._SCANNING_FOR_INCOMING}}if(d===this._LINKING_TO_OUTGOING){if(a===null)throw new _e("no outgoing dirEdge found",this.getCoordinate());z.isTrue(a.isInResult(),"unable to link last incoming dirEdge"),l.setNext(a)}}},{key:"insert",value:function(a){var l=a;this.insertEdgeEnd(l,l)}},{key:"getRightmostEdge",value:function(){var a=this.getEdges(),l=a.size();if(l<1)return null;var d=a.get(0);if(l===1)return d;var v=a.get(l-1),E=d.getQuadrant(),S=v.getQuadrant();return ue.isNorthern(E)&&ue.isNorthern(S)?d:ue.isNorthern(E)||ue.isNorthern(S)?d.getDy()!==0?d:v.getDy()!==0?v:(z.shouldNeverReachHere("found two horizontal edges incident on node"),null):v}},{key:"print",value:function(a){oe.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var l=this.iterator();l.hasNext();){var d=l.next();a.print("out "),d.print(a),a.println(),a.print("in "),d.getSym().print(a),a.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new ot;for(var a=this.iterator();a.hasNext();){var l=a.next();(l.isInResult()||l.getSym().isInResult())&&this._resultAreaEdgeList.add(l)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(a){for(var l=this.iterator();l.hasNext();){var d=l.next().getLabel();d.setAllLocationsIfNull(0,a.getLocation(0)),d.setAllLocationsIfNull(1,a.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var a=null,l=null,d=this._edgeList.size()-1;d>=0;d--){var v=this._edgeList.get(d),E=v.getSym();l===null&&(l=E),a!==null&&E.setNext(a),a=v}l.setNext(a)}},{key:"computeDepths",value:function(){if(arguments.length===1){var a=arguments[0],l=this.findIndex(a),d=a.getDepth(U.LEFT),v=a.getDepth(U.RIGHT),E=this.computeDepths(l+1,this._edgeList.size(),d),S=this.computeDepths(0,l,E);if(S!==v)throw new _e("depth mismatch at "+a.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],N=arguments[1],M=arguments[2],Y=M,W=w;W<N;W++){var q=this._edgeList.get(W);q.setEdgeDepths(U.RIGHT,Y),Y=q.getDepth(U.LEFT)}return Y}}},{key:"mergeSymLabels",value:function(){for(var a=this.iterator();a.hasNext();){var l=a.next();l.getLabel().merge(l.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(a){for(var l=null,d=null,v=this._SCANNING_FOR_INCOMING,E=this._resultAreaEdgeList.size()-1;E>=0;E--){var S=this._resultAreaEdgeList.get(E),w=S.getSym();switch(l===null&&S.getEdgeRing()===a&&(l=S),v){case this._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==a)continue;d=w,v=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(S.getEdgeRing()!==a)continue;d.setNextMin(S),v=this._SCANNING_FOR_INCOMING}}v===this._LINKING_TO_OUTGOING&&(z.isTrue(l!==null,"found null for first outgoing dirEdge"),z.isTrue(l.getEdgeRing()===a,"unable to link last incoming dirEdge"),d.setNextMin(l))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var a=0,l=this.iterator();l.hasNext();){var d=l.next();d.isInResult()&&a++}return a}if(arguments.length===1){for(var v=arguments[0],E=0,S=this.iterator();S.hasNext();){var w=S.next();w.getEdgeRing()===v&&E++}return E}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var a=T.NONE,l=this.iterator();l.hasNext();){var d=l.next(),v=d.getSym();if(!d.isLineEdge()){if(d.isInResult()){a=T.INTERIOR;break}if(v.isInResult()){a=T.EXTERIOR;break}}}if(a===T.NONE)return null;for(var E=a,S=this.iterator();S.hasNext();){var w=S.next(),N=w.getSym();w.isLineEdge()?w.getEdge().setCovered(E===T.INTERIOR):(w.isInResult()&&(E=T.EXTERIOR),N.isInResult()&&(E=T.INTERIOR))}}},{key:"computeLabelling",value:function(a){I(h(o.prototype),"computeLabelling",this).call(this,a),this._label=new Pe(T.NONE);for(var l=this.iterator();l.hasNext();)for(var d=l.next().getEdge().getLabel(),v=0;v<2;v++){var E=d.getLocation(v);E!==T.INTERIOR&&E!==T.BOUNDARY||this._label.setLocation(v,T.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),o}(Pw),Fw=function(c){u(o,c);var n=x(o);function o(){return e(this,o),n.call(this)}return s(o,[{key:"createNode",value:function(a){return new fa(a,new Dw)}}]),o}(Iy),Py=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"compareTo",value:function(n){var o=n;return c.compareOriented(this._pts,this._orientation,o._pts,o._orientation)}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var n=arguments[0];this._pts=n,this._orientation=c.orientation(n)}},{key:"orientation",value:function(n){return zt.increasingDirection(n)===1}},{key:"compareOriented",value:function(n,o,a,l){for(var d=o?1:-1,v=l?1:-1,E=o?n.length:-1,S=l?a.length:-1,w=o?0:n.length-1,N=l?0:a.length-1;;){var M=n[w].compareTo(a[N]);if(M!==0)return M;var Y=(w+=d)===E,W=(N+=v)===S;if(Y&&!W)return-1;if(!Y&&W)return 1;if(Y&&W)return 0}}}]),c}(),Gw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"print",value:function(n){n.print("MULTILINESTRING ( ");for(var o=0;o<this._edges.size();o++){var a=this._edges.get(o);o>0&&n.print(","),n.print("(");for(var l=a.getCoordinates(),d=0;d<l.length;d++)d>0&&n.print(","),n.print(l[d].x+" "+l[d].y);n.println(")")}n.print(")  ")}},{key:"addAll",value:function(n){for(var o=n.iterator();o.hasNext();)this.add(o.next())}},{key:"findEdgeIndex",value:function(n){for(var o=0;o<this._edges.size();o++)if(this._edges.get(o).equals(n))return o;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(n){return this._edges.get(n)}},{key:"findEqualEdge",value:function(n){var o=new Py(n.getCoordinates());return this._ocaMap.get(o)}},{key:"add",value:function(n){this._edges.add(n);var o=new Py(n.getCoordinates());this._ocaMap.put(o,n)}}],[{key:"constructor_",value:function(){this._edges=new ot,this._ocaMap=new Ms}}]),c}(),Dy=function(){function c(){e(this,c)}return s(c,[{key:"processIntersections",value:function(n,o,a,l){}},{key:"isDone",value:function(){}}]),c}(),Bw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"isTrivialIntersection",value:function(n,o,a,l){if(n===a&&this._li.getIntersectionNum()===1){if(c.isAdjacentSegments(o,l))return!0;if(n.isClosed()){var d=n.size()-1;if(o===0&&l===d||l===0&&o===d)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(n,o,a,l){if(n===a&&o===l)return null;this.numTests++;var d=n.getCoordinates()[o],v=n.getCoordinates()[o+1],E=a.getCoordinates()[l],S=a.getCoordinates()[l+1];this._li.computeIntersection(d,v,E,S),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(n,o,a,l)||(this._hasIntersection=!0,n.addIntersections(this._li,o,0),a.addIntersections(this._li,l,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Dy]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var n=arguments[0];this._li=n}},{key:"isAdjacentSegments",value:function(n,o){return Math.abs(n-o)===1}}]),c}(),Yw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(n){n.print(this.coord),n.print(" seg # = "+this.segmentIndex),n.println(" dist = "+this.dist)}},{key:"compareTo",value:function(n){var o=n;return this.compare(o.segmentIndex,o.dist)}},{key:"isEndPoint",value:function(n){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===n}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(n,o){return this.segmentIndex<n?-1:this.segmentIndex>n?1:this.dist<o?-1:this.dist>o?1:0}},{key:"interfaces_",get:function(){return[F]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var n=arguments[0],o=arguments[1],a=arguments[2];this.coord=new P(n),this.segmentIndex=o,this.dist=a}}]),c}(),zw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"print",value:function(n){n.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(n)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(n){this.addEndpoints();for(var o=this.iterator(),a=o.next();o.hasNext();){var l=o.next(),d=this.createSplitEdge(a,l);n.add(d),a=l}}},{key:"addEndpoints",value:function(){var n=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[n],n,0)}},{key:"createSplitEdge",value:function(n,o){var a=o.segmentIndex-n.segmentIndex+2,l=this.edge.pts[o.segmentIndex],d=o.dist>0||!o.coord.equals2D(l);d||a--;var v=new Array(a).fill(null),E=0;v[E++]=new P(n.coord);for(var S=n.segmentIndex+1;S<=o.segmentIndex;S++)v[E++]=this.edge.pts[S];return d&&(v[E]=o.coord),new Gy(v,new Pe(this.edge._label))}},{key:"add",value:function(n,o,a){var l=new Yw(n,o,a),d=this._nodeMap.get(l);return d!==null?d:(this._nodeMap.put(l,l),l)}},{key:"isIntersection",value:function(n){for(var o=this.iterator();o.hasNext();)if(o.next().coord.equals(n))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Ms,this.edge=null;var n=arguments[0];this.edge=n}}]),c}(),$w=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])||c.isTrue(this._matrix[T.INTERIOR][T.BOUNDARY])||c.isTrue(this._matrix[T.BOUNDARY][T.INTERIOR])||c.isTrue(this._matrix[T.BOUNDARY][T.BOUNDARY]))&&this._matrix[T.EXTERIOR][T.INTERIOR]===j.FALSE&&this._matrix[T.EXTERIOR][T.BOUNDARY]===j.FALSE}},{key:"isCoveredBy",value:function(){return(c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])||c.isTrue(this._matrix[T.INTERIOR][T.BOUNDARY])||c.isTrue(this._matrix[T.BOUNDARY][T.INTERIOR])||c.isTrue(this._matrix[T.BOUNDARY][T.BOUNDARY]))&&this._matrix[T.INTERIOR][T.EXTERIOR]===j.FALSE&&this._matrix[T.BOUNDARY][T.EXTERIOR]===j.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var n=arguments[0],o=0;o<n.length;o++){var a=Math.trunc(o/3),l=o%3;this._matrix[a][l]=j.toDimensionValue(n.charAt(o))}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];this._matrix[d][v]=E}}},{key:"isContains",value:function(){return c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])&&this._matrix[T.EXTERIOR][T.INTERIOR]===j.FALSE&&this._matrix[T.EXTERIOR][T.BOUNDARY]===j.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var n=arguments[0],o=0;o<n.length;o++){var a=Math.trunc(o/3),l=o%3;this.setAtLeast(a,l,j.toDimensionValue(n.charAt(o)))}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];this._matrix[d][v]<E&&(this._matrix[d][v]=E)}}},{key:"setAtLeastIfValid",value:function(n,o,a){n>=0&&o>=0&&this.setAtLeast(n,o,a)}},{key:"isWithin",value:function(){return c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])&&this._matrix[T.INTERIOR][T.EXTERIOR]===j.FALSE&&this._matrix[T.BOUNDARY][T.EXTERIOR]===j.FALSE}},{key:"isTouches",value:function(n,o){return n>o?this.isTouches(o,n):(n===j.A&&o===j.A||n===j.L&&o===j.L||n===j.L&&o===j.A||n===j.P&&o===j.A||n===j.P&&o===j.L)&&this._matrix[T.INTERIOR][T.INTERIOR]===j.FALSE&&(c.isTrue(this._matrix[T.INTERIOR][T.BOUNDARY])||c.isTrue(this._matrix[T.BOUNDARY][T.INTERIOR])||c.isTrue(this._matrix[T.BOUNDARY][T.BOUNDARY]))}},{key:"isOverlaps",value:function(n,o){return n===j.P&&o===j.P||n===j.A&&o===j.A?c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])&&c.isTrue(this._matrix[T.INTERIOR][T.EXTERIOR])&&c.isTrue(this._matrix[T.EXTERIOR][T.INTERIOR]):n===j.L&&o===j.L&&this._matrix[T.INTERIOR][T.INTERIOR]===1&&c.isTrue(this._matrix[T.INTERIOR][T.EXTERIOR])&&c.isTrue(this._matrix[T.EXTERIOR][T.INTERIOR])}},{key:"isEquals",value:function(n,o){return n===o&&c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])&&this._matrix[T.INTERIOR][T.EXTERIOR]===j.FALSE&&this._matrix[T.BOUNDARY][T.EXTERIOR]===j.FALSE&&this._matrix[T.EXTERIOR][T.INTERIOR]===j.FALSE&&this._matrix[T.EXTERIOR][T.BOUNDARY]===j.FALSE}},{key:"toString",value:function(){for(var n=new la("123456789"),o=0;o<3;o++)for(var a=0;a<3;a++)n.setCharAt(3*o+a,j.toDimensionSymbol(this._matrix[o][a]));return n.toString()}},{key:"setAll",value:function(n){for(var o=0;o<3;o++)for(var a=0;a<3;a++)this._matrix[o][a]=n}},{key:"get",value:function(n,o){return this._matrix[n][o]}},{key:"transpose",value:function(){var n=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=n,n=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=n,n=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=n,this}},{key:"matches",value:function(n){if(n.length!==9)throw new L("Should be length 9: "+n);for(var o=0;o<3;o++)for(var a=0;a<3;a++)if(!c.matches(this._matrix[o][a],n.charAt(3*o+a)))return!1;return!0}},{key:"add",value:function(n){for(var o=0;o<3;o++)for(var a=0;a<3;a++)this.setAtLeast(o,a,n.get(o,a))}},{key:"isDisjoint",value:function(){return this._matrix[T.INTERIOR][T.INTERIOR]===j.FALSE&&this._matrix[T.INTERIOR][T.BOUNDARY]===j.FALSE&&this._matrix[T.BOUNDARY][T.INTERIOR]===j.FALSE&&this._matrix[T.BOUNDARY][T.BOUNDARY]===j.FALSE}},{key:"isCrosses",value:function(n,o){return n===j.P&&o===j.L||n===j.P&&o===j.A||n===j.L&&o===j.A?c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])&&c.isTrue(this._matrix[T.INTERIOR][T.EXTERIOR]):n===j.L&&o===j.P||n===j.A&&o===j.P||n===j.A&&o===j.L?c.isTrue(this._matrix[T.INTERIOR][T.INTERIOR])&&c.isTrue(this._matrix[T.EXTERIOR][T.INTERIOR]):n===j.L&&o===j.L&&this._matrix[T.INTERIOR][T.INTERIOR]===0}},{key:"interfaces_",get:function(){return[G]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(j.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var n=arguments[0];c.constructor_.call(this),this.set(n)}else if(arguments[0]instanceof c){var o=arguments[0];c.constructor_.call(this),this._matrix[T.INTERIOR][T.INTERIOR]=o._matrix[T.INTERIOR][T.INTERIOR],this._matrix[T.INTERIOR][T.BOUNDARY]=o._matrix[T.INTERIOR][T.BOUNDARY],this._matrix[T.INTERIOR][T.EXTERIOR]=o._matrix[T.INTERIOR][T.EXTERIOR],this._matrix[T.BOUNDARY][T.INTERIOR]=o._matrix[T.BOUNDARY][T.INTERIOR],this._matrix[T.BOUNDARY][T.BOUNDARY]=o._matrix[T.BOUNDARY][T.BOUNDARY],this._matrix[T.BOUNDARY][T.EXTERIOR]=o._matrix[T.BOUNDARY][T.EXTERIOR],this._matrix[T.EXTERIOR][T.INTERIOR]=o._matrix[T.EXTERIOR][T.INTERIOR],this._matrix[T.EXTERIOR][T.BOUNDARY]=o._matrix[T.EXTERIOR][T.BOUNDARY],this._matrix[T.EXTERIOR][T.EXTERIOR]=o._matrix[T.EXTERIOR][T.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var n=arguments[0],o=arguments[1];return o===j.SYM_DONTCARE||o===j.SYM_TRUE&&(n>=0||n===j.TRUE)||o===j.SYM_FALSE&&n===j.FALSE||o===j.SYM_P&&n===j.P||o===j.SYM_L&&n===j.L||o===j.SYM_A&&n===j.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var a=arguments[0],l=arguments[1],d=new c(a);return d.matches(l)}}},{key:"isTrue",value:function(n){return n>=0||n===j.TRUE}}]),c}(),Xw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(n){return n===null||n.length===0?null:(this.ensureCapacity(this._size+n.length),oe.arraycopy(n,0,this._data,this._size,n.length),void(this._size+=n.length))}},{key:"ensureCapacity",value:function(n){if(n<=this._data.length)return null;var o=Math.max(n,2*this._data.length);this._data=Dt.copyOf(this._data,o)}},{key:"toArray",value:function(){var n=new Array(this._size).fill(null);return oe.arraycopy(this._data,0,n,0,this._size),n}},{key:"add",value:function(n){this.ensureCapacity(this._size+1),this._data[this._size]=n,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)c.constructor_.call(this,10);else if(arguments.length===1){var n=arguments[0];this._data=new Array(n).fill(null)}}}]),c}(),qw=function(){function c(){e(this,c)}return s(c,[{key:"getChainStartIndices",value:function(n){var o=0,a=new Xw(Math.trunc(n.length/2));a.add(o);do{var l=this.findChainEnd(n,o);a.add(l),o=l}while(o<n.length-1);return a.toArray()}},{key:"findChainEnd",value:function(n,o){for(var a=ue.quadrant(n[o],n[o+1]),l=o+1;l<n.length&&ue.quadrant(n[l-1],n[l])===a;)l++;return l-1}},{key:"OLDgetChainStartIndices",value:function(n){var o=0,a=new ot;a.add(o);do{var l=this.findChainEnd(n,o);a.add(l),o=l}while(o<n.length-1);return c.toIntArray(a)}}],[{key:"toIntArray",value:function(n){for(var o=new Array(n.size()).fill(null),a=0;a<o.length;a++)o[a]=n.get(a).intValue();return o}}]),c}(),Ww=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(n){var o=this.pts[this.startIndex[n]].x,a=this.pts[this.startIndex[n+1]].x;return o>a?o:a}},{key:"getMinX",value:function(n){var o=this.pts[this.startIndex[n]].x,a=this.pts[this.startIndex[n+1]].x;return o<a?o:a}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var n=arguments[0],o=arguments[1],a=arguments[2],l=arguments[3];this.computeIntersectsForChain(this.startIndex[n],this.startIndex[n+1],o,o.startIndex[a],o.startIndex[a+1],l)}else if(arguments.length===6){var d=arguments[0],v=arguments[1],E=arguments[2],S=arguments[3],w=arguments[4],N=arguments[5];if(v-d==1&&w-S==1)return N.addIntersections(this.e,d,E.e,S),null;if(!this.overlaps(d,v,E,S,w))return null;var M=Math.trunc((d+v)/2),Y=Math.trunc((S+w)/2);d<M&&(S<Y&&this.computeIntersectsForChain(d,M,E,S,Y,N),Y<w&&this.computeIntersectsForChain(d,M,E,Y,w,N)),M<v&&(S<Y&&this.computeIntersectsForChain(M,v,E,S,Y,N),Y<w&&this.computeIntersectsForChain(M,v,E,Y,w,N))}}},{key:"overlaps",value:function(n,o,a,l,d){return Tt.intersects(this.pts[n],this.pts[o],a.pts[l],a.pts[d])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(n,o){for(var a=0;a<this.startIndex.length-1;a++)for(var l=0;l<n.startIndex.length-1;l++)this.computeIntersectsForChain(a,n,l,o)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var n=arguments[0];this.e=n,this.pts=n.getCoordinates();var o=new qw;this.startIndex=o.getChainStartIndices(this.pts)}}]),c}(),Fy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"getDepth",value:function(n,o){return this._depth[n][o]}},{key:"setDepth",value:function(n,o,a){this._depth[n][o]=a}},{key:"isNull",value:function(){if(arguments.length===0){for(var n=0;n<2;n++)for(var o=0;o<3;o++)if(this._depth[n][o]!==c.NULL_VALUE)return!1;return!0}if(arguments.length===1){var a=arguments[0];return this._depth[a][1]===c.NULL_VALUE}if(arguments.length===2){var l=arguments[0],d=arguments[1];return this._depth[l][d]===c.NULL_VALUE}}},{key:"normalize",value:function(){for(var n=0;n<2;n++)if(!this.isNull(n)){var o=this._depth[n][1];this._depth[n][2]<o&&(o=this._depth[n][2]),o<0&&(o=0);for(var a=1;a<3;a++){var l=0;this._depth[n][a]>o&&(l=1),this._depth[n][a]=l}}}},{key:"getDelta",value:function(n){return this._depth[n][U.RIGHT]-this._depth[n][U.LEFT]}},{key:"getLocation",value:function(n,o){return this._depth[n][o]<=0?T.EXTERIOR:T.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var n=arguments[0],o=0;o<2;o++)for(var a=1;a<3;a++){var l=n.getLocation(o,a);l!==T.EXTERIOR&&l!==T.INTERIOR||(this.isNull(o,a)?this._depth[o][a]=c.depthAtLocation(l):this._depth[o][a]+=c.depthAtLocation(l))}else if(arguments.length===3){var d=arguments[0],v=arguments[1],E=arguments[2];E===T.INTERIOR&&this._depth[d][v]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var o=0;o<3;o++)this._depth[n][o]=c.NULL_VALUE}},{key:"depthAtLocation",value:function(n){return n===T.EXTERIOR?0:n===T.INTERIOR?1:c.NULL_VALUE}}]),c}();Fy.NULL_VALUE=-1;var Gy=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var a=new Array(2).fill(null);return a[0]=this.pts[0],a[1]=this.pts[1],new o(a,Pe.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(a){this._isIsolated=a}},{key:"setName",value:function(a){this._name=a}},{key:"equals",value:function(a){if(!(a instanceof o))return!1;var l=a;if(this.pts.length!==l.pts.length)return!1;for(var d=!0,v=!0,E=this.pts.length,S=0;S<this.pts.length;S++)if(this.pts[S].equals2D(l.pts[S])||(d=!1),this.pts[S].equals2D(l.pts[--E])||(v=!1),!d&&!v)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var a=arguments[0];return this.pts[a]}}},{key:"print",value:function(a){a.print("edge "+this._name+": "),a.print("LINESTRING (");for(var l=0;l<this.pts.length;l++)l>0&&a.print(","),a.print(this.pts[l].x+" "+this.pts[l].y);a.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(a){o.updateIM(this._label,a)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(a){a.print("edge "+this._name+": ");for(var l=this.pts.length-1;l>=0;l--)a.print(this.pts[l]+" ");a.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Ww(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Tt;for(var a=0;a<this.pts.length;a++)this._env.expandToInclude(this.pts[a])}return this._env}},{key:"addIntersection",value:function(a,l,d,v){var E=new P(a.getIntersection(v)),S=l,w=a.getEdgeDistance(d,v),N=S+1;if(N<this.pts.length){var M=this.pts[N];E.equals2D(M)&&(S=N,w=0)}this.eiList.add(E,S,w)}},{key:"toString",value:function(){var a=new la;a.append("edge "+this._name+": "),a.append("LINESTRING (");for(var l=0;l<this.pts.length;l++)l>0&&a.append(","),a.append(this.pts[l].x+" "+this.pts[l].y);return a.append(")  "+this._label+" "+this._depthDelta),a.toString()}},{key:"isPointwiseEqual",value:function(a){if(this.pts.length!==a.pts.length)return!1;for(var l=0;l<this.pts.length;l++)if(!this.pts[l].equals2D(a.pts[l]))return!1;return!0}},{key:"setDepthDelta",value:function(a){this._depthDelta=a}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(a,l,d){for(var v=0;v<a.getIntersectionNum();v++)this.addIntersection(a,l,d,v)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new zw(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Fy,this._depthDelta=0,arguments.length===1){var a=arguments[0];o.constructor_.call(this,a,null)}else if(arguments.length===2){var l=arguments[0],d=arguments[1];this.pts=l,this._label=d}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof $w&&arguments[0]instanceof Pe))return I(h(o),"updateIM",this).apply(this,arguments);var a=arguments[0],l=arguments[1];l.setAtLeastIfValid(a.getLocation(0,U.ON),a.getLocation(1,U.ON),1),a.isArea()&&(l.setAtLeastIfValid(a.getLocation(0,U.LEFT),a.getLocation(1,U.LEFT),2),l.setAtLeastIfValid(a.getLocation(0,U.RIGHT),a.getLocation(1,U.RIGHT),2))}}]),o}(vy),By=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"setWorkingPrecisionModel",value:function(n){this._workingPrecisionModel=n}},{key:"insertUniqueEdge",value:function(n){var o=this._edgeList.findEqualEdge(n);if(o!==null){var a=o.getLabel(),l=n.getLabel();o.isPointwiseEqual(n)||(l=new Pe(n.getLabel())).flip(),a.merge(l);var d=c.depthDelta(l),v=o.getDepthDelta()+d;o.setDepthDelta(v)}else this._edgeList.add(n),n.setDepthDelta(c.depthDelta(n.getLabel()))}},{key:"buildSubgraphs",value:function(n,o){for(var a=new ot,l=n.iterator();l.hasNext();){var d=l.next(),v=d.getRightmostCoordinate(),E=new Oy(a).getDepth(v);d.computeDepth(E),d.findResultEdges(),a.add(d),o.add(d.getDirectedEdges(),d.getNodes())}}},{key:"createSubgraphs",value:function(n){for(var o=new ot,a=n.getNodes().iterator();a.hasNext();){var l=a.next();if(!l.isVisited()){var d=new oa;d.create(l),o.add(d)}}return Rr.sort(o,Rr.reverseOrder()),o}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(n){if(this._workingNoder!==null)return this._workingNoder;var o=new Ul,a=new Di;return a.setPrecisionModel(n),o.setSegmentIntersector(new Bw(a)),o}},{key:"buffer",value:function(n,o){var a=this._workingPrecisionModel;a===null&&(a=n.getPrecisionModel()),this._geomFact=n.getFactory();var l=new Tw(a,this._bufParams),d=new Mw(n,o,l).getCurves();if(d.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(d,a),this._graph=new wy(new Fw),this._graph.addEdges(this._edgeList.getEdges());var v=this.createSubgraphs(this._graph),E=new pw(this._geomFact);this.buildSubgraphs(v,E);var S=E.getPolygons();return S.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(S)}},{key:"computeNodedEdges",value:function(n,o){var a=this.getNoder(o);a.computeNodes(n);for(var l=a.getNodedSubstrings().iterator();l.hasNext();){var d=l.next(),v=d.getCoordinates();if(v.length!==2||!v[0].equals2D(v[1])){var E=d.getData(),S=new Gy(d.getCoordinates(),new Pe(E));this.insertUniqueEdge(S)}}}},{key:"setNoder",value:function(n){this._workingNoder=n}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Gw;var n=arguments[0];this._bufParams=n}},{key:"depthDelta",value:function(n){var o=n.getLocation(0,U.LEFT),a=n.getLocation(0,U.RIGHT);return o===T.INTERIOR&&a===T.EXTERIOR?1:o===T.EXTERIOR&&a===T.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(n){for(var o=new kr,a=new ot;n.hasNext();){var l=n.next(),d=o.createLineString(l.getCoordinates());a.add(d)}return o.buildGeometry(a)}}]),c}(),Uw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"rescale",value:function(){if(ht(arguments[0],Me))for(var n=arguments[0],o=n.iterator();o.hasNext();){var a=o.next();this.rescale(a.getCoordinates())}else if(arguments[0]instanceof Array){for(var l=arguments[0],d=0;d<l.length;d++)l[d].x=l[d].x/this._scaleFactor+this._offsetX,l[d].y=l[d].y/this._scaleFactor+this._offsetY;l.length===2&&l[0].equals2D(l[1])&&oe.out.println(l)}}},{key:"scale",value:function(){if(ht(arguments[0],Me)){for(var n=arguments[0],o=new ot(n.size()),a=n.iterator();a.hasNext();){var l=a.next();o.add(new Fi(this.scale(l.getCoordinates()),l.getData()))}return o}if(arguments[0]instanceof Array){for(var d=arguments[0],v=new Array(d.length).fill(null),E=0;E<d.length;E++)v[E]=new P(Math.round((d[E].x-this._offsetX)*this._scaleFactor),Math.round((d[E].y-this._offsetY)*this._scaleFactor),d[E].getZ());var S=zt.removeRepeatedPoints(v);return S}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var n=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(n),n}},{key:"computeNodes",value:function(n){var o=n;this._isScaled&&(o=this.scale(n)),this._noder.computeNodes(o)}},{key:"interfaces_",get:function(){return[Wl]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var n=arguments[0],o=arguments[1];c.constructor_.call(this,n,o,0,0)}else if(arguments.length===4){var a=arguments[0],l=arguments[1];this._noder=a,this._scaleFactor=l,this._isScaled=!this.isIntegerPrecision()}}}]),c}(),Yy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var o=n.next(),a=o.getCoordinates();this.checkEndPtVertexIntersections(a[0],this._segStrings),this.checkEndPtVertexIntersections(a[a.length-1],this._segStrings)}else if(arguments.length===2){for(var l=arguments[0],d=arguments[1],v=d.iterator();v.hasNext();)for(var E=v.next(),S=E.getCoordinates(),w=1;w<S.length-1;w++)if(S[w].equals(l))throw new vt("found endpt/interior pt intersection at index "+w+" :pt "+l)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();)for(var o=n.next(),a=this._segStrings.iterator();a.hasNext();){var l=a.next();this.checkInteriorIntersections(o,l)}else if(arguments.length===2)for(var d=arguments[0],v=arguments[1],E=d.getCoordinates(),S=v.getCoordinates(),w=0;w<E.length-1;w++)for(var N=0;N<S.length-1;N++)this.checkInteriorIntersections(d,w,v,N);else if(arguments.length===4){var M=arguments[0],Y=arguments[1],W=arguments[2],q=arguments[3];if(M===W&&Y===q)return null;var it=M.getCoordinates()[Y],at=M.getCoordinates()[Y+1],gt=W.getCoordinates()[q],Rt=W.getCoordinates()[q+1];if(this._li.computeIntersection(it,at,gt,Rt),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,it,at)||this.hasInteriorIntersection(this._li,gt,Rt)))throw new vt("found non-noded intersection at "+it+"-"+at+" and "+gt+"-"+Rt)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var o=n.next();this.checkCollapses(o)}else if(arguments.length===1)for(var a=arguments[0],l=a.getCoordinates(),d=0;d<l.length-2;d++)this.checkCollapse(l[d],l[d+1],l[d+2])}},{key:"hasInteriorIntersection",value:function(n,o,a){for(var l=0;l<n.getIntersectionNum();l++){var d=n.getIntersection(l);if(!d.equals(o)&&!d.equals(a))return!0}return!1}},{key:"checkCollapse",value:function(n,o,a){if(n.equals(a))throw new vt("found non-noded collapse at "+c.fact.createLineString([n,o,a]))}}],[{key:"constructor_",value:function(){this._li=new Di,this._segStrings=null;var n=arguments[0];this._segStrings=n}}]),c}();Yy.fact=new kr;var Vl=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"intersectsScaled",value:function(n,o){var a=Math.min(n.x,o.x),l=Math.max(n.x,o.x),d=Math.min(n.y,o.y),v=Math.max(n.y,o.y),E=this._maxx<a||this._minx>l||this._maxy<d||this._miny>v;if(E)return!1;var S=this.intersectsToleranceSquare(n,o);return z.isTrue(!(E&&S),"Found bad envelope test"),S}},{key:"initCorners",value:function(n){var o=.5;this._minx=n.x-o,this._maxx=n.x+o,this._miny=n.y-o,this._maxy=n.y+o,this._corner[0]=new P(this._maxx,this._maxy),this._corner[1]=new P(this._minx,this._maxy),this._corner[2]=new P(this._minx,this._miny),this._corner[3]=new P(this._maxx,this._miny)}},{key:"intersects",value:function(n,o){return this._scaleFactor===1?this.intersectsScaled(n,o):(this.copyScaled(n,this._p0Scaled),this.copyScaled(o,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(n){return Math.round(n*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(n,o){o.x=this.scale(n.x),o.y=this.scale(n.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var n=c.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Tt(this._originalPt.x-n,this._originalPt.x+n,this._originalPt.y-n,this._originalPt.y+n)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(n,o){return this._li.computeIntersection(n,o,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(n,o,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(n,o,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(n,o,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(n,o){var a=!1,l=!1;return this._li.computeIntersection(n,o,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(n,o,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(a=!0),this._li.computeIntersection(n,o,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(l=!0),this._li.computeIntersection(n,o,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!a||!l)||!!n.equals(this._pt)||!!o.equals(this._pt))))}},{key:"addSnappedNode",value:function(n,o){var a=n.getCoordinate(o),l=n.getCoordinate(o+1);return!!this.intersects(a,l)&&(n.addIntersection(this.getCoordinate(),o),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var n=arguments[0],o=arguments[1],a=arguments[2];if(this._originalPt=n,this._pt=n,this._scaleFactor=o,this._li=a,o<=0)throw new L("Scale factor must be non-zero");o!==1&&(this._pt=new P(this.scale(n.x),this.scale(n.y)),this._p0Scaled=new P,this._p1Scaled=new P),this.initCorners(this._pt)}}]),c}();Vl.SAFE_ENV_EXPANSION_FACTOR=.75;var jw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var n=arguments[0],o=arguments[1];n.getLineSegment(o,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Se}}]),c}(),zy=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"snap",value:function(){if(arguments.length===1){var n=arguments[0];return this.snap(n,null,-1)}if(arguments.length===3){var o=arguments[0],a=arguments[1],l=arguments[2],d=o.getSafeEnvelope(),v=new $y(o,a,l);return this._index.query(d,new(function(){function E(){e(this,E)}return s(E,[{key:"interfaces_",get:function(){return[Cy]}},{key:"visitItem",value:function(S){S.select(d,v)}}]),E}())),v.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var n=arguments[0];this._index=n}}]),c}(),$y=function(c){u(o,c);var n=x(o);function o(){var a;return e(this,o),a=n.call(this),o.constructor_.apply(m(a),arguments),a}return s(o,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof by))return I(h(o.prototype),"select",this).apply(this,arguments);var a=arguments[0],l=arguments[1],d=a.getContext();if(this._parentEdge===d&&(l===this._hotPixelVertexIndex||l+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(d,l)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var a=arguments[0],l=arguments[1],d=arguments[2];this._hotPixel=a,this._parentEdge=l,this._hotPixelVertexIndex=d}}]),o}(jw);zy.HotPixelSnapAction=$y;var Vw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"processIntersections",value:function(n,o,a,l){if(n===a&&o===l)return null;var d=n.getCoordinates()[o],v=n.getCoordinates()[o+1],E=a.getCoordinates()[l],S=a.getCoordinates()[l+1];if(this._li.computeIntersection(d,v,E,S),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)this._interiorIntersections.add(this._li.getIntersection(w));n.addIntersections(this._li,o,0),a.addIntersections(this._li,l,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Dy]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var n=arguments[0];this._li=n,this._interiorIntersections=new ot}}]),c}(),Zw=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"checkCorrectness",value:function(n){var o=Fi.getNodedSubstrings(n),a=new Yy(o);try{a.checkValid()}catch(l){if(!(l instanceof A))throw l;l.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return Fi.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(n,o){var a=this.findInteriorIntersections(n,o);this.computeIntersectionSnaps(a),this.computeVertexSnaps(n)}},{key:"findInteriorIntersections",value:function(n,o){var a=new Vw(o);return this._noder.setSegmentIntersector(a),this._noder.computeNodes(n),a.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(ht(arguments[0],Me))for(var n=arguments[0],o=n.iterator();o.hasNext();){var a=o.next();this.computeVertexSnaps(a)}else if(arguments[0]instanceof Fi)for(var l=arguments[0],d=l.getCoordinates(),v=0;v<d.length;v++){var E=new Vl(d[v],this._scaleFactor,this._li),S=this._pointSnapper.snap(E,l,v);S&&l.addIntersection(d[v],v)}}},{key:"computeNodes",value:function(n){this._nodedSegStrings=n,this._noder=new Ul,this._pointSnapper=new zy(this._noder.getIndex()),this.snapRound(n,this._li)}},{key:"computeIntersectionSnaps",value:function(n){for(var o=n.iterator();o.hasNext();){var a=o.next(),l=new Vl(a,this._scaleFactor,this._li);this._pointSnapper.snap(l)}}},{key:"interfaces_",get:function(){return[Wl]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var n=arguments[0];this._pm=n,this._li=new Di,this._li.setPrecisionModel(n),this._scaleFactor=n.getScale()}}]),c}(),Nr=function(){function c(){e(this,c),c.constructor_.apply(this,arguments)}return s(c,[{key:"bufferFixedPrecision",value:function(n){var o=new Uw(new Zw(new Ze(1)),n.getScale()),a=new By(this._bufParams);a.setWorkingPrecisionModel(n),a.setNoder(o),this._resultGeometry=a.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var n=c.MAX_PRECISION_DIGITS;n>=0;n--){try{this.bufferReducedPrecision(n)}catch(d){if(!(d instanceof _e))throw d;this._saveException=d}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var o=arguments[0],a=c.precisionScaleFactor(this._argGeom,this._distance,o),l=new Ze(a);this.bufferFixedPrecision(l)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var n=this._argGeom.getFactory().getPrecisionModel();n.getType()===Ze.FIXED?this.bufferFixedPrecision(n):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(n){this._bufParams.setQuadrantSegments(n)}},{key:"bufferOriginalPrecision",value:function(){try{var n=new By(this._bufParams);this._resultGeometry=n.buffer(this._argGeom,this._distance)}catch(o){if(!(o instanceof vt))throw o;this._saveException=o}}},{key:"getResultGeometry",value:function(n){return this._distance=n,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(n){this._bufParams.setEndCapStyle(n)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new O,this._resultGeometry=null,this._saveException=null,arguments.length===1){var n=arguments[0];this._argGeom=n}else if(arguments.length===2){var o=arguments[0],a=arguments[1];this._argGeom=o,this._bufParams=a}}},{key:"bufferOp",value:function(){if(arguments.length===2){var n=arguments[0],o=arguments[1],a=new c(n),l=a.getResultGeometry(o);return l}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof et&&typeof arguments[1]=="number"){var d=arguments[0],v=arguments[1],E=arguments[2],S=new c(d);S.setQuadrantSegments(E);var w=S.getResultGeometry(v);return w}if(arguments[2]instanceof O&&arguments[0]instanceof et&&typeof arguments[1]=="number"){var N=arguments[0],M=arguments[1],Y=arguments[2],W=new c(N,Y),q=W.getResultGeometry(M);return q}}else if(arguments.length===4){var it=arguments[0],at=arguments[1],gt=arguments[2],Rt=arguments[3],Ft=new c(it);Ft.setQuadrantSegments(gt),Ft.setEndCapStyle(Rt);var re=Ft.getResultGeometry(at);return re}}},{key:"precisionScaleFactor",value:function(n,o,a){var l=n.getEnvelopeInternal(),d=bn.max(Math.abs(l.getMaxX()),Math.abs(l.getMaxY()),Math.abs(l.getMinX()),Math.abs(l.getMinY()))+2*(o>0?o:0),v=a-Math.trunc(Math.log(d)/Math.log(10)+1);return Math.pow(10,v)}}]),c}();Nr.CAP_ROUND=O.CAP_ROUND,Nr.CAP_BUTT=O.CAP_FLAT,Nr.CAP_FLAT=O.CAP_FLAT,Nr.CAP_SQUARE=O.CAP_SQUARE,Nr.MAX_PRECISION_DIGITS=12;var Hw=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Xy=function(){function c(n){e(this,c),this.geometryFactory=n||new kr}return s(c,[{key:"read",value:function(n){var o,a=(o=typeof n=="string"?JSON.parse(n):n).type;if(!Fe[a])throw new Error("Unknown GeoJSON type: "+o.type);return Hw.indexOf(a)!==-1?Fe[a].call(this,o.coordinates):a==="GeometryCollection"?Fe[a].call(this,o.geometries):Fe[a].call(this,o)}},{key:"write",value:function(n){var o=n.getGeometryType();if(!gn[o])throw new Error("Geometry is not supported");return gn[o].call(this,n)}}]),c}(),Fe={Feature:function(c){var n={};for(var o in c)n[o]=c[o];if(c.geometry){var a=c.geometry.type;if(!Fe[a])throw new Error("Unknown GeoJSON type: "+c.type);n.geometry=this.read(c.geometry)}return c.bbox&&(n.bbox=Fe.bbox.call(this,c.bbox)),n},FeatureCollection:function(c){var n={};if(c.features){n.features=[];for(var o=0;o<c.features.length;++o)n.features.push(this.read(c.features[o]))}return c.bbox&&(n.bbox=this.parse.bbox.call(this,c.bbox)),n},coordinates:function(c){for(var n=[],o=0;o<c.length;++o){var a=c[o];n.push(y(P,k(a)))}return n},bbox:function(c){return this.geometryFactory.createLinearRing([new P(c[0],c[1]),new P(c[2],c[1]),new P(c[2],c[3]),new P(c[0],c[3]),new P(c[0],c[1])])},Point:function(c){var n=y(P,k(c));return this.geometryFactory.createPoint(n)},MultiPoint:function(c){for(var n=[],o=0;o<c.length;++o)n.push(Fe.Point.call(this,c[o]));return this.geometryFactory.createMultiPoint(n)},LineString:function(c){var n=Fe.coordinates.call(this,c);return this.geometryFactory.createLineString(n)},MultiLineString:function(c){for(var n=[],o=0;o<c.length;++o)n.push(Fe.LineString.call(this,c[o]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(c){for(var n=Fe.coordinates.call(this,c[0]),o=this.geometryFactory.createLinearRing(n),a=[],l=1;l<c.length;++l){var d=c[l],v=Fe.coordinates.call(this,d),E=this.geometryFactory.createLinearRing(v);a.push(E)}return this.geometryFactory.createPolygon(o,a)},MultiPolygon:function(c){for(var n=[],o=0;o<c.length;++o){var a=c[o];n.push(Fe.Polygon.call(this,a))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(c){for(var n=[],o=0;o<c.length;++o){var a=c[o];n.push(this.read(a))}return this.geometryFactory.createGeometryCollection(n)}},gn={coordinate:function(c){var n=[c.x,c.y];return c.z&&n.push(c.z),c.m&&n.push(c.m),n},Point:function(c){return{type:"Point",coordinates:gn.coordinate.call(this,c.getCoordinate())}},MultiPoint:function(c){for(var n=[],o=0;o<c._geometries.length;++o){var a=c._geometries[o],l=gn.Point.call(this,a);n.push(l.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(c){for(var n=[],o=c.getCoordinates(),a=0;a<o.length;++a){var l=o[a];n.push(gn.coordinate.call(this,l))}return{type:"LineString",coordinates:n}},MultiLineString:function(c){for(var n=[],o=0;o<c._geometries.length;++o){var a=c._geometries[o],l=gn.LineString.call(this,a);n.push(l.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(c){var n=[],o=gn.LineString.call(this,c._shell);n.push(o.coordinates);for(var a=0;a<c._holes.length;++a){var l=c._holes[a],d=gn.LineString.call(this,l);n.push(d.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(c){for(var n=[],o=0;o<c._geometries.length;++o){var a=c._geometries[o],l=gn.Polygon.call(this,a);n.push(l.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(c){for(var n=[],o=0;o<c._geometries.length;++o){var a=c._geometries[o],l=a.getGeometryType();n.push(gn[l].call(this,a))}return{type:"GeometryCollection",geometries:n}}};return{BufferOp:Nr,GeoJSONReader:function(){function c(n){e(this,c),this.parser=new Xy(n||new kr)}return s(c,[{key:"read",value:function(n){return this.parser.read(n)}}]),c}(),GeoJSONWriter:function(){function c(){e(this,c),this.parser=new Xy(this.geometryFactory)}return s(c,[{key:"write",value:function(n){return this.parser.write(n)}}]),c}()}})})(yd);var qS=yd.exports;const WS=Gc(qS);function Kn(){return new Xo}function Xo(){this.reset()}Xo.prototype={constructor:Xo,reset:function(){this.s=this.t=0},add:function(i){pd(qo,i,this.t),pd(this,qo.s,this.s),this.s?this.t+=qo.t:this.s=qo.t},valueOf:function(){return this.s}};var qo=new Xo;function pd(i,t,e){var r=i.s=t+e,s=r-t,u=r-s;i.t=t-u+(e-s)}var Nt=1e-6,Et=Math.PI,un=Et/2,md=Et/4,ln=Et*2,Qn=180/Et,Te=Et/180,Wt=Math.abs,US=Math.atan,yr=Math.atan2,Lt=Math.cos,At=Math.sin,pr=Math.sqrt;function vd(i){return i>1?0:i<-1?Et:Math.acos(i)}function Ni(i){return i>1?un:i<-1?-un:Math.asin(i)}function ms(){}function Wo(i,t){i&&xd.hasOwnProperty(i.type)&&xd[i.type](i,t)}var _d={Feature:function(i,t){Wo(i.geometry,t)},FeatureCollection:function(i,t){for(var e=i.features,r=-1,s=e.length;++r<s;)Wo(e[r].geometry,t)}},xd={Sphere:function(i,t){t.sphere()},Point:function(i,t){i=i.coordinates,t.point(i[0],i[1],i[2])},MultiPoint:function(i,t){for(var e=i.coordinates,r=-1,s=e.length;++r<s;)i=e[r],t.point(i[0],i[1],i[2])},LineString:function(i,t){gl(i.coordinates,t,0)},MultiLineString:function(i,t){for(var e=i.coordinates,r=-1,s=e.length;++r<s;)gl(e[r],t,0)},Polygon:function(i,t){Ed(i.coordinates,t)},MultiPolygon:function(i,t){for(var e=i.coordinates,r=-1,s=e.length;++r<s;)Ed(e[r],t)},GeometryCollection:function(i,t){for(var e=i.geometries,r=-1,s=e.length;++r<s;)Wo(e[r],t)}};function gl(i,t,e){var r=-1,s=i.length-e,u;for(t.lineStart();++r<s;)u=i[r],t.point(u[0],u[1],u[2]);t.lineEnd()}function Ed(i,t){var e=-1,r=i.length;for(t.polygonStart();++e<r;)gl(i[e],t,1);t.polygonEnd()}function jS(i,t){i&&_d.hasOwnProperty(i.type)?_d[i.type](i,t):Wo(i,t)}Kn(),Kn();function dl(i){return[yr(i[1],i[0]),Ni(i[2])]}function mr(i){var t=i[0],e=i[1],r=Lt(e);return[r*Lt(t),r*At(t),At(e)]}function Uo(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function jo(i,t){return[i[1]*t[2]-i[2]*t[1],i[2]*t[0]-i[0]*t[2],i[0]*t[1]-i[1]*t[0]]}function yl(i,t){i[0]+=t[0],i[1]+=t[1],i[2]+=t[2]}function Vo(i,t){return[i[0]*t,i[1]*t,i[2]*t]}function pl(i){var t=pr(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]/=t,i[1]/=t,i[2]/=t}Kn();function Sd(i,t){function e(r,s){return r=i(r,s),t(r[0],r[1])}return i.invert&&t.invert&&(e.invert=function(r,s){return r=t.invert(r,s),r&&i.invert(r[0],r[1])}),e}function ml(i,t){return[i>Et?i-ln:i<-Et?i+ln:i,t]}ml.invert=ml;function VS(i,t,e){return(i%=ln)?t||e?Sd(wd(i),kd(t,e)):wd(i):t||e?kd(t,e):ml}function Id(i){return function(t,e){return t+=i,[t>Et?t-ln:t<-Et?t+ln:t,e]}}function wd(i){var t=Id(i);return t.invert=Id(-i),t}function kd(i,t){var e=Lt(i),r=At(i),s=Lt(t),u=At(t);function h(f,g){var y=Lt(g),p=Lt(f)*y,m=At(f)*y,_=At(g),x=_*e+p*r;return[yr(m*s-x*u,p*e-_*r),Ni(x*s+m*u)]}return h.invert=function(f,g){var y=Lt(g),p=Lt(f)*y,m=At(f)*y,_=At(g),x=_*s-m*u;return[yr(m*s+_*u,p*e+x*r),Ni(x*e-p*r)]},h}function ZS(i,t,e,r,s,u){if(e){var h=Lt(t),f=At(t),g=r*e;s==null?(s=t+r*ln,u=t-g/2):(s=Cd(h,s),u=Cd(h,u),(r>0?s<u:s>u)&&(s+=r*ln));for(var y,p=s;r>0?p>u:p<u;p-=g)y=dl([h,-f*Lt(p),-f*At(p)]),i.point(y[0],y[1])}}function Cd(i,t){t=mr(t),t[0]-=i,pl(t);var e=vd(-t[1]);return((-t[2]<0?-e:e)+ln-Nt)%ln}function Rd(){var i=[],t;return{point:function(e,r){t.push([e,r])},lineStart:function(){i.push(t=[])},lineEnd:ms,rejoin:function(){i.length>1&&i.push(i.pop().concat(i.shift()))},result:function(){var e=i;return i=[],t=null,e}}}function HS(i,t,e,r,s,u){var h=i[0],f=i[1],g=t[0],y=t[1],p=0,m=1,_=g-h,x=y-f,I;if(I=e-h,!(!_&&I>0)){if(I/=_,_<0){if(I<p)return;I<m&&(m=I)}else if(_>0){if(I>m)return;I>p&&(p=I)}if(I=s-h,!(!_&&I<0)){if(I/=_,_<0){if(I>m)return;I>p&&(p=I)}else if(_>0){if(I<p)return;I<m&&(m=I)}if(I=r-f,!(!x&&I>0)){if(I/=x,x<0){if(I<p)return;I<m&&(m=I)}else if(x>0){if(I>m)return;I>p&&(p=I)}if(I=u-f,!(!x&&I<0)){if(I/=x,x<0){if(I>m)return;I>p&&(p=I)}else if(x>0){if(I<p)return;I<m&&(m=I)}return p>0&&(i[0]=h+p*_,i[1]=f+p*x),m<1&&(t[0]=h+m*_,t[1]=f+m*x),!0}}}}}function Zo(i,t){return Wt(i[0]-t[0])<Nt&&Wt(i[1]-t[1])<Nt}function Ho(i,t,e,r){this.x=i,this.z=t,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function bd(i,t,e,r,s){var u=[],h=[],f,g;if(i.forEach(function(I){if(!((k=I.length-1)<=0)){var k,C=I[0],R=I[k],b;if(Zo(C,R)){for(s.lineStart(),f=0;f<k;++f)s.point((C=I[f])[0],C[1]);s.lineEnd();return}u.push(b=new Ho(C,I,null,!0)),h.push(b.o=new Ho(C,null,b,!1)),u.push(b=new Ho(R,I,null,!1)),h.push(b.o=new Ho(R,null,b,!0))}}),!!u.length){for(h.sort(t),Td(u),Td(h),f=0,g=h.length;f<g;++f)h[f].e=e=!e;for(var y=u[0],p,m;;){for(var _=y,x=!0;_.v;)if((_=_.n)===y)return;p=_.z,s.lineStart();do{if(_.v=_.o.v=!0,_.e){if(x)for(f=0,g=p.length;f<g;++f)s.point((m=p[f])[0],m[1]);else r(_.x,_.n.x,1,s);_=_.n}else{if(x)for(p=_.p.z,f=p.length-1;f>=0;--f)s.point((m=p[f])[0],m[1]);else r(_.x,_.p.x,-1,s);_=_.p}_=_.o,p=_.z,x=!x}while(!_.v);s.lineEnd()}}}function Td(i){if(t=i.length){for(var t,e=0,r=i[0],s;++e<t;)r.n=s=i[e],s.p=r,r=s;r.n=s=i[0],s.p=r}}function Nd(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function JS(i){return i.length===1&&(i=KS(i)),{left:function(t,e,r,s){for(r==null&&(r=0),s==null&&(s=t.length);r<s;){var u=r+s>>>1;i(t[u],e)<0?r=u+1:s=u}return r},right:function(t,e,r,s){for(r==null&&(r=0),s==null&&(s=t.length);r<s;){var u=r+s>>>1;i(t[u],e)>0?s=u:r=u+1}return r}}}function KS(i){return function(t,e){return Nd(i(t),e)}}JS(Nd);function Md(i){for(var t=i.length,e,r=-1,s=0,u,h;++r<t;)s+=i[r].length;for(u=new Array(s);--t>=0;)for(h=i[t],e=h.length;--e>=0;)u[--s]=h[e];return u}var vs=1e9,Jo=-vs;function QS(i,t,e,r){function s(y,p){return i<=y&&y<=e&&t<=p&&p<=r}function u(y,p,m,_){var x=0,I=0;if(y==null||(x=h(y,m))!==(I=h(p,m))||g(y,p)<0^m>0)do _.point(x===0||x===3?i:e,x>1?r:t);while((x=(x+m+4)%4)!==I);else _.point(p[0],p[1])}function h(y,p){return Wt(y[0]-i)<Nt?p>0?0:3:Wt(y[0]-e)<Nt?p>0?2:1:Wt(y[1]-t)<Nt?p>0?1:0:p>0?3:2}function f(y,p){return g(y.x,p.x)}function g(y,p){var m=h(y,1),_=h(p,1);return m!==_?m-_:m===0?p[1]-y[1]:m===1?y[0]-p[0]:m===2?y[1]-p[1]:p[0]-y[0]}return function(y){var p=y,m=Rd(),_,x,I,k,C,R,b,O,A,L,D,F={point:G,lineStart:H,lineEnd:Q,polygonStart:tt,polygonEnd:J};function G(K,V){s(K,V)&&p.point(K,V)}function B(){for(var K=0,V=0,lt=x.length;V<lt;++V)for(var ft=x[V],St=1,Z=ft.length,pt=ft[0],vt,Pt,z=pt[0],ve=pt[1];St<Z;++St)vt=z,Pt=ve,pt=ft[St],z=pt[0],ve=pt[1],Pt<=r?ve>r&&(z-vt)*(r-Pt)>(ve-Pt)*(i-vt)&&++K:ve<=r&&(z-vt)*(r-Pt)<(ve-Pt)*(i-vt)&&--K;return K}function tt(){p=m,_=[],x=[],D=!0}function J(){var K=B(),V=D&&K,lt=(_=Md(_)).length;(V||lt)&&(y.polygonStart(),V&&(y.lineStart(),u(null,null,1,y),y.lineEnd()),lt&&bd(_,f,K,u,y),y.polygonEnd()),p=y,_=x=I=null}function H(){F.point=X,x&&x.push(I=[]),L=!0,A=!1,b=O=NaN}function Q(){_&&(X(k,C),R&&A&&m.rejoin(),_.push(m.result())),F.point=G,A&&p.lineEnd()}function X(K,V){var lt=s(K,V);if(x&&I.push([K,V]),L)k=K,C=V,R=lt,L=!1,lt&&(p.lineStart(),p.point(K,V));else if(lt&&A)p.point(K,V);else{var ft=[b=Math.max(Jo,Math.min(vs,b)),O=Math.max(Jo,Math.min(vs,O))],St=[K=Math.max(Jo,Math.min(vs,K)),V=Math.max(Jo,Math.min(vs,V))];HS(ft,St,i,t,e,r)?(A||(p.lineStart(),p.point(ft[0],ft[1])),p.point(St[0],St[1]),lt||p.lineEnd(),D=!1):lt&&(p.lineStart(),p.point(K,V),D=!1)}b=K,O=V,A=lt}return F}}var vl=Kn();function tI(i,t){var e=t[0],r=t[1],s=[At(e),-Lt(e),0],u=0,h=0;vl.reset();for(var f=0,g=i.length;f<g;++f)if(p=(y=i[f]).length)for(var y,p,m=y[p-1],_=m[0],x=m[1]/2+md,I=At(x),k=Lt(x),C=0;C<p;++C,_=b,I=A,k=L,m=R){var R=y[C],b=R[0],O=R[1]/2+md,A=At(O),L=Lt(O),D=b-_,F=D>=0?1:-1,G=F*D,B=G>Et,tt=I*A;if(vl.add(yr(tt*F*At(G),k*L+tt*Lt(G))),u+=B?D+F*ln:D,B^_>=e^b>=e){var J=jo(mr(m),mr(R));pl(J);var H=jo(s,J);pl(H);var Q=(B^D>=0?-1:1)*Ni(H[2]);(r>Q||r===Q&&(J[0]||J[1]))&&(h+=B^D>=0?1:-1)}}return(u<-Nt||u<Nt&&vl<-Nt)^h&1}Kn();function Od(i){return i}Kn(),Kn();var vr=1/0,Ko=vr,_s=-vr,Qo=_s,Ld={point:eI,lineStart:ms,lineEnd:ms,polygonStart:ms,polygonEnd:ms,result:function(){var i=[[vr,Ko],[_s,Qo]];return _s=Qo=-(Ko=vr=1/0),i}};function eI(i,t){i<vr&&(vr=i),i>_s&&(_s=i),t<Ko&&(Ko=t),t>Qo&&(Qo=t)}Kn();function Ad(i,t,e,r){return function(s,u){var h=t(u),f=s.invert(r[0],r[1]),g=Rd(),y=t(g),p=!1,m,_,x,I={point:k,lineStart:R,lineEnd:b,polygonStart:function(){I.point=O,I.lineStart=A,I.lineEnd=L,_=[],m=[]},polygonEnd:function(){I.point=k,I.lineStart=R,I.lineEnd=b,_=Md(_);var D=tI(m,f);_.length?(p||(u.polygonStart(),p=!0),bd(_,iI,D,e,u)):D&&(p||(u.polygonStart(),p=!0),u.lineStart(),e(null,null,1,u),u.lineEnd()),p&&(u.polygonEnd(),p=!1),_=m=null},sphere:function(){u.polygonStart(),u.lineStart(),e(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function k(D,F){var G=s(D,F);i(D=G[0],F=G[1])&&u.point(D,F)}function C(D,F){var G=s(D,F);h.point(G[0],G[1])}function R(){I.point=C,h.lineStart()}function b(){I.point=k,h.lineEnd()}function O(D,F){x.push([D,F]);var G=s(D,F);y.point(G[0],G[1])}function A(){y.lineStart(),x=[]}function L(){O(x[0][0],x[0][1]),y.lineEnd();var D=y.clean(),F=g.result(),G,B=F.length,tt,J,H;if(x.pop(),m.push(x),x=null,!!B){if(D&1){if(J=F[0],(tt=J.length-1)>0){for(p||(u.polygonStart(),p=!0),u.lineStart(),G=0;G<tt;++G)u.point((H=J[G])[0],H[1]);u.lineEnd()}return}B>1&&D&2&&F.push(F.pop().concat(F.shift())),_.push(F.filter(nI))}}return I}}function nI(i){return i.length>1}function iI(i,t){return((i=i.x)[0]<0?i[1]-un-Nt:un-i[1])-((t=t.x)[0]<0?t[1]-un-Nt:un-t[1])}const Pd=Ad(function(){return!0},rI,oI,[-Et,-un]);function rI(i){var t=NaN,e=NaN,r=NaN,s;return{lineStart:function(){i.lineStart(),s=1},point:function(u,h){var f=u>0?Et:-Et,g=Wt(u-t);Wt(g-Et)<Nt?(i.point(t,e=(e+h)/2>0?un:-un),i.point(r,e),i.lineEnd(),i.lineStart(),i.point(f,e),i.point(u,e),s=0):r!==f&&g>=Et&&(Wt(t-r)<Nt&&(t-=r*Nt),Wt(u-f)<Nt&&(u-=f*Nt),e=sI(t,e,u,h),i.point(r,e),i.lineEnd(),i.lineStart(),i.point(f,e),s=0),i.point(t=u,e=h),r=f},lineEnd:function(){i.lineEnd(),t=e=NaN},clean:function(){return 2-s}}}function sI(i,t,e,r){var s,u,h=At(i-e);return Wt(h)>Nt?US((At(t)*(u=Lt(r))*At(e)-At(r)*(s=Lt(t))*At(i))/(s*u*h)):(t+r)/2}function oI(i,t,e,r){var s;if(i==null)s=e*un,r.point(-Et,s),r.point(0,s),r.point(Et,s),r.point(Et,0),r.point(Et,-s),r.point(0,-s),r.point(-Et,-s),r.point(-Et,0),r.point(-Et,s);else if(Wt(i[0]-t[0])>Nt){var u=i[0]<t[0]?Et:-Et;s=e*u/2,r.point(-u,s),r.point(0,s),r.point(u,s)}else r.point(t[0],t[1])}function aI(i,t){var e=Lt(i),r=e>0,s=Wt(e)>Nt;function u(p,m,_,x){ZS(x,i,t,_,p,m)}function h(p,m){return Lt(p)*Lt(m)>e}function f(p){var m,_,x,I,k;return{lineStart:function(){I=x=!1,k=1},point:function(C,R){var b=[C,R],O,A=h(C,R),L=r?A?0:y(C,R):A?y(C+(C<0?Et:-Et),R):0;if(!m&&(I=x=A)&&p.lineStart(),A!==x&&(O=g(m,b),(!O||Zo(m,O)||Zo(b,O))&&(b[0]+=Nt,b[1]+=Nt,A=h(b[0],b[1]))),A!==x)k=0,A?(p.lineStart(),O=g(b,m),p.point(O[0],O[1])):(O=g(m,b),p.point(O[0],O[1]),p.lineEnd()),m=O;else if(s&&m&&r^A){var D;!(L&_)&&(D=g(b,m,!0))&&(k=0,r?(p.lineStart(),p.point(D[0][0],D[0][1]),p.point(D[1][0],D[1][1]),p.lineEnd()):(p.point(D[1][0],D[1][1]),p.lineEnd(),p.lineStart(),p.point(D[0][0],D[0][1])))}A&&(!m||!Zo(m,b))&&p.point(b[0],b[1]),m=b,x=A,_=L},lineEnd:function(){x&&p.lineEnd(),m=null},clean:function(){return k|(I&&x)<<1}}}function g(p,m,_){var x=mr(p),I=mr(m),k=[1,0,0],C=jo(x,I),R=Uo(C,C),b=C[0],O=R-b*b;if(!O)return!_&&p;var A=e*R/O,L=-e*b/O,D=jo(k,C),F=Vo(k,A),G=Vo(C,L);yl(F,G);var B=D,tt=Uo(F,B),J=Uo(B,B),H=tt*tt-J*(Uo(F,F)-1);if(!(H<0)){var Q=pr(H),X=Vo(B,(-tt-Q)/J);if(yl(X,F),X=dl(X),!_)return X;var K=p[0],V=m[0],lt=p[1],ft=m[1],St;V<K&&(St=K,K=V,V=St);var Z=V-K,pt=Wt(Z-Et)<Nt,vt=pt||Z<Nt;if(!pt&&ft<lt&&(St=lt,lt=ft,ft=St),vt?pt?lt+ft>0^X[1]<(Wt(X[0]-K)<Nt?lt:ft):lt<=X[1]&&X[1]<=ft:Z>Et^(K<=X[0]&&X[0]<=V)){var Pt=Vo(B,(-tt+Q)/J);return yl(Pt,F),[X,dl(Pt)]}}}function y(p,m){var _=r?i:Et-i,x=0;return p<-_?x|=1:p>_&&(x|=2),m<-_?x|=4:m>_&&(x|=8),x}return Ad(h,f,u,r?[0,-i]:[-Et,i-Et])}function Dd(i){return function(t){var e=new _l;for(var r in i)e[r]=i[r];return e.stream=t,e}}function _l(){}_l.prototype={constructor:_l,point:function(i,t){this.stream.point(i,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Fd(i,t,e){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],u=i.clipExtent&&i.clipExtent();i.scale(150).translate([0,0]),u!=null&&i.clipExtent(null),jS(e,i.stream(Ld));var h=Ld.result(),f=Math.min(r/(h[1][0]-h[0][0]),s/(h[1][1]-h[0][1])),g=+t[0][0]+(r-f*(h[1][0]+h[0][0]))/2,y=+t[0][1]+(s-f*(h[1][1]+h[0][1]))/2;return u!=null&&i.clipExtent(u),i.scale(f*150).translate([g,y])}function uI(i,t,e){return Fd(i,[[0,0],t],e)}var Gd=16,lI=Lt(30*Te);function Bd(i,t){return+t?cI(i,t):hI(i)}function hI(i){return Dd({point:function(t,e){t=i(t,e),this.stream.point(t[0],t[1])}})}function cI(i,t){function e(r,s,u,h,f,g,y,p,m,_,x,I,k,C){var R=y-r,b=p-s,O=R*R+b*b;if(O>4*t&&k--){var A=h+_,L=f+x,D=g+I,F=pr(A*A+L*L+D*D),G=Ni(D/=F),B=Wt(Wt(D)-1)<Nt||Wt(u-m)<Nt?(u+m)/2:yr(L,A),tt=i(B,G),J=tt[0],H=tt[1],Q=J-r,X=H-s,K=b*Q-R*X;(K*K/O>t||Wt((R*Q+b*X)/O-.5)>.3||h*_+f*x+g*I<lI)&&(e(r,s,u,h,f,g,J,H,B,A/=F,L/=F,D,k,C),C.point(J,H),e(J,H,B,A,L,D,y,p,m,_,x,I,k,C))}}return function(r){var s,u,h,f,g,y,p,m,_,x,I,k,C={point:R,lineStart:b,lineEnd:A,polygonStart:function(){r.polygonStart(),C.lineStart=L},polygonEnd:function(){r.polygonEnd(),C.lineStart=b}};function R(G,B){G=i(G,B),r.point(G[0],G[1])}function b(){m=NaN,C.point=O,r.lineStart()}function O(G,B){var tt=mr([G,B]),J=i(G,B);e(m,_,p,x,I,k,m=J[0],_=J[1],p=G,x=tt[0],I=tt[1],k=tt[2],Gd,r),r.point(m,_)}function A(){C.point=R,r.lineEnd()}function L(){b(),C.point=D,C.lineEnd=F}function D(G,B){O(s=G,B),u=m,h=_,f=x,g=I,y=k,C.point=O}function F(){e(m,_,p,x,I,k,u,h,s,f,g,y,Gd,r),C.lineEnd=A,A()}return C}}var fI=Dd({point:function(i,t){this.stream.point(i*Te,t*Te)}});function gI(i){return dI(function(){return i})()}function dI(i){var t,e=150,r=480,s=250,u,h,f=0,g=0,y=0,p=0,m=0,_,x,I=null,k=Pd,C=null,R,b,O,A=Od,L=.5,D=Bd(J,L),F,G;function B(X){return X=x(X[0]*Te,X[1]*Te),[X[0]*e+u,h-X[1]*e]}function tt(X){return X=x.invert((X[0]-u)/e,(h-X[1])/e),X&&[X[0]*Qn,X[1]*Qn]}function J(X,K){return X=t(X,K),[X[0]*e+u,h-X[1]*e]}B.stream=function(X){return F&&G===X?F:F=fI(k(_,D(A(G=X))))},B.clipAngle=function(X){return arguments.length?(k=+X?aI(I=X*Te,6*Te):(I=null,Pd),Q()):I*Qn},B.clipExtent=function(X){return arguments.length?(A=X==null?(C=R=b=O=null,Od):QS(C=+X[0][0],R=+X[0][1],b=+X[1][0],O=+X[1][1]),Q()):C==null?null:[[C,R],[b,O]]},B.scale=function(X){return arguments.length?(e=+X,H()):e},B.translate=function(X){return arguments.length?(r=+X[0],s=+X[1],H()):[r,s]},B.center=function(X){return arguments.length?(f=X[0]%360*Te,g=X[1]%360*Te,H()):[f*Qn,g*Qn]},B.rotate=function(X){return arguments.length?(y=X[0]%360*Te,p=X[1]%360*Te,m=X.length>2?X[2]%360*Te:0,H()):[y*Qn,p*Qn,m*Qn]},B.precision=function(X){return arguments.length?(D=Bd(J,L=X*X),Q()):pr(L)},B.fitExtent=function(X,K){return Fd(B,X,K)},B.fitSize=function(X,K){return uI(B,X,K)};function H(){x=Sd(_=VS(y,p,m),t);var X=t(f,g);return u=r-X[0]*e,h=s+X[1]*e,Q()}function Q(){return F=G=null,B}return function(){return t=i.apply(this,arguments),B.invert=t.invert&&tt,H()}}function Yd(i){return function(t,e){var r=Lt(t),s=Lt(e),u=i(r*s);return[u*s*At(t),u*At(e)]}}function zd(i){return function(t,e){var r=pr(t*t+e*e),s=i(r),u=At(s),h=Lt(s);return[yr(t*u,r*h),Ni(r&&e*u/r)]}}var yI=Yd(function(i){return pr(2/(1+i))});yI.invert=zd(function(i){return 2*Ni(i/2)});var $d=Yd(function(i){return(i=vd(i))&&i/At(i)});$d.invert=zd(function(i){return i});function pI(){return gI($d).scale(79.4188).clipAngle(180-.001)}function Xd(i,t){return[i,t]}Xd.invert=Xd;var mI=Object.defineProperty,_r=(i,t)=>mI(i,"name",{value:t,configurable:!0}),{BufferOp:vI,GeoJSONReader:_I,GeoJSONWriter:xI}=WS;function qd(i,t,e){e=e||{};var r=e.units||"kilometers",s=e.steps||8;if(!i)throw new Error("geojson is required");if(typeof e!="object")throw new Error("options must be an object");if(typeof s!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(s<=0)throw new Error("steps must be greater than 0");var u=[];switch(i.type){case"GeometryCollection":return dr(i,function(h){var f=xs(h,t,r,s);f&&u.push(f)}),Cn(u);case"FeatureCollection":return zo(i,function(h){var f=xs(h,t,r,s);f&&zo(f,function(g){g&&u.push(g)})}),Cn(u)}return xs(i,t,r,s)}_r(qd,"buffer");function xs(i,t,e,r){var s=i.properties||{},u=i.type==="Feature"?i.geometry:i;if(u.type==="GeometryCollection"){var h=[];return dr(i,function(k){var C=xs(k,t,e,r);C&&h.push(C)}),Cn(h)}var f=Wd(u),g={type:u.type,coordinates:El(u.coordinates,f)},y=new _I,p=y.read(g),m=cl(Bo(t,e),"meters"),_=vI.bufferOp(p,m,r),x=new xI;if(_=x.write(_),!xl(_.coordinates)){var I={type:_.type,coordinates:Sl(_.coordinates,f)};return qe(I,s)}}_r(xs,"bufferFeature");function xl(i){return Array.isArray(i[0])?xl(i[0]):isNaN(i[0])}_r(xl,"coordsIsNaN");function El(i,t){return typeof i[0]!="object"?t(i):i.map(function(e){return El(e,t)})}_r(El,"projectCoords");function Sl(i,t){return typeof i[0]!="object"?t.invert(i):i.map(function(e){return Sl(e,t)})}_r(Sl,"unprojectCoords");function Wd(i){var t=dd(i).geometry.coordinates,e=[-t[0],-t[1]];return pI().rotate(e).scale(ge)}_r(Wd,"defineProjection");var EI=qd;/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function SI(i,t){var e={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},r,s,u,h;return h={next:f(0),throw:f(1),return:f(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function f(y){return function(p){return g([y,p])}}function g(y){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,s&&(u=y[0]&2?s.return:y[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,y[1])).done)return u;switch(s=0,u&&(y=[y[0]&2,u.value]),y[0]){case 0:case 1:u=y;break;case 4:return e.label++,{value:y[1],done:!1};case 5:e.label++,s=y[1],y=[0];continue;case 7:y=e.ops.pop(),e.trys.pop();continue;default:if(u=e.trys,!(u=u.length>0&&u[u.length-1])&&(y[0]===6||y[0]===2)){e=0;continue}if(y[0]===3&&(!u||y[1]>u[0]&&y[1]<u[3])){e.label=y[1];break}if(y[0]===6&&e.label<u[1]){e.label=u[1],u=y;break}if(u&&e.label<u[2]){e.label=u[2],e.ops.push(y);break}u[2]&&e.ops.pop(),e.trys.pop();continue}y=t.call(i,e)}catch(p){y=[6,p],s=0}finally{r=u=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var ti=function(){function i(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return i}();function II(i,t){return i>t?1:i<t?-1:0}function ei(i,t,e){for(var r=new ti(null,null),s=r,u=r;;){var h=e(i,t.key);if(h<0){if(t.left===null)break;if(e(i,t.left.key)<0){var f=t.left;if(t.left=f.right,f.right=t,t=f,t.left===null)break}u.left=t,u=t,t=t.left}else if(h>0){if(t.right===null)break;if(e(i,t.right.key)>0){var f=t.right;if(t.right=f.left,f.left=t,t=f,t.right===null)break}s.right=t,s=t,t=t.right}else break}return s.right=t.left,u.left=t.right,t.left=r.right,t.right=r.left,t}function Il(i,t,e,r){var s=new ti(i,t);if(e===null)return s.left=s.right=null,s;e=ei(i,e,r);var u=r(i,e.key);return u<0?(s.left=e.left,s.right=e,e.left=null):u>=0&&(s.right=e.right,s.left=e,e.right=null),s}function Ud(i,t,e){var r=null,s=null;if(t){t=ei(i,t,e);var u=e(t.key,i);u===0?(r=t.left,s=t.right):u<0?(s=t.right,t.right=null,r=t):(r=t.left,t.left=null,s=t)}return{left:r,right:s}}function wI(i,t,e){return t===null?i:(i===null||(t=ei(i.key,t,e),t.left=i),t)}function wl(i,t,e,r,s){if(i){r(""+t+(e?"└── ":"├── ")+s(i)+`
`);var u=t+(e?"    ":"│   ");i.left&&wl(i.left,u,!1,r,s),i.right&&wl(i.right,u,!0,r,s)}}var kl=function(){function i(t){t===void 0&&(t=II),this._root=null,this._size=0,this._comparator=t}return i.prototype.insert=function(t,e){return this._size++,this._root=Il(t,e,this._root,this._comparator)},i.prototype.add=function(t,e){var r=new ti(t,e);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var s=this._comparator,u=ei(t,this._root,s),h=s(t,u.key);return h===0?this._root=u:(h<0?(r.left=u.left,r.right=u,u.left=null):h>0&&(r.right=u.right,r.left=u,u.right=null),this._size++,this._root=r),this._root},i.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},i.prototype._remove=function(t,e,r){var s;if(e===null)return null;e=ei(t,e,r);var u=r(t,e.key);return u===0?(e.left===null?s=e.right:(s=ei(t,e.left,r),s.right=e.right),this._size--,s):e},i.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=ei(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},i.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var s=r(t,e.key);if(s===0)return e;s<0?e=e.left:e=e.right}return null},i.prototype.find=function(t){return this._root&&(this._root=ei(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},i.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var s=r(t,e.key);if(s===0)return!0;s<0?e=e.left:e=e.right}return!1},i.prototype.forEach=function(t,e){for(var r=this._root,s=[],u=!1;!u;)r!==null?(s.push(r),r=r.left):s.length!==0?(r=s.pop(),t.call(e,r),r=r.right):u=!0;return this},i.prototype.range=function(t,e,r,s){for(var u=[],h=this._comparator,f=this._root,g;u.length!==0||f;)if(f)u.push(f),f=f.left;else{if(f=u.pop(),g=h(f.key,e),g>0)break;if(h(f.key,t)>=0&&r.call(s,f))return this;f=f.right}return this},i.prototype.keys=function(){var t=[];return this.forEach(function(e){var r=e.key;return t.push(r)}),t},i.prototype.values=function(){var t=[];return this.forEach(function(e){var r=e.data;return t.push(r)}),t},i.prototype.min=function(){return this._root?this.minNode(this._root).key:null},i.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},i.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},i.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},i.prototype.at=function(t){for(var e=this._root,r=!1,s=0,u=[];!r;)if(e)u.push(e),e=e.left;else if(u.length>0){if(e=u.pop(),s===t)return e;s++,e=e.right}else r=!0;return null},i.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var s=this._comparator;e;){var u=s(t.key,e.key);if(u===0)break;u<0?(r=e,e=e.left):e=e.right}return r},i.prototype.prev=function(t){var e=this._root,r=null;if(t.left!==null){for(r=t.left;r.right;)r=r.right;return r}for(var s=this._comparator;e;){var u=s(t.key,e.key);if(u===0)break;u<0?e=e.left:(r=e,e=e.right)}return r},i.prototype.clear=function(){return this._root=null,this._size=0,this},i.prototype.toList=function(){return CI(this._root)},i.prototype.load=function(t,e,r){e===void 0&&(e=[]),r===void 0&&(r=!1);var s=t.length,u=this._comparator;if(r&&bl(t,e,0,s-1,u),this._root===null)this._root=Cl(t,e,0,s),this._size=s;else{var h=RI(this.toList(),kI(t,e),u);s=this._size+s,this._root=Rl({head:h},0,s)}return this},i.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(i.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),i.prototype.toString=function(t){t===void 0&&(t=function(r){return String(r.key)});var e=[];return wl(this._root,"",!0,function(r){return e.push(r)},t),e.join("")},i.prototype.update=function(t,e,r){var s=this._comparator,u=Ud(t,this._root,s),h=u.left,f=u.right;s(t,e)<0?f=Il(e,r,f,s):h=Il(e,r,h,s),this._root=wI(h,f,s)},i.prototype.split=function(t){return Ud(t,this._root,this._comparator)},i.prototype[Symbol.iterator]=function(){var t,e,r;return SI(this,function(s){switch(s.label){case 0:t=this._root,e=[],r=!1,s.label=1;case 1:return r?[3,6]:t===null?[3,2]:(e.push(t),t=t.left,[3,5]);case 2:return e.length===0?[3,4]:(t=e.pop(),[4,t]);case 3:return s.sent(),t=t.right,[3,5];case 4:r=!0,s.label=5;case 5:return[3,1];case 6:return[2]}})},i}();function Cl(i,t,e,r){var s=r-e;if(s>0){var u=e+Math.floor(s/2),h=i[u],f=t[u],g=new ti(h,f);return g.left=Cl(i,t,e,u),g.right=Cl(i,t,u+1,r),g}return null}function kI(i,t){for(var e=new ti(null,null),r=e,s=0;s<i.length;s++)r=r.next=new ti(i[s],t[s]);return r.next=null,e.next}function CI(i){for(var t=i,e=[],r=!1,s=new ti(null,null),u=s;!r;)t?(e.push(t),t=t.left):e.length>0?(t=u=u.next=e.pop(),t=t.right):r=!0;return u.next=null,s.next}function Rl(i,t,e){var r=e-t;if(r>0){var s=t+Math.floor(r/2),u=Rl(i,t,s),h=i.head;return h.left=u,i.head=i.head.next,h.right=Rl(i,s+1,e),h}return null}function RI(i,t,e){for(var r=new ti(null,null),s=r,u=i,h=t;u!==null&&h!==null;)e(u.key,h.key)<0?(s.next=u,u=u.next):(s.next=h,h=h.next),s=s.next;return u!==null?s.next=u:h!==null&&(s.next=h),r.next}function bl(i,t,e,r,s){if(!(e>=r)){for(var u=i[e+r>>1],h=e-1,f=r+1;;){do h++;while(s(i[h],u)<0);do f--;while(s(i[f],u)>0);if(h>=f)break;var g=i[h];i[h]=i[f],i[f]=g,g=t[h],t[h]=t[f],t[f]=g}bl(i,t,e,f,s),bl(i,t,f+1,r,s)}}const Rn=11102230246251565e-32,ne=134217729,bI=(3+8*Rn)*Rn;function Tl(i,t,e,r,s){let u,h,f,g,y=t[0],p=r[0],m=0,_=0;p>y==p>-y?(u=y,y=t[++m]):(u=p,p=r[++_]);let x=0;if(m<i&&_<e)for(p>y==p>-y?(h=y+u,f=u-(h-y),y=t[++m]):(h=p+u,f=u-(h-p),p=r[++_]),u=h,f!==0&&(s[x++]=f);m<i&&_<e;)p>y==p>-y?(h=u+y,g=h-u,f=u-(h-g)+(y-g),y=t[++m]):(h=u+p,g=h-u,f=u-(h-g)+(p-g),p=r[++_]),u=h,f!==0&&(s[x++]=f);for(;m<i;)h=u+y,g=h-u,f=u-(h-g)+(y-g),y=t[++m],u=h,f!==0&&(s[x++]=f);for(;_<e;)h=u+p,g=h-u,f=u-(h-g)+(p-g),p=r[++_],u=h,f!==0&&(s[x++]=f);return(u!==0||x===0)&&(s[x++]=u),x}function TI(i,t){let e=t[0];for(let r=1;r<i;r++)e+=t[r];return e}function Es(i){return new Float64Array(i)}const NI=(3+16*Rn)*Rn,MI=(2+12*Rn)*Rn,OI=(9+64*Rn)*Rn*Rn,xr=Es(4),jd=Es(8),Vd=Es(12),Zd=Es(16),se=Es(4);function LI(i,t,e,r,s,u,h){let f,g,y,p,m,_,x,I,k,C,R,b,O,A,L,D,F,G;const B=i-s,tt=e-s,J=t-u,H=r-u;A=B*H,_=ne*B,x=_-(_-B),I=B-x,_=ne*H,k=_-(_-H),C=H-k,L=I*C-(A-x*k-I*k-x*C),D=J*tt,_=ne*J,x=_-(_-J),I=J-x,_=ne*tt,k=_-(_-tt),C=tt-k,F=I*C-(D-x*k-I*k-x*C),R=L-F,m=L-R,xr[0]=L-(R+m)+(m-F),b=A+R,m=b-A,O=A-(b-m)+(R-m),R=O-D,m=O-R,xr[1]=O-(R+m)+(m-D),G=b+R,m=G-b,xr[2]=b-(G-m)+(R-m),xr[3]=G;let Q=TI(4,xr),X=MI*h;if(Q>=X||-Q>=X||(m=i-B,f=i-(B+m)+(m-s),m=e-tt,y=e-(tt+m)+(m-s),m=t-J,g=t-(J+m)+(m-u),m=r-H,p=r-(H+m)+(m-u),f===0&&g===0&&y===0&&p===0)||(X=OI*h+bI*Math.abs(Q),Q+=B*p+H*f-(J*y+tt*g),Q>=X||-Q>=X))return Q;A=f*H,_=ne*f,x=_-(_-f),I=f-x,_=ne*H,k=_-(_-H),C=H-k,L=I*C-(A-x*k-I*k-x*C),D=g*tt,_=ne*g,x=_-(_-g),I=g-x,_=ne*tt,k=_-(_-tt),C=tt-k,F=I*C-(D-x*k-I*k-x*C),R=L-F,m=L-R,se[0]=L-(R+m)+(m-F),b=A+R,m=b-A,O=A-(b-m)+(R-m),R=O-D,m=O-R,se[1]=O-(R+m)+(m-D),G=b+R,m=G-b,se[2]=b-(G-m)+(R-m),se[3]=G;const K=Tl(4,xr,4,se,jd);A=B*p,_=ne*B,x=_-(_-B),I=B-x,_=ne*p,k=_-(_-p),C=p-k,L=I*C-(A-x*k-I*k-x*C),D=J*y,_=ne*J,x=_-(_-J),I=J-x,_=ne*y,k=_-(_-y),C=y-k,F=I*C-(D-x*k-I*k-x*C),R=L-F,m=L-R,se[0]=L-(R+m)+(m-F),b=A+R,m=b-A,O=A-(b-m)+(R-m),R=O-D,m=O-R,se[1]=O-(R+m)+(m-D),G=b+R,m=G-b,se[2]=b-(G-m)+(R-m),se[3]=G;const V=Tl(K,jd,4,se,Vd);A=f*p,_=ne*f,x=_-(_-f),I=f-x,_=ne*p,k=_-(_-p),C=p-k,L=I*C-(A-x*k-I*k-x*C),D=g*y,_=ne*g,x=_-(_-g),I=g-x,_=ne*y,k=_-(_-y),C=y-k,F=I*C-(D-x*k-I*k-x*C),R=L-F,m=L-R,se[0]=L-(R+m)+(m-F),b=A+R,m=b-A,O=A-(b-m)+(R-m),R=O-D,m=O-R,se[1]=O-(R+m)+(m-D),G=b+R,m=G-b,se[2]=b-(G-m)+(R-m),se[3]=G;const lt=Tl(V,Vd,4,se,Zd);return Zd[lt-1]}function AI(i,t,e,r,s,u){const h=(t-u)*(e-s),f=(i-s)*(r-u),g=h-f,y=Math.abs(h+f);return Math.abs(g)>=NI*y?g:-LI(i,t,e,r,s,u,y)}const Ss=(i,t)=>i.ll.x<=t.x&&t.x<=i.ur.x&&i.ll.y<=t.y&&t.y<=i.ur.y,Nl=(i,t)=>{if(t.ur.x<i.ll.x||i.ur.x<t.ll.x||t.ur.y<i.ll.y||i.ur.y<t.ll.y)return null;const e=i.ll.x<t.ll.x?t.ll.x:i.ll.x,r=i.ur.x<t.ur.x?i.ur.x:t.ur.x,s=i.ll.y<t.ll.y?t.ll.y:i.ll.y,u=i.ur.y<t.ur.y?i.ur.y:t.ur.y;return{ll:{x:e,y:s},ur:{x:r,y:u}}};let ni=Number.EPSILON;ni===void 0&&(ni=Math.pow(2,-52));const PI=ni*ni,Hd=(i,t)=>{if(-ni<i&&i<ni&&-ni<t&&t<ni)return 0;const e=i-t;return e*e<PI*i*t?0:i<t?-1:1};class DI{constructor(){this.reset()}reset(){this.xRounder=new Jd,this.yRounder=new Jd}round(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}class Jd{constructor(){this.tree=new kl,this.round(0)}round(t){const e=this.tree.add(t),r=this.tree.prev(e);if(r!==null&&Hd(e.key,r.key)===0)return this.tree.remove(t),r.key;const s=this.tree.next(e);return s!==null&&Hd(e.key,s.key)===0?(this.tree.remove(t),s.key):t}}const Is=new DI,ta=(i,t)=>i.x*t.y-i.y*t.x,Kd=(i,t)=>i.x*t.x+i.y*t.y,Qd=(i,t,e)=>{const r=AI(i.x,i.y,t.x,t.y,e.x,e.y);return r>0?-1:r<0?1:0},ea=i=>Math.sqrt(Kd(i,i)),FI=(i,t,e)=>{const r={x:t.x-i.x,y:t.y-i.y},s={x:e.x-i.x,y:e.y-i.y};return ta(s,r)/ea(s)/ea(r)},GI=(i,t,e)=>{const r={x:t.x-i.x,y:t.y-i.y},s={x:e.x-i.x,y:e.y-i.y};return Kd(s,r)/ea(s)/ea(r)},ty=(i,t,e)=>t.y===0?null:{x:i.x+t.x/t.y*(e-i.y),y:e},ey=(i,t,e)=>t.x===0?null:{x:e,y:i.y+t.y/t.x*(e-i.x)},BI=(i,t,e,r)=>{if(t.x===0)return ey(e,r,i.x);if(r.x===0)return ey(i,t,e.x);if(t.y===0)return ty(e,r,i.y);if(r.y===0)return ty(i,t,e.y);const s=ta(t,r);if(s==0)return null;const u={x:e.x-i.x,y:e.y-i.y},h=ta(u,t)/s,f=ta(u,r)/s,g=i.x+f*t.x,y=e.x+h*r.x,p=i.y+f*t.y,m=e.y+h*r.y,_=(g+y)/2,x=(p+m)/2;return{x:_,y:x}};class Ne{static compare(t,e){const r=Ne.comparePoints(t.point,e.point);return r!==0?r:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:ii.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}constructor(t,e){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let r=0,s=e.length;r<s;r++){const u=e[r];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const r=this.point.events[e];if(r.segment.consumedBy===void 0)for(let s=e+1;s<t;s++){const u=this.point.events[s];u.consumedBy===void 0&&r.otherSE.point.events===u.otherSE.point.events&&r.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,r=this.point.events.length;e<r;e++){const s=this.point.events[e];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&t.push(s)}return t}getLeftmostComparator(t){const e=new Map,r=s=>{const u=s.otherSE;e.set(s,{sine:FI(this.point,t.point,u.point),cosine:GI(this.point,t.point,u.point)})};return(s,u)=>{e.has(s)||r(s),e.has(u)||r(u);const{sine:h,cosine:f}=e.get(s),{sine:g,cosine:y}=e.get(u);return h>=0&&g>=0?f<y?1:f>y?-1:0:h<0&&g<0?f<y?-1:f>y?1:0:g<h?-1:g>h?1:0}}}let YI=0;class ii{static compare(t,e){const r=t.leftSE.point.x,s=e.leftSE.point.x,u=t.rightSE.point.x,h=e.rightSE.point.x;if(h<r)return 1;if(u<s)return-1;const f=t.leftSE.point.y,g=e.leftSE.point.y,y=t.rightSE.point.y,p=e.rightSE.point.y;if(r<s){if(g<f&&g<y)return 1;if(g>f&&g>y)return-1;const m=t.comparePoint(e.leftSE.point);if(m<0)return 1;if(m>0)return-1;const _=e.comparePoint(t.rightSE.point);return _!==0?_:-1}if(r>s){if(f<g&&f<p)return-1;if(f>g&&f>p)return 1;const m=e.comparePoint(t.leftSE.point);if(m!==0)return m;const _=t.comparePoint(e.rightSE.point);return _<0?1:_>0?-1:1}if(f<g)return-1;if(f>g)return 1;if(u<h){const m=e.comparePoint(t.rightSE.point);if(m!==0)return m}if(u>h){const m=t.comparePoint(e.rightSE.point);if(m<0)return 1;if(m>0)return-1}if(u!==h){const m=y-f,_=u-r,x=p-g,I=h-s;if(m>_&&x<I)return 1;if(m<_&&x>I)return-1}return u>h?1:u<h||y<p?-1:y>p?1:t.id<e.id?-1:t.id>e.id?1:0}constructor(t,e,r,s){this.id=++YI,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=r,this.windings=s}static fromRing(t,e,r){let s,u,h;const f=Ne.comparePoints(t,e);if(f<0)s=t,u=e,h=1;else if(f>0)s=e,u=t,h=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const g=new Ne(s,!0),y=new Ne(u,!1);return new ii(g,y,[r],[h])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const e=this.leftSE.point,r=this.rightSE.point,s=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;const u=(t.y-e.y)/s.y,h=e.x+u*s.x;if(t.x===h)return 0;const f=(t.x-e.x)/s.x,g=e.y+f*s.y;return t.y===g?0:t.y<g?-1:1}getIntersection(t){const e=this.bbox(),r=t.bbox(),s=Nl(e,r);if(s===null)return null;const u=this.leftSE.point,h=this.rightSE.point,f=t.leftSE.point,g=t.rightSE.point,y=Ss(e,f)&&this.comparePoint(f)===0,p=Ss(r,u)&&t.comparePoint(u)===0,m=Ss(e,g)&&this.comparePoint(g)===0,_=Ss(r,h)&&t.comparePoint(h)===0;if(p&&y)return _&&!m?h:!_&&m?g:null;if(p)return m&&u.x===g.x&&u.y===g.y?null:u;if(y)return _&&h.x===f.x&&h.y===f.y?null:f;if(_&&m)return null;if(_)return h;if(m)return g;const x=BI(u,this.vector(),f,t.vector());return x===null||!Ss(s,x)?null:Is.round(x.x,x.y)}split(t){const e=[],r=t.events!==void 0,s=new Ne(t,!0),u=new Ne(t,!1),h=this.rightSE;this.replaceRightSE(u),e.push(u),e.push(s);const f=new ii(s,h,this.rings.slice(),this.windings.slice());return Ne.comparePoints(f.leftSE.point,f.rightSE.point)>0&&f.swapEvents(),Ne.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(s.checkForConsuming(),u.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}consume(t){let e=this,r=t;for(;e.consumedBy;)e=e.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const s=ii.compare(e,r);if(s!==0){if(s>0){const u=e;e=r,r=u}if(e.prev===r){const u=e;e=r,r=u}for(let u=0,h=r.rings.length;u<h;u++){const f=r.rings[u],g=r.windings[u],y=e.rings.indexOf(f);y===-1?(e.rings.push(f),e.windings.push(g)):e.windings[y]+=g}r.rings=null,r.windings=null,r.consumedBy=e,r.leftSE.consumedBy=e.leftSE,r.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,r=this._afterState.windings,s=this._afterState.multiPolys;for(let f=0,g=this.rings.length;f<g;f++){const y=this.rings[f],p=this.windings[f],m=e.indexOf(y);m===-1?(e.push(y),r.push(p)):r[m]+=p}const u=[],h=[];for(let f=0,g=e.length;f<g;f++){if(r[f]===0)continue;const y=e[f],p=y.poly;if(h.indexOf(p)===-1)if(y.isExterior)u.push(p);else{h.indexOf(p)===-1&&h.push(p);const m=u.indexOf(y.poly);m!==-1&&u.splice(m,1)}}for(let f=0,g=u.length;f<g;f++){const y=u[f].multiPoly;s.indexOf(y)===-1&&s.push(y)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(We.type){case"union":{const r=t.length===0,s=e.length===0;this._isInResult=r!==s;break}case"intersection":{let r,s;t.length<e.length?(r=t.length,s=e.length):(r=e.length,s=t.length),this._isInResult=s===We.numMultiPolys&&r<s;break}case"xor":{const r=Math.abs(t.length-e.length);this._isInResult=r%2===1;break}case"difference":{const r=s=>s.length===1&&s[0].isSubject;this._isInResult=r(t)!==r(e);break}default:throw new Error(`Unrecognized operation type found ${We.type}`)}return this._isInResult}}class ny{constructor(t,e,r){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const s=Is.round(t[0][0],t[0][1]);this.bbox={ll:{x:s.x,y:s.y},ur:{x:s.x,y:s.y}};let u=s;for(let h=1,f=t.length;h<f;h++){if(typeof t[h][0]!="number"||typeof t[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let g=Is.round(t[h][0],t[h][1]);g.x===u.x&&g.y===u.y||(this.segments.push(ii.fromRing(u,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),u=g)}(s.x!==u.x||s.y!==u.y)&&this.segments.push(ii.fromRing(u,s,this))}getSweepEvents(){const t=[];for(let e=0,r=this.segments.length;e<r;e++){const s=this.segments[e];t.push(s.leftSE),t.push(s.rightSE)}return t}}class zI{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ny(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,s=t.length;r<s;r++){const u=new ny(t[r],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){const s=this.interiorRings[e].getSweepEvents();for(let u=0,h=s.length;u<h;u++)t.push(s[u])}return t}}class iy{constructor(t,e){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let r=0,s=t.length;r<s;r++){const u=new zI(t[r],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const s=this.polys[e].getSweepEvents();for(let u=0,h=s.length;u<h;u++)t.push(s[u])}return t}}class na{static factory(t){const e=[];for(let r=0,s=t.length;r<s;r++){const u=t[r];if(!u.isInResult()||u.ringOut)continue;let h=null,f=u.leftSE,g=u.rightSE;const y=[f],p=f.point,m=[];for(;h=f,f=g,y.push(f),f.point!==p;)for(;;){const _=f.getAvailableLinkedEvents();if(_.length===0){const k=y[0].point,C=y[y.length-1].point;throw new Error(`Unable to complete output ring starting at [${k.x}, ${k.y}]. Last matching segment found ends at [${C.x}, ${C.y}].`)}if(_.length===1){g=_[0].otherSE;break}let x=null;for(let k=0,C=m.length;k<C;k++)if(m[k].point===f.point){x=k;break}if(x!==null){const k=m.splice(x)[0],C=y.splice(k.index);C.unshift(C[0].otherSE),e.push(new na(C.reverse()));continue}m.push({index:y.length,point:f.point});const I=f.getLeftmostComparator(h);g=_.sort(I)[0].otherSE;break}e.push(new na(y))}return e}constructor(t){this.events=t;for(let e=0,r=t.length;e<r;e++)t[e].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const e=[t];for(let y=1,p=this.events.length-1;y<p;y++){const m=this.events[y].point,_=this.events[y+1].point;Qd(m,t,_)!==0&&(e.push(m),t=m)}if(e.length===1)return null;const r=e[0],s=e[1];Qd(r,t,s)===0&&e.shift(),e.push(e[0]);const u=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:e.length-1,f=this.isExteriorRing()?e.length:-1,g=[];for(let y=h;y!=f;y+=u)g.push([e[y].x,e[y].y]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let s=1,u=this.events.length;s<u;s++){const h=this.events[s];Ne.compare(t,h)>0&&(t=h)}let e=t.segment.prevInResult(),r=e?e.prevInResult():null;for(;;){if(!e)return null;if(!r)return e.ringOut;if(r.ringOut!==e.ringOut)return r.ringOut.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut.enclosingRing();e=r.prevInResult(),r=e?e.prevInResult():null}}}class ry{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let e=0,r=this.interiorRings.length;e<r;e++){const s=this.interiorRings[e].getGeom();s!==null&&t.push(s)}return t}}class $I{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,r=this.polys.length;e<r;e++){const s=this.polys[e].getGeom();s!==null&&t.push(s)}return t}_composePolys(t){const e=[];for(let r=0,s=t.length;r<s;r++){const u=t[r];if(!u.poly)if(u.isExteriorRing())e.push(new ry(u));else{const h=u.enclosingRing();h.poly||e.push(new ry(h)),h.poly.addInterior(u)}}return e}}class XI{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ii.compare;this.queue=t,this.tree=new kl(e),this.segments=[]}process(t){const e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;const s=t.isLeft?this.tree.add(e):this.tree.find(e);if(!s)throw new Error(`Unable to find segment #${e.id} [${e.leftSE.point.x}, ${e.leftSE.point.y}] -> [${e.rightSE.point.x}, ${e.rightSE.point.y}] in SweepLine tree.`);let u=s,h=s,f,g;for(;f===void 0;)u=this.tree.prev(u),u===null?f=null:u.key.consumedBy===void 0&&(f=u.key);for(;g===void 0;)h=this.tree.next(h),h===null?g=null:h.key.consumedBy===void 0&&(g=h.key);if(t.isLeft){let y=null;if(f){const m=f.getIntersection(e);if(m!==null&&(e.isAnEndpoint(m)||(y=m),!f.isAnEndpoint(m))){const _=this._splitSafely(f,m);for(let x=0,I=_.length;x<I;x++)r.push(_[x])}}let p=null;if(g){const m=g.getIntersection(e);if(m!==null&&(e.isAnEndpoint(m)||(p=m),!g.isAnEndpoint(m))){const _=this._splitSafely(g,m);for(let x=0,I=_.length;x<I;x++)r.push(_[x])}}if(y!==null||p!==null){let m=null;y===null?m=p:p===null?m=y:m=Ne.comparePoints(y,p)<=0?y:p,this.queue.remove(e.rightSE),r.push(e.rightSE);const _=e.split(m);for(let x=0,I=_.length;x<I;x++)r.push(_[x])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=f)}else{if(f&&g){const y=f.getIntersection(g);if(y!==null){if(!f.isAnEndpoint(y)){const p=this._splitSafely(f,y);for(let m=0,_=p.length;m<_;m++)r.push(p[m])}if(!g.isAnEndpoint(y)){const p=this._splitSafely(g,y);for(let m=0,_=p.length;m<_;m++)r.push(p[m])}}}this.tree.remove(e)}return r}_splitSafely(t,e){this.tree.remove(t);const r=t.rightSE;this.queue.remove(r);const s=t.split(e);return s.push(r),t.consumedBy===void 0&&this.tree.add(t),s}}const sy=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,qI=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class WI{run(t,e,r){We.type=t,Is.reset();const s=[new iy(e,!0)];for(let m=0,_=r.length;m<_;m++)s.push(new iy(r[m],!1));if(We.numMultiPolys=s.length,We.type==="difference"){const m=s[0];let _=1;for(;_<s.length;)Nl(s[_].bbox,m.bbox)!==null?_++:s.splice(_,1)}if(We.type==="intersection")for(let m=0,_=s.length;m<_;m++){const x=s[m];for(let I=m+1,k=s.length;I<k;I++)if(Nl(x.bbox,s[I].bbox)===null)return[]}const u=new kl(Ne.compare);for(let m=0,_=s.length;m<_;m++){const x=s[m].getSweepEvents();for(let I=0,k=x.length;I<k;I++)if(u.insert(x[I]),u.size>sy)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const h=new XI(u);let f=u.size,g=u.pop();for(;g;){const m=g.key;if(u.size===f){const x=m.segment;throw new Error(`Unable to pop() ${m.isLeft?"left":"right"} SweepEvent [${m.point.x}, ${m.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(u.size>sy)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(h.segments.length>qI)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const _=h.process(m);for(let x=0,I=_.length;x<I;x++){const k=_[x];k.consumedBy===void 0&&u.insert(k)}f=u.size,g=u.pop()}Is.reset();const y=na.factory(h.segments);return new $I(y).getGeom()}}const We=new WI;var UI={union:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return We.run("union",i,e)},intersection:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return We.run("intersection",i,e)},xor:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return We.run("xor",i,e)},difference:function(i){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return We.run("difference",i,e)}},jI=Object.defineProperty,VI=(i,t)=>jI(i,"name",{value:t,configurable:!0});function oy(i){const t=[];if(dr(i,s=>{t.push(s.coordinates)}),t.length<2)throw new Error("Must have at least two features");const e=i.features[0].properties||{},r=UI.difference(t[0],...t.slice(1));return r.length===0?null:r.length===1?ps(r[0],e):hl(r,e)}VI(oy,"difference");var ZI=oy;function ay(i){let t;for(const e of i)t&&e[0]-t[0]>=180?e[0]-=360:t&&e[0]-t[0]<-180&&(e[0]+=360),t=e}function uy(i,t){const e=ZI(Cn([ps([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),i]));if(!e)return;e.properties={isMask:"y"};const r=EI(i,0);if(r){if(r.geometry.type==="Polygon")for(const s of r.geometry.coordinates)ay(s);else for(const s of r.geometry.coordinates)for(const u of s)ay(u);t(Cn([r,e]))}}const ly="EPSG:4326";function HI(i){var u;const t=i.getProperties(),{isMask:e}=t,r=(u=i.getGeometry())==null?void 0:u.getType(),s=e?0:r==="LineString"||r==="MultiLineString"?3:2;return new zn({stroke:e?void 0:new Ji({color:"#3170fe",lineDash:[s,s],width:s,lineCap:"butt"}),fill:e?new wi({color:"#00000020"}):void 0,image:new Kr({src:`/icons/marker_${t.isReverse?"reverse":t.isSelected?"selected":"unselected"}.svg`,anchor:[.5,1]}),zIndex:t.isSelected?2:t.isReverse?0:1,text:t.isSelected&&t.tooltip?new to({backgroundFill:new wi({color:"white"}),text:t.tooltip,offsetY:-40,backgroundStroke:new Ji({color:"white",lineJoin:"round",width:3}),padding:[2,0,0,2]}):void 0})}function JI(i,t={},e={},r=HI){let s=-1,u,h,f,g=!1;const y=new v_({updateWhileAnimating:!0});i.addLayer(y);const p=new w_({});y.setSource(p),y.setStyle(r),i.on("click",x=>{i.forEachFeatureAtPixel(x.pixel,I=>{const k=I.getId();if(k)return x.stopPropagation(),h==null||h({type:"markerClick",id:k}),I})}),i.on("pointermove",x=>{const I=i.forEachFeatureAtPixel(x.pixel,k=>k.getId());u!==I&&(u&&(h==null||h({type:"markerMouseLeave",id:u})),I&&(h==null||h({type:"markerMouseEnter",id:I})),i.getTargetElement().style.cursor=I?"pointer":g?"crosshair":"",u=I)});function m(x){return x.transform(ly,i.getView().getProjection())}const _=x=>{h==null||h({type:"mapClick",coordinates:xh(x.coordinate,i.getView().getProjection())})};return{setEventHandler(x){x?(h=x,i.on("click",_)):(h=void 0,i.un("click",_))},flyTo(x,I){i.getView().animate({center:Bs(x,i.getView().getProjection()),zoom:I,duration:2e3,...t})},fitBounds(x,I,k){i.getView().fit(Fp(x,ly,i.getView().getProjection()),{padding:[I,I,I,I],maxZoom:k,duration:2e3,...e})},indicateReverse(x){g=x,i.getTargetElement().style.cursor=x?"crosshair":""},setReverseMarker(x){f?x?f.getGeometry().setCoordinates(Bs(x,i.getView().getProjection())):(p.removeFeature(f),f.dispose(),f=void 0):x&&(f=new Bt.Feature(new Dn(Bs(x,i.getView().getProjection()))),f.setProperties({isReverse:!0}),p.addFeature(f))},setMarkers(x,I){function k(C){var R;if(C)for(const b of C.features){const O=b.geometry.type==="Polygon"?new Fn(b.geometry.coordinates):b.geometry.type==="MultiPolygon"?new Br(b.geometry.coordinates):null;O&&p.addFeature(new Bt.Feature({isMask:!!((R=b.properties)!=null&&R.isMask),geometry:m(O)}))}}if(p.clear(),f&&p.addFeature(f),k(),I){let C=!1;if(I.geometry.type==="GeometryCollection"){const R=I.geometry.geometries.map(b=>b.type==="Polygon"?new Fn(b.coordinates):b.type==="MultiPolygon"?new Br(b.coordinates):null).filter(b=>!!b);if(R.length>0)p.addFeature(new Bt.Feature(m(new $s(R)))),C=!0;else for(const b of I.geometry.geometries)b.type==="LineString"?(p.addFeature(new Bt.Feature(m(new Ei(b.coordinates)))),C=!0):b.type==="MultiLineString"&&p.addFeature(new Bt.Feature(m(new Gr(b.coordinates)))),C=!0}if(!C){if(I.geometry.type==="Polygon")uy(I,k);else if(I.geometry.type==="MultiPolygon")uy(I,k);else if(I.geometry.type==="LineString"){p.addFeature(new Bt.Feature(m(new Ei(I.geometry.coordinates))));return}else if(I.geometry.type==="MultiLineString"){p.addFeature(new Bt.Feature(m(new Gr(I.geometry.coordinates))));return}}p.addFeature(new Bt.Feature(m(new Dn(I.center))))}for(const C of x??[]){if(C===I)continue;const R=new Bt.Feature(new Dn(Bs(C.center,i.getView().getProjection())));R.setId(C.id),R.setProperties({fuzzy:!!C.matching_text,tooltip:C.place_type[0]==="reverse"?C.place_name:C.place_name.replace(/,.*/,"")}),p.addFeature(R)}},setSelectedMarker(x){var C,R,b;const I=p.getFeatures(),k=(C=I[0])!=null&&C.getProperties().isReverse?1:0;s>-1&&((R=I[s+k])==null||R.setProperties({isSelected:!1})),x>-1&&((b=I[x+k])==null||b.setProperties({isSelected:!0})),s=x},getCenterAndZoom(){const x=i.getView(),I=x.getCenter(),k=x.getZoom();if(!(!I||k===void 0))return[k,...xh(I,x.getProjection())]}}}de.createOpenLayersMapController=JI,Object.defineProperty(de,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=openlayers-controller.umd.cjs.map
